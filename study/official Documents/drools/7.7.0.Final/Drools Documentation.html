<!DOCTYPE html>
<!-- saved from url=(0113)#_when_to_use_decision_tables -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="The JBoss Drools Team &lt;https://www.drools.org/community/team.html&gt;">
<title>Drools Documentation</title>
<link rel="stylesheet" href="./Drools Documentation_files/css">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="./Drools Documentation_files/font-awesome.min.css">
<script type="text/javascript" async="" src="./Drools Documentation_files/elqCfg.min.js.下载"></script><script type="text/javascript" id="s_s:0:Integrate:s_2_Integrate_Demandbase_get_0" defer="" src="./Drools Documentation_files/ip.js.下载"></script><script type="text/javascript" src="./Drools Documentation_files/svrGP"></script></head>
<body class="book toc2 toc-left" style="position: relative; margin-top: 0pxpx !important;">
<div id="header">
<h1>Drools Documentation</h1>
<div class="details">
<span id="author" class="author">The JBoss Drools Team &lt;https://www.drools.org/community/team.html&gt;</span><br>
<span id="revnumber">version 7.7.0.Final</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_welcome">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_introduction">1.1. Introduction</a></li>
<li><a href="#_gettingstarted">1.2. Getting Involved</a>
<ul class="sectlevel3">
<li><a href="#_sign_up_to_jboss_org">1.2.1. Sign up to jboss.org</a></li>
<li><a href="#_sign_the_contributor_agreement">1.2.2. Sign the Contributor Agreement</a></li>
<li><a href="#_submitting_issues_via_jira">1.2.3. Submitting issues via JIRA</a></li>
<li><a href="#_fork_github">1.2.4. Fork GitHub</a></li>
<li><a href="#_writing_tests">1.2.5. Writing Tests</a></li>
<li><a href="#_commit_with_correct_conventions">1.2.6. Commit with Correct Conventions</a></li>
<li><a href="#_submit_pull_requests">1.2.7. Submit Pull Requests</a></li>
</ul>
</li>
<li><a href="#_installationandsetup">1.3. Installation and Setup (Core and IDE)</a>
<ul class="sectlevel3">
<li><a href="#_installing_and_using">1.3.1. Installing and using</a></li>
<li><a href="#_building_from_source">1.3.2. Building from source</a></li>
<li><a href="#_eclipse">1.3.3. Eclipse</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_droolsreleasenoteschapter">2. Release Notes</a>
<ul class="sectlevel2">
<li><a href="#_drools.releasenotesdrools.7.7.0">2.1. What is New and Noteworthy in Drools 7.7</a>
<ul class="sectlevel3">
<li><a href="#_executable_model">2.1.1. Executable Model</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.7.0.final">2.2. New and Noteworthy in KIE Workbench 7.7.0</a>
<ul class="sectlevel3">
<li><a href="#_project_oriented_workbench">2.2.1. Project Oriented Workbench</a></li>
<li><a href="#_connecting_to_a_remote_kie_server_controller">2.2.2. Connecting to a remote Kie Server Controller</a></li>
<li><a href="#_content_management_enhancements">2.2.3. Content management enhancements</a></li>
<li><a href="#_new_migration_tool">2.2.4. New Migration Tool</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.6.0.final">2.3. New and Noteworthy in KIE Workbench 7.6.0</a>
<ul class="sectlevel3">
<li><a href="#_content_management_enhancements_2">2.3.1. Content management enhancements</a></li>
</ul>
</li>
<li><a href="#_kieserver.releasenoteskie.7.5.1">2.4. New Kie Server Controller Client API</a></li>
<li><a href="#_breaking_changes_in_kie_server_7_5_1_from_7_0">2.5. Breaking changes in Kie Server 7.5.1 from 7.0</a>
<ul class="sectlevel3">
<li><a href="#_kie_server_controller_api_changes">2.5.1. Kie Server Controller API changes</a></li>
<li><a href="#_kie_server_api_changes">2.5.2. Kie Server API changes</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.5.0.final">2.6. New and Noteworthy in KIE Workbench 7.5.0</a>
<ul class="sectlevel3">
<li><a href="#_content_management_enhancements_3">2.6.1. Content management enhancements</a></li>
<li><a href="#_extra_navigation_components">2.6.2. Extra navigation components</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.4.0.final">2.7. New and Noteworthy in KIE Workbench 7.4.0</a>
<ul class="sectlevel3">
<li><a href="#_guided_decision_table_improvements">2.7.1. Guided Decision Table improvements</a></li>
<li><a href="#_disable_experimental_editors">2.7.2. Disable experimental editors</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.3.0.final">2.8. New and Noteworthy in KIE Workbench 7.3.0</a>
<ul class="sectlevel3">
<li><a href="#_new_home_and_menu_bar">2.8.1. New Home and Menu Bar</a></li>
<li><a href="#_admin_page_changes">2.8.2. Admin page changes</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.1.0">2.9. What is New and Noteworthy in Drools 7.1</a></li>
<li><a href="#_wb.releasenotesworkbench.7.1.0.final">2.10. New and Noteworthy in KIE Workbench 7.1.0</a>
<ul class="sectlevel3">
<li><a href="#_project_metrics_dashboard">2.10.1. Project Metrics Dashboard</a></li>
<li><a href="#_teams_metrics_dashboard">2.10.2. Teams Metrics Dashboard</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.7.0.0">2.11. What is New and Noteworthy in Drools 7.0</a>
<ul class="sectlevel3">
<li><a href="#_core_engine">2.11.1. Core Engine</a></li>
<li><a href="#_workbench">2.11.2. Workbench</a></li>
</ul>
</li>
<li><a href="#_breaking_changes_in_drools_7_0_from_6_x">2.12. Breaking changes in Drools 7.0 from 6.x</a>
<ul class="sectlevel3">
<li><a href="#_property_reactivity_enabled_by_default">2.12.1. Property reactivity enabled by default</a></li>
<li><a href="#_type_preserving_accumulate_functions">2.12.2. Type preserving accumulate functions</a></li>
<li><a href="#_renaming_timedruleexecutionoption">2.12.3. Renaming TimedRuleExecutionOption</a></li>
<li><a href="#_renaming_and_unification_of_configuration_files">2.12.4. Renaming and unification of configuration files</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.7.0.0.final">2.13. New and Noteworthy in KIE Workbench 7.0.0</a>
<ul class="sectlevel3">
<li><a href="#_new_authoring_library">2.13.1. New Authoring (Library)</a></li>
<li><a href="#_authoring_imports_of_examples">2.13.2. Authoring - Imports of Examples</a></li>
<li><a href="#_authoring_pop_ups_improvements">2.13.3. Authoring - Pop-ups improvements</a></li>
<li><a href="#_authoring_project_editor_reimport_button">2.13.4. Authoring - Project Editor - Reimport button</a></li>
<li><a href="#_security_management">2.13.5. Security Management</a></li>
<li><a href="#_kie_config_cli_has_been_removed">2.13.6. kie-config-cli has been removed</a></li>
<li><a href="#_user_and_project_admin_pages_and_preferences">2.13.7. User and Project Admin Pages and Preferences</a></li>
<li><a href="#_gav_conflict_check_and_child_gav_edition">2.13.8. GAV conflict check and child GAV edition</a></li>
<li><a href="#_data_source_management">2.13.9. Data Source Management</a></li>
</ul>
</li>
<li><a href="#_kieserver.releasenoteskie.7.0.0">2.14. Breaking changes in Kie Server 7.0 from 6.x</a>
<ul class="sectlevel3">
<li><a href="#_serviceresponse_xstream_marshalling_changes">2.14.1. ServiceResponse XStream marshalling changes</a></li>
<li><a href="#_simplified_planner_rest_api">2.14.2. Simplified Planner REST API</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.5.0">2.15. What is New and Noteworthy in Drools 6.5.0</a>
<ul class="sectlevel3">
<li><a href="#_configurable_threadfactory">2.15.1. Configurable ThreadFactory</a></li>
<li><a href="#_use_of_any_expressions_as_input_for_a_query">2.15.2. Use of any expressions as input for a query</a></li>
<li><a href="#_update_with_modified_properties">2.15.3. Update with modified properties</a></li>
<li><a href="#_monitoring_framework_improvements">2.15.4. Monitoring framework improvements</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.4.0">2.16. What is New and Noteworthy in Drools 6.4.0</a>
<ul class="sectlevel3">
<li><a href="#_better_java_8_compatibility">2.16.1. Better Java 8 compatibility</a></li>
<li><a href="#_more_robust_incremental_compilation">2.16.2. More robust incremental compilation</a></li>
<li><a href="#_improved_multi_threading_behaviour">2.16.3. Improved multi-threading behaviour</a></li>
<li><a href="#_oopath_improvements_2">2.16.4. OOPath improvements</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.4.0.final">2.17. New and Noteworthy in KIE Workbench 6.4.0</a>
<ul class="sectlevel3">
<li><a href="#_new_look_and_feel">2.17.1. New look and feel</a></li>
<li><a href="#_various_ui_improvements">2.17.2. Various UI improvements</a></li>
<li><a href="#_new_locales">2.17.3. New locales</a></li>
<li><a href="#_authoring_imports_consistent_terminology">2.17.4. Authoring - Imports - Consistent terminology</a></li>
<li><a href="#_disable_automatic_build">2.17.5. Disable automatic build</a></li>
<li><a href="#_support_for_code_scp_code_style_code_git_code_repository_urls">2.17.6. Support for <code>SCP</code> style <code>git</code> Repository URLs</a></li>
<li><a href="#_authoring_duplicate_gav_detection">2.17.7. Authoring - Duplicate GAV detection</a></li>
<li><a href="#_new_execution_server_management_user_interface">2.17.8. New Execution Server Management User Interface</a></li>
<li><a href="#_user_and_group_management">2.17.9. User and group management</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.3.0">2.18. What is New and Noteworthy in Drools 6.3.0</a>
<ul class="sectlevel3">
<li><a href="#_browsing_graphs_of_objects_with_oopath">2.18.1. Browsing graphs of objects with OOPath</a></li>
<li><a href="#_shared.releasenotes.kienavigator">2.18.2. Kie Navigator View for Eclipse</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.3.0.final">2.19. New and Noteworthy in KIE Workbench 6.3.0</a>
<ul class="sectlevel3">
<li><a href="#_real_time_validation_and_verification_for_the_decision_tables">2.19.1. Real Time Validation and Verification for the Decision Tables</a></li>
<li><a href="#_improved_drl_editor">2.19.2. Improved DRL Editor</a></li>
<li><a href="#_asset_locking">2.19.3. Asset locking</a></li>
<li><a href="#_data_modeller_tool_windows">2.19.4. Data Modeller Tool Windows</a></li>
<li><a href="#_generation_of_jpa_enabled_data_models">2.19.5. Generation of JPA enabled Data Models</a></li>
<li><a href="#_data_set_authoring">2.19.6. Data Set Authoring</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.2.0">2.20. What is New and Noteworthy in Drools 6.2.0</a>
<ul class="sectlevel3">
<li><a href="#_propagation_modes">2.20.1. Propagation modes</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.2.0.final">2.21. New and Noteworthy in KIE Workbench 6.2.0</a>
<ul class="sectlevel3">
<li><a href="#_download_repository_or_part_of_the_repository_as_a_zip">2.21.1. Download Repository or Part of the Repository as a ZIP</a></li>
<li><a href="#_project_editor_permissions">2.21.2. Project Editor permissions</a></li>
<li><a href="#_unify_validation_style_in_guided_decision_table_wizard">2.21.3. Unify validation style in Guided Decision Table Wizard.</a></li>
<li><a href="#_improved_wizards">2.21.4. Improved Wizards</a></li>
<li><a href="#_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates">2.21.5. Consistent behaviour of XLS, Guided Decision Tables and Guided Templates</a></li>
<li><a href="#_improved_metadata_tab">2.21.6. Improved Metadata Tab</a></li>
<li><a href="#_improved_data_objects_editor">2.21.7. Improved Data Objects Editor</a></li>
<li><a href="#_execution_server_management_ui">2.21.8. Execution Server Management UI</a></li>
<li><a href="#_social_activities">2.21.9. Social Activities</a></li>
<li><a href="#_contributors_dashboard">2.21.10. Contributors Dashboard</a></li>
<li><a href="#_package_selector">2.21.11. Package selector</a></li>
<li><a href="#_improved_visual_consistency">2.21.12. Improved visual consistency</a></li>
<li><a href="#_guided_decision_tree_editor">2.21.13. Guided Decision Tree Editor</a></li>
<li><a href="#_create_repository_wizard">2.21.14. Create Repository Wizard</a></li>
<li><a href="#_repository_structure_screen">2.21.15. Repository Structure Screen</a></li>
</ul>
</li>
<li><a href="#_kie.releasenotesintegration.6.2.0">2.22. New and Noteworthy in Integration 6.2.0</a>
<ul class="sectlevel3">
<li><a href="#_kie_execution_server">2.22.1. KIE Execution Server</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.1.0">2.23. What is New and Noteworthy in Drools 6.1.0</a>
<ul class="sectlevel3">
<li><a href="#_jmx_support_for_kiescanner">2.23.1. JMX support for KieScanner</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.1.0">2.24. New and Noteworthy in KIE Workbench 6.1.0</a>
<ul class="sectlevel3">
<li><a href="#_data_modeler_round_trip_and_source_code_preservation">2.24.1. Data Modeler - round trip and source code preservation</a></li>
<li><a href="#_data_modeler_improved_annotations">2.24.2. Data Modeler - improved annotations</a></li>
<li><a href="#_standardization_of_the_display_of_tabular_data">2.24.3. Standardization of the display of tabular data</a></li>
<li><a href="#_generation_of_code_modify_x_code_blocks">2.24.4. Generation of <code>modify(x) {…​}</code> blocks</a></li>
</ul>
</li>
<li><a href="#_kie.releasenoteskie.6.0.0">2.25. New and Noteworthy in KIE API 6.0.0</a>
<ul class="sectlevel3">
<li><a href="#_new_kie_name">2.25.1. New KIE name</a></li>
<li><a href="#_maven_aligned_projects_and_modules_and_maven_deployment">2.25.2. Maven aligned projects and modules and Maven Deployment</a></li>
<li><a href="#_configuration_and_convention_based_projects">2.25.3. Configuration and convention based projects</a></li>
<li><a href="#_kiebase_inclusion">2.25.4. KieBase Inclusion</a></li>
<li><a href="#_kiemodules_kiecontainer_and_kie_ci">2.25.5. KieModules, KieContainer and KIE-CI</a></li>
<li><a href="#_kiescanner">2.25.6. KieScanner</a></li>
<li><a href="#_hierarchical_classloader">2.25.7. Hierarchical ClassLoader</a></li>
<li><a href="#_legacy_api_adapter">2.25.8. Legacy API Adapter</a></li>
<li><a href="#_kie_documentation">2.25.9. KIE Documentation</a></li>
</ul>
</li>
<li><a href="#_drools.releasenotesdrools.6.0.0">2.26. What is New and Noteworthy in Drools 6.0.0</a>
<ul class="sectlevel3">
<li><a href="#_phreak_lazy_rule_matching_algorithm">2.26.1. PHREAK - Lazy rule matching algorithm</a></li>
<li><a href="#_automatically_firing_timed_rule_in_passive_mode">2.26.2. Automatically firing timed rule in passive mode</a></li>
<li><a href="#_expression_timers">2.26.3. Expression Timers</a></li>
<li><a href="#_ruleflowgroups_and_agendagroups_are_merged">2.26.4. RuleFlowGroups and AgendaGroups are merged</a></li>
</ul>
</li>
<li><a href="#_wb.releasenotesworkbench.6.0.0">2.27. New and Noteworthy in KIE Workbench 6.0.0</a></li>
<li><a href="#_kie.releasenotesintegration.6.0.0">2.28. New and Noteworthy in Integration 6.0.0</a>
<ul class="sectlevel3">
<li><a href="#_cdi">2.28.1. CDI</a></li>
<li><a href="#_spring">2.28.2. Spring</a></li>
<li><a href="#_aries_blueprints">2.28.3. Aries Blueprints</a></li>
<li><a href="#_osgi_ready">2.28.4. OSGi Ready</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_compatibilitymatrix">3. Compatibility matrix</a></li>
<li><a href="#_kiechapter">4. KIE</a>
<ul class="sectlevel2">
<li><a href="#_kieoverviewsection">4.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_kieanatomysection">4.1.1. Anatomy of Projects</a></li>
<li><a href="#_kielifecyclessection">4.1.2. Lifecycles</a></li>
</ul>
</li>
<li><a href="#_builddeployutilizeandrunsection">4.2. Build, Deploy, Utilize and Run</a>
<ul class="sectlevel3">
<li><a href="#_kiemoduleintroductionbuildingintroductionsection">4.2.1. Introduction</a></li>
<li><a href="#_kiebuildingsection">4.2.2. Building</a></li>
<li><a href="#_kiedeployingsection">4.2.3. Deploying</a></li>
<li><a href="#_kierunningsection">4.2.4. Running</a></li>
<li><a href="#_kiedeploycheatsheets">4.2.5. Installation and Deployment Cheat Sheets</a></li>
<li><a href="#_kieexamplessection">4.2.6. Build,  Deploy and Utilize Examples</a></li>
</ul>
</li>
<li><a href="#_kiesecuritysection">4.3. Security</a>
<ul class="sectlevel3">
<li><a href="#_securitymanager">4.3.1. Security Manager</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_hybridreasoningchapter">5. Hybrid Reasoning</a>
<ul class="sectlevel2">
<li><a href="#_artificial_intelligence">5.1. Artificial Intelligence</a>
<ul class="sectlevel3">
<li><a href="#_a_little_history">5.1.1. A Little History</a></li>
<li><a href="#_knowledge_representation_and_reasoning">5.1.2. Knowledge Representation and Reasoning</a></li>
<li><a href="#_rule_engines_and_production_rule_systems_prs">5.1.3. Rule Engines and Production Rule Systems (PRS)</a></li>
<li><a href="#_hybrid_reasoning_systems_hrs">5.1.4. Hybrid Reasoning Systems (HRS)</a></li>
<li><a href="#_expert_systems">5.1.5. Expert Systems</a></li>
<li><a href="#_recommended_reading">5.1.6. Recommended Reading</a></li>
</ul>
</li>
<li><a href="#_reteoo">5.2. Rete Algorithm</a></li>
<li><a href="#_reteoosection">5.3. ReteOO Algorithm</a></li>
<li><a href="#_phreak">5.4. PHREAK Algorithm</a></li>
</ul>
</li>
<li><a href="#_user_guide">6. User Guide</a>
<ul class="sectlevel2">
<li><a href="#_the_basics">6.1. The Basics</a>
<ul class="sectlevel3">
<li><a href="#_stateless_knowledge_session">6.1.1. Stateless Knowledge Session</a></li>
<li><a href="#_stateful_knowledge_session">6.1.2. Stateful Knowledge Session</a></li>
<li><a href="#_methods_versus_rules">6.1.3. Methods versus Rules</a></li>
<li><a href="#_cross_products">6.1.4. Cross Products</a></li>
</ul>
</li>
<li><a href="#_execution_control">6.2. Execution Control</a>
<ul class="sectlevel3">
<li><a href="#_agenda">6.2.1. Agenda</a></li>
<li><a href="#_rule_matches_and_conflict_sets">6.2.2. Rule Matches and Conflict Sets.</a></li>
</ul>
</li>
<li><a href="#_inference">6.3. Inference</a>
<ul class="sectlevel3">
<li><a href="#_bus_pass_example">6.3.1. Bus Pass Example</a></li>
</ul>
</li>
<li><a href="#_truth_maintenance_with_logical_objects">6.4. Truth Maintenance with Logical Objects</a>
<ul class="sectlevel3">
<li><a href="#_overview">6.4.1. Overview</a></li>
</ul>
</li>
<li><a href="#_decision_tables_in_spreadsheets">6.5. Decision Tables in Spreadsheets</a>
<ul class="sectlevel3">
<li><a href="#_when_to_use_decision_tables">6.5.1. When to Use Decision Tables</a></li>
<li><a href="#_overview_2">6.5.2. Overview</a></li>
<li><a href="#_how_decision_tables_work">6.5.3. How Decision Tables Work</a></li>
<li><a href="#_spreadsheet_syntax">6.5.4. Spreadsheet Syntax</a></li>
<li><a href="#_creating_and_integrating_spreadsheet_based_decision_tables">6.5.5. Creating and integrating Spreadsheet based Decision Tables</a></li>
<li><a href="#_managing_business_rules_in_decision_tables">6.5.6. Managing Business Rules in Decision Tables</a></li>
<li><a href="#_rule_templates">6.5.7. Rule Templates</a></li>
</ul>
</li>
<li><a href="#_logging">6.6. Logging</a></li>
</ul>
</li>
<li><a href="#_running">7. Running</a>
<ul class="sectlevel2">
<li><a href="#_kieruntime_3">7.1. KieRuntime</a>
<ul class="sectlevel3">
<li><a href="#_entrypoint">7.1.1. EntryPoint</a></li>
<li><a href="#_ruleruntime">7.1.2. RuleRuntime</a></li>
<li><a href="#_statefulrulesession">7.1.3. StatefulRuleSession</a></li>
</ul>
</li>
<li><a href="#_agenda_2">7.2. Agenda</a>
<ul class="sectlevel3">
<li><a href="#_conflict_resolution_2">7.2.1. Conflict Resolution</a></li>
<li><a href="#_agendagroup">7.2.2. AgendaGroup</a></li>
<li><a href="#_activationgroup">7.2.3. ActivationGroup</a></li>
<li><a href="#_ruleflowgroup">7.2.4. RuleFlowGroup</a></li>
</ul>
</li>
<li><a href="#_event_model_2">7.3. Event Model</a></li>
<li><a href="#_statelesskiesession_2">7.4. StatelessKieSession</a>
<ul class="sectlevel3">
<li><a href="#_sequential_mode">7.4.1. Sequential Mode</a></li>
</ul>
</li>
<li><a href="#_rule_execution_modes">7.5. Rule Execution Modes</a>
<ul class="sectlevel3">
<li><a href="#_passive_mode">7.5.1. Passive Mode</a></li>
<li><a href="#_active_mode">7.5.2. Active Mode</a></li>
</ul>
</li>
<li><a href="#_propagation_modes_2">7.6. Propagation modes</a></li>
<li><a href="#_commands_and_the_commandexecutor_2">7.7. Commands and the CommandExecutor</a></li>
</ul>
</li>
<li><a href="#_droolslanguagereferencechapter">8. Rule Language Reference</a>
<ul class="sectlevel2">
<li><a href="#_overview_3">8.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_a_rule_file">8.1.1. A rule file</a></li>
<li><a href="#_what_makes_a_rule">8.1.2. What makes a rule</a></li>
</ul>
</li>
<li><a href="#_keywords">8.2. Keywords</a></li>
<li><a href="#_comments">8.3. Comments</a>
<ul class="sectlevel3">
<li><a href="#_single_line_comment">8.3.1. Single line comment</a></li>
<li><a href="#_multi_line_comment">8.3.2. Multi-line comment</a></li>
</ul>
</li>
<li><a href="#_error_messages">8.4. Error Messages</a>
<ul class="sectlevel3">
<li><a href="#_message_format">8.4.1. Message format</a></li>
<li><a href="#_error_messages_description">8.4.2. Error Messages Description</a></li>
<li><a href="#_other_messages">8.4.3. Other Messages</a></li>
</ul>
</li>
<li><a href="#_package">8.5. Package</a>
<ul class="sectlevel3">
<li><a href="#_import">8.5.1. import</a></li>
<li><a href="#_global">8.5.2. global</a></li>
</ul>
</li>
<li><a href="#_function">8.6. Function</a></li>
<li><a href="#_type_declaration">8.7. Type Declaration</a>
<ul class="sectlevel3">
<li><a href="#_declaring_new_types">8.7.1. Declaring New Types</a></li>
<li><a href="#_declaring_metadata">8.7.2. Declaring Metadata</a></li>
<li><a href="#_declaring_metadata_for_existing_types">8.7.3. Declaring Metadata for Existing Types</a></li>
<li><a href="#_parametrized_constructors_for_declared_types">8.7.4. Parametrized constructors for declared types</a></li>
<li><a href="#_non_typesafe_classes">8.7.5. Non Typesafe Classes</a></li>
<li><a href="#_accessing_declared_types_from_the_application_code">8.7.6. Accessing Declared Types from the Application Code</a></li>
<li><a href="#_type_declaration_extends">8.7.7. Type Declaration 'extends'</a></li>
</ul>
</li>
<li><a href="#_rule">8.8. Rule</a>
<ul class="sectlevel3">
<li><a href="#_rule_attributes">8.8.1. Rule Attributes</a></li>
<li><a href="#_timers_and_calendars">8.8.2. Timers and Calendars</a></li>
<li><a href="#_left_hand_side_when_syntax">8.8.3. Left Hand Side (when) syntax</a></li>
<li><a href="#_the_right_hand_side_then">8.8.4. The Right Hand Side (then)</a></li>
<li><a href="#_conditional_named_consequences">8.8.5. Conditional named consequences</a></li>
<li><a href="#_a_note_on_auto_boxing_and_primitive_types">8.8.6. A Note on Auto-boxing and Primitive Types</a></li>
</ul>
</li>
<li><a href="#_querysection">8.9. Query</a></li>
<li><a href="#_domain_specific_languages">8.10. Domain Specific Languages</a>
<ul class="sectlevel3">
<li><a href="#_when_to_use_a_dsl">8.10.1. When to Use a DSL</a></li>
<li><a href="#_dsl_basics">8.10.2. DSL Basics</a></li>
<li><a href="#_adding_constraints_to_facts">8.10.3. Adding Constraints to Facts</a></li>
<li><a href="#_developing_a_dsl">8.10.4. Developing a DSL</a></li>
<li><a href="#_dsl_and_dslr_reference">8.10.5. DSL and DSLR Reference</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#DroolsComplexEventProcessingChapter">9. Complex Event Processing</a>
<ul class="sectlevel2">
<li><a href="#_complex_event_processing">9.1. Complex Event Processing</a></li>
<li><a href="#_drools_fusion">9.2. Drools Fusion</a></li>
<li><a href="#_event_semantics">9.3. Event Semantics</a></li>
<li><a href="#_event_processing_modes">9.4. Event Processing Modes</a>
<ul class="sectlevel3">
<li><a href="#_cloud_mode">9.4.1. Cloud Mode</a></li>
<li><a href="#_stream_mode">9.4.2. Stream Mode</a></li>
</ul>
</li>
<li><a href="#_session_clock">9.5. Session Clock</a>
<ul class="sectlevel3">
<li><a href="#_available_clock_implementations">9.5.1. Available Clock Implementations</a></li>
</ul>
</li>
<li><a href="#_sliding_windows">9.6. Sliding Windows</a>
<ul class="sectlevel3">
<li><a href="#_sliding_time_windows">9.6.1. Sliding Time Windows</a></li>
<li><a href="#_sliding_length_windows">9.6.2. Sliding Length Windows</a></li>
<li><a href="#_window_declaration">9.6.3. Window Declaration</a></li>
</ul>
</li>
<li><a href="#_streams_support">9.7. Streams Support</a>
<ul class="sectlevel3">
<li><a href="#_declaring_and_using_entry_points">9.7.1. Declaring and Using Entry Points</a></li>
</ul>
</li>
<li><a href="#_memory_management_for_events">9.8. Memory Management for Events</a>
<ul class="sectlevel3">
<li><a href="#_explicit_expiration_offset">9.8.1. Explicit expiration offset</a></li>
<li><a href="#_inferred_expiration_offset">9.8.2. Inferred expiration offset</a></li>
</ul>
</li>
<li><a href="#_temporal_reasoning">9.9. Temporal Reasoning</a>
<ul class="sectlevel3">
<li><a href="#_temporal_operators">9.9.1. Temporal Operators</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#drools.DMN">10. Decision Model and Notation</a>
<ul class="sectlevel2">
<li><a href="#decision_model_and_notation_overview">10.1. Decision Model and Notation</a>
<ul class="sectlevel3">
<li><a href="#dmn_conformance_levels">10.1.1. Conformance Levels</a></li>
</ul>
</li>
<li><a href="#executing_decision_services_from_kie_container">10.2. Executing DMN services embedded in the application</a></li>
<li><a href="#executing_decision_services_on_the_kie_execution_server">10.3. Executing DMN services remotely on the Kie Server</a></li>
<li><a href="#feel_language_reference">10.4. FEEL Language Reference</a>
<ul class="sectlevel3">
<li><a href="#feel_language_reference_semantics">10.4.1. FEEL Language Semantics</a></li>
</ul>
</li>
<li><a href="#dmn_support_in_drools">10.5. DMN Support in Drools</a>
<ul class="sectlevel3">
<li><a href="#dmn_support_in_drools_details">10.5.1. DMN Implementation Details</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_experimentalfeatureschapter">11. Experimental Features</a>
<ul class="sectlevel2">
<li><a href="#_declarative_agenda">11.1. Declarative Agenda</a></li>
<li><a href="#_browsing_graphs_of_objects_with_oopath_2">11.2. Browsing graphs of objects with OOPath</a>
<ul class="sectlevel3">
<li><a href="#_reactive_and_non_reactive_oopath">11.2.1. Reactive and Non-Reactive OOPath</a></li>
</ul>
</li>
<li><a href="#_traits">11.3. Traits</a>
<ul class="sectlevel3">
<li><a href="#_cascading_traits">11.3.1. Cascading traits</a></li>
</ul>
</li>
<li><a href="#_rule_units_2">11.4. Rule Units</a>
<ul class="sectlevel3">
<li><a href="#_data_sources">11.4.1. Data sources</a></li>
<li><a href="#_imperatively_running_and_declaratively_guarding_a_ruleunit">11.4.2. Imperatively running and declaratively guarding a RuleUnit</a></li>
<li><a href="#_ruleunit_identity">11.4.3. RuleUnit identity</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.commands">12. Drools Commands</a>
<ul class="sectlevel2">
<li><a href="#_commandsapisection">12.1. API</a>
<ul class="sectlevel3">
<li><a href="#_xstream">12.1.1. XStream</a></li>
<li><a href="#_json">12.1.2. JSON</a></li>
<li><a href="#_jaxb">12.1.3. JAXB</a></li>
</ul>
</li>
<li><a href="#_commands_supported">12.2. Commands supported</a>
<ul class="sectlevel3">
<li><a href="#_batchexecutioncommand">12.2.1. BatchExecutionCommand</a></li>
<li><a href="#_insertobjectcommand">12.2.2. InsertObjectCommand</a></li>
<li><a href="#_retractcommand">12.2.3. RetractCommand</a></li>
<li><a href="#_modifycommand">12.2.4. ModifyCommand</a></li>
<li><a href="#_getobjectcommand">12.2.5. GetObjectCommand</a></li>
<li><a href="#_insertelementscommand">12.2.6. InsertElementsCommand</a></li>
<li><a href="#_fireallrulescommand">12.2.7. FireAllRulesCommand</a></li>
<li><a href="#_startprocesscommand">12.2.8. StartProcessCommand</a></li>
<li><a href="#_signaleventcommand">12.2.9. SignalEventCommand</a></li>
<li><a href="#_completeworkitemcommand">12.2.10. CompleteWorkItemCommand</a></li>
<li><a href="#_abortworkitemcommand">12.2.11. AbortWorkItemCommand</a></li>
<li><a href="#_querycommand">12.2.12. QueryCommand</a></li>
<li><a href="#_setglobalcommand">12.2.13. SetGlobalCommand</a></li>
<li><a href="#_getglobalcommand">12.2.14. GetGlobalCommand</a></li>
<li><a href="#_getobjectscommand">12.2.15. GetObjectsCommand</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cdichapter">13. CDI</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">13.1. Introduction</a></li>
<li><a href="#_annotations">13.2. Annotations</a>
<ul class="sectlevel3">
<li><a href="#__kreleaseid">13.2.1. @KReleaseId</a></li>
<li><a href="#__kcontainer">13.2.2. @KContainer</a></li>
<li><a href="#__kbase">13.2.3. @KBase</a></li>
<li><a href="#__ksession_for_kiesession">13.2.4. @KSession for KieSession</a></li>
<li><a href="#__ksession_for_statelesskiesession">13.2.5. @KSession for StatelessKieSession</a></li>
</ul>
</li>
<li><a href="#_api_example_comparison">13.3. API Example Comparison</a></li>
</ul>
</li>
<li><a href="#_ch.kie.spring">14. Integration with Spring</a>
<ul class="sectlevel2">
<li><a href="#_important_changes_for_drools_6_0">14.1. Important Changes for Drools 6.0</a></li>
<li><a href="#_integration_with_drools_expert">14.2. Integration with Drools Expert</a>
<ul class="sectlevel3">
<li><a href="#_kiemodule">14.2.1. KieModule</a></li>
<li><a href="#_kiebase_3">14.2.2. KieBase</a></li>
<li><a href="#_important_note">14.2.3. IMPORTANT NOTE</a></li>
<li><a href="#_kiesessions">14.2.4. KieSessions</a></li>
<li><a href="#_kie_releaseid">14.2.5. Kie:ReleaseId</a></li>
<li><a href="#_kie_import">14.2.6. Kie:Import</a></li>
<li><a href="#_annotations_2">14.2.7. Annotations</a></li>
<li><a href="#_event_listeners">14.2.8. Event Listeners</a></li>
<li><a href="#_loggers">14.2.9. Loggers</a></li>
<li><a href="#_defining_batch_commands">14.2.10. Defining Batch Commands</a></li>
<li><a href="#_persistence">14.2.11. Persistence</a></li>
<li><a href="#_leveraging_other_spring_features">14.2.12. Leveraging Other Spring Features</a></li>
</ul>
</li>
<li><a href="#_integration_with_jbpm_human_task">14.3. Integration with jBPM Human Task</a>
<ul class="sectlevel3">
<li><a href="#_how_to_configure_spring_with_jbpm_human_task">14.3.1. How to configure Spring with jBPM Human task</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.kie.blueprint">15. Integration with Aries Blueprint</a>
<ul class="sectlevel2">
<li><a href="#_integration_with_drools_expert_2">15.1. Integration with Drools Expert</a>
<ul class="sectlevel3">
<li><a href="#_kiemodule_2">15.1.1. KieModule</a></li>
<li><a href="#_kiebase_4">15.1.2. KieBase</a></li>
<li><a href="#_kiesessions_2">15.1.3. KieSessions</a></li>
<li><a href="#_kie_releaseid_2">15.1.4. Kie:ReleaseId</a></li>
<li><a href="#_kie_import_2">15.1.5. Kie:Import</a></li>
<li><a href="#_event_listeners_2">15.1.6. Event Listeners</a></li>
<li><a href="#_loggers_2">15.1.7. Loggers</a></li>
<li><a href="#_defining_batch_commands_2">15.1.8. Defining Batch Commands</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.kie.android">16. Android Integration</a>
<ul class="sectlevel2">
<li><a href="#_integration_with_drools_expert_3">16.1. Integration with Drools Expert</a>
<ul class="sectlevel3">
<li><a href="#_pre_serialized_rules">16.1.1. Pre-serialized Rules</a></li>
<li><a href="#_kiecontainer_api_with_drools_compiler_dependency">16.1.2. KieContainer API with drools-compiler dependency</a></li>
</ul>
</li>
<li><a href="#_integration_with_roboguice">16.2. Integration with Roboguice</a>
<ul class="sectlevel3">
<li><a href="#_pre_serialized_rules_with_roboguice">16.2.1. Pre-serialized Rules with Roboguice</a></li>
<li><a href="#_kiecontainer_with_drools_compiler_dependency_and_roboguice">16.2.2. KieContainer with drools-compiler dependency and Roboguice</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ch.camel">17. Apache Camel Integration</a>
<ul class="sectlevel2">
<li><a href="#_camel">17.1. Camel</a></li>
</ul>
</li>
<li><a href="#_ch.server">18. Drools Camel Server</a>
<ul class="sectlevel2">
<li><a href="#_introduction_3">18.1. Introduction</a></li>
<li><a href="#_deployment">18.2. Deployment</a></li>
<li><a href="#_configuration">18.3. Configuration</a>
<ul class="sectlevel3">
<li><a href="#_rest_camel_services_configuration">18.3.1. REST/Camel Services configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rhqchapter">19. JMX monitoring with RHQ/JON</a>
<ul class="sectlevel2">
<li><a href="#_introduction_4">19.1. Introduction</a>
<ul class="sectlevel3">
<li><a href="#_enabling_jmx_monitoring_in_a_drools_application">19.1.1. Enabling JMX monitoring in a Drools application</a></li>
<li><a href="#_installing_and_running_the_rhq_jon_plugin">19.1.2. Installing and running the RHQ/JON plugin</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_wb.workbench">20. Workbench (General)</a>
<ul class="sectlevel2">
<li><a href="#_wb.installation">20.1. Installation</a>
<ul class="sectlevel3">
<li><a href="#_wb.warinstallation">20.1.1. War installation</a></li>
<li><a href="#_wb.workbenchdata">20.1.2. Workbench data</a></li>
<li><a href="#_wb.systemproperties">20.1.3. System properties</a></li>
<li><a href="#_wb.troubleshooting">20.1.4. Trouble shooting</a></li>
</ul>
</li>
<li><a href="#_wb.quickstart">20.2. Quick Start</a>
<ul class="sectlevel3">
<li><a href="#_wb.quickstartimportexamples">20.2.1. Importing examples</a></li>
<li><a href="#_wb.quickstartaddproject">20.2.2. Add Project</a></li>
<li><a href="#_wb.quickstartdefinedatamodel">20.2.3. Define Data Model</a></li>
<li><a href="#_wb.quickstartdefinerule">20.2.4. Define Rule</a></li>
<li><a href="#_wb.quickstartbuildanddeloy">20.2.5. Build and Deploy</a></li>
</ul>
</li>
<li><a href="#_wb.configuration">20.3. Configuration</a>
<ul class="sectlevel3">
<li><a href="#_wb.usermanagement">20.3.1. Basic user management</a></li>
<li><a href="#_wb.roles">20.3.2. Roles</a></li>
</ul>
</li>
<li><a href="#_wb.introduction">20.4. Introduction</a>
<ul class="sectlevel3">
<li><a href="#_wb.loginandlogout">20.4.1. Log in and log out</a></li>
<li><a href="#_wb.homescreen">20.4.2. Home screen</a></li>
<li><a href="#_wb.administrationoverview">20.4.3. Workbench overview</a></li>
<li><a href="#_wb.workbenchconcepts">20.4.4. Workbench user interface concepts</a></li>
</ul>
</li>
<li><a href="#_wb.changinglayout">20.5. Changing the layout</a>
<ul class="sectlevel3">
<li><a href="#_wb.resizing">20.5.1. Resizing</a></li>
</ul>
</li>
<li><a href="#_wb.authoring">20.6. Authoring (General)</a>
<ul class="sectlevel3">
<li><a href="#_wb.artifactrepository">20.6.1. Artifact Repository</a></li>
<li><a href="#_wb.asseteditor">20.6.2. Asset Editor</a></li>
<li><a href="#_wb.tagseditor">20.6.3. Tags Editor</a></li>
<li><a href="#_wb.projectexplorer">20.6.4. Project Explorer</a></li>
<li><a href="#_wb.projecteditor">20.6.5. Project Editor</a></li>
<li><a href="#_wb.validation">20.6.6. Validation</a></li>
<li><a href="#_wb.datamodeller">20.6.7. Data Modeller</a></li>
<li><a href="#_wb.datasets">20.6.8. Data Sets</a></li>
<li><a href="#_wb.datasources">20.6.9. Data Source Management</a></li>
</ul>
</li>
<li><a href="#_wb.userandgroupmgmt">20.7. Security management</a>
<ul class="sectlevel3">
<li><a href="#_basic_concepts">20.7.1. Basic concepts</a></li>
<li><a href="#_installation_and_setup">20.7.2. Installation and setup</a></li>
<li><a href="#_usage_2">20.7.3. Usage</a></li>
<li><a href="#_security_settings_editor">20.7.4. Security Settings Editor</a></li>
<li><a href="#_security_policy_storage">20.7.5. Security Policy Storage</a></li>
</ul>
</li>
<li><a href="#_wb.embedding">20.8. Embedding Workbench In Your Application</a></li>
<li><a href="#_wb.execserverui">20.9. Execution Server Management UI</a>
<ul class="sectlevel3">
<li><a href="#_wb.execserveruitemplate">20.9.1. Server Templates</a></li>
<li><a href="#_wb.execserveruicontainer">20.9.2. Container</a></li>
<li><a href="#_wb.execserveruiremoteserver">20.9.3. Remote Server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#drools.AuthoringAssets">21. Authoring Rule Assets</a>
<ul class="sectlevel2">
<li><a href="#_drools.newpackage">21.1. Creating a package</a>
<ul class="sectlevel3">
<li><a href="#_empty_package">21.1.1. Empty package</a></li>
<li><a href="#_copy_rename_and_delete_packages">21.1.2. Copy, Rename and Delete Packages</a></li>
</ul>
</li>
<li><a href="#_drools.guidedruleeditor">21.2. Business rules with the guided editor</a>
<ul class="sectlevel3">
<li><a href="#_drools.guidedruleeditorparts">21.2.1. Parts of the Guided Rule Editor</a></li>
<li><a href="#_drools.guidedruleeditorlhs">21.2.2. The "WHEN" (left-hand side) of a Rule</a></li>
<li><a href="#_drools.guidedruleeditorrhs">21.2.3. The "THEN" (right-hand side) of a Rule</a></li>
<li><a href="#_drools.guidedruleeditoroptionalattributes">21.2.4. Optional attributes</a></li>
<li><a href="#_drools.guidedruleeditortoolbar">21.2.5. Pattern/Action toolbar</a></li>
<li><a href="#_drools.guidedruleeditorenumerations">21.2.6. User driven drop down lists</a></li>
<li><a href="#_drools.guidedruleeditordsl">21.2.7. Augmenting with DSL sentences</a></li>
<li><a href="#_drools.guidedruleeditorcomplexexample">21.2.8. A more complex example:</a></li>
</ul>
</li>
<li><a href="#_drools.guidedruletemplateeditor">21.3. Templates of assets/rules</a>
<ul class="sectlevel3">
<li><a href="#_drools.guidedruletemplateeditorcreating">21.3.1. Creating a rule template</a></li>
<li><a href="#_drools.guidedruletemplateeditordefining">21.3.2. Define the template</a></li>
<li><a href="#_drools.guidedruletemplateeditordefiningdata">21.3.3. Defining the template data</a></li>
<li><a href="#_drools.guidedruletemplateeditorgenerateddrl">21.3.4. Generated DRL</a></li>
</ul>
</li>
<li><a href="#_drools.guideddecisiontableeditor">21.4. Guided Decision Tables</a>
<ul class="sectlevel3">
<li><a href="#_drools.guideddecisiontableeditortypesofdecisiontable">21.4.1. Types of decision table</a></li>
<li><a href="#_drools.guideddecisiontableeditordefining">21.4.2. Defining a web based decision table</a></li>
<li><a href="#_drools.guideddecisiontableeditorhitpolicy">21.4.3. Hit Policy</a></li>
<li><a href="#_drools.guideddecisiontableeditorauditlog">21.4.4. Audit Log</a></li>
<li><a href="#_drools.guideddecisiontableeditorverification">21.4.5. Real Time Validation and Verification</a></li>
</ul>
</li>
<li><a href="#_drools.guideddecisiontablegrapheditor">21.5. Guided Decision Table Graphs</a>
<ul class="sectlevel3">
<li><a href="#_editor">21.5.1. Editor</a></li>
<li><a href="#_creating_a_new_graph">21.5.2. Creating a new graph</a></li>
<li><a href="#_adding_new_tables_to_the_graph">21.5.3. Adding new tables to the graph</a></li>
<li><a href="#_removing_tables">21.5.4. Removing tables</a></li>
</ul>
</li>
<li><a href="#_drools.guideddecisiontreeeditor">21.6. Guided Decision Trees</a>
<ul class="sectlevel3">
<li><a href="#_the_initial_editor_layout">21.6.1. The initial editor layout</a></li>
<li><a href="#_first_steps">21.6.2. First steps</a></li>
<li><a href="#_editing_data_object_nodes">21.6.3. Editing Data Object nodes</a></li>
<li><a href="#_editing_field_constraint_nodes">21.6.4. Editing Field Constraint nodes</a></li>
<li><a href="#_editing_action_nodes">21.6.5. Editing Action nodes</a></li>
<li><a href="#_managing_the_tree">21.6.6. Managing the tree</a></li>
</ul>
</li>
<li><a href="#_drools.xlsdecisiontable">21.7. Spreadsheet decision tables</a>
<ul class="sectlevel3">
<li><a href="#_convert_to_guided_decision_table">21.7.1. Convert to Guided Decision Table</a></li>
</ul>
</li>
<li><a href="#_drools.guidedscorecardeditor">21.8. Scorecards</a>
<ul class="sectlevel3">
<li><a href="#_drools.guidedscorecardeditorsetupparameters">21.8.1. (a) Setup Parameters</a></li>
<li><a href="#_drools.guidedscorecardeditorcharacteristics">21.8.2. (b) Characteristics</a></li>
</ul>
</li>
<li><a href="#_drools.testscenarioeditor">21.9. Test Scenario</a>
<ul class="sectlevel3">
<li><a href="#_drools.ksessionselector">21.9.1. Knowledge Session Selector</a></li>
<li><a href="#_drools.testscenarioeditorgivensection">21.9.2. Given Section</a></li>
<li><a href="#_drools.testscenarioeditorexpectedsection">21.9.3. Expect Section</a></li>
<li><a href="#_drools.testscenarioeditorglobalsection">21.9.4. Global Section</a></li>
<li><a href="#_drools.testscenarioeditorinpuotsection">21.9.5. New Input Section</a></li>
</ul>
</li>
<li><a href="#_drools.dsleditor">21.10. DSL editor</a></li>
<li><a href="#_drools.enumerationeditor">21.11. Data enumerations (drop down list configurations)</a>
<ul class="sectlevel3">
<li><a href="#_drools.advancedenumconcepts">21.11.1. Advanced enumeration concepts</a></li>
</ul>
</li>
<li><a href="#_drools.drleditor">21.12. DRL file</a></li>
</ul>
</li>
<li><a href="#_wb.workbenchintegration">22. Workbench Integration</a>
<ul class="sectlevel2">
<li><a href="#_drools.workbenchremoteapi">22.1. REST</a>
<ul class="sectlevel3">
<li><a href="#_job_calls">22.1.1. Job calls</a></li>
<li><a href="#_project_calls">22.1.2. Project calls</a></li>
<li><a href="#_space_calls">22.1.3. Space calls</a></li>
<li><a href="#_maven_calls">22.1.4. Maven calls</a></li>
<li><a href="#_rest_summary">22.1.5. REST summary</a></li>
<li><a href="#_embedded_kie_server_controller_calls">22.1.6. Embedded Kie Server Controller calls</a></li>
</ul>
</li>
<li><a href="#_kie.keycloakssointegration">22.2. Keycloak SSO integration</a>
<ul class="sectlevel3">
<li><a href="#_scenario">22.2.1. Scenario</a></li>
<li><a href="#_install_and_setup_a_keycloak_server">22.2.2. Install and setup a Keycloak server</a></li>
<li><a href="#_create_and_setup_the_demo_realm">22.2.3. Create and setup the demo realm</a></li>
<li><a href="#_install_and_setup_jbpm_workbench">22.2.4. Install and setup jBPM Workbench</a></li>
<li><a href="#_securing_workbench_remote_services_via_keycloak">22.2.5. Securing workbench remote services via Keycloak</a></li>
<li><a href="#_securing_workbench_s_file_system_services_via_keycloak">22.2.6. Securing workbench’s file system services via Keycloak</a></li>
<li><a href="#_execution_server">22.2.7. Execution server</a></li>
<li><a href="#consumingRemoteServices">22.2.8. Consuming remote services</a></li>
<li><a href="#_keycloak_and_the_workbench_s_security_administration_area">22.2.9. Keycloak and the workbench’s security administration area</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_wb.workbenchhighavailability">23. Workbench High Availability</a>
<ul class="sectlevel2">
<li><a href="#_wb.vfsclustering">23.1. VFS clustering</a></li>
<li><a href="#_jbpm_clustering">23.2. jBPM clustering</a></li>
</ul>
</li>
<li><a href="#_ch.kie.server">24. KIE Execution Server</a>
<ul class="sectlevel2">
<li><a href="#_overview_4">24.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_glossary">24.1.1. Glossary</a></li>
</ul>
</li>
<li><a href="#_installing_the_kie_server">24.2. Installing the KIE Server</a>
<ul class="sectlevel3">
<li><a href="#_bootstrap_switches">24.2.1. Bootstrap switches</a></li>
<li><a href="#_installation_details_for_different_containers">24.2.2. Installation details for different containers</a></li>
</ul>
</li>
<li><a href="#_kie_server_setup">24.3. Kie Server setup</a>
<ul class="sectlevel3">
<li><a href="#_managed_kie_server">24.3.1. Managed Kie Server</a></li>
<li><a href="#_unmanaged_kie_execution_server">24.3.2. Unmanaged KIE Execution Server</a></li>
</ul>
</li>
<li><a href="#_creating_a_kie_container">24.4. Creating a Kie Container</a></li>
<li><a href="#_managing_containers">24.5. Managing Containers</a>
<ul class="sectlevel3">
<li><a href="#_starting_a_container">24.5.1. Starting a Container</a></li>
<li><a href="#_stopping_and_deleting_a_container">24.5.2. Stopping and Deleting a Container</a></li>
<li><a href="#_updating_a_container">24.5.3. Updating a Container</a></li>
</ul>
</li>
<li><a href="#_kie.ksrestapi">24.6. Kie Server REST API</a>
<ul class="sectlevel3">
<li><a href="#__get">24.6.1. [GET] /</a></li>
<li><a href="#__post_config">24.6.2. [POST] /config</a></li>
<li><a href="#__get_containers">24.6.3. [GET] /containers</a></li>
<li><a href="#__get_containers_id">24.6.4. ⁠[GET] /containers/{id}</a></li>
<li><a href="#__put_containers_id">24.6.5. [PUT] /containers/{id}</a></li>
<li><a href="#__delete_containers_id">24.6.6. [DELETE] /containers/{id}</a></li>
<li><a href="#__post_containers_instances_id">24.6.7. [POST] /containers/instances/{id}</a></li>
<li><a href="#__get_containers_id_release_id">24.6.8. [GET] /containers/{id}/release-id</a></li>
<li><a href="#__post_containers_id_release_id">24.6.9. [POST] /containers/{id}/release-id</a></li>
<li><a href="#__get_containers_id_scanner">24.6.10. [GET] /containers/{id}/scanner</a></li>
<li><a href="#__post_containers_id_scanner">24.6.11. [POST] /containers/{id}/scanner</a></li>
</ul>
</li>
<li><a href="#_optaplanner_rest_api">24.7. OptaPlanner REST API</a>
<ul class="sectlevel3">
<li><a href="#__get_containers_2">24.7.1. [GET] /containers</a></li>
<li><a href="#__put_containers_containerid_solvers_solverid">24.7.2. [PUT] /containers/{containerId}/solvers/{solverId}</a></li>
<li><a href="#__get_containers_containerid_solvers">24.7.3. [GET] /containers/{containerId}/solvers</a></li>
<li><a href="#__get_containers_containerid_solvers_solverid">24.7.4. [GET] /containers/{containerId}/solvers/{solverId}</a></li>
<li><a href="#__post_containers_containerid_solvers_solverid_state_solving">24.7.5. [POST] /containers/{containerId}/solvers/{solverId}/state/solving</a></li>
<li><a href="#__post_containers_containerid_solvers_solverid_state_terminating_early">24.7.6. [POST] /containers/{containerId}/solvers/{solverId}/state/terminating-early</a></li>
<li><a href="#__get_containers_containerid_solvers_solverid_bestsolution">24.7.7. [GET] /containers/{containerId}/solvers/{solverId}/bestsolution</a></li>
<li><a href="#__post_containers_containerid_solvers_solverid_problemfactchanges">24.7.8. [POST] /containers/{containerId}/solvers/{solverId}/problemfactchanges</a></li>
<li><a href="#__get_containers_containerid_solvers_solverid_problemfactchanges_processed">24.7.9. [GET] /containers/{containerId}/solvers/{solverId}/problemfactchanges/processed</a></li>
<li><a href="#__delete_containers_containerid_solvers_solverid">24.7.10. [DELETE] /containers/{containerId}/solvers/{solverId}</a></li>
</ul>
</li>
<li><a href="#_controller_rest_api">24.8. Controller REST API</a>
<ul class="sectlevel3">
<li><a href="#__get_management_servers">24.8.1. [GET] /management/servers</a></li>
<li><a href="#__get_management_server_id">24.8.2. [GET] /management/server/{id}</a></li>
<li><a href="#__put_management_server_id">24.8.3. [PUT] /management/server/{id}</a></li>
<li><a href="#__delete_management_server_id">24.8.4. [DELETE] /management/server/{id}</a></li>
<li><a href="#__get_management_server_id_containers">24.8.5. [GET] /management/server/{id}/containers</a></li>
<li><a href="#__get_management_server_id_containers_containerid">24.8.6. [GET] /management/server/{id}/containers/{containerId}</a></li>
<li><a href="#__put_management_server_id_containers_containerid">24.8.7. [PUT] /management/server/{id}/containers/{containerId}</a></li>
<li><a href="#__delete_management_server_id_containers_containerid">24.8.8. [DELETE] /management/server/{id}/containers/{containerId}</a></li>
<li><a href="#__post_management_server_id_containers_containerid_status_started">24.8.9. [POST] /management/server/{id}/containers/{containerId}/status/started</a></li>
<li><a href="#__post_management_server_id_containers_containerid_status_stopped">24.8.10. [POST] /management/server/{id}/containers/{containerId}/status/stopped</a></li>
</ul>
</li>
<li><a href="#_kie_server_java_client_api">24.9. Kie Server Java Client API</a>
<ul class="sectlevel3">
<li><a href="#_maven_configuration_2">24.9.1. Maven Configuration</a></li>
<li><a href="#_client_configuration">24.9.2. Client Configuration</a></li>
<li><a href="#_server_response">24.9.3. Server Response</a></li>
<li><a href="#_server_capabilities">24.9.4. Server Capabilities</a></li>
<li><a href="#_kie_containers">24.9.5. Kie Containers</a></li>
<li><a href="#_managing_containers_2">24.9.6. Managing Containers</a></li>
<li><a href="#_available_clients_for_the_decision_server">24.9.7. Available Clients for the Decision Server</a></li>
<li><a href="#_sending_commands_to_the_server">24.9.8. Sending commands to the server</a></li>
<li><a href="#_listing_available_business_processes">24.9.9. Listing available business processes</a></li>
</ul>
</li>
<li><a href="#_securing_password_using_key_store">24.10. Securing password using key store</a>
<ul class="sectlevel3">
<li><a href="#_simple_usecase">24.10.1. Simple usecase</a></li>
<li><a href="#_implementation_and_business_logic">24.10.2. Implementation and business logic</a></li>
<li><a href="#_system_requirements">24.10.3. System requirements</a></li>
<li><a href="#_initialization_of_a_key_store">24.10.4. Initialization of a key store</a></li>
<li><a href="#_system_parameters_for_loading_key_store">24.10.5. System parameters for loading key store</a></li>
<li><a href="#_example_3">24.10.6. Example</a></li>
</ul>
</li>
<li><a href="#_kie_server_controller_client_api">24.11. Kie Server Controller Client API</a>
<ul class="sectlevel3">
<li><a href="#_maven_configuration_3">24.11.1. Maven Configuration</a></li>
<li><a href="#_client_configuration_2">24.11.2. Client Configuration</a></li>
<li><a href="#_setting_up_a_kie_server_controller">24.11.3. Setting up a Kie Server Controller</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_examples_2">25. Examples</a>
<ul class="sectlevel2">
<li><a href="#_getting_the_examples">25.1. Getting the Examples</a></li>
<li><a href="#_hello_world">25.2. Hello World</a></li>
<li><a href="#_state_example">25.3. State Example</a>
<ul class="sectlevel3">
<li><a href="#_understanding_the_state_example">25.3.1. Understanding the State Example</a></li>
</ul>
</li>
<li><a href="#_fibonacci_example">25.4. Fibonacci Example</a></li>
<li><a href="#_banking_tutorial">25.5. Banking Tutorial</a></li>
<li><a href="#_pricing_rule_decision_table_example">25.6. Pricing Rule Decision Table Example</a>
<ul class="sectlevel3">
<li><a href="#_executing_the_example">25.6.1. Executing the example</a></li>
<li><a href="#_the_decision_table">25.6.2. The decision table</a></li>
</ul>
</li>
<li><a href="#_pet_store_example">25.7. Pet Store Example</a></li>
<li><a href="#_honest_politician_example">25.8. Honest Politician Example</a></li>
<li><a href="#_sudoku_example">25.9. Sudoku Example</a>
<ul class="sectlevel3">
<li><a href="#_sudoku_overview">25.9.1. Sudoku Overview</a></li>
<li><a href="#_running_the_example">25.9.2. Running the Example</a></li>
<li><a href="#_java_source_and_rules_overview">25.9.3. Java Source and Rules Overview</a></li>
<li><a href="#_sudoku_validator_rules_validate_drl">25.9.4. Sudoku Validator Rules (validate.drl)</a></li>
<li><a href="#_sudoku_solving_rules_sudoku_drl">25.9.5. Sudoku Solving Rules (sudoku.drl)</a></li>
</ul>
</li>
<li><a href="#_number_guess">25.10. Number Guess</a></li>
<li><a href="#_conway_s_game_of_life">25.11. Conway’s Game Of Life</a></li>
<li><a href="#_invaders">25.12. Invaders</a>
<ul class="sectlevel3">
<li><a href="#_invaders1main">25.12.1. Invaders1Main</a></li>
<li><a href="#_invaders2main">25.12.2. Invaders2Main</a></li>
<li><a href="#_invaders3main">25.12.3. Invaders3Main</a></li>
<li><a href="#_invaders4main">25.12.4. Invaders4Main</a></li>
<li><a href="#_invaders5main">25.12.5. Invaders5Main</a></li>
<li><a href="#_invaders6main">25.12.6. Invaders6Main</a></li>
<li><a href="#_invaders4main_2">25.12.7. Invaders4Main</a></li>
</ul>
</li>
<li><a href="#_adventures_with_drools">25.13. Adventures with Drools</a>
<ul class="sectlevel3">
<li><a href="#_using_the_game">25.13.1. Using the game.</a></li>
<li><a href="#_the_code">25.13.2. The code</a></li>
</ul>
</li>
<li><a href="#_pong">25.14. Pong</a></li>
<li><a href="#_wumpus_world">25.15. Wumpus World</a></li>
<li><a href="#_miss_manners_and_benchmarking">25.16. Miss Manners and Benchmarking</a>
<ul class="sectlevel3">
<li><a href="#_introduction_5">25.16.1. Introduction</a></li>
<li><a href="#_in_depth_discussion">25.16.2. In depth Discussion</a></li>
<li><a href="#_output_summary">25.16.3. Output Summary</a></li>
</ul>
</li>
<li><a href="#_backward_chaining">25.17. Backward-Chaining</a>
<ul class="sectlevel3">
<li><a href="#_backward_chaining_systems">25.17.1. Backward-Chaining Systems</a></li>
<li><a href="#_cloning_transitive_closures">25.17.2. Cloning Transitive Closures</a></li>
<li><a href="#_defining_a_query">25.17.3. Defining a Query</a></li>
<li><a href="#_transitive_closure_example">25.17.4. Transitive Closure Example</a></li>
<li><a href="#_reactive_transitive_queries">25.17.5. Reactive Transitive Queries</a></li>
<li><a href="#_queries_with_unbound_arguments">25.17.6. Queries with Unbound Arguments</a></li>
<li><a href="#_multiple_unbound_arguments">25.17.7. Multiple Unbound Arguments</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/droolsExpertLogo.png" alt="droolsExpertLogo">
</div>
</div>
<h1 id="_welcome" class="discrete">Welcome</h1>
<div class="paragraph">
<p>Welcome and Release Notes</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_welcome"><a class="anchor" href="#_welcome"></a><a class="link" href="#_welcome">1. Introduction</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction"><a class="anchor" href="#_introduction"></a><a class="link" href="#_introduction">1.1. Introduction</a></h3>
<div class="paragraph">
<p>KIE (Knowledge Is Everything) is an umbrella project introduced to bring our related technologies together under one roof.
It also acts as the core shared between our projects.</p>
</div>
<div class="paragraph">
<p>KIE contains the following different but related projects offering a complete portfolio of solutions for business
automation and management:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Drools</strong> is a business rule management system with a forward-chaining and backward-chaining inference based rules engine,
allowing fast and reliable evaluation of business rules and complex event processing. A rule engine is also a fundamental
building block to create an expert system which, in artificial intelligence, is a computer system that emulates the decision-making
ability of a human expert.</p>
</li>
<li>
<p><strong>jBPM</strong> is a flexible Business Process Management suite allowing you to model your business goals by describing
the steps that need to be executed to achieve those goals.</p>
</li>
<li>
<p><strong>OptaPlanner</strong> is a constraint solver that optimizes use cases such as employee rostering, vehicle routing, task assignment
and cloud optimization.</p>
</li>
<li>
<p><strong>Drools Workbench</strong> is is a full featured web application for the visual composition of custom business rules and processes.</p>
</li>
<li>
<p><strong>UberFire</strong> is a web based workbench framework inspired by Eclipse Rich Client Platform.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The 7.x series will follow a more agile approach with more regular and iterative releases. We plan to do some bigger changes than normal for a series of minor releases, and users need to be aware those are coming before adopting.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>UI sections and links will become object oriented, rather than task oriented. <a href="https://en.wikipedia.org/wiki/Object-oriented_user_interface" class="bare">https://en.wikipedia.org/wiki/Object-oriented_user_interface</a></p>
</li>
<li>
<p>Authoring/Library will become project oriented, rather than repository oriented. You’ll create, browse and open projects rather than repositories. The repository concept will be pushed lower, for instance it’ll be created automaticaly when you create the projcet.</p>
</li>
<li>
<p>The old form modeller will be removed and only the new one made available. Although old forms will continue to render.</p>
</li>
<li>
<p>The new designer will continue to mature with more nodes and improved UXD. Eventually it’ll become the default editor, but we will not remove the old one until there is feature parity in BPMN2 support.</p>
</li>
<li>
<p>Continued UXD improvements in lots of places.</p>
</li>
<li>
<p>We will introduce the AppFormer project, this will be a re-org and consolidation of existing projects and result in some artifact renames. UberFire will become AppFormer-Core, forms, data modeller and dashbuilder will come under AppFormer. Dashbuilder will most likely becalled Appformer-Insight.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The 8.x series will come towards the end of this year. We have ongoing parallel work to introduce concepts of workspaces with improved git support, that will have a built in workflow for forking and pull requests. This will be combined with horizontal scaling and improved high availability. These changes are important for usability and cloud scalability, but too much of a change for a minor release, hence the bump to 8.x</p>
</div>
</div>
<div class="sect2">
<h3 id="_gettingstarted"><a class="anchor" href="#_gettingstarted"></a><a class="link" href="#_gettingstarted">1.2. Getting Involved</a></h3>
<div class="paragraph">
<p>We are often asked "How do I get involved". Luckily the answer is simple, just write some code and submit it :) There are no hoops you have to jump through or secret handshakes.
We have a very minimal "overhead" that we do request to allow for scalable project development.
Below we provide a general overview of the tools and "workflow" we request, along with some general advice.</p>
</div>
<div class="paragraph">
<p>If you contribute some good work, don’t forget to blog about it :)</p>
</div>
<div class="sect3">
<h4 id="_sign_up_to_jboss_org"><a class="anchor" href="#_sign_up_to_jboss_org"></a><a class="link" href="#_sign_up_to_jboss_org">1.2.1. Sign up to jboss.org</a></h4>
<div class="paragraph">
<p>Signing to jboss.org will give you access to the JBoss wiki, forums and JIRA.
Go to <a href="https://www.jboss.org/" class="bare">https://www.jboss.org/</a> and click "Register".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/sign_jbossorg.png" alt="sign jbossorg">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sign_the_contributor_agreement"><a class="anchor" href="#_sign_the_contributor_agreement"></a><a class="link" href="#_sign_the_contributor_agreement">1.2.2. Sign the Contributor Agreement</a></h4>
<div class="paragraph">
<p>The only form you need to sign is the contributor agreement, which is fully automated via the web.
As the image below says "This establishes the terms and conditions for your contributions and ensures that source code can be licensed appropriately"</p>
</div>
<div class="paragraph">
<p><a href="https://cla.jboss.org/" class="bare">https://cla.jboss.org/</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/sign_contributor.png" alt="sign contributor">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_submitting_issues_via_jira"><a class="anchor" href="#_submitting_issues_via_jira"></a><a class="link" href="#_submitting_issues_via_jira">1.2.3. Submitting issues via JIRA</a></h4>
<div class="paragraph">
<p>To be able to interact with the core development team you will need to use JIRA, the issue tracker.
This ensures that all requests are logged and allocated to a release schedule and all discussions captured in one place.
Bug reports, bug fixes, feature requests and feature submissions should all go here.
General questions should be undertaken at the mailing lists.</p>
</div>
<div class="paragraph">
<p>Minor code submissions, like format or documentation fixes do not need an associated JIRA issue created.</p>
</div>
<div class="paragraph">
<p><a href="https://issues.jboss.org/browse/DROOLS" class="bare">https://issues.jboss.org/browse/DROOLS</a></p>
</div>
<div class="paragraph">
<p><a href="https://issues.jboss.org/browse/JBPM" class="bare">https://issues.jboss.org/browse/JBPM</a></p>
</div>
<div class="paragraph">
<p><a href="https://issues.jboss.org/browse/GUVNOR" class="bare">https://issues.jboss.org/browse/GUVNOR</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/submit_jira.png" alt="submit jira">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fork_github"><a class="anchor" href="#_fork_github"></a><a class="link" href="#_fork_github">1.2.4. Fork GitHub</a></h4>
<div class="paragraph">
<p>With the contributor agreement signed and your requests submitted to JIRA you should now be ready to code :) Create a GitHub account and fork any of the Drools, jBPM or Guvnor repositories.
The fork will create a copy in your own GitHub space which you can work on at your own pace.
If you make a mistake, don’t worry blow it away and fork again.
Note each GitHub repository provides you the clone (checkout) URL, GitHub will provide you URLs specific to your fork.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kiegroup" class="bare">https://github.com/kiegroup</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/fork_github.png" alt="fork github">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_writing_tests"><a class="anchor" href="#_writing_tests"></a><a class="link" href="#_writing_tests">1.2.5. Writing Tests</a></h4>
<div class="paragraph">
<p>When writing tests, try and keep them minimal and self contained.
We prefer to keep the DRL fragments within the test, as it makes for quicker reviewing.
If their are a large number of rules then using a String is not practical so then by all means place them in separate DRL files instead to be loaded from the classpath.
If your tests need to use a model, please try to use those that already exist for other unit tests; such as Person, Cheese or Order.
If no classes exist that have the fields you need, try and update fields of existing classes before adding a new class.</p>
</div>
<div class="paragraph">
<p>There are a vast number of tests to look over to get an idea, MiscTest is a good place to start.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kiegroup">https://github.com/kiegroup/drools/blob/master/drools-compiler/src/test/java/org/drools/integrationtests/MiscTest.java</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/unit_test.png" alt="unit test">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_commit_with_correct_conventions"><a class="anchor" href="#_commit_with_correct_conventions"></a><a class="link" href="#_commit_with_correct_conventions">1.2.6. Commit with Correct Conventions</a></h4>
<div class="paragraph">
<p>When you commit, make sure you use the correct conventions.
The commit must start with the JIRA issue id, such as JBRULES-220.
This ensures the commits are cross referenced via JIRA, so we can see all commits for a given issue in the same place.
After the id the title of the issue should come next.
Then use a newline, indented with a dash, to provide additional information related to this commit.
Use an additional new line and dash for each separate point you wish to make.
You may add additional JIRA cross references to the same commit, if it’s appropriate.
In general try to avoid combining unrelated issues in the same commit.</p>
</div>
<div class="paragraph">
<p>Don’t forget to rebase your local fork from the original master and then push your commits back to your fork.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/jira_crossreferenced.png" alt="jira crossreferenced">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_submit_pull_requests"><a class="anchor" href="#_submit_pull_requests"></a><a class="link" href="#_submit_pull_requests">1.2.7. Submit Pull Requests</a></h4>
<div class="paragraph">
<p>With your code rebased from original master and pushed to your personal GitHub area, you can now submit your work as a pull request.
If you look at the top of the page in GitHub for your work area their will be a "Pull Request" button.
Selecting this will then provide a gui to automate the submission of your pull request.</p>
</div>
<div class="paragraph">
<p>The pull request then goes into a queue for everyone to see and comment on.
Below you can see a typical pull request.
The pull requests allow for discussions and it shows all associated commits and the diffs for each commit.
The discussions typically involve code reviews which provide helpful suggestions for improvements, and allows for us to leave inline comments on specific parts of the code.
Don’t be disheartened if we don’t merge straight away, it can often take several revisions before we accept a pull request.
Luckily GitHub makes it very trivial to go back to your code, do some more commits and then update your pull request to your latest and greatest.</p>
</div>
<div class="paragraph">
<p>It can take time for us to get round to responding to pull requests, so please be patient.
Submitted tests that come with a fix will generally be applied quite quickly, where as just tests will often way until we get time to also submit that with a fix.
Don’t forget to rebase and resubmit your request from time to time, otherwise over time it will have merge conflicts and core developers will general ignore those.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/submit_pull_request.png" alt="submit pull request">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installationandsetup"><a class="anchor" href="#_installationandsetup"></a><a class="link" href="#_installationandsetup">1.3. Installation and Setup (Core and IDE)</a></h3>
<div class="sect3">
<h4 id="_installing_and_using"><a class="anchor" href="#_installing_and_using"></a><a class="link" href="#_installing_and_using">1.3.1. Installing and using</a></h4>
<div class="paragraph">
<p>Drools provides an Eclipse-based IDE (which is optional), but at its core only Java 1.5 (Java SE) is required.</p>
</div>
<div class="paragraph">
<p>A simple way to get started is to download and install the Eclipse plug-in - this will also require the Eclipse GEF framework to be installed (see below, if you don’t have it installed already). This will provide you with all the dependencies you need to get going: you can simply create a new rule project and everything will be done for you.
Refer to the chapter on the Rule Workbench and IDE for detailed instructions on this.
Installing the Eclipse plug-in is generally as simple as unzipping a file into your Eclipse plug-in directory.</p>
</div>
<div class="paragraph">
<p>Use of the Eclipse plug-in is not required.
Rule files are just textual input (or spreadsheets as the case may be) and the IDE (also known as the Rule Workbench) is just a convenience.
People have integrated the rule engine in many ways, there is no "one size fits all".</p>
</div>
<div class="paragraph">
<p>Alternatively, you can download the binary distribution, and include the relevant JARs in your projects classpath.</p>
</div>
<div class="sect4">
<h5 id="_dependencies_and_jars"><a class="anchor" href="#_dependencies_and_jars"></a><a class="link" href="#_dependencies_and_jars">1.3.1.1. Dependencies and JARs</a></h5>
<div class="paragraph">
<p>Drools is broken down into a few modules, some are required during rule development/compiling, and some are required at runtime.
In many cases, people will simply want to include all the dependencies at runtime, and this is fine.
It allows you to have the most flexibility.
However, some may prefer to have their "runtime" stripped down to the bare minimum, as they will be deploying rules in binary form - this is also possible.
The core runtime engine can be quite compact, and only requires a few 100 kilobytes across 3 JAR files.</p>
</div>
<div class="paragraph">
<p>The following is a description of the important libraries that make up JBoss Drools</p>
</div>
<div class="ulist">
<ul>
<li>
<p>knowledge-api.jar - this provides the interfaces and factories. It also helps clearly show what is intended as a user API and what is just an engine API.</p>
</li>
<li>
<p>knowledge-internal-api.jar - this provides internal interfaces and factories.</p>
</li>
<li>
<p>drools-core.jar - this is the core engine, runtime component. Contains both the RETE engine and the LEAPS engine. This is the only runtime dependency if you are pre-compiling rules (and deploying via Package or RuleBase objects).</p>
</li>
<li>
<p>drools-compiler.jar - this contains the compiler/builder components to take rule source, and build executable rule bases. This is often a runtime dependency of your application, but it need not be if you are pre-compiling your rules. This depends on drools-core.</p>
</li>
<li>
<p>drools-jsr94.jar - this is the JSR-94 compliant implementation, this is essentially a layer over the drools-compiler component. Note that due to the nature of the JSR-94 specification, not all features are easily exposed via this interface. In some cases, it will be easier to go direct to the Drools API, but in some environments the JSR-94 is mandated.</p>
</li>
<li>
<p>drools-decisiontables.jar - this is the decision tables 'compiler' component, which uses the drools-compiler component. This supports both excel and CSV input formats.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are quite a few other dependencies which the above components require, most of which are for the drools-compiler, drools-jsr94 or drools-decisiontables module.
Some key ones to note are "POI" which provides the spreadsheet parsing ability, and "antlr" which provides the parsing for the rule language itself.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if you are using Drools in J2EE or servlet containers and you come across classpath issues with "JDT", then you can switch to the janino compiler.
Set the system property "drools.compiler": For example: -Ddrools.compiler=JANINO.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For up to date info on dependencies in a release, consult the released POMs, which can be found on the Maven repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_with_maven_gradle_ivy_buildr_or_ant"><a class="anchor" href="#_use_with_maven_gradle_ivy_buildr_or_ant"></a><a class="link" href="#_use_with_maven_gradle_ivy_buildr_or_ant">1.3.1.2. Use with Maven, Gradle, Ivy, Buildr or Ant</a></h5>
<div class="paragraph">
<p>The JARs are also available in <a href="http://search.maven.org/#search|ga|1|org.drools">the central
    Maven repository</a> (and also in <a href="https://repository.jboss.org/nexus/index.html#nexus-search;gav" class="bare">https://repository.jboss.org/nexus/index.html#nexus-search;gav</a><sub>org.drools</sub><sub>~</sub>[the JBoss Maven
    repository]).</p>
</div>
<div class="paragraph">
<p>If you use Maven, add KIE and Drools dependencies in your project’s <em class="path">pom.xml</em>
 like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  <span class="hljs-tag">&lt;<span class="hljs-title">dependencyManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-bom<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-title">type</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
      ...
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">dependencyManagement</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-compiler<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
    ...
  <span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is similar for Gradle, Ivy and Buildr.
To identify the latest version, check the Maven repository.</p>
</div>
<div class="paragraph">
<p>If you’re still using Ant (without Ivy), copy all the JARs from the download zip’s <em class="path">binaries</em>
 directory and manually verify that your classpath doesn’t contain duplicate JARs.</p>
</div>
</div>
<div class="sect4">
<h5 id="_runtime"><a class="anchor" href="#_runtime"></a><a class="link" href="#_runtime">1.3.1.3. Runtime</a></h5>
<div class="paragraph">
<p>The "runtime" requirements mentioned here are if you are deploying rules as their binary form (either as KnowledgePackage objects, or KnowledgeBase objects etc). This is an optional feature that allows you to keep your runtime very light.
You may use drools-compiler to produce rule packages "out of process", and then deploy them to a runtime system.
This runtime system only requires drools-core.jar and knowledge-api for execution.
This is an optional deployment pattern, and many people do not need to "trim" their application this much, but it is an ideal option for certain environments.</p>
</div>
</div>
<div class="sect4">
<h5 id="_installing_ide_rule_workbench"><a class="anchor" href="#_installing_ide_rule_workbench"></a><a class="link" href="#_installing_ide_rule_workbench">1.3.1.4. Installing IDE (Rule Workbench)</a></h5>
<div class="paragraph">
<p>The rule workbench (for Eclipse) requires that you have Eclipse 3.4 or greater, as well as Eclipse GEF 3.4 or greater.
You can install it either by downloading the plug-in or using the update site.</p>
</div>
<div class="paragraph">
<p>Another option is to use the JBoss IDE, which comes with all the plug-in requirements pre packaged, as well as a choice of other tools separate to rules.
You can choose just to install rules from the "bundle" that JBoss IDE ships with.</p>
</div>
<div class="sect5">
<h6 id="_installing_gef_a_required_dependency"><a class="anchor" href="#_installing_gef_a_required_dependency"></a><a class="link" href="#_installing_gef_a_required_dependency">Installing GEF (a required dependency)</a></h6>
<div class="paragraph">
<p>GEF is the Eclipse Graphical Editing Framework, which is used for graph viewing components in the plug-in.</p>
</div>
<div class="paragraph">
<p>If you don’t have GEF installed, you can install it using the built in update mechanism (or downloading GEF from the Eclipse.org website not recommended). JBoss IDE has GEF already, as do many other "distributions" of Eclipse, so this step may be redundant for some people.</p>
</div>
<div class="paragraph">
<p>Open the Help→Software updates…​→Available Software→Add Site…​ from the help menu.
Location is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby"><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/download.eclipse.org/tools</span><span class="hljs-regexp">/gef/updates</span><span class="hljs-regexp">/releases/</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next you choose the GEF plug-in:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/install_gef.png" alt="install gef">
</div>
</div>
<div class="paragraph">
<p>Press next, and agree to install the plug-in (an Eclipse restart may be required). Once this is completed, then you can continue on installing the rules plug-in.</p>
</div>
</div>
<div class="sect5">
<h6 id="_installing_gef_from_zip_file"><a class="anchor" href="#_installing_gef_from_zip_file"></a><a class="link" href="#_installing_gef_from_zip_file">Installing GEF from zip file</a></h6>
<div class="paragraph">
<p>To install from the zip file, download and unzip the file.
Inside the zip you will see a plug-in directory, and the plug-in JAR itself.
You place the plug-in JAR into your Eclipse applications plug-in directory, and restart Eclipse.</p>
</div>
</div>
<div class="sect5">
<h6 id="_installing_drools_plug_in_from_zip_file"><a class="anchor" href="#_installing_drools_plug_in_from_zip_file"></a><a class="link" href="#_installing_drools_plug_in_from_zip_file">Installing Drools plug-in from zip file</a></h6>
<div class="paragraph">
<p>Download the Drools Eclipse IDE plugin from the link below.
Unzip the downloaded file in your main eclipse folder (do not just copy the file there, extract it so that the feature and plugin JARs end up in the features and plugin directory of eclipse) and (re)start Eclipse.</p>
</div>
<div class="paragraph">
<p><a href="https://www.drools.org/download/download.html" class="bare">https://www.drools.org/download/download.html</a></p>
</div>
<div class="paragraph">
<p>To check that the installation was successful, try opening the Drools perspective: Click the 'Open Perspective' button in the top right corner of your Eclipse window, select 'Other…​' and pick the Drools perspective.
If you cannot find the Drools perspective as one of the possible perspectives, the installation probably was unsuccessful.
Check whether you executed each of the required steps correctly: Do you have the right version of Eclipse (3.4.x)? Do you have Eclipse GEF installed (check whether the org.eclipse.gef_3.4.<strong>.jar exists in the plugins directory in your eclipse root folder)? Did you extract the Drools Eclipse plugin correctly (check whether the org.drools.eclipse_</strong>.jar exists in the plugins directory in your eclipse root folder)? If you cannot find the problem, try contacting us (e.g.
on irc or on the user mailing list), more info can be found no our homepage here:</p>
</div>
<div class="paragraph">
<p><a href="https://www.drools.org/" class="bare">https://www.drools.org/</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_drools_runtimes"><a class="anchor" href="#_drools_runtimes"></a><a class="link" href="#_drools_runtimes">Drools Runtimes</a></h6>
<div class="paragraph">
<p>A Drools runtime is a collection of JARs on your file system that represent one specific release of the Drools project JARs.
To create a runtime, you must point the IDE to the release of your choice.
If you want to create a new runtime based on the latest Drools project JARs included in the plugin itself, you can also easily do that.
You are required to specify a default Drools runtime for your Eclipse workspace, but each individual project can override the default and select the appropriate runtime for that project specifically.</p>
</div>
<div class="sect6">
<h7 id="_defining_a_drools_runtime"><a class="anchor" href="#_defining_a_drools_runtime"></a><a class="link" href="#_defining_a_drools_runtime">Defining a Drools runtime</a></h7>
<div class="paragraph">
<p>You are required to define one or more Drools runtimes using the Eclipse preferences view.
To open up your preferences, in the menu Window select the Preferences menu item.
A new preferences dialog should show all your preferences.
On the left side of this dialog, under the Drools category, select "Installed Drools runtimes". The panel on the right should then show the currently defined Drools runtimes.
If you have not yet defined any runtimes, it should like something like the figure below.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/drools-runtimes.png" alt="drools runtimes">
</div>
</div>
<div class="paragraph">
<p>To define a new Drools runtime, click on the add button.
A dialog as shown below should pop up, requiring the name for your runtime and the location on your file system where it can be found.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/drools-runtimes-add.png" alt="drools runtimes add">
</div>
</div>
<div class="paragraph">
<p>In general, you have two options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you simply want to use the default JARs as included in the Drools Eclipse plugin, you can create a new Drools runtime automatically by clicking the "Create a new Drools 5 runtime …​" button. A file browser will show up, asking you to select the folder on your file system where you want this runtime to be created. The plugin will then automatically copy all required dependencies to the specified folder. After selecting this folder, the dialog should look like the figure shown below.</p>
</li>
<li>
<p>If you want to use one specific release of the Drools project, you should create a folder on your file system that contains all the necessary Drools libraries and dependencies. Instead of creating a new Drools runtime as explained above, give your runtime a name and select the location of this folder containing all the required JARs.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/drools-runtimes-add2.png" alt="drools runtimes add2">
</div>
</div>
<div class="paragraph">
<p>After clicking the OK button, the runtime should show up in your table of installed Drools runtimes, as shown below.
Click on checkbox in front of the newly created runtime to make it the default Drools runtime.
The default Drools runtime will be used as the runtime of all your Drools project that have not selected a project-specific runtime.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/drools-runtimes2.png" alt="drools runtimes2">
</div>
</div>
<div class="paragraph">
<p>You can add as many Drools runtimes as you need.
For example, the screenshot below shows a configuration where three runtimes have been defined: a Drools 4.0.7 runtime, a Drools 5.0.0 runtime and a Drools 5.0.0.SNAPSHOT runtime.
The Drools 5.0.0 runtime is selected as the default one.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/drools-runtimes3.png" alt="drools runtimes3">
</div>
</div>
<div class="paragraph">
<p>Note that you will need to restart Eclipse if you changed the default runtime and you want to make sure that all the projects that are using the default runtime update their classpath accordingly.</p>
</div>
</div>
<div class="sect6">
<h7 id="_selecting_a_runtime_for_your_drools_project"><a class="anchor" href="#_selecting_a_runtime_for_your_drools_project"></a><a class="link" href="#_selecting_a_runtime_for_your_drools_project">Selecting a runtime for your Drools project</a></h7>
<div class="paragraph">
<p>Whenever you create a Drools project (using the New Drools Project wizard or by converting an existing Java project to a Drools project using the "Convert to Drools Project" action that is shown when you are in the Drools perspective and you right-click an existing Java project), the plugin will automatically add all the required JARs to the classpath of your project.</p>
</div>
<div class="paragraph">
<p>When creating a new Drools project, the plugin will automatically use the default Drools runtime for that project, unless you specify a project-specific one.
You can do this in the final step of the New Drools Project wizard, as shown below, by deselecting the "Use default Drools runtime" checkbox and selecting the appropriate runtime in the drop-down box.
If you click the "Configure workspace settings …​" link, the workspace preferences showing the currently installed Drools runtimes will be opened, so you can add new runtimes there.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/drools-runtimes-newproject.png" alt="drools runtimes newproject">
</div>
</div>
<div class="paragraph">
<p>You can change the runtime of a Drools project at any time by opening the project properties (right-click the project and select Properties) and selecting the Drools category, as shown below.
Check the "Enable project specific settings" checkbox and select the appropriate runtime from the drop-down box.
If you click the "Configure workspace settings …​" link, the workspace preferences showing the currently installed Drools runtimes will be opened, so you can add new runtimes there.
If you deselect the "Enable project specific settings" checkbox, it will use the default runtime as defined in your global preferences.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/drools-runtimes-project.png" alt="drools runtimes project">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_building_from_source"><a class="anchor" href="#_building_from_source"></a><a class="link" href="#_building_from_source">1.3.2. Building from source</a></h4>
<div class="sect4">
<h5 id="_getting_the_sources"><a class="anchor" href="#_getting_the_sources"></a><a class="link" href="#_getting_the_sources">1.3.2.1. Getting the sources</a></h5>
<div class="paragraph">
<p>The source code of each Maven artifact is available in the JBoss Maven repository as a source JAR.
The same source JARs are also included in the download zips.
However, if you want to build from source, it’s highly recommended to get our sources from our source control.</p>
</div>
<div class="paragraph">
<p>Drools and jBPM use <a href="http://git-scm.com/">Git</a> for source control.
The blessed git repositories are hosted on <a href="https://github.com/">GitHub</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/kiegroup" class="bare">https://github.com/kiegroup</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Git allows you to fork our code, independently make personal changes on it, yet still merge in our latest changes regularly and optionally share your changes with us.
To learn more about git, read the free book <a href="http://progit.org/book/">Git Pro</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_building_the_sources"><a class="anchor" href="#_building_the_sources"></a><a class="link" href="#_building_the_sources">1.3.2.2. Building the sources</a></h5>
<div class="paragraph">
<p>In essense, building from source is very easy, for example if you want to build the <em class="term">guvnor</em>
 project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell" data-lang="shell">$ git clone git@github.com:kiegroup/guvnor.git
...
$ cd guvnor
$ mvn clean install -DskipTests -Dfull
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, <em>there are a lot potential pitfalls</em>, so if you’re serious about building from source
and possibly contributing to the project, <strong>follow the instructions
<a href="https://github.com/kiegroup/droolsjbpm-build-bootstrap/blob/master/README.md">in the README file in droolsjbpm-build-bootstrap</a>.</strong></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eclipse"><a class="anchor" href="#_eclipse"></a><a class="link" href="#_eclipse">1.3.3. Eclipse</a></h4>
<div class="sect4">
<h5 id="_importing_eclipse_projects"><a class="anchor" href="#_importing_eclipse_projects"></a><a class="link" href="#_importing_eclipse_projects">1.3.3.1. Importing Eclipse Projects</a></h5>
<div class="paragraph">
<p>With the 
Eclipse project files generated they can now be imported into Eclipse.
When starting Eclipse open the workspace in the root of your subversion checkout.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/eclipse_import1.jpg" alt="eclipse import1">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/eclipse_import2.jpg" alt="eclipse import2">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/eclipse_import3.jpg" alt="eclipse import3">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/eclipse_import4.jpg" alt="eclipse import4">
</div>
</div>
<div class="paragraph">
<p>When calling <code>mvn install</code> all the project dependencies were downloaded and added to the local Maven repository.
Eclipse cannot find those dependencies unless you tell it where that repository is.
To do this setup an <code>M2_REPO</code> classpath variable.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/eclipse_import6.jpg" alt="eclipse import6">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/eclipse_import7.jpg" alt="eclipse import7">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/eclipse_import8.jpg" alt="eclipse import8">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/eclipse_import9.jpg" alt="eclipse import9">
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_droolsreleasenoteschapter"><a class="anchor" href="#_droolsreleasenoteschapter"></a><a class="link" href="#_droolsreleasenoteschapter">2. Release Notes</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.7.0"><a class="anchor" href="#_drools.releasenotesdrools.7.7.0"></a><a class="link" href="#_drools.releasenotesdrools.7.7.0">2.1. What is New and Noteworthy in Drools 7.7</a></h3>
<div class="sect3">
<h4 id="_executable_model"><a class="anchor" href="#_executable_model"></a><a class="link" href="#_executable_model">2.1.1. Executable Model</a></h4>
<div class="paragraph">
<p>The purpose of the executable model is to provide a pure Java-based representation of a rule set, together with a convenient
Java DSL to programmatically create such model. The model is low level and designed for the user to provide all the information
it needs, such as the lambda’s for the index evaluation. This keeps it fast and avoids building in too many assumptions at this
level. It is expected higher level representations can layer on in the future, that may be more end-user focused. This work also
highly compliments the unit work, which provides a java-oriented way to provide data and control orchestration.</p>
</div>
<div class="sect4">
<h5 id="_details"><a class="anchor" href="#_details"></a><a class="link" href="#_details">2.1.1.1. Details</a></h5>
<div class="paragraph">
<p>This model is generic enough to be independent from Drools but can be compiled into a plain Drools knowledge base. For this
reason the implementation of the executable model has been split in 2 subprojects:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>drools-canonical-model</strong> is the canonical representation of a rule set model which is totally independent from Drools</p>
</li>
<li>
<p><strong>drools-model-compiler</strong> compiles the canonical model into Drools internal data structures making it executable by the engine</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The introduction of the executable model brings a set of benefits in different areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Compile time</strong>: in Drools 6 a kjar contained the list of drl files and other Drools artifacts defining the rule base together
with some pre generated classes implementing the constraints and the consequences. Those drl files needed to be parsed and
compiled from scratch, when the kjar is downloaded from the Maven repository and installed in a KieContainer, making this
process quite slow especially for large rules sets. Conversely it is now possible to package inside the kjar the Java classes
implementing the executable model of the project rule base and recreate the KieContainer and its KieBases out of it in a much
faster way. The kie-maven-plugin automatically generates the executable model sources from the drl files during the compilation
process.</p>
</li>
<li>
<p><strong>Runtime</strong>: in the executable model all constraints are defined as Java lambda expressions. The same lambdas are also used
for constraints evaluation and this allows to get rid of both mvel for interpreted evaluation and the jitting process transforming
the mvel-based constraints in bytecode, resulting in a slow warming up process.</p>
</li>
<li>
<p><strong>Future research</strong>: the executable model will allow to experiment new features of the rule engine without the need of encoding
them in the drl format and modify the drl parser to support them.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_executable_model_dsls"><a class="anchor" href="#_executable_model_dsls"></a><a class="link" href="#_executable_model_dsls">2.1.1.2. Executable Model DSLs</a></h5>
<div class="paragraph">
<p>One goal while designing the first iteration of the DSL for the executable model was to get rid of the notion of pattern and
to consider a rule as a flow of expressions (constraints) and actions (consequences). For this reason we called it Flow DSL.
Some examples of this DSL are available here.</p>
</div>
<div class="paragraph">
<p>However after having implemented the Flow DSL it became clear that the decision of avoiding the explicit use of patterns
obliged us to implement some extra-logic that had both a complexity and a performance cost, since in order to properly
recreate the data structures expected by the Drools compiler it is necessary to put together the patterns out of those
apparently unrelated expressions.</p>
</div>
<div class="paragraph">
<p>For this reason it has been decided to reintroduce the patterns in a second DSL that we called Pattern DSL. This allowed
to bypass that algorithm grouping expressions that has to fill an artificial semantic gap and that is also time consuming
at runtime. We believe that both DSLs are valid for different use cases and then we decided to keep and support both. In
particular the Pattern DSL is safer and faster (even if more verbose) so this will be the DSL that will be automatically
generated when creating a kjar through the kie-maven-plugin. Conversely the Flow DSL is more succinct and closer to the
way how an user may want to programmatically define a rule in Java and we planned to make it even less verbose by generating
in an automatic way through a post processor the parts of the model defining the indexing and property reactivity. In other
terms we expect that the Pattern DSL will be written by machines and the Flow DSL eventually by human.</p>
</div>
</div>
<div class="sect4">
<h5 id="_programmatic_build"><a class="anchor" href="#_programmatic_build"></a><a class="link" href="#_programmatic_build">2.1.1.3. Programmatic Build</a></h5>
<div class="paragraph">
<p>As evidenced by the test cases linked in the former section it is possible to programmatically define in Java one or more
rules and then add them to a Model with a fluent API</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">Model model = <span class="hljs-keyword">new</span> ModelImpl().addRule( rule );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have this model, which as explained is totally independent from Drools algorithms and data structures, it’s possible
to create a KieBase out of it as it follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">KieBase</span> kieBase = KieBaseBuilder.createKieBaseFromModel( model );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it is also possible to create an executable model based kieproject by starting from plain drl files, adding
them to a KieFileSystem as usual</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">KieServices</span> ks = KieServices.Factory.get();
<span class="hljs-title">KieFileSystem</span> kfs = ks.newKieFileSystem()
                      .write( <span class="hljs-string">"src/main/resources/r1.drl"</span>, createDrl( <span class="hljs-string">"R1"</span> ) );
<span class="hljs-title">KieBuilder</span> kieBuilder = ks.newKieBuilder( kfs );</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then building the project using a new overload of the buildAll() method that accepts a class specifying which kind of
project you want to build</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">kieBuilder</span><span class="hljs-class">.buildAll</span>( <span class="hljs-tag">ExecutableModelProject</span><span class="hljs-class">.class</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing so the KieBuilder will generate the executable model (based on the Pattern DSL) and then the resulting KieSession</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">KieSession</span> ksession = ks.newKieContainer(ks.getRepository()
                                           .getDefaultReleaseId())
                        .newKieSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>will work with lambda expression based constraint as described in the first section of this document. In the same way it is
also possible to generate the executable model from the Flow DSL by passing a different project class to the KieBuilder</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">kieBuilder</span><span class="hljs-class">.buildAll</span>( <span class="hljs-tag">ExecutableModelFlowProject</span><span class="hljs-class">.class</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>but, for what explained when discussing the 2 different DSLs, it is better to use the pattern-based one for this purpose.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kie_maven_plugin"><a class="anchor" href="#_kie_maven_plugin"></a><a class="link" href="#_kie_maven_plugin">2.1.1.4. Kie Maven Plugin</a></h5>
<div class="paragraph">
<p>In order to generate a kjar embedding the executable model using the kie-maven-plugin it is necessary to add the dependencies
related to the two formerly mentioned projects implementing the model and its compiler in the pom.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-model-compiler<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-canonical-model<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>also add the plugin to the plugin section</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">build</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">plugins</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">plugin</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>${project.version}<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">extensions</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">extensions</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">plugin</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-title">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">build</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An example of a pom.xml file already prepared to generate the executable model is available here. By default the kie-maven-plugin
still generates a drl based kjar, so it is necessary to run the plugin with the following argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs diff"><span class="hljs-deletion">-DgenerateModel=&lt;VALUE&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where &lt;VALUE&gt; can be one of three values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs objectivec"><span class="hljs-literal">YES</span>
<span class="hljs-literal">NO</span>
WITHDRL</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both YES and WITHDRL will generate and add to the kjar use the Java classes implementing the executable model corresponding
to the drl files in the original project with difference that the first will exclude the drl files from the generated kjar,
while the second will also add them. However in this second case the drl files will play only a documentation role since the
KieBase will be built from the executable model regardless.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.7.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.7.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.7.0.final">2.2. New and Noteworthy in KIE Workbench 7.7.0</a></h3>
<div class="sect3">
<h4 id="_project_oriented_workbench"><a class="anchor" href="#_project_oriented_workbench"></a><a class="link" href="#_project_oriented_workbench">2.2.1. Project Oriented Workbench</a></h4>
<div class="paragraph">
<p>Workbench becomes Project Oriented. Meaning each project is now in a dedicated repository. Previously each project was in a folder and one repository could hold several projects. These changes merge the concepts of Project and Repository.</p>
</div>
<div class="paragraph">
<p>One project one repository approach makes the UI simpler and improves releasing or freezing a single project. Previously if a project was frozen, branched or tagged the repository was still shared with other projects, making the release control harder and more complicated.</p>
</div>
<div class="paragraph">
<p>Projects from older Workbench versions need to be migrated to the new setup. For this we offer a command line migration tool.</p>
</div>
<div class="paragraph">
<p>Project Orientated does not, at the moment, offer support for multimodule setup. This feature is planned, but not in this release. The now deprecated Asset Management features depended on multimodule support and can not be migrated to this Workbench version.</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_to_a_remote_kie_server_controller"><a class="anchor" href="#_connecting_to_a_remote_kie_server_controller"></a><a class="link" href="#_connecting_to_a_remote_kie_server_controller">2.2.2. Connecting to a remote Kie Server Controller</a></h4>
<div class="paragraph">
<p>When running a Workbench instance, there is now greater flexibility to decide how Kie Server instances will be managed.
Previously, whenever a Workbench is started, it would always start an embedded Kie Server Controller. This setup is still available
but now there is also an option to not start this service and instead connect to a remote Kie Server Controller.
This allows a more fine grained deployment model where it’s possible to decide the best approach for a specific scenario.</p>
</div>
<div class="paragraph">
<p>To switch between these modes, a key system property is used: <strong>org.kie.workbench.controller</strong>. By default, the Workbench
will continue to start the embedded service if this system property is missing. Otherwise, it will try to connect to the remote
service and also ensure that none of the embedded services are started.</p>
</div>
<div class="paragraph">
<p>It is important to note that only Web Socket connection protocol is available to use when connecting to remote Kie Server Controller.</p>
</div>
<div class="paragraph">
<p>For more details regarding all possible system configs regarding user name, password, token and secured password via key store,
please refer to <a href="#_wb.systemproperties">Workbench system properties</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_content_management_enhancements"><a class="anchor" href="#_content_management_enhancements"></a><a class="link" href="#_content_management_enhancements">2.2.3. Content management enhancements</a></h4>
<div class="sect4">
<h5 id="_properties_panel"><a class="anchor" href="#_properties_panel"></a><a class="link" href="#_properties_panel">2.2.3.1. Properties panel</a></h5>
<div class="paragraph">
<p>It is possible to edit the properties of the different page elements including, the page itself or any of its rows and components.
Once an element is selected, either by hovering on the element and clicking on the editor’s area or selecting the element in the
<em>Properties</em> panel dropdown, its properties are displayed in the left docked panel. See screenshot:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ContentManagementPropertiesPanel.png" alt="ContentManagementPropertiesPanel">
</div>
<div class="title">Figure 1. Content management properties panel</div>
</div>
<div class="paragraph">
<p>The properties available in this version are basically those related with the element style such as width, height or margins, amongst others.
The properties available might differ for each type. Notice for example, the HTML component provides an extra set of properties all related
with the text style.</p>
</div>
<div class="paragraph">
<p>Once a property is changed, its value is reflected in the editor’s area, both in <em>design</em> and <em>preview</em> modes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_screen_component_removed"><a class="anchor" href="#_screen_component_removed"></a><a class="link" href="#_screen_component_removed">2.2.3.2. Screen component removed</a></h5>
<div class="paragraph">
<p>The <em>Screen</em> component, which was placed under the <em>Core</em> group in the right sidebar’s <em>Components</em> panel, has been removed.
The reason is, this component was not suitable for production environments.</p>
</div>
<div class="paragraph">
<p>In future versions though, domain related components, such as a BPM’s task list, will be available for easy consumption by end users.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_migration_tool"><a class="anchor" href="#_new_migration_tool"></a><a class="link" href="#_new_migration_tool">2.2.4. New Migration Tool</a></h4>
<div class="paragraph">
<p>A new command line Migration tool with support for Linux and Windows has been provided to move different resources to it’s latest version.
It makes possible to perform different migrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Project Migration</strong>: migrates KIE projects from the old project layout (7.4.x and previous) to the new project-oriented structure.</p>
</li>
<li>
<p><strong>Forms Migration</strong>: migrates old jBPM Form Modeler forms into the new Forms format.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/MigrationTool.png" alt="MigrationTool">
</div>
<div class="title">Figure 2. Command Line Migration Tool</div>
</div>
<div class="paragraph">
<p>You can find more info <a href="https://github.com/kiegroup/kie-wb-common/blob/master/kie-wb-common-cli/kie-wb-common-cli-migration-tool/README.md">here</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.6.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.6.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.6.0.final">2.3. New and Noteworthy in KIE Workbench 7.6.0</a></h3>
<div class="sect3">
<h4 id="_content_management_enhancements_2"><a class="anchor" href="#_content_management_enhancements_2"></a><a class="link" href="#_content_management_enhancements_2">2.3.1. Content management enhancements</a></h4>
<div class="paragraph">
<p>A few extra changes have been introduced in the <em>Content Management</em> tooling (aka <em>Page Authoring</em>) in order to
improve the user experience. The following screenshot reveals the changes introduced since the latest version.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ContentManagementEnhancements.png" alt="ContentManagementEnhancements">
</div>
<div class="title">Figure 3. Content management new look &amp; feel</div>
</div>
<div class="sect4">
<h5 id="_fluid_page_editor_mode_selection"><a class="anchor" href="#_fluid_page_editor_mode_selection"></a><a class="link" href="#_fluid_page_editor_mode_selection">2.3.1.1. Fluid/Page editor mode selection</a></h5>
<div class="paragraph">
<p>The new page pop up allows for the selection of two edition modes:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewPagePopup.png" alt="NewPagePopup">
</div>
<div class="title">Figure 4. Content management’s new page pop up</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Fluid</strong>: it acts more as a classical web page, showing a vertical scrollbar when the page exceeds the available height.</p>
</li>
<li>
<p><strong>Page</strong>: it was the default in previous versions. When selected, it forces the page to always fit the window’s 100% height.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_preview_feature"><a class="anchor" href="#_preview_feature"></a><a class="link" href="#_preview_feature">2.3.1.2. Preview feature</a></h5>
<div class="paragraph">
<p>Page authors can go back and forth from the <em>Editor</em> to the <em>Preview</em> mode as many times as needed. In the <em>Preview</em> mode
all the editor’s controls are removed, allowing for the display of the page as it would be seen by end
users once the page is published.</p>
</div>
</div>
<div class="sect4">
<h5 id="_use_dock_panels_to_increase_the_editor_content_area"><a class="anchor" href="#_use_dock_panels_to_increase_the_editor_content_area"></a><a class="link" href="#_use_dock_panels_to_increase_the_editor_content_area">2.3.1.3. Use dock panels to increase the editor content area</a></h5>
<div class="paragraph">
<p>In order to increase the available space in the editor’s central area, the page listing, the navigation configuration and the
component palette panels have all been moved to the left sidebar as docked panels.</p>
</div>
</div>
<div class="sect4">
<h5 id="_component_palette_reorganization"><a class="anchor" href="#_component_palette_reorganization"></a><a class="link" href="#_component_palette_reorganization">2.3.1.4. Component palette reorganization</a></h5>
<div class="paragraph">
<p>In previous versions, there only existed one single category of components in the palette. As of
version 7.6, the components are now grouped into three main categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Core</em>: HTML and Page components</p>
</li>
<li>
<p><em>Navigation</em>: Menu Bar, Tree, Tiles, Tab List, Carousel and Target Div</p>
</li>
<li>
<p><em>Reporting</em>: Bar, Pie, Line, Area, Map, Bubble, Metric, Meter, Table and Filter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The goal of these changes is to make the palette more appealing as well as to ease the selection of the target component to
drag.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kieserver.releasenoteskie.7.5.1"><a class="anchor" href="#_kieserver.releasenoteskie.7.5.1"></a><a class="link" href="#_kieserver.releasenoteskie.7.5.1">2.4. New Kie Server Controller Client API</a></h3>
<div class="paragraph">
<p>In order to facilitate the management of Kie Server Controller related tasks such as creating server templates, starting and stopping containers,
etc, we developed a new Java client API available under the kie-server-controller-client Maven module.
With this API, you can connect to a Kie Server Controller using either REST or Web Socket protocols.
For more details, see <a href="#ControllerJavaAPI-section.adoc">Kie Server Controller Client API</a> chapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_breaking_changes_in_kie_server_7_5_1_from_7_0"><a class="anchor" href="#_breaking_changes_in_kie_server_7_5_1_from_7_0"></a><a class="link" href="#_breaking_changes_in_kie_server_7_5_1_from_7_0">2.5. Breaking changes in Kie Server 7.5.1 from 7.0</a></h3>
<div class="sect3">
<h4 id="_kie_server_controller_api_changes"><a class="anchor" href="#_kie_server_controller_api_changes"></a><a class="link" href="#_kie_server_controller_api_changes">2.5.1. Kie Server Controller API changes</a></h4>
<div class="paragraph">
<p>Changes to <code>SpecManagementService</code> interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Included new method <code>getContainerInfo</code> that allows to retrieve a single <code>ContainerSpec</code> defined in a <code>ServerTemplate</code>.</p>
</li>
<li>
<p>Changed methods <code>listContainerSpec</code>, <code>listServerTemplateKeys</code>, and <code>listServerTemplates</code> return types from generic
collection to specific domain list types (<code>ContainerSpecList</code>, <code>ServerTemplateKeyList</code>, and <code>ServerTemplateList</code>) in order
to properly serialize and deserialize the returned values using JAXB and JSON.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Changes to <code>RuleCapabilitiesService</code> interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>startScanner</code> method now uses a <code>java.lang.Long</code> time instead of a primitive <code>long</code> for the <code>interval</code> parameter in order
to avoid JSON and JAXB serialization issues.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Changes to <code>RuntimeManagementService</code> interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changed methods <code>getContainers</code> and <code>getServerInstances</code> return types from generic collection to specific domain list types
(<code>ContainerList</code> and <code>ServerInstanceKeyList</code>) in order to properly serialize and deserialize the returned values using JAXB and JSON.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details, see <a href="https://issues.jboss.org/browse/JBPM-6243">JBPM-6243</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kie_server_api_changes"><a class="anchor" href="#_kie_server_api_changes"></a><a class="link" href="#_kie_server_api_changes">2.5.2. Kie Server API changes</a></h4>
<div class="paragraph">
<p>Changes to <code>ServiceResponse</code> wrapper:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Moved <code>ResponseType</code> enum and common methods to a new interface called <code>KieServiceResponse</code>,
allowing it to be extended to multiple implementations.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.5.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.5.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.5.0.final">2.6. New and Noteworthy in KIE Workbench 7.5.0</a></h3>
<div class="sect3">
<h4 id="_content_management_enhancements_3"><a class="anchor" href="#_content_management_enhancements_3"></a><a class="link" href="#_content_management_enhancements_3">2.6.1. Content management enhancements</a></h4>
<div class="paragraph">
<p>Remarkable changes have been introduced in the <em>Content Management</em> (aka <em>Dashboards</em>) tooling in order to
improve the user experience.</p>
</div>
<div class="sect4">
<h5 id="_perspective_to_page_renaming"><a class="anchor" href="#_perspective_to_page_renaming"></a><a class="link" href="#_perspective_to_page_renaming">2.6.1.1. Perspective to page renaming</a></h5>
<div class="paragraph">
<p>The "page" term is far more familiar to users. Notice that, "perspective" is a concept that was borrowed from the Eclipse
development tool, thus it is a concept mostly used in developer circles. Page is more related to web content, easier to
understand by regular people. For this reason, perspective has been renamed to page all over the tooling.</p>
</div>
</div>
<div class="sect4">
<h5 id="_left_sidebar_new_look_and_feel"><a class="anchor" href="#_left_sidebar_new_look_and_feel"></a><a class="link" href="#_left_sidebar_new_look_and_feel">2.6.1.2. Left sidebar new look and feel</a></h5>
<div class="paragraph">
<p>This is the most noticeable change introduced. The left sidebar has been completely rewritten in order to provide an
enhanced look and feel.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ContentManagementLeftSideBar.png" alt="ContentManagementLeftSideBar">
</div>
<div class="title">Figure 5. Content management tooling’s left side bar</div>
</div>
<div class="paragraph">
<p>The two sections <em>Pages</em> and <em>Navigation</em> have been merged into a single view. From this view users can either create
new pages or change the navigation configuration.</p>
</div>
<div class="paragraph">
<p>The <em>Navigation</em> section lists the navigation trees. Specifically, the tree named <em>Workbench</em> is available by
default, it can not be deleted and it contains the entries displayed in the workbench’s top mega menu. Any change applied
to it will cause the mega menu to modify its entries. This is actually the mechanism users must use to extend the workbench
with new pages.</p>
</div>
</div>
<div class="sect4">
<h5 id="_tags_button_disabled"><a class="anchor" href="#_tags_button_disabled"></a><a class="link" href="#_tags_button_disabled">2.6.1.3. Tags button disabled</a></h5>
<div class="paragraph">
<p>The tags feature or the ability to attach a set of labels to a page during edition time has been removed. This
feature in combination with the former "Apps" perspective was used to allow users to publish their dynamic pages
in a categorized way. This feature is no longer needed. During the edition of a page, the <em>Tags</em> button, that used
to appear at the editor’s top right button bar, has been removed.</p>
</div>
<div class="paragraph">
<p>As a replacement, users can leverage the existing navigation features to create new pages and attach them
to the workbench’s mega menu.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_extra_navigation_components"><a class="anchor" href="#_extra_navigation_components"></a><a class="link" href="#_extra_navigation_components">2.6.2. Extra navigation components</a></h4>
<div class="paragraph">
<p>The existing navigation components available in the <em>Content Management</em> tooling have been extended with some extra types.
To date there exist the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tile navigator</p>
</li>
<li>
<p>Tab list</p>
</li>
<li>
<p>Carousel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following have recently been added to the release:</p>
</div>
<div class="sect4">
<h5 id="_menu_bar"><a class="anchor" href="#_menu_bar"></a><a class="link" href="#_menu_bar">2.6.2.1. Menu bar</a></h5>
<div class="paragraph">
<p>As its name states, this component displays the entries of a navigation tree in a manu bar shape. There is no limit to
the number of levels supported. When a page item is clicked, the page content is displayed in the <em>Target div</em>
(see details below) component specified in the menu bar’s configuration.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/MenubarComponent.png" alt="MenubarComponent">
</div>
<div class="title">Figure 6. Menu bar navigation component</div>
</div>
</div>
<div class="sect4">
<h5 id="_tree_navigator"><a class="anchor" href="#_tree_navigator"></a><a class="link" href="#_tree_navigator">2.6.2.2. Tree navigator</a></h5>
<div class="paragraph">
<p>Same as the <em>Menu bar</em>, but the entries are displayed as a vertical tree structure.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/TreeNavigatorComponent.png" alt="TreeNavigatorComponent">
</div>
<div class="title">Figure 7. Menu bar navigation component</div>
</div>
</div>
<div class="sect4">
<h5 id="_target_div"><a class="anchor" href="#_target_div"></a><a class="link" href="#_target_div">2.6.2.3. Target div</a></h5>
<div class="paragraph">
<p>Both the <em>Carousel</em> and the <em>Tile navigator</em> components can handle by themselves the display of the items the user clicks on.
Others like <em>Tab list</em>, <em>Menu bar</em> and <em>Tree navigator</em> require a <em>Target div</em> component as its display output since they
have a clear separation between the display of its entries and the content of the last item clicked.</p>
</div>
<div class="paragraph">
<p>So, every time, a <em>Target div</em> based navigation component is dropped into a page, a <em>Target div</em> component must
have been dropped as well, so that the first one can link to it. The following screen shows the configuration panel that
 is displayed every time a target div based component is dropped into a page.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NavComponentTargetDivModal.png" alt="NavComponentTargetDivModal">
</div>
<div class="title">Figure 8. Target div based navigation components configuration</div>
</div>
<div class="paragraph">
<p>The navigation group is mandatory for all the navigation components as it indicates the navigation structure to display
whereas the <em>Target div</em> setting is <strong>not</strong> available for non target div components like <em>Carousel</em> or <em>Tile navigator</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.4.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.4.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.4.0.final">2.7. New and Noteworthy in KIE Workbench 7.4.0</a></h3>
<div class="sect3">
<h4 id="_guided_decision_table_improvements"><a class="anchor" href="#_guided_decision_table_improvements"></a><a class="link" href="#_guided_decision_table_improvements">2.7.1. Guided Decision Table improvements</a></h4>
<div class="paragraph">
<p>In addition to fixing numerous bugs the Wizard used to create and edit columns has been improved to show descriptions of the different steps required for the different column types.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-wizard-help-text1.png" alt="dtable wizard help text1">
</div>
<div class="title">Figure 9. Guided Decision Table Wizard example 1</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-wizard-help-text2.png" alt="dtable wizard help text2">
</div>
<div class="title">Figure 10. Guided Decision Table Wizard example 2</div>
</div>
</div>
<div class="sect3">
<h4 id="_disable_experimental_editors"><a class="anchor" href="#_disable_experimental_editors"></a><a class="link" href="#_disable_experimental_editors">2.7.2. Disable experimental editors</a></h4>
<div class="paragraph">
<p>The following features are considered experimental and can be disabled using the Security/User Management administration screen:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Guided Decision Tree Editor</p>
</li>
<li>
<p>Guided Score Card Editor</p>
</li>
<li>
<p>XLS Score Card Editor</p>
</li>
<li>
<p>(New) BPMN2 Process Editor</p>
</li>
<li>
<p>Deployments/Server Provisioning Perspective</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These features are enabled by default.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/disable-experimental-features1.png" alt="disable experimental features1">
</div>
<div class="title">Figure 11. Disabling an Editor</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.3.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.3.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.3.0.final">2.8. New and Noteworthy in KIE Workbench 7.3.0</a></h3>
<div class="sect3">
<h4 id="_new_home_and_menu_bar"><a class="anchor" href="#_new_home_and_menu_bar"></a><a class="link" href="#_new_home_and_menu_bar">2.8.1. New Home and Menu Bar</a></h4>
<div class="paragraph">
<p>The Home page, Menu bar and About popup now have a new design. Menu items are split into groups representing major functional areas.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/home-with-menu-expanded.png" alt="home with menu expanded">
</div>
<div class="title">Figure 12. Home view with Menu expanded</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/about-popup.png" alt="about popup">
</div>
<div class="title">Figure 13. About popup</div>
</div>
</div>
<div class="sect3">
<h4 id="_admin_page_changes"><a class="anchor" href="#_admin_page_changes"></a><a class="link" href="#_admin_page_changes">2.8.2. Admin page changes</a></h4>
<div class="paragraph">
<p>The Admin page is now accessible with the cog icon on the Menu bar and has more items. Access to the perspective artifacts, Data Sets, Data Sources and Language options have been moved there.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/admin-page-7-3-x.png" alt="admin page 7 3 x">
</div>
<div class="title">Figure 14. Admin page</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.1.0"><a class="anchor" href="#_drools.releasenotesdrools.7.1.0"></a><a class="link" href="#_drools.releasenotesdrools.7.1.0">2.9. What is New and Noteworthy in Drools 7.1</a></h3>

</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.1.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.1.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.1.0.final">2.10. New and Noteworthy in KIE Workbench 7.1.0</a></h3>
<div class="sect3">
<h4 id="_project_metrics_dashboard"><a class="anchor" href="#_project_metrics_dashboard"></a><a class="link" href="#_project_metrics_dashboard">2.10.1. Project Metrics Dashboard</a></h4>
<div class="paragraph">
<p>A brand new dashboard is now available for every project listed in the authoring library. After opening the project details page, a metrics card shows up on the right side of the screen.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/project-metrics-card.png" alt="project metrics card">
</div>
<div class="title">Figure 15. Project Metrics Card</div>
</div>
<div class="paragraph">
<p>The card shows the history of contributions (commits) made to that specific project over time.
Click the <em>View All</em> link to access the full dashboard that shows several metrics all about the project’s contributions.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/project-metrics-dashboard.png" alt="project metrics dashboard">
</div>
<div class="title">Figure 16. Project Metrics Dashboard</div>
</div>
<div class="paragraph">
<p>Notice that different filter controls are available for selecting the contributions made either by a concrete user or in a specific time frame.</p>
</div>
</div>
<div class="sect3">
<h4 id="_teams_metrics_dashboard"><a class="anchor" href="#_teams_metrics_dashboard"></a><a class="link" href="#_teams_metrics_dashboard">2.10.2. Teams Metrics Dashboard</a></h4>
<div class="paragraph">
<p>A brand new dashboard has also been added to the Teams page. A metrics card on the right side shows the history of all contributions (commits).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/teams-metrics-card.png" alt="teams metrics card">
</div>
<div class="title">Figure 17. Teams Metrics Card</div>
</div>
<div class="paragraph">
<p>Click the <em>View All</em> link to access the full dashboard showing overall contributions metrics.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/teams-metrics-dashboard.png" alt="teams metrics dashboard">
</div>
<div class="title">Figure 18. Teams Metrics Dashboard</div>
</div>
<div class="paragraph">
<p>Note that different filter controls are available for selecting the contributions by different criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>by a concrete user,</p>
</li>
<li>
<p>within a specific time frame,</p>
</li>
<li>
<p>by team or,</p>
</li>
<li>
<p>by project.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This dashboard replaces the former <em>Authoring&gt;Contributors</em> dashboard, which is no longer available at the top menu bar of the workbench.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.7.0.0"><a class="anchor" href="#_drools.releasenotesdrools.7.0.0"></a><a class="link" href="#_drools.releasenotesdrools.7.0.0">2.11. What is New and Noteworthy in Drools 7.0</a></h3>
<div class="sect3">
<h4 id="_core_engine"><a class="anchor" href="#_core_engine"></a><a class="link" href="#_core_engine">2.11.1. Core Engine</a></h4>
<div class="sect4">
<h5 id="_dmn_runtime_support"><a class="anchor" href="#_dmn_runtime_support"></a><a class="link" href="#_dmn_runtime_support">2.11.1.1. DMN Runtime Support</a></h5>
<div class="paragraph">
<p>Drools now has complete runtime support for DMN (Decision Model and Notation). DMN files are now an asset
that can be added to any kjar for execution. Please refer to the <a href="#drools.DMN">DMN section</a>
for details on how to build and execute DMN models.</p>
</div>
<div class="paragraph">
<p>At this time, no DMN authoring is supported, but it will be supported in future versions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_multithreaded_rule_engine"><a class="anchor" href="#_multithreaded_rule_engine"></a><a class="link" href="#_multithreaded_rule_engine">2.11.1.2. Multithreaded rule engine</a></h5>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Historically Rete has always been a sequential algorithm and even if Phreak, its evolution introduced in Drools 6, allowed
some degree of parallelization, this possibility wasn’t concretely leveraged yet. In Drools 7 is finally possible to make
the engine to evaluate more rules in parallel. This is achieved by partitioning the Rete/Phreak in independent partitions
and evaluating them in parallel.</p>
</div>
<div class="paragraph">
<p>This feature is off by default, but it’s possible to create a parallel KieBase by enabling it via the <code>KieBaseConfiguration</code> as it follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">KieServices ks = KieServices.Factory.<span class="hljs-keyword">get</span>();
KieBaseConfiguration kieBaseConf = ks.newKieBaseConfiguration();
kieBaseConf.setOption(MultithreadEvaluationOption.YES);
KieBase kieBase = kieContainer.newKieBase(kieBaseConf);</code></pre>
</div>
</div>
<div class="paragraph">
<p>or alternatively through the system property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">drools.multithreadEvaluation = <span class="hljs-literal">true</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rules using queries, salience or agenda-group are currently not supported by the parallel engine. In case they are present inside
the rule base the compiler emits a warning and automatically switches back using the single threaded implementation. There are
other cases where using the multithreaded rule engine is not correct and leads to wrong results even if the engine may be not
able to automatically detect them and then will not fallback to the single thread mode, e.g. rules rely on implicit salience
given by rule ordering inside the drl file. For this reason particular attention must be paid when enabling this option.
Finally at the moment session serialization and incremental compilation are not supported.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_oopath_improvements"><a class="anchor" href="#_oopath_improvements"></a><a class="link" href="#_oopath_improvements">2.11.1.3. OOPath improvements</a></h5>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>OOPath has been introduced with Drools 6.3.0 but in Drools 7.0.0 the syntax has been slightly changed to make it closer to standard
xpath one. This means that constraints have to be put between square brackets instead of curly ones and inline cast has to be
expressed out of constraints. For instance the following oopath expressed with 6.x syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/list{#SubClass, prop == <span class="hljs-number">0</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>in Drools 7.x becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">/list#SubClass[prop == <span class="hljs-number">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also Drools 7.0.0 improves the support for standard Java Collection, with a dedicated implementation for <code>List</code> and <code>Set</code>,
as specialized <code>ReactiveList</code> and <code>ReactiveSet</code>; a <code>ReactiveCollection</code> is also available.
This also includes out of the box reactive support when performing mutable operations through their <code>Iterator</code> and <code>ListIterator</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">School</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractReactiveObject</span> </span>{
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Child&gt; children = <span class="hljs-keyword">new</span> ReactiveList&lt;Child&gt;(); <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
        notifyModification(); <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addChild</span><span class="hljs-params">(Child child)</span> </span>{
        children.add(child); <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
        <span class="hljs-comment">// no need to call notifyModification() here.</span>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using specialized <code>ReactiveList</code> for reactive support over standard Java <code>List</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Usually <code>notifyModification()</code> is required to be called when a field is changed for reactive support</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but in the case of <code>ReactiveList</code> this is handled automatically, like every other mutating operations performed over the field <code>children</code>.</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As a best-practice, it is recommended to declare reactive collection fields <code>final</code> as per the example shown.
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="_oopath_maven_plug_in"><a class="anchor" href="#_oopath_maven_plug_in"></a><a class="link" href="#_oopath_maven_plug_in">OOPath Maven plug-in</a></h6>
<div class="paragraph">
<p>The Kie Maven plug-in offers a new goal <code>injectreactive</code> to instrument bytecode and automatically inject reactivity support for standard cases.</p>
</div>
<div class="paragraph">
<p>The <code>injectreactive</code> goal is disabled by default, and can be enabled via Maven plug-in configuration <code>instrument-enabled</code> settings.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">extensions</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">extensions</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">instrument-enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">instrument-enabled</span>&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enable the <code>injectreactive</code> goal.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>injectreactive</code> goal will instrument bytecode pertaining to the Maven project build’s output directory <code>${project.build.outputDirectory}</code>.</p>
</div>
<div class="paragraph">
<p>It is possible to limit the scope of the goal to a specific package or hierarchy of packages via Maven plug-in
configuration <code>instrument-packages</code> settings list.
.Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">extensions</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">extensions</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">instrument-enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">instrument-enabled</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">instrument-packages</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">instrumentPackage</span>&gt;</span>to.instrument<span class="hljs-tag">&lt;/<span class="hljs-title">instrumentPackage</span>&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="hljs-tag">&lt;<span class="hljs-title">instrumentPackage</span>&gt;</span>org.drools.compiler.xpath.tobeinstrumented.*<span class="hljs-tag">&lt;/<span class="hljs-title">instrumentPackage</span>&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="hljs-tag">&lt;/<span class="hljs-title">instrument-packages</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Limit scope of instrumentation specifically to <code>to.instrument</code> package only.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Limit scope of instrumentation to <code>org.drools.compiler.xpath.tobeinstrumented</code> and its children packages.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The plug-in will instrument bytecode for every field assignment under the following standard cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a field assignment will also trigger <code>notifyModification()</code></p>
</li>
<li>
<p>wrap any field defined as List with a <code>ReactiveList</code></p>
</li>
<li>
<p>wrap any field defined as Set with a <code>ReactiveSet</code></p>
</li>
<li>
<p>wrap any field defined as Collection with a <code>ReactiveCollection</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order for a field of type List/Set to be wrapped correctly, the field member of the java class must be declared specifically using either
<code>java.util.Collection</code>, <code>java.util.List</code> or <code>java.util.Set</code>
(declaring for instance a field as <code>java.util.ArrayList</code> will not be instrumented with the specialized reactive collections).
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is not recommended to mix manual support for reactivity (implemented manually) and the bytecode instrumentation Maven plug-in; it is better envisaged to keep the two scopes distinct, for instance by making use of the plug-in configuration to instrument only specific packages as documented above.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following section present detailed examples of the plug-in instrumentation.</p>
</div>
<div class="sect6">
<h7 id="_instrumentation_of_field_assignments"><a class="anchor" href="#_instrumentation_of_field_assignments"></a><a class="link" href="#_instrumentation_of_field_assignments">Instrumentation of field assignments</a></h7>
<div class="paragraph">
<p>A field assignment like in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Original:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Toy</span> </span>{
    <span class="hljs-keyword">private</span> String owner;
    ...

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setOwner</span><span class="hljs-params">(String owner)</span> </span>{
        <span class="hljs-keyword">this</span>.owner = owner;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be instrumented by intercepting the field assignment and triggering the <code>notifyModification()</code>:</p>
</div>
<div class="listingblock">
<div class="title">Result:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Toy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ReactiveObject</span> </span>{
    <span class="hljs-keyword">private</span> String owner;
    ...

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setOwner</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String owner)</span> </span>{
        <span class="hljs-keyword">this</span>.$$_drools_write_owner(owner);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> $$_drools_write_owner(<span class="hljs-keyword">final</span> String owner) {
        <span class="hljs-keyword">this</span>.owner = owner;
        ReactiveObjectUtil.notifyModification((ReactiveObject) <span class="hljs-keyword">this</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please notice this instrumentation applies only if the field is not a <code>Collection</code>.</p>
</div>
<div class="paragraph">
<p>In the case the field assignment is referring a <code>List</code> or a <code>Set</code>, the instrumentation will wrap the assignment with a <code>ReactiveList</code> or <code>`ReactiveSet</code> accordingly; for example:</p>
</div>
<div class="listingblock">
<div class="title">Original:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">School</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Child&gt; children = <span class="hljs-keyword">new</span> ArrayList&lt;Child&gt;();
    ...

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">School</span><span class="hljs-params">(String name)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Child&gt; <span class="hljs-title">getChildren</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> children;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be instrumented by intercepting and wrapping with <code>ReactiveList</code>:</p>
</div>
<div class="listingblock">
<div class="title">Result:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">School</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ReactiveObject</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Child&gt; children;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">School</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String name)</span> </span>{
        <span class="hljs-keyword">this</span>.$$_drools_write_children(<span class="hljs-keyword">new</span> ArrayList());
        <span class="hljs-keyword">this</span>.name = name;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Child&gt; <span class="hljs-title">getChildren</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.children;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> $$_drools_write_children(<span class="hljs-keyword">final</span> List list) {
        <span class="hljs-keyword">this</span>.children = (List&lt;Child&gt;) <span class="hljs-keyword">new</span> ReactiveList(list);
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pmml_support"><a class="anchor" href="#_pmml_support"></a><a class="link" href="#_pmml_support">2.11.1.4. PMML Support</a></h5>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature makes use of <a href="#_rule_units_2">Rule Units</a>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Drools now support assets that conform to a subset of the Predictive Modeling Markup Language (PMML). The following
predictive model types are now supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Regression</p>
</li>
<li>
<p>Scorecard</p>
</li>
<li>
<p>Tree</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, the Mining model type has partial support; with the following modes currently available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Model Chain</p>
</li>
<li>
<p>Select All</p>
</li>
<li>
<p>Select First</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further modes of operation will be supported as they become available.</p>
</div>
</div>
<div class="sect4">
<h5 id="_soft_expiration_for_events"><a class="anchor" href="#_soft_expiration_for_events"></a><a class="link" href="#_soft_expiration_for_events">2.11.1.5. Soft expiration for events</a></h5>
<div class="paragraph">
<p>When explicitly defining an event expiration in Drools 6.x, it is always considered an hard expiration, meaning that it always
takes precedence on any other expiration implicitly calculated on temporal windows and constraints where the event is involved.
Drools 7 also allows to specify a soft expiration for events that can be used if the inferred expiration offset is infinite.
In this way it is possible to have a guaranteed expiration that is either the inferred one or the specified one if the other
is missing. Moreover this implies that rule authors are not required to include a temporal constraint in all rules and then
event classes can be designed even if the rules are not yet known.</p>
</div>
<div class="paragraph">
<p>By default event expiration is considered to be hard, but it is possible to change the expiration policy and define a soft
expiration either annotating the event’s class as it follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Role</span>(Role.Type.EVENT)
<span class="hljs-annotation">@Expires</span>( value = <span class="hljs-string">"30s"</span>, policy = TIME_SOFT )
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyEvent</span> </span>{ ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>or using a type declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> MyEvent
  @<span class="hljs-keyword">role</span>( <span class="hljs-keyword">event</span> )
  @expires(<span class="hljs-keyword">value</span> = <span class="hljs-number">30</span>s, <span class="hljs-keyword">policy</span> = TIME_SOFT)
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_units"><a class="anchor" href="#_rule_units"></a><a class="link" href="#_rule_units">2.11.1.6. Rule Units</a></h5>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Rule units represent a purely declarative approach to partition a rules set into smaller units, binding different data sources
to those units and orchestrate the execution of the individual unit. A rule unit is an aggregate of data sources, global variables
and rules.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_workbench"><a class="anchor" href="#_workbench"></a><a class="link" href="#_workbench">2.11.2. Workbench</a></h4>
<div class="paragraph">
<p>Apart from the generic improvements to the workbench (listed below in a separate section), there are also some Drools-specific enhancements in the workbench.</p>
</div>
<div class="sect4">
<h5 id="_dmn_style_hit_policies_for_decision_tables"><a class="anchor" href="#_dmn_style_hit_policies_for_decision_tables"></a><a class="link" href="#_dmn_style_hit_policies_for_decision_tables">2.11.2.1. DMN style hit policies for Decision Tables</a></h5>
<div class="paragraph">
<p>With each Hit Policy, by default a row has priority over each row below it.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unique Hit
With unique hit policy each row has to be unique meaning there can be no overlap. There can never be a situation where two rows can fire, if there is the Verification feature warns about this on development time.</p>
</li>
<li>
<p>First Hit
First hit fires only one row, the one that is satisfied first from top to bottom.</p>
</li>
<li>
<p>Resolved Hit
Similar to First Hit, but you can for example give row 10 priority over row 5. This means you can keep the order of the rows you want for visual readability, but specify priority exceptions.</p>
</li>
<li>
<p>Rule Order
Multiple rows can fire and Verification does not report about conflicts between the rows since they are expected to happen.</p>
</li>
<li>
<p>None
This is the normal hit mode. Old decision tables will use this by default, but since 7.0 uses PHREAK the row order now matters. There is no migration tooling needed for the old tables. Multiple rows can fire. Verification warns about rows that conflict.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_guided_rule_editor_support_formulae_in_composite_field_constraints"><a class="anchor" href="#_guided_rule_editor_support_formulae_in_composite_field_constraints"></a><a class="link" href="#_guided_rule_editor_support_formulae_in_composite_field_constraints">2.11.2.2. Guided Rule Editor : Support formulae in composite field constraints</a></h5>
<div class="paragraph">
<p>Composite field constraints now support use of formulae.</p>
</div>
<div class="paragraph">
<p>When adding constraints to a Pattern the "Multiple Field Constraint" selection ("All of (and)" and "Any of (or)") supports use of formulae in addition to expressions.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/composite-field-constraint-formulae1.png" alt="composite field constraint formulae1">
</div>
<div class="title">Figure 19. Composite field constraint - Select formula</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/composite-field-constraint-formulae2.png" alt="composite field constraint formulae2">
</div>
<div class="title">Figure 20. Composite field constraint - Formula editor</div>
</div>
</div>
<div class="sect4">
<h5 id="_guided_decision_table_editor_new_editor"><a class="anchor" href="#_guided_decision_table_editor_new_editor"></a><a class="link" href="#_guided_decision_table_editor_new_editor">2.11.2.3. Guided Decision Table Editor : New editor</a></h5>
<div class="paragraph">
<p>The Guided Decision Table Editor has been extensively rewritten to support editing of multiple tables in the same editor. Tables that share an association are visibly linked making it easier to visualise relationships. Associations are infered from Actions that create or update a Fact consumed by the Conditions of another table.</p>
</div>
<div class="paragraph">
<p>Highlights include:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A new look and feel</p>
</li>
<li>
<p>Resizable columns</p>
</li>
<li>
<p>Reordering of columns by dragging and dropping "in table"</p>
</li>
<li>
<p>Reordering of rows by dragging and dropping "in table"</p>
</li>
<li>
<p>Repositioning of tables with drag and drop</p>
</li>
<li>
<p>Panning of view to scroll content</p>
</li>
<li>
<p>Zoomable view, so you can zoom "out" to see more content at once</p>
</li>
<li>
<p>File locks and Version History per Decision Table</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/dtables-new-editor.png" alt="dtables new editor">
</div>
<div class="title">Figure 21. New editor</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/dtables-new-editor-multiple.png" alt="dtables new editor multiple">
</div>
<div class="title">Figure 22. New editor - multiple open tables</div>
</div>
</div>
<div class="sect4">
<h5 id="_guided_decision_table_editor_caching_of_enumeration_lookups"><a class="anchor" href="#_guided_decision_table_editor_caching_of_enumeration_lookups"></a><a class="link" href="#_guided_decision_table_editor_caching_of_enumeration_lookups">2.11.2.4. Guided Decision Table Editor : Caching of enumeration lookups</a></h5>
<div class="paragraph">
<p>The Guided Decision Table Editor has long been capable of using enumeration definitions. However since a table can contain many cells performance of enumerations could sometimes be less than ideal if the definition required a server round-trip to retrieve the lookups from a helper class.</p>
</div>
<div class="paragraph">
<p>Results from server round-trips are now cached in the client hence removing the need for successive network calls when cells are modified. The cache is initialised when the editor is opened and populated on demand.</p>
</div>
</div>
<div class="sect4">
<h5 id="_guided_decision_table_editor_verification_and_validation"><a class="anchor" href="#_guided_decision_table_editor_verification_and_validation"></a><a class="link" href="#_guided_decision_table_editor_verification_and_validation">2.11.2.5. Guided Decision Table Editor : Verification and Validation</a></h5>
<div class="sect5">
<h6 id="_system_property"><a class="anchor" href="#_system_property"></a><a class="link" href="#_system_property">System Property</a></h6>
<div class="paragraph">
<p>It is possible to disable the Verification &amp; Validation with the system property <strong><code></code></strong><code>org.kie.verification.disable-dtable-realtime-verification<strong></strong></code>. This can be useful for large decision tables or if the users want to ignore V&amp;V.</p>
</div>
</div>
<div class="sect5">
<h6 id="_range_checks"><a class="anchor" href="#_range_checks"></a><a class="link" href="#_range_checks">Range Checks</a></h6>
<div class="paragraph">
<p>The verification takes the first steps towards helping you to make complete decision tables. In the next release we add the support for checking if all the ranges are covered for boolean, numeric and date values. This means if your table has a check for if an Application is approved the verification report will remind you to make sure you also handle situations where the Application was not approved.</p>
</div>
</div>
<div class="sect5">
<h6 id="_unique_single_hit"><a class="anchor" href="#_unique_single_hit"></a><a class="link" href="#_unique_single_hit">Unique Single Hit</a></h6>
<div class="paragraph">
<p>In the past verification and validation has raised an issue if rows subsume each other. If a row subsumes another, then the conditions can be satisfied with the same set of facts. Meaning two rows from the same table can fire at the same time. In some cases subsumption does not matter, but in other cases you want to have a table where only one rule fires at the time. The table is then a single hit decision table. To help the making of single hit tables where only one row can fire, the verification keeps an eye on the conditions. Reporting situations when single hit is broken.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_breaking_changes_in_drools_7_0_from_6_x"><a class="anchor" href="#_breaking_changes_in_drools_7_0_from_6_x"></a><a class="link" href="#_breaking_changes_in_drools_7_0_from_6_x">2.12. Breaking changes in Drools 7.0 from 6.x</a></h3>
<div class="sect3">
<h4 id="_property_reactivity_enabled_by_default"><a class="anchor" href="#_property_reactivity_enabled_by_default"></a><a class="link" href="#_property_reactivity_enabled_by_default">2.12.1. Property reactivity enabled by default</a></h4>
<div class="paragraph">
<p>Property reactivity has been introduced in Drools 5.4 but users had to explicitly enable it on a class by class basis through
the <code>@PropertyReactive</code> annotation or on the whole knowledge base using the <code>PropertySpecificOption.ALWAYS</code> builder option.
However, since using this feature is considered a good practice both under correctness and performance points of view, it has
been enabled by default in Drools 7.0. If required it is possible to disable property reactivity and reconfigure Drools 7.0
to work exactly as it did in version 6.x by adding the following configuration to the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"drools.propertySpecific"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"ALLOWED"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_type_preserving_accumulate_functions"><a class="anchor" href="#_type_preserving_accumulate_functions"></a><a class="link" href="#_type_preserving_accumulate_functions">2.12.2. Type preserving accumulate functions</a></h4>
<div class="paragraph">
<p>In Drools 6 when using the <code>sum</code> function inside an accumulate pattern the result was always a Double regardless of the
field type on which the sum was performed. This caused the following 3 problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Loss of precision: the sum of a long <code>1881617265586265321L</code> will incorrectly return <code>1.88161726558626534E18</code>.
The BigDecimal sum of <code>0.09</code> and <code>0.01</code> will also be incorrect.</p>
</li>
<li>
<p>Loss of performance: summing with a Double total is significantly slower than summing with a Long or an Integer.</p>
</li>
<li>
<p>Leaked complexity: it enforced the user to pattern matching on Double, or more generically (suggested choice) on Number,
while it may be expected that the result of summing on a field of type Integer would be an Integer as well.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Conversely Drools 7 preserves the type of the expression on which the sum is executed, so it will be possible to directly
match on that type as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Long(...) from accumulate(..., sum(<span class="hljs-variable">$p</span>.getLongWeight()))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_renaming_timedruleexecutionoption"><a class="anchor" href="#_renaming_timedruleexecutionoption"></a><a class="link" href="#_renaming_timedruleexecutionoption">2.12.3. Renaming TimedRuleExecutionOption</a></h4>
<div class="paragraph">
<p>The KieSession option to control when timed rules have to be automatically executed has been renamed into <code>TimedRuleExecutionOption</code> fixing a typing mistake in its name which affected previous releases; the property has been aligned into <code>drools.timedRuleExecution</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Name changes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">previous releases</th>
<th class="tableblock halign-left valign-top">version <code>7.0.0.Final</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieSession option</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TimedRuleExectionOption</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TimedRuleExecutionOption</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>drools.timedRuleExection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>drools.timedRuleExecution</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_renaming_and_unification_of_configuration_files"><a class="anchor" href="#_renaming_and_unification_of_configuration_files"></a><a class="link" href="#_renaming_and_unification_of_configuration_files">2.12.4. Renaming and unification of configuration files</a></h4>
<div class="paragraph">
<p>In Drools 6.x, the default Drools configuration properties were configured in two distinct files:
*  <code>drools.default.rulebase.conf</code> located in the META-INF folder of drools-core
*  <code>drools.default.packagebuilder.conf</code> located in the META-INF folder of of drools-compiler</p>
</div>
<div class="paragraph">
<p>In Drools 7.0.0, these files are unified into a single one named <code>kie.default.properties.conf</code>, located in the META-INF folder of drools-core.
If you want to override the default values of these properties or add your own, you can put them in a file called <code>kie.properties.conf</code> located in the META-INF folder of your project.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.7.0.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.7.0.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.7.0.0.final">2.13. New and Noteworthy in KIE Workbench 7.0.0</a></h3>
<div class="paragraph">
<p>The workbench has been updated to support Wildfly 10 and EAP7.  Minimum Java requirement is JDK8.</p>
</div>
<div class="sect3">
<h4 id="_new_authoring_library"><a class="anchor" href="#_new_authoring_library"></a><a class="link" href="#_new_authoring_library">2.13.1. New Authoring (Library)</a></h4>
<div class="paragraph">
<p>Authoring now has a new design, with a better information organization. It’s now possible to manage (create, delete and edit) Teams (Organizational Units), list Projects in a Repository and the Assets in a Project. When an Asset is selected, you can see the Asset Editor and the Project Explorer.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Library uses the indexing of the Workbench. It is, therefore, <strong>imperative</strong> that existing index information is deleted so that the Workbench can rebuild them with the necessary information. Index information is stored in the <code>.index</code> folder within your application servers <code>\bin</code> folder (or as you may have configured otherwise with the <code>org.uberfire.metadata.index.dir</code> System Property).</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/library-teams-view.png" alt="library teams view">
</div>
<div class="title">Figure 23. Teams view</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/library-team-creation.png" alt="library team creation">
</div>
<div class="title">Figure 24. Teams creation</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/library-empty-library.png" alt="library empty library">
</div>
<div class="title">Figure 25. Empty Repository</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/library-projects-list.png" alt="library projects list">
</div>
<div class="title">Figure 26. Repository with Projects</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/library-empty-project.png" alt="library empty project">
</div>
<div class="title">Figure 27. Empty Project</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/library-assets-list.png" alt="library assets list">
</div>
<div class="title">Figure 28. Project with Assets</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/library-asset-view.png" alt="library asset view">
</div>
<div class="title">Figure 29. Asset View</div>
</div>
<div class="paragraph">
<p>Also, you can set some preferences about your default workspace by accessing Home &gt; Admin &gt; Library.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/library-preferences.png" alt="library preferences">
</div>
<div class="title">Figure 30. Library Preferences</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_imports_of_examples"><a class="anchor" href="#_authoring_imports_of_examples"></a><a class="link" href="#_authoring_imports_of_examples">2.13.2. Authoring - Imports of Examples</a></h4>
<div class="paragraph">
<p>Prior to 7.x the Workbench used to install pre-defined examples at startup.</p>
</div>
<div class="paragraph">
<p>Version 7.x brings the ability to import examples from git repositories.
The Authoring Perspective contains a menu item for 'Examples' clicking this launches a Wizard to guide you through the import.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Menu item</div>
<div class="content">
<div class="paragraph">
<p>The Authoring Perspective contains a menu item for 'Examples'.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/examples-wizard1.png" alt="examples wizard1">
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 2. Wizard - Enter source Repository</div>
<div class="content">
<div class="paragraph">
<p>Page 1 of the Wizard allows the User to select a pre-defined examples repository, or enter their own URL.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/examples-wizard2.png" alt="examples wizard2">
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 3. Wizard - Select Project(s)</div>
<div class="content">
<div class="paragraph">
<p>Page 2 of the Wizard lists Projects available in the source repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/examples-wizard3.png" alt="examples wizard3">
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 4. Wizard - Enter target Repository</div>
<div class="content">
<div class="paragraph">
<p>Page 3 of the Wizard allows the User to enter a target Repository name and associate it with an Organizational Unit.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/examples-wizard4.png" alt="examples wizard4">
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_pop_ups_improvements"><a class="anchor" href="#_authoring_pop_ups_improvements"></a><a class="link" href="#_authoring_pop_ups_improvements">2.13.3. Authoring - Pop-ups improvements</a></h4>
<div class="paragraph">
<p>All system pop-ups had their UX improved.</p>
</div>
<div class="paragraph">
<p>The "comment" field is hidden by default.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/popups-comment-field.png" alt="popups comment field">
</div>
</div>
<div class="paragraph">
<p>Now, the destination package can be selected when a project file is copied from any package.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/popups-package-field.png" alt="popups package field">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_project_editor_reimport_button"><a class="anchor" href="#_authoring_project_editor_reimport_button"></a><a class="link" href="#_authoring_project_editor_reimport_button">2.13.4. Authoring - Project Editor - Reimport button</a></h4>
<div class="paragraph">
<p>The "Reimport" button invalidates all cached dependencies, in order to handle scenarios where a specific dependency was updated without having its version modified.</p>
</div>
</div>
<div class="sect3">
<h4 id="_security_management"><a class="anchor" href="#_security_management"></a><a class="link" href="#_security_management">2.13.5. Security Management</a></h4>
<div class="paragraph">
<p>The User and Group management perspectives released in version 6.4 have been unified into a single perspective which delivers a shared view for managing both users and groups as well as the permissions granted to any of the application roles.</p>
</div>
<div class="paragraph">
<p>This very new perspective is placed under the <em>Home</em> section in the top menu bar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementMenuEntry.png" alt="SecurityManagementMenuEntry">
</div>
<div class="title">Figure 31. Link to the Security Management perspective</div>
</div>
<div class="paragraph">
<p>The next screenshot shows how this new perspective looks:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementHome.png" alt="SecurityManagementHome">
</div>
<div class="title">Figure 32. Security Management Home</div>
</div>
<div class="paragraph">
<p>A tabbed pane is shown on the left, allowing the User to select the <em>Roles</em>, <em>Groups</em> or <em>Users</em> tab. After clicking on a Role (or Group)
a detailed screen is displayed allowing the user to configure some security settings.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementRoleView.png" alt="SecurityManagementRoleView">
</div>
<div class="title">Figure 33. Role security settings</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Home Perspective</strong>: The target perspective where the user is directed after login, which makes it possible to have different home pages per role/group.</p>
</li>
<li>
<p><strong>Priority</strong>: Used to determine what settings (home perspective, permissions, …​) have precedence for those users with more than one role or group assigned.</p>
</li>
<li>
<p><strong>Permissions</strong>: A full ACL (<em>Access Control List</em>) editor for grant/deny permissions over the different resources available in the platform like <em>Perspectives</em>,
<em>Organizational Units</em>, <em>Repositories</em> or <em>Projects</em>. Global permissions on top of any of those resource types can be ovewritten by means of adding individual exceptions
which makes it possible to implement both the <em>grant all deny a few</em> or the <em>deny all grant a few</em> strategies.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_kie_config_cli_has_been_removed"><a class="anchor" href="#_kie_config_cli_has_been_removed"></a><a class="link" href="#_kie_config_cli_has_been_removed">2.13.6. kie-config-cli has been removed</a></h4>
<div class="paragraph">
<p>The command-line tool <code>kie-config-cli.[sh/bat]</code> for managing remote repositories that was present in 6.x has been removed for the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The security-related operations it provided (<code>add-role-repo</code>, <code>remove-role-repo</code>, <code>add-role-org-unit</code>, <code>remove-role-org-unit</code>, <code>add-role-project</code>, <code>remove-role-project</code>) have been replaced by more comprehensive <a href="#_wb.userandgroupmgmt">Security management</a> feature.</p>
</li>
<li>
<p>The operations related to managing deployments (<code>list-deployment</code>, <code>add-deployment</code>, <code>remove-deployment</code>) no longer make sense, since jBPM Runtime has been removed from workbench. Deployments can still be managed programmatically using <a href="#_kie.ksrestapi">Kie Server REST API</a>.</p>
</li>
<li>
<p>The remaining operations (<code>create-org-unit</code>, <code>remove-org-unit</code>, <code>list-org-units</code>, <code>create-repo</code>, <code>remove-repo</code>, <code>list-repo</code>, <code>add-repo-org-unit</code>, <code>remove-repo-org-unit</code>, <code>list-project-details</code>) are available as a part of <a href="#_drools.workbenchremoteapi">workbench remote API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_user_and_project_admin_pages_and_preferences"><a class="anchor" href="#_user_and_project_admin_pages_and_preferences"></a><a class="link" href="#_user_and_project_admin_pages_and_preferences">2.13.7. User and Project Admin Pages and Preferences</a></h4>
<div class="paragraph">
<p>The workbench now has a new menu item: "Admin". In there, you can find some admin tools, like "Users", "Groups" and "Roles" management, and also general preferences. When a preference is changed there, it will affect all places that depend on it, but only for the logged user.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/admin-page-user-access.png" alt="admin page user access">
</div>
<div class="title">Figure 34. User admin page access</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/admin-page-user.png" alt="admin page user">
</div>
<div class="title">Figure 35. User admin page, that contains user level tools and preferences</div>
</div>
<div class="paragraph">
<p>Each project also has its own admin page, with admin tools and preferences. When a preference is changed there, it will affect only that project, and only for the logged user.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/admin-page-project-access.png" alt="admin page project access">
</div>
<div class="title">Figure 36. Project admin page access</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/admin-page-project.png" alt="admin page project">
</div>
<div class="title">Figure 37. Project admin page, that contains project level tools and preferences</div>
</div>
</div>
<div class="sect3">
<h4 id="_gav_conflict_check_and_child_gav_edition"><a class="anchor" href="#_gav_conflict_check_and_child_gav_edition"></a><a class="link" href="#_gav_conflict_check_and_child_gav_edition">2.13.8. GAV conflict check and child GAV edition</a></h4>
<div class="paragraph">
<p>It is now possible, for each user, to set the GAV conflict check flag, and also allow or block child GAV edition for all their projects, or specifically for each project.</p>
</div>
<div class="paragraph">
<p>The configuration can be found inside the admin tool "Project", in case the access is made through the "Admin" menu item. It can also be found by entering the admin tool "General", on the Project admin page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/gav-preferences.png" alt="gav preferences">
</div>
<div class="title">Figure 38. Group Artifact Version (GAV) preferences</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_source_management"><a class="anchor" href="#_data_source_management"></a><a class="link" href="#_data_source_management">2.13.9. Data Source Management</a></h4>
<div class="paragraph">
<p>The new data source management system empowers the workbench with the ability of defining data sources and drivers for accessing external databases.</p>
</div>
<div class="paragraph">
<p>Some of the included functionalities are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A new perspective for managing the data sources:</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSourceManagementPerspective.png" alt="DataSourceManagementPerspective">
</div>
<div class="title">Figure 39. Data Source Authoring Perspective</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A new wizard for guiding the data source creation.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewDataSourceWizard.png" alt="NewDataSourceWizard">
</div>
<div class="title">Figure 40. New Data Source Wizard</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A new wizard for guiding the drivers creation.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewDriverWizard.png" alt="NewDriverWizard">
</div>
<div class="title">Figure 41. New Driver Wizard</div>
</div>
<div class="paragraph">
<p>And the ability of browsing the database information for the databases pointed to by the data sources.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Available schemas browsing</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSourceContentBrowser1.png" alt="DataSourceContentBrowser1">
</div>
<div class="title">Figure 42. Database schemas</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Available tables browsing</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSourceContentBrowser2.png" alt="DataSourceContentBrowser2">
</div>
<div class="title">Figure 43. Schema tables</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Table content browsing</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSourceContentBrowser3.png" alt="DataSourceContentBrowser3">
</div>
<div class="title">Figure 44. Table information</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kieserver.releasenoteskie.7.0.0"><a class="anchor" href="#_kieserver.releasenoteskie.7.0.0"></a><a class="link" href="#_kieserver.releasenoteskie.7.0.0">2.14. Breaking changes in Kie Server 7.0 from 6.x</a></h3>
<div class="sect3">
<h4 id="_serviceresponse_xstream_marshalling_changes"><a class="anchor" href="#_serviceresponse_xstream_marshalling_changes"></a><a class="link" href="#_serviceresponse_xstream_marshalling_changes">2.14.1. ServiceResponse XStream marshalling changes</a></h4>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This release note applies only when directly interfacing with the Kie Server (kie-server) API, not when using the Kie Server Java Client (kie-server-client) API.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In an effort to be more consistent with JAXB marshalling, XStream marshalling has undergone the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The XML ServiceResponse element’s <code>response</code> object no longer renders with the canonical name.</p>
</li>
<li>
<p>XStream now uses <code>type</code> and <code>msg</code> as attributes, not child elements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details, see <a href="https://issues.jboss.org/browse/DROOLS-1509">DROOLS-1509</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_simplified_planner_rest_api"><a class="anchor" href="#_simplified_planner_rest_api"></a><a class="link" href="#_simplified_planner_rest_api">2.14.2. Simplified Planner REST API</a></h4>
<div class="sect4">
<h5 id="_serviceresponse_wrapper_removal"><a class="anchor" href="#_serviceresponse_wrapper_removal"></a><a class="link" href="#_serviceresponse_wrapper_removal">2.14.2.1. ServiceResponse wrapper removal</a></h5>
<div class="paragraph">
<p><code>ServiceResponse</code> wrapper has been removed from Planner service responses returned by KIE Server.
This allows an easier processing of the responses on the client side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">solver-instance</span>&gt;</span>
    ...
    <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>SOLVING<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">score</span> <span class="hljs-attribute">scoreClass</span>=<span class="hljs-value">"org.optaplanner.core.api.score.buildin.hardsoft.HardSoftScore"</span>&gt;</span>0hard/-10soft<span class="hljs-tag">&lt;/<span class="hljs-title">score</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">best-solution</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"curriculumcourse.curriculumcourse.CourseSchedule"</span>&gt;</span>
        ...
    <span class="hljs-tag">&lt;/<span class="hljs-title">best-solution</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">solver-instance</span>&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_new_planner_api_overview"><a class="anchor" href="#_new_planner_api_overview"></a><a class="link" href="#_new_planner_api_overview">2.14.2.2. New Planner API overview</a></h5>
<div class="paragraph">
<p>Register a solver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PUT <a href="http://%24%7Bkie-server%7D/services/rest/server/containers/$%7Bcontainer_id%7D/solvers/$%7Bsolver_id%7D" class="bare">http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Submit a solution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POST <a href="http://%24%7Bkie-server%7D/services/rest/server/containers/$%7Bcontainer_id%7D/solvers/$%7Bsolver_id%7D/state/solving" class="bare">http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/state/solving</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Get the best solution:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GET <a href="http://%24%7Bkie-server%7D/services/rest/server/containers/$%7Bcontainer_id%7D/solvers/$%7Bsolver_id%7D/bestsolution" class="bare">http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/bestsolution</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Terminate a solver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POST <a href="http://%24%7Bkie-server%7D/services/rest/server/containers/$%7Bcontainer_id%7D/solvers/$%7Bsolver_id%7D/state/terminating-early" class="bare">http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}/state/terminating-early</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dispose a solver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DELETE <a href="http://%24%7Bkie-server%7D/services/rest/server/containers/$%7Bcontainer_id%7D/solvers/$%7Bsolver_id%7D" class="bare">http://${kie-server}/services/rest/server/containers/${container_id}/solvers/${solver_id}</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.5.0"><a class="anchor" href="#_drools.releasenotesdrools.6.5.0"></a><a class="link" href="#_drools.releasenotesdrools.6.5.0">2.15. What is New and Noteworthy in Drools 6.5.0</a></h3>
<div class="sect3">
<h4 id="_configurable_threadfactory"><a class="anchor" href="#_configurable_threadfactory"></a><a class="link" href="#_configurable_threadfactory">2.15.1. Configurable ThreadFactory</a></h4>
<div class="paragraph">
<p>Some runtime environments (like for example Google App Engine) don’t allow to directly create new Threads.
For this reason it is now possible to plug your own ThreadFactory implementation by setting the system property <strong>drools.threadFactory</strong> with its class name.
For instance if you implemented your Google App Engine compatible ThreadFactory with the class <code>com.user.project.GoogleAppEngineThreadFactory</code> you can make Drools to use it by setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">drools.threadFactory = com.user.project.GoogleAppEngineThreadFactory</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_use_of_any_expressions_as_input_for_a_query"><a class="anchor" href="#_use_of_any_expressions_as_input_for_a_query"></a><a class="link" href="#_use_of_any_expressions_as_input_for_a_query">2.15.2. Use of any expressions as input for a query</a></h4>
<div class="paragraph">
<p>It is now possible to use as input argument for a query both the field of a fact as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">query contains(<span class="hljs-constant">String</span> <span class="hljs-variable">$s</span>, <span class="hljs-constant">String</span> <span class="hljs-variable">$c</span>)
    <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span>= <span class="hljs-constant">String</span>( this.contains( <span class="hljs-variable">$c</span> ) )
<span class="hljs-keyword">end</span>

rule <span class="hljs-constant">PersonNamesWithA</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>()
    contains( <span class="hljs-variable">$p</span>.name, <span class="hljs-string">"a"</span>; )
<span class="hljs-keyword">then</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and more in general any kind of valid expression like in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">query checkLength(<span class="hljs-constant">String</span> <span class="hljs-variable">$s</span>, int <span class="hljs-variable">$l</span>)
    <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span>= <span class="hljs-constant">String</span>( length == <span class="hljs-variable">$l</span> )
<span class="hljs-keyword">end</span>

rule <span class="hljs-constant">CheckPersonNameLength</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$i</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Integer</span>()
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>()
    checkLength( <span class="hljs-variable">$p</span>.name, <span class="hljs-number">1</span> + <span class="hljs-variable">$i</span> + <span class="hljs-variable">$p</span>.age; )
<span class="hljs-keyword">then</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_with_modified_properties"><a class="anchor" href="#_update_with_modified_properties"></a><a class="link" href="#_update_with_modified_properties">2.15.3. Update with modified properties</a></h4>
<div class="paragraph">
<p>Property reactivity has been introduced to avoid unwanted and useless (re)evaluations and allow the engine to react only to
modification of properties actually constrained or bound inside of a given pattern. However this feature is automatically available
only for modifications performed inside the consequence of a rule. Conversely a programmatic update is unaware of the object’s
properties that have been changed, so it is unable of using this feature.</p>
</div>
<div class="paragraph">
<p>To overcome this limitation it is now possible to optionally specify in an update statement the names of the properties that
have been changed in the modified object as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person me = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"me"</span>, <span class="hljs-number">40</span>);
FactHandle meHandle = ksession.insert( me );

me.setAge(<span class="hljs-number">41</span>);
me.setAddress(<span class="hljs-string">"California Avenue"</span>);
ksession.update( meHandle, me, <span class="hljs-string">"age"</span>, <span class="hljs-string">"address"</span> );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_framework_improvements"><a class="anchor" href="#_monitoring_framework_improvements"></a><a class="link" href="#_monitoring_framework_improvements">2.15.4. Monitoring framework improvements</a></h4>
<div class="paragraph">
<p>A new type of MBean has been introduced in order to provide monitoring of the KieContainers, and the JMX MBeans hierarchical structure have been revisited to reflect the relationship with the related MBeans of the KieBases.
The JMX objectnaming has been normalized to reflect the terminology used in the Kie API.
A new type of MBean has been introduced in order to provide monitoring for Stateless KieSession, which was not available in previous releases.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. JMX objectname changes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MBean</th>
<th class="tableblock halign-left valign-top">before <code>6.5.x</code></th>
<th class="tableblock halign-left valign-top">from <code>6.5.0.Final</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieContainer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieBase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.kbases:type=<em>{kbaseId}</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em>,kbaseId=<em>{kbaseId}</em></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KieSession (stateful)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.drools.kbases:type=<em>{kbaseId}</em>,group=Sessions,sessionId=<em>{ksessionId}</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em>,kbaseId=<em>{kbaseId}</em>,ksessionType=Stateful,ksessionName=<em>{ksessionName}</em></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stateless KieSession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie:kcontainerId=<em>{kcontainerId}</em>,kbaseId=<em>{kbaseId}</em>,ksessionType=Stateless,ksessionName=<em>{ksessionName}</em></code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The KieSession MBeans consolidate the statistics data for all sessions instantiated under the same name.</p>
</div>
<div class="paragraph">
<p>KieSession created via <code>JPAKnowledgeService</code>, will be monitored under a KieSession MBean having constant <code>{ksessionName}</code> valorized to <code>persistent</code>; this MBean is not managed by the KieContainer directly, hence it requires to be manually deregistered from JMX, when monitoring is no longer needed.</p>
</div>
<div class="paragraph">
<p>The new JMX objectnaming scheme now enforces proper JMX quoting for IDs, e.g.: <code>org.kie:kcontainerId="2cb55f40-f220-432a-aba8-7940c18bf108",kbaseId="KBase1"</code></p>
</div>
<div class="paragraph">
<p>The old DroolsManagementAgent (which was registered on JMX under <code>org.drools:type=DroolsManagementAgent</code>) is no longer necessary, hence no longer registered on JMX.</p>
</div>
<div class="paragraph">
<p>The KieSession MBeans now have proper JMX <code>CompositeData</code> and <code>TabularData</code> support, where applicable. The KieSession MBeans continue to support all process-related aggregated statistics monitoring, but no longer display start/end dates for each process instances: auditing and logging support is available in jBPM for this scope.</p>
</div>
<div class="paragraph">
<p>The Drools RHQ/JON plug-in have been changed to reflect all the above mentioned changes, in addition to specific bug-fixing aiming to display hierarchical nesting correctly.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.4.0"><a class="anchor" href="#_drools.releasenotesdrools.6.4.0"></a><a class="link" href="#_drools.releasenotesdrools.6.4.0">2.16. What is New and Noteworthy in Drools 6.4.0</a></h3>
<div class="sect3">
<h4 id="_better_java_8_compatibility"><a class="anchor" href="#_better_java_8_compatibility"></a><a class="link" href="#_better_java_8_compatibility">2.16.1. Better Java 8 compatibility</a></h4>
<div class="paragraph">
<p>It is now possible to use Java 8 syntax (lambdas and method references) in the Right Hand Side (then) part of a rule.</p>
</div>
</div>
<div class="sect3">
<h4 id="_more_robust_incremental_compilation"><a class="anchor" href="#_more_robust_incremental_compilation"></a><a class="link" href="#_more_robust_incremental_compilation">2.16.2. More robust incremental compilation</a></h4>
<div class="paragraph">
<p>The incremental compilation (dynamic rule-base update) had some relevant flaws when one or more rules with a subnetwork (rules with complex existential patterns) were involved, especially when the same subnetwork was shared among different rules.
This issue required a partial rewriting of the existing incremental compilation algorithm, followed by a complete audit that has also been validated by brand new test suite made by more than 20,000 test cases only in this area.</p>
</div>
</div>
<div class="sect3">
<h4 id="_improved_multi_threading_behaviour"><a class="anchor" href="#_improved_multi_threading_behaviour"></a><a class="link" href="#_improved_multi_threading_behaviour">2.16.3. Improved multi-threading behaviour</a></h4>
<div class="paragraph">
<p>Engine’s code dealing with multi-threading has been partially rewritten in order to remove a large number of synchronisation points and improve stability and predictability.
In particular this new implementation allows a clearer separation and better interaction between the User thread (performing the insert/update/delete actions on the session), the Engine thread (doing the proper rules evaluation) and the Timer one (performing time-based actions like events expiration).</p>
</div>
<div class="paragraph">
<p>This improvement has been made possible by the new phreak algorithm introduced with Drools 6.
In fact with in the ReteOO algorithm the network evaluation is performed during the User insert/update/delete action, meaning that each user action locks the entire engine.
Conversely with phreak the insert/update/delete is separated and the network evaluation happens when fireAllRules or fireUntilHalt is called.</p>
</div>
<div class="paragraph">
<p>More in detail this improvement has been made by 2 parts.
First of all a new thread-safe queue has been added to store all user actions as commands.
This queue is populated by the User thread while its entries are flushed and processed by the Engine thread during the rules evaluations phase.
The second part introduced a state machine coordinating the User, Timer and Engine threads and then providing a clearer and self-documenting way to model their interactions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_oopath_improvements_2"><a class="anchor" href="#_oopath_improvements_2"></a><a class="link" href="#_oopath_improvements_2">2.16.4. OOPath improvements</a></h4>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>OOPath has been introduced with Drools 6.3.0.
In Drools 6.4.0 it has been enhanced to support the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A constraint can also have a beckreference to an object of the graph traversed before the currently iterated one. For example the following OOPath:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan/exams/grades{ result &gt; ../averageResult } )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will match only the grades having a result above the average for the passed exam.</p>
</div>
</li>
<li>
<p>A constraint can also recursively be another OOPath as it follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$exam</span>: /plan/exams{ /grades{ result &gt; <span class="hljs-number">20</span> } } )</code></pre>
</div>
</div>
</li>
<li>
<p>It is also possible to use the <code>?/</code> separator instead of the <code>/</code> one. As in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan/exams{ course == <span class="hljs-string">"Big Data"</span> }?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>By doing so the engine will react to a change made to an exam, or if an exam is added to the plan, but not if a new grade is added to an existing exam.
Of course if a OOPath chunk is not reactive, all remaining part of the OOPath from there till the end of the expression will be non-reactive as well.
For instance the following OOPath</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: ?/plan/exams{ course == <span class="hljs-string">"Big Data"</span> }/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be completely non-reactive.
For this reason it is not allowed to use the <code>?/</code> separator more than once in the same OOPath so an expression like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan?/exams{ course == <span class="hljs-string">"Big Data"</span> }?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will cause a compile time error.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.4.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.6.4.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.6.4.0.final">2.17. New and Noteworthy in KIE Workbench 6.4.0</a></h3>
<div class="sect3">
<h4 id="_new_look_and_feel"><a class="anchor" href="#_new_look_and_feel"></a><a class="link" href="#_new_look_and_feel">2.17.1. New look and feel</a></h4>
<div class="paragraph">
<p>The general look and feel in the entire workbench has been updated to adopt <a href="https://www.patternfly.org/">PatternFly</a>.
The update brings a cleaner, lightweight and more consistent user experience throughout every screen.
Allowing users focus on the data and the tasks by removing all uncessary visual elements.
Interactions and behaviors remain mostly unchanged, limiting the scope of this change to visual updates.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/NewLookAndFeel.png" alt="NewLookAndFeel">
</div>
<div class="title">Figure 45. Workbench - New look and feel</div>
</div>
</div>
<div class="sect3">
<h4 id="_various_ui_improvements"><a class="anchor" href="#_various_ui_improvements"></a><a class="link" href="#_various_ui_improvements">2.17.2. Various UI improvements</a></h4>
<div class="paragraph">
<p>In addition to the PatternFly update described above which targeted the general look and feel, many  individual components in the workbench have been improved to create a better user experience.
This involved  making sure the default size of modal popup windows is appropriate to fit the corresponding content, adjusting the size of text fields as well as aligning labels, and improving the resize behaviour of various components  when used on smaller screens.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/ModalPostPatternFly.png" alt="ModalPostPatternFly">
</div>
<div class="title">Figure 46. Workbench - Properly sized popup window</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/LabelFieldAlignmentPostPatternFly.png" alt="LabelFieldAlignmentPostPatternFly">
</div>
<div class="title">Figure 47. Workbench - Properly sized text fields and aligned labels</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/HorizonalAlignmentPostPatternFly.png" alt="HorizonalAlignmentPostPatternFly">
</div>
<div class="title">Figure 48. Workbench - Resized editor window with limited horizontal space</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_locales"><a class="anchor" href="#_new_locales"></a><a class="link" href="#_new_locales">2.17.3. New locales</a></h4>
<div class="paragraph">
<p>Locales <code>ru</code> (Russian) and <code>zh_TW</code> (Chineses Traditional) have now been added.</p>
</div>
<div class="paragraph">
<p>The locales now supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default English.</p>
</li>
<li>
<p><code>es</code> (Spanish)</p>
</li>
<li>
<p><code>fr</code> (French)</p>
</li>
<li>
<p><code>de</code> (German)</p>
</li>
<li>
<p><code>ja</code> (Japanese)</p>
</li>
<li>
<p><code>pt_BR</code> (Portuguese - Brazil)</p>
</li>
<li>
<p><code>zh_CN</code> (Chinese - Simplified)</p>
</li>
<li>
<p><code>zh_TW</code> (Chinese - Traditional)</p>
</li>
<li>
<p><code>ru</code> (Russian)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_imports_consistent_terminology"><a class="anchor" href="#_authoring_imports_consistent_terminology"></a><a class="link" href="#_authoring_imports_consistent_terminology">2.17.4. Authoring - Imports - Consistent terminology</a></h4>
<div class="paragraph">
<p>The Workbench used to have a section in the Project Editor for "Import Suggestions" which was really a way for Users to register classes provided by the Java Runtime environment to be available to Rule authoring.
Furthermore Editors had a "Config" tab which was where Users were expected to import classes from other packages to that in which the rule resides.</p>
</div>
<div class="paragraph">
<p>Neither term was clear and both were inconsistent with each other and other aspects of the Workbench.</p>
</div>
<div class="paragraph">
<p>We have changed these terms to (hopefully) be clearer in their meaning and to be consistent with the "Data Object" term used in relation to authoring Java classes within the Workbench.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/ExternalDataObjects1.png" alt="ExternalDataObjects1">
</div>
<div class="title">Figure 49. Project Editor - External Data Objects</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/ExternalDataObjects2.png" alt="ExternalDataObjects2">
</div>
<div class="title">Figure 50. Project Editor - Defining External Data Objects</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DataObjects1.png" alt="DataObjects1">
</div>
<div class="title">Figure 51. Asset Editors - Data Objects</div>
</div>
<div class="paragraph">
<p>The Data Object screen lists all Data Objects in the same package as the asset and allows other Data Objects from other packages to be imported.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DataObjects2.png" alt="DataObjects2">
</div>
<div class="title">Figure 52. Asset Editors - Defining Data Objects available for authoring</div>
</div>
</div>
<div class="sect3">
<h4 id="_disable_automatic_build"><a class="anchor" href="#_disable_automatic_build"></a><a class="link" href="#_disable_automatic_build">2.17.5. Disable automatic build</a></h4>
<div class="paragraph">
<p>When navigating Projects with the Project Explorer the workbench automatically builds the selected project, displaying build messages in the  Message Console.
Whilst this is beneficial it can have a detremental impact on performance of the workbench when authoring large projects.
The  automatic build can now be disabled with the <code>org.kie.build.disable-project-explorer</code> System Property.
Set the value  to <code>true</code> to disable.
The default value is <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_support_for_code_scp_code_style_code_git_code_repository_urls"><a class="anchor" href="#_support_for_code_scp_code_style_code_git_code_repository_urls"></a><a class="link" href="#_support_for_code_scp_code_style_code_git_code_repository_urls">2.17.6. Support for <code>SCP</code> style <code>git</code> Repository URLs</a></h4>
<div class="paragraph">
<p>When cloning <code>git</code> Repositories it is now possible to use <code>SCP</code> style URLS, for example <code>git@github.com:user/repository.git</code>.
If your Operating System’s public keystore is password protected the passphrase can be provided with the <code>org.uberfire.nio.git.ssh.passphrase</code> System Property.</p>
</div>
</div>
<div class="sect3">
<h4 id="_authoring_duplicate_gav_detection"><a class="anchor" href="#_authoring_duplicate_gav_detection"></a><a class="link" href="#_authoring_duplicate_gav_detection">2.17.7. Authoring - Duplicate GAV detection</a></h4>
<div class="paragraph">
<p>When performing any of the following operations a check is now made against all Maven Repositories, resolved for the Project,  for whether the Project’s GroupId, ArtifactId and Version pre-exist.
If a clash is found the operation is prevented; although this can be overridden by Users with the <code>admin</code> role.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The feature can be disabled by setting the System Property <code>org.guvnor.project.gav.check.disabled</code> to <code>true</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Resolved repositories are those discovered in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Project’s <code>POM</code> <code>&lt;repositories&gt;</code> section (or any parent <code>POM</code>).</p>
</li>
<li>
<p>The Project’s <code>POM</code> <code>&lt;distributionManagement&gt;</code> section.</p>
</li>
<li>
<p>Maven’s global <code>settings.xml</code> configuration file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Affected operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation of new Managed Repositories.</p>
</li>
<li>
<p>Saving a Project defintion with the Project Editor.</p>
</li>
<li>
<p>Adding new Modules to a Managed Multi-Module Repository.</p>
</li>
<li>
<p>Saving the <code>pom.xml</code> file.</p>
</li>
<li>
<p>Build &amp; installing a Project with the Project Editor.</p>
</li>
<li>
<p>Build &amp; deploying a Project with the Project Editor.</p>
</li>
<li>
<p>Asset Management operations building, installing or deloying Projects.</p>
</li>
<li>
<p><code>REST</code> operations creating, installing or deploying Projects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users with the <code>Admin</code> role can override the list of Repositories checked using the "Repositories" settings in the Project Editor.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/MavenRepositories1.png" alt="MavenRepositories1">
</div>
<div class="title">Figure 53. Project Editor - Viewing resolved Repositories</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/MavenRepositories2.png" alt="MavenRepositories2">
</div>
<div class="title">Figure 54. Project Editor - The list of resolved Repositories</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/MavenRepositories3.png" alt="MavenRepositories3">
</div>
<div class="title">Figure 55. Duplicate GAV detected</div>
</div>
</div>
<div class="sect3">
<h4 id="_new_execution_server_management_user_interface"><a class="anchor" href="#_new_execution_server_management_user_interface"></a><a class="link" href="#_new_execution_server_management_user_interface">2.17.8. New Execution Server Management User Interface</a></h4>
<div class="paragraph">
<p>The KIE Execution Server Management UI has been completely redesigned to adjust to major improvements introduced recently.
Besides the fact that new UI has been built from scratch and following best practices provided by PatternFly, the new interface expands previous features giving users more control of their servers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/NewExecServerUI.png" alt="NewExecServerUI">
</div>
<div class="title">Figure 56. KIE Execution Server - New user interface</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_and_group_management"><a class="anchor" href="#_user_and_group_management"></a><a class="link" href="#_user_and_group_management">2.17.9. User and group management</a></h4>
<div class="paragraph">
<p>Provides the backend services and an intuitive and friendly user interface that allows the workbench administrators to manage the application’s users and groups.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/UserAndGroupManagement.png" alt="UserAndGroupManagement">
</div>
</div>
<div class="paragraph">
<p>This interface provides to the workbench administrators the ability to perform realm related operations such as create users, create groups, assign groups or roles to a given user, etc.</p>
</div>
<div class="paragraph">
<p>It comes by default with built-in implementations for the administration of Wildfly, EAP and Tomcat default realms, and it’s designed to be extensible - any third party realm management system can be easily integrated into the workbench.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.3.0"><a class="anchor" href="#_drools.releasenotesdrools.6.3.0"></a><a class="link" href="#_drools.releasenotesdrools.6.3.0">2.18. What is New and Noteworthy in Drools 6.3.0</a></h3>
<div class="sect3">
<h4 id="_browsing_graphs_of_objects_with_oopath"><a class="anchor" href="#_browsing_graphs_of_objects_with_oopath"></a><a class="link" href="#_browsing_graphs_of_objects_with_oopath">2.18.1. Browsing graphs of objects with OOPath</a></h4>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When the field of a fact is a collection it is possible to bind and reason over all the items in that collection on by one using the <code>from</code> keyword.
Nevertheless, when it is required to browse a graph of object the extensive use of the <code>from</code> conditional element may result in a verbose and cubersome syntax like in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Browsing a graph of objects with from</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Find all grades for Big Data exam"</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$student</span><span class="hljs-symbol">:</span> <span class="hljs-constant">Student</span>( <span class="hljs-variable">$plan</span><span class="hljs-symbol">:</span> plan )
    <span class="hljs-variable">$exam</span><span class="hljs-symbol">:</span> <span class="hljs-constant">Exam</span>( course == <span class="hljs-string">"Big Data"</span> ) from <span class="hljs-variable">$plan</span>.exams
    <span class="hljs-variable">$grade</span><span class="hljs-symbol">:</span> <span class="hljs-constant">Grade</span>() from <span class="hljs-variable">$exam</span>.grades
<span class="hljs-keyword">then</span> /* <span class="hljs-constant">RHS</span> *<span class="hljs-regexp">/ end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example it has been assumed to use a domain model consisting of a <code>Student</code> who has a <code>Plan</code> of study: a <code>Plan</code> can have zero or more <code>Exam</code>s and an <code>Exam</code> zero or more <code>Grade</code>s.
Note that only the root object of the graph (the <code>Student</code> in this case) needs to be in the working memory in order to make this works.</p>
</div>
<div class="paragraph">
<p>By borrowing ideas from XPath, this syntax can be made more succinct, as XPath has a compact notation for navigating through related elements while handling collections and filtering constraints.
This XPath-inspired notation has been called <code>OOPath</code> since it is explictly intended to browse graph of objects.
Using this notation the former example can be rewritten as it follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Browsing a graph of objects with OOPath</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Find all grades for Big Data exam"</span> <span class="hljs-keyword">when</span>
    <span class="hljs-constant">Student</span>( <span class="hljs-variable">$grade</span><span class="hljs-symbol">:</span> /plan/exams[course == <span class="hljs-string">"Big Data"</span>]/grades )
<span class="hljs-keyword">then</span> /* <span class="hljs-constant">RHS</span> *<span class="hljs-regexp">/ end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Formally, the core grammar of an <code>OOPath</code> expression can be defined in EBNF notation in this way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ini"><span class="hljs-setting">OOPExpr = <span class="hljs-value"><span class="hljs-string">"/"</span> OOPSegment { ( <span class="hljs-string">"/"</span> | <span class="hljs-string">"."</span> ) OOPSegment } ;</span></span>
<span class="hljs-setting">OOPSegment = <span class="hljs-value">[ID ( <span class="hljs-string">":"</span> | <span class="hljs-string">":="</span> )] ID [<span class="hljs-string">"["</span> Number <span class="hljs-string">"]"</span>] [<span class="hljs-string">"{"</span> Constraints <span class="hljs-string">"}"</span>];</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In practice an <code>OOPath</code> expression has the following features.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It has to start with <code>/</code>.</p>
</li>
<li>
<p>It can dereference a single property of an object with the <code>.</code> operator</p>
</li>
<li>
<p>It can dereference a multiple property of an object using the <code>/</code> operator. If a collection is returned, it will iterate over the values in the collection</p>
</li>
<li>
<p>While traversing referenced objects it can filter away those not satisfying one or more constraints, written as predicate expressions between curly brackets like in:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan/exams[course == <span class="hljs-string">"Big Data"</span>]/grades )</code></pre>
</div>
</div>
</li>
<li>
<p>Items can also be accessed by their index by putting it between square brackets like in:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan/exams[<span class="hljs-number">0</span>]/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>To adhere to Java convention OOPath indexes are 0-based, compared to XPath 1-based</p>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_reactive_oopath"><a class="anchor" href="#_reactive_oopath"></a><a class="link" href="#_reactive_oopath">2.18.1.1. Reactive OOPath</a></h5>
<div class="paragraph">
<p>At the moment Drools is not able to react to updates involving a deeply nested traversed during the evaluation of an <code>OOPath</code> expression.
To make these objects reactive to changes at the moment it is necessary to make them extend the class <code>org.drools.core.phreak.ReactiveObject</code>.
It is planned to overcome this limitation by implementing a mechanism that automatically instruments the classes belonging to a specific domain model.</p>
</div>
<div class="paragraph">
<p>Having extendend that class, the domain objects can notify the engine when one of its field has been updated by invoking the inherited method <code>notifyModification</code> as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Notifying the engine that an exam has been moved to a different course</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCourse</span><span class="hljs-params">(String course)</span> </span>{
    <span class="hljs-keyword">this</span>.course = course;
    notifyModification(<span class="hljs-keyword">this</span>);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this way if an exam is moved to a different course, the rule is re-triggered and the list of grades matching the rule recomputed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_shared.releasenotes.kienavigator"><a class="anchor" href="#_shared.releasenotes.kienavigator"></a><a class="link" href="#_shared.releasenotes.kienavigator">2.18.2. Kie Navigator View for Eclipse</a></h4>
<div class="paragraph">
<p>A new viewer has been added to the Eclipse Tooling.
This Kie Navigator View is used to manage Kie Server installations and projects.</p>
</div>
<div class="paragraph">
<p>Please read the chapter <a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/Eclipe-KieNavigator-section.html#Kie_Navigator_View">Kie Navigator View</a>
for more information about this new feature</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.3.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.6.3.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.6.3.0.final">2.19. New and Noteworthy in KIE Workbench 6.3.0</a></h3>
<div class="sect3">
<h4 id="_real_time_validation_and_verification_for_the_decision_tables"><a class="anchor" href="#_real_time_validation_and_verification_for_the_decision_tables"></a><a class="link" href="#_real_time_validation_and_verification_for_the_decision_tables">2.19.1. Real Time Validation and Verification for the Decision Tables</a></h4>
<div class="paragraph">
<p>Decision tables used to have a Validation-button for validating the table.
This is now removed and the table is validated after each cell value change.
The validation and verification checks include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Redundancy</p>
</li>
<li>
<p>Subsumption</p>
</li>
<li>
<p>Conflicts</p>
</li>
<li>
<p>Missing Columns</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These checks are explained in detail in the workbench documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_improved_drl_editor"><a class="anchor" href="#_improved_drl_editor"></a><a class="link" href="#_improved_drl_editor">2.19.2. Improved DRL Editor</a></h4>
<div class="paragraph">
<p>The DRL Editor has undergone a face lift; moving from a plain TextArea to using ACE Editor and a custom DRL syntax highlighter.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/drl-ace-editor.png" alt="drl ace editor">
</div>
<div class="title">Figure 57. ACE Editor</div>
</div>
</div>
<div class="sect3">
<h4 id="_asset_locking"><a class="anchor" href="#_asset_locking"></a><a class="link" href="#_asset_locking">2.19.3. Asset locking</a></h4>
<div class="paragraph">
<p>To avoid conflicts when editing assets, a new locking mechanism has been introduced that makes sure that only one user at a time can edit an asset.
When a user begins to edit an asset, a lock will automatically be acquired.
This is indicated by a lock symbol appearing on the asset title bar as well as in the project explorer view.
If a user starts editing an already locked asset a pop-up notification will appear to inform the user that the asset can’t currently be edited, as it is being worked on by another user.
As long as the editing user holds the lock, changes by other users will be prevented.
Locks will automatically be released when the editing user saves or closes the asset, or logs out of the workbench.
Every user further has the option to force a lock release in the metadata tab, if required.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DataModelEditingWithLock.png" alt="DataModelEditingWithLock">
</div>
<div class="title">Figure 58. Editing an asset automatically acquires a lock</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DataModelLocked.png" alt="DataModelLocked">
</div>
<div class="title">Figure 59. Locked assets cannot be edited by other users</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_modeller_tool_windows"><a class="anchor" href="#_data_modeller_tool_windows"></a><a class="link" href="#_data_modeller_tool_windows">2.19.4. Data Modeller Tool Windows</a></h4>
<div class="paragraph">
<p>Drools and jBPM configurations, Persistence (see Generation of JPA enabled Data Models) and Advanced configurations were moved into "Tool Windows". "Tool Windows" are a new concept introduced in latest Uberfire version that enables the development of context aware screens.
Each "Tool Window" will contain a domain editor that will manage a set of related Data Object parameters.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DM-DroolsDomainToolWindow6.3.png" alt="DM DroolsDomainToolWindow6.3">
</div>
<div class="title">Figure 60. Drools and jBPM domain tool window</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DM-JPADomainToolWindow6.3.png" alt="DM JPADomainToolWindow6.3">
</div>
<div class="title">Figure 61. Persistence tool window</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DM-AdvancedDomainToolWindow6.3.png" alt="DM AdvancedDomainToolWindow6.3">
</div>
<div class="title">Figure 62. Advanced configurations tool window</div>
</div>
</div>
<div class="sect3">
<h4 id="_generation_of_jpa_enabled_data_models"><a class="anchor" href="#_generation_of_jpa_enabled_data_models"></a><a class="link" href="#_generation_of_jpa_enabled_data_models">2.19.5. Generation of JPA enabled Data Models</a></h4>
<div class="paragraph">
<p>Data modeller was extended to support the generation of persistable Data Objects.
The persistable Data Objects are based on the JPA specification and all the underlying metadata are automatically generated.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"The New → Data Object" Data Objects can be marked as persistable at creation time.</p>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DM-NewDataObject6.3.png" alt="DM NewDataObject6.3">
</div>
<div class="title">Figure 63. New Data Object</div>
</div>
</li>
<li>
<p>The Persistence tool window contains the JPA Domain editors for both Data Object and Field. Each editor will manage the by default generated JPA metadata</p>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DM-DataObjectJPADomainTab6.3.png" alt="DM DataObjectJPADomainTab6.3">
</div>
<div class="title">Figure 64. Data Object level JPA domain editor</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DM-FieldJPADomainTab6.3.png" alt="DM FieldJPADomainTab6.3">
</div>
<div class="title">Figure 65. Field level JPA domain editor</div>
</div>
</li>
<li>
<p>Persistence configuration screen was added to the project editor.</p>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DM-Persistence-Configuration6.3.png" alt="DM Persistence Configuration6.3">
</div>
<div class="title">Figure 66. Persistence configuration</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_data_set_authoring"><a class="anchor" href="#_data_set_authoring"></a><a class="link" href="#_data_set_authoring">2.19.6. Data Set Authoring</a></h4>
<div class="paragraph">
<p>A new perspective for authoring data set definitions has been added.
Data set definitions make it possible to retrieve data from external systems like databases, CSV/Excel files or even use a Java class to generate the data.
Once the data is available it can be used, for instance, to create charts and dashboards from the Perspective Editor just feeding the charts from any of the data sets available.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/DataSetAuthoringPerspective.png" alt="DataSetAuthoringPerspective">
</div>
<div class="title">Figure 67. Data Sets Authoring Perspective</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.2.0"><a class="anchor" href="#_drools.releasenotesdrools.6.2.0"></a><a class="link" href="#_drools.releasenotesdrools.6.2.0">2.20. What is New and Noteworthy in Drools 6.2.0</a></h3>
<div class="sect3">
<h4 id="_propagation_modes"><a class="anchor" href="#_propagation_modes"></a><a class="link" href="#_propagation_modes">2.20.1. Propagation modes</a></h4>
<div class="paragraph">
<p>The introduction of PHREAK as default algorithm for the Drools engine made the rules' evaluation lazy.
This new Drools lazy behavior allowed a relevant performance boost but, in some very specific cases, breaks the semantic of a few Drools features.</p>
</div>
<div class="paragraph">
<p>More precisely in some circumstances it is necessary to propagate the insertion of new fact into th session immediately.
For instance Drools allows a query to be executed in pull only (or passive) mode by prepending a '?' symbol to its invocation as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. A passive query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function">query <span class="hljs-title">Q</span> <span class="hljs-params">(Integer i)</span>
    <span class="hljs-title">String</span><span class="hljs-params">( <span class="hljs-keyword">this</span> == i.toString()</span> )
end
rule R when
    $i : <span class="hljs-title">Integer</span><span class="hljs-params">()</span>
    ?<span class="hljs-title">Q</span><span class="hljs-params">( $i; )</span>
then
    System.out.<span class="hljs-title">println</span><span class="hljs-params">( $i )</span></span>;
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, since the query is passive, it shouldn’t react to the insertion of a String matching the join condition in the query itself.
In other words this sequence of commands</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = ...
ksession.insert(<span class="hljs-number">1</span>);
ksession.insert(<span class="hljs-string">"1"</span>);
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>shouldn’t cause the rule R to fire because the String satisfying the query condition has been inserted after the Integer and the passive query shouldn’t react to this insertion.
Conversely the rule should fire if the insertion sequence is inverted because the insertion of the Integer, when the passive query can be satisfied by the presence of an already existing String, will trigger it.</p>
</div>
<div class="paragraph">
<p>Unfortunately the lazy nature of PHREAK doesn’t allow the engine to make any distinction regarding the insertion sequence of the two facts, so the rule will fire in both cases.
In circumstances like this it is necessary to evaluate the rule eagerly as done by the old RETEOO-based engine.</p>
</div>
<div class="paragraph">
<p>In other cases it is required that the propagation is eager, meaning that it is not immedate, but anyway has to happen before the engine/agenda starts scheduled evaluations.
For instance this is necessary when a rule has the no-loop or the lock-on-active attribute and in fact when this happens this propagation mode is automatically enforced by the engine.</p>
</div>
<div class="paragraph">
<p>To cover these use cases, and in all other situations where an immediate or eager rule evaluation is required, it is possible to declaratively specify so by annotating the rule itself with <strong>@Propagation(Propagation.Type)</strong>, where Propagation.Type is an enumeration with 3 possible values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>IMMEDIATE</strong> means that the propagation is performed immediately.</p>
</li>
<li>
<p><strong>EAGER</strong> means that the propagation is performed lazily but eagerly evaluated before scheduled evaluations.</p>
</li>
<li>
<p><strong>LAZY</strong> means that the propagation is totally lazy and this is default PHREAK behaviour</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This means that the following drl:</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. A data-driven rule using a passive query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function">query <span class="hljs-title">Q</span> <span class="hljs-params">(Integer i)</span>
    <span class="hljs-title">String</span><span class="hljs-params">( <span class="hljs-keyword">this</span> == i.toString()</span> )
end
rule R @<span class="hljs-title">Propagation</span><span class="hljs-params">(IMMEDIATE)</span> when
    $i : <span class="hljs-title">Integer</span><span class="hljs-params">()</span>
    ?<span class="hljs-title">Q</span><span class="hljs-params">( $i; )</span>
then
    System.out.<span class="hljs-title">println</span><span class="hljs-params">( $i )</span></span>;
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>will make the rule R to fire if and only if the Integer is inserted after the String, thus behaving in accordance with the semantic of the passive query.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.2.0.final"><a class="anchor" href="#_wb.releasenotesworkbench.6.2.0.final"></a><a class="link" href="#_wb.releasenotesworkbench.6.2.0.final">2.21. New and Noteworthy in KIE Workbench 6.2.0</a></h3>
<div class="sect3">
<h4 id="_download_repository_or_part_of_the_repository_as_a_zip"><a class="anchor" href="#_download_repository_or_part_of_the_repository_as_a_zip"></a><a class="link" href="#_download_repository_or_part_of_the_repository_as_a_zip">2.21.1. Download Repository or Part of the Repository as a ZIP</a></h4>
<div class="paragraph">
<p>This feature makes it possible to download a repository or a folder from the repository as a ZIP file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/zip_repo.png" alt="zip repo">
</div>
<div class="title">Figure 68. Download current repository or project</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/zip_folder.png" alt="zip folder">
</div>
<div class="title">Figure 69. Download a folder</div>
</div>
</div>
<div class="sect3">
<h4 id="_project_editor_permissions"><a class="anchor" href="#_project_editor_permissions"></a><a class="link" href="#_project_editor_permissions">2.21.2. Project Editor permissions</a></h4>
<div class="paragraph">
<p>The ability to configure role-based permissions for the Project Editor have been added.</p>
</div>
<div class="paragraph">
<p>Permissions can be configured using the <code>WEB-INF/classes/workbench-policy.properties</code> file.</p>
</div>
<div class="paragraph">
<p>The following permissions are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Save button</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_save</code></p>
</div>
</li>
<li>
<p>Delete button</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_delete</code></p>
</div>
</li>
<li>
<p>Copy button</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_copy</code></p>
</div>
</li>
<li>
<p>Rename button</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_rename</code></p>
</div>
</li>
<li>
<p>Build &amp; Deploy button</p>
<div class="paragraph">
<p><code>feature.wb_project_authoring_buildAndDeploy</code></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_unify_validation_style_in_guided_decision_table_wizard"><a class="anchor" href="#_unify_validation_style_in_guided_decision_table_wizard"></a><a class="link" href="#_unify_validation_style_in_guided_decision_table_wizard">2.21.3. Unify validation style in Guided Decision Table Wizard.</a></h4>
<div class="paragraph">
<p>All of our new screens use GWT-Bootstrap widgets and alert users to input errors in a consistent way.</p>
</div>
<div class="paragraph">
<p>One of the most noticable differences was the Guided Decision Table Wizard that alerted errors in a way inconsistent with our use of GWT-Bootstrap.</p>
</div>
<div class="paragraph">
<p>This Wizard has been updated to use the new look and feel.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/NewGuidedDecisionTableWizardValidation.png" alt="NewGuidedDecisionTableWizardValidation">
</div>
<div class="title">Figure 70. New Guided Decision Table Wizard validation</div>
</div>
</div>
<div class="sect3">
<h4 id="_improved_wizards"><a class="anchor" href="#_improved_wizards"></a><a class="link" href="#_improved_wizards">2.21.4. Improved Wizards</a></h4>
<div class="paragraph">
<p>During the re-work of the Guided Decision Table’s Wizard to make it’s validation consistent with other areas of the application we took the opportunity to move the Wizard Framework to GWT-Bootstrap too.</p>
</div>
<div class="paragraph">
<p>The resulting appearance is much more pleasing.
We hope to migrate more legacy editors to GWT-Bootstrap as time and priorities permit.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/NewGuidedDecisionTableWizard.png" alt="NewGuidedDecisionTableWizard">
</div>
<div class="title">Figure 71. New Wizard Framework</div>
</div>
</div>
<div class="sect3">
<h4 id="_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates"><a class="anchor" href="#_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates"></a><a class="link" href="#_consistent_behaviour_of_xls_guided_decision_tables_and_guided_templates">2.21.5. Consistent behaviour of XLS, Guided Decision Tables and Guided Templates</a></h4>
<div class="paragraph">
<p>Consistency is a good thing for everybody.
Users can expect different authoring metaphores to produce the same rule behaviour (and developers know when something is a bug!).</p>
</div>
<div class="paragraph">
<p>There were a few inconsistencies in the way XLS Decision Tables, Guidied Decision Tables and Guided Rule Templates generated the underlying rules for empty cells.
These have been eliminated making their operation consistent.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If all constraints have null values (empty cells) the Pattern is not created.</p>
<div class="paragraph">
<p>Should you need the Pattern but no constraints; you will need to include the constraint <code>this != null</code>.</p>
</div>
<div class="paragraph">
<p>This operation is consistent with how XLS and Guided Decision Tables have always worked.</p>
</div>
</li>
<li>
<p>You can define a constraint on a String field for an empty String or white-space by delimiting it with double-quotation marks. The enclosing quotation-marks are removed from the value when generating the rules.</p>
<div class="paragraph">
<p>The use of quotation marks for other String values is not required and they can be omitted.
Their use is however essential to differentiate a constraint for an empty String from an empty cell - in which case the constraint is omitted.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_improved_metadata_tab"><a class="anchor" href="#_improved_metadata_tab"></a><a class="link" href="#_improved_metadata_tab">2.21.6. Improved Metadata Tab</a></h4>
<div class="paragraph">
<p>The Metadata tab provided in previous versions was redesigned to provide a better asset versioning information browsing and recovery.
Now every workbench editor will provide an "Overview tab" that will enable the user to manage the following information.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/ImprovedMetadataWidget.jpg" alt="ImprovedMetadataWidget">
</div>
<div class="title">Figure 72. Improved Metadata Tab</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Versions history</p>
<div class="paragraph">
<p>The versions history shows a tabular view of the asset versions and provides a "Select" button that will enable the user to load a previously created version.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/ImprovedVersionsHistory.jpg" alt="ImprovedVersionsHistory">
</div>
<div class="title">Figure 73. Versions history</div>
</div>
</li>
<li>
<p>Metadata</p>
<div class="paragraph">
<p>The metadata section gets access to additional file attributes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/ImprovedMetadatSection.jpg" alt="ImprovedMetadatSection">
</div>
<div class="title">Figure 74. Metadata section</div>
</div>
</li>
<li>
<p>Comments area</p>
<div class="paragraph">
<p>The redesigned comments area enables much clearer discussions on a file.</p>
</div>
</li>
<li>
<p>Version selection dropdown</p>
<div class="paragraph">
<p>The "Version selector dropdown" located at the menu bar provides the ability to load and restore previous versions from the "Editor tab", without having to open the "Overview tab" to load the "Version history".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/ImprovedVersionsSelector.jpg" alt="ImprovedVersionsSelector">
</div>
<div class="title">Figure 75. Version selection dropdown</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_improved_data_objects_editor"><a class="anchor" href="#_improved_data_objects_editor"></a><a class="link" href="#_improved_data_objects_editor">2.21.7. Improved Data Objects Editor</a></h4>
<div class="paragraph">
<p>The Java editor was unified to the standard workbench editors functioning.
It means that and now every data object is edited on his own editor window.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/NewJavaEditor.png" alt="NewJavaEditor">
</div>
<div class="title">Figure 76. Improved Data Object Editor</div>
</div>
<div class="ulist">
<ul>
<li>
<p>"New → Data Object" option was added to create the data objects.</p>
</li>
<li>
<p>Overview tab was added for every file to manage the file metadata and have access to the file versions history.</p>
</li>
<li>
<p>Editable "Source Tab" tab was added. Now the Java code can be modified by administrators using the workbench.</p>
</li>
<li>
<p>"Editor" - "Source Tab" round trip is provided. This will let administrators to do manual changes on the generated Java code and go back to the editor tab to continue working.</p>
</li>
<li>
<p>Class usages detection. Whenever a Data Object is about to be deleted or renamed, the project will be scanned for the class usages. If usages are found (e.g. in drl files, decision tables, etc.) the user will receive an alert. This will prevent the user from breaking the project build.</p>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/UsagesDetection.png" alt="UsagesDetection">
</div>
<div class="title">Figure 77. Usages detection</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_execution_server_management_ui"><a class="anchor" href="#_execution_server_management_ui"></a><a class="link" href="#_execution_server_management_ui">2.21.8. Execution Server Management UI</a></h4>
<div class="paragraph">
<p>A new perspective called <strong>Management</strong> has been added under <strong>Servers</strong> top level menu.
This perspective provides users the ability to manage multiple execution servers with multiple containers.
Available features includes connect to already deployed execution servers; create new, start, stop, delete or upgrade containers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/NewExecutionServerManagementPerspective.png" alt="NewExecutionServerManagementPerspective">
</div>
<div class="title">Figure 78. Management perspective</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Current version of Execution Server just supports rule based execution.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_social_activities"><a class="anchor" href="#_social_activities"></a><a class="link" href="#_social_activities">2.21.9. Social Activities</a></h4>
<div class="paragraph">
<p>A brand new feature called <strong>Social Activities</strong> has been added under a new top level menu item group called <strong>Activity</strong>.</p>
</div>
<div class="paragraph">
<p>This new feature is divided in two different perspectives: <strong>Timeline Perspective</strong>  and <strong>People Perspective</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong>Timeline Perspective</strong> shows on left side the recent assets created or edited by the logged user.
In the main window there is the "Latest Changes" screen, showing all the recent updated assets and an option to filter the recent updates by repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/TimelinePerspective.png" alt="TimelinePerspective">
</div>
<div class="title">Figure 79. Timeline Perspective</div>
</div>
<div class="paragraph">
<p>The <strong>People Perspective</strong> is the home page of an user.
Showing his infos (including a gravatar picture from user e-mail), user connections (people that user follow) and user recent activities.
There is also a way to edit an user info.
The search suggestion can be used to navigate to a user profile, follow him and see his updates on your timeline.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/PeoplePerspective.png" alt="PeoplePerspective">
</div>
<div class="title">Figure 80. People Perspective</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/PeoplePerspective1.png" alt="PeoplePerspective1">
</div>
<div class="title">Figure 81. Edit User Info</div>
</div>
</div>
<div class="sect3">
<h4 id="_contributors_dashboard"><a class="anchor" href="#_contributors_dashboard"></a><a class="link" href="#_contributors_dashboard">2.21.10. Contributors Dashboard</a></h4>
<div class="paragraph">
<p>A brand new perspective called <strong>Contributors</strong> has been added under a new top level menu item group called <strong>Activity</strong>.
The perspective itself is a dashboard which shows several indicators about the contributions made to the managed organizations / repositories within the workbench.
Every time a organization/repository is added/removed from the workbench the dashboard itself is updated accordingly.</p>
</div>
<div class="paragraph">
<p>This new perspective allows for the monitoring of the underlying activity on the managed repositories.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/ContributorsPerspective.png" alt="ContributorsPerspective">
</div>
<div class="title">Figure 82. Contributors perspective</div>
</div>
</div>
<div class="sect3">
<h4 id="_package_selector"><a class="anchor" href="#_package_selector"></a><a class="link" href="#_package_selector">2.21.11. Package selector</a></h4>
<div class="paragraph">
<p>The location of new assets whilst authoring was driven by the context of the Project Explorer.</p>
</div>
<div class="paragraph">
<p>This has been replaced with a Package Selector in the New Resource Popup.</p>
</div>
<div class="paragraph">
<p>The location defaults to the Project Explorer context but different packages can now be more easily chosen.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/PackageSelector.png" alt="PackageSelector">
</div>
<div class="title">Figure 83. Package selector</div>
</div>
</div>
<div class="sect3">
<h4 id="_improved_visual_consistency"><a class="anchor" href="#_improved_visual_consistency"></a><a class="link" href="#_improved_visual_consistency">2.21.12. Improved visual consistency</a></h4>
<div class="paragraph">
<p>All Popups have been refactored to use GWT-Bootstrap widgets.</p>
</div>
<div class="paragraph">
<p>Whilst a simple change it brings greater visual consistency to the application as a whole.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTableNewPopup.png" alt="GuidedDecisionTableNewPopup">
</div>
<div class="title">Figure 84. Example Guided Decision Table Editor popup</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/GuidedRuleNewPopup.png" alt="GuidedRuleNewPopup">
</div>
<div class="title">Figure 85. Example Guided Rule Editor popup</div>
</div>
</div>
<div class="sect3">
<h4 id="_guided_decision_tree_editor"><a class="anchor" href="#_guided_decision_tree_editor"></a><a class="link" href="#_guided_decision_tree_editor">2.21.13. Guided Decision Tree Editor</a></h4>
<div class="paragraph">
<p>A new editor has been added to support modelling of simple decision trees.</p>
</div>
<div class="paragraph">
<p>See the applicable section within the User Guide for more information about usage.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTree1.png" alt="GuidedDecisionTree1">
</div>
<div class="title">Figure 86. Example Guided Decision Tree</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_repository_wizard"><a class="anchor" href="#_create_repository_wizard"></a><a class="link" href="#_create_repository_wizard">2.21.14. Create Repository Wizard</a></h4>
<div class="paragraph">
<p>A wizard has been created to guide the repository creation process.
Now the user can decide at repository creation time if it should be a managed or unmanaged repository and configure all related parameters.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/CreateRepositoryWizard1.png" alt="CreateRepositoryWizard1">
</div>
<div class="title">Figure 87. Create Repository Wizard 1/2</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/CreateRepositoryWizard2.png" alt="CreateRepositoryWizard2">
</div>
<div class="title">Figure 88. Create Repository Wizard 2/2</div>
</div>
</div>
<div class="sect3">
<h4 id="_repository_structure_screen"><a class="anchor" href="#_repository_structure_screen"></a><a class="link" href="#_repository_structure_screen">2.21.15. Repository Structure Screen</a></h4>
<div class="paragraph">
<p>The new Repository Structure Screen will let users to manage the projects for a given repository, as well as other operations related to managed repositories like: branch creation, assets promotion and project release.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/ManagedRepositoryStructureScreen.png" alt="ManagedRepositoryStructureScreen">
</div>
<div class="title">Figure 89. Repository Structure Screen for a Managed Repository</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/UnManagedRepositoryStructureScreen.png" alt="UnManagedRepositoryStructureScreen">
</div>
<div class="title">Figure 90. Repository Structure Screen for an Unmanaged Repository</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie.releasenotesintegration.6.2.0"><a class="anchor" href="#_kie.releasenotesintegration.6.2.0"></a><a class="link" href="#_kie.releasenotesintegration.6.2.0">2.22. New and Noteworthy in Integration 6.2.0</a></h3>
<div class="sect3">
<h4 id="_kie_execution_server"><a class="anchor" href="#_kie_execution_server"></a><a class="link" href="#_kie_execution_server">2.22.1. KIE Execution Server</a></h4>
<div class="paragraph">
<p>A new KIE Execution Server was created with the goal of supporting the deployment of kjars and the automatic creation of REST endpoints for remote rules execution.
This initial implementation supports provisioning and execution of kjars via REST without any glue code.</p>
</div>
<div class="paragraph">
<p>A user interface was also integrated into the workbench for remote provisioning.
See the workbench’s New&amp;Noteworthy for details.</p>
</div>
<div class="listingblock">
<div class="title">Kie Server interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Path</span>(<span class="hljs-string">"/server"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">KieServer</span> </span>{

    <span class="hljs-annotation">@GET</span>
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">getInfo</span><span class="hljs-params">()</span></span>;

    <span class="hljs-annotation">@POST</span>
    <span class="hljs-annotation">@Consumes</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">execute</span><span class="hljs-params">( CommandScript command )</span></span>;

    <span class="hljs-annotation">@GET</span>
    <span class="hljs-annotation">@Path</span>(<span class="hljs-string">"containers"</span>)
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">listContainers</span><span class="hljs-params">()</span></span>;

    <span class="hljs-annotation">@GET</span>
    <span class="hljs-annotation">@Path</span>(<span class="hljs-string">"containers/{id}"</span>)
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">getContainerInfo</span><span class="hljs-params">( @PathParam(<span class="hljs-string">"id"</span>)</span> String id )</span>;

    <span class="hljs-annotation">@PUT</span>
    <span class="hljs-annotation">@Path</span>(<span class="hljs-string">"containers/{id}"</span>)
    <span class="hljs-annotation">@Consumes</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">createContainer</span><span class="hljs-params">( @PathParam(<span class="hljs-string">"id"</span>)</span> String id, KieContainerResource container )</span>;

    <span class="hljs-annotation">@DELETE</span>
    <span class="hljs-annotation">@Path</span>(<span class="hljs-string">"containers/{id}"</span>)
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">disposeContainer</span><span class="hljs-params">( @PathParam(<span class="hljs-string">"id"</span>)</span> String id )</span>;

    <span class="hljs-annotation">@POST</span>
    <span class="hljs-annotation">@Path</span>(<span class="hljs-string">"containers/{id}"</span>)
    <span class="hljs-annotation">@Consumes</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">execute</span><span class="hljs-params">( @PathParam(<span class="hljs-string">"id"</span>)</span> String id, String cmdPayload )</span>;

    <span class="hljs-annotation">@GET</span>
    <span class="hljs-annotation">@Path</span>(<span class="hljs-string">"containers/{id}/release-id"</span>)
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">getReleaseId</span><span class="hljs-params">( @PathParam(<span class="hljs-string">"id"</span>)</span> String id)</span>;

    <span class="hljs-annotation">@POST</span>
    <span class="hljs-annotation">@Path</span>(<span class="hljs-string">"containers/{id}/release-id"</span>)
    <span class="hljs-annotation">@Consumes</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">updateReleaseId</span><span class="hljs-params">( @PathParam(<span class="hljs-string">"id"</span>)</span> String id, ReleaseId releaseId )</span>;

    <span class="hljs-annotation">@GET</span>
    <span class="hljs-annotation">@Path</span>(<span class="hljs-string">"containers/{id}/scanner"</span>)
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">getScannerInfo</span><span class="hljs-params">( @PathParam(<span class="hljs-string">"id"</span>)</span> String id )</span>;

    <span class="hljs-annotation">@POST</span>
    <span class="hljs-annotation">@Path</span>(<span class="hljs-string">"containers/{id}/scanner"</span>)
    <span class="hljs-annotation">@Consumes</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="hljs-function"><span class="hljs-keyword">public</span> Response <span class="hljs-title">updateScanner</span><span class="hljs-params">( @PathParam(<span class="hljs-string">"id"</span>)</span> String id, KieScannerResource resource )</span>;

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.1.0"><a class="anchor" href="#_drools.releasenotesdrools.6.1.0"></a><a class="link" href="#_drools.releasenotesdrools.6.1.0">2.23. What is New and Noteworthy in Drools 6.1.0</a></h3>
<div class="sect3">
<h4 id="_jmx_support_for_kiescanner"><a class="anchor" href="#_jmx_support_for_kiescanner"></a><a class="link" href="#_jmx_support_for_kiescanner">2.23.1. JMX support for KieScanner</a></h4>
<div class="paragraph">
<p>Added support for JMX monitoring and management on KieScanner and KieContainer.
To enable, set the property <code>kie.scanner.mbeans</code> to <code>enabled</code>, for example via Java command line: <code> -Dkie.scanner.mbeans=enabled </code>.</p>
</div>
<div class="paragraph">
<p>KieScannerMBean will register under the name:</p>
</div>
<div class="paragraph">
<p>It exposes the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Scanner Release Id:</strong> the release ID the scanner was configured with. May include maven range versions and special keywords like LATEST, SNAPSHOT, etc.</p>
</li>
<li>
<p><strong>Current Release Id: </strong>the actual release ID the artifact resolved to.</p>
</li>
<li>
<p><strong>Status:</strong> STARTING, SCANNING, UPDATING, RUNNING, STOPPED, SHUTDOWN</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It also exposes the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>scanNow():</strong> forces an immediate scan of the maven repository looking for artifact updates</p>
</li>
<li>
<p><strong>start():</strong> starts polling the maven repository for artifact updates based on the polling interval parameter</p>
</li>
<li>
<p><strong>stop():</strong> stops automatically polling the maven repository</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.1.0"><a class="anchor" href="#_wb.releasenotesworkbench.6.1.0"></a><a class="link" href="#_wb.releasenotesworkbench.6.1.0">2.24. New and Noteworthy in KIE Workbench 6.1.0</a></h3>
<div class="sect3">
<h4 id="_data_modeler_round_trip_and_source_code_preservation"><a class="anchor" href="#_data_modeler_round_trip_and_source_code_preservation"></a><a class="link" href="#_data_modeler_round_trip_and_source_code_preservation">2.24.1. Data Modeler - round trip and source code preservation</a></h4>
<div class="paragraph">
<p>Full round trip between Data modeler and Java source code is now supported.
No matter where the Java code was generated (e.g.
Eclipse, Data modeller), data modeler will only update the necessary code blocks to maintain the model updated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_modeler_improved_annotations"><a class="anchor" href="#_data_modeler_improved_annotations"></a><a class="link" href="#_data_modeler_improved_annotations">2.24.2. Data Modeler - improved annotations</a></h4>
<div class="paragraph">
<p>New annotations @TypeSafe, @ClassReactive, @PropertyReactive, @Timestamp, @Duration and @Expires were added in order enrich current Drools annotations manged by the data modeler.</p>
</div>
</div>
<div class="sect3">
<h4 id="_standardization_of_the_display_of_tabular_data"><a class="anchor" href="#_standardization_of_the_display_of_tabular_data"></a><a class="link" href="#_standardization_of_the_display_of_tabular_data">2.24.3. Standardization of the display of tabular data</a></h4>
<div class="paragraph">
<p>We have standardized the display of tabular data with a new table widget.</p>
</div>
<div class="paragraph">
<p>The new table supports the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Selection of visible columns</p>
</li>
<li>
<p>Resizable columns</p>
</li>
<li>
<p>Moveable columns</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/new-grid.png" alt="new grid">
</div>
<div class="title">Figure 91. New table</div>
</div>
<div class="paragraph">
<p>The table is used in the following scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inbox (Incoming changes)</p>
</li>
<li>
<p>Inbox (Recently edited)</p>
</li>
<li>
<p>Inbox (Recently opened)</p>
</li>
<li>
<p>Project Problems summary</p>
</li>
<li>
<p>Artifact Repository browser</p>
</li>
<li>
<p>Project Editor Dependency grid</p>
</li>
<li>
<p>Project Editor KSession grid</p>
</li>
<li>
<p>Project Editor Work Item Handlers Configuration grid</p>
</li>
<li>
<p>Project Editor Listeners Configuration grid</p>
</li>
<li>
<p>Search Results grid</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_generation_of_code_modify_x_code_blocks"><a class="anchor" href="#_generation_of_code_modify_x_code_blocks"></a><a class="link" href="#_generation_of_code_modify_x_code_blocks">2.24.4. Generation of <code>modify(x) {…​}</code> blocks</a></h4>
<div class="paragraph">
<p>The Guided Rule Editor, Guided Template Editor and Guided Decision Table Editor have been changed to generate <code>modify(x){…​}</code></p>
</div>
<div class="paragraph">
<p>Historically these editors supported the older <code>update(x)</code> syntax and hence rules created within the Workbench would not respond correctly to <code>@PropertyReactive</code> and associated annotations within a model.
This has now been rectified with the use of <code>modify(x){…​}</code> blocks.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie.releasenoteskie.6.0.0"><a class="anchor" href="#_kie.releasenoteskie.6.0.0"></a><a class="link" href="#_kie.releasenoteskie.6.0.0">2.25. New and Noteworthy in KIE API 6.0.0</a></h3>
<div class="sect3">
<h4 id="_new_kie_name"><a class="anchor" href="#_new_kie_name"></a><a class="link" href="#_new_kie_name">2.25.1. New KIE name</a></h4>
<div class="paragraph">
<p>KIE is the new umbrella name used to group together our related projects; as the family continues to grow.
KIE is also used for the generic parts of unified API; such as building, deploying and loading.
This replaces the kiegroup and knowledge keywords that would have been used before.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/kie.png" alt="kie">
</div>
<div class="title">Figure 92. KIE Anatomy</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven_aligned_projects_and_modules_and_maven_deployment"><a class="anchor" href="#_maven_aligned_projects_and_modules_and_maven_deployment"></a><a class="link" href="#_maven_aligned_projects_and_modules_and_maven_deployment">2.25.2. Maven aligned projects and modules and Maven Deployment</a></h4>
<div class="paragraph">
<p>One of the biggest complaints during the 5.x series was the lack of defined methodology for deployment.
The mechanism used by Drools and jBPM was very flexible, but it was too flexible.
A big focus for 6.0 was streamlining the build, deploy and loading (utilization) aspects of the system.
Building and deploying activities are now aligned with Maven and Maven repositories.
The utilization for loading rules and processess is now convention and configuration oriented, instead of programmatic, with sane defaults to minimise the configuration.</p>
</div>
<div class="paragraph">
<p>Projects can be built with Maven and installed to the local M2_REPO or remote Maven repositories.
Maven is then used to declare and build the classpath of dependencies, for KIE to access.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_and_convention_based_projects"><a class="anchor" href="#_configuration_and_convention_based_projects"></a><a class="link" href="#_configuration_and_convention_based_projects">2.25.3. Configuration and convention based projects</a></h4>
<div class="paragraph">
<p>The 'kmodule.xml' provides declarative configuration for KIE projects.
Conventions and defaults are used to reduce the amount of configuration needed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. Declare KieBases and KieSessions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kmodule</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.drools.org/xsd/kmodule"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase1"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.mypackages"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 11. Utilize the KieSession</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession(<span class="hljs-string">"ksession1"</span>);
kSession.insert(<span class="hljs-keyword">new</span> Message(<span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiebase_inclusion"><a class="anchor" href="#_kiebase_inclusion"></a><a class="link" href="#_kiebase_inclusion">2.25.4. KieBase Inclusion</a></h4>
<div class="paragraph">
<p>It is possible to include all the KIE artifacts belonging to a KieBase into a second KieBase.
This means that the second KieBase, in addition to all the rules, function and processes directly defined into it,  will also contain the ones created in the included KieBase.
This inclusion can be done declaratively in the kmodule.xml file</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. Including a KieBase into another declaratively</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kmodule</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.drools.org/xsd/kmodule"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase2"</span> <span class="hljs-attribute">includes</span>=<span class="hljs-value">"kbase1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession2"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>or programmatically using the <code>KieModuleModel</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 13. Including a KieBase into another programmatically</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieModuleModel kmodule = KieServices.Factory.get().newKieModuleModel();
KieBaseModel kieBaseModel1 = kmodule.newKieBaseModel(<span class="hljs-string">"KBase2"</span>).addInclude(<span class="hljs-string">"KBase1"</span>);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiemodules_kiecontainer_and_kie_ci"><a class="anchor" href="#_kiemodules_kiecontainer_and_kie_ci"></a><a class="link" href="#_kiemodules_kiecontainer_and_kie_ci">2.25.5. KieModules, KieContainer and KIE-CI</a></h4>
<div class="paragraph">
<p>Any Maven produced JAR with a 'kmodule.xml' in it is considered a KieModule.
This can be loaded from the classpath or dynamically at runtime from a Resource location.
If the kie-ci dependency is on the classpath it embeds Maven and all resolving is done automatically using Maven and can access local or remote repositories.
Settings.xml is obeyed for Maven configuration.</p>
</div>
<div class="paragraph">
<p>The KieContainer provides a runtime to utilize the KieModule, versioning is built in throughout, via Maven.
Kie-ci will create a classpath dynamically from all the Maven declared dependencies for the artifact being loaded.
Maven LATEST, SNAPSHOT, RELEASE and version ranges are supported.</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.newKieContainer(
        ks.newReleaseId(<span class="hljs-string">"org.mygroup"</span>, <span class="hljs-string">"myartefact"</span>, <span class="hljs-string">"1.0"</span>) );

KieSession kSession = kContainer.newKieSession(<span class="hljs-string">"ksession1"</span>);
kSession.insert(<span class="hljs-keyword">new</span> Message(<span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>KieContainers can be dynamically updated to a specific version, and resolved through Maven if KIE-CI is on the classpath.
For stateful KieSessions the existing sessions are incrementally updated.</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. Dynamically Update - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieContainer kContainer.updateToVersion(
                ks.newReleaseId(<span class="hljs-string">"org.mygroup"</span>, <span class="hljs-string">"myartefact"</span>, <span class="hljs-string">"1.1"</span>) );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiescanner"><a class="anchor" href="#_kiescanner"></a><a class="link" href="#_kiescanner">2.25.6. KieScanner</a></h4>
<div class="paragraph">
<p>The <code>KieScanner</code> is a Maven-oriented replacement of the KnowledgeAgent present in Drools 5.
It continuously monitors your Maven repository to check if a new release of a Kie project has been installed and if so, deploys it in the <code>KieContainer</code> wrapping that project.
The use of the <code>KieScanner</code> requires kie-ci.jar to be on the classpath.</p>
</div>
<div class="paragraph">
<p>A <code>KieScanner</code> can be registered on a <code>KieContainer</code> as in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 16. Registering and starting a KieScanner on a KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( <span class="hljs-string">"org.acme"</span>, <span class="hljs-string">"myartifact"</span>, <span class="hljs-string">"1.0-SNAPSHOT"</span> );
KieContainer kContainer = kieServices.newKieContainer( releaseId );
KieScanner kScanner = kieServices.newKieScanner( kContainer );

<span class="hljs-comment">// Start the KieScanner polling the Maven repository every 10 seconds</span>
kScanner.start( <span class="hljs-number">10000L</span> );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example the <code>KieScanner</code> is configured to run with a fixed time interval, but it is also possible to run it on demand by invoking the <code>scanNow()</code> method on it.
If the <code>KieScanner</code> finds, in the Maven repository, an updated version of the Kie project used by that <code>KieContainer</code> it automatically downloads the new version and triggers an incremental build of the new project.
From this moment all the new <code>KieBase</code>s and <code>KieSession</code>s created from that <code>KieContainer</code> will use the new project version.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hierarchical_classloader"><a class="anchor" href="#_hierarchical_classloader"></a><a class="link" href="#_hierarchical_classloader">2.25.7. Hierarchical ClassLoader</a></h4>
<div class="paragraph">
<p>The CompositeClassLoader is no longer used; as it was a constant source of performance problems and bugs.
Traditional hierarchical classloaders are now used.
The root classloader is at the KieContext level, with one child ClassLoader per namespace.
This makes it cleaner to add and remove rules, but there can now be no referencing between namespaces in DRL files; i.e.
functions can only be used by the namespaces that declared them.
The recommendation is to use static Java methods in your project, which is visible to all namespaces; but those cannot (like other classes on the root KieContainer ClassLoader) be dynamically updated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_legacy_api_adapter"><a class="anchor" href="#_legacy_api_adapter"></a><a class="link" href="#_legacy_api_adapter">2.25.8. Legacy API Adapter</a></h4>
<div class="paragraph">
<p>The 5.x API for building and running with Drools and jBPM is still available through Maven dependency "knowledge-api-legacy5-adapter". Because the nature of deployment has significantly changed in 6.0, it was not possible to provide an adapter bridge for the KnowledgeAgent.
If any other methods are missing or problematic, please open a JIRA, and we’ll fix for 6.1</p>
</div>
</div>
<div class="sect3">
<h4 id="_kie_documentation"><a class="anchor" href="#_kie_documentation"></a><a class="link" href="#_kie_documentation">2.25.9. KIE Documentation</a></h4>
<div class="paragraph">
<p>While a lot of new documentation has been added for working with the new KIE API, the entire documentation has not yet been brought up to date.
For this reason there will be continued references to old terminologies.
Apologies in advance, and thank you for your patience.
We hope those in the community will work with us to get the documentation updated throughout, for 6.1</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.releasenotesdrools.6.0.0"><a class="anchor" href="#_drools.releasenotesdrools.6.0.0"></a><a class="link" href="#_drools.releasenotesdrools.6.0.0">2.26. What is New and Noteworthy in Drools 6.0.0</a></h3>
<div class="sect3">
<h4 id="_phreak_lazy_rule_matching_algorithm"><a class="anchor" href="#_phreak_lazy_rule_matching_algorithm"></a><a class="link" href="#_phreak_lazy_rule_matching_algorithm">2.26.1. PHREAK - Lazy rule matching algorithm</a></h4>
<div class="paragraph">
<p>The main work done for Drools in 6.0 involves the new PREAK algorithm.
This is a lazy algorithm that should enable Drools to handle a larger number of rules and facts.
AngendaGroups can now help improvement performance, as rules are not evaluated until it attempts to fire them.</p>
</div>
<div class="paragraph">
<p>Sequential mode continues to be supported for PHREAK but now 'modify' is allowed.
While there is no 'inference' with sequential configuration,  as rules are lazily evaluated, any rule not yet evaluated will see the more recent data as a result of 'modify'. This is more inline with how people intuitively think sequential works.</p>
</div>
<div class="paragraph">
<p>The conflict resolution order has been tweaked for PHREAK, and now is ordered by salience and then rule order; based on the rule position in the file.. Prior to Drools 6.0.0, after salience, it was considered arbitrary.
When KieModules and updateToVersion are used for dynamic deployment, the rule order in the file is preserved via the diff processing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_automatically_firing_timed_rule_in_passive_mode"><a class="anchor" href="#_automatically_firing_timed_rule_in_passive_mode"></a><a class="link" href="#_automatically_firing_timed_rule_in_passive_mode">2.26.2. Automatically firing timed rule in passive mode</a></h4>
<div class="paragraph">
<p>When the rule engine runs in passive mode (i.e.: using fireAllRules) by default it doesn’t fire consequences of timed rules unless fireAllRules isn’t invoked again.
Now it is possible to change this default behavior by configuring the KieSession with a <code>TimedRuleExectionOption</code> as shown in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 17. Configuring a KieSession to automatically execute timed rules</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption( TimedRuleExectionOption.YES );
KSession ksession = kbase.newKieSession(ksconf, <span class="hljs-keyword">null</span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is also possible to have a finer grained control on the timed rules that have to be automatically executed.
To do this it is necessary to set a `FILTERED<code>`TimedRuleExectionOption</code> that allows to define a callback to filter those rules, as done in the next example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. Configuring a filter to choose which timed rules should be automatically executed</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( <span class="hljs-keyword">new</span> TimedRuleExectionOption.FILTERED(<span class="hljs-keyword">new</span> TimedRuleExecutionFilter() {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">accept</span><span class="hljs-params">(Rule[] rules)</span> </span>{
        <span class="hljs-keyword">return</span> rules[<span class="hljs-number">0</span>].getName().equals(<span class="hljs-string">"MyRule"</span>);
    }
}) );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expression_timers"><a class="anchor" href="#_expression_timers"></a><a class="link" href="#_expression_timers">2.26.3. Expression Timers</a></h4>
<div class="paragraph">
<p>It is now possible to define both the delay and interval of an interval timer as an expression instead of a fixed value.
To do that it is necessary to declare the timer as an expression one (indicated by "expr:") as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. An Expression Timer Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">declare Bean
    delay   : String = <span class="hljs-string">"30s"</span>
    period  : <span class="hljs-keyword">long</span> = <span class="hljs-number">60000</span>
end

rule <span class="hljs-string">"Expression timer"</span>
    timer( expr: $d, $p )
<span class="hljs-function">when
    <span class="hljs-title">Bean</span><span class="hljs-params">( $d : delay, $p : period )</span>
then
end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The expressions, $d and $p in this case, can use any variable defined in the pattern matching part of the rule and can be any String that can be parsed in a time duration or any numeric value that will be internally converted in a long representing a duration expressed in milliseconds.</p>
</div>
<div class="paragraph">
<p>Both interval and expression timers can have 3 optional parameters named "start", "end" and "repeat-limit". When one or more of these parameters are used the first part of the timer definition must be followed by a semicolon ';' and the parameters have to be separated by a comma ',' as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. An Interval Timer with a start and an end</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer (<span class="hljs-keyword">int</span>: <span class="hljs-number">30</span>s <span class="hljs-number">10</span>s; start=<span class="hljs-number">3</span>-JAN-<span class="hljs-number">2010</span>, end=<span class="hljs-number">5</span>-JAN-<span class="hljs-number">2010</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The value for start and end parameters can be a Date, a String representing a Date or a long, or more in general any Number, that will be transformed in a Java Date applying the following conversion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">new</span> Date( ((Number) n).longValue() )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Conversely the repeat-limit can be only an integer and it defines the maximum number of repetitions allowed by the timer.
If both the end and the repeat-limit parameters are set the timer will stop when the first of the two will be matched.</p>
</div>
<div class="paragraph">
<p>The using of the start parameter implies the definition of a phase for the timer, where the beginning of the phase is given by the start itself plus the eventual delay.
In other words in this case the timed rule will then be scheduled at times:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">start + delay + n*period</code></pre>
</div>
</div>
<div class="paragraph">
<p>for up to repeat-limit times and no later than the end timestamp (whichever first). For instance the rule having the following interval timer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer ( <span class="hljs-keyword">int</span>: <span class="hljs-number">30</span>s <span class="hljs-number">1</span>m; start=<span class="hljs-string">"3-JAN-2010"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be scheduled at the 30th second of every minute after the midnight of the 3-JAN-2010.
This also means that if for example you turn the system on at midnight of the 3-FEB-2010 it won’t be scheduled immediately but will preserve the phase defined by the timer and so it will be scheduled for the first time 30 seconds after the midnight.
If for some reason the system is paused (e.g.
the session is serialized and then deserialized after a while) the rule will be scheduled only once to recover from missing activations (regardless of how many activations we missed) and subsequently it will be scheduled again in phase with the timer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ruleflowgroups_and_agendagroups_are_merged"><a class="anchor" href="#_ruleflowgroups_and_agendagroups_are_merged"></a><a class="link" href="#_ruleflowgroups_and_agendagroups_are_merged">2.26.4. RuleFlowGroups and AgendaGroups are merged</a></h4>
<div class="paragraph">
<p>These two groups have been merged and now RuleFlowGroups behave the same as AgendaGroups.
The get methods have been left, for deprecation reasons, but both return the same underlying data.
When jBPM activates a group it now just calls setFocus.
RuleFlowGroups and AgendaGroups when used together was a continued source of errors.
It also aligns the codebase, towards PHREAK and the multi-core explotation that is planned in the future.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.releasenotesworkbench.6.0.0"><a class="anchor" href="#_wb.releasenotesworkbench.6.0.0"></a><a class="link" href="#_wb.releasenotesworkbench.6.0.0">2.27. New and Noteworthy in KIE Workbench 6.0.0</a></h3>
<div class="paragraph">
<p>The workbench has had a big overhaul using a new base project called UberFire.
UberFire is inspired by Eclipse and provides a clean, extensible and flexible framework for the workbench.
The end result is not only a richer experience for our end users, but we can now develop more rapidly with a clean component based architecture.
If you like he Workbench experience you can use UberFire today to build your own web based dashboard and console efforts.</p>
</div>
<div class="paragraph">
<p>As well as the move to a UberFire the other biggest change is the move from JCR to Git; there is an utility project to help with migration.
Git is the most scalable and powerful source repository bar none.
JGit provides a solid OSS implementation for Git.
This addresses the continued performance problems with the various JCR implementations, which would slow down once the number of files and number of versions become too high.
There has been a big "low tech" drive, to remove complexity.
Everything is now stored as a file, including meta data.
The database is only there to provide fast indexing and search.
So importing and exporting is all standard Git and external sites, like GitHub, can be used to exchange repositories.</p>
</div>
<div class="paragraph">
<p>In 5.x developers would work with their own source repository and then push JCR, via the team provider.
This team provider was not full featured and not available outside Eclipse.
Git enables our repository to work any existing Git tool or team provider.
While not yet supported in the UI,  this will be added over time, it is possible to connect to the repo and tag and branch and restore things.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/kie-drools-wb.png" alt="kie drools wb">
</div>
<div class="title">Figure 93. Workbench</div>
</div>
<div class="paragraph">
<p>The Guvnor brand leaked too much from its intended role; such as the authoring metaphors, like Decision Tables, being considered Guvnor components instead of Drools components.
This wasn’t helped by the monolithic projects structure used in 5.x for Guvnor.
In 6.0 Guvnor 's focus has been narrowed to encapsulates the set of UberFire plugins that provide the basis for building a web based IDE.
Such as Maven integration for building and deploying, management of Maven repositories and activity notifications via inboxes.
Drools and jBPM build workbench distributions using Uberfire as the base and including a set of plugins, such as Guvnor, along with their own plugins for things like decision tables, guided editors, BPMN2 designer, human tasks.</p>
</div>
<div class="paragraph">
<p>The "Model Structure" diagram outlines the new project anatomy.
The Drools workbench is called KIE-Drools-WB.
KIE-WB is the uber workbench that combines all the Guvnor, Drools and jBPM plugins.
The jBPM-WB is ghosted out, as it doesn’t actually exist, being made redundant by KIE-WB.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/kie-structure.png" alt="kie structure">
</div>
<div class="title">Figure 94. Module Structure</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>KIE Drools Workbench and KIE Workbench share a common set of components for generic workbench functionality such as Project navigation, Project definitions, Maven based Projects, Maven Artifact Repository.
These common features are described in more detail throughout this documentation.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The two primary distributions consist of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KIE Drools Workbench</p>
<div class="ulist">
<ul>
<li>
<p>Drools Editors, for rules and supporting assets.</p>
</li>
<li>
<p>jBPM Designer, for Rule Flow and supporting assets.</p>
</li>
</ul>
</div>
</li>
<li>
<p>KIE Workbench</p>
<div class="ulist">
<ul>
<li>
<p>Drools Editors, for rules and supporting assets.</p>
</li>
<li>
<p>jBPM Designer, for BPMN2 and supporting assets.</p>
</li>
<li>
<p>jBPM Console, runtime and Human Task support.</p>
</li>
<li>
<p>jBPM Form Builder.</p>
</li>
<li>
<p>BAM.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Workbench highlights:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New flexible Workbench environment, with perspectives and panels.</p>
</li>
<li>
<p>New packaging and build system following KIE API.</p>
<div class="ulist">
<ul>
<li>
<p>Maven based projects.</p>
</li>
<li>
<p>Maven Artifact Repository replaces Global Area, with full dependency support.</p>
</li>
</ul>
</div>
</li>
<li>
<p>New Data Modeller replaces the declarative Fact Model Editor; bringing authoring of Java classes to the authoring environment. Java classes are packaged into the project and can be used within rules, processes etc and externally in your own applications.</p>
</li>
<li>
<p>Virtual File System replaces JCR with a default Git based implementation.</p>
<div class="ulist">
<ul>
<li>
<p>Default Git based implementation supports remote operations.</p>
</li>
<li>
<p>External modifications appear within the Workbench.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Incremental Build system showing, near real-time validation results of your project and assets.</p>
<div class="literalblock">
<div class="content">
<pre>The editors themselves are largely unchanged; however of note imports have moved from the package definition to individual editors so you need only import types used for an asset and not the package as a whole.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kie.releasenotesintegration.6.0.0"><a class="anchor" href="#_kie.releasenotesintegration.6.0.0"></a><a class="link" href="#_kie.releasenotesintegration.6.0.0">2.28. New and Noteworthy in Integration 6.0.0</a></h3>
<div class="sect3">
<h4 id="_cdi"><a class="anchor" href="#_cdi"></a><a class="link" href="#_cdi">2.28.1. CDI</a></h4>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"kbase1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, rtifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieBase kbase1v10;

<span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KBase</span>(<span class="hljs-string">"kbase1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, rtifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieBase kbase1v10;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, rtifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieSession ksessionv10;

<span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, rtifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieSession ksessionv11;</code></pre>
</div>
</div>
<div class="paragraph">
<p>CDI is now tightly integrated into the KIE API.
It can be used to inject versioned KieSession and KieBases.</p>
</div>
</div>
<div class="sect3">
<h4 id="_spring"><a class="anchor" href="#_spring"></a><a class="link" href="#_spring">2.28.2. Spring</a></h4>
<div class="paragraph">
<p>Spring has been revamped and now integrated with KIE.
Spring can replace the 'kmodule.xml' with a more powerful spring version.
The aim is for consistency with kmodule.xml</p>
</div>
</div>
<div class="sect3">
<h4 id="_aries_blueprints"><a class="anchor" href="#_aries_blueprints"></a><a class="link" href="#_aries_blueprints">2.28.3. Aries Blueprints</a></h4>
<div class="paragraph">
<p>Aries blueprints is now also supported, and follows the work done for spring.
The aim is for consistency with spring and kmodule.xml</p>
</div>
</div>
<div class="sect3">
<h4 id="_osgi_ready"><a class="anchor" href="#_osgi_ready"></a><a class="link" href="#_osgi_ready">2.28.4. OSGi Ready</a></h4>
<div class="paragraph">
<p>All modules have been refactored to avoid package splitting, which was a problem in 5.x.
Testing has been moved to PAX.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compatibilitymatrix"><a class="anchor" href="#_compatibilitymatrix"></a><a class="link" href="#_compatibilitymatrix">3. Compatibility matrix</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting from KIE 6.0, Drools (including workbench), jBPM (including designer and console) and OptaPlanner follow the same version numbering.</p>
</div>
<h1 id="_kie" class="discrete">KIE</h1>
<div class="paragraph">
<p>KIE is the shared core for Drools and jBPM. It provides a unified methodology and programming model for
building, deploying and utilizing resources.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kiechapter"><a class="anchor" href="#_kiechapter"></a><a class="link" href="#_kiechapter">4. KIE</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kieoverviewsection"><a class="anchor" href="#_kieoverviewsection"></a><a class="link" href="#_kieoverviewsection">4.1. Overview</a></h3>
<div class="sect3">
<h4 id="_kieanatomysection"><a class="anchor" href="#_kieanatomysection"></a><a class="link" href="#_kieanatomysection">4.1.1. Anatomy of Projects</a></h4>
<div class="paragraph">
<p>The process of researching an integration knowledge solution for Drools and jBPM has simply used the "kiegroup" group name.
This name permeates GitHub accounts and Maven POMs.
As scopes broadened and new projects were spun KIE, an acronym for Knowledge Is Everything, was chosen as the new group name.
The KIE name is also used for the shared aspects of the system; such as the unified build, deploy and utilization.</p>
</div>
<div class="paragraph">
<p>KIE currently consists of the following subprojects:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/kie.png" alt="kie">
</div>
<div class="title">Figure 95. KIE Anatomy</div>
</div>
<div class="paragraph">
<p>OptaPlanner, a local search and optimization tool, has been spun off from Drools Planner and is now a top level project with Drools and jBPM.
This was a natural evolution as Optaplanner, while having strong Drools integration, has long been independant of Drools.</p>
</div>
<div class="paragraph">
<p>From the Polymita acquisition, along with other things, comes the powerful Dashboard Builder which provides powerful reporting capabilities.
Dashboard Builder is currently a temporary name and after the 6.0 release a new name will be chosen.
Dashboard Builder is completely independant of Drools and jBPM and will be used by many projects at JBoss, and hopefully outside of JBoss :)</p>
</div>
<div class="paragraph">
<p>UberFire is the new base workbench project, spun off from the ground up rewrite.
UberFire provides Eclipse-like workbench capabilities, with panels and pages from plugins.
The project is independant of Drools and jBPM and anyone can use it as a basis of building flexible and powerful workbenches.
UberFire will be used for console and workbench development throughout JBoss.</p>
</div>
<div class="paragraph">
<p>It was determined that the Guvnor brand leaked too much from its intended role; such as the authoring metaphors, like Decision Tables, being considered Guvnor components instead of Drools components.
This wasn’t helped by the monolithic projects structure used in 5.x for Guvnor.
In 6.0 Guvnor’s focus has been narrowed to encapsulate the set of UberFire plugins that provide the basis for building a web based IDE.
Such as Maven integration for building and deploying, management of Maven repositories and activity notifications via inboxes.
Drools and jBPM build workbench distributions using Uberfire as the base and including a set of plugins, such as Guvnor, along with their own plugins for things like decision tables, guided editors, BPMN2 designer, human tasks.
The Drools workbench is called Drools-WB.
KIE-WB is the uber workbench that combined all the Guvnor, Drools and jBPM plugins.
The jBPM-WB is ghosted out, as it doesn’t actually exist, being made redundant by KIE-WB.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kielifecyclessection"><a class="anchor" href="#_kielifecyclessection"></a><a class="link" href="#_kielifecyclessection">4.1.2. Lifecycles</a></h4>
<div class="paragraph">
<p>The different aspects, or life cycles, of working with KIE system, whether it’s Drools or jBPM, can typically be broken down into the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Author</strong></p>
<div class="ulist">
<ul>
<li>
<p>Authoring of knowledge using a UI metaphor, such as: DRL, BPMN2, decision table, class models.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Build</strong></p>
<div class="ulist">
<ul>
<li>
<p>Builds the authored knowledge into deployable units.</p>
</li>
<li>
<p>For KIE this unit is a JAR.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Test</strong></p>
<div class="ulist">
<ul>
<li>
<p>Test KIE knowedge before it’s deployed to the application.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Deploy</strong></p>
<div class="ulist">
<ul>
<li>
<p>Deploys the unit to a location where applications may utilize (consume) them.</p>
</li>
<li>
<p>KIE uses Maven style repository.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Utilize</strong></p>
<div class="ulist">
<ul>
<li>
<p>The loading of a JAR to provide a KIE session (KieSession), for which the application can interact with.</p>
</li>
<li>
<p>KIE exposes the JAR at runtime via a KIE container (KieContainer).</p>
</li>
<li>
<p>KieSessions, for the runtime’s to interact with, are created from the KieContainer.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Run</strong></p>
<div class="ulist">
<ul>
<li>
<p>System interaction with the KieSession, via API.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Work</strong></p>
<div class="ulist">
<ul>
<li>
<p>User interaction with the KieSession, via command line or UI.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Manage</strong></p>
<div class="ulist">
<ul>
<li>
<p>Manage any KieSession or KieContainer.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_builddeployutilizeandrunsection"><a class="anchor" href="#_builddeployutilizeandrunsection"></a><a class="link" href="#_builddeployutilizeandrunsection">4.2. Build, Deploy, Utilize and Run</a></h3>
<div class="sect3">
<h4 id="_kiemoduleintroductionbuildingintroductionsection"><a class="anchor" href="#_kiemoduleintroductionbuildingintroductionsection"></a><a class="link" href="#_kiemoduleintroductionbuildingintroductionsection">4.2.1. Introduction</a></h4>
<div class="paragraph">
<p>6.0 introduces a new configuration and convention approach to building knowledge bases, instead of using the programmatic builder approach in 5.x.
The builder is still available to fall back on, as it’s used for the tooling integration.</p>
</div>
<div class="paragraph">
<p>Building now uses Maven, and aligns with Maven practices.
A KIE project or module is simply a Maven Java project or module; with an additional metadata file META-INF/kmodule.xml.
The kmodule.xml file is the descriptor that selects resources to knowledge bases and configures those knowledge bases and sessions.
There is also alternative XML support via Spring and OSGi BluePrints.</p>
</div>
<div class="paragraph">
<p>While standard Maven can build and package KIE resources, it will not provide validation at build time.
There is a Maven plugin which is recommended to use to get build time validation.
The plugin also generates many classes, making the runtime loading faster too.</p>
</div>
<div class="paragraph">
<p>The example project layout and Maven POM descriptor is illustrated in the screenshot</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/defaultkiesession.png" alt="defaultkiesession">
</div>
<div class="title">Figure 96. Example project layout and Maven POM</div>
</div>
<div class="paragraph">
<p>KIE uses defaults to minimise the amount of configuration.
With an empty kmodule.xml being the simplest configuration.
There must always be a kmodule.xml file, even if empty, as it’s used for discovery of the JAR and its contents.</p>
</div>
<div class="paragraph">
<p>Maven can either 'mvn install' to deploy a KieModule to the local machine, where all other applications on the local machine use it.
Or it can 'mvn deploy' to push the KieModule to a remote Maven repository.
Building the Application will pull in the KieModule and populate the local Maven repository in the process.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/maven.png" alt="maven">
</div>
<div class="title">Figure 97. Example project layout and Maven POM</div>
</div>
<div class="paragraph">
<p>JARs can be deployed in one of two ways.
Either added to the classpath, like any other JAR in a Maven dependency listing, or they can be dynamically loaded at runtime.
KIE will scan the classpath to find all the JARs with a kmodule.xml in it.
Each found JAR is represented by the KieModule interface.
The terms classpath KieModule and dynamic KieModule are used to refer to the two loading approaches.
While dynamic modules supports side by side versioning, classpath modules do not.
Further once a module is on the classpath, no other version may be loaded dynamically.</p>
</div>
<div class="paragraph">
<p>Detailed references for the API are included in the next sections, the impatient can jump straight to the examples section, which is fairly self-explanatory on the different use cases.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiebuildingsection"><a class="anchor" href="#_kiebuildingsection"></a><a class="link" href="#_kiebuildingsection">4.2.2. Building</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/builder.png" alt="builder">
</div>
<div class="title">Figure 98. org.kie.api.core.builder</div>
</div>
<div class="sect4">
<h5 id="_creatingandbuildingakieproject"><a class="anchor" href="#_creatingandbuildingakieproject"></a><a class="link" href="#_creatingandbuildingakieproject">4.2.2.1. Creating and building a Kie Project</a></h5>
<div class="paragraph">
<p>A Kie Project has the structure of a normal Maven project with the only peculiarity of including a kmodule.xml file defining in a declaratively way the <code>KieBase</code>s and <code>KieSession</code>s that can be created from it.
This file has to be placed in the resources/META-INF folder of the Maven project while all the other Kie artifacts, such as DRL or a Excel files, must be stored in the resources folder or in any other subfolder under it.</p>
</div>
<div class="paragraph">
<p>Since meaningful defaults have been provided for all configuration aspects, the simplest kmodule.xml file can contain just an empty kmodule tag like the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. An empty kmodule.xml file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">kmodule</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.drools.org/xsd/kmodule"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this way the kmodule will contain one single default <code>KieBase</code>.
All Kie assets stored under the resources folder, or any of its subfolders, will be compiled and added to it.
To trigger the building of these artifacts it is enough to create a <code>KieContainer</code> for them.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieContainer.png" alt="KieContainer">
</div>
<div class="title">Figure 99. KieContainer</div>
</div>
<div class="paragraph">
<p>For this simple case it is enough to create a <code>KieContainer</code> that reads the files to be built from the classpath:</p>
</div>
<div class="exampleblock">
<div class="title">Example 22. Creating a KieContainer from the classpath</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>`
KieServices` is the interface from where it possible to access all the Kie building and runtime facilities:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieServices.png" alt="KieServices">
</div>
<div class="title">Figure 100. KieServices</div>
</div>
<div class="paragraph">
<p>In this way all the Java sources and the Kie resources are compiled and deployed into the KieContainer which makes its contents available for use at runtime.</p>
</div>
</div>
<div class="sect4">
<h5 id="_thekmodulexmlfile"><a class="anchor" href="#_thekmodulexmlfile"></a><a class="link" href="#_thekmodulexmlfile">4.2.2.2. The kmodule.xml file</a></h5>
<div class="paragraph">
<p>As explained in the former section, the kmodule.xml file is the place where it is possible to declaratively configure the <code>KieBase</code>(s) and <code>KieSession</code>(s) that can be created from a KIE project.</p>
</div>
<div class="paragraph">
<p>In particular a <code>KieBase</code> is a repository of all the application’s knowledge definitions.
It will contain rules, processes, functions, and type models.
The <code>KieBase</code> itself does not contain data; instead, sessions are created from the <code>KieBase</code> into which data can be inserted and from which process instances may be started.
Creating the <code>KieBase</code> can be heavy, whereas session creation is very light, so it is recommended that <code>KieBase</code> be cached where possible to allow for repeated session creation.
However end-users usually shouldn’t worry about it, because this caching mechanism is already automatically provided by the <code>KieContainer</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieBase.png" alt="KieBase">
</div>
<div class="title">Figure 101. KieBase</div>
</div>
<div class="paragraph">
<p>Conversely the <code>KieSession</code> stores and executes on the runtime data.
It is created from the <code>KieBase</code> or more easily can be created directly from the <code>KieContainer</code> if it has been defined in the kmodule.xml file</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieSession.png" alt="KieSession">
</div>
<div class="title">Figure 102. KieSession</div>
</div>
<div class="paragraph">
<p>The kmodule.xml allows to define and configure one or more <code>KieBase</code>s and for each <code>KieBase</code> all the different <code>KieSession</code>s that can be created from it, as showed by the follwing example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 23. A sample kmodule.xml file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kmodule</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.drools.org/xsd/kmodule"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"drools.evaluator.supersetOf"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"org.mycompany.SupersetOfEvaluatorDefinition"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"KBase1"</span> <span class="hljs-attribute">default</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">eventProcessingMode</span>=<span class="hljs-value">"cloud"</span> <span class="hljs-attribute">equalsBehavior</span>=<span class="hljs-value">"equality"</span> <span class="hljs-attribute">declarativeAgenda</span>=<span class="hljs-value">"enabled"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.domain.pkg1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"KSession2_1"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateful"</span> <span class="hljs-attribute">default</span>=<span class="hljs-value">"true"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"KSession2_2"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateless"</span> <span class="hljs-attribute">default</span>=<span class="hljs-value">"false"</span> <span class="hljs-attribute">beliefSystem</span>=<span class="hljs-value">"jtms"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"KBase2"</span> <span class="hljs-attribute">default</span>=<span class="hljs-value">"false"</span> <span class="hljs-attribute">eventProcessingMode</span>=<span class="hljs-value">"stream"</span> <span class="hljs-attribute">equalsBehavior</span>=<span class="hljs-value">"equality"</span> <span class="hljs-attribute">declarativeAgenda</span>=<span class="hljs-value">"enabled"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.domain.pkg2, org.domain.pkg3"</span> <span class="hljs-attribute">includes</span>=<span class="hljs-value">"KBase1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"KSession3_1"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateful"</span> <span class="hljs-attribute">default</span>=<span class="hljs-value">"false"</span> <span class="hljs-attribute">clockType</span>=<span class="hljs-value">"realtime"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">fileLogger</span> <span class="hljs-attribute">file</span>=<span class="hljs-value">"drools.log"</span> <span class="hljs-attribute">threaded</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">interval</span>=<span class="hljs-value">"10"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">workItemHandlers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">workItemHandler</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"name"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"org.domain.WorkItemHandler"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">workItemHandlers</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">listeners</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ruleRuntimeEventListener</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"org.domain.RuleRuntimeListener"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">agendaEventListener</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"org.domain.FirstAgendaListener"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">agendaEventListener</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"org.domain.SecondAgendaListener"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">processEventListener</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"org.domain.ProcessListener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">listeners</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here the
tag contains a list of key-value pairs that are the optional properties used to configure the <code>KieBase</code>s building process.
For instance this sample kmodule.xml file defines an additional custom operator named <code>supersetOf</code> and implemented by the <code>org.mycompany.SupersetOfEvaluatorDefinition</code> class.</p>
</div>
<div class="paragraph">
<p>After this 2 <code>KieBase</code>s have been defined and it is possible to instance 2 different types of <code>KieSession</code>s from the first one, while only one from the second.
A list of the attributes that can be defined on the kbase tag, together with their meaning and default values follows:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. kbase Attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Admitted values</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name with which retrieve this KieBase from the KieContainer.
            This is the only mandatory attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any comma separated list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of other KieBases contained in this kmodule.
            The artifacts of all these KieBases will be also included in this one.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any comma separated list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default all the Drools artifacts under the resources folder,
            at any level, are included into the KieBase. This attribute allows to limit
            the artifacts that will be compiled in this KieBase to only the ones
            belonging to the list of packages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true, false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if this KieBase is the default one for this module, so
            it can be created from the KieContainer without passing any name to it.
            There can be at most one default KieBase in each module.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">equalsBehavior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">identity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">identity, equality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the behavior of Drools when a new fact is inserted into the
            Working Memory. With identity it always create a new FactHandle unless the same
            object isn’t already present in the Working Memory, while with equality only if
            the newly inserted object is not equal (according to its equal method) to an already
            existing fact.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eventProcessingMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cloud, stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When compiled in cloud mode the KieBase treats events as normal facts, while
            in stream mode allow temporal reasoning on them.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">declarativeAgenda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled, enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if the Declarative Agenda is enabled or not.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Similarly all attributes of the ksession tag (except of course the name) have meaningful default.
They are listed and described in the following table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. ksession Attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute name</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Admitted values</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique name of this KieSession. Used to fetch the KieSession from the KieContainer.
            This is the only mandatory attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stateful</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stateful, stateless</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A stateful session allows to iteratively work with the Working Memory,
            while a stateless one is a one-off execution of a Working Memory with a provided data set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true, false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if this KieSession is the default one for this module, so
            it can be created from the KieContainer without passing any name to it.
            In each module there can be at most one default KieSession for each type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clockType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">realtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">realtime, pseudo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if events timestamps are determined by the system clock or by
            a psuedo clock controlled by the application. This clock is specially useful for
            unit testing temporal rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">beliefSystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simple, jtms, defeasible</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the type of belief system used by the KieSession.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As outlined in the former kmodule.xml sample, it is also possible to declaratively create on each <code>KieSession</code> a file (or a console) logger, one or more <code>WorkItemHandler</code>s and some listeners that can be of 3 different types: ruleRuntimeEventListener, agendaEventListener and processEventListener</p>
</div>
<div class="paragraph">
<p>Having defined a kmodule.xml like the one in the former sample, it is now possible to simply retrieve the KieBases and KieSessions from the KieContainer using their names.</p>
</div>
<div class="exampleblock">
<div class="title">Example 24. Retriving KieBases and KieSessions from the KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();

KieBase kBase1 = kContainer.getKieBase(<span class="hljs-string">"KBase1"</span>);
KieSession kieSession1 = kContainer.newKieSession(<span class="hljs-string">"KSession2_1"</span>);
StatelessKieSession kieSession2 = kContainer.newStatelessKieSession(<span class="hljs-string">"KSession2_2"</span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It has to be noted that since KSession2_1 and KSession2_2 are of 2 different types (the first is stateful, while the second is stateless) it is necessary to invoke 2 different methods on the <code>KieContainer</code> according to their declared type.
If the type of the <code>KieSession</code> requested to the <code>KieContainer</code> doesn’t correspond with the one declared in the kmodule.xml file the <code>KieContainer</code> will throw a <code>RuntimeException</code>.
Also since a <code>KieBase</code> and a <code>KieSession</code> have been flagged as default is it possible to get them from the <code>KieContainer</code> without passing any name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. Retriving default KieBases and KieSessions from the KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieContainer kContainer = ...

KieBase kBase1 = kContainer.getKieBase(); <span class="hljs-comment">// returns KBase1</span>
KieSession kieSession1 = kContainer.newKieSession(); <span class="hljs-comment">// returns KSession2_1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Since a Kie project is also a Maven project the groupId, artifactId and version declared in the pom.xml file are used to generate a <code>ReleaseId</code> that uniquely identifies this project inside your application.
This allows creation of a new KieContainer from the project by simply passing its <code>ReleaseId</code> to the <code>KieServices</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 26. Creating a KieContainer of an existing project by ReleaseId</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( <span class="hljs-string">"org.acme"</span>, <span class="hljs-string">"myartifact"</span>, <span class="hljs-string">"1.0"</span> );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_buildingwithmaven"><a class="anchor" href="#_buildingwithmaven"></a><a class="link" href="#_buildingwithmaven">4.2.2.3. Building with Maven</a></h5>
<div class="paragraph">
<p>The KIE plugin for Maven ensures that artifact resources are validated and pre-compiled, it is recommended that this is used at all times.
To use the plugin simply add it to the build section of the Maven pom.xml and activate it by using packaging <code>kjar</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 27. Adding the KIE plugin to a Maven pom.xml and activating it</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  <span class="hljs-tag">&lt;<span class="hljs-title">packaging</span>&gt;</span>kjar<span class="hljs-tag">&lt;/<span class="hljs-title">packaging</span>&gt;</span>
  ...
  <span class="hljs-tag">&lt;<span class="hljs-title">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">plugins</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>7.7.0.Final<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">extensions</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">extensions</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">plugins</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">build</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The plugin comes with support for all the Drools/jBPM knowledge resources.
However, in case you are using specific KIE annotations in your Java classes, like for example <code>@kie.api.Position</code>, you will need to add compile time dependency on <code>kie-api</code> into your project.
We recommend to use the provided scope for all the additional KIE dependencies.
That way the kjar stays as lightweight as possible, and not dependant on any particular KIE version.</p>
</div>
<div class="paragraph">
<p>Building a KIE module without the Maven plugin will copy all the resources, as is, into the resulting JAR.
When that JAR is loaded by the runtime, it will attempt to build all the resources then.
If there are compilation issues it will return a null KieContainer.
It also pushes the compilation overhead to the runtime.
In general this is not recommended, and the Maven plugin should always be used.</p>
</div>
</div>
<div class="sect4">
<h5 id="_definingakiemoduleprogrammatically"><a class="anchor" href="#_definingakiemoduleprogrammatically"></a><a class="link" href="#_definingakiemoduleprogrammatically">4.2.2.4. Defining a KieModule programmatically</a></h5>
<div class="paragraph">
<p>It is also possible to define the <code>KieBase</code>s and <code>KieSession</code>s belonging to a KieModule programmatically instead of the declarative definition in the kmodule.xml file.
The same programmatic API also allows in explicitly adding the file containing the Kie artifacts instead of automatically read them from the resources folder of your project.
To do that it is necessary to create a <code>KieFileSystem</code>, a sort of virtual file system, and add all the resources contained in your project to it.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieFileSystem.png" alt="KieFileSystem">
</div>
<div class="title">Figure 103. KieFileSystem</div>
</div>
<div class="paragraph">
<p>Like all other Kie core components you can obtain an instance of the <code>KieFileSystem</code> from the <code>KieServices</code>.
The kmodule.xml configuration file must be added to the filesystem.
This is a mandatory step.
Kie also provides a convenient fluent API, implemented by the <code>KieModuleModel</code>, to programmatically create this file.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieModuleModel.png" alt="KieModuleModel">
</div>
<div class="title">Figure 104. KieModuleModel</div>
</div>
<div class="paragraph">
<p>To do this in practice it is necessary to create a <code>KieModuleModel</code> from the <code>KieServices</code>, configure it with the desired <code>KieBase</code>s and <code>KieSession</code>s, convert it in XML and add the XML to the <code>KieFileSystem</code>.
This process is shown by the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 28. Creating a kmodule.xml programmatically and adding it to a KieFileSystem</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieModuleModel kieModuleModel = kieServices.newKieModuleModel();

KieBaseModel kieBaseModel1 = kieModuleModel.newKieBaseModel( <span class="hljs-string">"KBase1 "</span>)
        .setDefault( <span class="hljs-keyword">true</span> )
        .setEqualsBehavior( EqualityBehaviorOption.EQUALITY )
        .setEventProcessingMode( EventProcessingOption.STREAM );

KieSessionModel ksessionModel1 = kieBaseModel1.newKieSessionModel( <span class="hljs-string">"KSession1"</span> )
        .setDefault( <span class="hljs-keyword">true</span> )
        .setType( KieSessionModel.KieSessionType.STATEFUL )
        .setClockType( ClockTypeOption.get(<span class="hljs-string">"realtime"</span>) );

KieFileSystem kfs = kieServices.newKieFileSystem();
kfs.writeKModuleXML(kieModuleModel.toXML());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this point it is also necessary to add to the <code>KieFileSystem</code>, through its fluent API, all others Kie artifacts composing your project.
These artifacts have to be added in the same position of a corresponding usual Maven project.</p>
</div>
<div class="exampleblock">
<div class="title">Example 29. Adding Kie artifacts to a KieFileSystem</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieFileSystem kfs = ...
kfs.write( <span class="hljs-string">"src/main/resources/KBase1/ruleSet1.drl"</span>, stringContainingAValidDRL )
        .write( <span class="hljs-string">"src/main/resources/dtable.xls"</span>,
                kieServices.getResources().newInputStreamResource( dtableFileStream ) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example shows that it is possible to add the Kie artifacts both as plain Strings and as <code>Resource</code>s.
In the latter case the <code>Resource</code>s can be created by the <code>KieResources</code> factory, also provided by the <code>KieServices</code>.
The <code>KieResources</code> provides many convenient factory methods to convert an <code>InputStream</code>, a <code>URL</code>, a <code>File</code>, or a <code>String</code> representing a path of your file system to a <code>Resource</code> that can be managed by the <code>KieFileSystem</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieResources.png" alt="KieResources">
</div>
<div class="title">Figure 105. KieResources</div>
</div>
<div class="paragraph">
<p>Normally the type of a <code>Resource</code> can be inferred from the extension of the name used to add it to the <code>KieFileSystem</code>.
However it also possible to not follow the Kie conventions about file extensions and explicitly assign a specific <code>ResourceType</code> to a <code>Resource</code> as shown below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 30. Creating and adding a Resource with an explicit type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieFileSystem kfs = ...
kfs.write( <span class="hljs-string">"src/main/resources/myDrl.txt"</span>,
           kieServices.getResources().newInputStreamResource( drlStream )
                      .setResourceType(ResourceType.DRL) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Add all the resources to the <code>KieFileSystem</code> and build it by passing the <code>KieFileSystem</code> to a <code>KieBuilder</code></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieBuilder.png" alt="KieBuilder">
</div>
<div class="title">Figure 106. KieBuilder</div>
</div>
<div class="paragraph">
<p>When the contents of a <code>KieFileSystem</code> are successfully built, the resulting <code>KieModule</code> is automatically added to the <code>KieRepository</code>.
The <code>KieRepository</code> is a singleton acting as a repository for all the available <code>KieModule</code>s.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieRepository.png" alt="KieRepository">
</div>
<div class="title">Figure 107. KieRepository</div>
</div>
<div class="paragraph">
<p>After this it is possible to create through the <code>KieServices</code> a new <code>KieContainer</code> for that <code>KieModule</code> using its <code>ReleaseId</code>.
However, since in this case the <code>KieFileSystem</code> doesn’t contain any pom.xml file (it is possible to add one using the <code>KieFileSystem.writePomXML</code> method), Kie cannot determine the <code>ReleaseId</code> of the <code>KieModule</code> and assign to it a default one.
This default <code>ReleaseId</code> can be obtained from the <code>KieRepository</code> and used to identify the <code>KieModule</code> inside the <code>KieRepository</code> itself.
The following example shows this whole process.</p>
</div>
<div class="exampleblock">
<div class="title">Example 31. Building the contents of a KieFileSystem and creating a KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieFileSystem kfs = ...
kieServices.newKieBuilder( kfs ).buildAll();
KieContainer kieContainer = kieServices.newKieContainer(kieServices.getRepository().getDefaultReleaseId());</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this point it is possible to get <code>KieBase</code>s and create new <code>KieSession</code>s from this <code>KieContainer</code> exactly in the same way as in the case of a <code>KieContainer</code> created directly from the classpath.</p>
</div>
<div class="paragraph">
<p>It is a best practice to check the compilation results.
The <code>KieBuilder</code> reports compilation results of 3 different severities: ERROR, WARNING and INFO.
An ERROR indicates that the compilation of the project failed and in the case no <code>KieModule</code> is produced and nothing is added to the <code>KieRepository</code>.
WARNING and INFO results can be ignored, but are available for inspection.</p>
</div>
<div class="exampleblock">
<div class="title">Example 32. Checking that a compilation didn’t produce any error</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieBuilder kieBuilder = kieServices.newKieBuilder( kfs ).buildAll();
assertEquals( <span class="hljs-number">0</span>, kieBuilder.getResults().getMessages( Message.Level.ERROR ).size() );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_changingthedefaultbuildresultseverity"><a class="anchor" href="#_changingthedefaultbuildresultseverity"></a><a class="link" href="#_changingthedefaultbuildresultseverity">4.2.2.5. Changing the Default Build Result Severity</a></h5>
<div class="paragraph">
<p>In some cases, it is possible to change the default severity of a type of build result.
For instance, when a new rule with the same name of an existing rule is added to a package, the default behavior is to replace the old rule by the new rule and report it as an INFO.
This is probably ideal for most use cases, but in some deployments the user might want to prevent the rule update and report it as an error.</p>
</div>
<div class="paragraph">
<p>Changing the default severity for a result type, configured like any other option in Drools, can be done by API calls, system properties or configuration files.
As of this version, Drools supports configurable result severity for rule updates and function updates.
To configure it using system properties or configuration files, the user has to use the following properties:</p>
</div>
<div class="exampleblock">
<div class="title">Example 33. Setting the severity using properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-comment">// sets the severity of rule updates</span>
drools.kbuilder.severity.duplicateRule = &lt;INFO|WARNING|ERROR&gt;
<span class="hljs-comment">// sets the severity of function updates</span>
drools.kbuilder.severity.duplicateFunction = &lt;INFO|WARNING|ERROR&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiedeployingsection"><a class="anchor" href="#_kiedeployingsection"></a><a class="link" href="#_kiedeployingsection">4.2.3. Deploying</a></h4>
<div class="sect4">
<h5 id="_kiebase"><a class="anchor" href="#_kiebase"></a><a class="link" href="#_kiebase">4.2.3.1. KieBase</a></h5>
<div class="paragraph">
<p>The <code>KieBase</code> is a repository of all the application’s knowledge definitions.
It will contain rules, processes, functions, and type models.
The <code>KieBase</code> itself does not contain data; instead, sessions are created from the <code>KieBase</code> into which data can be inserted and from which process instances may be started.
The <code>KieBase</code> can be obtained from the <code>KieContainer</code> containing the <code>KieModule</code> where the <code>KieBase</code> has been defined.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieBase.png" alt="KieBase">
</div>
<div class="title">Figure 108. KieBase</div>
</div>
<div class="paragraph">
<p>Sometimes, for instance in a OSGi environment, the <code>KieBase</code> needs to resolve types that are not in the default class loader.
In this case it will be necessary to create a <code>KieBaseConfiguration</code> with an additional class loader and pass it to <code>KieContainer</code> when creating a new <code>KieBase</code> from it.</p>
</div>
<div class="exampleblock">
<div class="title">Example 34. Creating a new KieBase with a custom ClassLoader</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieBaseConfiguration kbaseConf = kieServices.newKieBaseConfiguration( <span class="hljs-keyword">null</span>, MyType.class.getClassLoader() );
KieBase kbase = kieContainer.newKieBase( kbaseConf );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiesessions_and_kiebase_modifications"><a class="anchor" href="#_kiesessions_and_kiebase_modifications"></a><a class="link" href="#_kiesessions_and_kiebase_modifications">4.2.3.2. KieSessions and KieBase Modifications</a></h5>
<div class="paragraph">
<p>KieSessions will be discussed in more detail in section "Running". The <code>KieBase</code> creates and returns <code>KieSession</code> objects, and it may optionally keep references to those.
When <code>KieBase</code> modifications occur those modifications are applied against the data in the sessions.
This reference is a weak reference and it is also optional, which is controlled by a boolean flag.</p>
</div>
</div>
<div class="sect4">
<h5 id="_kiescanner_2"><a class="anchor" href="#_kiescanner_2"></a><a class="link" href="#_kiescanner_2">4.2.3.3. KieScanner</a></h5>
<div class="paragraph">
<p>The <code>KieScanner</code> allows continuous monitoring of your Maven repository to check whether a new release of a Kie project has been installed.
A new release is deployed in the <code>KieContainer</code> wrapping that project.
The use of the <code>KieScanner</code> requires kie-ci.jar to be on the classpath.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieScanner.png" alt="KieScanner">
</div>
<div class="title">Figure 109. KieScanner</div>
</div>
<div class="paragraph">
<p>A <code>KieScanner</code> can be registered on a <code>KieContainer</code> as in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 35. Registering and starting a KieScanner on a KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
ReleaseId releaseId = kieServices.newReleaseId( <span class="hljs-string">"org.acme"</span>, <span class="hljs-string">"myartifact"</span>, <span class="hljs-string">"1.0-SNAPSHOT"</span> );
KieContainer kContainer = kieServices.newKieContainer( releaseId );
KieScanner kScanner = kieServices.newKieScanner( kContainer );

<span class="hljs-comment">// Start the KieScanner polling the Maven repository every 10 seconds</span>
kScanner.start( <span class="hljs-number">10000L</span> );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example the <code>KieScanner</code> is configured to run with a fixed time interval, but it is also possible to run it on demand by invoking the <code>scanNow()</code> method on it.
If the <code>KieScanner</code> finds, in the Maven repository, an updated version of the Kie project used by that <code>KieContainer</code> it automatically downloads the new version and triggers an incremental build of the new project.
At this point, existing <code>KieBase</code>s and <code>KieSession</code>s under the control of <code>KieContainer</code> will get automatically upgraded with it - specifically, those <code>KieBase</code>s obtained with <code>getKieBase()</code> along with their related <code>KieSession</code>s, and any <code>KieSession</code> obtained directly with <code>KieContainer.newKieSession()</code> thus referencing the default <code>KieBase</code>.
Additionally, from this moment on, all the new <code>KieBase</code>s and <code>KieSession</code>s created from that <code>KieContainer</code> will use the new project version.
Please notice however any existing <code>KieBase</code> which was obtained via <code>newKieBase()</code> before the KieScanner upgrade, and any of its related <code>KieSession</code>s, will not get automatically upgraded; this is because <code>KieBase</code>s obtained via <code>newKieBase()</code> are not under the direct control of the <code>KieContainer</code>.</p>
</div>
<div class="paragraph">
<p>The <code>KieScanner</code> will only pickup changes to deployed jars if it is using a SNAPSHOT, version range, the LATEST, or the RELEASE setting.
Fixed versions will not automatically update at runtime.</p>
</div>
</div>
<div class="sect4">
<h5 id="_maven_versions_and_dependencies"><a class="anchor" href="#_maven_versions_and_dependencies"></a><a class="link" href="#_maven_versions_and_dependencies">4.2.3.4. Maven Versions and Dependencies</a></h5>
<div class="paragraph">
<p>Maven supports a number of mechanisms to manage versioning and dependencies within applications.
Modules can be published with specific version numbers, or they can use the SNAPSHOT suffix.
Dependencies can specify version ranges to consume, or take avantage of SNAPSHOT mechanism.</p>
</div>
<div class="paragraph">
<p>StackOverflow provides a very good description for this, which is reproduced below.</p>
</div>
<div class="paragraph">
<p><a href="http://stackoverflow.com/questions/30571/how-do-i-tell-maven-to-use-the-latest-version-of-a-dependency">http://stackoverflow.com/questions/30571/how-do-i-tell-maven-to-use-the-latest-version-of-a-dependency</a></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Maven 3.x metaversions RELEASE and LATEST are no longer supported for the sake of reproducible builds.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>See the POM Syntax section of the Maven book for more details.</p>
</div>
<div class="paragraph">
<p><a href="http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-pom-syntax.html">http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-pom-syntax.html </a></p>
</div>
<div class="paragraph">
<p><a href="http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-project-dependencies.html" class="bare">http://books.sonatype.com/mvnref-book/reference/pom-relationships-sect-project-dependencies.html</a></p>
</div>
<div class="paragraph">
<p>Here’s an example illustrating the various options.
In the Maven repository, com.foo:my-foo has the following metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">metadata</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>com.foo<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>my-foo<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>2.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">versioning</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">release</span>&gt;</span>1.1.1<span class="hljs-tag">&lt;/<span class="hljs-title">release</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">versions</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0.1<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.1<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.1.1<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>2.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">versions</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">lastUpdated</span>&gt;</span>20090722140000<span class="hljs-tag">&lt;/<span class="hljs-title">lastUpdated</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">versioning</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">metadata</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If a dependency on that artifact is required, you have the following options (other version ranges can be specified of course, just showing the relevant ones here): Declare an exact version (will always resolve to 1.0.1):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>[1.0.1]<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare an explicit version (will always resolve to 1.0.1 unless a collision occurs, when Maven will select a matching version):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0.1<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare a version range for all 1.x (will currently resolve to 1.1.1):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>[1.0.0,2.0.0)<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare an open-ended version range (will resolve to 2.0.0):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>[1.0.0,)<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare the version as LATEST (will resolve to 2.0.0):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>LATEST<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Declare the version as RELEASE (will resolve to 1.1.1):</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>RELEASE<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that by default your own deployments will update the "latest" entry in the Maven metadata, but to update the "release" entry, you need to activate the "release-profile" from the Maven super POM.
You can do this with either "-Prelease-profile" or "-DperformRelease=true"</p>
</div>
</div>
<div class="sect4">
<h5 id="_settings_xml_and_remote_repository_setup"><a class="anchor" href="#_settings_xml_and_remote_repository_setup"></a><a class="link" href="#_settings_xml_and_remote_repository_setup">4.2.3.5. Settings.xml and Remote Repository Setup</a></h5>
<div class="paragraph">
<p>The maven settings.xml is used to configure Maven execution.
Detailed instructions can be found at the Maven website:</p>
</div>
<div class="paragraph">
<p><a href="http://maven.apache.org/settings.html" class="bare">http://maven.apache.org/settings.html</a></p>
</div>
<div class="paragraph">
<p>The settings.xml file can be located in 3 locations, the actual settings used is a merge of those 3 locations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Maven install: <code>$M2_HOME/conf/settings.xml</code></p>
</li>
<li>
<p>A user’s install: <code>${user.home}/.m2/settings.xml</code></p>
</li>
<li>
<p>Folder location specified by the system property <code>kie.maven.settings.custom</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The settings.xml is used to specify the location of remote repositories.
It is important that you activate the profile that specifies the remote repository, typically this can be done using "activeByDefault":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">profiles</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">profile</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">id</span>&gt;</span>profile-1<span class="hljs-tag">&lt;/<span class="hljs-title">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">activation</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">activeByDefault</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">activeByDefault</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">activation</span>&gt;</span>
    ...
  <span class="hljs-tag">&lt;/<span class="hljs-title">profile</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">profiles</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Maven provides detailed documentation on using multiple remote repositories:</p>
</div>
<div class="paragraph">
<p><a href="http://maven.apache.org/guides/mini/guide-multiple-repositories.html" class="bare">http://maven.apache.org/guides/mini/guide-multiple-repositories.html</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kierunningsection"><a class="anchor" href="#_kierunningsection"></a><a class="link" href="#_kierunningsection">4.2.4. Running</a></h4>
<div class="sect4">
<h5 id="_kiebase_2"><a class="anchor" href="#_kiebase_2"></a><a class="link" href="#_kiebase_2">4.2.4.1. KieBase</a></h5>
<div class="paragraph">
<p>The <code>KieBase</code> is a repository of all the application’s knowledge definitions.
It will contain rules, processes, functions, and type models.
The <code>KieBase</code> itself does not contain data; instead, sessions are created from the <code>KieBase</code> into which data can be inserted and from which process instances may be started.
The <code>KieBase</code> can be obtained from the <code>KieContainer</code> containing the <code>KieModule</code> where the <code>KieBase</code> has been defined.</p>
</div>
<div class="exampleblock">
<div class="title">Example 36. Getting a KieBase from a KieContainer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieBase kBase = kContainer.getKieBase();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiesession"><a class="anchor" href="#_kiesession"></a><a class="link" href="#_kiesession">4.2.4.2. KieSession</a></h5>
<div class="paragraph">
<p>The <code>KieSession</code> stores and executes on the runtime data.
It is created from the <code>KieBase</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieSession.png" alt="KieSession">
</div>
<div class="title">Figure 110. KieSession</div>
</div>
<div class="exampleblock">
<div class="title">Example 37. Create a KieSession from a KieBase</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = kbase.newKieSession();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kieruntime"><a class="anchor" href="#_kieruntime"></a><a class="link" href="#_kieruntime">4.2.4.3. KieRuntime</a></h5>
<div class="sect5">
<h6 id="_kieruntime_2"><a class="anchor" href="#_kieruntime_2"></a><a class="link" href="#_kieruntime_2">KieRuntime</a></h6>
<div class="paragraph">
<p>The <code>KieRuntime</code> provides methods that are applicable to both rules and processes, such as setting globals and registering channels.
("Exit point" is an obsolete synonym for "channel".)</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieRuntime.png" alt="KieRuntime">
</div>
<div class="title">Figure 111. KieRuntime</div>
</div>
<div class="sect6">
<h7 id="_globals"><a class="anchor" href="#_globals"></a><a class="link" href="#_globals">Globals</a></h7>
<div class="paragraph">
<p>Globals are named objects that are made visible to the rule engine, but in a way that is fundamentally different from the one for facts: changes in the object backing a global do not trigger reevaluation of rules.
Still, globals are useful for providing static information, as an object offering services that are used in the RHS of a rule, or as a means to return objects from the rule engine.
When you use a global on the LHS of a rule, make sure it is immutable, or, at least, don’t expect changes to have any effect on the behavior of your rules.</p>
</div>
<div class="paragraph">
<p>A global must be declared in a rules file, and then it needs to be backed up with a Java object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php"><span class="hljs-keyword">global</span> java.util.<span class="hljs-keyword">List</span> <span class="hljs-keyword">list</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the Knowledge Base now aware of the global identifier and its type, it is now possible to call <code>ksession.setGlobal()</code> with the global’s name and an object, for any session, to associate the object with the global.
Failure to declare the global type and identifier in DRL code will result in an exception being thrown from this call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List list = <span class="hljs-keyword">new</span> ArrayList();
ksession.setGlobal(<span class="hljs-string">"list"</span>, list);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to set any global before it is used in the evaluation of a rule.
Failure to do so results in a <code>NullPointerException</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_event_model"><a class="anchor" href="#_event_model"></a><a class="link" href="#_event_model">4.2.4.4. Event Model</a></h5>
<div class="paragraph">
<p>The event package provides means to be notified of rule engine events, including rules firing, objects being asserted, etc.
This allows separation of logging and auditing activities from the main part of your application (and the rules).</p>
</div>
<div class="paragraph">
<p>The <code>KieRuntimeEventManager</code> interface is implemented by the <code>KieRuntime</code> which provides two interfaces, <code>RuleRuntimeEventManager</code> and <code>ProcessEventManager</code>.
We will only cover the <code>RuleRuntimeEventManager</code> here.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieRuntimeEventManager.png" alt="KieRuntimeEventManager">
</div>
<div class="title">Figure 112. KieRuntimeEventManager</div>
</div>
<div class="paragraph">
<p>The <code>RuleRuntimeEventManager</code> allows for listeners to be added and removed, so that events for the working memory and the agenda can be listened to.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RuleRuntimeEventManager.png" alt="RuleRuntimeEventManager">
</div>
<div class="title">Figure 113. RuleRuntimeEventManager</div>
</div>
<div class="paragraph">
<p>The following code snippet shows how a simple agenda listener is declared and attached to a session.
It will print matches after they have fired.</p>
</div>
<div class="exampleblock">
<div class="title">Example 38. Adding an AgendaEventListener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( <span class="hljs-keyword">new</span> DefaultAgendaEventListener() {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterMatchFired</span><span class="hljs-params">(AfterMatchFiredEvent event)</span> </span>{
        <span class="hljs-keyword">super</span>.afterMatchFired( event );
        System.out.println( event );
    }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Drools also provides <code>DebugRuleRuntimeEventListener</code> and <code>DebugAgendaEventListener</code> which implement each method with a debug print statement.
To print all Working Memory events, you add a listener like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 39. Adding a DebugRuleRuntimeEventListener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( <span class="hljs-keyword">new</span> DebugRuleRuntimeEventListener() );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All emitted events implement the <code>KieRuntimeEvent</code> interface which can be used to retrieve the actual <code>KnowlegeRuntime</code> the event originated from.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieRuntimeEvent.png" alt="KieRuntimeEvent">
</div>
<div class="title">Figure 114. KieRuntimeEvent</div>
</div>
<div class="paragraph">
<p>The events currently supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MatchCreatedEvent</p>
</li>
<li>
<p>MatchCancelledEvent</p>
</li>
<li>
<p>BeforeMatchFiredEvent</p>
</li>
<li>
<p>AfterMatchFiredEvent</p>
</li>
<li>
<p>AgendaGroupPushedEvent</p>
</li>
<li>
<p>AgendaGroupPoppedEvent</p>
</li>
<li>
<p>ObjectInsertEvent</p>
</li>
<li>
<p>ObjectDeletedEvent</p>
</li>
<li>
<p>ObjectUpdatedEvent</p>
</li>
<li>
<p>ProcessCompletedEvent</p>
</li>
<li>
<p>ProcessNodeLeftEvent</p>
</li>
<li>
<p>ProcessNodeTriggeredEvent</p>
</li>
<li>
<p>ProcessStartEvent</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_kieruntimelogger"><a class="anchor" href="#_kieruntimelogger"></a><a class="link" href="#_kieruntimelogger">4.2.4.5. KieRuntimeLogger</a></h5>
<div class="paragraph">
<p>The KieRuntimeLogger uses the comprehensive event system in Drools to create an audit log that can be used to log the execution of an application for later inspection, using tools such as the Eclipse audit viewer.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieLoggers.png" alt="KieLoggers">
</div>
<div class="title">Figure 115. KieLoggers</div>
</div>
<div class="exampleblock">
<div class="title">Example 40. FileLogger</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieRuntimeLogger logger =
  KieServices.Factory.get().getLoggers().newFileLogger(ksession, <span class="hljs-string">"logdir/mylogfile"</span>);
...
logger.close();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_commands_and_the_commandexecutor"><a class="anchor" href="#_commands_and_the_commandexecutor"></a><a class="link" href="#_commands_and_the_commandexecutor">4.2.4.6. Commands and the CommandExecutor</a></h5>
<div class="paragraph">
<p>KIE has the concept of stateful or stateless sessions.
Stateful sessions have already been covered, which use the standard KieRuntime, and can be worked with iteratively over time.
Stateless is a one-off execution of a KieRuntime with a provided data set.
It may return some results, with the session being disposed at the end, prohibiting further iterative interactions.
You can think of stateless as treating an engine like a function call with optional return results.</p>
</div>
<div class="paragraph">
<p>The foundation for this is the <code>CommandExecutor</code> interface, which both the stateful and stateless interfaces extend.
This returns an <code>ExecutionResults</code>:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/CommandExecutor.png" alt="CommandExecutor">
</div>
<div class="title">Figure 116. CommandExecutor</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ExecutionResults.png" alt="ExecutionResults">
</div>
<div class="title">Figure 117. ExecutionResults</div>
</div>
<div class="paragraph">
<p>The <code>CommandExecutor</code> allows for commands to be executed on those sessions, the only difference being that the StatelessKieSession executes <code>fireAllRules()</code> at the end before disposing the session.
The commands can be created using the <code>CommandExecutor</code> .The Javadocs provide the full list of the allowed comands using the <code>CommandExecutor</code>.</p>
</div>
<div class="paragraph">
<p>setGlobal and getGlobal are two commands relevant to both Drools and jBPM.</p>
</div>
<div class="paragraph">
<p>Set Global calls setGlobal underneath.
The optional boolean indicates whether the command should return the global’s value as part of the <code>ExecutionResults</code>.
If true it uses the same name as the global name.
A String can be used instead of the boolean, if an alternative name is desired.</p>
</div>
<div class="exampleblock">
<div class="title">Example 41. Set Global Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ExecutionResults bresults =
    ksession.execute( CommandFactory.newSetGlobal( <span class="hljs-string">"stilton"</span>, <span class="hljs-keyword">new</span> Cheese( <span class="hljs-string">"stilton"</span> ), <span class="hljs-keyword">true</span>);
Cheese stilton = bresults.getValue( <span class="hljs-string">"stilton"</span> );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Allows an existing global to be returned.
The second optional String argument allows for an alternative return name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 42. Get Global Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ExecutionResults bresults =
    ksession.execute( CommandFactory.getGlobal( <span class="hljs-string">"stilton"</span> );
Cheese stilton = bresults.getValue( <span class="hljs-string">"stilton"</span> );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All the above examples execute single commands.
The <code>BatchExecution</code> represents a composite command, created from a list of commands.
It will iterate over the list and execute each command in turn.
This means you can insert some objects, start a process, call fireAllRules and execute a query, all in a single <code>execute(…​)</code> call, which is quite powerful.</p>
</div>
<div class="paragraph">
<p>The StatelessKieSession will execute <code>fireAllRules()</code> automatically at the end.
However the keen-eyed reader probably has already noticed the <code>FireAllRules</code> command and wondered how that works with a StatelessKieSession.
The <code>FireAllRules</code> command is allowed, and using it will disable the automatic execution at the end; think of using it as a sort of manual override function.</p>
</div>
<div class="paragraph">
<p>Any command, in the batch, that has an out identifier set will add its results to the returned <code>ExecutionResults</code> instance.
Let’s look at a simple example to see how this works.
The example presented includes command from the Drools and jBPM, for the sake of illustration.
They are covered in more detail in the Drool and jBPM specific sections.</p>
</div>
<div class="exampleblock">
<div class="title">Example 43. BatchExecution Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();

List cmds = <span class="hljs-keyword">new</span> ArrayList();
cmds.add( CommandFactory.newInsertObject( <span class="hljs-keyword">new</span> Cheese( <span class="hljs-string">"stilton"</span>, <span class="hljs-number">1</span>), <span class="hljs-string">"stilton"</span>) );
cmds.add( CommandFactory.newStartProcess( <span class="hljs-string">"process cheeses"</span> ) );
cmds.add( CommandFactory.newQuery( <span class="hljs-string">"cheeses"</span> ) );
ExecutionResults bresults = ksession.execute( CommandFactory.newBatchExecution( cmds ) );
Cheese stilton = ( Cheese ) bresults.getValue( <span class="hljs-string">"stilton"</span> );
QueryResults qresults = ( QueryResults ) bresults.getValue( <span class="hljs-string">"cheeses"</span> );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the above example multiple commands are executed, two of which populate the <code>ExecutionResults</code>.
The query command defaults to use the same identifier as the query name, but it can also be mapped to a different identifier.</p>
</div>
<div class="paragraph">
<p>All commands support XML and jSON marshalling using XStream, as well as JAXB marshalling.
This is covered in section <a href="#_commandsapisection">Commands API</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_statelesskiesession"><a class="anchor" href="#_statelesskiesession"></a><a class="link" href="#_statelesskiesession">4.2.4.7. StatelessKieSession</a></h5>
<div class="paragraph">
<p>The <code>StatelessKieSession</code> wraps the <code>KieSession</code>, instead of extending it.
Its main focus is on the decision service type scenarios.
It avoids the need to call <code>dispose()</code>.
Stateless sessions do not support iterative insertions and the method call <code>fireAllRules()</code> from Java code; the act of calling <code>execute()</code> is a single-shot method that will internally instantiate a <code>KieSession</code>, add all the user data and execute user commands, call <code>fireAllRules()</code>, and then call <code>dispose()</code>.
While the main way to work with this class is via the <code>BatchExecution</code> (a subinterface of <code>Command</code>) as supported by the <code>CommandExecutor</code> interface, two convenience methods are provided for when simple object insertion is all that’s required.
The <code>CommandExecutor</code> and <code>BatchExecution</code> are talked about in detail in their own section.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/StatelessKieSession.png" alt="StatelessKieSession">
</div>
<div class="title">Figure 118. StatelessKieSession</div>
</div>
<div class="paragraph">
<p>Our simple example shows a stateless session executing a given collection of Java objects using the convenience API.
It will iterate the collection, inserting each element in turn.</p>
</div>
<div class="exampleblock">
<div class="title">Example 44. Simple StatelessKieSession execution with a Collection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ksession.execute( collection );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If this was done as a single Command it would be as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 45. Simple StatelessKieSession execution with InsertElements Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.execute( CommandFactory.newInsertElements( collection ) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you wanted to insert the collection itself, and the collection’s individual elements, then <code>CommandFactory.newInsert(collection)</code> would do the job.</p>
</div>
<div class="paragraph">
<p>Methods of the <code>CommandFactory</code> create the supported commands, all of which can be marshalled using XStream and the <code>BatchExecutionHelper</code>. <code>BatchExecutionHelper</code> provides details on the XML format as well as how to use Drools Pipeline to automate the marshalling of <code>BatchExecution</code> and <code>ExecutionResults</code>.</p>
</div>
<div class="paragraph">
<p><code>StatelessKieSession</code> supports globals, scoped in a number of ways.
We cover the non-command way first, as commands are scoped to a specific execution call.
Globals can be resolved in three ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The StatelessKieSession method <code>getGlobals()</code> returns a Globals instance which provides access to the session’s globals. These are shared for <em>all</em> execution calls. Exercise caution regarding mutable globals because execution calls can be executing simultaneously in different threads.</p>
<div class="exampleblock">
<div class="title">Example 46. Session scoped global</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
<span class="hljs-comment">// Set a global hbnSession, that can be used for DB interactions in the rules.</span>
ksession.setGlobal( <span class="hljs-string">"hbnSession"</span>, hibernateSession );
<span class="hljs-comment">// Execute while being able to resolve the "hbnSession" identifier.</span>
ksession.execute( collection );</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Using a delegate is another way of global resolution. Assigning a value to a global (with <code>setGlobal(String, Object)</code>) results in the value being stored in an internal collection mapping identifiers to values. Identifiers in this internal collection will have priority over any supplied delegate. Only if an identifier cannot be found in this internal collection, the delegate global (if any) will be used.</p>
</li>
<li>
<p>The third way of resolving globals is to have execution scoped globals. Here, a <code>Command</code> to set a global is passed to the <code>CommandExecutor</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>CommandExecutor</code> interface also offers the ability to export data via "out" parameters.
Inserted facts, globals and query results can all be returned.</p>
</div>
<div class="exampleblock">
<div class="title">Example 47. Out identifiers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// Set up a list of commands</span>
List cmds = <span class="hljs-keyword">new</span> ArrayList();
cmds.add( CommandFactory.newSetGlobal( <span class="hljs-string">"list1"</span>, <span class="hljs-keyword">new</span> ArrayList(), <span class="hljs-keyword">true</span> ) );
cmds.add( CommandFactory.newInsert( <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"jon"</span>, <span class="hljs-number">102</span> ), <span class="hljs-string">"person"</span> ) );
cmds.add( CommandFactory.newQuery( <span class="hljs-string">"Get People"</span> <span class="hljs-string">"getPeople"</span> );

<span class="hljs-comment">// Execute the list</span>
ExecutionResults results =
  ksession.execute( CommandFactory.newBatchExecution( cmds ) );

<span class="hljs-comment">// Retrieve the ArrayList</span>
results.getValue( <span class="hljs-string">"list1"</span> );
<span class="hljs-comment">// Retrieve the inserted Person fact</span>
results.getValue( <span class="hljs-string">"person"</span> );
<span class="hljs-comment">// Retrieve the query as a QueryResults instance.</span>
results.getValue( <span class="hljs-string">"Get People"</span> );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_marshalling"><a class="anchor" href="#_marshalling"></a><a class="link" href="#_marshalling">4.2.4.8. Marshalling</a></h5>
<div class="paragraph">
<p>The <code>KieMarshallers</code> are used to marshal and unmarshal KieSessions.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KieMarshallers.png" alt="KieMarshallers">
</div>
<div class="title">Figure 119. KieMarshallers</div>
</div>
<div class="paragraph">
<p>An instance of the <code>KieMarshallers</code> can be retrieved from the <code>KieServices</code>.
A simple example is shown below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 48. Simple Marshaller Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// ksession is the KieSession</span>
<span class="hljs-comment">// kbase is the KieBase</span>
ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();
Marshaller marshaller = KieServices.Factory.get().getMarshallers().newMarshaller( kbase );
marshaller.marshall( baos, ksession );
baos.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>However, with marshalling, you will need more flexibility when dealing with referenced user data.
To achieve this use the <code>ObjectMarshallingStrategy</code> interface.
Two implementations are provided, but users can implement their own.
The two supplied strategies are <code>IdentityMarshallingStrategy</code> and <code>SerializeMarshallingStrategy</code>. <code>SerializeMarshallingStrategy</code> is the default, as shown in the example above, and it just calls the <code>Serializable</code> or <code>Externalizable</code> methods on a user instance. <code>IdentityMarshallingStrategy</code> creates an integer id for each user object and stores them in a Map, while the id is written to the stream.
When unmarshalling it accesses the <code>IdentityMarshallingStrategy</code> map to retrieve the instance.
This means that if you use the <code>IdentityMarshallingStrategy</code>, it is stateful for the life of the Marshaller instance and will create ids and keep references to all objects that it attempts to marshal.
Below is the code to use an Identity Marshalling Strategy.</p>
</div>
<div class="exampleblock">
<div class="title">Example 49. IdentityMarshallingStrategy</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();
KieMarshallers kMarshallers = KieServices.Factory.get().getMarshallers()
ObjectMarshallingStrategy oms = kMarshallers.newIdentityMarshallingStrategy()
Marshaller marshaller =
        kMarshallers.newMarshaller( kbase, <span class="hljs-keyword">new</span> ObjectMarshallingStrategy[]{ oms } );
marshaller.marshall( baos, ksession );
baos.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Im most cases, a single strategy is insufficient.
For added flexibility, the <code>ObjectMarshallingStrategyAcceptor</code> interface can be used.
This Marshaller has a chain of strategies, and while reading or writing a user object it iterates the strategies asking if they accept responsibility for marshalling the user object.
One of the provided implementations is <code>ClassFilterAcceptor</code>.
This allows strings and wild cards to be used to match class names.
The default is "<strong>.</strong>", so in the above example the Identity Marshalling Strategy is used which has a default "<strong>.</strong>" acceptor.</p>
</div>
<div class="paragraph">
<p>Assuming that we want to serialize all classes except for one given package, where we will use identity lookup, we could do the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 50. IdentityMarshallingStrategy with Acceptor</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ByteArrayOutputStream baos = <span class="hljs-keyword">new</span> ByteArrayOutputStream();
KieMarshallers kMarshallers = KieServices.Factory.get().getMarshallers()
ObjectMarshallingStrategyAcceptor identityAcceptor =
        kMarshallers.newClassFilterAcceptor( <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"org.domain.pkg1.*"</span> } );
ObjectMarshallingStrategy identityStrategy =
        kMarshallers.newIdentityMarshallingStrategy( identityAcceptor );
ObjectMarshallingStrategy sms = kMarshallers.newSerializeMarshallingStrategy();
Marshaller marshaller =
        kMarshallers.newMarshaller( kbase,
                                    <span class="hljs-keyword">new</span> ObjectMarshallingStrategy[]{ identityStrategy, sms } );
marshaller.marshall( baos, ksession );
baos.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the acceptance checking order is in the natural order of the supplied elements.</p>
</div>
<div class="paragraph">
<p>Also note that if you are using scheduled matches (i.e.
some of your rules use timers or calendars) they are marshallable only if, before you use it, you configure your KieSession to use a trackable timer job factory manager as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 51. Configuring a trackable timer job factory manager</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption(TimerJobFactoryOption.get(<span class="hljs-string">"trackable"</span>));
KSession ksession = kbase.newKieSession(ksconf, <span class="hljs-keyword">null</span>);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_persistence_and_transactions"><a class="anchor" href="#_persistence_and_transactions"></a><a class="link" href="#_persistence_and_transactions">4.2.4.9. Persistence and Transactions</a></h5>
<div class="paragraph">
<p>Longterm out of the box persistence with Java Persistence API (JPA) is possible with Drools.
It is necessary to have some implementation of the Java Transaction API (JTA) installed.
For development purposes the Bitronix Transaction Manager is suggested, as it’s simple to set up and works embedded, but for production use JBoss Transactions is recommended.</p>
</div>
<div class="exampleblock">
<div class="title">Example 52. Simple example using transactions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
Environment env = kieServices.newEnvironment();
env.set( EnvironmentName.ENTITY_MANAGER_FACTORY,
         Persistence.createEntityManagerFactory( <span class="hljs-string">"emf-name"</span> ) );
env.set( EnvironmentName.TRANSACTION_MANAGER,
         TransactionManagerServices.getTransactionManager() );

<span class="hljs-comment">// KieSessionConfiguration may be null, and a default will be used</span>
KieSession ksession =
        kieServices.getStoreServices().newKieSession( kbase, <span class="hljs-keyword">null</span>, env );
<span class="hljs-keyword">int</span> sessionId = ksession.getId();

UserTransaction ut =
  (UserTransaction) <span class="hljs-keyword">new</span> InitialContext().lookup( <span class="hljs-string">"java:comp/UserTransaction"</span> );
ut.begin();
ksession.insert( data1 );
ksession.insert( data2 );
ksession.startProcess( <span class="hljs-string">"process1"</span> );
ut.commit();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use a JPA, the Environment must be set with both the <code>EntityManagerFactory</code> and the <code>TransactionManager</code>.
If rollback occurs the ksession state is also rolled back, hence it is possible to continue to use it after a rollback.
To load a previously persisted KieSession you’ll need the id, as shown below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 53. Loading a KieSession</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession =
        kieServices.getStoreServices().loadKieSession( sessionId, kbase, <span class="hljs-keyword">null</span>, env );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To enable persistence several classes must be added to your persistence.xml, as in the example below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 54. Configuring JPA</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">persistence-unit</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.drools.persistence.jpa"</span> <span class="hljs-attribute">transaction-type</span>=<span class="hljs-value">"JTA"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">provider</span>&gt;</span>org.hibernate.ejb.HibernatePersistence<span class="hljs-tag">&lt;/<span class="hljs-title">provider</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">jta-data-source</span>&gt;</span>jdbc/BitronixJTADataSource<span class="hljs-tag">&lt;/<span class="hljs-title">jta-data-source</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">class</span>&gt;</span>org.drools.persistence.info.SessionInfo<span class="hljs-tag">&lt;/<span class="hljs-title">class</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">class</span>&gt;</span>org.drools.persistence.info.WorkItemInfo<span class="hljs-tag">&lt;/<span class="hljs-title">class</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">properties</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"hibernate.dialect"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"org.hibernate.dialect.H2Dialect"</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"hibernate.max_fetch_depth"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"3"</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"hibernate.hbm2ddl.auto"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"update"</span> /&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"hibernate.show_sql"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"true"</span> /&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"hibernate.transaction.manager_lookup_class"</span>
                      <span class="hljs-attribute">value</span>=<span class="hljs-value">"org.hibernate.transaction.BTMTransactionManagerLookup"</span> /&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">properties</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">persistence-unit</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The jdbc JTA data source would have to be configured first.
Bitronix provides a number of ways of doing this, and its documentation should be consulted for details.
For a quick start, here is the programmatic approach:</p>
</div>
<div class="exampleblock">
<div class="title">Example 55. Configuring JTA DataSource</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">PoolingDataSource ds = <span class="hljs-keyword">new</span> PoolingDataSource();
ds.setUniqueName( <span class="hljs-string">"jdbc/BitronixJTADataSource"</span> );
ds.setClassName( <span class="hljs-string">"org.h2.jdbcx.JdbcDataSource"</span> );
ds.setMaxPoolSize( <span class="hljs-number">3</span> );
ds.setAllowLocalTransactions( <span class="hljs-keyword">true</span> );
ds.getDriverProperties().put( <span class="hljs-string">"user"</span>, <span class="hljs-string">"sa"</span> );
ds.getDriverProperties().put( <span class="hljs-string">"password"</span>, <span class="hljs-string">"sasa"</span> );
ds.getDriverProperties().put( <span class="hljs-string">"URL"</span>, <span class="hljs-string">"jdbc:h2:mem:mydb"</span> );
ds.init();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Bitronix also provides a simple embedded JNDI service, ideal for testing.
To use it, add a jndi.properties file to your META-INF folder and add the following line to it:</p>
</div>
<div class="exampleblock">
<div class="title">Example 56. JNDI properties</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">java.naming.factory.initial=bitronix.tm.jndi.BitronixInitialContextFactory</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiedeploycheatsheets"><a class="anchor" href="#_kiedeploycheatsheets"></a><a class="link" href="#_kiedeploycheatsheets">4.2.5. Installation and Deployment Cheat Sheets</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/cheatsheet1.png" alt="cheatsheet1">
</div>
<div class="title">Figure 120. Installation Overview</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/cheatsheet2.png" alt="cheatsheet2">
</div>
<div class="title">Figure 121. Deployment Overview</div>
</div>
</div>
<div class="sect3">
<h4 id="_kieexamplessection"><a class="anchor" href="#_kieexamplessection"></a><a class="link" href="#_kieexamplessection">4.2.6. Build,  Deploy and Utilize Examples</a></h4>
<div class="paragraph">
<p>The best way to learn the new build system is by example.
The source project "drools-examples-api" contains a number of examples, and can be found at GitHub:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kiegroup/drools/tree/6.0.x/drools-examples-api" class="bare">https://github.com/kiegroup/drools/tree/6.0.x/drools-examples-api</a></p>
</div>
<div class="paragraph">
<p>Each example is described below, the order starts with the simplest (most of the options are defaulted) and working its way up to more complex use cases.</p>
</div>
<div class="paragraph">
<p>The Deploy use cases shown below all involve <code>mvn install</code>.
Remote deployment of JARs in Maven is well covered in Maven literature.
Utilize refers to the initial act of loading the resources and providing access to the KIE runtimes.
Where as Run refers to the act of interacting with those runtimes.</p>
</div>
<div class="sect4">
<h5 id="_default_kiesession"><a class="anchor" href="#_default_kiesession"></a><a class="link" href="#_default_kiesession">4.2.6.1. Default KieSession</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: default-kesession.</p>
</li>
<li>
<p>Summary: Empty kmodule.xml KieModule on the classpath that includes all resources in a single default KieBase. The example shows the retrieval of the default KieSession from the classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An empty kmodule.xml will produce a single KieBase that includes all files found under resources path, be it DRL, BPMN2, XLS etc.
That single KieBase is the default and also includes a single default KieSession.
Default means they can be created without knowing their names.</p>
</div>
<div class="exampleblock">
<div class="title">Example 57. Author - kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kmodule</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.drools.org/xsd/kmodule"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-title">kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 58. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">mvn</span> install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>ks.getKieClasspathContainer() returns the KieContainer that contains the KieBases deployed onto the environment classpath.
kContainer.newKieSession() creates the default KieSession.
Notice that you no longer need to look up the KieBase, in order to create the KieSession.
The KieSession knows which KieBase it’s associated with, and use that, which in this case is the default KieBase.</p>
</div>
<div class="exampleblock">
<div class="title">Example 59. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal(<span class="hljs-string">"out"</span>, out);
kSession.insert(<span class="hljs-keyword">new</span> Message(<span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_named_kiesession"><a class="anchor" href="#_named_kiesession"></a><a class="link" href="#_named_kiesession">4.2.6.2. Named KieSession</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: named-kiesession.</p>
</li>
<li>
<p>Summary: kmodule.xml that has one named KieBase and one named KieSession. The examples shows the retrieval of the named KieSession from the classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>kmodule.xml will produce a single named KieBase, 'kbase1' that includes all files found under resources path, be it DRL, BPMN2, XLS etc.
KieSession 'ksession1' is associated with that KieBase and can be created by name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 60. Author - kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kmodule</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.drools.org/xsd/kmodule"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase1"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 61. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">mvn</span> install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>ks.getKieClasspathContainer() returns the KieContainer that contains the KieBases deployed onto the environment classpath.
This time the KieSession uses the name 'ksession1'. You do not need to lookup the KieBase first, as it knows which KieBase 'ksession1' is assocaited with.</p>
</div>
<div class="exampleblock">
<div class="title">Example 62. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();

KieSession kSession = kContainer.newKieSession(<span class="hljs-string">"ksession1"</span>);
kSession.setGlobal(<span class="hljs-string">"out"</span>, out);
kSession.insert(<span class="hljs-keyword">new</span> Message(<span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiebase_inheritence"><a class="anchor" href="#_kiebase_inheritence"></a><a class="link" href="#_kiebase_inheritence">4.2.6.3. KieBase Inheritence</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: kiebase-inclusion.</p>
</li>
<li>
<p>Summary: 'kmodule.xml' demonstrates that one KieBase can include the resources from another KieBase, from another KieModule. In this case it inherits the named KieBase from the 'name-kiesession' example. The included KieBase can be from the current KieModule or any other KieModule that is in the pom.xml dependency list.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>kmodule.xml will produce a single named KieBase, 'kbase2' that includes all files found under resources path, be it DRL, BPMN2, XLS etc.
Further it will include all the resources found from the KieBase 'kbase1', due to the use of the 'includes' attribute.
KieSession 'ksession2' is associated with that KieBase and can be created by name.</p>
</div>
<div class="exampleblock">
<div class="title">Example 63. Author - kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase2"</span> <span class="hljs-attribute">includes</span>=<span class="hljs-value">"kbase1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession2"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This example requires that the previous example, 'named-kiesession', is built and installed to the local Maven repository first.
Once installed it can be included as a dependency, using the standard Maven &lt;dependencies&gt; element.</p>
</div>
<div class="exampleblock">
<div class="title">Example 64. Author - pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">project</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">modelVersion</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-examples-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>6.0.0/version&gt;
  <span class="hljs-tag">&lt;/<span class="hljs-title">parent</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kiebase-inclusion<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>Drools API examples - KieBase Inclusion<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-compiler<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>named-kiesession<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>6.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">project</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once 'named-kiesession' is built and installed this example can be built and installed as normal.
Again the act of installing, will force the unit tests to run, demonstrating the use case.</p>
</div>
<div class="exampleblock">
<div class="title">Example 65. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">mvn</span> install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>ks.getKieClasspathContainer() returns the KieContainer that contains the KieBases deployed onto the environment classpath.
This time the KieSession uses the name 'ksession2'. You do not need to lookup the KieBase first, as it knows which KieBase 'ksession1' is assocaited with.
Notice two rules fire this time, showing that KieBase 'kbase2' has included the resources from the dependency KieBase 'kbase1'.</p>
</div>
<div class="exampleblock">
<div class="title">Example 66. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieContainer kContainer = ks.getKieClasspathContainer();
KieSession kSession = kContainer.newKieSession(<span class="hljs-string">"ksession2"</span>);
kSession.setGlobal(<span class="hljs-string">"out"</span>, out);

kSession.insert(<span class="hljs-keyword">new</span> Message(<span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>));
kSession.fireAllRules();

kSession.insert(<span class="hljs-keyword">new</span> Message(<span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Open the pod bay doors, HAL."</span>));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_kiebases"><a class="anchor" href="#_multiple_kiebases"></a><a class="link" href="#_multiple_kiebases">4.2.6.4. Multiple KieBases</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: 'multiple-kbases.</p>
</li>
<li>
<p>Summary: Demonstrates that the 'kmodule.xml'  can contain any number of KieBase or KieSession declarations. Introduces the 'packages' attribute to select the folders for the resources to be included in the KieBase.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>kmodule.xml produces 6 different named KieBases.
'kbase1' includes all resources from the KieModule.
The other KieBases include resources from other selected folders, via the 'packages' attribute.
Note the use of wildcard '*', to select this package and all packages below it.</p>
</div>
<div class="exampleblock">
<div class="title">Example 67. Author - kmodule.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kmodule</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.drools.org/xsd/kmodule"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase2"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.some.pkg"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession2"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase3"</span> <span class="hljs-attribute">includes</span>=<span class="hljs-value">"kbase2"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.some.pkg2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession3"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase4"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.some.pkg, org.other.pkg"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession4"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase5"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.*"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession5"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase6"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.some.*"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession6"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 68. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">mvn</span> install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Only part of the example is included below, as there is a test method per KieSession, but each one is a repetition of the other, with different list expectations.</p>
</div>
<div class="exampleblock">
<div class="title">Example 69. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSimpleKieBase</span><span class="hljs-params">()</span> </span>{
    List&lt;Integer&gt; list = useKieSession(<span class="hljs-string">"ksession1"</span>);
    <span class="hljs-comment">// no packages imported means import everything</span>
    assertEquals(<span class="hljs-number">4</span>, list.size());
    assertTrue( list.containsAll( asList(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>) ) );
}

<span class="hljs-comment">//.. other tests for ksession2 to ksession6 here</span>

<span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;Integer&gt; <span class="hljs-title">useKieSession</span><span class="hljs-params">(String name)</span> </span>{
    KieServices ks = KieServices.Factory.get();
    KieContainer kContainer = ks.getKieClasspathContainer();
    KieSession kSession = kContainer.newKieSession(name);

    List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;Integer&gt;();
    kSession.setGlobal(<span class="hljs-string">"list"</span>, list);
    kSession.insert(<span class="hljs-number">1</span>);
    kSession.fireAllRules();

    <span class="hljs-keyword">return</span> list;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiecontainer_from_kierepository"><a class="anchor" href="#_kiecontainer_from_kierepository"></a><a class="link" href="#_kiecontainer_from_kierepository">4.2.6.5. KieContainer from KieRepository</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: kcontainer-from-repository</p>
</li>
<li>
<p>Summary: The project does not contain a kmodule.xml, nor does the pom.xml have any dependencies for other KieModules. Instead the Java code demonstrates the loading of a dynamic KieModule from a Maven repository.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The pom.xml must include kie-ci as a depdency, to ensure Maven is available at runtime.
As this uses Maven under the hood you can also use the standard Maven settings.xml file.</p>
</div>
<div class="exampleblock">
<div class="title">Example 70. Author - pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">project</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">modelVersion</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-examples-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>6.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">parent</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kiecontainer-from-kierepo<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>Drools API examples - KieContainer from KieRepo<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-ci<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">project</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 71. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">mvn</span> install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the previous examples the classpath KieContainer used.
This example creates a dynamic KieContainer as specified by the  ReleaseId.
The ReleaseId uses Maven conventions for group id, artifact id and version.
It also obeys LATEST and SNAPSHOT for versions.</p>
</div>
<div class="exampleblock">
<div class="title">Example 72. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();

<span class="hljs-comment">// Install example1 in the local Maven repo before to do this</span>
KieContainer kContainer = ks.newKieContainer(ks.newReleaseId(<span class="hljs-string">"org.drools"</span>, <span class="hljs-string">"named-kiesession"</span>, <span class="hljs-string">"6.0.0-SNAPSHOT"</span>));

KieSession kSession = kContainer.newKieSession(<span class="hljs-string">"ksession1"</span>);
kSession.setGlobal(<span class="hljs-string">"out"</span>, out);

Object msg1 = createMessage(kContainer, <span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>);
kSession.insert(msg1);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_default_kiesession_from_file"><a class="anchor" href="#_default_kiesession_from_file"></a><a class="link" href="#_default_kiesession_from_file">4.2.6.6. Default KieSession from File</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: default-kiesession-from-file</p>
</li>
<li>
<p>Summary: Dynamic KieModules can also be loaded from any Resource location. The loaded KieModule provides default KieBase and KieSession definitions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No kmodue.xml file exists.
The project 'default-kiesession' must be built first, so that the resulting JAR, in the target folder, can be referenced as a File.</p>
</div>
<div class="exampleblock">
<div class="title">Example 73. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">mvn</span> install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Any KieModule can be loaded from a Resource location and added to the KieRepository.
Once deployed in the KieRepository it can be resolved via its ReleaseId.
Note neither Maven or kie-ci are needed here.
It will not set up a transitive dependency parent classloader.</p>
</div>
<div class="exampleblock">
<div class="title">Example 74. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

KieModule kModule = kr.addKieModule(ks.getResources().newFileSystemResource(getFile(<span class="hljs-string">"default-kiesession"</span>)));

KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal(<span class="hljs-string">"out"</span>, out);

Object msg1 = createMessage(kContainer, <span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>);
kSession.insert(msg1);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_named_kiesession_from_file"><a class="anchor" href="#_named_kiesession_from_file"></a><a class="link" href="#_named_kiesession_from_file">4.2.6.7. Named KieSession from File</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: named-kiesession-from-file</p>
</li>
<li>
<p>Summary: Dynamic KieModules can also be loaded from any Resource location. The loaded KieModule provides named KieBase and KieSession definitions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No kmodue.xml file exists.
The project 'named-kiesession' must be built first, so that the resulting JAR, in the target folder, can be referenced as a File.</p>
</div>
<div class="exampleblock">
<div class="title">Example 75. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">mvn</span> install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Any KieModule can be loaded from a Resource location and added to the KieRepository.
Once in the KieRepository it can be resolved via its ReleaseId.
Note neither Maven or kie-ci are needed here.
It will not setup a transitive dependency parent classloader.</p>
</div>
<div class="exampleblock">
<div class="title">Example 76. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

KieModule kModule = kr.addKieModule(ks.getResources().newFileSystemResource(getFile(<span class="hljs-string">"named-kiesession"</span>)));

KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession(<span class="hljs-string">"ksession1"</span>);
kSession.setGlobal(<span class="hljs-string">"out"</span>, out);

Object msg1 = createMessage(kContainer, <span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>);
kSession.insert(msg1);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kiemodule_with_dependent_kiemodule"><a class="anchor" href="#_kiemodule_with_dependent_kiemodule"></a><a class="link" href="#_kiemodule_with_dependent_kiemodule">4.2.6.8. KieModule with Dependent KieModule</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: kie-module-form-multiple-files</p>
</li>
<li>
<p>Summary: Programmatically provide the list of dependant KieModules, without using Maven to resolve anything.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No kmodue.xml file exists.
The projects 'named-kiesession' and 'kiebase-include' must be built first, so that the resulting JARs, in the target folders, can be referenced as Files.</p>
</div>
<div class="exampleblock">
<div class="title">Example 77. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">mvn</span> install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Creates two resources.
One is for the main KieModule 'exRes1' the other is for the dependency 'exRes2'. Even though kie-ci is not present and thus Maven is not available to resolve the dependencies, this shows how you can manually specify the dependent KieModules, for the vararg.</p>
</div>
<div class="exampleblock">
<div class="title">Example 78. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();

Resource ex1Res = ks.getResources().newFileSystemResource(getFile(<span class="hljs-string">"kiebase-inclusion"</span>));
Resource ex2Res = ks.getResources().newFileSystemResource(getFile(<span class="hljs-string">"named-kiesession"</span>));

KieModule kModule = kr.addKieModule(ex1Res, ex2Res);
KieContainer kContainer = ks.newKieContainer(kModule.getReleaseId());

KieSession kSession = kContainer.newKieSession(<span class="hljs-string">"ksession2"</span>);
kSession.setGlobal(<span class="hljs-string">"out"</span>, out);

Object msg1 = createMessage(kContainer, <span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>);
kSession.insert(msg1);
kSession.fireAllRules();

Object msg2 = createMessage(kContainer, <span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Open the pod bay doors, HAL."</span>);
kSession.insert(msg2);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_programmaticaly_build_a_simple_kiemodule_with_defaults"><a class="anchor" href="#_programmaticaly_build_a_simple_kiemodule_with_defaults"></a><a class="link" href="#_programmaticaly_build_a_simple_kiemodule_with_defaults">4.2.6.9. Programmaticaly build a Simple KieModule with Defaults</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: kiemoduelmodel-example</p>
</li>
<li>
<p>Summary: Programmaticaly buid a KieModule from just a single file. The POM and models are all defaulted. This is the quickest out of the box approach, but should not be added to a Maven repository.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 79. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">mvn</span> install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This programmatically builds a KieModule.
It populates the model that represents the ReleaseId and  kmodule.xml, and it adds the relevant resources.
A pom.xml is generated from the ReleaseId.</p>
</div>
<div class="exampleblock">
<div class="title">Example 80. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieRepository kr = ks.getRepository();
KieFileSystem kfs = ks.newKieFileSystem();

kfs.write(<span class="hljs-string">"src/main/resources/org/kie/example5/HAL5.drl"</span>, getRule());

KieBuilder kb = ks.newKieBuilder(kfs);

kb.buildAll(); <span class="hljs-comment">// kieModule is automatically deployed to KieRepository if successfully built.</span>
<span class="hljs-keyword">if</span> (kb.getResults().hasMessages(Level.ERROR)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Build Errors:\n"</span> + kb.getResults().toString());
}

KieContainer kContainer = ks.newKieContainer(kr.getDefaultReleaseId());

KieSession kSession = kContainer.newKieSession();
kSession.setGlobal(<span class="hljs-string">"out"</span>, out);

kSession.insert(<span class="hljs-keyword">new</span> Message(<span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>));
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_programmaticaly_build_a_kiemodule_using_meta_models"><a class="anchor" href="#_programmaticaly_build_a_kiemodule_using_meta_models"></a><a class="link" href="#_programmaticaly_build_a_kiemodule_using_meta_models">4.2.6.10. Programmaticaly build a KieModule using Meta Models</a></h5>
<div class="ulist">
<ul>
<li>
<p>Project: kiemoduelmodel-example</p>
</li>
<li>
<p>Summary: Programmaticaly build a KieModule, by creating its kmodule.xml meta model resources.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 81. Build and Install - Maven</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">mvn</span> install</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This programmatically builds a KieModule.
It populates the model that represents the ReleaseId and  kmodule.xml, as well as add the relevant resources.
A pom.xml is generated from the ReleaseId.</p>
</div>
<div class="exampleblock">
<div class="title">Example 82. Utilize and Run - Java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices ks = KieServices.Factory.get();
KieFileSystem kfs = ks.newKieFileSystem();

Resource ex1Res = ks.getResources().newFileSystemResource(getFile(<span class="hljs-string">"named-kiesession"</span>));
Resource ex2Res = ks.getResources().newFileSystemResource(getFile(<span class="hljs-string">"kiebase-inclusion"</span>));

ReleaseId rid = ks.newReleaseId(<span class="hljs-string">"org.drools"</span>, <span class="hljs-string">"kiemodulemodel-example"</span>, <span class="hljs-string">"6.0.0-SNAPSHOT"</span>);
kfs.generateAndWritePomXML(rid);

KieModuleModel kModuleModel = ks.newKieModuleModel();
kModuleModel.newKieBaseModel(<span class="hljs-string">"kiemodulemodel"</span>)
            .addInclude(<span class="hljs-string">"kiebase1"</span>)
            .addInclude(<span class="hljs-string">"kiebase2"</span>)
            .newKieSessionModel(<span class="hljs-string">"ksession6"</span>);

kfs.writeKModuleXML(kModuleModel.toXML());
kfs.write(<span class="hljs-string">"src/main/resources/kiemodulemodel/HAL6.drl"</span>, getRule());

KieBuilder kb = ks.newKieBuilder(kfs);
kb.setDependencies(ex1Res, ex2Res);
kb.buildAll(); <span class="hljs-comment">// kieModule is automatically deployed to KieRepository if successfully built.</span>
<span class="hljs-keyword">if</span> (kb.getResults().hasMessages(Level.ERROR)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Build Errors:\n"</span> + kb.getResults().toString());
}

KieContainer kContainer = ks.newKieContainer(rid);

KieSession kSession = kContainer.newKieSession(<span class="hljs-string">"ksession6"</span>);
kSession.setGlobal(<span class="hljs-string">"out"</span>, out);

Object msg1 = createMessage(kContainer, <span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>);
kSession.insert(msg1);
kSession.fireAllRules();

Object msg2 = createMessage(kContainer, <span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Open the pod bay doors, HAL."</span>);
kSession.insert(msg2);
kSession.fireAllRules();

Object msg3 = createMessage(kContainer, <span class="hljs-string">"Dave"</span>, <span class="hljs-string">"What's the problem?"</span>);
kSession.insert(msg3);
kSession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kiesecuritysection"><a class="anchor" href="#_kiesecuritysection"></a><a class="link" href="#_kiesecuritysection">4.3. Security</a></h3>
<div class="sect3">
<h4 id="_securitymanager"><a class="anchor" href="#_securitymanager"></a><a class="link" href="#_securitymanager">4.3.1. Security Manager</a></h4>
<div class="paragraph">
<p>The KIE engine is a platform for the modelling and execution of business behavior, using a multitude of declarative abstractions and metaphores, like rules, processes, decision tables and etc.</p>
</div>
<div class="paragraph">
<p>Many times, the authoring of these metaphores is done by third party groups, be it a different group inside the same company, a group from a partner company, or even anonymous third parties on the internet.</p>
</div>
<div class="paragraph">
<p>Rules and Processes are designed to execute arbitrary code in order to do their job, but in such cases it might be necessary to constrain what they can do.
For instance, it is unlikely a rule should be allowed to create a classloader (what could open the system to an attack) and certainly it should not be allowed to make a call to <code>System.exit()</code>.</p>
</div>
<div class="paragraph">
<p>The Java Platform provides a very comprehensive and well defined security framework that allows users to define policies for what a system can do.
The KIE platform leverages that framework and allow application developers to define a specific policy to be applied to any execution of user provided code, be it in rules, processes, work item handlers and etc.</p>
</div>
<div class="sect4">
<h5 id="_howtodefinekiepolicy"><a class="anchor" href="#_howtodefinekiepolicy"></a><a class="link" href="#_howtodefinekiepolicy">4.3.1.1. How to define a KIE Policy</a></h5>
<div class="paragraph">
<p>Rules and processes can run with very restrict permissions, but the engine itself needs to perform many complex operations in order to work.
Examples are: it needs to create classloaders, read system properties, access the file system, etc.</p>
</div>
<div class="paragraph">
<p>Once a security manager is installed, though, it will apply restrictions to all the code executing in the JVM according to the defined policy.
For that reason, KIE allows the user to define two different policy files: one for the engine itself and one for the assets deployed into and executed by the engine.</p>
</div>
<div class="paragraph">
<p>One easy way to setup the enviroment is to give the engine itself a very permissive policy, while providing a constrained policy for rules and processes.</p>
</div>
<div class="paragraph">
<p>Policy files follow the standard policy file syntax as described in the Java documentation.
For more details, see:</p>
</div>
<div class="paragraph">
<p><a href="https://docs.oracle.com/javase/6/docs/technotes/guides/security/PolicyFiles.html#FileSyntax" class="bare">https://docs.oracle.com/javase/6/docs/technotes/guides/security/PolicyFiles.html#FileSyntax</a></p>
</div>
<div class="paragraph">
<p>A permissive policy file for the engine can look like the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 83. A sample engine.policy file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">grant</span> {
    <span class="hljs-title">permission</span> java.security.AllPermission;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An example security policy for rules could be:</p>
</div>
<div class="exampleblock">
<div class="title">Example 84. A sample rules.policy file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">grant</span> {
    <span class="hljs-title">permission</span> java.util.PropertyPermission <span class="hljs-string">"*"</span>, <span class="hljs-string">"read"</span>;
    <span class="hljs-title">permission</span> java.lang.RuntimePermission <span class="hljs-string">"accessDeclaredMembers"</span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Please note that depending on what the rules and processes are supposed to do, many more permissions might need to be granted, like accessing files in the filesystem, databases, etc.</p>
</div>
<div class="paragraph">
<p>In order to use these policy files, all that is necessary is to execute the application with these files as parameters to the JVM.
Three parameters are required:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Parameters</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Djava.security.manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the security manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Djava.security.policy=&lt;jvm_policy_file&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the global policy file to be applied to the whole application, including the engine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dkie.security.policy=&lt;kie_policy_file&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the policy file to be applied to rules and processes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For instance:</p>
</div>
<div class="paragraph">
<p><code>java -Djava.security.manager -Djava.security.policy=global.policy -Dkie.security.policy=rules.policy
        foo.bar.MyApp</code></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When executing the engine inside a container, use your container’s documentation to find out how to configure the Security Manager and how to define the global security policy.
Define the kie security policy as described above and set the <code>kie.security.policy</code> system property in order to configure the engine to use it.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that unless a Security Manager is configured, the <code>kie.security.policy</code> will be ignored.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A Security Manager has a high performance impact in the JVM.
Applications with strict performance requirements are strongly discouraged of using a Security Manager.
An alternative is the use of other security procedures like the auditing of rules/processes before testing and deployment to prevent malicious code from being deployed to the environment.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<h1 id="_drools_runtime_and_language" class="discrete">Drools Runtime and Language</h1>
<div class="paragraph">
<p>Drools is a powerful Hybrid Reasoning System.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hybridreasoningchapter"><a class="anchor" href="#_hybridreasoningchapter"></a><a class="link" href="#_hybridreasoningchapter">5. Hybrid Reasoning</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_artificial_intelligence"><a class="anchor" href="#_artificial_intelligence"></a><a class="link" href="#_artificial_intelligence">5.1. Artificial Intelligence</a></h3>
<div class="sect3">
<h4 id="_a_little_history"><a class="anchor" href="#_a_little_history"></a><a class="link" href="#_a_little_history">5.1.1. A Little History</a></h4>
<div class="paragraph">
<p>Over the last few decades <em class="term">artificial
    intelligence</em>
 (AI) became an unpopular term, with the well-known <a href="http://en.wikipedia.org/wiki/AI_winter">"AI
    Winter"</a>.
There were large boasts from scientists and engineers looking for funding, which never lived up to expectations, resulting in many failed projects. <a href="http://en.wikipedia.org/wiki/Thinking_Machines_Corporation">Thinking
    Machines Corporation</a> and the <a href="http://en.wikipedia.org/wiki/Fifth-generation_computer">5th
    Generation Computer</a> (5GP) project probably exemplify best the problems at the time.</p>
</div>
<div class="paragraph">
<p>Thinking Machines Corporation was one of the leading AI firms in 1990, it had sales of nearly $65 million.
Here is a quote from its brochure:</p>
</div>
<div class="paragraph">
<p>“Some day we will build a thinking machine. It will be a truly
    intelligent machine. One that can see and hear and speak. A machine that
    will be proud of us.”</p>
</div>
<div class="paragraph">
<p>Yet 5 years later it filed for bankruptcy protection under Chapter 11.
The site inc.com has a fascinating article titled <a href="http://www.inc.com/magazine/19950915/2622.html">"The Rise and
    Fall of Thinking Machines"</a>.
The article covers the growth of the industry and how a cosy relationship with Thinking Machines and <a href="http://en.wikipedia.org/wiki/DARPA">DARPA</a> over-heated the market, to the point of collapse.
It explains how and why commerce moved away from AI and towards more practical number-crunching super computers.</p>
</div>
<div class="paragraph">
<p>The 5th Generation Computer project was a USD 400 million project in Japan to build a next generation computer.
Valves (or Tubes) was the first generation, transistors the second, integrated circuits the third and finally microprocessors was the fourth.
The fifth was intended to be a machine capable of effective Artificial Intelligence.
This project spurred an "arms" race with the UK and USA, that caused much of the AI bubble.
The 5GP would provide massive multi-cpu parallel processing hardware along with powerful knowledge representation and reasoning software via <em class="term">Prolog</em>
; a type of [term]_ expert system_
.
By 1992 the project was considered a failure and cancelled.
It was the largest and most visible commercial venture for Prolog, and many of the failures are pinned on the problems of trying to run a logic based programming language concurrently on multi CPU hardware with effective results.
Some believe that the failure of the 5GP project tainted Prolog and relegated it to academia, see <a href="http://www.dvorak.org/blog/whatever-happened-to-prolog/">"Whatever Happened to Prolog"</a> by John C.
Dvorak.</p>
</div>
<div class="paragraph">
<p>However while research funding dried up and the term AI became less used, many green shoots were planted and continued more quietly under discipline specific names: <em class="term">cognitive systems</em>
, <em class="term">machine learning</em>
, <em class="term">intelligent
    systems</em>
,[term]_ knowledge representation and
    reasoning_
.
Offshoots of these then made their way into commercial systems, such as expert systems in the <em class="term">Business
    Rules Management System</em>
 (BRMS) market.</p>
</div>
<div class="paragraph">
<p><em class="term">Imperative</em>
, system based languages, languages such as C, C++, Java and C#/.Net have dominated the last 20 years, enabled by the practicality of the languages and ability to run with good performance on commodity hardware.
However many believe there is a renaissance underway in the field of AI, spurred by advances in hardware capabilities and AI research.
In 2005 Heather Havenstein authored <a href="http://www.computerworld.com/s/article/99691/Spring_comes_to_AI_winter">"Spring comes to AI
        winter"</a> which outlines a case for this resurgence.
Norvig and Russel dedicate several pages to what factors allowed the industry to overcome its problems and the research that came about as a result:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Recent years have seen a revolution in both the content and the methodology of work in artificial intelligence.
It is now more common to build on existing theories than to propose brand-new ones, to base claims on rigorous theorems or hard experimental evidence rather than on intuition, and to show relevance to real-world applications rather than toy examples.</p>
</div>
</blockquote>
<div class="attribution">
— Artificial Intelligence: A Modern Approach
</div>
</div>
<div class="paragraph">
<p><em class="term">Computer vision</em>
, <em class="term">neural networks</em>
, <em class="term">machine
        learning</em>
 and <em class="term">knowledge representation and reasoning</em>
 (KRR) have made great strides towards becoming practical in commercial environments.
For example, vision-based systems can now fully map out and navigate their environments with strong recognition skills.
As a result we now have self-driving cars about to enter the commercial market. <em class="term">Ontological</em>
 research, based around description logic, has provided very rich semantics to represent our world.
Algorithms such as the tableaux algorithm have made it possible to use those rich semantics effectively in large complex ontologies.
Early KRR systems, like Prolog in 5GP, were dogged by the limited semantic capabilities and memory restrictions on the size of those ontologies.</p>
</div>
</div>
<div class="sect3">
<h4 id="_knowledge_representation_and_reasoning"><a class="anchor" href="#_knowledge_representation_and_reasoning"></a><a class="link" href="#_knowledge_representation_and_reasoning">5.1.2. Knowledge Representation and Reasoning</a></h4>
<div class="paragraph">
<p>In A Little History talks about AI as a broader subject and touches on Knowledge Representation and Reasoning (KRR) and also Expert Systems, I’ll come back to Expert Systems later.</p>
</div>
<div class="paragraph">
<p>KRR is about how we represent our knowledge in symbolic form, i.e.
how we describe something.
Reasoning is about how we go about the act of thinking using this knowledge.
System based object-oriented languages, like C++, Java and C#, have data definitions called classes for describing the composition and behaviour of modeled entities.
In Java we call exemplars of these described things beans or instances.
However those classification systems are limited to ensure computational efficiency.
Over the years researchers have developed increasingly sophisticated ways to represent our world.
Many of you may already have heard of OWL (Web Ontology Language). There is always a gap between what can be theoretically represented and what can be used computationally in practically timely manner, which is why OWL has different sub-languages from Lite to Full.
It is not believed that any reasoning system can support OWL Full.
However, algorithmic advances continue  to narrow that gap and improve the expressiveness available to reasoning engines.</p>
</div>
<div class="paragraph">
<p>There are also many approaches to how these systems go about thinking.
You may have heard discussions comparing the merits of forward chaining, which is reactive and data driven, with backward chaining, which is passive and query driven.
Many other types of reasoning techniques exist, each of which enlarges the scope of the problems we can tackle declaratively.
To list just a few: imperfect reasoning (fuzzy logic, certainty factors), defeasible logic, belief systems, temporal reasoning and correlation.
You don’t need to understand all these terms to understand and use Drools.
They are just there to give an idea of the range of scope of research topics, which is actually far more extensive, and continues to grow as researchers push new boundaries.</p>
</div>
<div class="paragraph">
<p>KRR is often referred to as the core of Artificial Intelligence.
Even when using biological approaches like neural networks, which model the brain and are more about pattern recognition than thinking, they still build on KRR theory.
My first endeavours with Drools were engineering oriented, as I had no formal training or understanding of KRR.
Learning KRR has allowed me to get a much wider theoretical background,
and to better understand both what I’ve done and where I’m going, as it underpins nearly all of the theoretical side to our Drools R&amp;D.
It really is a vast and fascinating subject that will pay dividends for those who take the time to learn.
I know it did and still does for me.
Bracham and Levesque have written a seminal piece of work, called "Knowledge Representation and Reasoning" that is a must read for anyone wanting to build strong foundations.
I would also recommend the Russel and Norvig book "Artificial Intelligence, a modern approach" which also covers KRR.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rule_engines_and_production_rule_systems_prs"><a class="anchor" href="#_rule_engines_and_production_rule_systems_prs"></a><a class="link" href="#_rule_engines_and_production_rule_systems_prs">5.1.3. Rule Engines and Production Rule Systems (PRS)</a></h4>
<div class="paragraph">
<p>We’ve now covered a brief history of AI and learnt that the core of AI is formed around KRR.
We’ve shown than KRR is a vast and fascinating subject which forms the bulk of the theory driving Drools R&amp;D.</p>
</div>
<div class="paragraph">
<p>The rule engine is the computer program that delivers KRR functionality to the developer.
At a high level it has three components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ontology</p>
</li>
<li>
<p>Rules</p>
</li>
<li>
<p>Data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As previously mentioned the ontology is the representation model we use for our "things". It could use records or Java classes or full-blown OWL based ontologies.
The rules perform the reasoning, i.e., they facilitate "thinking". The distinction between rules and ontologies blurs a little with OWL based ontologies, whose richness is rule based.</p>
</div>
<div class="paragraph">
<p>The term "rules engine" is quite ambiguous in that it can be any system that uses rules, in any form, that can be applied to data to produce outcomes.
This includes simple systems like form validation and dynamic expression engines.
The book "How to Build a Business Rules Engine" (2004) by Malcolm Chisholm exemplifies this ambiguity.
The book is actually about how to build and alter a database schema to hold validation rules.
The book then shows how to generate Visual Basic code from those validation rules to validate data entry.
While perfectly valid, this is very different to what we are talking about.</p>
</div>
<div class="paragraph">
<p>Drools started life as a specific type of rule engine called a Production Rule System (PRS) and was based around the Rete algorithm (usually pronounced as two syllables, e.g., REH-te or RAY-tay). The Rete algorithm, developed by Charles Forgy in 1974, forms the brain of a Production Rule System and is able to scale to a large number of rules and facts.
A Production Rule is a two-part structure: the engine matches facts and data against Production Rules - also called Productions or just Rules - to infer conclusions which result in actions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">when
    &lt;conditions&gt;
then
    &lt;actions&gt;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The process of matching the new or existing facts against Production Rules is called <em class="term">pattern
        matching</em>

, which is performed by the <em class="term">inference engine</em>

.
Actions execute in response to changes in data, like a database trigger; we say this is a <em class="term">data driven</em>

 approach to reasoning.
The actions themselves can change data, which in turn could match against other rules causing them to fire; this is referred to as

forward chaining</p>
</div>
<div class="paragraph">
<p>Drools 5.x implements and extends the <em class="term">Rete</em>

 algorithm.
This extended Rete algorithm is named <em class="term">ReteOO</em>

, signifying that Drools has an enhanced and optimized implementation of the Rete algorithm for object oriented systems.
Other Rete based engines also have marketing terms for their proprietary enhancements to Rete, like RetePlus and Rete III.
The most common enhancements are covered in "Production Matching for Large Learning Systems" (1995) by Robert B.
Doorenbos' thesis, which presents Rete/UL.
Drools 6.x introduces a new lazy algorithm named <em class="term">PHREAK</em>

; which is covered in more detail in the PHREAK algorithm section.</p>
</div>
<div class="paragraph">
<p>The Rules are stored in the

 Production Memory and the facts that the Inference Engine matches against are kept in the

 Working Memory.
Facts are asserted into the Working Memory where they may then be modified or retracted.
A system with a large number of rules and facts may result in many rules being true for the same fact assertion; these rules are said to be in conflict.
The Agenda manages the execution order of these conflicting rules using a Conflict Resolution strategy.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/rule-engine-inkscape.png" alt="rule engine inkscape">
</div>
<div class="title">Figure 122. High-level View of a Production Rule System</div>
</div>
</div>
<div class="sect3">
<h4 id="_hybrid_reasoning_systems_hrs"><a class="anchor" href="#_hybrid_reasoning_systems_hrs"></a><a class="link" href="#_hybrid_reasoning_systems_hrs">5.1.4. Hybrid Reasoning Systems (HRS)</a></h4>
<div class="paragraph">
<p>You may have read discussions comparing the merits of forward chaining (reactive and data driven) or backward chaining (passive query). Here is a quick explanation of these two main types of reasoning.</p>
</div>
<div class="paragraph">
<p>Forward chaining is "data-driven" and thus reactionary, with facts being asserted into working memory, which results in one or more rules being concurrently true and scheduled for execution by the Agenda.
In short, we start with a fact, it propagates through the rules, and we end in a conclusion.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Forward_Chaining.png" alt="Forward Chaining">
</div>
<div class="title">Figure 123. Forward Chaining</div>
</div>
<div class="paragraph">
<p>Backward chaining is "goal-driven", meaning that we start with a conclusion which the engine tries to satisfy.
If it can’t, then it searches for conclusions that it can satisfy.
These are known as subgoals, that will help satisfy some unknown part of the current goal.
It continues this process until either the initial conclusion is proven or there are no more subgoals.
Prolog is an example of a Backward Chaining engine.
Drools can also do backward chaining, which we refer to as derivation queries.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Backward_Chaining.png" alt="Backward Chaining">
</div>
<div class="title">Figure 124. Backward Chaining</div>
</div>
<div class="paragraph">
<p>Historically you would have to make a choice between systems like OPS5 (forward) or Prolog (backward). Nowadays many modern systems provide both types of reasoning capabilities.
There are also many other types of reasoning techniques, each of which enlarges the scope of the problems we can tackle declaratively.
To list just a few: imperfect reasoning (fuzzy logic, certainty factors), defeasible logic, belief systems, temporal reasoning and correlation.
Modern systems are merging these capabilities, and others not listed, to create <em class="term">hybrid reasoning
    systems</em>
 (HRS).</p>
</div>
<div class="paragraph">
<p>While Drools started out as a PRS, 5.x introduced Prolog style backward chaining reasoning as well as some functional programming styles.
For this reason we now prefer the term Hybrid Reasoning System when describing Drools.</p>
</div>
<div class="paragraph">
<p>Drools currently provides crisp reasoning, but imperfect reasoning is almost ready.
Initially this will be imperfect reasoning with fuzzy logic; later we’ll add support for other types of uncertainty.
Work is also under way to bring OWL based ontological reasoning, which will integrate with our <em class="term">traits</em>
 system.
We also continue to improve our functional programming capabilities.</p>
</div>
</div>
<div class="sect3">
<h4 id="_expert_systems"><a class="anchor" href="#_expert_systems"></a><a class="link" href="#_expert_systems">5.1.5. Expert Systems</a></h4>
<div class="paragraph">
<p>You will often hear the terms <em class="term">expert systems</em>
 used to refer to <em class="term">production rule systems</em>
 or <em class="term">Prolog</em>
-like systems.
While this is normally acceptable, it’s technically incorrect as these are frameworks to build expert systems with, rather than expert systems themselves.
It becomes an expert system once there is an ontological model to represent the domain and there are facilities for knowledge acquisition and explanation.</p>
</div>
<div class="paragraph">
<p><em class="term">Mycin</em>
 is the most famous expert system, built during the 70s.
It is still heavily covered in academic literature, such as the recommended book "Expert Systems" by Peter Jackson.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/expertsytem_history.png" alt="expertsytem history">
</div>
<div class="title">Figure 125. Early History of Expert Systems</div>
</div>
</div>
<div class="sect3">
<h4 id="_recommended_reading"><a class="anchor" href="#_recommended_reading"></a><a class="link" href="#_recommended_reading">5.1.6. Recommended Reading</a></h4>
<div class="paragraph">
<p>*
General AI, KRR and Expert System
    Books*</p>
</div>
<div class="paragraph">
<p>For those wanting to get a strong theoretical background in KRR and expert systems, I’d strongly recommend the following books.
"Artificial Intelligence: A Modern Approach" is a must have, for anyone’s bookshelf.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Introduction to Expert Systems</p>
<div class="ulist">
<ul>
<li>
<p>Peter Jackson</p>
</li>
</ul>
</div>
</li>
<li>
<p>Expert Systems: Principles and Programming</p>
<div class="ulist">
<ul>
<li>
<p>Joseph C. Giarratano, Gary D. Riley</p>
</li>
</ul>
</div>
</li>
<li>
<p>Knowledge Representation and Reasoning</p>
<div class="ulist">
<ul>
<li>
<p>Ronald J. Brachman, Hector J. Levesque</p>
</li>
</ul>
</div>
</li>
<li>
<p>Artificial Intelligence : A Modern Approach.</p>
<div class="ulist">
<ul>
<li>
<p>Stuart Russell and Peter Norvig</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/book_recommendations.png" alt="book recommendations">
</div>
<div class="title">Figure 126. Recommended Reading</div>
</div>
<div class="paragraph">
<p>*
Papers*</p>
</div>
<div class="paragraph">
<p>Here are some recommended papers that cover interesting areas in rule engine research:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Production Matching for Large Learning Systems: Rete/UL (1993)</p>
<div class="ulist">
<ul>
<li>
<p>Robert B. Doorenbos</p>
</li>
</ul>
</div>
</li>
<li>
<p>Advances In Rete Pattern Matching</p>
<div class="ulist">
<ul>
<li>
<p>Marshall Schor, Timothy P. Daly, Ho Soo Lee, Beth R. Tibbitts (AAAI 1986)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Collection-Oriented Match</p>
<div class="ulist">
<ul>
<li>
<p>Anurag Acharya and Milind Tambe (1993)</p>
</li>
</ul>
</div>
</li>
<li>
<p>The Leaps Algorithm</p>
<div class="ulist">
<ul>
<li>
<p>Don Batery (1990)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Gator: An Optimized Discrimination Network for Active Database Rule Condition Testing</p>
<div class="ulist">
<ul>
<li>
<p>Eric Hanson , Mohammed S. Hasan (1993)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>*
Drools Books*</p>
</div>
<div class="paragraph">
<p>There are currently three Drools books, all from Packt Publishing.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JBoss Drools Business Rules</p>
<div class="ulist">
<ul>
<li>
<p>Paul Browne</p>
</li>
</ul>
</div>
</li>
<li>
<p>Drools JBoss Rules 5.0 Developers Guide</p>
<div class="ulist">
<ul>
<li>
<p>Michal Bali</p>
</li>
</ul>
</div>
</li>
<li>
<p>Drools Developer’s Cookbook</p>
<div class="ulist">
<ul>
<li>
<p>Lucas Amador</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/drools_book_recommendations.png" alt="drools book recommendations">
</div>
<div class="title">Figure 127. Recommended Reading</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reteoo"><a class="anchor" href="#_reteoo"></a><a class="link" href="#_reteoo">5.2. Rete Algorithm</a></h3>
<div class="paragraph">
<p>The <em>Rete</em> algorithm was invented by Dr.
Charles Forgy and documented in his PhD thesis in 1978-79.
A simplified version of the paper was published in 1982 (<a href="http://citeseer.ist.psu.edu/context/505087/0" class="bare">http://citeseer.ist.psu.edu/context/505087/0</a>). The Latin word "rete" means "net" or "network". The Rete algorithm can be broken into 2 parts: rule compilation and runtime execution.</p>
</div>
<div class="paragraph">
<p>The compilation algorithm describes how the Rules in the Production Memory are processed to generate an efficient discrimination network.
In non-technical terms, a discrimination network is used to filter data as it propagates through the network.
The nodes at the top of the network would have many matches, and as we go down the network, there would be fewer matches.
At the very bottom of the network are the terminal nodes.
In Dr.
Forgy’s 1982 paper, he described 4 basic nodes: root, 1-input, 2-input and terminal.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Rete_Nodes.png" alt="Rete Nodes">
</div>
<div class="title">Figure 128. Rete Nodes</div>
</div>
<div class="paragraph">
<p>The root node is where all objects enter the network.
From there, it immediately goes to the ObjectTypeNode.
The purpose of the ObjectTypeNode is to make sure the engine doesn’t do more work than it needs to.
For example, say we have 2 objects: Account and Order.
If the rule engine tried to evaluate every single node against every object, it would waste a lot of cycles.
To make things efficient, the engine should only pass the object to the nodes that match the object type.
The easiest way to do this is to create an ObjectTypeNode and have all 1-input and 2-input nodes descend from it.
This way, if an application asserts a new Account, it won’t propagate to the nodes for the Order object.
In Drools when an object is asserted it retrieves a list of valid ObjectTypesNodes via a lookup in a HashMap from the object’s Class; if this list doesn’t exist it scans all the ObjectTypeNodes finding valid matches which it caches in the list.
This enables Drools to match against any Class type that matches with an <code>instanceof</code> check.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Object_Type_Nodes.png" alt="Object Type Nodes">
</div>
<div class="title">Figure 129. ObjectTypeNodes</div>
</div>
<div class="paragraph">
<p>ObjectTypeNodes can propagate to AlphaNodes, LeftInputAdapterNodes and BetaNodes.
AlphaNodes are used to evaluate literal conditions.
Although the 1982 paper only covers equality conditions, many RETE implementations support other operations.
For example, <code>Account.name == "Mr
  Trout"</code> is a literal condition.
When a rule has multiple literal conditions for a single object type, they are linked together.
This means that if an application asserts an Account object, it must first satisfy the first literal condition before it can proceed to the next AlphaNode.
In Dr.
Forgy’s paper, he refers to these as IntraElement conditions.
The following diagram shows the AlphaNode combinations for Cheese( name == "cheddar", strength == "strong" ):</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Alpha_Nodes.png" alt="Alpha Nodes">
</div>
<div class="title">Figure 130. AlphaNodes</div>
</div>
<div class="paragraph">
<p>Drools extends Rete by optimizing the propagation from ObjectTypeNode to AlphaNode using hashing.
Each time an AlphaNode is added to an ObjectTypeNode it adds the literal value as a key to the HashMap with the AlphaNode as the value.
When a new instance enters the ObjectType node, rather than propagating to each AlphaNode, it can instead retrieve the correct AlphaNode from the HashMap, thereby avoiding unnecessary literal checks.</p>
</div>
<div class="paragraph">
<p>There are two two-input nodes, JoinNode and NotNode, and both are types of BetaNodes.
BetaNodes are used to compare 2 objects, and their fields, to each other.
The objects may be the same or different types.
By convention we refer to the two inputs as left and right.
The left input for a BetaNode is generally a list of objects; in Drools this is a Tuple.
The right input is a single object.
Two Nodes can be used to implement 'exists' checks.
BetaNodes also have memory.
The left input is called the Beta Memory and remembers all incoming tuples.
The right input is called the Alpha Memory and remembers all incoming objects.
Drools extends Rete by performing indexing on the BetaNodes.
For instance, if we know that a BetaNode is performing a check on a String field, as each object enters we can do a hash lookup on that String value.
This means when facts enter from the opposite side, instead of iterating over all the facts to find valid joins, we do a lookup returning potentially valid candidates.
At any point a valid join is found the Tuple is joined with the Object; which is referred to as a partial match; and then propagated to the next node.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Join_Node.png" alt="Join Node">
</div>
<div class="title">Figure 131. JoinNode</div>
</div>
<div class="paragraph">
<p>To enable the first Object, in the above case Cheese, to enter the network we use a LeftInputNodeAdapter - this takes an Object as an input and propagates a single Object Tuple.</p>
</div>
<div class="paragraph">
<p>Terminal nodes are used to indicate a single rule having matched all its conditions; at this point we say the rule has a full match.
A rule with an 'or' conditional disjunctive connective results in subrule generation for each possible logical branch; thus one rule can have multiple terminal nodes.</p>
</div>
<div class="paragraph">
<p>Drools also performs node sharing.
Many rules repeat the same patterns, and node sharing allows us to collapse those patterns so that they don’t have to be re-evaluated for every single instance.
The following two rules share the first pattern, but not the last:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule
<span class="hljs-keyword">when</span>
    <span class="hljs-constant">Cheese</span>( <span class="hljs-variable">$cheddar</span> <span class="hljs-symbol">:</span> name == <span class="hljs-string">"cheddar"</span> )
    <span class="hljs-variable">$person</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( favouriteCheese == <span class="hljs-variable">$cheddar</span> )
<span class="hljs-keyword">then</span>
    <span class="hljs-constant">System</span>.out.println( <span class="hljs-variable">$person</span>.getName() + <span class="hljs-string">" likes cheddar"</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule
<span class="hljs-keyword">when</span>
    <span class="hljs-constant">Cheese</span>( <span class="hljs-variable">$cheddar</span> <span class="hljs-symbol">:</span> name == <span class="hljs-string">"cheddar"</span> )
    <span class="hljs-variable">$person</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( favouriteCheese != <span class="hljs-variable">$cheddar</span> )
<span class="hljs-keyword">then</span>
    <span class="hljs-constant">System</span>.out.println( <span class="hljs-variable">$person</span>.getName() + <span class="hljs-string">" does not like cheddar"</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see below, the compiled Rete network shows that the alpha node is shared, but the beta nodes are not.
Each beta node has its own TerminalNode.
Had the second pattern been the same it would have also been shared.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Node_Sharing.png" alt="Node Sharing">
</div>
<div class="title">Figure 132. Node Sharing</div>
</div>
</div>
<div class="sect2">
<h3 id="_reteoosection"><a class="anchor" href="#_reteoosection"></a><a class="link" href="#_reteoosection">5.3. ReteOO Algorithm</a></h3>
<div class="paragraph">
<p>The <em>ReteOO</em> was developed throughout the 3, 4 and 5 series releases.
It takes the RETE algorithm and applies well known enhancements, all of which are covered by existing academic literature:</p>
</div>
<div class="paragraph">
<p>Node sharing</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sharing is applied to both the alpha and beta network. The beta network sharing is always from the root pattern.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alpha indexing</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Alpha Nodes with many children use a hash lookup mechanism to avoid testing each result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Beta indexing</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Join, Not and Exist nodes index their memories using a hash. This reduces the join attempts for equal checks. Recently range indexing was added to Not and Exists.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tree based graphs</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Join matches did not contain any references to their parent or children matches. Deletions would have to recalculate all join matches again, which involves recreating all those join match objects, to be able to find the parts of the network where the tuples should be deleted. This is called symmetrical propagation. A tree graph provides parent and children references, so a deletion is just a matter of following those references. This is asymmetrical propagation. The result is faster and makes less impact on the GC. It is also more robust because changes in values will not cause memory leaks if they happen without the engine being notified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Modify-in-place</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Traditional RETE implements a modify as a delete + insert. This causes all join tuples to be GC’d, many of which are recreated again as part of the insert. Modify-in-place instead propagates as a single pass; every node is inspected.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Property reactive</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Also called "new trigger condition". Allows more fine grained reactivity to updates. A Pattern can react to changes to specific properties and ignore others. This alleviates problems of recursion and also helps with performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sub-networks</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Not, Exists and Accumulate can each have nested conditional elements, which forms sub networks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Backward Chaining</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prolog style derivation trees for backward chaining are supported. The implementation is stack based, so does not have method recursion issues for large graphs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lazy Truth Maintenance</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Truth maintenance has a runtime cost which is incurred whether TMS is used or not. Lazy TMS enables it only on first use; further it is activated per object type, so irrelevant object types do not incur the runtime cost.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Heap based agenda</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The agenda uses a binary heap queue to sort rule matches by salience, rather than any linear search or maintenance approach.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dynamic Rules</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rules can be added and removed at runtime, while the engine is still populated with data.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_phreak"><a class="anchor" href="#_phreak"></a><a class="link" href="#_phreak">5.4. PHREAK Algorithm</a></h3>
<div class="paragraph">
<p>Drools 6 introduces a new algorithm, that attempts to address some of the core issues of RETE.
The algorithm is not a rewrite from scratch: it incorporates all of the existing code and enhancements from ReteOO.
While PHREAK is an evolution of the RETE algorithm, it is no longer classified as a RETE implementation.
Once an animal evolves beyond a certain point and key characteristics are changed, the animal becomes classified as a new species; in the same way PHREAK cannot be considered RETE.
There are two key RETE characteristics that strongly identify any derivative strains, regardless of optimizations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>That it is an eager, data oriented algorithm.</p>
</li>
<li>
<p>All work is done using the insert, update or delete actions, eagerly producing all partial matches for all rules.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PHREAK in contrast is characterised as a lazy, goal oriented algorithm, where partial matching is aggressively delayed.</p>
</div>
<div class="paragraph">
<p>This eagerness of RETE can lead to a lot of churn in large systems, and much wasted work,
where "wasted work" is defined as matching efforts that do not result in a rule firing.</p>
</div>
<div class="paragraph">
<p>PHREAK was heavily inspired by a number of algorithms, including (but not limited to) LEAPS, RETE/UL and Collection-Oriented Match.
PHREAK has all enhancements listed in the ReteOO section.
In addition it adds the following set of enhancements, which are explained in more detail in the following paragraphs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Three layers of contextual memory; Node, Segment and Rule memories.</p>
</li>
<li>
<p>Rule, segment and node based linking.</p>
</li>
<li>
<p>Lazy (delayed) rule evaluation.</p>
</li>
<li>
<p>Isolated rule evaluation.</p>
</li>
<li>
<p>Set oriented propagations.</p>
</li>
<li>
<p>Stack based evaluations, with pause and resume.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the PHREAK engine is started all rules are said to be unlinked; no rule evaluation can happen while rules are unlinked.
The insert, update and delete actions are queued before entering the beta network.
A simple heuristic, based on the rule most likely to result in firings, is used to select the next rule for evaluation; this delays the evaluation and firing of the other rules.
Only once a rule has all right inputs populated will the rule be considered linked in, although no work is yet done.
Instead a goal is created, that represents the rule, and placed into a priority queue; which is ordered by salience.
Each queue itself is associated with an AgendaGroup.
Only the active AgendaGroup will inspect its queue, popping the goal for the rule with the highest salience and submitting it for evaluation.
So the work done shifts from the insert, update, delete phase to the fireAllRules phase.
Only the rule for which the goal was created is evaluated, other potential rule evaluations from those facts are delayed.
While individual rules are evaluated, node sharing is still achieved through the process of segmentation, which is explained later.</p>
</div>
<div class="paragraph">
<p>Each successful join attempt in RETE produces a tuple (or token, or partial match) that will be propagated to the child nodes.
For this reason it is characterised as a tuple oriented algorithm.
For each child node that it reaches it will attempt to join with the other side of the node; again each successful join attempt will be propagated straight away.
This creates a descent recursion effect,
thrashing the network of nodes as it ripples up and down, left and right from the point of entry into the beta network to all the reachable leaf nodes.</p>
</div>
<div class="paragraph">
<p>PHREAK propagation is set oriented (or collection-oriented), instead of tuple oriented.
For the rule being evaluated it will visit the first node and process all queued inserts, updates and deletes.
The results are added to a set and the set is propagated to the child node.
In the child node all queued inserts, updates and deletes are processed, adding the results to the same set.
Once finished that set is propagated to the next child node, and so on until the terminal node is reached.
This creates a single pass, pipeline type effect that is isolated to the current rule being evaluated.
This creates a batch process effect which can provide performance advantages for certain rule constructs, such as sub-networks with accumulates.
In the future it will lend itself to being able to exploit multi-core machines in a number of ways.</p>
</div>
<div class="paragraph">
<p>The Linking and Unlinking uses a layered bit mask system, based on a network segmentation.
When the rule network is built segments are created for nodes that are shared by the same set of rules.
A rule itself is made up from a path of segments, although if there is no sharing that will be a single segment.
A bit-mask offset is assigned to each node in the segment.
Also another bit mask (the layering) is assigned to each segment in the rule’s path.
When there is at least one input (data propagation) the node’s bit is set to on.
When each node has its bit set to on the segment’s bit is also set to on.
Conversely if any node’s bit is set to off, the segment is then also set to off.
If each segment in the rule’s path is set to on, the rule is said to be linked in and a goal is created to schedule the rule for evaluation.
The same bit-mask technique is used to also track dirty node, segments and rules; this allows for a rule already linked in to be scheduled for evaluation if it’s considered dirty since it was last evaluated.</p>
</div>
<div class="paragraph">
<p>This ensures that no rule will ever evaluate partial matches, if it’s impossible for it to result in rule instances because one of the joins has no data.
This is possible in RETE and it will merrily churn away producing partial match attempts for all nodes, even if the last join is empty.</p>
</div>
<div class="paragraph">
<p>While the incremental rule evaluation always starts from the root node, the dirty bit masks are used to allow nodes and segments that are not dirty to be skipped.</p>
</div>
<div class="paragraph">
<p>Using the existence of at at least one items of data per node is a fairly basic heuristic.
Future work would attempt to delay the linking even further, using techniques such as arc consistency to determine whether or not matching will result in rule instance firings.</p>
</div>
<div class="paragraph">
<p>Where as RETE has just a singe unit of memory, the node memory, PHREAK has 3 levels of memory.
This allows for much more contextual understanding during evaluation of a Rule.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/LayeredMemory.png" alt="LayeredMemory">
</div>
<div class="title">Figure 133. PHREAK 3 Layered memory system</div>
</div>
<div class="paragraph">
<p>Example 1 shows a single rule with three patterns: A, B and C.
It forms a single segment, with bits 1, 2 and 4 for the nodes.
The single segment has a bit offset of 1.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/segment1.png" alt="segment1">
</div>
<div class="title">Figure 134. Example1: Single rule, no sharing</div>
</div>
<div class="paragraph">
<p>Example 2 demonstrates what happens when another rule is added that shares the pattern A.
A is placed in its own segment, resulting in two segments per rule.
Those two segments form a path for their respective rules.
The first segment is shared by both paths.
When A is linked the segment becomes linked. It then iterates each path the segment is shared by, setting the bit 1 to on.
If B and C are later turned on, the second segment for path R1 is linked in; this causes bit 2 to be turned on for R1.
With bit 1 and bit 2 set to on for R1, the rule is now linked and a goal created to schedule the rule for later evaluation and firing.</p>
</div>
<div class="paragraph">
<p>When a rule is evaluated it is the segments that allow the results of matching to be shared.
Each segment has a staging memory to queue all inserts, updates and deletes for that segment.
If R1 were to be evaluated it would process A and result in a set of tuples.
The algorithm detects that there is a segmentation split and will create peered tuples for each insert, update and delete in the set and add them to R2’s staging memory.
Those tuples will be merged with any existing staged tuples and wait for R2 to eventually be evaluated.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/segment2.png" alt="segment2">
</div>
<div class="title">Figure 135. Example 2: Two rules, with sharing</div>
</div>
<div class="paragraph">
<p>Example 3 adds a third rule and demonstrates what happens when A and B are shared.
Only the bits for the segments are shown this time.
Demonstrating that R4 has 3 segments, R3 has 3 segments and R1 has 2 segments.
A and B are shared by R1, R3 and R4.
While D is shared by R3 and R4.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/segment3.png" alt="segment3">
</div>
<div class="title">Figure 136. Example 3: Three rules, with sharing</div>
</div>
<div class="paragraph">
<p>Sub-networks are formed when a Not, Exists or Accumulate node contains more than one element.
In Example 4 "B not( C )" forms the sub network, note that "not( C )" is a single element which does not require a sub network and is therefore merged inside of the Not node.</p>
</div>
<div class="paragraph">
<p>The sub network gets its own segment.
R1 still has a path of two segments.
The sub network forms another "inner" path.
When the sub network is linked in, it will link in the outer segment.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/segment4.png" alt="segment4">
</div>
<div class="title">Figure 137. Example 4 : Single rule, with sub-network and no sharing</div>
</div>
<div class="paragraph">
<p>Example 5 shows that the sub-network nodes can be shared by a rule that does not have a sub-network.
This results in the sub-network segment being split into two.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/segment5.png" alt="segment5">
</div>
<div class="title">Figure 138. Example 5: Two rules, one with a sub-network and sharing</div>
</div>
<div class="paragraph">
<p>Constrained Not nodes and Accumulate nodes have special behaviour: these can never unlink a segment, and are always considered to have their bits on.</p>
</div>
<div class="paragraph">
<p>All rule evaluations are incremental, and will not waste work recomputing matches already produced.</p>
</div>
<div class="paragraph">
<p>The evaluation algorithm is stack, instead of method recursion, based.
Evaluation can be paused and resumed at any time, via the use of a StackEntry to represent the node currently being evaluated.</p>
</div>
<div class="paragraph">
<p>When a rule evaluation reaches a sub-network a StackEntry is created for the outer path segment and the sub-network segment.
The sub-network segment is evaluated first; when the set reaches the end of the sub-network path it is merged into a staging list for the outer node it feeds into.
The previous StackEntry is then resumed and can now process the results of the sub network.
This has the added benefit that all work is processed in a batch, before propagating to the child node; this is much more efficient for Accumulate nodes.</p>
</div>
<div class="paragraph">
<p>The same stack system can be used for efficient backward chaining.
When a rule evaluation reaches a query node it again pauses the current evaluation, by placing it on the stack.
The query is then evaluated which produces a result set, which is saved in a memory location for the resumed StackEntry to pick up and propagate to the child node.
If the query itself called other queries the process would repeat, with the current query being paused and a new evaluation setup for the current query node.</p>
</div>
<div class="paragraph">
<p>One final point on performance:
One single rule in general will not evaluate any faster with PHREAK than it does with RETE.
For a given rule and same data set, which using a root context object to enable and disable matching, both attempt the same number of matches, produce the same number of rule instances and take roughly the same amount of time,
except for the use case with subnetworks and Accumulates.</p>
</div>
<div class="paragraph">
<p>PHREAK can however be considered more forgiving that RETE for poorly written rule bases and with a more graceful degradation of performance as the number of rules and complexity increases.</p>
</div>
<div class="paragraph">
<p>RETE will also churn away producing partial matches for rules that do not have data in all the joins, whereas PHREAK will avoid this.</p>
</div>
<div class="paragraph">
<p>So it’s not that PHREAK is faster than RETE; it just won’t slow down as much as your system grows :)</p>
</div>
<div class="paragraph">
<p>AgendaGroups did not help in RETE performance, as all rules were evaluated at all times, regardless of the group.
The same is true for salience,
which is why root context objects are often used to limit matching attempts.
PHREAK only evaluates rules for the active AgendaGroup, and within that group will attempt to avoid evaluation of rules (via salience) that do not result in rule instance firings.</p>
</div>
<div class="paragraph">
<p>With PHREAK AgendaGroups and salience now become useful performance tools.
The root context objects are no longer needed and are potentially counterproductive to performance, as they force the flushing and recreation of matches for rules.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_guide"><a class="anchor" href="#_user_guide"></a><a class="link" href="#_user_guide">6. User Guide</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_basics"><a class="anchor" href="#_the_basics"></a><a class="link" href="#_the_basics">6.1. The Basics</a></h3>
<div class="sect3">
<h4 id="_stateless_knowledge_session"><a class="anchor" href="#_stateless_knowledge_session"></a><a class="link" href="#_stateless_knowledge_session">6.1.1. Stateless Knowledge Session</a></h4>
<div class="paragraph">
<p>So where do we get started? There are so many use cases and so much functionality in a rule engine such as Drools that it becomes beguiling.
Have no fear my intrepid adventurer, the complexity is layered and you can ease yourself in with simple use cases.</p>
</div>
<div class="paragraph">
<p>Stateless session, not utilising inference, forms the simplest use case.
A stateless session can be called like a function passing it some data and then receiving some results back.
Some common use cases for stateless sessions are, but not limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Validation</p>
<div class="ulist">
<ul>
<li>
<p>Is this person eligible for a mortgage?</p>
</li>
</ul>
</div>
</li>
<li>
<p>Calculation</p>
<div class="ulist">
<ul>
<li>
<p>Compute a mortgage premium.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Routing and Filtering</p>
<div class="ulist">
<ul>
<li>
<p>Filter incoming messages, such as emails, into folders.</p>
</li>
<li>
<p>Send incoming messages to a destination.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>So let’s start with a very simple example using a driving license application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Applicant</span> </span>{
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> valid;
    <span class="hljs-comment">// getter and setter methods here</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have our data model we can write our first rule.
We assume that the application uses rules to reject invalid applications.
As this is a simple validation use case we will add a single rule to disqualify any applicant younger than 18.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package com.company.license

rule <span class="hljs-string">"Is of valid age"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$a</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Applicant</span>( age &lt; <span class="hljs-number">18</span> )
<span class="hljs-keyword">then</span>
    <span class="hljs-variable">$a</span>.setValid( <span class="hljs-keyword">false</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To make the engine aware of data, so it can be processed against the rules, we have to <em>insert</em> the data, much like with a database.
When the Applicant instance is inserted into the engine it is evaluated against the constraints of the rules, in this case just two constraints for one rule.
We say <em>two</em> because the type Applicant is the first object type constraint, and <code>age &lt; 18</code> is the second field constraint.
An object type constraint plus its zero or more field constraints is referred to as a pattern.
When an inserted instance satisfies both the object type constraint and all the field constraints, it is said to be matched.
The <code>$a</code> is a binding variable which permits us to reference the matched object in the consequence.
There its properties can be updated.
The dollar character ('$') is optional, but it helps to differentiate variable names from field names.
The process of matching patterns against the inserted data is, not surprisingly, often referred to as <em>pattern matching</em>.</p>
</div>
<div class="paragraph">
<p>To use this rule it is necessary to put it a Drools file, just a plain text file with .drl extension , short for "Drools Rule Language". Let’s call this file licenseApplication.drl, and store it in a Kie Project.
A Kie Project has the structure of a normal Maven project with an additional file (kmodule.xml) defining the <code>KieBase</code>s and <code>KieSession</code>s that can be created.
This file has to be placed in the resources/META-INF folder of the Maven project while all the other Drools artifacts, such as the licenseApplication.drl containing the former rule, must be stored in the resources folder or in any other subfolder under it.</p>
</div>
<div class="paragraph">
<p>Since meaningful defaults have been provided for all configuration aspects, the simplest kmodule.xml file can contain just an empty kmodule tag like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">kmodule</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.drools.org/xsd/kmodule"</span>/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point it is possible to create a <code>KieContainer</code> that reads the files to be built, from the classpath.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code snippet compiles all the DRL files found on the classpath and put the result of this compilation, a <code>KieModule</code>, in the <code>KieContainer</code>.
If there are no errors, we are now ready to create our session from the <code>KieContainer</code> and execute against some data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession kSession = kContainer.newStatelessKieSession();
Applicant applicant = <span class="hljs-keyword">new</span> Applicant( <span class="hljs-string">"Mr John Smith"</span>, <span class="hljs-number">16</span> );
assertTrue( applicant.isValid() );
ksession.execute( applicant );
assertFalse( applicant.isValid() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding code executes the data against the rules.
Since the applicant is under the age of 18, the application is marked as invalid.</p>
</div>
<div class="paragraph">
<p>So far we’ve only used a single instance, but what if we want to use more than one? We can execute against any object implementing Iterable, such as a collection.
Let’s add another class called <code>Application</code>, which has the date of the application, and we’ll also move the boolean valid field to the <code>Application</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Applicant</span> </span>{
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;
    <span class="hljs-comment">// getter and setter methods here</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Application</span> </span>{
    <span class="hljs-keyword">private</span> Date dateApplied;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> valid;
    <span class="hljs-comment">// getter and setter methods here</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will also add another rule to validate that the application was made within a period of time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package com.company.license

rule <span class="hljs-string">"Is of valid age"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-constant">Applicant</span>( age &lt; <span class="hljs-number">18</span> )
    <span class="hljs-variable">$a</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Application</span>()
<span class="hljs-keyword">then</span>
    <span class="hljs-variable">$a</span>.setValid( <span class="hljs-keyword">false</span> );
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Application was made this year"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$a</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Application</span>( dateApplied &gt; <span class="hljs-string">"01-jan-2009"</span> )
<span class="hljs-keyword">then</span>
    <span class="hljs-variable">$a</span>.setValid( <span class="hljs-keyword">false</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately a Java array does not implement the <code>Iterable</code> interface, so we have to use the JDK converter method <code>Arrays.asList(…​)</code>.
The code shown below executes against an iterable list, where all collection elements are inserted before any matched rules are fired.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession kSession = kContainer.newStatelessKieSession();
Applicant applicant = <span class="hljs-keyword">new</span> Applicant( <span class="hljs-string">"Mr John Smith"</span>, <span class="hljs-number">16</span> );
Application application = <span class="hljs-keyword">new</span> Application();
assertTrue( application.isValid() );
ksession.execute( Arrays.asList( <span class="hljs-keyword">new</span> Object[] { application, applicant } ) );
assertFalse( application.isValid() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two execute methods <code>execute(Object object)</code> and <code>execute(Iterable objects)</code> are actually convenience methods for the interface <code>BatchExecutor</code>'s method <code>execute(Command command)</code>.</p>
</div>
<div class="paragraph">
<p>The <code>KieCommands</code> commands factory, obtainable from the <code>KieServices</code> like all other factories of the KIE API, is used to create commands, so that the following is equivalent to <code>execute(Iterable it)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.execute( kieServices.getCommands().newInsertElements( Arrays.asList( <span class="hljs-keyword">new</span> Object[] { application, applicant } ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Batch Executor and Command Factory are particularly useful when working with multiple Commands and with output identifiers for obtaining results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieCommands kieCommands = kieServices.getCommands();
List&lt;Command&gt; cmds = <span class="hljs-keyword">new</span> ArrayList&lt;Command&gt;();
cmds.add( kieCommands.newInsert( <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Mr John Smith"</span> ), <span class="hljs-string">"mrSmith"</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">null</span> ) );
cmds.add( kieCommands.newInsert( <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Mr John Doe"</span> ), <span class="hljs-string">"mrDoe"</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">null</span> ) );
BatchExecutionResults results = ksession.execute( kieCommands.newBatchExecution( cmds ) );
assertEquals( <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Mr John Smith"</span> ), results.getValue( <span class="hljs-string">"mrSmith"</span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CommandFactory</code> supports many other Commands that can be used in the <code>BatchExecutor</code> like <code>StartProcess</code>, <code>Query</code>, and <code>SetGlobal</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_stateful_knowledge_session"><a class="anchor" href="#_stateful_knowledge_session"></a><a class="link" href="#_stateful_knowledge_session">6.1.2. Stateful Knowledge Session</a></h4>
<div class="paragraph">
<p>Stateful Sessions are long lived and allow iterative changes over time.
Some common use cases for Stateful Sessions are, but not limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Monitoring</p>
<div class="ulist">
<ul>
<li>
<p>Stock market monitoring and analysis for semi-automatic buying.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Diagnostics</p>
<div class="ulist">
<ul>
<li>
<p>Fault finding, medical diagnostics</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logistics</p>
<div class="ulist">
<ul>
<li>
<p>Parcel tracking and delivery provisioning</p>
</li>
</ul>
</div>
</li>
<li>
<p>Compliance</p>
<div class="ulist">
<ul>
<li>
<p>Validation of legality for market trades.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In contrast to a Stateless Session, the <code>dispose()</code> method must be called afterwards to ensure there are no memory leaks, as the KieBase contains references to Stateful Knowledge Sessions when they are created.
Since Stateful Knowledge Session is the most commonly used session type it is just named <code>KieSession</code> in the KIE API. <code>KieSession</code> also supports the <code>BatchExecutor</code> interface, like <code>StatelessKieSession</code>, the only difference being that the <code>FireAllRules</code> command is not automatically called at the end for a Stateful Session.</p>
</div>
<div class="paragraph">
<p>We illustrate the monitoring use case with an example for raising a fire alarm.
Using just four classes, we represent rooms in a house, each of which has one sprinkler.
If a fire starts in a room, we represent that with a single <code>Fire</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Room</span> </span>{
    <span class="hljs-keyword">private</span> String name
    <span class="hljs-comment">// getter and setter methods here</span>
}
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sprinkler</span> </span>{
    <span class="hljs-keyword">private</span> Room room;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> on;
    <span class="hljs-comment">// getter and setter methods here</span>
}
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fire</span> </span>{
    <span class="hljs-keyword">private</span> Room room;
    <span class="hljs-comment">// getter and setter methods here</span>
}
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Alarm</span> </span>{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous section on Stateless Sessions the concepts of inserting and matching against data were introduced.
That example assumed that only a single instance of each object type was ever inserted and thus only used literal constraints.
However, a house has many rooms, so rules must express relationships between objects, such as a sprinkler being in a certain room.
This is best done by using a binding variable as a constraint in a pattern.
This "join" process results in what is called cross products, which are covered in the next section.</p>
</div>
<div class="paragraph">
<p>When a fire occurs an instance of the <code>Fire</code> class is created, for that room, and inserted into the session.
The rule uses a binding on the <code>room</code> field of the <code>Fire</code> object to constrain matching to the sprinkler for that room, which is currently off.
When this rule fires and the consequence is executed the sprinkler is turned on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"When there is a fire turn on the sprinkler"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-constant">Fire</span>(<span class="hljs-variable">$room</span> <span class="hljs-symbol">:</span> room)
    <span class="hljs-variable">$sprinkler</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Sprinkler</span>( room == <span class="hljs-variable">$room</span>, on == <span class="hljs-keyword">false</span> )
<span class="hljs-keyword">then</span>
    modify( <span class="hljs-variable">$sprinkler</span> ) { setOn( <span class="hljs-keyword">true</span> ) };
    <span class="hljs-constant">System</span>.out.println( <span class="hljs-string">"Turn on the sprinkler for room "</span> + <span class="hljs-variable">$room</span>.getName() );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whereas the Stateless Session uses standard Java syntax to modify a field, in the above rule we use the <code>modify</code> statement, which acts as a sort of "with" statement.
It may contain a series of comma separated Java expressions, i.e., calls to setters of the object selected by the <code>modify</code> statement’s control expression.
This modifies the data, and makes the engine aware of those changes so it can reason over them once more.
This process is called inference, and it’s essential for the working of a Stateful Session.
Stateless Sessions typically do not use inference, so the engine does not need to be aware of changes to data.
Inference can also be turned off explicitly by using the <em>sequential mode</em>.</p>
</div>
<div class="paragraph">
<p>So far we have rules that tell us when matching data exists, but what about when it does <em>not</em> exist? How do we determine that a fire has been extinguished, i.e., that there isn’t a <code>Fire</code> object any more? Previously the constraints have been sentences according to Propositional Logic, where the engine is constraining against individual instances.
Drools also has support for First Order Logic that allows you to look at sets of data.
A pattern under the keyword <code>not</code> matches when something does not exist.
The rule given below turns the sprinkler off as soon as the fire in that room has disappeared.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"When the fire is gone turn off the sprinkler"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$room</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Room</span>( )
    <span class="hljs-variable">$sprinkler</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Sprinkler</span>( room == <span class="hljs-variable">$room</span>, on == <span class="hljs-keyword">true</span> )
    <span class="hljs-keyword">not</span> <span class="hljs-constant">Fire</span>( room == <span class="hljs-variable">$room</span> )
<span class="hljs-keyword">then</span>
    modify( <span class="hljs-variable">$sprinkler</span> ) { setOn( <span class="hljs-keyword">false</span> ) };
    <span class="hljs-constant">System</span>.out.println( <span class="hljs-string">"Turn off the sprinkler for room "</span> + <span class="hljs-variable">$room</span>.getName() );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While there is one sprinkler per room, there is just a single alarm for the building.
An <code>Alarm</code> object is created when a fire occurs, but only one <code>Alarm</code> is needed for the entire building, no matter how many fires occur.
Previously <code>not</code> was introduced to match the absence of a fact; now we use its complement <code>exists</code> which matches for one or more instances of some category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">rule <span class="hljs-string">"Raise the alarm when we have one or more fires"</span>
<span class="hljs-keyword">when</span>
    exists Fire()
<span class="hljs-keyword">then</span>
    insert( <span class="hljs-keyword">new</span> Alarm() );
    System.out.println( <span class="hljs-string">"Raise the alarm"</span> );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Likewise, when there are no fires we want to remove the alarm, so the <code>not</code> keyword can be used again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Cancel the alarm when all the fires have gone"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-keyword">not</span> <span class="hljs-constant">Fire</span>()
    <span class="hljs-variable">$alarm</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Alarm</span>()
<span class="hljs-keyword">then</span>
    delete( <span class="hljs-variable">$alarm</span> );
    <span class="hljs-constant">System</span>.out.println( <span class="hljs-string">"Cancel the alarm"</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally there is a general health status message that is printed when the application first starts and after the alarm is removed and all sprinklers have been turned off.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">rule <span class="hljs-string">"Status output when things are ok"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-keyword">not</span> Alarm()
    <span class="hljs-keyword">not</span> Sprinkler( <span class="hljs-literal">on</span> == <span class="hljs-literal">true</span> )
<span class="hljs-keyword">then</span>
    System.out.println( <span class="hljs-string">"Everything is ok"</span> );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we did in the Stateless Session example, the above rules should be placed in a single DRL file and saved into the resouces folder of your Maven project or any of its subfolder.
As before, we can then obtain a <code>KieSession</code> from the <code>KieContainer</code>.
The only difference is that this time we create a Stateful Session, whereas before we created a Stateless Session.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();
KieContainer kContainer = kieServices.getKieClasspathContainer();
KieSession ksession = kContainer.newKieSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the session created it is now possible to iteratively work with it over time.
Four <code>Room</code> objects are created and inserted, as well as one <code>Sprinkler</code> object for each room.
At this point the engine has done all of its matching, but no rules have fired yet.
Calling <code>ksession.fireAllRules()</code> allows the matched rules to fire, but without a fire that will just produce the health message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String[] names = <span class="hljs-keyword">new</span> String[]{<span class="hljs-string">"kitchen"</span>, <span class="hljs-string">"bedroom"</span>, <span class="hljs-string">"office"</span>, <span class="hljs-string">"livingroom"</span>};
Map&lt;String,Room&gt; name2room = <span class="hljs-keyword">new</span> HashMap&lt;String,Room&gt;();
<span class="hljs-keyword">for</span>( String name: names ){
    Room room = <span class="hljs-keyword">new</span> Room( name );
    name2room.put( name, room );
    ksession.insert( room );
    Sprinkler sprinkler = <span class="hljs-keyword">new</span> Sprinkler( room );
    ksession.insert( sprinkler );
}

ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">&gt; Everything <span class="hljs-keyword">is</span> ok</code></pre>
</div>
</div>
<div class="paragraph">
<p>We now create two fires and insert them; this time a reference is kept for the returned <code>FactHandle</code>.
A Fact Handle is an internal engine reference to the inserted instance and allows instances to be retracted or modified at a later point in time.
With the fires now in the engine, once <code>fireAllRules()</code> is called, the alarm is raised and the respective sprinklers are turned on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Fire kitchenFire = <span class="hljs-keyword">new</span> Fire( name2room.get( <span class="hljs-string">"kitchen"</span> ) );
Fire officeFire = <span class="hljs-keyword">new</span> Fire( name2room.get( <span class="hljs-string">"office"</span> ) );

FactHandle kitchenFireHandle = ksession.insert( kitchenFire );
FactHandle officeFireHandle = ksession.insert( officeFire );

ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">&gt; Raise the alarm
&gt; Turn <span class="hljs-literal">on</span> the sprinkler <span class="hljs-keyword">for</span> room kitchen
&gt; Turn <span class="hljs-literal">on</span> the sprinkler <span class="hljs-keyword">for</span> room office</code></pre>
</div>
</div>
<div class="paragraph">
<p>After a while the fires will be put out and the <code>Fire</code> instances are retracted.
This results in the sprinklers being turned off, the alarm being cancelled, and eventually the health message is printed again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.delete( kitchenFireHandle );
ksession.delete( officeFireHandle );

ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">&gt; Cancel the alarm
&gt; Turn <span class="hljs-literal">off</span> the sprinkler <span class="hljs-keyword">for</span> room office
&gt; Turn <span class="hljs-literal">off</span> the sprinkler <span class="hljs-keyword">for</span> room kitchen
&gt; Everything <span class="hljs-keyword">is</span> ok</code></pre>
</div>
</div>
<div class="paragraph">
<p>Everyone still with me? That wasn’t so hard and already I’m hoping you can start to see the value and power of a declarative rule system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_methods_versus_rules"><a class="anchor" href="#_methods_versus_rules"></a><a class="link" href="#_methods_versus_rules">6.1.3. Methods versus Rules</a></h4>
<div class="paragraph">
<p>People often confuse methods and rules, and new rule users often ask, "How do I call a rule?" After the last section, you are now feeling like a rule expert and the answer to that is obvious, but let’s summarize the differences nonetheless.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">helloWorld</span><span class="hljs-params">(Person person)</span> </span>{
    <span class="hljs-keyword">if</span> ( person.getName().equals( <span class="hljs-string">"Chuck"</span> ) ) {
        System.out.println( <span class="hljs-string">"Hello Chuck"</span> );
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Methods are called directly.</p>
</li>
<li>
<p>Specific instances are passed.</p>
</li>
<li>
<p>One call results in a single execution.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"Hello World"</span> <span class="hljs-function"><span class="hljs-keyword">when</span>
    <span class="hljs-title">Person</span>(<span class="hljs-params"> name == <span class="hljs-string">"Chuck"</span> </span>)
then
    System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params"> <span class="hljs-string">"Hello Chuck"</span> </span>)</span>;
end</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Rules execute by matching against any data as long it is inserted into the engine.</p>
</li>
<li>
<p>Rules can never be called directly.</p>
</li>
<li>
<p>Specific instances cannot be passed to a rule.</p>
</li>
<li>
<p>Depending on the matches, a rule may fire once or several times, or not at all.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_cross_products"><a class="anchor" href="#_cross_products"></a><a class="link" href="#_cross_products">6.1.4. Cross Products</a></h4>
<div class="paragraph">
<p>Earlier the term "cross product" was mentioned, which is the result of a join.
Imagine for a moment that the data from the fire alarm example were used in combination with the following rule where there are no field constraints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Show Sprinklers"</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$room</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Room</span>()
    <span class="hljs-variable">$sprinkler</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Sprinkler</span>()
<span class="hljs-keyword">then</span>
    <span class="hljs-constant">System</span>.out.println( <span class="hljs-string">"room:"</span> + <span class="hljs-variable">$room</span>.getName() +
                        <span class="hljs-string">" sprinkler:"</span> + <span class="hljs-variable">$sprinkler</span>.getRoom().getName() );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In SQL terms this would be like doing <code>select * from Room,
    Sprinkler</code> and every row in the Room table would be joined with every row in the Sprinkler table resulting in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">room</span><span class="hljs-pseudo">:office</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:office</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:office</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:kitchen</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:office</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:livingroom</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:office</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:bedroom</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:kitchen</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:office</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:kitchen</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:kitchen</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:kitchen</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:livingroom</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:kitchen</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:bedroom</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:livingroom</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:office</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:livingroom</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:kitchen</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:livingroom</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:livingroom</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:livingroom</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:bedroom</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:bedroom</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:office</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:bedroom</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:kitchen</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:bedroom</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:livingroom</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:bedroom</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:bedroom</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These cross products can obviously become huge, and they may very well contain spurious data.
The size of cross products is often the source of performance problems for new rule authors.
From this it can be seen that it’s always desirable to constrain the cross products, which is done with the variable constraint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$room</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Room</span>()
    <span class="hljs-variable">$sprinkler</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Sprinkler</span>( room == <span class="hljs-variable">$room</span> )
<span class="hljs-keyword">then</span>
    <span class="hljs-constant">System</span>.out.println( <span class="hljs-string">"room:"</span> + <span class="hljs-variable">$room</span>.getName() +
                        <span class="hljs-string">" sprinkler:"</span> + <span class="hljs-variable">$sprinkler</span>.getRoom().getName() );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in just four rows of data, with the correct Sprinkler for each Room.
In SQL (actually HQL) the corresponding query would be <code>select * from Room, Sprinkler where Room ==
    Sprinkler.room</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">room</span><span class="hljs-pseudo">:office</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:office</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:kitchen</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:kitchen</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:livingroom</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:livingroom</span>
<span class="hljs-tag">room</span><span class="hljs-pseudo">:bedroom</span> <span class="hljs-tag">sprinkler</span><span class="hljs-pseudo">:bedroom</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_execution_control"><a class="anchor" href="#_execution_control"></a><a class="link" href="#_execution_control">6.2. Execution Control</a></h3>
<div class="sect3">
<h4 id="_agenda"><a class="anchor" href="#_agenda"></a><a class="link" href="#_agenda">6.2.1. Agenda</a></h4>
<div class="paragraph">
<p>The Agenda is a <em>Rete</em> feature.
It maintains set of rules that are able to execute, its job is to schedule that execution in a deterministic order.</p>
</div>
<div class="paragraph">
<p>During actions on the <code>RuleRuntime</code>, rules may become fully matched and eligible for execution; a single Rule Runtime Action can result in multiple eligible rules.
When a rule is fully matched a Rule Match is created, referencing the rule and the matched facts, and placed onto the Agenda.
The Agenda controls the execution order of these Matches using a Conflict Resolution strategy.</p>
</div>
<div class="paragraph">
<p>The engine cycles repeatedly through two phases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Rule Runtime Actions. This is where most of the work takes place, either in the Consequence (the RHS itself) or the main Java application process. Once the Consequence has finished or the main Java application process calls <code>fireAllRules()</code> the engine switches to the Agenda Evaluation phase.</p>
</li>
<li>
<p>Agenda Evaluation. This attempts to select a rule to fire. If no rule is found it exits, otherwise it fires the found rule, switching the phase back to Rule Runtime Actions.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/Two_Phase.png" alt="Two Phase">
</div>
<div class="title">Figure 139. Two Phase Execution</div>
</div>
<div class="paragraph">
<p>The process repeats until the agenda is clear, in which case control returns to the calling application.
When Rule Runtime Actions are taking place, no rules are being fired.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rule_matches_and_conflict_sets"><a class="anchor" href="#_rule_matches_and_conflict_sets"></a><a class="link" href="#_rule_matches_and_conflict_sets">6.2.2. Rule Matches and Conflict Sets.</a></h4>
<div class="sect4">
<h5 id="_cashflow_example"><a class="anchor" href="#_cashflow_example"></a><a class="link" href="#_cashflow_example">6.2.2.1. Cashflow Example</a></h5>
<div class="paragraph">
<p>So far the data and the matching process has been simple and small.
To mix things up a bit a new example will be explored that handles cashflow calculations over date periods.
The state of the engine will be illustratively shown at key stages to help get a better understanding of what is actually going on under the hood.
Three classes will be used, as shown below.
This will help us grow our understanding of pattern matching and joins further.
We will then use this to illustrate different techniques for execution control.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CashFlow</span> </span>{
    <span class="hljs-keyword">private</span> Date   date;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> amount;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span>    type;
    <span class="hljs-keyword">long</span>           accountNo;
    <span class="hljs-comment">// getter and setter methods here</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span>   accountNo;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> balance;
    <span class="hljs-comment">// getter and setter methods here</span>
}

<span class="hljs-keyword">public</span> AccountPeriod {
    <span class="hljs-keyword">private</span> Date start;
    <span class="hljs-keyword">private</span> Date end;
    <span class="hljs-comment">// getter and setter methods here</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By now you already know how to create KieBases and how to instantiate facts to populate the <code>KieSession</code>, so tables will be used to show the state of the inserted data, as it makes things clearer for illustration purposes.
The tables below show that a single fact was inserted for the <code>Account</code>.
Also inserted are a series of debits and credits as <code>CashFlow</code> objects for that account, extending over two quarters.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/tables1.png" alt="tables1">
</div>
<div class="title">Figure 140. CashFlows and Account</div>
</div>
<div class="paragraph">
<p>Two rules can be used to determine the debit and credit for that quarter and update the Account balance.
The two rules below constrain the cashflows for an account for a given time period.
Notice the "&amp;&amp;" which use short cut syntax to avoid repeating the field name twice.</p>
</div>
<table class="tableblock frame-void grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"increase balance for credits"</span>
<span class="hljs-keyword">when</span>
  ap <span class="hljs-symbol">:</span> <span class="hljs-constant">AccountPeriod</span>()
  acc <span class="hljs-symbol">:</span> <span class="hljs-constant">Account</span>( <span class="hljs-variable">$accountNo</span> <span class="hljs-symbol">:</span> accountNo )
  <span class="hljs-constant">CashFlow</span>( type == <span class="hljs-constant">CREDIT</span>,
            accountNo == <span class="hljs-variable">$accountNo</span>,
            date &gt;= ap.start &amp;&amp; &lt;= ap.<span class="hljs-keyword">end</span>,
            <span class="hljs-variable">$amount</span> <span class="hljs-symbol">:</span> amount )
<span class="hljs-keyword">then</span>
  acc.balance  += <span class="hljs-variable">$amount</span>;
<span class="hljs-keyword">end</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"decrease balance for debits"</span>
<span class="hljs-keyword">when</span>
  ap <span class="hljs-symbol">:</span> <span class="hljs-constant">AccountPeriod</span>()
  acc <span class="hljs-symbol">:</span> <span class="hljs-constant">Account</span>( <span class="hljs-variable">$accountNo</span> <span class="hljs-symbol">:</span> accountNo )
  <span class="hljs-constant">CashFlow</span>( type == <span class="hljs-constant">DEBIT</span>,
            accountNo == <span class="hljs-variable">$accountNo</span>,
            date &gt;= ap.start &amp;&amp; &lt;= ap.<span class="hljs-keyword">end</span>,
            <span class="hljs-variable">$amount</span> <span class="hljs-symbol">:</span> amount )
<span class="hljs-keyword">then</span>
  acc.balance -= <span class="hljs-variable">$amount</span>;
<span class="hljs-keyword">end</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Earlier we showed how rules would equate to SQL, which can often help people with an SQL background to understand rules.
The two rules above can be represented with two views and a trigger for each view, as below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql"><span class="hljs-operator"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">Account</span> <span class="hljs-keyword">acc</span>,
              Cashflow cf,
              AccountPeriod ap
<span class="hljs-keyword">where</span> <span class="hljs-keyword">acc</span>.accountNo == cf.accountNo <span class="hljs-keyword">and</span>
      cf.<span class="hljs-keyword">type</span> == CREDIT <span class="hljs-keyword">and</span>
      cf.<span class="hljs-built_in">date</span> &gt;= ap.<span class="hljs-keyword">start</span> <span class="hljs-keyword">and</span>
      cf.<span class="hljs-built_in">date</span> &lt;= ap.<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql"><span class="hljs-operator"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">Account</span> <span class="hljs-keyword">acc</span>,
              Cashflow cf,
              AccountPeriod ap
<span class="hljs-keyword">where</span> <span class="hljs-keyword">acc</span>.accountNo == cf.accountNo <span class="hljs-keyword">and</span>
      cf.<span class="hljs-keyword">type</span> == DEBIT <span class="hljs-keyword">and</span>
      cf.<span class="hljs-built_in">date</span> &gt;= ap.<span class="hljs-keyword">start</span> <span class="hljs-keyword">and</span>
      cf.<span class="hljs-built_in">date</span> &lt;= ap.<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">trigger</span> : acc.balance += cf.amount</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">trigger</span> : acc.balance -= cf.amount</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the <code>AccountPeriod</code> is set to the first quarter we constrain the rule "increase balance for credits" to fire on two rows of data and "decrease balance for debits" to act on one row of data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/tables2.png" alt="tables2">
</div>
<div class="title">Figure 141. AccountingPeriod, CashFlows and Account</div>
</div>
<div class="paragraph">
<p>The two cashflow tables above represent the matched data for the two rules.
The data is matched during the insertion stage and, as you discovered in the previous chapter, does not fire straight away, but only after <code>fireAllRules()</code> is called.
Meanwhile, the rule plus its matched data is placed on the Agenda and referred to as an RuIe Match or Rule Instance.
The Agenda is a table of Rule Matches that are able to fire and have their consequences executed, as soon as fireAllRules() is called.
Rule Matches on the Agenda are referred to as a <em class="term">conflict set</em>
 and their execution is determine by a conflict resolution strategy.
Notice that the order of execution so far is considered arbitrary.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/tables7.png" alt="tables7">
</div>
<div class="title">Figure 142. CashFlows and Account</div>
</div>
<div class="paragraph">
<p>After all of the above activations are fired, the account has a balance of -25.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/tables3.png" alt="tables3">
</div>
<div class="title">Figure 143. CashFlows and Account</div>
</div>
<div class="paragraph">
<p>If the <code>AccountPeriod</code> is updated to the second quarter, we have just a single matched row of data, and thus just a single Rule Match on the Agenda.</p>
</div>
<div class="paragraph">
<p>The firing of that Activation results in a balance of 25.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/tables4.png" alt="tables4">
</div>
<div class="title">Figure 144. CashFlows and Account</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/tables5.png" alt="tables5">
</div>
<div class="title">Figure 145. CashFlows and Account</div>
</div>
</div>
<div class="sect4">
<h5 id="_conflict_resolution"><a class="anchor" href="#_conflict_resolution"></a><a class="link" href="#_conflict_resolution">6.2.2.2. Conflict Resolution</a></h5>
<div class="paragraph">
<p>What if you don’t want the order of rule execution to be arbitrary? When there is one or more Rule Match on the Agenda they are said to be in conflict, and a conflict resolution strategy is used to determine the order of execution.
The Drools strategy is very simple and based around a salience value, which assigns a priority to a rule.
Each rule has a default value of 0, the higher the value the higher the priority.</p>
</div>
<div class="paragraph">
<p>As a general rule, it is a good idea not to count on rules firing in any particular order, and to author the rules without worrying about a "flow". However when a flow is needed a number of possibilities exist beyond salience: agenda groups, rule flow groups, activation groups and control/semaphore facts.</p>
</div>
<div class="paragraph">
<p>As of Drools 6.0 rule definition order in the source file is used to set priority after salience.</p>
</div>
</div>
<div class="sect4">
<h5 id="_salience"><a class="anchor" href="#_salience"></a><a class="link" href="#_salience">6.2.2.3. Salience</a></h5>
<div class="paragraph">
<p>To illustrate Salience we add a rule to print the account balance, where we want this rule to be executed after all the debits and credits have been applied for all accounts.
We achieve this by assigning a negative salience to this rule so that it fires after all rules with the default salience 0.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Print balance for AccountPeriod"</span>
        salience -<span class="hljs-number">50</span>
    <span class="hljs-keyword">when</span>
        ap <span class="hljs-symbol">:</span> <span class="hljs-constant">AccountPeriod</span>()
        acc <span class="hljs-symbol">:</span> <span class="hljs-constant">Account</span>()
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">System</span>.out.println( acc.accountNo + <span class="hljs-string">" : "</span> + acc.balance );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The table below depicts the resulting Agenda.
The three debit and credit rules are shown to be in arbitrary order, while the print rule is ranked last, to execute afterwards.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/tables6.png" alt="tables6">
</div>
<div class="title">Figure 146. CashFlows and Account</div>
</div>
</div>
<div class="sect4">
<h5 id="_agenda_groups"><a class="anchor" href="#_agenda_groups"></a><a class="link" href="#_agenda_groups">6.2.2.4. Agenda Groups</a></h5>
<div class="paragraph">
<p>Agenda groups allow you to place rules into groups, and to place those groups onto a stack.
The stack has push/pop bevaviour.
Calling "setFocus" places the group onto the stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getAgenda().getAgendaGroup( <span class="hljs-string">"Group A"</span> ).setFocus();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The agenda always evaluates the top of the stack.
When all the rules have fired for a group, it is popped from the stack and the next group is evaluated.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">rule <span class="hljs-string">"increase balance for credits"</span>
  agenda-group <span class="hljs-string">"calculation"</span>
when
  ap : AccountPeriod()
  acc : Account( $accountNo : accountNo )
  CashFlow( type == CREDIT,
            accountNo == $accountNo,
            date &gt;= ap.start &amp;&amp; &lt;= ap.end,
            $amount : amount )
then
  acc.balance  += $amount;
end</code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">rule <span class="hljs-string">"Print balance for AccountPeriod"</span>
  agenda-group <span class="hljs-string">"report"</span>
when
  ap : AccountPeriod()
  acc : Account()
then
  System.out.println( acc.accountNo +
                      <span class="hljs-string">" : "</span> + acc.balance );
end</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>First set the focus to the "report" group and then by placing the focus on "calculation" we ensure that group is evaluated first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Agenda agenda = ksession.getAgenda();
agenda.getAgendaGroup( <span class="hljs-string">"report"</span> ).setFocus();
agenda.getAgendaGroup( <span class="hljs-string">"calculation"</span> ).setFocus();
ksession.fireAllRules();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_flow"><a class="anchor" href="#_rule_flow"></a><a class="link" href="#_rule_flow">6.2.2.5. Rule Flow</a></h5>
<div class="paragraph">
<p>Drools also features ruleflow-group attributes which allows workflow diagrams to declaratively specify when rules are allowed to fire.
The screenshot below is taken from Eclipse using the Drools plugin.
It has two ruleflow-group nodes which ensures that the calculation rules are executed before the reporting rules.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/ruleflow.png" alt="ruleflow">
</div>
</div>
<div class="paragraph">
<p>The use of the ruleflow-group attribute in a rule is shown below.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"increase balance for credits"</span>
  ruleflow-group <span class="hljs-string">"calculation"</span>
<span class="hljs-keyword">when</span>
  ap <span class="hljs-symbol">:</span> <span class="hljs-constant">AccountPeriod</span>()
  acc <span class="hljs-symbol">:</span> <span class="hljs-constant">Account</span>( <span class="hljs-variable">$accountNo</span> <span class="hljs-symbol">:</span> accountNo )
  <span class="hljs-constant">CashFlow</span>( type == <span class="hljs-constant">CREDIT</span>,
            accountNo == <span class="hljs-variable">$accountNo</span>,
            date &gt;= ap.start &amp;&amp; &lt;= ap.<span class="hljs-keyword">end</span>,
            <span class="hljs-variable">$amount</span> <span class="hljs-symbol">:</span> amount )
<span class="hljs-keyword">then</span>
  acc.balance  += <span class="hljs-variable">$amount</span>;
<span class="hljs-keyword">end</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"Print balance for AccountPeriod"</span>
  ruleflow-<span class="hljs-keyword">group</span> <span class="hljs-string">"report"</span>
<span class="hljs-keyword">when</span>
  ap : AccountPeriod()
  acc : Account()
then
  System.<span class="hljs-keyword">out</span>.println( acc.accountNo +
                      <span class="hljs-string">" : "</span> + acc.balance );
end</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inference"><a class="anchor" href="#_inference"></a><a class="link" href="#_inference">6.3. Inference</a></h3>
<div class="sect3">
<h4 id="_bus_pass_example"><a class="anchor" href="#_bus_pass_example"></a><a class="link" href="#_bus_pass_example">6.3.1. Bus Pass Example</a></h4>
<div class="paragraph">
<p>Inference has a bad name these days, as something not relevant to business use cases and just too complicated to be useful.
It is true that contrived and complicated examples occur with inference, but that should not detract from the fact that simple and useful ones exist too.
But more than this, correct use of inference can crate more agile and less error prone business rules, which are easier to maintain.</p>
</div>
<div class="paragraph">
<p>So what is inference? Something is inferred when we gain knowledge of something from using previous knowledge.
For example, given a Person fact with an age field and a rule that provides age policy control, we can infer whether a Person is an adult or a child and act on this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Infer Adult"</span>
<span class="hljs-keyword">when</span>
  <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( age &gt;= <span class="hljs-number">18</span> )
<span class="hljs-keyword">then</span>
  insert( new <span class="hljs-constant">IsAdult</span>( <span class="hljs-variable">$p</span> ) )
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Due to the preceding rule, every Person who is 18 or over will have an instance of IsAdult inserted for them.
This fact is special in that it is known as a relation.
We can use this inferred relation in any rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$p</span> : Person()
IsAdult( person == <span class="hljs-variable">$p</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>So now we know what inference is, and have a basic example, how does this facilitate good rule design and maintenance?</p>
</div>
<div class="paragraph">
<p>Let’s take a government department that are responsible for issuing ID cards when children become adults, henceforth referred to as ID department.
They might have a decision table that includes logic like this, which says when an adult living in London is 18 or over, issue the card:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/monolithic.png" alt="monolithic">
</div>
</div>
<div class="paragraph">
<p>However the ID department does not set the policy on who an adult is.
That’s done at a central government level.
If the central government were to change that age to 21, this would initiate a change management process.
Someone would have to liaise with the ID department and make sure their systems are updated, in time for the law going live.</p>
</div>
<div class="paragraph">
<p>This change management process and communication between departments is not ideal for an agile environment, and change becomes costly and error prone.
Also the card department is managing more information than it needs to be aware of with its "monolithic" approach to rules management which is "leaking" information better placed elsewhere.
By this I mean that it doesn’t care what explicit <span class="menuseq"><span class="menu">age</span>&nbsp;▸ <span class="menuitem">= 18</span></span> information determines whether someone is an adult, only that they are an adult.</p>
</div>
<div class="paragraph">
<p>In contrast to this, let’s pursue an approach where we split (de-couple) the authoring responsibilities, so that both the central government and the ID department maintain their own rules.</p>
</div>
<div class="paragraph">
<p>It’s the central government’s job to determine who is an adult.
If they change the law they just update their central repository with the new rules, which others use:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/InferIsAdult.png" alt="InferIsAdult">
</div>
</div>
<div class="paragraph">
<p>The IsAdult fact, as discussed previously, is inferred from the policy rules.
It encapsulates the seemingly arbitrary piece of logic <span class="menuseq"><span class="menu">age</span>&nbsp;▸ <span class="menuitem">= 18</span></span> and provides semantic abstractions for its meaning.
Now if anyone uses the above rules, they no longer need to be aware of explicit information that determines whether someone is an adult or not.
They can just use the inferred fact:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/IssueIdCard.png" alt="IssueIdCard">
</div>
</div>
<div class="paragraph">
<p>While the example is very minimal and trivial it illustrates some important points.
We started with a monolithic and leaky approach to our knowledge engineering.
We created a single decision table that had all possible information in it and that leaks information from central government that the ID department did not care about and did not want to manage.</p>
</div>
<div class="paragraph">
<p>We first de-coupled the knowledge process so each department was responsible for only what it needed to know.
We then encapsulated this leaky knowledge using an inferred fact IsAdult.
The use of the term IsAdult also gave a semantic abstraction to the previously arbitrary logic <span class="menuseq"><span class="menu">age</span>&nbsp;▸ <span class="menuitem">= 18</span></span>.</p>
</div>
<div class="paragraph">
<p>So a general rule of thumb when doing your knowledge engineering is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Bad</strong></p>
<div class="ulist">
<ul>
<li>
<p>Monolithic</p>
</li>
<li>
<p>Leaky</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Good</strong></p>
<div class="ulist">
<ul>
<li>
<p>De-couple knowledge responsibilities</p>
</li>
<li>
<p>Encapsulate knowledge</p>
</li>
<li>
<p>Provide semantic abstractions for those encapsulations</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_truth_maintenance_with_logical_objects"><a class="anchor" href="#_truth_maintenance_with_logical_objects"></a><a class="link" href="#_truth_maintenance_with_logical_objects">6.4. Truth Maintenance with Logical Objects</a></h3>
<div class="sect3">
<h4 id="_overview"><a class="anchor" href="#_overview"></a><a class="link" href="#_overview">6.4.1. Overview</a></h4>
<div class="paragraph">
<p>After regular inserts you have to retract facts explicitly.
With <em>logical</em> assertions, the fact that was asserted will be automatically retracted when the conditions that asserted it in the first place are no longer true.
Actually, it’s even cleverer then that, because it will be retracted only if there isn’t any single condition that supports the logical assertion.</p>
</div>
<div class="paragraph">
<p>Normal insertions are said to be <em>stated</em>, i.e., just like the intuitive meaning of "stating a fact" implies.
Using a <code>HashMap</code> and a counter, we track how many times a particular equality is <em>stated</em>; this means we count how many different instances are equal.</p>
</div>
<div class="paragraph">
<p>When we <em>logically</em> insert an object during a RHS execution we are said to <em>justify</em> it, and it is considered to be justified by the firing rule.
For each logical insertion there can only be one equal object, and each subsequent equal logical insertion increases the justification counter for this logical assertion.
A justification is removed by the LHS of the creating rule becoming untrue, and the counter is decreased accordingly.
As soon as we have no more justifications the logical object is automatically retracted.</p>
</div>
<div class="paragraph">
<p>If we try to <em>logically</em> insert an object when there is an equal <em>stated</em> object, this will fail and return null.
If we <em>state</em> an object that has an existing equal object that is <em>justified</em> we override the Fact; how this override works depends on the configuration setting <code>WM_BEHAVIOR_PRESERVE</code>.
When the property is set to discard we use the existing handle and replace the existing instance with the new Object, which is the default behavior; otherwise we override it to <em>stated</em> but we create an new <code>FactHandle</code>.</p>
</div>
<div class="paragraph">
<p>This can be confusing on a first read, so hopefully the flow charts below help.
When it says that it returns a new <code>FactHandle</code>, this also indicates the <code>Object</code> was propagated through the network.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Stated_Assertion.png" alt="Stated Assertion">
</div>
<div class="title">Figure 147. Stated Insertion</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Logical_Assertion.png" alt="Logical Assertion">
</div>
<div class="title">Figure 148. Logical Insertion</div>
</div>
<div class="sect4">
<h5 id="_bus_pass_example_with_inference_and_tms"><a class="anchor" href="#_bus_pass_example_with_inference_and_tms"></a><a class="link" href="#_bus_pass_example_with_inference_and_tms">6.4.1.1. Bus Pass Example With Inference and TMS</a></h5>
<div class="paragraph">
<p>The previous example was issuing ID cards to over 18s, in this example we now issue bus passes, either a child or adult pass.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Issue Child Bus Pass"</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( age &lt; <span class="hljs-number">16</span> )
<span class="hljs-keyword">then</span>
    insert(new <span class="hljs-constant">ChildBusPass</span>( <span class="hljs-variable">$p</span> ) );
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Issue Adult Bus Pass"</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( age &gt;= <span class="hljs-number">16</span> )
<span class="hljs-keyword">then</span>
    insert(new <span class="hljs-constant">AdultBusPass</span>( <span class="hljs-variable">$p</span> ) );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As before the above example is considered monolithic, leaky and providing poor separation of concerns.</p>
</div>
<div class="paragraph">
<p>As before we can provide a more robust application with a separation of concerns using inference.
Notice this time we don’t just insert the inferred object, we use "insertLogical":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Infer Child"</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( age &lt; <span class="hljs-number">16</span> )
<span class="hljs-keyword">then</span>
    insertLogical( new <span class="hljs-constant">IsChild</span>( <span class="hljs-variable">$p</span> ) )
<span class="hljs-keyword">end</span>
rule <span class="hljs-string">"Infer Adult"</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( age &gt;= <span class="hljs-number">16</span> )
<span class="hljs-keyword">then</span>
    insertLogical( new <span class="hljs-constant">IsAdult</span>( <span class="hljs-variable">$p</span> ) )
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A "insertLogical" is part of the Drools Truth Maintenance System (TMS). When a fact is logically inserted, this fact is dependant on the truth of the "when" clause.
It means that when the rule becomes false the fact is automatically retracted.
This works particularly well as the two rules are mutually exclusive.
So in the above rules if the person is under 16 it inserts an IsChild fact, once the person is 16 or over the IsChild fact is automatically retracted and the IsAdult fact inserted.</p>
</div>
<div class="paragraph">
<p>Returning to the code to issue bus passes, these two rules can + logically insert the ChildBusPass and AdultBusPass facts, as the TMS + supports chaining of logical insertions for a cascading set of retracts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Issue Child Bus Pass"</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( )
         <span class="hljs-constant">IsChild</span>( person == <span class="hljs-variable">$p</span> )
<span class="hljs-keyword">then</span>
    insertLogical(new <span class="hljs-constant">ChildBusPass</span>( <span class="hljs-variable">$p</span> ) );
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Issue Adult Bus Pass"</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( age &gt;= <span class="hljs-number">16</span> )
         <span class="hljs-constant">IsAdult</span>( person =<span class="hljs-variable">$p</span> )
<span class="hljs-keyword">then</span>
    insertLogical(new <span class="hljs-constant">AdultBusPass</span>( <span class="hljs-variable">$p</span> ) );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when a person changes from being 15 to 16, not only is the IsChild fact automatically retracted, so is the person’s ChildBusPass fact.
For bonus points we can combine this with the 'not' conditional element to handle notifications, in this situation, a request for the returning of the pass.
So when the TMS automatically retracts the ChildBusPass object, this rule triggers and sends a request to the person:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Return ChildBusPass Request "</span><span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( )
         <span class="hljs-keyword">not</span>( <span class="hljs-constant">ChildBusPass</span>( person == <span class="hljs-variable">$p</span> ) )
<span class="hljs-keyword">then</span>
    requestChildBusPass( <span class="hljs-variable">$p</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_important_note_equality_for_java_objects"><a class="anchor" href="#_important_note_equality_for_java_objects"></a><a class="link" href="#_important_note_equality_for_java_objects">6.4.1.2. Important note: Equality for Java objects</a></h5>
<div class="paragraph">
<p>It is important to note that for Truth Maintenance (and logical assertions) to work at all, your Fact objects (which may be JavaBeans) must override equals and hashCode methods (from java.lang.Object) correctly.
As the truth maintenance system needs to know when two different physical objects are equal in value, <em>both</em> equals and hashCode must be overridden correctly, as per the Java standard.</p>
</div>
<div class="paragraph">
<p>Two objects are equal if and only if their equals methods return true for each other and if their hashCode methods return the same values.
See the Java API for more details (but do keep in mind you <em>MUST</em> override both equals and hashCode).</p>
</div>
<div class="paragraph">
<p>TMS behaviour is not affected by theruntime configuration of Identity vs Equality, TMS is always equality.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deleting_stated_or_logically_asserted_facts_from_the_working_memory"><a class="anchor" href="#_deleting_stated_or_logically_asserted_facts_from_the_working_memory"></a><a class="link" href="#_deleting_stated_or_logically_asserted_facts_from_the_working_memory">6.4.1.3. Deleting stated or logically asserted facts from the working memory</a></h5>
<div class="paragraph">
<p>By default when a fact is deleted from the working memory Drools attempts to remove it both from the set of stated facts and also from the Truth Maintenance System in case it has been logically asserted.
However, using an overload of the delete method, it is also possible to remove it only from one of the 2.
For instance invoking:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">ksession</span><span class="hljs-class">.delete</span>( <span class="hljs-tag">factHandle</span>, <span class="hljs-tag">FactHandle</span><span class="hljs-class">.State</span><span class="hljs-class">.LOGICAL</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>the fact is removed only if it has been logically asserted, but not if it is a stated fact.
In this case, if the fact has been stated its deletion fails silently and it is ignored.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_decision_tables_in_spreadsheets"><a class="anchor" href="#_decision_tables_in_spreadsheets"></a><a class="link" href="#_decision_tables_in_spreadsheets">6.5. Decision Tables in Spreadsheets</a></h3>
<div class="paragraph">
<p>Decision tables are a "precise yet compact" (ref.
Wikipedia) way of representing conditional logic, and are well suited to <em>business</em> level rules.</p>
</div>
<div class="paragraph">
<p>Drools supports managing rules in a spreadsheet format.
Supported formats are Excel (XLS), and CSV, which means that a variety of spreadsheet programs (such as Microsoft Excel, OpenOffice.org Calc amongst others) can be utilized.
It is expected that web based decision table editors will be included in a near future release.</p>
</div>
<div class="paragraph">
<p>Decision tables are an old concept (in software terms) but have proven useful over the years.
Very briefly speaking, in Drools decision tables are a way to generate rules driven from the data entered into a spreadsheet.
All the usual features of a spreadsheet for data capture and manipulation can be taken advantage of.</p>
</div>
<div class="sect3">
<h4 id="_when_to_use_decision_tables"><a class="anchor" href="#_when_to_use_decision_tables"></a><a class="link" href="#_when_to_use_decision_tables">6.5.1. When to Use Decision Tables</a></h4>
<div class="paragraph">
<p>Consider decision tables as a course of action if rules exist that can be expressed as rule templates and data: each row of a decision table provides data that is combined with a template to generate a rule.</p>
</div>
<div class="paragraph">
<p>Many businesses already use spreadsheets for managing data, calculations, etc.
If you are happy to continue this way, you can also manage your business rules this way.
This also assumes you are happy to manage packages of rules in <em class="path">.xls</em>
 or <em class="path">.csv</em>
 files.
Decision tables are not recommended for rules that do not follow a set of templates, or where there are a small number of rules (or if there is a dislike towards software like Excel or OpenOffice.org). They are ideal in the sense that there can be control over what <em>parameters</em> of rules can be edited, without exposing the rules directly.</p>
</div>
<div class="paragraph">
<p>Decision tables also provide a degree of insulation from the underlying object model.</p>
</div>
</div>
<div class="sect3">
<h4 id="_overview_2"><a class="anchor" href="#_overview_2"></a><a class="link" href="#_overview_2">6.5.2. Overview</a></h4>
<div class="paragraph">
<p>Here are some examples of real world decision tables (slightly edited to protect the innocent).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/excel.png" alt="excel">
</div>
<div class="title">Figure 149. Using Excel to edit a decision table</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/actions.png" alt="actions">
</div>
<div class="title">Figure 150. Multiple actions for a rule row</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/open_office.png" alt="open office">
</div>
<div class="title">Figure 151. Using OpenOffice.org</div>
</div>
<div class="paragraph">
<p>In the above examples, the technical aspects of the decision table have been collapsed away (using a standard spreadsheet feature).</p>
</div>
<div class="paragraph">
<p>The rules start from row 17, with each row resulting in a rule.
The conditions are in columns C, D, E, etc., the actions being off-screen.
The values in the cells are quite simple, and their meaning is indicated by the headers in Row 16.
Column B is just a description.
It is customary to use color to make it obvious what the different areas of the table mean.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that although the decision tables look like they process top down, this is not necessarily the case.
Ideally, rules are authored without regard for the order of rows, simply because this makes maintenance easier, as rows will not need to be shifted around all the time.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As each row is a rule, the same principles apply.
As the rule engine processes the facts, any rules that match may fire.
(Some people are confused by this.
It is possible to clear the agenda when a rule fires and simulate a very simple decision table where only the first match effects an action.) Also note that you can have multiple tables on one spreadsheet.
This way, rules can be grouped where they share common templates, yet at the end of the day they are all combined into one rule package.
Decision tables are essentially a tool to generate DRL rules automatically.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/multi_table.png" alt="multi table">
</div>
<div class="title">Figure 152. A real world example using multiple tables for grouping like rules</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_decision_tables_work"><a class="anchor" href="#_how_decision_tables_work"></a><a class="link" href="#_how_decision_tables_work">6.5.3. How Decision Tables Work</a></h4>
<div class="paragraph">
<p>The key point to keep in mind is that in a decision table each row is a rule, and each column in that row is either a condition or action for that rule.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/row_col.png" alt="row col">
</div>
<div class="title">Figure 153. Rows and columns</div>
</div>
<div class="paragraph">
<p>The spreadsheet looks for the <em class="term">RuleTable</em>
 keyword to indicate the start of a rule table (both the starting row and column). Other keywords are also used to define other package level attributes (covered later). It is important to keep the keywords in one column.
By convention the second column ("B") is used for this, but it can be any column (convention is to leave a margin on the left for notes). In the following diagram, C is actually the column where it starts.
Everything to the left of this is ignored.</p>
</div>
<div class="paragraph">
<p>If we expand the hidden sections, it starts to make more sense how it works; note the keywords in column C.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/expanded.png" alt="expanded">
</div>
<div class="title">Figure 154. Expanded for rule templates</div>
</div>
<div class="paragraph">
<p>Now the hidden magic which makes it work can be seen.
The RuleSet keyword indicates the name to be used in the <em>rule package</em> that will encompass all the rules.
This name is optional, using a default, but it <em>must</em> have the <em>RuleSet</em> keyword in the cell immediately to the right.</p>
</div>
<div class="paragraph">
<p>The other keywords visible in Column C are Import and Sequential which will be covered later.
The RuleTable keyword is important as it indicates that a chunk of rules will follow, based on some rule templates.
After the RuleTable keyword there is a name, used to prefix the names of the generated rules.
The sheet name and row numbers are appended to guarantee unique rule names.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The RuleTable name combined with the sheet name must be unique across all spreadsheet files in the same KieBase.
If that’s not the case, some rules might have the same name and only 1 of them will be applied.
To show such ignored rules, <a href="#_changingthedefaultbuildresultseverity">raise the severity of such rule name conflicts</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The column of RuleTable indicates the column in which the rules start; columns to the left are ignored.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In general the keywords make up name-value pairs.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Referring to row 14 (the row immediately after RuleTable), the keywords CONDITION and ACTION indicate that the data in the columns below are for either the LHS or the RHS parts of a rule.
There are other attributes on the rule which can also be optionally set this way.</p>
</div>
<div class="paragraph">
<p>Row 15 contains declarations of <em class="term">ObjectTypes</em>
.
The content in this row is optional, but if this option is not in use, the row must be left blank; however this option is usually found to be quite useful.
When using this row, the values in the cells below (row 16) become constraints on that object type.
In the above case, it generates <code>Person(age=="42")</code> and <code>Cheese(type=="stilton")</code>, where 42 and "stilton" come from row 18.
In the above example, the "==" is implicit; if just a field name is given the translator assumes that it is to generate an exact match.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An ObjectType declaration can span columns (via merged cells), meaning that all columns below the merged range are to be combined into one set of constraints within a single pattern matching a single fact at a time, as opposed to non-merged cells containing the same ObjectType, but resulting in different patterns, potentially matching different or identical facts.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Row 16 contains the rule templates themselves.
They can use the "$param" placeholder to indicate where data from the cells below should be interpolated.
(For multiple insertions, use "$1", "$2", etc., indicating parameters from a comma-separated list in a cell below.) Row 17 is ignored; it may contain textual descriptions of the column’s purpose.</p>
</div>
<div class="paragraph">
<p>Rows 18 and 19 show data, which will be combined (interpolated) with the templates in row 15, to generate rules.
If a cell contains no data, then its template is ignored.
(This would mean that some condition or action does not apply for that rule row.) Rule rows are read until there is a blank row.
Multiple RuleTables can exist in a sheet.
Row 20 contains another keyword, and a value.
The row positions of keywords like this do not matter (most people put them at the top) but their column should be the same one where the RuleTable or RuleSet keywords should appear.
In our case column C has been chosen to be significant, but any other column could be used instead.</p>
</div>
<div class="paragraph">
<p>In the above example, rules would be rendered like the following (as it uses the "ObjectType" row):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>//row 18
rule "Cheese_fans_18"
when
    Person(age=="42")
    Cheese(type=="stilton")
then
    list.add("Old man stilton");
end</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The constraints <code>age=="42"</code> and <code>type=="stilton"</code> are interpreted as single constraints, to be added to the respective ObjectType in the cell above.
If the cells above were spanned, then there could be multiple constraints on one "column".</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Very large decision tables may have very large memory requirements.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_spreadsheet_syntax"><a class="anchor" href="#_spreadsheet_syntax"></a><a class="link" href="#_spreadsheet_syntax">6.5.4. Spreadsheet Syntax</a></h4>
<div class="sect4">
<h5 id="_spreadsheet_structure"><a class="anchor" href="#_spreadsheet_structure"></a><a class="link" href="#_spreadsheet_structure">6.5.4.1. Spreadsheet Structure</a></h5>
<div class="paragraph">
<p>There are two types of rectangular areas defining data that is used for generating a DRL file.
One, marked by a cell labelled <code>RuleSet</code>, defines all DRL items except rules.
The other one may occur repeatedly and is to the right and below a cell whose contents begin with <code>RuleTable</code>.
These areas represent the actual decision tables, each area resulting in a set of rules of similar structure.</p>
</div>
<div class="paragraph">
<p>A Rule Set area may contain cell pairs, one below the <code>RuleSet</code> cell and containing a keyword designating the kind of value contained in the other one that follows in the same row.</p>
</div>
<div class="paragraph">
<p>The columns of a Rule Table area define patterns and constraints for the left hand sides of the rules derived from it, actions for the consequences of the rules, and the values of individual rule attributes.
Thus, a Rule Table area should contain one or more columns, both for conditions and actions, and an arbitrary selection of columns for rule attributes, at most one column for each of these.
The first four rows following the row with the cell marked with <code>RuleTable</code> are earmarked as header area, mostly used for the definition of code to construct the rules.
It is any additional row below these four header rows that spawns another rule, with its data providing for variations in the code defined in the Rule Table header.</p>
</div>
<div class="paragraph">
<p>All keywords are case insensitive.</p>
</div>
<div class="paragraph">
<p>Only the first worksheet is examined for decision tables.</p>
</div>
</div>
<div class="sect4">
<h5 id="_rule_set_entries"><a class="anchor" href="#_rule_set_entries"></a><a class="link" href="#_rule_set_entries">6.5.4.2. Rule Set Entries</a></h5>
<div class="paragraph">
<p>Entries in a Rule Set area may define DRL constructs (except rules), and specify rule attributes.
While entries for constructs may be used repeatedly, each rule attribute may be given at most once, and it applies to all rules unless it is overruled by the same attribute being defined within the Rule Table area.</p>
</div>
<div class="paragraph">
<p>Entries must be given in a vertically stacked sequence of cell pairs.
The first one contains a keyword and the one to its right the value, as shown in the table below.
This sequence of cell pairs may be interrupted by blank rows or even a Rule Table, as long as the column marked by <code>RuleSet</code> is upheld as the one containing the keyword.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Entries in the Rule Set area</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RuleSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The package name for the generated DRL file. Optional, the default is
              <code>rule_table</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must be First entry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sequential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"true" or "false". If "true", then salience is used to ensure that rules fire from the top
              down.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. If omitted, no firing order is imposed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SequentialMaxPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer numeric value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. In sequential mode, this option is used to set the start value of the salience. If omitted, the default value is 65535.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SequentialMinPriority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer numeric value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. In sequential mode this option is used to check if this minimum salience value is not violated. If omitted the default value is 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EscapeQuotes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"true" or "false". If "true", then quotation marks are escaped so that they appear literally in the
              DRL.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. If omitted, quotation marks are escaped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NumericDisabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"true" or "false". If "true", then a String representation is used for DRL instead of a double value
              from a Numeric cell</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, at most once. If omitted, a double value is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma-separated list of Java classes to import.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declarations of DRL globals, i.e., a type followed by a variable name. Multiple global definitions
              must be separated with a comma.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more function definitions, according to DRL syntax.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Queries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more query definitions, according to DRL syntax.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more declarative types, according to DRL syntax.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, may be used repeatedly.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In some locales, MS Office, LibreOffice and OpenOffice will encode a double quote <code>"</code> differently, which will cause a compilation error.
The difference is often hard to see.
For example: <code>“A”</code> will fail, but <code>"A"</code> will work.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For defining rule attributes that apply to all rules in the generated DRL file you can use any of the entries in the following table.
Notice, however, that the proper keyword must be used.
Also, each of these attributes may be used only once.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Rule attributes specified in a Rule Set area will affect all rule assets in the same package (not only in the spreadsheet). Unless you are sure that the spreadsheet is the only one rule asset in the package, the recommendation is to specify rule attributes not in a Rule Set area but in a Rule Table columns for each rule instead.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Rule attribute entries in the Rule Set area</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Initial</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PRIORITY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An integer defining the "salience" value for the rule. Overridden by the "Sequential" flag.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DURATION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A long integer value defining the "duration" value for the rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TIMER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A timer definition. See "Timers and Calendars".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENABLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value. "true" enables the rule; "false" disables the rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALENDARS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A calendars definition. See "Timers and Calendars".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NO-LOOP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value. "true" inhibits looping of rules due to changes made by its consequence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCK-ON-ACTIVE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value. "true" inhibits additional activations of all rules with this flag set within the
              same ruleflow or agenda group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AUTO-FOCUS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean value. "true" for a rule within an agenda group causes activations of the rule to
              automatically give the focus to the group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTIVATION-GROUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying an activation (or XOR) group. Only one rule within an activation group will
              fire, i.e., the first one to fire cancels any existing activations of other rules within the same
              group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AGENDA-GROUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying an agenda group, which has to be activated by giving it the "focus", which is
              one way of controlling the flow between groups of rules.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RULEFLOW-GROUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string identifying a rule-flow group.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_rule_tables"><a class="anchor" href="#_rule_tables"></a><a class="link" href="#_rule_tables">6.5.4.3. Rule Tables</a></h5>
<div class="paragraph">
<p>All Rule Tables begin with a cell containing "RuleTable", optionally followed by a string within the same cell.
The string is used as the initial part of the name for all rules derived from this Rule Table, with the row number appended for distinction.
(This automatic naming can be overridden by using a NAME column.) All other cells defining rules of this Rule Table are below and to the right of this cell.</p>
</div>
<div class="paragraph">
<p>The next row defines the column type, with each column resulting in a part of the condition or the consequence, or providing some rule attribute, the rule name or a comment.
The table below shows which column headers are available; additional columns may be used according to the table showing rule attribute entries given in the preceding section.
Note that each attribute column may be used at most once.
For a column header, either use the keyword or any other word beginning with the letter given in the "Initial" column of these tables.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. Column Headers in the Rule Table</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Initial</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NAME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides the name for the rule generated from that row. The default is constructed from the text
              following the RuleTable tag and the row number.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At most one column</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DESCRIPTION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A text, resulting in a comment within the generated rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At most one column</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONDITION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code snippet and interpolated values for constructing a constraint within a pattern in a
              condition.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one per rule table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACTION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code snippet and interpolated values for constructing an action for the consequence of the
              rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one per rule table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">METADATA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code snippet and interpolated values for constructing a metadata entry for the rule.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional, any number of columns</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Given a column headed CONDITION, the cells in successive lines result in a conditional element.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Text in the first cell below CONDITION develops into a pattern for the rule condition, with the snippet in the next line becoming a constraint. If the cell is merged with one or more neighbours, a single pattern with multiple constraints is formed: all constraints are combined into a parenthesized list and appended to the text in this cell. The cell may be left blank, which means that the code snippet in the next row must result in a valid conditional element on its own.</p>
<div class="paragraph">
<p>To include a pattern without constraints, you can write the pattern in front of the text for another pattern.</p>
</div>
<div class="paragraph">
<p>The pattern may be written with or without an empty pair of parentheses.
A "from" clause may be appended to the pattern.</p>
</div>
<div class="paragraph">
<p>If the pattern ends with "eval", code snippets are supposed to produce boolean expressions for inclusion into a pair of parentheses after "eval".</p>
</div>
</li>
<li>
<p>Text in the second cell below CONDITION is processed in two steps.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The code snippet in this cell is modified by interpolating values from cells farther down in the column. If you want to create a constraint consisting of a comparison using "==" with the value from the cells below, the field selector alone is sufficient. Any other comparison operator must be specified as the last item within the snippet, and the value from the cells below is appended. For all other constraint forms, you must mark the position for including the contents of a cell with the symbol <code>$param</code>. Multiple insertions are possible by using the symbols <code>$1</code>, <code>$2</code>, etc., and a comma-separated list of values in the cells below.</p>
<div class="paragraph">
<p>A text according to the pattern <code>forall(</code><em>delimiter</em><code>){</code><em>snippet</em><code>}</code> is expanded by repeating the <em>snippet</em> once for each of the values of the comma-separated list of values in each of the cells below, inserting the value in place of the symbol <code>$</code> and by joining these expansions by the given <em>delimiter</em>.
Note that the forall construct may be surrounded by other text.</p>
</div>
</li>
<li>
<p>If the cell in the preceding row is not empty, the completed code snippet is added to the conditional element from that cell. A pair of parentheses is provided automatically, as well as a separating comma if multiple constraints are added to a pattern in a merged cell.</p>
<div class="paragraph">
<p>If the cell above is empty, the interpolated result is used as is.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Text in the third cell below CONDITION is for documentation only. It should be used to indicate the column’s purpose to a human reader.</p>
</li>
<li>
<p>From the fourth row on, non-blank entries provide data for interpolation as described above. A blank cell results in the omission of the conditional element or constraint for this rule.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given a column headed ACTION, the cells in successive lines result in an action statement.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Text in the first cell below ACTION is optional. If present, it is interpreted as an object reference.</p>
</li>
<li>
<p>Text in the second cell below ACTION is processed in two steps.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The code snippet in this cell is modified by interpolating values from cells farther down in the column. For a singular insertion, mark the position for including the contents of a cell with the symbol <code>$param</code>. Multiple insertions are possible by using the symbols <code>$1</code>, <code>$2</code>, etc., and a comma-separated list of values in the cells below.</p>
<div class="paragraph">
<p>A method call without interpolation can be achieved by a text without any marker symbols.
In this case, use any non-blank entry in a row below to include the statement.</p>
</div>
<div class="paragraph">
<p>The forall construct is available here, too.</p>
</div>
</li>
<li>
<p>If the first cell is not empty, its text, followed by a period, the text in the second cell and a terminating semicolon are stringed together, resulting in a method call which is added as an action statement for the consequence.</p>
<div class="paragraph">
<p>If the cell above is empty, the interpolated result is used as is.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Text in the third cell below ACTION is for documentation only. It should be used to indicate the column’s purpose to a human reader.</p>
</li>
<li>
<p>From the fourth row on, non-blank entries provide data for interpolation as described above. A blank cell results in the omission of the action statement for this rule.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using <code>$1</code> instead of <code>$param</code> works in most cases, but it will fail if the replacement text contains a comma: then, only the part preceding the first comma is inserted.
Use this "abbreviation" judiciously.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Given a column headed METADATA, the cells in successive lines result in a metadata annotation for the generated rules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Text in the first cell below METADATA is ignored.</p>
</li>
<li>
<p>Text in the second cell below METADATA is subject to interpolation, as described above, using values from the cells in the rule rows. The metadata marker character <code>@</code> is prefixed automatically, and thus it should not be included in the text for this cell.</p>
</li>
<li>
<p>Text in the third cell below METADATA is for documentation only. It should be used to indicate the column’s purpose to a human reader.</p>
</li>
<li>
<p>From the fourth row on, non-blank entries provide data for interpolation as described above. A blank cell results in the omission of the metadata annotation for this rule.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_examples"><a class="anchor" href="#_examples"></a><a class="link" href="#_examples">6.5.4.4. Examples</a></h5>
<div class="paragraph">
<p>The various interpolations are illustrated in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 85. Interpolating cell data</div>
<div class="content">
<div class="paragraph">
<p>If the template is <code>Foo(bar == $param)</code> and the cell is <code>42</code>, then the result is <code>Foo(bar == 42)</code>.</p>
</div>
<div class="paragraph">
<p>If the template is <code>Foo(bar &lt; $1, baz == $2)</code> and the cell contains <code>42,43</code>, the result will be <code>Foo(bar &lt; 42, baz ==43)</code>.</p>
</div>
<div class="paragraph">
<p>The template <code>forall(&amp;&amp;){bar != $}</code> with a cell containing <code>42,43</code> results in <code>bar != 42 &amp;&amp; bar != 43</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The next example demonstrates the joint effect of a cell defining the pattern type and the code snippet below it.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/spanned_column.png" alt="spanned column">
</div>
</div>
<div class="paragraph">
<p>This spreadsheet section shows how the <code>Person</code> type declaration spans 2 columns, and thus both constraints will appear as <code>Person(age == …​, type == …​)</code>.
Since only the field names are present in the snippet, they imply an equality test.</p>
</div>
<div class="paragraph">
<p>In the following example the marker symbol <code>$param</code> is used.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/with_param.png" alt="with param">
</div>
</div>
<div class="paragraph">
<p>The result of this column is the pattern <code>Person(age == "42"))</code>.
You may have noticed that the marker and the operator "==" are redundant.</p>
</div>
<div class="paragraph">
<p>The next example illustrates that a trailing insertion marker can be omitted.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/operator_completion.png" alt="operator completion">
</div>
</div>
<div class="paragraph">
<p>Here, appending the value from the cell is implied, resulting in <code>Person(age &lt; "42")).</code></p>
</div>
<div class="paragraph">
<p>You can provide the definition of a binding variable, as in the example below.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/with_binding.png" alt="with binding">
</div>
</div>
<div class="paragraph">
<p>Here, the result is <code>c: Cheese(type == "stilton").</code> Note that the quotes are provided automatically.
Actually, anything can be placed in the object type row.
Apart from the definition of a binding variable, it could also be an additional pattern that is to be inserted literally.</p>
</div>
<div class="paragraph">
<p>A simple construction of an action statement with the insertion of a single value is shown below.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/consequence.png" alt="consequence">
</div>
</div>
<div class="paragraph">
<p>The cell below the ACTION header is left blank.
Using this style, anything can be placed in the consequence, not just a single method call.
(The same technique is applicable within a CONDITION column as well.)</p>
</div>
<div class="paragraph">
<p>Below is a comprehensive example, showing the use of various column headers.
It is not an error to have no value below a column header (as in the NO-LOOP column): here, the attribute will not be applied in any of the rules.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Key.png" alt="Key">
</div>
<div class="title">Figure 155. Example usage of keywords for imports, headers, etc.</div>
</div>
<div class="paragraph">
<p>And, finally, here is an example of Import, Variables and Functions.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/keywords.png" alt="keywords">
</div>
<div class="title">Figure 156. Example usage of keywords for functions, etc.</div>
</div>
<div class="paragraph">
<p>Multiple package names within the same cell must be separated by a comma.
Also, the pairs of type and variable names must be comma-separated.
Functions, however, must be written as they appear in a DRL file.
This should appear in the same column as the "RuleSet" keyword; it could be above, between or below all the rule rows.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It may be more convenient to use Import, Variables, Functions and Queries repeatedly rather than packing several definitions into a single cell.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_and_integrating_spreadsheet_based_decision_tables"><a class="anchor" href="#_creating_and_integrating_spreadsheet_based_decision_tables"></a><a class="link" href="#_creating_and_integrating_spreadsheet_based_decision_tables">6.5.5. Creating and integrating Spreadsheet based Decision Tables</a></h4>
<div class="paragraph">
<p>The API to use spreadsheet based decision tables is in the drools-decisiontables module.
There is really only one class to look at: <code>SpreadsheetCompiler</code>.
This class will take spreadsheets in various formats, and generate rules in DRL (which you can then use in the normal way). The <code>SpreadsheetCompiler</code> can just be used to generate partial rule files if it is wished, and assemble it into a complete rule package after the fact (this allows the separation of technical and non-technical aspects of the rules if needed).</p>
</div>
<div class="paragraph">
<p>To get started, a sample spreadsheet can be used as a base.
Alternatively, if the plug-in is being used (Rule Workbench IDE), the wizard can generate a spreadsheet from a template (to edit it an xls compatible spreadsheet editor will need to be used).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/wizard.png" alt="wizard">
</div>
<div class="title">Figure 157. Wizard in the IDE</div>
</div>
</div>
<div class="sect3">
<h4 id="_managing_business_rules_in_decision_tables"><a class="anchor" href="#_managing_business_rules_in_decision_tables"></a><a class="link" href="#_managing_business_rules_in_decision_tables">6.5.6. Managing Business Rules in Decision Tables</a></h4>
<div class="sect4">
<h5 id="_workflow_and_collaboration"><a class="anchor" href="#_workflow_and_collaboration"></a><a class="link" href="#_workflow_and_collaboration">6.5.6.1. Workflow and Collaboration</a></h5>
<div class="paragraph">
<p>Spreadsheets are well established business tools (in use for over 25 years). Decision tables lend themselves to close collaboration between IT and domain experts, while making the business rules clear to business analysts, it is an ideal separation of concerns.</p>
</div>
<div class="paragraph">
<p>Typically, the whole process of authoring rules (coming up with a new decision table) would be something like:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Business analyst takes a template decision table (from a repository, or from IT)</p>
</li>
<li>
<p>Decision table business language descriptions are entered in the table(s)</p>
</li>
<li>
<p>Decision table rules (rows) are entered (roughly)</p>
</li>
<li>
<p>Decision table is handed to a technical resource, who maps the business language (descriptions) to scripts (this may involve software development of course, if it is a new application or data model)</p>
</li>
<li>
<p>Technical person hands back and reviews the modifications with the business analyst.</p>
</li>
<li>
<p>The business analyst can continue editing the rule rows as needed (moving columns around is also fine etc).</p>
</li>
<li>
<p>In parallel, the technical person can develop test cases for the rules (liaising with business analysts) as these test cases can be used to verify rules and rule changes once the system is running.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_using_spreadsheet_features"><a class="anchor" href="#_using_spreadsheet_features"></a><a class="link" href="#_using_spreadsheet_features">6.5.6.2. Using spreadsheet features</a></h5>
<div class="paragraph">
<p>Features of applications like Excel can be used to provide assistance in entering data into spreadsheets, such as validating fields.
Lists that are stored in other worksheets can be used to provide valid lists of values for cells, like in the following diagram.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/lists.png" alt="lists">
</div>
</div>
<div class="paragraph">
<p>Some applications provide a limited ability to keep a history of changes, but it is recommended to use an alternative means of revision control.
When changes are being made to rules over time, older versions are archived (many open source solutions exist for this, such as Subversion or Git).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rule_templates"><a class="anchor" href="#_rule_templates"></a><a class="link" href="#_rule_templates">6.5.7. Rule Templates</a></h4>
<div class="paragraph">
<p>Related to decision tables (but not necessarily requiring a spreadsheet) are "Rule Templates" (in the drools-templates module). These use any tabular data source as a source of rule data - populating a template to generate many rules.
This can allow both for more flexible spreadsheets, but also rules in existing databases for instance (at the cost of developing the template up front to generate the rules).</p>
</div>
<div class="paragraph">
<p>With Rule Templates the data is separated from the rule and there are no restrictions on which part of the rule is data-driven.
So whilst you can do everything you could do in decision tables you can also do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>store your data in a database (or any other format)</p>
</li>
<li>
<p>conditionally generate rules based on the values in the data</p>
</li>
<li>
<p>use data for any part of your rules (e.g. condition operator, class name, property name)</p>
</li>
<li>
<p>run different templates over the same data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, a more classic decision table is shown, but without any hidden rows for the rule meta data (so the spreadsheet only contains the raw data to generate the rules).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/template1.png" alt="template1">
</div>
<div class="title">Figure 158. Template data</div>
</div>
<div class="paragraph">
<p>See the <em class="path">ExampleCheese.xls</em> in the examples download for the above spreadsheet.</p>
</div>
<div class="paragraph">
<p>If this was a regular decision table there would be hidden rows before row 1 and between rows 1 and 2 containing rule metadata.
With rule templates the data is completely separate from the rules.
This has two handy consequences - you can apply multiple rule templates to the same data and your data is not tied to your rules at all.
So what does the template look like?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-number">1</span>  <span class="hljs-keyword">template</span> header
<span class="hljs-number">2</span>  age
<span class="hljs-number">3</span>  type
<span class="hljs-number">4</span>  <span class="hljs-built_in">log</span>
<span class="hljs-number">5</span>
<span class="hljs-number">6</span>  package org.drools.examples.templates;
<span class="hljs-number">7</span>
<span class="hljs-number">8</span>  global java.util.List <span class="hljs-built_in">list</span>;
<span class="hljs-number">9</span>
<span class="hljs-number">10</span> <span class="hljs-keyword">template</span> <span class="hljs-string">"cheesefans"</span>
<span class="hljs-number">11</span>
<span class="hljs-number">12</span> rule <span class="hljs-string">"Cheese fans_@{row.rowNumber}"</span>
<span class="hljs-number">13</span> when
<span class="hljs-number">14</span>    Person(age == @{age})
<span class="hljs-number">15</span>    Cheese(type == <span class="hljs-string">"@{type}"</span>)
<span class="hljs-number">16</span> then
<span class="hljs-number">17</span>    <span class="hljs-built_in">list</span>.add(<span class="hljs-string">"@{log}"</span>);
<span class="hljs-number">18</span> end
<span class="hljs-number">19</span>
<span class="hljs-number">20</span> end <span class="hljs-keyword">template</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Annotations to the preceding program listing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 1: All rule templates start with <code>template header</code>.</p>
</li>
<li>
<p>Lines 2-4: Following the header is the list of columns in the order they appear in the data. In this case we are calling the first column <code>age</code>, the second <code>type</code> and the third <code>log</code>.</p>
</li>
<li>
<p>Line 5: An empty line signifies the end of the column definitions.</p>
</li>
<li>
<p>Lines 6-9: Standard rule header text. This is standard rule DRL and will appear at the top of the generated DRL. Put the package statement and any imports and global and function definitions into this section.</p>
</li>
<li>
<p>Line 10: The keyword <code>template</code> signals the start of a rule template. There can be more than one template in a template file, but each template should have a unique name.</p>
</li>
<li>
<p>Lines 11-18: The rule template - see below for details.</p>
</li>
<li>
<p>Line 20: The keywords <code>end template</code> signify the end of the template.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rule templates rely on MVEL to do substitution using the syntax @{token_name}. There is currently one built-in expression, @{row.rowNumber} which gives a unique number for each row of data and enables you to generate unique rule names.
For each row of data a rule will be generated with the values in the data substituted for the tokens in the template.</p>
</div>
<div class="paragraph">
<p>A rule template has to be included in a file with extension .drt and associated to the corresponding decision table when defining the kbase in the kmodule.xml file as in the following example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">kmodule</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://drools.org/xsd/kmodule"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"TemplatesKB"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.drools.examples.templates"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ruleTemplate</span> <span class="hljs-attribute">dtable</span>=<span class="hljs-value">"org/drools/examples/templates/ExampleCheese.xls"</span>
                  <span class="hljs-attribute">template</span>=<span class="hljs-value">"org/drools/examples/templates/Cheese.drt"</span>
                  <span class="hljs-attribute">row</span>=<span class="hljs-value">"2"</span> <span class="hljs-attribute">col</span>=<span class="hljs-value">"2"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"TemplatesKS"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kmodule</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the example data above the following rule file would be generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package org.drools.examples.templates;

global java.util.<span class="hljs-constant">List</span> list;

rule <span class="hljs-string">"Cheese fans_1"</span>
<span class="hljs-keyword">when</span>
  <span class="hljs-constant">Person</span>(age == <span class="hljs-number">42</span>)
  <span class="hljs-constant">Cheese</span>(type == <span class="hljs-string">"stilton"</span>)
<span class="hljs-keyword">then</span>
  list.add(<span class="hljs-string">"Old man stilton"</span>);
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Cheese fans_2"</span>
<span class="hljs-keyword">when</span>
  <span class="hljs-constant">Person</span>(age == <span class="hljs-number">21</span>)
  <span class="hljs-constant">Cheese</span>(type == <span class="hljs-string">"cheddar"</span>)
<span class="hljs-keyword">then</span>
  list.add(<span class="hljs-string">"Young man cheddar"</span>);
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point the <code>KieSession</code> named "TemplatesKS" and containing the rules generated from the template can be simply created from the <code>KieContainer</code> and used as any other <code>KieSession</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = kc.newKieSession( <span class="hljs-string">"TemplatesKS"</span> );

<span class="hljs-comment">// now create some test data</span>
ksession.insert( <span class="hljs-keyword">new</span> Cheese( <span class="hljs-string">"stilton"</span>, <span class="hljs-number">42</span> ) );
ksession.insert( <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"michael"</span>, <span class="hljs-string">"stilton"</span>, <span class="hljs-number">42</span> ) );
<span class="hljs-keyword">final</span> List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();
ksession.setGlobal( <span class="hljs-string">"list"</span>, list );

ksession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_logging"><a class="anchor" href="#_logging"></a><a class="link" href="#_logging">6.6. Logging</a></h3>
<div class="paragraph">
<p>One way to illuminate the black box that is a rule engine, is to play with the logging level.</p>
</div>
<div class="paragraph">
<p>Everything is logged to <a href="http://www.slf4j.org/">SLF4J</a>, which is a simple logging facade that can delegate any log to Logback, Apache Commons Logging, Log4j or java.util.logging.
Add a dependency to the logging adaptor for your logging framework of choice.
If you’re not using any logging framework yet, you can use Logback by adding this Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.x<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you’re developing for an ultra light environment, use <code>slf4j-nop</code> or <code>slf4j-simple</code> instead.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Configure the logging level on the package <code>org.drools</code>.
For example:</p>
</div>
<div class="paragraph">
<p>In Logback, configure it in your <em class="path">logback.xml</em>
 file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">logger</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.drools"</span> <span class="hljs-attribute">level</span>=<span class="hljs-value">"debug"</span>/&gt;</span>

    ...

<span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Log4J, configure it in your <em class="path">log4j.xml</em>
 file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">log4j:configuration</span> <span class="hljs-attribute">xmlns:log4j</span>=<span class="hljs-value">"http://jakarta.apache.org/log4j/"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">category</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.drools"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">priority</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"debug"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">category</span>&gt;</span>

    ...

<span class="hljs-tag">&lt;/<span class="hljs-title">log4j:configuration</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running"><a class="anchor" href="#_running"></a><a class="link" href="#_running">7. Running</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ths sections extends the KIE Running section, which should be read first, with specifics for the Drools runtime.</p>
</div>
<div class="sect2">
<h3 id="_kieruntime_3"><a class="anchor" href="#_kieruntime_3"></a><a class="link" href="#_kieruntime_3">7.1. KieRuntime</a></h3>
<div class="sect3">
<h4 id="_entrypoint"><a class="anchor" href="#_entrypoint"></a><a class="link" href="#_entrypoint">7.1.1. EntryPoint</a></h4>
<div class="paragraph">
<p>The <code>EntryPoint</code> provides the methods around inserting, updating and deleting facts.
The term "entry point" is related to the fact that we have multiple partitions in a Working Memory and you can choose which one you are inserting into.
The use of multiple entry points is more common in event processing use cases, but they can be used by pure rule applications as well.</p>
</div>
<div class="paragraph">
<p>The <code>KieRuntime</code> interface provides the main interaction with the engine.
It is available in rule consequences and process actions.
In this manual the focus is on the methods and interfaces related to rules, and the methods pertaining to processes will be ignored for now.
But you’ll notice that the <code>KieRuntime</code> inherits methods from both the <code>WorkingMemory</code> and the <code>ProcessRuntime</code>, thereby providing a unified API to work with processes and rules.
When working with rules, three interfaces form the <code>KieRuntime</code>: <code>EntryPoint</code>, <code>WorkingMemory</code> and the <code>KieRuntime</code> itself.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/EntryPoint.png" alt="EntryPoint">
</div>
<div class="title">Figure 159. EntryPoint</div>
</div>
<div class="sect4">
<h5 id="_insert"><a class="anchor" href="#_insert"></a><a class="link" href="#_insert">7.1.1.1. Insert</a></h5>
<div class="paragraph">
<p>In order for a fact to be evaluated against the rules in a <code>KieBase</code>, it has to be inserted into the session.
This is done by calling the method <code>insert(yourObject)</code>.
When a fact is inserted into the session, some of its properties might be immediately evaluated (eager evaluation) and some might be deferred for later evaluation (lazy evaluation). The exact behaviour depends on the rules engine algorithm being used.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Expert systems typically use the term <em>assert</em> or <em>assertion</em> to refer to facts made available to the system.
However, due to "assert" being a keyword in most languages, we have decided to use the <code>insert</code> keyword; In this manual, the two terms are used interchangeably.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When an Object is inserted it returns a <code>FactHandle</code>.
This <code>FactHandle</code> is the token used to represent your inserted object within the <code>WorkingMemory</code>.
It is also used for interactions with the <code>WorkingMemory</code> when you wish to delete or modify an object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Cheese stilton = <span class="hljs-keyword">new</span> Cheese(<span class="hljs-string">"stilton"</span>);
FactHandle stiltonHandle = ksession.insert( stilton );</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned in the KieBase section, a Working Memory may operate in two assertion modes: either equality or identity.
Identity is the default.</p>
</div>
<div class="paragraph">
<p><em>Identity</em> means that the Working Memory uses an <code>IdentityHashMap</code> to store all asserted objects.
New instance assertions always result in the return of new <code>FactHandle</code>, but if an instance is asserted again then it returns the original fact handle, i.e., it ignores repeated insertions for the same object.</p>
</div>
<div class="paragraph">
<p><em>Equality</em> means that the Working Memory uses a <code>HashMap</code> to store all asserted objects.
An object instance assertion will only return a new <code>FactHandle</code> if the inserted object is not equal (according to its <code>equal()/hashcode()</code> methods) to an already existing fact.</p>
</div>
</div>
<div class="sect4">
<h5 id="_delete"><a class="anchor" href="#_delete"></a><a class="link" href="#_delete">7.1.1.2. Delete</a></h5>
<div class="paragraph">
<p>In order to remove a fact from the session, the method <code>delete()</code> is used.
When a fact is deleted,  any matches that are active and depend on that fact will be cancelled.
Note that it is possible to have rules that depend on the nonexistence of a fact, in which case deleting a fact may cause a rule to activate.
(See the <code>not</code> and <code>exists</code> keywords).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Expert systems typically use the term <em>retract</em> or <em>retraction</em> to refer to the operation of removing facts from the Working Memory.
Drools prefers the keyword <code>delete</code> for symmetry with the keyword <code>insert</code>; Drools also supports the keyword <code>retract</code>, but it was deprecated in favor of <code>delete</code>.
In this manual, the two terms are used interchangeably.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Retraction may be done using the <code>FactHandle</code> that was returned by the insert call.
On the right hand side of a rule the <code>delete</code> statement is used, which works with a simple object reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Cheese stilton = <span class="hljs-keyword">new</span> Cheese(<span class="hljs-string">"stilton"</span>);
FactHandle stiltonHandle = ksession.insert( stilton );
....
ksession.delete( stiltonHandle );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_update"><a class="anchor" href="#_update"></a><a class="link" href="#_update">7.1.1.3. Update</a></h5>
<div class="paragraph">
<p>The Rule Engine must be notified of modified facts, so that they can be reprocessed.
You must use the <code>update()</code> method to notify the <code>WorkingMemory</code> of changed objects for those objects that are not able to notify the <code>WorkingMemory</code> themselves.
Notice that <code>update()</code> always takes the modified object as a second parameter, which allows you to specify new instances for immutable objects.
On the right hand side of a rule the <code>modify</code> statement is recommended, as it makes the changes and notifies the engine in a single statement.
Alternatively, after changing a fact object’s field values through calls of setter methods you must invoke <code>update</code> immediately, event before changing another fact, or you will cause problems with the indexing within the rule engine.
The modify statement avoids this problem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Cheese stilton = <span class="hljs-keyword">new</span> Cheese(<span class="hljs-string">"stilton"</span>);
FactHandle stiltonHandle = workingMemory.insert( stilton );
...
stilton.setPrice( <span class="hljs-number">100</span> );
workingMemory.update( stiltonHandle, stilton );</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ruleruntime"><a class="anchor" href="#_ruleruntime"></a><a class="link" href="#_ruleruntime">7.1.2. RuleRuntime</a></h4>
<div class="paragraph">
<p>The RuleRuntime provides access to the Agenda, permits query executions, and lets you access named Entry Points.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RuleRuntime.png" alt="RuleRuntime">
</div>
<div class="title">Figure 160. RuleRuntime</div>
</div>
<div class="sect4">
<h5 id="_query"><a class="anchor" href="#_query"></a><a class="link" href="#_query">7.1.2.1. Query</a></h5>
<div class="paragraph">
<p>Queries are used to retrieve fact sets based on patterns, as they are used in rules.
Patterns may make use of optional parameters.
Queries can be defined in the Knowledge Base, from where they are called up to return the matching results.
While iterating over the result collection, any identifier bound in the query can be used to access the corresponding fact or fact field by calling the <code>get</code> method with the binding variable’s name as its argument.
If the binding refers to a fact object, its FactHandle can be retrieved by calling <code>getFactHandle</code>, again with the variable’s name as the parameter.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QueryResults.png" alt="QueryResults">
</div>
<div class="title">Figure 161. QueryResults</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QueryResultsRow.png" alt="QueryResultsRow">
</div>
<div class="title">Figure 162. QueryResultsRow</div>
</div>
<div class="exampleblock">
<div class="title">Example 86. Simple Query Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryResults results =
    ksession.getQueryResults( <span class="hljs-string">"my query"</span>, <span class="hljs-keyword">new</span> Object[] { <span class="hljs-string">"string"</span> } );
<span class="hljs-keyword">for</span> ( QueryResultsRow row : results ) {
    System.out.println( row.get( <span class="hljs-string">"varName"</span> ) );
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_live_queries"><a class="anchor" href="#_live_queries"></a><a class="link" href="#_live_queries">7.1.2.2. Live Queries</a></h5>
<div class="paragraph">
<p>Invoking queries and processing the results by iterating over the returned set is not a good way to monitor changes over time.</p>
</div>
<div class="paragraph">
<p>To alleviate this, Drools provides Live Queries, which have a listener attached instead of returning an iterable result set.
These live queries stay open by creating a view and publishing change events for the contents of this view.
To activate, you start your query with parameters and listen to changes in the resulting view.
The <code>dispose</code> method terminates the query and discontinues this reactive scenario.</p>
</div>
<div class="exampleblock">
<div class="title">Example 87. Implementing ViewChangedEventListener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">final</span> List updated = <span class="hljs-keyword">new</span> ArrayList();
<span class="hljs-keyword">final</span> List removed = <span class="hljs-keyword">new</span> ArrayList();
<span class="hljs-keyword">final</span> List added = <span class="hljs-keyword">new</span> ArrayList();

ViewChangedEventListener listener = <span class="hljs-keyword">new</span> ViewChangedEventListener() {
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rowUpdated</span><span class="hljs-params">(Row row)</span> </span>{
  updated.add( row.get( <span class="hljs-string">"$price"</span> ) );
 }

 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rowRemoved</span><span class="hljs-params">(Row row)</span> </span>{
  removed.add( row.get( <span class="hljs-string">"$price"</span> ) );
 }

 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">rowAdded</span><span class="hljs-params">(Row row)</span> </span>{
  added.add( row.get( <span class="hljs-string">"$price"</span> ) );
 }
};

<span class="hljs-comment">// Open the LiveQuery</span>
LiveQuery query = ksession.openLiveQuery( <span class="hljs-string">"cheeses"</span>,
                                          <span class="hljs-keyword">new</span> Object[] { <span class="hljs-string">"cheddar"</span>, <span class="hljs-string">"stilton"</span> },
                                          listener );
...
...
query.dispose() <span class="hljs-comment">// calling dispose to terminate the live query</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A Drools blog article contains an example of Glazed Lists integration for live queries:</p>
</div>
<div class="paragraph">
<p><a href="http://blog.athico.com/2010/07/glazed-lists-examples-for-drools-live.html" class="bare">http://blog.athico.com/2010/07/glazed-lists-examples-for-drools-live.html</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_statefulrulesession"><a class="anchor" href="#_statefulrulesession"></a><a class="link" href="#_statefulrulesession">7.1.3. StatefulRuleSession</a></h4>
<div class="paragraph">
<p>The <code>StatefulRuleSession</code> is inherited by the <code>KieSession</code> and provides the rule related methods that are relevant from outside of the engine.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/StatefulRuleSession.png" alt="StatefulRuleSession">
</div>
<div class="title">Figure 163. StatefulRuleSession</div>
</div>
<div class="sect4">
<h5 id="_agenda_filters"><a class="anchor" href="#_agenda_filters"></a><a class="link" href="#_agenda_filters">7.1.3.1. Agenda Filters</a></h5>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AgendaFilter.png" alt="AgendaFilter">
</div>
<div class="title">Figure 164. AgendaFilters</div>
</div>
<div class="paragraph">
<p>`
AgendaFilter` objects are optional implementations of the filter interface which are used to allow or deny the firing of a match.
What you filter on is entirely up to the implementation.
Drools 4.0 used to supply some out of the box filters, which have not be exposed in drools 5.0 knowledge-api, but they are simple to implement and the Drools 4.0 code base can be referred to.</p>
</div>
<div class="paragraph">
<p>To use a filter specify it while calling <code>fireAllRules()</code>.
The following example permits only rules ending in the string <code>"Test"</code>.
All others will be filtered out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.fireAllRules( <span class="hljs-keyword">new</span> RuleNameEndsWithAgendaFilter( <span class="hljs-string">"Test"</span> ) );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_agenda_2"><a class="anchor" href="#_agenda_2"></a><a class="link" href="#_agenda_2">7.2. Agenda</a></h3>
<div class="paragraph">
<p>The Agenda is a <em>Rete</em> feature.
During actions on the <code>WorkingMemory</code>, rules may become fully matched and eligible for execution; a single Working Memory Action can result in multiple eligible rules.
When a rule is fully matched a Match is created, referencing the rule and the matched facts, and placed onto the Agenda.
The Agenda controls the execution order of these Matches using a Conflict Resolution strategy.</p>
</div>
<div class="paragraph">
<p>The engine cycles repeatedly through two phases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Working Memory Actions. This is where most of the work takes place, either in the Consequence (the RHS itself) or the main Java application process. Once the Consequence has finished or the main Java application process calls <code>fireAllRules()</code> the engine switches to the Agenda Evaluation phase.</p>
</li>
<li>
<p>Agenda Evaluation. This attempts to select a rule to fire. If no rule is found it exits, otherwise it fires the found rule, switching the phase back to Working Memory Actions.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Two_Phase(1).png" alt="Two Phase">
</div>
<div class="title">Figure 165. Two Phase Execution</div>
</div>
<div class="paragraph">
<p>The process repeats until the agenda is clear, in which case control returns to the calling application.
When Working Memory Actions are taking place, no rules are being fired.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Agenda.png" alt="Agenda">
</div>
<div class="title">Figure 166. Agenda</div>
</div>
<div class="sect3">
<h4 id="_conflict_resolution_2"><a class="anchor" href="#_conflict_resolution_2"></a><a class="link" href="#_conflict_resolution_2">7.2.1. Conflict Resolution</a></h4>
<div class="paragraph">
<p>Conflict resolution is required when there are multiple rules on the agenda.
(The basics to this are covered in chapter "Quick Start".) As firing a rule may have side effects on the working memory, the rule engine needs to know in what order the rules should fire (for instance, firing ruleA may cause ruleB to be removed from the agenda).</p>
</div>
<div class="paragraph">
<p>The default conflict resolution strategies employed by Drools are: Salience and LIFO (last in, first out).</p>
</div>
<div class="paragraph">
<p>The most visible one is <em>salience</em> (or priority), in which case a user can specify that a certain rule has a higher priority (by giving it a higher number) than other rules.
In that case, the rule with higher salience will be preferred.
LIFO priorities are based on the assigned Working Memory Action counter value, with all rules created during the same action receiving the same value.
The execution order of a set of firings with the same priority value is arbitrary.</p>
</div>
<div class="paragraph">
<p>As a general rule, it is a good idea not to count on rules firing in any particular order, and to author the rules without worrying about a "flow". However when a flow is needed a number of possibilities exist, including but not limited to: agenda groups, rule flow groups, activation groups, control/semaphore facts.
These are discussed in later sections.</p>
</div>
<div class="paragraph">
<p>Drools 4.0 supported custom conflict resolution strategies; while this capability still exists in Drools it has not yet been exposed to the end user via knowledge-api in Drools 5.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="_agendagroup"><a class="anchor" href="#_agendagroup"></a><a class="link" href="#_agendagroup">7.2.2. AgendaGroup</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AgendaGroup.png" alt="AgendaGroup">
</div>
<div class="title">Figure 167. AgendaGroup</div>
</div>
<div class="paragraph">
<p>Agenda groups are a way to partition rules (matches, actually) on the agenda.
At any one time, only one group has "focus" which means that matches for rules in that group only will take effect.
You can also have rules with "auto focus" which means that the focus is taken for its agenda group when that rule’s conditions are true.</p>
</div>
<div class="paragraph">
<p>Agenda groups are known as "modules" in CLIPS terminology.
While it best to design rules that do not need control flow, this is not always possible.
Agenda groups provide a handy way to create a "flow" between grouped rules.
You can switch the group which has focus either from within the rule engine, or via the API.
If your rules have a clear need for multiple "phases" or "sequences" of processing, consider using agenda-groups for this purpose.</p>
</div>
<div class="paragraph">
<p>Each time <code>setFocus()</code> is called it pushes that Agenda Group onto a stack.
When the focus group is empty it is popped from the stack and the focus group that is now on top evaluates.
An Agenda Group can appear in multiple locations on the stack.
The default Agenda Group is "MAIN", with all rules which do not specify an Agenda Group being in this group.
It is also always the first group on the stack, given focus initially, by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getAgenda().getAgendaGroup( <span class="hljs-string">"Group A"</span> ).setFocus();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>clear()</code> method can be used to cancel all the activations generated by the rules belonging to a given Agenda Group before one has had a chance to fire.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getAgenda().getAgendaGroup( <span class="hljs-string">"Group A"</span> ).clear();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, due to the lazy nature of the phreak algorithm used by Drools, the activations are by default materialized only at firing time, but it is possible to anticipate the evaluation and then the activation of a given rule at the moment when a fact is inserted into the session by annotating it with <code>@Propagation(IMMEDIATE)</code> as explained in the Propagation modes section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_activationgroup"><a class="anchor" href="#_activationgroup"></a><a class="link" href="#_activationgroup">7.2.3. ActivationGroup</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ActivationGroup.png" alt="ActivationGroup">
</div>
<div class="title">Figure 168. ActivationGroup</div>
</div>
<div class="paragraph">
<p>An activation group is a set of rules bound together by the same "activation-group" rule attribute.
In this group only one rule can fire, and after that rule has fired all the other rules are cancelled from the agenda.
The <code>clear()</code> method can be called at any time, which cancels all of the activations before one has had a chance to fire.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getAgenda().getActivationGroup( <span class="hljs-string">"Group B"</span> ).clear();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ruleflowgroup"><a class="anchor" href="#_ruleflowgroup"></a><a class="link" href="#_ruleflowgroup">7.2.4. RuleFlowGroup</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RuleFlowGroup.png" alt="RuleFlowGroup">
</div>
<div class="title">Figure 169. RuleFlowGroup</div>
</div>
<div class="paragraph">
<p>A rule flow group is a group of rules associated by the "ruleflow-group" rule attribute.
These rules can only fire when the group is activate.
The group itself can only become active when the elaboration of the ruleflow diagram reaches the node representing the group.
Here too, the <code>clear()</code> method can be called at any time to cancels all matches still remaining on the Agenda.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getAgenda().getRuleFlowGroup( <span class="hljs-string">"Group C"</span> ).clear();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_event_model_2"><a class="anchor" href="#_event_model_2"></a><a class="link" href="#_event_model_2">7.3. Event Model</a></h3>
<div class="paragraph">
<p>The event package provides means to be notified of rule engine events, including rules firing, objects being asserted, etc.
This allows you, for instance, to separate logging and auditing activities from the main part of your application (and the rules).</p>
</div>
<div class="paragraph">
<p>The <code>WorkingMemoryEventManager</code> allows for listeners to be added and removed, so that events for the working memory and the agenda can be listened to.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/WorkingMemoryEventManager.png" alt="WorkingMemoryEventManager">
</div>
<div class="title">Figure 170. WorkingMemoryEventManager</div>
</div>
<div class="paragraph">
<p>The following code snippet shows how a simple agenda listener is declared and attached to a session.
It will print matches after they have fired.</p>
</div>
<div class="exampleblock">
<div class="title">Example 88. Adding an AgendaEventListener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( <span class="hljs-keyword">new</span> DefaultAgendaEventListener() {
   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterMatchFired</span><span class="hljs-params">(AfterMatchFiredEvent event)</span> </span>{
       <span class="hljs-keyword">super</span>.afterMatchFired( event );
       System.out.println( event );
   }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Drools also provides <code>DebugRuleRuntimeEventListener</code> and <code>DebugAgendaEventListener</code> which implement each method with a debug print statement.
To print all Working Memory events, you add a listener like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 89. Adding a DebugRuleRuntimeEventListener</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.addEventListener( <span class="hljs-keyword">new</span> DebugRuleRuntimeEventListener() );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The events currently supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MatchCreatedEvent</p>
</li>
<li>
<p>MatchCancelledEvent</p>
</li>
<li>
<p>BeforeMatchFiredEvent</p>
</li>
<li>
<p>AfterMatchFiredEvent</p>
</li>
<li>
<p>AgendaGroupPushedEvent</p>
</li>
<li>
<p>AgendaGroupPoppedEvent</p>
</li>
<li>
<p>ObjectInsertEvent</p>
</li>
<li>
<p>ObjectDeletedEvent</p>
</li>
<li>
<p>ObjectUpdatedEvent</p>
</li>
<li>
<p>ProcessCompletedEvent</p>
</li>
<li>
<p>ProcessNodeLeftEvent</p>
</li>
<li>
<p>ProcessNodeTriggeredEvent</p>
</li>
<li>
<p>ProcessStartEvent</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_statelesskiesession_2"><a class="anchor" href="#_statelesskiesession_2"></a><a class="link" href="#_statelesskiesession_2">7.4. StatelessKieSession</a></h3>
<div class="paragraph">
<p>The <code>StatelessKieSession</code> wraps the <code>KieSession</code>, instead of extending it.
Its main focus is on decision service type scenarios.
It avoids the need to call <code>dispose()</code>.
Stateless sessions do not support iterative insertions and the method call <code>fireAllRules()</code> from Java code; the act of calling <code>execute()</code> is a single-shot method that will internally instantiate a <code>KieSession</code>, add all the user data and execute user commands, call <code>fireAllRules()</code>, and then call <code>dispose()</code>.
While the main way to work with this class is via the <code>BatchExecution</code> (a subinterface of <code>Command</code>) as supported by the <code>CommandExecutor</code> interface, two convenience methods are provided for when simple object insertion is all that’s required.
The <code>CommandExecutor</code> and <code>BatchExecution</code> are talked about in detail in their own section.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/StatelessKieSession(1).png" alt="StatelessKieSession">
</div>
<div class="title">Figure 171. StatelessKieSession</div>
</div>
<div class="paragraph">
<p>Our simple example shows a stateless session executing a given collection of Java objects using the convenience API.
It will iterate the collection, inserting each element in turn.</p>
</div>
<div class="exampleblock">
<div class="title">Example 90. Simple StatelessKieSession execution with a Collection</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ksession.execute( collection );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If this was done as a single Command it would be as follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 91. Simple StatelessKieSession execution with InsertElements Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.execute( CommandFactory.newInsertElements( collection ) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you wanted to insert the collection itself, and the collection’s individual elements, then <code>CommandFactory.newInsert(collection)</code> would do the job.</p>
</div>
<div class="paragraph">
<p>Methods of the <code>CommandFactory</code> create the supported commands, all of which can be marshalled using XStream and the <code>BatchExecutionHelper</code>. <code>BatchExecutionHelper</code> provides details on the XML format as well as how to use Drools Pipeline to automate the marshalling of <code>BatchExecution</code> and <code>ExecutionResults</code>.</p>
</div>
<div class="paragraph">
<p><code>StatelessKieSession</code> supports globals, scoped in a number of ways.
I’ll cover the non-command way first, as commands are scoped to a specific execution call.
Globals can be resolved in three ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The StatelessKieSession method <code>getGlobals()</code> returns a Globals instance which provides access to the session’s globals. These are shared for <em>all</em> execution calls. Exercise caution regarding mutable globals because execution calls can be executing simultaneously in different threads.</p>
<div class="exampleblock">
<div class="title">Example 92. Session scoped global</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
<span class="hljs-comment">// Set a global hbnSession, that can be used for DB interactions in the rules.</span>
ksession.setGlobal( <span class="hljs-string">"hbnSession"</span>, hibernateSession );
<span class="hljs-comment">// Execute while being able to resolve the "hbnSession" identifier.</span>
ksession.execute( collection );</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Using a delegate is another way of global resolution. Assigning a value to a global (with <code>setGlobal(String, Object)</code>) results in the value being stored in an internal collection mapping identifiers to values. Identifiers in this internal collection will have priority over any supplied delegate. Only if an identifier cannot be found in this internal collection, the delegate global (if any) will be used.</p>
</li>
<li>
<p>The third way of resolving globals is to have execution scoped globals. Here, a <code>Command</code> to set a global is passed to the <code>CommandExecutor</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>CommandExecutor</code> interface also offers the ability to export data via "out" parameters.
Inserted facts, globals and query results can all be returned.</p>
</div>
<div class="exampleblock">
<div class="title">Example 93. Out identifiers</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// Set up a list of commands</span>
List cmds = <span class="hljs-keyword">new</span> ArrayList();
cmds.add( CommandFactory.newSetGlobal( <span class="hljs-string">"list1"</span>, <span class="hljs-keyword">new</span> ArrayList(), <span class="hljs-keyword">true</span> ) );
cmds.add( CommandFactory.newInsert( <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"jon"</span>, <span class="hljs-number">102</span> ), <span class="hljs-string">"person"</span> ) );
cmds.add( CommandFactory.newQuery( <span class="hljs-string">"Get People"</span> <span class="hljs-string">"getPeople"</span> );

<span class="hljs-comment">// Execute the list</span>
ExecutionResults results =
  ksession.execute( CommandFactory.newBatchExecution( cmds ) );

<span class="hljs-comment">// Retrieve the ArrayList</span>
results.getValue( <span class="hljs-string">"list1"</span> );
<span class="hljs-comment">// Retrieve the inserted Person fact</span>
results.getValue( <span class="hljs-string">"person"</span> );
<span class="hljs-comment">// Retrieve the query as a QueryResults instance.</span>
results.getValue( <span class="hljs-string">"Get People"</span> );</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sequential_mode"><a class="anchor" href="#_sequential_mode"></a><a class="link" href="#_sequential_mode">7.4.1. Sequential Mode</a></h4>
<div class="paragraph">
<p>With Rete you have a stateful session where objects can be asserted and modified over time, and where rules can also be added and removed.
Now what happens if we assume a stateless session, where after the initial data set no more data can be asserted or modified and rules cannot be added or removed? Certainly it won’t be necessary to re-evaluate rules, and the engine will be able to operate in a simplified way.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Order the Rules by salience and position in the ruleset (by setting a sequence attribute on the rule terminal node).</p>
</li>
<li>
<p>Create an elements, one element for each possible rule match; element position indicates firing order.</p>
</li>
<li>
<p>Turn off all node memories, except the right-input Object memory.</p>
</li>
<li>
<p>Disconnect the Left Input Adapter Node propagation, and let the Object plus the Node be referenced in a Command object, which is added to a list on the Working Memory for later execution.</p>
</li>
<li>
<p>Assert all objects, and, when all assertions are finished and thus right-input node memories are populated, check the Command list and execute each in turn.</p>
</li>
<li>
<p>All resulting Matches should be placed in the elements, based upon the determined sequence number of the Rule. Record the first and last populated elements, to reduce the iteration range.</p>
</li>
<li>
<p>Iterate the elements of Matches, executing populated element in turn.</p>
</li>
<li>
<p>If we have a maximum number of allowed rule executions, we can exit our network evaluations early to fire all the rules in the elements.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>LeftInputAdapterNode</code> no longer creates a Tuple, adding the Object, and then propagate the Tuple – instead a Command object is created and added to a list in the Working Memory.
This Command object holds a reference to the <code>LeftInputAdapterNode</code> and the propagated object.
This stops any left-input propagations at insertion time, so that we know that a right-input propagation will never need to attempt a join with the left-inputs (removing the need for left-input memory). All nodes have their memory turned off, including the left-input Tuple memory but excluding the right-input object memory, which means that the only node remembering an insertion propagation is the right-input object memory.
Once all the assertions are finished and all right-input memories populated, we can then iterate the list of <code>LeftInputAdatperNode</code> Command objects calling each in turn.
They will propagate down the network attempting to join with the right-input objects, but they won’t be remembered in the left input as we know there will be no further object assertions and thus propagations into the right-input memory.</p>
</div>
<div class="paragraph">
<p>There is no longer an Agenda, with a priority queue to schedule the Tuples; instead, there is simply an elements for the number of rules.
The sequence number of the <code>RuleTerminalNode</code> indicates the element within the elements where to place the Match.
Once all Command objects have finished we can iterate our elements, checking each element in turn, and firing the Matches if they exist.
To improve performance, we remember the first and the last populated cell in the elements.
The network is constructed, with each <code>RuleTerminalNode</code> being given a sequence number based on a salience number and its order of being added to the network.</p>
</div>
<div class="paragraph">
<p>Typically the right-input node memories are Hash Maps, for fast object deletion; here, as we know there will be no object deletions, we can use a list when the values of the object are not indexed.
For larger numbers of objects indexed Hash Maps provide a performance increase; if we know an object type has only a few instances, indexing is probably not advantageous, and a list can be used.</p>
</div>
<div class="paragraph">
<p>Sequential mode can only be used with a Stateless Session and is off by default.
To turn it on, either call <code>RuleBaseConfiguration.setSequential(true)</code>, or set the rulebase configuration property <code>drools.sequential</code> to true.
Sequential mode can fall back to a dynamic agenda by calling <code>setSequentialAgenda</code> with <code>SequentialAgenda.DYNAMIC</code>.
You may also set the "drools.sequential.agenda" property to "sequential" or "dynamic".</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rule_execution_modes"><a class="anchor" href="#_rule_execution_modes"></a><a class="link" href="#_rule_execution_modes">7.5. Rule Execution Modes</a></h3>
<div class="paragraph">
<p>Drools provides two modes for rule execution - passive and active.</p>
</div>
<div class="paragraph">
<p>As a general guideline, Passive Mode is most suitable for Rule Engine applications which need to explicitly control when the engine shall evaluate and fire the rules, or for CEP applications making use of the Pseudo Clock. Active Mode is most effective for Rule Engine applications which delegate control of when rules are evaluated and fired to the engine, or for typical CEP application making use of the Real Time Clock.</p>
</div>
<div class="sect3">
<h4 id="_passive_mode"><a class="anchor" href="#_passive_mode"></a><a class="link" href="#_passive_mode">7.5.1. Passive Mode</a></h4>
<div class="paragraph">
<p>With Passive mode not only is the user responsible for working memory operations, such as <code>insert()</code>, but also for when the rules are to evaluate the data and fire the resulting rule instantiations - using <code>fireAllRules()</code>  .</p>
</div>
<div class="paragraph">
<p>An example outline of Drools code for a CEP application making use of Passive Mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get(<span class="hljs-string">"pseudo"</span>) );
KieSession session = kbase.newKieSession( conf, <span class="hljs-keyword">null</span> );
SessionPseudoClock clock = session.getSessionClock();

session.insert( tick1 );
session.fireAllRules();

clock.advanceTime(<span class="hljs-number">1</span>, TimeUnit.SECONDS);
session.insert( tick2 );
session.fireAllRules();

clock.advanceTime(<span class="hljs-number">1</span>, TimeUnit.SECONDS);
session.insert( tick3 );
session.fireAllRules();

session.dispose();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_active_mode"><a class="anchor" href="#_active_mode"></a><a class="link" href="#_active_mode">7.5.2. Active Mode</a></h4>
<div class="paragraph">
<p>Drools offers a <code>fireUntilHalt()</code> method, that starts the engine in Active Mode, which is asynchronous in behavior, where rules will be continually evaluated and fired, until a <code>halt()</code> call is made.</p>
</div>
<div class="paragraph">
<p>This is specially useful for CEP scenarios that require what is commonly known as "active queries".</p>
</div>
<div class="paragraph">
<p>Please note calling <code>fireUntilHalt()</code> blocks the current thread, while the engine will start and continue running asynchronously until the <code>halt()</code> is called on the KieSession. It is suggested therefore to call <code>fireUntilHalt()</code> from a dedicated thread, so the current thread does not get blocked indefinitely; this also enable the current thread to call <code>halt()</code> at a later stage, ref. examples below.</p>
</div>
<div class="paragraph">
<p>An example outline of Drools code for a CEP application making use of Active Mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get(<span class="hljs-string">"realtime"</span>) );
KieSession session = kbase.newKieSession( conf, <span class="hljs-keyword">null</span> );

<span class="hljs-keyword">new</span> Thread( <span class="hljs-keyword">new</span> Runnable() {
  <span class="hljs-annotation">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
      session.fireUntilHalt();
  }
} ).start();

session.insert( tick1 );

... Thread.sleep( <span class="hljs-number">1000L</span> ); ...

session.insert( tick2 );

... Thread.sleep( <span class="hljs-number">1000L</span> ); ...

session.insert( tick3 );

session.halt();
session.dispose();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Generally, it is not recommended mixing <code>fireAllRules()</code> and <code>fireUntilHalt()</code>, especially from different threads. However the engine is able to handle such situations safely, thanks to the internal state machine. If <code>fireAllRules()</code> is running and a call <code>fireUntilHalt()</code> is made, the engine will wait until the <code>fireAllRules()</code> is finished and then start <code>fireUntilHalt()</code>. However if <code>fireUntilHalt()</code> is running and <code>fireAllRules()</code> is called, the later is ignored and will just return directly. For more details about thread-safety and the internal state machine, reference section "Improved multi-threading behaviour".
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_performing_kiesession_operations_atomically_when_in_active_mode"><a class="anchor" href="#_performing_kiesession_operations_atomically_when_in_active_mode"></a><a class="link" href="#_performing_kiesession_operations_atomically_when_in_active_mode">7.5.2.1. Performing KieSession operations atomically when in Active Mode</a></h5>
<div class="paragraph">
<p>When in Active Mode, the Drools engine is in control of when the rule shall be evaluated and fired; therefore it is important that operations on the KieSession are performed in a thread-safe manner. Additionally, from a client-side perspective, there might be the need for more than one operations to be called on the KieSession in between rule evaluations, but for engine to consider these as an atomic operation: for example, inserting more than one Fact at a given time, but for the engine to await until all the inserts are done, before evaluating the rules again.</p>
</div>
<div class="paragraph">
<p>Drools offers a <code>submit()</code> method to group and perform operations on the KieSession as a thread-safe atomic action, while in Active Mode.</p>
</div>
<div class="paragraph">
<p>An example outline of Drools code to perform KieSession operations atomically when in Active Mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession session = ...;

<span class="hljs-keyword">new</span> Thread( <span class="hljs-keyword">new</span> Runnable() {
  <span class="hljs-annotation">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
      session.fireUntilHalt();
  }
} ).start();

<span class="hljs-keyword">final</span> FactHandle fh = session.insert( fact_a );

... Thread.sleep( <span class="hljs-number">1000L</span> ); ...

session.submit( <span class="hljs-keyword">new</span> KieSession.AtomicAction() {
  <span class="hljs-annotation">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">( KieSession kieSession )</span> </span>{
    fact_a.setField(<span class="hljs-string">"value"</span>);
    kieSession.update( fh, fact_a );
    kieSession.insert( fact_1 );
    kieSession.insert( fact_2 );
    kieSession.insert( fact_3 );
  }
} );

... Thread.sleep( <span class="hljs-number">1000L</span> ); ...

session.insert( fact_z );

session.halt();
session.dispose();</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a reminder example, the fact handle could also be retrieved from the KieSession:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">...
session.insert( fact_a );

... Thread.sleep( <span class="hljs-number">1000L</span> ); ...

session.submit( <span class="hljs-keyword">new</span> KieSession.AtomicAction() {
  <span class="hljs-annotation">@Override</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">( KieSession kieSession )</span> </span>{
    <span class="hljs-keyword">final</span> FactHandle fh = kieSession.getFactHandle( fact_a );
    fact_a.setField(<span class="hljs-string">"value"</span>);
    kieSession.update( fh, fact_a );
    kieSession.insert( fact_1 );
    kieSession.insert( fact_2 );
    kieSession.insert( fact_3 );
  }
} );

...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_propagation_modes_2"><a class="anchor" href="#_propagation_modes_2"></a><a class="link" href="#_propagation_modes_2">7.6. Propagation modes</a></h3>
<div class="paragraph">
<p>The introduction of PHREAK as default algorithm for the Drools engine made the rules' evaluation lazy.
This new Drools lazy behavior allowed a relevant performance boost but, in some very specific cases, breaks the semantic of a few Drools features.</p>
</div>
<div class="paragraph">
<p>More precisely in some circumstances it is necessary to propagate the insertion of new fact into th session immediately.
For instance Drools allows a query to be executed in pull only (or passive) mode by prepending a '?' symbol to its invocation as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 94. A passive query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function">query <span class="hljs-title">Q</span> <span class="hljs-params">(Integer i)</span>
    <span class="hljs-title">String</span><span class="hljs-params">( <span class="hljs-keyword">this</span> == i.toString()</span> )
end
rule R when
    $i : <span class="hljs-title">Integer</span><span class="hljs-params">()</span>
    ?<span class="hljs-title">Q</span><span class="hljs-params">( $i; )</span>
then
    System.out.<span class="hljs-title">println</span><span class="hljs-params">( $i )</span></span>;
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this case, since the query is passive, it shouldn’t react to the insertion of a String matching the join condition in the query itself.
In other words this sequence of commands</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSession ksession = ...
ksession.insert(<span class="hljs-number">1</span>);
ksession.insert(<span class="hljs-string">"1"</span>);
ksession.fireAllRules();</code></pre>
</div>
</div>
<div class="paragraph">
<p>shouldn’t cause the rule R to fire because the String satisfying the query condition has been inserted after the Integer and the passive query shouldn’t react to this insertion.
Conversely the rule should fire if the insertion sequence is inverted because the insertion of the Integer, when the passive query can be satisfied by the presence of an already existing String, will trigger it.</p>
</div>
<div class="paragraph">
<p>Unfortunately the lazy nature of PHREAK doesn’t allow the engine to make any distinction regarding the insertion sequence of the two facts, so the rule will fire in both cases.
In circumstances like this it is necessary to evaluate the rule eagerly as done by the old RETEOO-based engine.</p>
</div>
<div class="paragraph">
<p>In other cases it is required that the propagation is eager, meaning that it is not immedate, but anyway has to happen before the engine/agenda starts scheduled evaluations.
For instance this is necessary when a rule has the no-loop or the lock-on-active attribute and in fact when this happens this propagation mode is automatically enforced by the engine.</p>
</div>
<div class="paragraph">
<p>To cover these use cases, and in all other situations where an immediate or eager rule evaluation is required, it is possible to declaratively specify so by annotating the rule itself with <strong>@Propagation(Propagation.Type)</strong>, where Propagation.Type is an enumeration with 3 possible values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>IMMEDIATE</strong> means that the propagation is performed immediately.</p>
</li>
<li>
<p><strong>EAGER</strong> means that the propagation is performed lazily but eagerly evaluated before scheduled evaluations.</p>
</li>
<li>
<p><strong>LAZY</strong> means that the propagation is totally lazy and this is default PHREAK behaviour</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This means that the following drl:</p>
</div>
<div class="exampleblock">
<div class="title">Example 95. A data-driven rule using a passive query</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function">query <span class="hljs-title">Q</span> <span class="hljs-params">(Integer i)</span>
    <span class="hljs-title">String</span><span class="hljs-params">( <span class="hljs-keyword">this</span> == i.toString()</span> )
end
rule R @<span class="hljs-title">Propagation</span><span class="hljs-params">(IMMEDIATE)</span> when
    $i : <span class="hljs-title">Integer</span><span class="hljs-params">()</span>
    ?<span class="hljs-title">Q</span><span class="hljs-params">( $i; )</span>
then
    System.out.<span class="hljs-title">println</span><span class="hljs-params">( $i )</span></span>;
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>will make the rule R to fire if and only if the Integer is inserted after the String, thus behaving in accordance with the semantic of the passive query.</p>
</div>
</div>
<div class="sect2">
<h3 id="_commands_and_the_commandexecutor_2"><a class="anchor" href="#_commands_and_the_commandexecutor_2"></a><a class="link" href="#_commands_and_the_commandexecutor_2">7.7. Commands and the CommandExecutor</a></h3>
<div class="paragraph">
<p>The <code>CommandFactory</code> allows for commands to be executed on those sessions, the only difference being that the Stateless Knowledge Session executes <code>fireAllRules()</code> at the end before disposing the session.
The currently supported commands are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FireAllRules</p>
</li>
<li>
<p>GetGlobal</p>
</li>
<li>
<p>SetGlobal</p>
</li>
<li>
<p>InsertObject</p>
</li>
<li>
<p>InsertElements</p>
</li>
<li>
<p>Query</p>
</li>
<li>
<p>StartProcess</p>
</li>
<li>
<p>BatchExecution</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>`
InsertObject` will insert a single object, with an optional "out" identifier. <code>InsertElements</code> will iterate an Iterable, inserting each of the elements.
What this means is that a Stateless Knowledge Session is no longer limited to just inserting objects, it can now start processes or execute queries, and do this in any order.</p>
</div>
<div class="exampleblock">
<div class="title">Example 96. Insert Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
ExecutionResults bresults =
  ksession.execute( CommandFactory.newInsert( <span class="hljs-keyword">new</span> Cheese( <span class="hljs-string">"stilton"</span> ), <span class="hljs-string">"stilton_id"</span> ) );
Stilton stilton = bresults.getValue( <span class="hljs-string">"stilton_id"</span> );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The execute method always returns an <code>ExecutionResults</code> instance, which allows access to any command results if they specify an out identifier such as the "stilton_id" above.</p>
</div>
<div class="exampleblock">
<div class="title">Example 97. InsertElements Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">StatelessKieSession ksession = kbase.newStatelessKieSession();
Command cmd = CommandFactory.newInsertElements( Arrays.asList( Object[] {
                  <span class="hljs-keyword">new</span> Cheese( <span class="hljs-string">"stilton"</span> ),
                  <span class="hljs-keyword">new</span> Cheese( <span class="hljs-string">"brie"</span> ),
                  <span class="hljs-keyword">new</span> Cheese( <span class="hljs-string">"cheddar"</span> ),
              });
ExecutionResults bresults = ksession.execute( cmd );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The execute method only allows for a single command.
That’s where <code>BatchExecution</code> comes in, which represents a composite command, created from a list of commands.
Now, execute will iterate over the list and execute each command in turn.
This means you can insert some objects, start a process, call fireAllRules and execute a query, all in a single <code>execute(…​)</code> call, which is quite powerful.</p>
</div>
<div class="paragraph">
<p>As mentioned previosly, the StatelessKieSession will execute <code>fireAllRules()</code> automatically at the end.
However the keen-eyed reader probably has already noticed the <code>FireAllRules</code> command and wondered how that works with a StatelessKieSession.
The <code>FireAllRules</code> command is allowed, and using it will disable the automatic execution at the end; think of using it as a sort of manual override function.</p>
</div>
<div class="paragraph">
<p>A custom XStream marshaller can be used with the Drools Pipeline to achieve XML scripting, which is perfect for services.
Here are two simple XML samples, one for the BatchExecution and one for the <code>ExecutionResults</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 98. Simple BatchExecution XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">insert</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">'outStilton'</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">type</span>&gt;</span>stilton<span class="hljs-tag">&lt;/<span class="hljs-title">type</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">price</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">price</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">oldPrice</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-title">oldPrice</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">insert</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 99. Simple ExecutionResults XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">execution-results</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">identifier</span>=<span class="hljs-value">'outStilton'</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">type</span>&gt;</span>stilton<span class="hljs-tag">&lt;/<span class="hljs-title">type</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">oldPrice</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">oldPrice</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">price</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-title">price</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">result</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">execution-results</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Spring and Camel, covered in the integrations book, facilitate declarative services.</p>
</div>
<div class="exampleblock">
<div class="title">Example 100. BatchExecution Marshalled to XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">insert</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"stilton"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">type</span>&gt;</span>stilton<span class="hljs-tag">&lt;/<span class="hljs-title">type</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">price</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">price</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">oldPrice</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-title">oldPrice</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">insert</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">query</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">'cheeses2'</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">'cheesesWithParams'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>stilton<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>cheddar<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">query</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>CommandExecutor</code> returns an <code>ExecutionResults</code>, and this is handled by the pipeline code snippet as well.
A similar output for the &lt;batch-execution&gt; XML sample above would be:</p>
</div>
<div class="exampleblock">
<div class="title">Example 101. ExecutionResults Marshalled to XML</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">execution-results</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">identifier</span>=<span class="hljs-value">"stilton"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">type</span>&gt;</span>stilton<span class="hljs-tag">&lt;/<span class="hljs-title">type</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">price</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-title">price</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">result</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">identifier</span>=<span class="hljs-value">'cheeses2'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">query-results</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">identifiers</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">identifier</span>&gt;</span>cheese<span class="hljs-tag">&lt;/<span class="hljs-title">identifier</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">identifiers</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">type</span>&gt;</span>cheddar<span class="hljs-tag">&lt;/<span class="hljs-title">type</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">price</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-title">price</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">oldPrice</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-title">oldPrice</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">row</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">type</span>&gt;</span>cheddar<span class="hljs-tag">&lt;/<span class="hljs-title">type</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">price</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">price</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">oldPrice</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-title">oldPrice</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.Cheese</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">row</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">query-results</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">result</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">execution-results</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>BatchExecutionHelper</code> provides a configured XStream instance to support the marshalling of Batch Executions, where the resulting XML can be used as a message format, as shown above.
Configured converters only exist for the commands supported via the Command Factory.
The user may add other converters for their user objects.
This is very useful for scripting stateless or stateful knowledge sessions, especially when services are involved.</p>
</div>
<div class="paragraph">
<p>There is currently no XML schema to support schema validation.
The basic format is outlined here, and the drools-pipeline module has an illustrative unit test in the <code>XStreamBatchExecutionTest</code> unit test.
The root element is &lt;batch-execution&gt; and it can contain zero or more commands elements.</p>
</div>
<div class="exampleblock">
<div class="title">Example 102. Root XML element</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span>&gt;</span>
...
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This contains a list of elements that represent commands, the supported commands is limited to those Commands provided by the Command Factory.
The most basic of these is the &lt;insert&gt; element, which inserts objects.
The contents of the insert element is the user object, as dictated by XStream.</p>
</div>
<div class="exampleblock">
<div class="title">Example 103. Insert</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">insert</span>&gt;</span>
      ...<span class="hljs-comment">&lt;!-- any user object --&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">insert</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The insert element features an "out-identifier" attribute, demanding that the inserted object will also be returned as part of the result payload.</p>
</div>
<div class="exampleblock">
<div class="title">Example 104. Insert with Out Identifier Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">insert</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">'userVar'</span>&gt;</span>
      ...
   <span class="hljs-tag">&lt;/<span class="hljs-title">insert</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It’s also possible to insert a collection of objects using the &lt;insert-elements&gt; element.
This command does not support an out-identifier.
The <code>org.domain.UserClass</code> is just an illustrative user object that XStream would serialize.</p>
</div>
<div class="exampleblock">
<div class="title">Example 105. Insert Elements command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">insert-elements</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">org.domain.UserClass</span>&gt;</span>
         ...
      <span class="hljs-tag">&lt;/<span class="hljs-title">org.domain.UserClass</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">org.domain.UserClass</span>&gt;</span>
         ...
      <span class="hljs-tag">&lt;/<span class="hljs-title">org.domain.UserClass</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">org.domain.UserClass</span>&gt;</span>
         ...
      <span class="hljs-tag">&lt;/<span class="hljs-title">org.domain.UserClass</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">insert-elements</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>While the <code>out</code> attribute is useful in returning specific instances as a result payload, we often wish to run actual queries.
Both parameter and parameterless queries are supported.
The <code>name</code> attribute is the name of the query to be called, and the <code>out-identifier</code> is the identifier to be used for the query results in the <code>&lt;execution-results&gt;</code> payload.</p>
</div>
<div class="exampleblock">
<div class="title">Example 106. Query Command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">query</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">'cheeses'</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">'cheeses'</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">query</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">'cheeses2'</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">'cheesesWithParams'</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>stilton<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">string</span>&gt;</span>cheddar<span class="hljs-tag">&lt;/<span class="hljs-title">string</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">query</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_droolslanguagereferencechapter"><a class="anchor" href="#_droolslanguagereferencechapter"></a><a class="link" href="#_droolslanguagereferencechapter">8. Rule Language Reference</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_3"><a class="anchor" href="#_overview_3"></a><a class="link" href="#_overview_3">8.1. Overview</a></h3>
<div class="paragraph">
<p>Drools has a "native" rule language.
This format is very light in terms of punctuation, and supports natural and domain specific languages via "expanders" that allow the language to morph to your problem domain.
This chapter is mostly concerted with this native rule format.
The diagrams used to present the syntax are known as "railroad" diagrams, and they are basically flow charts for the language terms.
The technically very keen may also refer to <em class="path">DRL.g</em>
 which is  the Antlr3 grammar for the rule language.
If you use the Rule Workbench, a lot of the rule structure is done for you with content assistance, for example, type "ru" and press ctrl+space, and it will build the rule structure for you.</p>
</div>
<div class="sect3">
<h4 id="_a_rule_file"><a class="anchor" href="#_a_rule_file"></a><a class="link" href="#_a_rule_file">8.1.1. A rule file</a></h4>
<div class="paragraph">
<p>A rule file is typically a file with a .drl extension.
In a DRL file you can have multiple rules, queries and functions, as well as some resource declarations like imports, globals and attributes that are assigned and used by your rules and queries.
However, you are also able to spread your rules across multiple rule files (in that case, the extension .rule is suggested, but not required) - spreading rules across files can help with managing large numbers of rules.
A DRL file is simply a text file.</p>
</div>
<div class="paragraph">
<p>The overall structure of a rule file is:</p>
</div>
<div class="exampleblock">
<div class="title">Example 107. Rules file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs java"><span class="hljs-keyword">package</span> <span class="hljs-keyword">package</span>-name

imports

globals

functions

queries

rules</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The order in which the elements are declared is not important, except for the package name that, if declared, must be the first element in the rules file.
All elements are optional, so you will use only those you need.
We will discuss each of them in the following sections.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_makes_a_rule"><a class="anchor" href="#_what_makes_a_rule"></a><a class="link" href="#_what_makes_a_rule">8.1.2. What makes a rule</a></h4>
<div class="paragraph">
<p>For the impatient, just as an early view, a rule has the following rough structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"name"</span>
    attributes
    <span class="hljs-keyword">when</span>
        <span class="hljs-constant">LHS</span>
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">RHS</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s really that simple.
Mostly punctuation is not needed, even the double quotes for "name" are optional, as are newlines.
Attributes are simple (always optional) hints to how the rule should behave.
LHS is the conditional parts of the rule, which follows a certain syntax which is covered below.
RHS is basically a block that allows dialect specific semantic code to be executed.</p>
</div>
<div class="paragraph">
<p>It is important to note that white space is not important, <em>except</em> in the case of domain specific languages, where lines are processed one by one and spaces may be significant to the domain language.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_keywords"><a class="anchor" href="#_keywords"></a><a class="link" href="#_keywords">8.2. Keywords</a></h3>
<div class="paragraph">
<p>Drools 5 introduces the concept of <em>hard</em> and <em>soft</em> keywords.</p>
</div>
<div class="paragraph">
<p>Hard keywords are reserved, you cannot use any hard keyword when naming your domain objects, properties, methods, functions and other elements that are used in the rule text.</p>
</div>
<div class="paragraph">
<p>Here is the list of hard keywords that must be avoided as identifiers when writing rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>true</code></p>
</li>
<li>
<p><code>false</code></p>
</li>
<li>
<p><code>null</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Soft keywords are just recognized in their context, enabling you to use these words in any other place if you wish, although, it is still recommended to avoid them, to avoid confusions, if possible.
Here is a list of the soft keywords:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>lock-on-active</code></p>
</li>
<li>
<p><code>date-effective</code></p>
</li>
<li>
<p><code>date-expires</code></p>
</li>
<li>
<p><code>no-loop</code></p>
</li>
<li>
<p><code>auto-focus</code></p>
</li>
<li>
<p><code>activation-group</code></p>
</li>
<li>
<p><code>agenda-group</code></p>
</li>
<li>
<p><code>ruleflow-group</code></p>
</li>
<li>
<p><code>entry-point</code></p>
</li>
<li>
<p><code>duration</code></p>
</li>
<li>
<p><code>package</code></p>
</li>
<li>
<p><code>import</code></p>
</li>
<li>
<p><code>dialect</code></p>
</li>
<li>
<p><code>salience</code></p>
</li>
<li>
<p><code>enabled</code></p>
</li>
<li>
<p><code>attributes</code></p>
</li>
<li>
<p><code>rule</code></p>
</li>
<li>
<p><code>extend</code></p>
</li>
<li>
<p>when</p>
</li>
<li>
<p>then</p>
</li>
<li>
<p><code>template</code></p>
</li>
<li>
<p><code>query</code></p>
</li>
<li>
<p><code>declare</code></p>
</li>
<li>
<p><code>function</code></p>
</li>
<li>
<p><code>global</code></p>
</li>
<li>
<p><code>eval</code></p>
</li>
<li>
<p><code>not</code></p>
</li>
<li>
<p><code>in</code></p>
</li>
<li>
<p><code>or</code></p>
</li>
<li>
<p><code>and</code></p>
</li>
<li>
<p><code>exists</code></p>
</li>
<li>
<p><code>forall</code></p>
</li>
<li>
<p>accumulate</p>
</li>
<li>
<p>collect</p>
</li>
<li>
<p>from</p>
</li>
<li>
<p><code>action</code></p>
</li>
<li>
<p><code>reverse</code></p>
</li>
<li>
<p><code>result</code></p>
</li>
<li>
<p><code>end</code></p>
</li>
<li>
<p>over</p>
</li>
<li>
<p><code>init</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course, you can have these (hard and soft) words as part of a method name in camel case, like notSomething() or accumulateSomething() - there are no issues with that scenario.</p>
</div>
<div class="paragraph">
<p>Although the 3 hard keywords above are unlikely to be used in your existing domain models, if you absolutely need to use them as identifiers instead of keywords, the DRL language provides the ability to escape hard keywords on rule text.
To escape a word, simply enclose it in grave accents, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Holiday( `<span class="hljs-literal">true</span>` == <span class="hljs-string">"yes"</span> ) <span class="hljs-comment">// please note that Drools will resolve that reference to the method Holiday.isTrue()</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_comments"><a class="anchor" href="#_comments"></a><a class="link" href="#_comments">8.3. Comments</a></h3>
<div class="paragraph">
<p>Comments are sections of text that are ignored by the rule engine.
They are stripped out when they are encountered, except inside semantic code blocks, like the RHS of a rule.</p>
</div>
<div class="sect3">
<h4 id="_single_line_comment"><a class="anchor" href="#_single_line_comment"></a><a class="link" href="#_single_line_comment">8.3.1. Single line comment</a></h4>
<div class="paragraph">
<p>To create single line comments, you can use '//'. The parser will ignore anything in the line after the comment symbol.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">rule <span class="hljs-string">"Testing Comments"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-regexp">//</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> a single line comment
    eval( <span class="hljs-literal">true</span> ) <span class="hljs-regexp">//</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> a comment <span class="hljs-keyword">in</span> the same line <span class="hljs-keyword">of</span> a pattern
<span class="hljs-keyword">then</span>
    <span class="hljs-regexp">//</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> a comment inside a semantic code block
end</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>'#' for comments has been removed.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_multi_line_comment"><a class="anchor" href="#_multi_line_comment"></a><a class="link" href="#_multi_line_comment">8.3.2. Multi-line comment</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/multi_line_comment.png" alt="multi line comment">
</div>
<div class="title">Figure 172. Multi-line comment</div>
</div>
<div class="paragraph">
<p>Multi-line comments are used to comment blocks of text, both in and outside semantic code blocks.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"Test Multi-line Comments"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-comment">/* this is a multi-line comment
       in the left hand side of a rule */</span>
    eval( <span class="hljs-keyword">true</span> )
then
    <span class="hljs-comment">/* and this is a multi-line comment
       in the right hand side of a rule */</span>
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_error_messages"><a class="anchor" href="#_error_messages"></a><a class="link" href="#_error_messages">8.4. Error Messages</a></h3>
<div class="paragraph">
<p>Drools 5 introduces standardized error messages.
This standardization aims to help users to find and resolve problems in a easier and faster way.
In this section you will learn how to identify and interpret those error messages, and you will also receive some tips on how to solve the problems associated with them.</p>
</div>
<div class="sect3">
<h4 id="_message_format"><a class="anchor" href="#_message_format"></a><a class="link" href="#_message_format">8.4.1. Message format</a></h4>
<div class="paragraph">
<p>The standardization includes the error message format and to better explain this format, let’s use the following example:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/error_message.png" alt="error message">
</div>
<div class="title">Figure 173. Error Message Format</div>
</div>
<div class="paragraph">
<p><strong>1st Block:</strong> This area identifies the error code.</p>
</div>
<div class="paragraph">
<p><strong>2nd Block:</strong> Line and column information.</p>
</div>
<div class="paragraph">
<p><strong>3rd Block:</strong> Some text describing the problem.</p>
</div>
<div class="paragraph">
<p><strong>4th Block:</strong> This is the first context.
Usually indicates the rule, function, template or query where the error occurred.
This block is not mandatory.</p>
</div>
<div class="paragraph">
<p><strong>5th Block:</strong> Identifies the pattern where the error occurred.
This block is not mandatory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_error_messages_description"><a class="anchor" href="#_error_messages_description"></a><a class="link" href="#_error_messages_description">8.4.2. Error Messages Description</a></h4>
<div class="sect4">
<h5 id="_101_no_viable_alternative"><a class="anchor" href="#_101_no_viable_alternative"></a><a class="link" href="#_101_no_viable_alternative">8.4.2.1. 101: No viable alternative</a></h5>
<div class="paragraph">
<p>Indicates the most common errors, where the parser came to a decision point but couldn’t identify an alternative.
Here are some examples:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs http"><span class="hljs-attribute">1</span>: <span class="hljs-string">rule one</span>
<span class="hljs-attribute">2</span>: <span class="hljs-string">  when</span>
<span class="hljs-attribute">3</span>: <span class="hljs-string">    exists Foo()</span>
<span class="hljs-attribute">4</span>: <span class="hljs-string">    exits Bar()  // "exits"</span>
<span class="hljs-attribute">5</span>: <span class="hljs-string">  then</span>
<span class="hljs-attribute">6</span>: <span class="hljs-string">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example generates this message:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[ERR 101] Line 4:4 no viable alternative at input 'exits' in rule one</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At first glance this seems to be valid syntax, but it is not (exits != exists). Let’s take a look at next example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs http"><span class="hljs-attribute">1</span>: <span class="hljs-string">package org.drools.examples;</span>
<span class="hljs-attribute">2</span>: <span class="hljs-string">rule</span>
<span class="hljs-attribute">3</span>: <span class="hljs-string">  when</span>
<span class="hljs-attribute">4</span>: <span class="hljs-string">    Object()</span>
<span class="hljs-attribute">5</span>: <span class="hljs-string">  then</span>
<span class="hljs-attribute">6</span>: <span class="hljs-string">    System.out.println("A RHS");</span>
<span class="hljs-attribute">7</span>: <span class="hljs-string">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now the above code generates this message:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[ERR 101] Line 3:2 no viable alternative at input 'WHEN'</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This message means that the parser encountered the token <strong>WHEN</strong>, actually a hard keyword, but it’s in the wrong place since the the rule name is missing.</p>
</div>
<div class="paragraph">
<p>The error "no viable alternative" also occurs when you make a simple lexical mistake.
Here is a sample of a lexical problem:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs http"><span class="hljs-attribute">1</span>: <span class="hljs-string">rule simple_rule</span>
<span class="hljs-attribute">2</span>: <span class="hljs-string">  when</span>
<span class="hljs-attribute">3</span>: <span class="hljs-string">    Student( name == "Andy )</span>
<span class="hljs-attribute">4</span>: <span class="hljs-string">  then</span>
<span class="hljs-attribute">5</span>: <span class="hljs-string">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above code misses to close the quotes and because of this the parser generates this error message:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[ERR 101] Line 0:-1 no viable alternative at input '&lt;eof&gt;' in rule simple_rule in pattern Student</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Usually the Line and Column information are accurate, but in some cases (like unclosed quotes), the parser generates a 0:-1 position.
In this case you should check whether you didn’t forget to close quotes, apostrophes or parentheses.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_102_mismatched_input"><a class="anchor" href="#_102_mismatched_input"></a><a class="link" href="#_102_mismatched_input">8.4.2.2. 102: Mismatched input</a></h5>
<div class="paragraph">
<p>This error indicates that the parser was looking for a particular symbol that it didn’t ﬁnd at the current input position.
Here are some samples:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs http"><span class="hljs-attribute">1</span>: <span class="hljs-string">rule simple_rule</span>
<span class="hljs-attribute">2</span>: <span class="hljs-string">  when</span>
<span class="hljs-attribute">3</span>: <span class="hljs-string">    foo3 : Bar(</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example generates this message:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[ERR 102] Line 0:-1 mismatched input '&lt;eof&gt;' expecting ')' in rule simple_rule in pattern Bar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To fix this problem, it is necessary to complete the rule statement.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Usually when you get a 0:-1 position, it means that parser reached the end of source.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following code generates more than one error message:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-number">1</span>: package org.drools.examples;
<span class="hljs-number">2</span>:
<span class="hljs-number">3</span>: rule <span class="hljs-string">"Avoid NPE on wrong syntax"</span>
<span class="hljs-number">4</span>:   when
<span class="hljs-number">5</span>:     not( Cheese( ( type == <span class="hljs-string">"stilton"</span>, price == <span class="hljs-number">10</span> ) || ( type == <span class="hljs-string">"brie"</span>, price == <span class="hljs-number">15</span> ) ) from $cheeseList )
<span class="hljs-number">6</span>:   then
<span class="hljs-number">7</span>:     System.out.println(<span class="hljs-string">"OK"</span>);
<span class="hljs-number">8</span>: end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These are the errors associated with this source:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[ERR 102] Line 5:36 mismatched input ',' expecting ')' in rule "Avoid NPE on wrong syntax" in pattern Cheese</p>
</li>
<li>
<p>[ERR 101] Line 5:57 no viable alternative at input 'type' in rule "Avoid NPE on wrong syntax"</p>
</li>
<li>
<p>[ERR 102] Line 5:106 mismatched input ')' expecting 'then' in rule "Avoid NPE on wrong syntax"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the second problem is related to the first.
To fix it, just replace the commas (',') by AND operator ('&amp;&amp;').</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In some situations you can get more than one error message.
Try to fix one by one, starting at the first one.
Some error messages are generated merely as consequences of other errors.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_103_failed_predicate"><a class="anchor" href="#_103_failed_predicate"></a><a class="link" href="#_103_failed_predicate">8.4.2.3. 103: Failed predicate</a></h5>
<div class="paragraph">
<p>A validating semantic predicate evaluated to false.
Usually these semantic predicates are used to identify soft keywords.
This sample shows exactly this situation:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"> <span class="hljs-number">1</span>: package nesting;
 <span class="hljs-number">2</span>: dialect <span class="hljs-string">"mvel"</span>
 <span class="hljs-number">3</span>:
 <span class="hljs-number">4</span>: import org.drools.compiler.Person
 <span class="hljs-number">5</span>: import org.drools.compiler.Address
 <span class="hljs-number">6</span>:
 <span class="hljs-number">7</span>: fdsfdsfds
 <span class="hljs-number">8</span>:
 <span class="hljs-number">9</span>: rule <span class="hljs-string">"test something"</span>
<span class="hljs-number">10</span>:   when
<span class="hljs-number">11</span>:     p: Person( name==<span class="hljs-string">"Michael"</span> )
<span class="hljs-number">12</span>:   then
<span class="hljs-number">13</span>:     p.name = <span class="hljs-string">"other"</span>;
<span class="hljs-number">14</span>:     System.out.println(p.name);
<span class="hljs-number">15</span>: end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With this sample, we get this error message:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[ERR 103] Line 7:0 rule 'rule_key' failed predicate: {(validateIdentifierKey(DroolsSoftKeywords.RULE))}? in rule</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>fdsfdsfds</strong> text is invalid and the parser couldn’t identify it as the soft keyword <code>rule</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This error is very similar to 102: Mismatched input, but usually involves soft keywords.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_104_trailing_semi_colon_not_allowed"><a class="anchor" href="#_104_trailing_semi_colon_not_allowed"></a><a class="link" href="#_104_trailing_semi_colon_not_allowed">8.4.2.4. 104: Trailing semi-colon not allowed</a></h5>
<div class="paragraph">
<p>This error is associated with the <code>eval</code> clause, where its expression may not be terminated with a semicolon.
Check this example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs http"><span class="hljs-attribute">1</span>: <span class="hljs-string">rule simple_rule</span>
<span class="hljs-attribute">2</span>: <span class="hljs-string">  when</span>
<span class="hljs-attribute">3</span>: <span class="hljs-string">    eval(abc();)</span>
<span class="hljs-attribute">4</span>: <span class="hljs-string">  then</span>
<span class="hljs-attribute">5</span>: <span class="hljs-string">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Due to the trailing semicolon within eval, we get this error message:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[ERR 104] Line 3:4 trailing semi-colon not allowed in rule simple_rule</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This problem is simple to fix: just remove the semi-colon.</p>
</div>
</div>
<div class="sect4">
<h5 id="_105_early_exit"><a class="anchor" href="#_105_early_exit"></a><a class="link" href="#_105_early_exit">8.4.2.5. 105: Early Exit</a></h5>
<div class="paragraph">
<p>The recognizer came to a subrule in the grammar that must match an alternative at least once, but the subrule did not match anything.
Simply put: the parser has entered a branch from where there is no way out.
This example illustrates it:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs http"><span class="hljs-attribute">1</span>: <span class="hljs-string">template test_error</span>
<span class="hljs-attribute">2</span>: <span class="hljs-string">  aa s  11;</span>
<span class="hljs-attribute">3</span>: <span class="hljs-string">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This is the message associated to the above sample:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[ERR 105] Line 2:2 required (…​)+ loop did not match anything at input 'aa' in template test_error</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To fix this problem it is necessary to remove the numeric value as it is neither a valid data type which might begin a new template slot nor a possible start for any other rule file construct.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_messages"><a class="anchor" href="#_other_messages"></a><a class="link" href="#_other_messages">8.4.3. Other Messages</a></h4>
<div class="paragraph">
<p>Any other message means that something bad has happened, so please contact the development team.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_package"><a class="anchor" href="#_package"></a><a class="link" href="#_package">8.5. Package</a></h3>
<div class="paragraph">
<p>A package is a collection of rules and other related constructs, such as imports and globals.
The package members are typically related to each other - perhaps HR rules, for instance.
A package represents a namespace, which ideally is kept unique for a given grouping of rules.
The package name itself is the namespace, and is not related to files or folders in any way.</p>
</div>
<div class="paragraph">
<p>It is possible to assemble rules from multiple rule sources, and have one top level package configuration that all the rules are kept under (when the rules are assembled). Although, it is not possible to merge into the same package resources declared under different names.
A single Rulebase may, however, contain multiple packages built on it.
A common structure is to have all the rules for a package in the same file as the package declaration (so that is it entirely self-contained).</p>
</div>
<div class="paragraph">
<p>The following railroad diagram shows all the components that may make up a package.
Note that a package <em>must</em> have a namespace and be declared using standard Java conventions for package names; i.e., no spaces, unlike rule names which allow spaces.
In terms of the order of elements, they can appear in any order in the rule file, with the exception of the <code>package</code> statement, which must be at the top of the file.
In all cases, the semicolons are optional.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/package.png" alt="package">
</div>
<div class="title">Figure 174. package</div>
</div>
<div class="paragraph">
<p>Notice that any rule attribute (as described the section Rule Attributes) may also be written at package level, superseding the attribute’s default value.
The modified default may still be replaced by an attribute setting within a rule.</p>
</div>
<div class="sect3">
<h4 id="_import"><a class="anchor" href="#_import"></a><a class="link" href="#_import">8.5.1. import</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/import.png" alt="import">
</div>
<div class="title">Figure 175. import</div>
</div>
<div class="paragraph">
<p>Import statements work like import statements in Java.
You need to specify the fully qualified paths and type names for any objects you want to use in the rules.
Drools automatically imports classes from the Java package of the same name, and also from the package <code>java.lang</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_global"><a class="anchor" href="#_global"></a><a class="link" href="#_global">8.5.2. global</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/global.png" alt="global">
</div>
<div class="title">Figure 176. global</div>
</div>
<div class="paragraph">
<p>With <code>global</code> you define global variables.
They are used to make application objects available to the rules.
Typically, they are used to provide data or services that the rules use, especially application services used in rule consequences, and to return data from the rules, like logs or values added in rule consequences, or for the rules to interact with the application, doing callbacks.
Globals are not  inserted into the Working Memory, and therefore a global should never be used to establish conditions in rules except when it has a constant immutable value.
The engine cannot be notified about value changes of globals and does not track their changes.
Incorrect use of globals in constraints may yield surprising results - surprising in a bad way.</p>
</div>
<div class="paragraph">
<p>If multiple packages declare globals with the same identifier they must be of the same type and all of them will reference the same global value.</p>
</div>
<div class="paragraph">
<p>In order to use globals you must:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declare your global variable in your rules file and use it in rules.
For example:</p>
<div class="paragraph">
<p></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-built_in">global</span> java.util.List myGlobalList;

rule <span class="hljs-string">"Using a global"</span>
<span class="hljs-keyword">when</span>
    eval( <span class="hljs-literal">true</span> )
<span class="hljs-keyword">then</span>
    myGlobalList.add( <span class="hljs-string">"Hello World"</span> );
end</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
</li>
<li>
<p>Set the global value on your working memory. It is a best practice to set all global values before asserting any fact to the working memory. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List list = <span class="hljs-keyword">new</span> ArrayList();
KieSession kieSession = kiebase.newKieSession();
kieSession.setGlobal( <span class="hljs-string">"myGlobalList"</span>, list );</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that these are just named instances of objects that you pass in from your application to the working memory.
This means you can pass in any object you want: you could pass in a service locator, or perhaps a service itself.
With the new <code>from</code> element it is now common to pass a Hibernate session as a global, to allow <code>from</code> to pull data from a named Hibernate query.</p>
</div>
<div class="paragraph">
<p>One example may be an instance of a Email service.
In your integration code that is calling the rule engine, you obtain your emailService object, and then set it in the working memory.
In the DRL, you declare that you have a global of type EmailService, and give it the name "email". Then in your rule consequences, you can use things like email.sendSMS(number, message).</p>
</div>
<div class="paragraph">
<p>Globals are not designed to share data between rules and they should never be used for that purpose.
Rules always reason and react to the working memory state, so if you want to pass data from rule to rule, assert the data as facts into the working memory.</p>
</div>
<div class="paragraph">
<p>Care must be taken when changing data held by globals because the rule engine is not aware of those changes, hence cannot react to them.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_function"><a class="anchor" href="#_function"></a><a class="link" href="#_function">8.6. Function</a></h3>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/function.png" alt="function">
</div>
<div class="title">Figure 177. function</div>
</div>
<div class="paragraph">
<p>Functions are a way to put semantic code in your rule source file, as opposed to in normal Java classes.
They can’t do anything more than what you can do with helper classes.
(In fact, the compiler generates the helper class for you behind the scenes.) The main advantage of using functions in a rule is that you can keep the logic all in one place, and you can change the functions as needed (which can be a good or a bad thing). Functions are most useful for invoking actions on the consequence (<code>then</code>) part of a rule, especially if that particular action is used over and over again, perhaps with only differing parameters for each rule.</p>
</div>
<div class="paragraph">
<p>A typical function declaration looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">String</span> <span class="hljs-title">hello</span>(<span class="hljs-params">String name</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello "</span>+name+<span class="hljs-string">"!"</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>function</code> keyword is used, even though its not really part of Java.
Parameters to the function are defined as for a method, and you don’t have to have parameters if they are not needed.
The return type is defined just like in a regular method.</p>
</div>
<div class="paragraph">
<p>Alternatively, you could use a static method in a helper class, e.g., <code>Foo.hello()</code>.
Drools supports the use of function imports, so all you would need to do is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">import</span> <span class="hljs-tag">function</span> <span class="hljs-tag">my</span><span class="hljs-class">.package</span><span class="hljs-class">.Foo</span><span class="hljs-class">.hello</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Irrespective of the way the function is defined or imported, you use a function by calling it by its name, in the consequence or inside a semantic code block.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"using a static function"</span>
<span class="hljs-function"><span class="hljs-keyword">when</span>
    <span class="hljs-title">eval</span>(<span class="hljs-params"> <span class="hljs-keyword">true</span> </span>)
then
    System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params"> hello( <span class="hljs-string">"Bob"</span> </span>) )</span>;
end</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_type_declaration"><a class="anchor" href="#_type_declaration"></a><a class="link" href="#_type_declaration">8.7. Type Declaration</a></h3>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/meta_data.png" alt="meta data">
</div>
<div class="title">Figure 178. meta_data</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/type_declaration.png" alt="type declaration">
</div>
<div class="title">Figure 179. type_declaration</div>
</div>
<div class="paragraph">
<p>Type declarations have two main goals in the rules engine: to allow the declaration of new types, and to allow the declaration of metadata for types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Declaring new types:</strong> Drools works out of the box with plain Java objects as facts. Sometimes, however, users may want to define the model directly to the rules engine, without worrying about creating models in a lower level language like Java. At other times, there is a domain model already built, but eventually the user wants or needs to complement this model with additional entities that are used mainly during the reasoning process.</p>
</li>
<li>
<p><strong>Declaring metadata:</strong> facts may have meta information associated to them. Examples of meta information include any kind of data that is not represented by the fact attributes and is consistent among all instances of that fact type. This meta information may be queried at runtime by the engine and used in the reasoning process.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_declaring_new_types"><a class="anchor" href="#_declaring_new_types"></a><a class="link" href="#_declaring_new_types">8.7.1. Declaring New Types</a></h4>
<div class="paragraph">
<p>To declare a new type, all you need to do is use the keyword <code>declare</code>, followed by the list of fields, and the keyword <code>end</code>.
A new fact must have a list of fields, otherwise the engine will look for an existing fact class in the classpath and raise an error if not found.</p>
</div>
<div class="exampleblock">
<div class="title">Example 108. Declaring a new fact type: Address</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Address
   <span class="hljs-built_in">number</span> : <span class="hljs-built_in">int</span>
   streetName : <span class="hljs-keyword">String</span>
   city : <span class="hljs-keyword">String</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The previous example declares a new fact type called <code>Address</code>.
This fact type will have three attributes: <code>number</code>, <code>streetName</code> and <code>city</code>.
Each attribute has a type that can be any valid Java type, including any other class created by the user or even other fact types previously declared.</p>
</div>
<div class="paragraph">
<p>For instance, we may want to declare another fact type <code>Person</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 109. declaring a new fact type: Person</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Person
    <span class="hljs-keyword">name</span> : <span class="hljs-keyword">String</span>
    dateOfBirth : <span class="hljs-keyword">java</span>.util.<span class="hljs-built_in">Date</span>
    address : Address
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As we can see on the previous example, <code>dateOfBirth</code> is of type <code>java.util.Date</code>, from the Java API, while <code>address</code> is of the previously defined fact type Address.</p>
</div>
<div class="paragraph">
<p>You may avoid having to write the fully qualified name of a class every time you write it by using the <code>import</code> clause, as previously discussed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 110. Avoiding the need to use fully qualified class names by using import</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">import java.util.Date

<span class="hljs-operator"><span class="hljs-keyword">declare</span> Person
    <span class="hljs-keyword">name</span> : <span class="hljs-keyword">String</span>
    dateOfBirth : <span class="hljs-built_in">Date</span>
    address : Address
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When you declare a new fact type, Drools will, at compile time, generate bytecode that implements a Java class representing the fact type.
The generated Java class will be a one-to-one Java Bean mapping of the type definition.
So, for the previous example, the generated Java class would be:</p>
</div>
<div class="exampleblock">
<div class="title">Example 111. generated Java class for the previous Person fact typedeclaration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>{
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> java.util.Date dateOfBirth;
    <span class="hljs-keyword">private</span> Address address;

    <span class="hljs-comment">// empty constructor</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span><span class="hljs-params">()</span> </span>{...}

    <span class="hljs-comment">// constructor with all fields</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span><span class="hljs-params">( String name, Date dateOfBirth, Address address )</span> </span>{...}

    <span class="hljs-comment">// if keys are defined, constructor with keys</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span><span class="hljs-params">( ...keys... )</span> </span>{...}

    <span class="hljs-comment">// getters and setters</span>
    <span class="hljs-comment">// equals/hashCode</span>
    <span class="hljs-comment">// toString</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Since the generated class is a simple Java class, it can be used transparently in the rules, like any other fact.</p>
</div>
<div class="exampleblock">
<div class="title">Example 112. Using the declared types in rules</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"Using a declared Type"</span>
<span class="hljs-keyword">when</span>&lt;
    $p : Person( name == <span class="hljs-string">"Bob"</span> )
then
    <span class="hljs-comment">// Insert Mark, who is Bob's mate.</span>
    Person mark = <span class="hljs-keyword">new</span> Person();
    mark.setName(<span class="hljs-string">"Mark"</span>);
    insert( mark );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_declaring_enumerative_types"><a class="anchor" href="#_declaring_enumerative_types"></a><a class="link" href="#_declaring_enumerative_types">8.7.1.1. Declaring enumerative types</a></h5>
<div class="paragraph">
<p>DRL also supports the declaration of enumerative types.
Such type declarations require the additional keyword <em>enum</em>, followed by a comma separated list of admissible values terminated by a semicolon.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"Using a declared Type"</span>
<span class="hljs-keyword">when</span>
    $p : Person( name == <span class="hljs-string">"Bob"</span> )
then
    <span class="hljs-comment">// Insert Mark, who is Bob's mate.</span>
    Person mark = <span class="hljs-keyword">new</span> Person();
    mark.setName(<span class="hljs-string">"Mark"</span>);
    insert( mark );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The compiler will generate a valid Java enum, with static methods valueOf() and values(), as well as instance methods ordinal(), compareTo() and name().</p>
</div>
<div class="paragraph">
<p>Complex enums are also partially supported, declaring the internal fields similarly to a regular type declaration.
Notice that as of version 6.x, enum fields do <em>NOT</em> support other declared types or enums</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> enum DaysOfWeek
   SUN(<span class="hljs-string">"Sunday"</span>),MON(<span class="hljs-string">"Monday"</span>),TUE(<span class="hljs-string">"Tuesday"</span>),WED(<span class="hljs-string">"Wednesday"</span>),THU(<span class="hljs-string">"Thursday"</span>),FRI(<span class="hljs-string">"Friday"</span>),SAT(<span class="hljs-string">"Saturday"</span>);</span>

   fullName : String
<span class="hljs-operator"><span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Enumeratives can then be used in rules</p>
</div>
<div class="exampleblock">
<div class="title">Example 113. Using declarative enumerations in rules</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Using a declared Enum"</span>
<span class="hljs-keyword">when</span>
   <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Employee</span>( dayOff == <span class="hljs-constant">DaysOfWeek</span>.<span class="hljs-constant">MONDAY</span> )
<span class="hljs-keyword">then</span>
   ...
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_declaring_metadata"><a class="anchor" href="#_declaring_metadata"></a><a class="link" href="#_declaring_metadata">8.7.2. Declaring Metadata</a></h4>
<div class="paragraph">
<p>Metadata may be assigned to several different constructions in Drools: fact types, fact attributes and rules.
Drools uses the at sign ('@') to introduce metadata, and it always uses the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-property">@metadata_key</span>( metadata_value )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parenthesized <em>metadata_value</em> is optional.</p>
</div>
<div class="paragraph">
<p>For instance, if you want to declare a metadata attribute like <code>author</code>, whose value is <em>Bob</em>, you could simply write:</p>
</div>
<div class="exampleblock">
<div class="title">Example 114. Declaring a metadata attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-property">@author</span>( Bob )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Drools allows the declaration of any arbitrary metadata attribute, but some will have special meaning to the engine, while others are simply available for querying at runtime.
Drools allows the declaration of metadata both for fact types and for fact attributes.
Any metadata that is declared before the attributes of a fact type are assigned to the fact type, while metadata declared after an attribute are assigned to that particular attribute.</p>
</div>
<div class="exampleblock">
<div class="title">Example 115. Declaring metadata attributes for fact types and attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">import java.util.Date

<span class="hljs-operator"><span class="hljs-keyword">declare</span> Person
    @author( Bob )
    @dateOfCreation( <span class="hljs-number">01</span>-Feb-<span class="hljs-number">2009</span> )

    <span class="hljs-keyword">name</span> : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">key</span> @maxLength( <span class="hljs-number">30</span> )
    dateOfBirth : <span class="hljs-built_in">Date</span>
    address : Address
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the previous example, there are two metadata items declared for the fact type (<code>@author</code> and <code>@dateOfCreation</code>) and two more defined for the name attribute (<code>@key</code> and <code>@maxLength</code>). Please note that the <code>@key</code> metadata has no required value, and so the parentheses and the value were omitted.:</p>
</div>
<div class="sect4">
<h5 id="_predefined_class_level_annotations"><a class="anchor" href="#_predefined_class_level_annotations"></a><a class="link" href="#_predefined_class_level_annotations">8.7.2.1. Predefined class level annotations</a></h5>
<div class="paragraph">
<p>Some annotations have predefined semantics that are interpreted by the engine.
The following is a list of some of these predefined annotations and their meaning.</p>
</div>
<div class="sect5">
<h6 id="__role_fact_event"><a class="anchor" href="#__role_fact_event"></a><a class="link" href="#__role_fact_event">@role( &lt;fact | event&gt; )</a></h6>
<div class="paragraph">
<p>The @role annotation defines how the engine should handle instances of that type: either as regular facts or as events.
It accepts two possible values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>fact : this is the default, declares that the type is to be handled as a regular fact.</p>
</li>
<li>
<p>event : declares that the type is to be handled as an event.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example declares that the fact type StockTick in a stock broker application is to be handled as an event.</p>
</div>
<div class="exampleblock">
<div class="title">Example 116. declaring a fact type as an event</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">import some.package.StockTick

<span class="hljs-operator"><span class="hljs-keyword">declare</span> StockTick
    @<span class="hljs-keyword">role</span>( <span class="hljs-keyword">event</span> )
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The same applies to facts declared inline.
If StockTick was a fact type declared in the DRL itself, instead of a previously existing class, the code would be:</p>
</div>
<div class="exampleblock">
<div class="title">Example 117. declaring a fact type and assigning it the event role</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> StockTick
    @<span class="hljs-keyword">role</span>( <span class="hljs-keyword">event</span> )

    datetime : <span class="hljs-keyword">java</span>.util.<span class="hljs-built_in">Date</span>
    symbol : <span class="hljs-keyword">String</span>
    price : <span class="hljs-keyword">double</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="__typesafe_boolean"><a class="anchor" href="#__typesafe_boolean"></a><a class="link" href="#__typesafe_boolean">@typesafe( &lt;boolean&gt; )</a></h6>
<div class="paragraph">
<p>By default all type declarations are compiled with type safety enabled; @typesafe( false ) provides a means to override this behaviour by permitting a fall-back, to type unsafe evaluation where all constraints are generated as MVEL constraints and executed dynamically.
This can be important when dealing with collections that do not have any generics or mixed type collections.</p>
</div>
</div>
<div class="sect5">
<h6 id="__timestamp_attribute_name"><a class="anchor" href="#__timestamp_attribute_name"></a><a class="link" href="#__timestamp_attribute_name">@timestamp( &lt;attribute name&gt; )</a></h6>
<div class="paragraph">
<p>Every event has an associated timestamp assigned to it.
By default, the timestamp for a given event is read from the Session Clock and assigned to the event at the time the event is inserted into the working memory.
Although, sometimes, the event has the timestamp as one of its own attributes.
In this case, the user may tell the engine to use the timestamp from the event’s attribute instead of reading it from the Session Clock.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-property">@timestamp</span>( &lt;attributeName&gt; )</code></pre>
</div>
</div>
<div class="paragraph">
<p>To tell the engine what attribute to use as the source of the event’s timestamp, just list the attribute name as a parameter to the @timestamp tag.</p>
</div>
<div class="exampleblock">
<div class="title">Example 118. declaring the VoiceCall timestamp attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> VoiceCall
    @<span class="hljs-keyword">role</span>( <span class="hljs-keyword">event</span> )
    @<span class="hljs-keyword">timestamp</span>( callDateTime )
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="__duration_attribute_name"><a class="anchor" href="#__duration_attribute_name"></a><a class="link" href="#__duration_attribute_name">@duration( &lt;attribute name&gt; )</a></h6>
<div class="paragraph">
<p>Drools supports both event semantics: point-in-time events and interval-based events.
A point-in-time event is represented as an interval-based event whose duration is zero.
By default, all events have duration zero.
The user may attribute a different duration for an event by declaring which attribute in the event type contains the duration of the event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-property">@duration</span>( &lt;attributeName&gt; )</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, for our VoiceCall fact type, the declaration would be:</p>
</div>
<div class="exampleblock">
<div class="title">Example 119. declaring the VoiceCall duration attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> VoiceCall
    @<span class="hljs-keyword">role</span>( <span class="hljs-keyword">event</span> )
    @<span class="hljs-keyword">timestamp</span>( callDateTime )
    @<span class="hljs-keyword">duration</span>( callDuration )
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="__expires_time_interval"><a class="anchor" href="#__expires_time_interval"></a><a class="link" href="#__expires_time_interval">@expires( &lt;time interval&gt; )</a></h6>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This tag is only considered when running the engine in STREAM mode.
Also, additional discussion on the effects of using this tag is made on the Memory Management section.
It is included here for completeness.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Events may be automatically expired after some time in the working memory.
Typically this happens when, based on the existing rules in the knowledge base, the event can no longer match and activate any rules.
Although, it is possible to explicitly define when an event should expire.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-property">@expires</span>( &lt;timeOffset&gt; )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <em>timeOffset</em> is a temporal interval in the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">[#d][#h][#m][#s][#[ms]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <em>[ ]</em> means an optional parameter and <em>\#</em> means a numeric value.</p>
</div>
<div class="paragraph">
<p>So, to declare that the VoiceCall facts should be expired after 1 hour and 35 minutes after they are inserted into the working memory, the user would write:</p>
</div>
<div class="exampleblock">
<div class="title">Example 120. declaring the expiration offset for the VoiceCall events</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> VoiceCall
    @<span class="hljs-keyword">role</span>( <span class="hljs-keyword">event</span> )
    @<span class="hljs-keyword">timestamp</span>( callDateTime )
    @<span class="hljs-keyword">duration</span>( callDuration )
    @expires( <span class="hljs-number">1</span>h35m )
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The @expires policy will take precedence and override the implicit expiration offset calculated from temporal constraints and sliding windows in the knowledge base.</p>
</div>
</div>
<div class="sect5">
<h6 id="__propertychangesupport"><a class="anchor" href="#__propertychangesupport"></a><a class="link" href="#__propertychangesupport">@propertyChangeSupport</a></h6>
<div class="paragraph">
<p>Facts that implement support for property changes as defined in the Javabean(tm) spec, now can be annotated so that the engine register itself to listen for changes on fact properties.
The boolean parameter that was used in the insert() method in the Drools 4 API is deprecated and does not exist in the drools-api module.</p>
</div>
<div class="exampleblock">
<div class="title">Example 121. @propertyChangeSupport</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">declare</span> Person
    <span class="hljs-variable">@propertyChangeSupport</span>
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="__propertyreactive"><a class="anchor" href="#__propertyreactive"></a><a class="link" href="#__propertyreactive">@propertyReactive</a></h6>
<div class="paragraph">
<p>Make this type property reactive.
See Fine grained property change listeners section for details.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_predefined_attribute_level_annotations"><a class="anchor" href="#_predefined_attribute_level_annotations"></a><a class="link" href="#_predefined_attribute_level_annotations">8.7.2.2. Predefined attribute level annotations</a></h5>
<div class="paragraph">
<p>As noted before, Drools also supports annotations in type attributes.
Here is a list of predefined attribute annotations.</p>
</div>
<div class="sect5">
<h6 id="__key"><a class="anchor" href="#__key"></a><a class="link" href="#__key">@key</a></h6>
<div class="paragraph">
<p>Declaring an attribute as a key attribute has 2 major effects on generated types:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The attribute will be used as a key identifier for the type, and as so, the generated class will implement the equals() and hashCode() methods taking the attribute into account when comparing instances of this type.</p>
</li>
<li>
<p>Drools will generate a constructor using all the key attributes as parameters.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For instance:</p>
</div>
<div class="exampleblock">
<div class="title">Example 122. example of @key declarations for a type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Person
    firstName : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">key</span>
    lastName : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">key</span>
    age : <span class="hljs-built_in">int</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For the previous example, Drools will generate equals() and hashCode() methods that will check the firstName and lastName attributes to determine if two instances of Person are equal to each other, but will not check the age attribute.
It will also generate a constructor taking firstName and lastName as parameters, allowing one to create instances with a code like this:</p>
</div>
<div class="exampleblock">
<div class="title">Example 123. creating an instance using the key constructor</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">Person person = <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"John"</span>, <span class="hljs-string">"Doe"</span> );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="__position"><a class="anchor" href="#__position"></a><a class="link" href="#__position">@position</a></h6>
<div class="paragraph">
<p>Patterns support positional arguments on type declarations.</p>
</div>
<div class="paragraph">
<p>Positional arguments are ones where you don’t need to specify the field name, as the position maps to a known named field.
i.e.
Person( name == "mark" ) can be rewritten as Person( "mark"; ). The semicolon ';' is important so that the engine knows that everything before it is a positional argument.
Otherwise we might assume it was a boolean expression, which is how it could be interpreted after the semicolon.
You can mix positional and named arguments on a pattern by using the semicolon ';' to separate them.
Any variables used in a positional that have not yet been bound will be bound to the field that maps to that position.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Cheese
    <span class="hljs-keyword">name</span> : <span class="hljs-keyword">String</span>
    shop : <span class="hljs-keyword">String</span>
    price : <span class="hljs-built_in">int</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The default order is the declared order, but this can be overridden using @position</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Cheese
    <span class="hljs-keyword">name</span> : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">position</span>(<span class="hljs-number">1</span>)
    shop : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">position</span>(<span class="hljs-number">2</span>)
    price : <span class="hljs-built_in">int</span> @<span class="hljs-keyword">position</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The @Position annotation, in the org.drools.definition.type package, can be used to annotate original pojos on the classpath.
Currently only fields on classes can be annotated.
Inheritance of classes is supported, but not interfaces of methods yet.</p>
</div>
<div class="paragraph">
<p>Example patterns, with two constraints and a binding.
Remember semicolon ';' is used to differentiate the positional section from the named argument section.
Variables and literals and expressions using just literals are supported in positional arguments, but not variables.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-keyword">Cheese</span>( <span class="hljs-string">"stilton"</span>, <span class="hljs-string">"Cheese Shop"</span>, p; )
<span class="hljs-keyword">Cheese</span>( <span class="hljs-string">"stilton"</span>, <span class="hljs-string">"Cheese Shop"</span>; p : price )
<span class="hljs-keyword">Cheese</span>( <span class="hljs-string">"stilton"</span>; shop == <span class="hljs-string">"Cheese Shop"</span>, p : price )
<span class="hljs-keyword">Cheese</span>( name == <span class="hljs-string">"stilton"</span>; shop == <span class="hljs-string">"Cheese Shop"</span>, p : price )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>@Position is inherited when beans extend each other; while not recommended, two fields may have the same @position value, and not all consecutive values need be declared.
If a @position is repeated, the conflict is solved using inheritance (fields in the superclass have the precedence) and the declaration order.
If a @position value is missing, the first field without an explicit @position (if any) is selected to fill the gap.
As always, conflicts are resolved by inheritance and declaration order.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Cheese
    <span class="hljs-keyword">name</span> : <span class="hljs-keyword">String</span>
    shop : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">position</span>(<span class="hljs-number">2</span>)
    price : <span class="hljs-built_in">int</span> @<span class="hljs-keyword">position</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">declare</span> SeasonedCheese extends Cheese
    <span class="hljs-keyword">year</span> : <span class="hljs-built_in">Date</span> @<span class="hljs-keyword">position</span>(<span class="hljs-number">0</span>)
    origin : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">position</span>(<span class="hljs-number">6</span>)
    country : <span class="hljs-keyword">String</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the example, the field order would be : price (@position 0 in the superclass), year (@position 0 in the subclass), name (first field with no @position), shop (@position 2), country (second field without @position), origin.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_declaring_metadata_for_existing_types"><a class="anchor" href="#_declaring_metadata_for_existing_types"></a><a class="link" href="#_declaring_metadata_for_existing_types">8.7.3. Declaring Metadata for Existing Types</a></h4>
<div class="paragraph">
<p>Drools allows the declaration of metadata attributes for existing types in the same way as when declaring metadata attributes for new fact types.
The only difference is that there are no fields in that declaration.</p>
</div>
<div class="paragraph">
<p>For instance, if there is a class org.drools.examples.Person, and one wants to declare metadata for it, it’s possible to write the following code:</p>
</div>
<div class="exampleblock">
<div class="title">Example 124. Declaring metadata for an existing type</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">import</span> <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.examples</span><span class="hljs-class">.Person</span>

<span class="hljs-tag">declare</span> <span class="hljs-tag">Person</span>
    <span class="hljs-at_rule">@<span class="hljs-keyword">author(</span> Bob )
    @<span class="hljs-function">dateOfCreation</span>( <span class="hljs-number">01</span>-Feb-<span class="hljs-number">2009</span> )
end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Instead of using the import, it is also possible to reference the class by its fully qualified name, but since the class will also be referenced in the rules, it is usually shorter to add the import and use the short class name everywhere.</p>
</div>
<div class="exampleblock">
<div class="title">Example 125. Declaring metadata using the fully qualified class name</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">declare</span> <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.examples</span><span class="hljs-class">.Person</span>
    <span class="hljs-at_rule">@<span class="hljs-keyword">author(</span> Bob )
    @<span class="hljs-function">dateOfCreation</span>( <span class="hljs-number">01</span>-Feb-<span class="hljs-number">2009</span> )
end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_parametrized_constructors_for_declared_types"><a class="anchor" href="#_parametrized_constructors_for_declared_types"></a><a class="link" href="#_parametrized_constructors_for_declared_types">8.7.4. Parametrized constructors for declared types</a></h4>
<div class="paragraph">
<p>Generate constructors with parameters for declared types.</p>
</div>
<div class="paragraph">
<p>Example: for a declared type like the following:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Person
    firstName : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">key</span>
    lastName : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">key</span>
    age : <span class="hljs-built_in">int</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The compiler will implicitly generate 3 constructors: one without parameters, one with the @key fields, and one with all fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs javascript">Person() <span class="hljs-comment">// parameterless constructor</span>
Person( <span class="hljs-built_in">String</span> firstName, <span class="hljs-built_in">String</span> lastName )
Person( <span class="hljs-built_in">String</span> firstName, <span class="hljs-built_in">String</span> lastName, int age )</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_non_typesafe_classes"><a class="anchor" href="#_non_typesafe_classes"></a><a class="link" href="#_non_typesafe_classes">8.7.5. Non Typesafe Classes</a></h4>
<div class="paragraph">
<p>@typesafe( &lt;boolean&gt;) has been added to type declarations.
By default all type declarations are compiled with type safety enabled; @typesafe( false ) provides a means to override this behaviour by permitting a fall-back, to type unsafe evaluation where all constraints are generated as MVEL constraints and executed dynamically.
This can be important when dealing with collections that do not have any generics or mixed type collections.</p>
</div>
</div>
<div class="sect3">
<h4 id="_accessing_declared_types_from_the_application_code"><a class="anchor" href="#_accessing_declared_types_from_the_application_code"></a><a class="link" href="#_accessing_declared_types_from_the_application_code">8.7.6. Accessing Declared Types from the Application Code</a></h4>
<div class="paragraph">
<p>Declared types are usually used inside rules files, while Java models are used when sharing the model between rules and applications.
Although, sometimes, the application may need to access and handle facts from the declared types, especially when the application is wrapping the rules engine and providing higher level, domain specific user interfaces for rules management.</p>
</div>
<div class="paragraph">
<p>In such cases, the generated classes can be handled as usual with the Java Reflection API, but, as we know, that usually requires a lot of work for small results.
Therefore, Drools provides a simplified API for the most common fact handling the application may want to do.</p>
</div>
<div class="paragraph">
<p>The first important thing to realize is that a declared fact will belong to the package where it was declared.
So, for instance, in the example below, <code>Person</code> will belong to the <code>org.drools.examples</code> package, and so the fully qualified name of the generated class will be <code>org.drools.examples.Person</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 126. Declaring a type in the org.drools.examples package</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">package org.drools.examples

import java.util.Date

<span class="hljs-operator"><span class="hljs-keyword">declare</span> Person
    <span class="hljs-keyword">name</span> : <span class="hljs-keyword">String</span>
    dateOfBirth : <span class="hljs-built_in">Date</span>
    address : Address
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Declared types, as discussed previously, are generated at knowledge base compilation time, i.e., the application will only have access to them at application run time.
Therefore, these classes are not available for direct reference from the application.</p>
</div>
<div class="paragraph">
<p>Drools then provides an interface through which users can handle declared types from the application code: <code>org.drools.definition.type.FactType</code>.
Through this interface, the user can instantiate, read and write fields in the declared fact types.</p>
</div>
<div class="exampleblock">
<div class="title">Example 127. Handling declared fact types through the API</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// get a reference to a knowledge base with a declared type:</span>
KieBase kbase = ...

<span class="hljs-comment">// get the declared FactType</span>
FactType personType = kbase.getFactType( <span class="hljs-string">"org.drools.examples"</span>,
                                         <span class="hljs-string">"Person"</span> );

<span class="hljs-comment">// handle the type as necessary:</span>
<span class="hljs-comment">// create instances:</span>
Object bob = personType.newInstance();

<span class="hljs-comment">// set attributes values</span>
personType.set( bob,
                <span class="hljs-string">"name"</span>,
                <span class="hljs-string">"Bob"</span> );
personType.set( bob,
                <span class="hljs-string">"age"</span>,
                <span class="hljs-number">42</span> );

<span class="hljs-comment">// insert fact into a session</span>
KieSession ksession = ...
ksession.insert( bob );
ksession.fireAllRules();

<span class="hljs-comment">// read attributes</span>
String name = personType.get( bob, <span class="hljs-string">"name"</span> );
<span class="hljs-keyword">int</span> age = personType.get( bob, <span class="hljs-string">"age"</span> );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The API also includes other helpful methods, like setting all the attributes at once, reading values from a Map, or reading all attributes at once, into a Map.</p>
</div>
<div class="paragraph">
<p>Although the API is similar to Java reflection (yet much simpler to use), it does not use reflection underneath, relying on much more performant accessors implemented with generated bytecode.</p>
</div>
</div>
<div class="sect3">
<h4 id="_type_declaration_extends"><a class="anchor" href="#_type_declaration_extends"></a><a class="link" href="#_type_declaration_extends">8.7.7. Type Declaration 'extends'</a></h4>
<div class="paragraph">
<p>Type declarations now support 'extends' keyword for inheritance</p>
</div>
<div class="paragraph">
<p>In order to extend a type declared in Java by a DRL declared subtype, repeat the supertype in a declare statement without any fields.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">import org.people.Person

<span class="hljs-operator"><span class="hljs-keyword">declare</span> Person <span class="hljs-keyword">end</span>

<span class="hljs-keyword">declare</span> Student extends Person
    school : <span class="hljs-keyword">String</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">declare</span> LongTermStudent extends Student
    <span class="hljs-keyword">years</span> : <span class="hljs-built_in">int</span>
    course : <span class="hljs-keyword">String</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rule"><a class="anchor" href="#_rule"></a><a class="link" href="#_rule">8.8. Rule</a></h3>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/rule.png" alt="rule">
</div>
<div class="title">Figure 180. rule</div>
</div>
<div class="paragraph">
<p>A rule specifies that <em>when</em> a particular set of conditions occur, specified in the Left Hand Side
(LHS), <em>then</em> do what queryis specified as a list of actions in the Right Hand Side (RHS). A
common question from users is "Why use when instead of if?" "When" was chosen over "if" because
"if" is normally part of a procedural execution flow, where, at a specific point in time, a
condition is to be checked.</p>
</div>
<div class="paragraph">
<p>In contrast, "when" indicates that the condition evaluation is not tied to a specific evaluation
sequence or point in time, but that it happens continually, at any time during the life time of
the engine; whenever the condition is met, the actions are executed.</p>
</div>
<div class="paragraph">
<p>A rule must have a name, unique within its rule package.
If you define a rule twice in the same DRL it produces an error while loading.
If you add a DRL that includes a rule name already in the package, it replaces the previous rule.
If a rule name is to have spaces, then it will need to be enclosed in double quotes (it is best to
always use double quotes).</p>
</div>
<div class="paragraph">
<p>Attributes - described below - are optional.
They are best written one per line.</p>
</div>
<div class="paragraph">
<p>The LHS of the rule follows the <code>when</code> keyword (ideally on a new line), similarly the RHS follows
the <code>then</code> keyword (again, ideally on a newline). The rule is terminated by the keyword <code>end</code>.
Rules cannot be nested.</p>
</div>
<div class="exampleblock">
<div class="title">Example 128. Rule Syntax Overview</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml">rule "<span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>"
    <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span>&gt;</span>*
when
    <span class="hljs-tag">&lt;<span class="hljs-title">conditional</span> <span class="hljs-attribute">element</span>&gt;</span>*
then
    <span class="hljs-tag">&lt;<span class="hljs-title">action</span>&gt;</span>*
end</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 129. A simple rule</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Approve if not rejected"</span>
  salience -<span class="hljs-number">100</span>
  agenda-group <span class="hljs-string">"approval"</span>
    <span class="hljs-keyword">when</span>
        <span class="hljs-keyword">not</span> <span class="hljs-constant">Rejection</span>()
        p <span class="hljs-symbol">:</span> <span class="hljs-constant">Policy</span>(approved == <span class="hljs-keyword">false</span>, <span class="hljs-symbol">policyState:</span>status)
        exists <span class="hljs-constant">Driver</span>(age &gt; <span class="hljs-number">25</span>)
        <span class="hljs-constant">Process</span>(status == policyState)
    <span class="hljs-keyword">then</span>
        log(<span class="hljs-string">"APPROVED: due to no objections."</span>);
        p.setApproved(<span class="hljs-keyword">true</span>);
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rule_attributes"><a class="anchor" href="#_rule_attributes"></a><a class="link" href="#_rule_attributes">8.8.1. Rule Attributes</a></h4>
<div class="paragraph">
<p>Rule attributes provide a declarative way to influence the behavior of the rule.
Some are quite simple, while others are part of complex subsystems such as ruleflow.
To get the most from Drools you should make sure you have a proper understanding of each attribute.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/rule_attributes.png" alt="rule attributes">
</div>
<div class="title">Figure 181. rule attributes</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>no-loop</code></dt>
<dd>
<p>default value: <code>false</code></p>
<div class="paragraph">
<p>type: Boolean</p>
</div>
<div class="paragraph">
<p>When a rule’s consequence modifies a fact it may cause the rule to activate again, causing an
infinite loop. Setting no-loop to true will skip the creation of another Activation for the rule
with the current set of facts.</p>
</div>
</dd>
<dt class="hdlist1"><code>ruleflow-group</code></dt>
<dd>
<p>default value: N/A</p>
<div class="paragraph">
<p>type: String</p>
</div>
<div class="paragraph">
<p>Ruleflow is a Drools feature that lets you exercise control over the firing of rules.
Rules that are assembled by the same ruleflow-group identifier fire only when their group is active.</p>
</div>
</dd>
<dt class="hdlist1"><code>lock-on-active</code></dt>
<dd>
<p>default value: <code>false</code></p>
<div class="paragraph">
<p>type: Boolean</p>
</div>
<div class="paragraph">
<p>Whenever a ruleflow-group becomes active or an agenda-group receives the focus, any rule within
that group that has lock-on-active set to true will not be activated any more; irrespective of the
origin of the update, the activation of a matching rule is discarded. This is a stronger version
of <code>no-loop</code>, because the change could now be caused not only by the rule itself.  It’s ideal for calculation rules where you have a number of rules that modify a fact and you don’t want any rule re-matching and firing again.
Only when the ruleflow-group is no longer active or the agenda-group loses the focus those rules with lock-on-active set to true become eligible again for their activations to be placed onto the agenda.</p>
</div>
</dd>
<dt class="hdlist1"><code>salience</code></dt>
<dd>
<p>default value: <code>0</code></p>
<div class="paragraph">
<p>type: integer</p>
</div>
<div class="paragraph">
<p>Each rule has an integer salience attribute which defaults to zero and can be negative or positive.
Salience is a form of priority where rules with higher salience values are given higher priority when ordered in the Activation queue.</p>
</div>
<div class="paragraph">
<p>Drools also supports dynamic salience where you can use an expression involving bound variables.</p>
</div>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="title">Example 130. Dynamic Salience</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Fire in rank order 1,2,.."</span>
        salience( -<span class="hljs-variable">$rank</span> )
    <span class="hljs-keyword">when</span>
        <span class="hljs-constant">Element</span>( <span class="hljs-variable">$rank</span> <span class="hljs-symbol">:</span> rank,... )
    <span class="hljs-keyword">then</span>
        ...
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>agenda-group</code></dt>
<dd>
<p>default value: MAIN</p>
<div class="paragraph">
<p>type: String</p>
</div>
<div class="paragraph">
<p>Agenda groups allow the user to partition the Agenda providing more execution control.
Only rules in the agenda group that has acquired the focus are allowed to fire.</p>
</div>
</dd>
<dt class="hdlist1"><code>auto-focus</code></dt>
<dd>
<p>default value: <code>false</code></p>
<div class="paragraph">
<p>type: Boolean</p>
</div>
<div class="paragraph">
<p>When a rule is activated where the <code>auto-focus</code> value is true and the rule’s agenda group does not have focus yet, then it is given focus, allowing the rule to potentially fire.</p>
</div>
</dd>
<dt class="hdlist1"><code>activation-group</code></dt>
<dd>
<p>default value: N/A</p>
<div class="paragraph">
<p>type: String</p>
</div>
<div class="paragraph">
<p>Rules that belong to the same activation-group, identified by this attribute’s string value, will only fire exclusively.
More precisely, the first rule in an activation-group to fire will cancel all pending activations of all rules in the group, i.e., stop them from firing.</p>
</div>
<div class="paragraph">
<p>Note: This used to be called Xor group, but technically it’s not quite an Xor.
You may still hear people mention Xor group; just swap that term in your mind with activation-group.</p>
</div>
</dd>
<dt class="hdlist1"><code>dialect</code></dt>
<dd>
<p>default value: as specified by the package</p>
<div class="paragraph">
<p>type: String</p>
</div>
<div class="paragraph">
<p>possible values: "java" or "mvel"</p>
</div>
<div class="paragraph">
<p>The dialect species the language to be used for any code expressions in the LHS or the RHS code block.
Currently two dialects are available, Java and MVEL.
While the dialect can be specified at the package level, this attribute allows the package definition to be overridden for a rule.</p>
</div>
</dd>
<dt class="hdlist1"><code>date-effective</code></dt>
<dd>
<p>default value: N/A</p>
<div class="paragraph">
<p>type: String, containing a date and time definition</p>
</div>
<div class="paragraph">
<p>A rule can only activate if the current date and time is after date-effective attribute.</p>
</div>
</dd>
<dt class="hdlist1"><code>date-expires</code></dt>
<dd>
<p>default value: N/A</p>
<div class="paragraph">
<p>type: String, containing a date and time definition</p>
</div>
<div class="paragraph">
<p>A rule cannot activate if the current date and time is after the date-expires attribute.</p>
</div>
</dd>
<dt class="hdlist1"><code>duration</code></dt>
<dd>
<p>default value: no default value</p>
<div class="paragraph">
<p>type: long</p>
</div>
<div class="paragraph">
<p>The duration dictates that the rule will fire after a specified duration, if it is still true.</p>
</div>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="title">Example 131. Some attribute examples</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"my rule"</span>
  salience <span class="hljs-number">42</span>
  agenda-<span class="hljs-keyword">group</span> <span class="hljs-string">"number 1"</span>
    <span class="hljs-keyword">when</span> ...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_timers_and_calendars"><a class="anchor" href="#_timers_and_calendars"></a><a class="link" href="#_timers_and_calendars">8.8.2. Timers and Calendars</a></h4>
<div class="paragraph">
<p>Rules now support both interval and cron based timers, which replace the now deprecated duration attribute.</p>
</div>
<div class="exampleblock">
<div class="title">Example 132. Sample timer attribute uses</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer ( <span class="hljs-keyword">int</span>: &lt;initial delay&gt; &lt;repeat interval&gt;? )
timer ( <span class="hljs-keyword">int</span>: <span class="hljs-number">30</span>s )
timer ( <span class="hljs-keyword">int</span>: <span class="hljs-number">30</span>s <span class="hljs-number">5</span>m )

timer ( cron: &lt;cron expression&gt; )
timer ( cron:* <span class="hljs-number">0</span>/<span class="hljs-number">15</span> * * * ? )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Interval (indicated by "int:") timers follow the semantics of java.util.Timer objects, with an initial delay and an optional repeat interval.
Cron (indicated by "cron:") timers follow standard Unix cron expressions:</p>
</div>
<div class="exampleblock">
<div class="title">Example 133. A Cron Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">rule <span class="hljs-string">"Send SMS every 15 minutes"</span>
    timer (cron:* <span class="hljs-number">0</span>/<span class="hljs-number">15</span> * * * ?)
when
    $a : Alarm( on == <span class="hljs-keyword">true</span> )
then
    channels[ <span class="hljs-string">"sms"</span> ].insert( <span class="hljs-keyword">new</span> Sms( $a.mobileNumber, <span class="hljs-string">"The alarm is still on"</span> );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A rule controlled by a timer becomes active when it matches, and once for each individual match.
Its consequence is executed repeatedly, according to the timer’s settings.
This stops as soon as the condition doesn’t match any more.</p>
</div>
<div class="paragraph">
<p>Consequences are executed even after control returns from a call to fireUntilHalt.
Moreover, the Engine remains reactive to any changes made to the Working Memory.
For instance, removing a fact that was involved in triggering the timer rule’s execution causes the repeated execution to terminate, or inserting a fact so that some rule matches will cause that rule to fire.
But the Engine is not continually active, only after a rule fires, for whatever reason.
Thus, reactions to an insertion done asynchronously will not happen until the next execution of a timer-controlled rule.
Disposing a session puts an end to all timer activity.</p>
</div>
<div class="paragraph">
<p>Conversely when the rule engine runs in passive mode (i.e.: using fireAllRules instead of fireUntilHalt) by default it doesn’t fire consequences of timed rules unless fireAllRules isn’t invoked again.
However it is possible to change this default behavior by configuring the KieSession with a <code>TimedRuleExecutionOption</code> as shown in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 134. Configuring a KieSession to automatically execute timed rules</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
ksconf.setOption( TimedRuleExecutionOption.YES );
KSession ksession = kbase.newKieSession(ksconf, <span class="hljs-keyword">null</span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is also possible to have a finer grained control on the timed rules that have to be automatically executed.
To do this it is necessary to set a <code>FILTERED</code> <code>TimedRuleExecutionOption</code> that allows to define a
callback to filter those rules, as done in the next example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 135. Configuring a filter to choose which timed rules should be automatically executed</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration ksconf = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( <span class="hljs-keyword">new</span> TimedRuleExecutionOption.FILTERED(<span class="hljs-keyword">new</span> TimedRuleExecutionFilter() {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">accept</span><span class="hljs-params">(Rule[] rules)</span> </span>{
        <span class="hljs-keyword">return</span> rules[<span class="hljs-number">0</span>].getName().equals(<span class="hljs-string">"MyRule"</span>);
    }
}) );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For what regards interval timers it is also possible to define both the delay and interval as an
expression instead of a fixed value. To do that it is necessary to use an expression timer
(indicated by "expr:") as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 136. An Expression Timer Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">declare Bean
    delay   : String = <span class="hljs-string">"30s"</span>
    period  : <span class="hljs-keyword">long</span> = <span class="hljs-number">60000</span>
end

rule <span class="hljs-string">"Expression timer"</span>
    timer( expr: $d, $p )
<span class="hljs-function">when
    <span class="hljs-title">Bean</span><span class="hljs-params">( $d : delay, $p : period )</span>
then
end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The expressions, <code>$d</code> and <code>$p</code> in this case, can use any variable defined in the pattern matching part
of the rule and can be any String that can be parsed in a time duration or any numeric value that
will be internally converted in a long representing a duration expressed in milliseconds.</p>
</div>
<div class="paragraph">
<p>Both interval and expression timers can have 3 optional parameters named "start", "end" and
"repeat-limit". When one or more of these parameters are used the first part of the timer
definition must be followed by a semicolon ';' and the parameters have to be separated by a comma
',' as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 137. An Interval Timer with a start and an end</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer (<span class="hljs-keyword">int</span>: <span class="hljs-number">30</span>s <span class="hljs-number">10</span>s; start=<span class="hljs-number">3</span>-JAN-<span class="hljs-number">2010</span>, end=<span class="hljs-number">5</span>-JAN-<span class="hljs-number">2010</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The value for start and end parameters can be a Date, a String representing a Date or a long, or
more in general any Number, that will be transformed in a Java Date applying the following
conversion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">new</span> Date( ((Number) n).longValue() )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Conversely the repeat-limit can be only an integer and it defines the maximum number of
repetitions allowed by the timer. If both the end and the repeat-limit parameters are set the
timer will stop when the first of the two will be matched.</p>
</div>
<div class="paragraph">
<p>The using of the start parameter implies the definition of a phase for the timer, where the
beginning of the phase is given by the start itself plus the eventual delay. In other words in
this case the timed rule will then be scheduled at times:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">start + delay + n*period</code></pre>
</div>
</div>
<div class="paragraph">
<p>for up to repeat-limit times and no later than the end timestamp (whichever first). For instance
the rule having the following interval timer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">timer ( <span class="hljs-keyword">int</span>: <span class="hljs-number">30</span>s <span class="hljs-number">1</span>m; start=<span class="hljs-string">"3-JAN-2010"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be scheduled at the 30th second of every minute after the midnight of the 3-JAN-2010.
This also means that if for example you turn the system on at midnight of the 3-FEB-2010 it won’t
be scheduled immediately but will preserve the phase defined by the timer and so it will be
scheduled for the first time 30 seconds after the midnight.</p>
</div>
<div class="paragraph">
<p>If for some reason the system is paused (e.g. the session is serialized and then deserialized
after a while) the rule will be scheduled only once to recover from missing activations
(regardless of how many activations we missed) and subsequently it will be scheduled again in
phase with the timer.</p>
</div>
<div class="paragraph">
<p>Calendars are used to control when rules can fire. The Calendar API is modelled on
<a href="http://www.quartz-scheduler.org/">Quartz</a>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 138. Adapting a Quartz Calendar</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Calendar weekDayCal = QuartzHelper.quartzCalendarAdapter(org.quartz.Calendar quartzCal)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Calendars are registered with the <code>KieSession</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 139. Registering a Calendar</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.getCalendars().set( <span class="hljs-string">"weekday"</span>, weekDayCal );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>They can be used in conjunction with normal rules and rules including timers. The rule attribute
"calendars" may contain one or more comma-separated calendar names written as string literals.</p>
</div>
<div class="exampleblock">
<div class="title">Example 140. Using Calendars and Timers together</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">rule <span class="hljs-string">"weekdays are high priority"</span>
   calendars <span class="hljs-string">"weekday"</span>
   timer (<span class="hljs-keyword">int</span>:<span class="hljs-number">0</span> <span class="hljs-number">1</span>h)
<span class="hljs-function">when
    <span class="hljs-title">Alarm</span><span class="hljs-params">()</span>
then
    <span class="hljs-title">send</span><span class="hljs-params">( <span class="hljs-string">"priority high - we have an alarm"</span> )</span></span>;
end

rule <span class="hljs-string">"weekend are low priority"</span>
   calendars <span class="hljs-string">"weekend"</span>
   timer (<span class="hljs-keyword">int</span>:<span class="hljs-number">0</span> <span class="hljs-number">4</span>h)
<span class="hljs-function">when
    <span class="hljs-title">Alarm</span><span class="hljs-params">()</span>
then
    <span class="hljs-title">send</span><span class="hljs-params">( <span class="hljs-string">"priority low - we have an alarm"</span> )</span></span>;
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_left_hand_side_when_syntax"><a class="anchor" href="#_left_hand_side_when_syntax"></a><a class="link" href="#_left_hand_side_when_syntax">8.8.3. Left Hand Side (when) syntax</a></h4>
<div class="sect4">
<h5 id="_what_is_the_left_hand_side"><a class="anchor" href="#_what_is_the_left_hand_side"></a><a class="link" href="#_what_is_the_left_hand_side">8.8.3.1. What is the Left Hand Side?</a></h5>
<div class="paragraph">
<p>The Left Hand Side (LHS) is a common name for the conditional part of the rule.
It consists of zero or more Conditional Elements.
If the LHS is empty, it will be considered as a condition element that is always true and it will be activated once, when a new WorkingMemory session is created.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/lhs.png" alt="lhs">
</div>
<div class="title">Figure 182. Left Hand Side</div>
</div>
<div class="exampleblock">
<div class="title">Example 141. Rule without a Conditional Element</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"no CEs"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-comment">// empty</span>
then
    ... <span class="hljs-comment">// actions (executed once)</span>
end

<span class="hljs-comment">// The above rule is internally rewritten as:</span>

rule <span class="hljs-string">"eval(true)"</span>
<span class="hljs-function"><span class="hljs-keyword">when</span>
    <span class="hljs-title">eval</span>(<span class="hljs-params"> <span class="hljs-keyword">true</span> </span>)
then
    ... <span class="hljs-comment">// actions (executed once)</span>
end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Conditional elements work on one or more <em>patterns</em> (which are described below). The most common
conditional element is " <code>and"</code>. Therefore it is implicit when you have multiple patterns in the
LHS of a rule that are not connected in any way:</p>
</div>
<div class="exampleblock">
<div class="title">Example 142. Implicit and</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">rule <span class="hljs-string">"2 unconnected patterns"</span>
<span class="hljs-keyword">when</span>
    Pattern1()
    Pattern2()
<span class="hljs-keyword">then</span>
    ... <span class="hljs-regexp">//</span> actions
end

<span class="hljs-regexp">//</span> The above rule <span class="hljs-keyword">is</span> internally rewritten <span class="hljs-attribute">as</span>:

rule <span class="hljs-string">"2 and connected patterns"</span>
<span class="hljs-keyword">when</span>
    Pattern1()
    <span class="hljs-keyword">and</span> Pattern2()
<span class="hljs-keyword">then</span>
    ... <span class="hljs-regexp">//</span> actions
end</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An “and” cannot have a leading declaration binding (unlike for example <code>or</code>). This is obvious,
since a declaration can only reference a single fact at a time, and when the “and” is satisfied
it matches both facts - so which fact would the declaration bind to?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php"><span class="hljs-comment">// Compile error</span>
<span class="hljs-variable">$person</span> : (Person( name == <span class="hljs-string">"Romeo"</span> ) <span class="hljs-keyword">and</span> Person( name == <span class="hljs-string">"Juliet"</span>))</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_pattern_conditional_element"><a class="anchor" href="#_pattern_conditional_element"></a><a class="link" href="#_pattern_conditional_element">8.8.3.2. Pattern (conditional element)</a></h5>
<div class="sect5">
<h6 id="_what_is_a_pattern"><a class="anchor" href="#_what_is_a_pattern"></a><a class="link" href="#_what_is_a_pattern">What is a pattern?</a></h6>
<div class="paragraph">
<p>A pattern element is the most important Conditional Element.
It can potentially match on each fact that is inserted in the working memory.</p>
</div>
<div class="paragraph">
<p>A pattern contains of zero or more constraints and has an optional pattern binding.
The railroad diagram below shows the syntax for this.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Pattern.png" alt="Pattern">
</div>
<div class="title">Figure 183. Pattern</div>
</div>
<div class="paragraph">
<p>In its simplest form, with no constraints, a pattern matches against a fact of the given type.
In the following case the type is <code>Cheese</code>, which means that the pattern will match against all <code>Person</code> objects in the Working Memory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">Person()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type need not be the actual class of some fact object.
Patterns may refer to superclasses or even interfaces, thereby potentially matching facts from many different classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs javascript"><span class="hljs-built_in">Object</span>() <span class="hljs-comment">// matches all objects in the working memory</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside of the pattern parenthesis is where all the action happens: it defines the constraints for that pattern.
For example, with a age related constraint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( age == <span class="hljs-number">100</span> )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For backwards compatibility reasons it’s allowed to suffix patterns with the <code>;</code> character.
But it is not recommended to do that.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_pattern_binding"><a class="anchor" href="#_pattern_binding"></a><a class="link" href="#_pattern_binding">Pattern binding</a></h6>
<div class="paragraph">
<p>For referring to the matched object, use a pattern binding variable such as <code>$p</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 143. Pattern with a binding variable</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule ...
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>()
<span class="hljs-keyword">then</span>
    <span class="hljs-constant">System</span>.out.println( <span class="hljs-string">"Person "</span> + <span class="hljs-variable">$p</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The prefixed dollar symbol (<code>$</code>) is just a convention; it can be useful in complex rules where it helps to easily differentiate between variables and fields, but it is not mandatory.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_constraint_part_of_a_pattern"><a class="anchor" href="#_constraint_part_of_a_pattern"></a><a class="link" href="#_constraint_part_of_a_pattern">8.8.3.3. Constraint (part of a pattern)</a></h5>
<div class="sect5">
<h6 id="_what_is_a_constraint"><a class="anchor" href="#_what_is_a_constraint"></a><a class="link" href="#_what_is_a_constraint">What is a constraint?</a></h6>
<div class="paragraph">
<p>A constraint is an expression that returns <code>true</code> or <code>false</code>.
This example has a constraint that states <em>5 is smaller than
        6</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( <span class="hljs-number">5</span> &lt; <span class="hljs-number">6</span> )  <span class="hljs-comment">// just an example, as constraints like this would be useless in a real pattern</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In essence, it’s a Java expression with some enhancements (such as property access) and a few differences (such as <code>equals()</code> semantics for <code>==</code>). Let’s take a deeper look.</p>
</div>
</div>
<div class="sect5">
<h6 id="_property_access_on_java_beans_pojo_s"><a class="anchor" href="#_property_access_on_java_beans_pojo_s"></a><a class="link" href="#_property_access_on_java_beans_pojo_s">Property access on Java Beans (POJO’s)</a></h6>
<div class="paragraph">
<p>Any bean property can be used directly.
A bean property is exposed using a standard Java bean getter: a method <code>getMyProperty()</code> (or <code>isMyProperty()</code> for a primitive boolean) which takes no arguments and return something.
For example: the age property is written as <code>age</code> in DRL instead of the getter <code>getAge()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( age == <span class="hljs-number">50</span> )

<span class="hljs-comment">// this is the same as:</span>
Person( getAge() == <span class="hljs-number">50</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools uses the standard JDK <code>Introspector</code> class to do this mapping, so it follows the standard Java bean specification.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We recommend using property access (<code>age</code>) over using getters explicitly (<code>getAge()</code>) because of performance enhancements through field indexing.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Property accessors must not change the state of the object in a way that may effect the rules.
Remember that the rule engine effectively caches the results of its matching in between invocations to make it faster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>{
    age++; <span class="hljs-comment">// Do NOT do this</span>
    <span class="hljs-keyword">return</span> age;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>{
    Date now = DateUtil.now(); <span class="hljs-comment">// Do NOT do this</span>
    <span class="hljs-keyword">return</span> DateUtil.differenceInYears(now, birthday);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To solve this latter case, insert a fact that wraps the current date into working memory and update that fact between <code>fireAllRules</code> as needed.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following fallback applies: if the getter of a property cannot be found, the compiler will resort to using the property name as a method name and without arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( age == <span class="hljs-number">50</span> )

<span class="hljs-comment">// If Person.getAge() does not exists, this falls back to:</span>
Person( age() == <span class="hljs-number">50</span> )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Nested property access is also supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( address.houseNumber == <span class="hljs-number">50</span> )

<span class="hljs-comment">// this is the same as:</span>
Person( getAddress().getHouseNumber() == <span class="hljs-number">50</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nested properties are also indexed.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In a stateful session, care should be taken when using nested accessors as the Working Memory is not aware of any of the nested values, and does not know when they change.
Either consider them immutable while any of their parent references are inserted into the Working Memory.
Or, instead, if you wish to modify a nested value you should mark all of the outer facts as updated.
In the above example, when the <code>houseNumber</code> changes, any <code>Person</code> with that <code>Address</code> must be marked as updated.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_java_expression"><a class="anchor" href="#_java_expression"></a><a class="link" href="#_java_expression">Java expression</a></h6>
<div class="paragraph">
<p>You can use any Java expression that returns a <code>boolean</code> as a constraint inside the parentheses of a pattern.
Java expressions can be mixed with other expression enhancements, such as property access:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( age == <span class="hljs-number">50</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to change the evaluation priority by using parentheses, as in any logic or mathematical expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( age &gt; <span class="hljs-number">100</span> &amp;&amp; ( age % <span class="hljs-number">10</span> == <span class="hljs-number">0</span> ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to reuse Java methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( Math.round( weight / ( height * height ) ) &lt; <span class="hljs-number">25.0</span> )</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As for property accessors, methods must not change the state of the object in a way that may affect the rules.
Any method executed on a fact in the LHS should be a <em>read
          only</em> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">Person( incrementAndGetAge() == 10 ) // <span class="hljs-operator"><span class="hljs-keyword">Do</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">do</span> this</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The state of a fact should not change between rule invocations (unless those facts are marked as updated to the working memory on every change):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( System.currentTimeMillis() % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span> ) <span class="hljs-comment">// Do NOT do this</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Normal Java operator precedence applies, see the operator precedence list below.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All operators have normal Java semantics except for <code>==</code> and <code>!=</code>.</p>
</div>
<div class="paragraph">
<p>The <code>==</code> operator has null-safe <code>equals()</code> semantics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-regexp">//</span> Similar <span class="hljs-attribute">to</span>: java.util.Objects.equals(person.getFirstName(), <span class="hljs-string">"John"</span>)
<span class="hljs-regexp">//</span> so (because <span class="hljs-string">"John"</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>) similar <span class="hljs-attribute">to</span>:
<span class="hljs-regexp">//</span> <span class="hljs-string">"John"</span>.equals(person.getFirstName())
Person( firstName == <span class="hljs-string">"John"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>!=</code> operator has null-safe <code>!equals()</code> semantics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">// Similar to: !java.util.Objects.equals(person.getFirstName(), <span class="hljs-string">"John"</span>)
Person( firstName != <span class="hljs-string">"John"</span> )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Type coercion is always attempted if the field and the value are of different types; exceptions will be thrown if a bad coercion is attempted.
For instance, if "ten" is provided as a string in a numeric evaluator, an exception is thrown, whereas "10" would coerce to a numeric 10.
Coercion is always in favor of the field type and not the value type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">Person( age == <span class="hljs-string">"10"</span> ) <span class="hljs-regexp">//</span> <span class="hljs-string">"10"</span> <span class="hljs-keyword">is</span> coerced to <span class="hljs-number">10</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_comma_separated_and"><a class="anchor" href="#_comma_separated_and"></a><a class="link" href="#_comma_separated_and">Comma separated AND</a></h6>
<div class="paragraph">
<p>The comma character (‘`,`’) is used to separate constraint groups.
It has implicit <em>AND</em> connective semantics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-comment">// Person is at least 50 and weighs at least 80 kg</span>
Person( age &gt; <span class="hljs-number">50</span>, weight &gt; <span class="hljs-number">80</span> )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-comment">// Person is at least 50, weighs at least 80 kg and is taller than 2 meter.</span>
Person( age &gt; <span class="hljs-number">50</span>, weight &gt; <span class="hljs-number">80</span>, height &gt; <span class="hljs-number">2</span> )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Although the <code>&amp;&amp;</code> and <code>,</code> operators have the same semantics, they are resolved with different priorities: The <code>&amp;&amp;</code> operator precedes the <code>||</code> operator.
Both the <code>&amp;&amp;</code> and <code>||</code> operator precede the <code>,</code> operator.
See the operator precedence list below.</p>
</div>
<div class="paragraph">
<p>The comma operator should be preferred at the top level constraint, as it makes constraints easier to read and the engine will often be able to optimize them better.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The comma (<code>,</code>) operator cannot be embedded in a composite constraint expression, such as parentheses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( ( age &gt; <span class="hljs-number">50</span>, weight &gt; <span class="hljs-number">80</span> ) || height &gt; <span class="hljs-number">2</span> ) <span class="hljs-comment">// Do NOT do this: compile error</span>

<span class="hljs-comment">// Use this instead</span>
Person( ( age &gt; <span class="hljs-number">50</span> &amp;&amp; weight &gt; <span class="hljs-number">80</span> ) || height &gt; <span class="hljs-number">2</span> )</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_binding_variables"><a class="anchor" href="#_binding_variables"></a><a class="link" href="#_binding_variables">Binding variables</a></h6>
<div class="paragraph">
<p>A property can be bound to a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php"><span class="hljs-comment">// 2 persons of the same age</span>
Person( <span class="hljs-variable">$firstAge</span> : age ) <span class="hljs-comment">// binding</span>
Person( age == <span class="hljs-variable">$firstAge</span> ) <span class="hljs-comment">// constraint expression</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The prefixed dollar symbol (<code>$</code>) is just a convention; it can be useful in complex rules where it helps to easily differentiate between variables and fields.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For backwards compatibility reasons, It’s allowed (but not recommended) to mix a constraint binding and constraint expressions as such:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-comment">// Not recommended</span>
Person( $age : age * <span class="hljs-number">2</span> &lt; <span class="hljs-number">100</span> )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-comment">// Recommended (separates bindings and constraint expressions)</span>
Person( age * <span class="hljs-number">2</span> &lt; <span class="hljs-number">100</span>, $age : age )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Bound variable restrictions using the operator <code>==</code> provide for very fast execution as it use hash indexing to improve performance.</p>
</div>
</div>
<div class="sect5">
<h6 id="_unification"><a class="anchor" href="#_unification"></a><a class="link" href="#_unification">Unification</a></h6>
<div class="paragraph">
<p>Drools does not allow bindings to the same declaration.
However this is an important aspect to derivation query unification.
While positional arguments are always processed with unification a special unification symbol, ':=', was introduced for named arguments named arguments.
The following "unifies" the age argument across two people.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Person( <span class="hljs-variable">$age</span> := age )
Person( <span class="hljs-variable">$age</span> := age)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In essence unification will declare a binding for the first occurrence and constrain to the same value of the bound field for sequence occurrences.</p>
</div>
</div>
<div class="sect5">
<h6 id="_grouped_accessors_for_nested_objects"><a class="anchor" href="#_grouped_accessors_for_nested_objects"></a><a class="link" href="#_grouped_accessors_for_nested_objects">Grouped accessors for nested objects</a></h6>
<div class="paragraph">
<p>Often it happens that it is necessary to access multiple properties of a nested object as in the following example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-keyword">Person</span>( name == <span class="hljs-string">"mark"</span>, address.city == <span class="hljs-string">"london"</span>, address.country == <span class="hljs-string">"uk"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>These accessors to nested objects can be grouped with a '.(…​)' syntax providing more readable rules as in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-keyword">Person</span>( name == <span class="hljs-string">"mark"</span>, address.( city == <span class="hljs-string">"london"</span>, country == <span class="hljs-string">"uk"</span>) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the '.' prefix, this is necessary to differentiate the nested object constraints from a method call.</p>
</div>
</div>
<div class="sect5">
<h6 id="_inline_casts_and_coercion"><a class="anchor" href="#_inline_casts_and_coercion"></a><a class="link" href="#_inline_casts_and_coercion">Inline casts and coercion</a></h6>
<div class="paragraph">
<p>When dealing with nested objects, it also quite common the need to cast to a subtype.
It is possible to do that via the # symbol as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( name == <span class="hljs-string">"mark"</span>, address<span class="hljs-preprocessor">#LongAddress.country == <span class="hljs-string">"uk"</span> )</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example casts Address to LongAddress, making its getters available.
If the cast is not possible (instanceof returns false), the evaluation will be considered false.
Also fully qualified names are supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( name == <span class="hljs-string">"mark"</span>, address<span class="hljs-preprocessor">#org.domain.LongAddress.country == <span class="hljs-string">"uk"</span> )</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to use multiple inline casts in the same expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person( name == <span class="hljs-string">"mark"</span>, address<span class="hljs-preprocessor">#LongAddress.country#DetailedCountry.population &gt; <span class="hljs-number">10000000</span> )</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>moreover, since we also support the instanceof operator, if that is used we will infer its results for further uses of that field, within that pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">Person( name == <span class="hljs-string">"mark"</span>, address <span class="hljs-keyword">instanceof</span> LongAddress, address.country == <span class="hljs-string">"uk"</span> )</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_special_literal_support"><a class="anchor" href="#_special_literal_support"></a><a class="link" href="#_special_literal_support">Special literal support</a></h6>
<div class="paragraph">
<p>Besides normal Java literals (including Java 5 enums), this literal is also supported:</p>
</div>
</div>
<div class="sect5">
<h6 id="_date_literal"><a class="anchor" href="#_date_literal"></a><a class="link" href="#_date_literal">Date literal</a></h6>
<div class="paragraph">
<p>The date format <code>dd-mmm-yyyy</code> is supported by default.
You can customize this by providing an alternative date format mask as the System property named <code>drools.dateformat</code>.
If more control is required, use a restriction.</p>
</div>
<div class="exampleblock">
<div class="title">Example 144. Date Literal Restriction</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-keyword">Cheese</span>( bestBefore &lt; <span class="hljs-string">"27-Oct-2009"</span> )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_list_and_map_access"><a class="anchor" href="#_list_and_map_access"></a><a class="link" href="#_list_and_map_access">List and Map access</a></h6>
<div class="paragraph">
<p>It’s possible to directly access a <code>List</code> value by index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-comment">// Same as childList(0).getAge() == 18</span>
Person( childList[<span class="hljs-number">0</span>].age == <span class="hljs-number">18</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s also possible to directly access a <code>Map</code> value by key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs python">// Same <span class="hljs-keyword">as</span> credentialMap.get(<span class="hljs-string">"jsmith"</span>).isValid()
Person( credentialMap[<span class="hljs-string">"jsmith"</span>].valid )</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_abbreviated_combined_relation_condition"><a class="anchor" href="#_abbreviated_combined_relation_condition"></a><a class="link" href="#_abbreviated_combined_relation_condition">Abbreviated combined relation condition</a></h6>
<div class="paragraph">
<p>This allows you to place more than one restriction on a field using the restriction connectives <code>&amp;&amp;</code> or <code>||</code>.
Grouping via parentheses is permitted, resulting in a recursive syntax pattern.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/abbreviatedCombinedRelationCondition.png" alt="abbreviatedCombinedRelationCondition">
</div>
<div class="title">Figure 184. Abbreviated combined relation condition</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/abbreviatedCombinedRelationConditionGroup.png" alt="abbreviatedCombinedRelationConditionGroup">
</div>
<div class="title">Figure 185. Abbreviated combined relation condition withparentheses</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-comment">// Simple abbreviated combined relation condition using a single &amp;&amp;</span>
Person( age &gt; <span class="hljs-number">30</span> &amp;&amp; &lt; <span class="hljs-number">40</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-comment">// Complex abbreviated combined relation using groupings</span>
Person( age ( (&gt; <span class="hljs-number">30</span> &amp;&amp; &lt; <span class="hljs-number">40</span>) ||
              (&gt; <span class="hljs-number">20</span> &amp;&amp; &lt; <span class="hljs-number">25</span>) ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-comment">// Mixing abbreviated combined relation with constraint connectives</span>
Person( age &gt; <span class="hljs-number">30</span> &amp;&amp; &lt; <span class="hljs-number">40</span> || location == <span class="hljs-string">"london"</span> )</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_special_drl_operators"><a class="anchor" href="#_special_drl_operators"></a><a class="link" href="#_special_drl_operators">Special DRL operators</a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/operator.png" alt="operator">
</div>
<div class="title">Figure 186. Operators</div>
</div>
<div class="paragraph">
<p>Coercion to the correct value for the evaluator and the field will be attempted.</p>
</div>
</div>
<div class="sect5">
<h6 id="_the_operators_code_code"><a class="anchor" href="#_the_operators_code_code"></a><a class="link" href="#_the_operators_code_code">The operators <code>&lt; ⇐ &gt; &gt;=</code></a></h6>
<div class="paragraph">
<p>These operators can be used on properties with natural ordering.
For example, for Date fields, <code>&lt;</code> means <em>before</em>, for <code>String</code> fields, it means alphabetically lower.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Person( firstName &lt; <span class="hljs-variable">$otherFirstName</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Person( birthDate &lt; <span class="hljs-variable">$otherBirthDate</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only applies on <code>Comparable</code> properties.</p>
</div>
</div>
<div class="sect5">
<h6 id="_null_safe_dereferencing_operator"><a class="anchor" href="#_null_safe_dereferencing_operator"></a><a class="link" href="#_null_safe_dereferencing_operator">Null-safe dereferencing operator</a></h6>
<div class="paragraph">
<p>The !. operator allows to derefencing in a null-safe way.
More in details the matching algorithm requires the value to the left of the !. operator to be not null in order to give a positive result for pattern matching itself.
In other words the pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Person( <span class="hljs-variable">$streetName</span> : address!.street )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be internally translated in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php">Person( address != <span class="hljs-keyword">null</span>, <span class="hljs-variable">$streetName</span> : address.street )</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_the_operator_code_matches_code"><a class="anchor" href="#_the_operator_code_matches_code"></a><a class="link" href="#_the_operator_code_matches_code">The operator <code>matches</code></a></h6>
<div class="paragraph">
<p>Matches a field against any valid Java

Regular Expression.
Typically that regexp is a string literal, but variables that resolve to a valid regexp are also allowed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 145. Regular Expression Constraint</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Cheese( <span class="hljs-built_in">type</span> matches <span class="hljs-string">"(Buffalo)?\\S*Mozzarella"</span> )</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Like in Java, regular expressions written as string literals <em>need to escape '\\'</em>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Only applies on <code>String</code> properties.
Using <code>matches</code> against a <code>null</code> value always evaluates to false.</p>
</div>
</div>
<div class="sect5">
<h6 id="_the_operator_code_not_matches_code"><a class="anchor" href="#_the_operator_code_not_matches_code"></a><a class="link" href="#_the_operator_code_not_matches_code">The operator <code>not matches</code></a></h6>
<div class="paragraph">
<p>The operator returns true if the String does not match the regular expression.
The same rules apply as for the <code>matches</code> operator.
Example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 146. Regular Expression Constraint</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Cheese( <span class="hljs-built_in">type</span> not matches <span class="hljs-string">"(Buffalo)?\\S*Mozzarella"</span> )</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Only applies on <code>String</code> properties.
Using <code>not matches</code> against a <code>null</code> value always evaluates to true.</p>
</div>
</div>
<div class="sect5">
<h6 id="_the_operator_code_contains_code"><a class="anchor" href="#_the_operator_code_contains_code"></a><a class="link" href="#_the_operator_code_contains_code">The operator <code>contains</code></a></h6>
<div class="paragraph">
<p>The operator <code>contains</code> is used to check whether a field that is a

Collection or elements contains the specified value.</p>
</div>
<div class="exampleblock">
<div class="title">Example 147. Contains with Collections</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">CheeseCounter( cheeses contains <span class="hljs-string">"stilton"</span> ) <span class="hljs-comment">// contains with a String literal</span>
CheeseCounter( cheeses contains $<span class="hljs-keyword">var</span> ) <span class="hljs-comment">// contains with a variable</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Only applies on <code>Collection</code> properties.</p>
</div>
<div class="paragraph">
<p>The operator <code>contains</code> can also be used in place of <code>String.contains()</code> constraints checks.</p>
</div>
<div class="exampleblock">
<div class="title">Example 148. Contains with String literals</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs javascript">Cheese( name contains <span class="hljs-string">"tilto"</span> )
Person( fullName contains <span class="hljs-string">"Jr"</span> )
<span class="hljs-built_in">String</span>( <span class="hljs-keyword">this</span> contains <span class="hljs-string">"foo"</span> )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_the_operator_code_not_contains_code"><a class="anchor" href="#_the_operator_code_not_contains_code"></a><a class="link" href="#_the_operator_code_not_contains_code">The operator <code>not contains</code></a></h6>
<div class="paragraph">
<p>The operator <code>not contains</code> is used to check whether a field that is a

Collection or elements does <em>not</em> contain the specified value.</p>
</div>
<div class="exampleblock">
<div class="title">Example 149. Literal Constraint with Collections</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs python">CheeseCounter( cheeses <span class="hljs-keyword">not</span> contains <span class="hljs-string">"cheddar"</span> ) // <span class="hljs-keyword">not</span> contains <span class="hljs-keyword">with</span> a String literal
CheeseCounter( cheeses <span class="hljs-keyword">not</span> contains $var ) // <span class="hljs-keyword">not</span> contains <span class="hljs-keyword">with</span> a variable</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Only applies on <code>Collection</code> properties.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>For backward compatibility, the <code>excludes</code> operator is supported as a synonym for <code>not contains</code>.</em></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The operator <code>not contains</code> can also be used in place of the logical negation of <code>String.contains()</code> for constraints checks - i.e.: <code>! String.contains()</code></p>
</div>
<div class="exampleblock">
<div class="title">Example 150. Contains with String literals</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">Cheese( name <span class="hljs-keyword">not</span> contains <span class="hljs-string">"tilto"</span> )
Person( fullName <span class="hljs-keyword">not</span> contains <span class="hljs-string">"Jr"</span> )
String( <span class="hljs-keyword">this</span> <span class="hljs-keyword">not</span> contains <span class="hljs-string">"foo"</span> )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_the_operator_code_memberof_code"><a class="anchor" href="#_the_operator_code_memberof_code"></a><a class="link" href="#_the_operator_code_memberof_code">The operator <code>memberOf</code></a></h6>
<div class="paragraph">
<p>The operator <code>memberOf</code> is used to check whether a field is a member of a collection or elements; that collection must be a variable.</p>
</div>
<div class="exampleblock">
<div class="title">Example 151. Literal Constraint with Collections</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">CheeseCounter( cheese memberOf <span class="hljs-variable">$matureCheeses</span> )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_the_operator_code_not_memberof_code"><a class="anchor" href="#_the_operator_code_not_memberof_code"></a><a class="link" href="#_the_operator_code_not_memberof_code">The operator <code>not memberOf</code></a></h6>
<div class="paragraph">
<p>The operator <code>not memberOf</code> is used to check whether a field is not a member of a collection or elements; that collection must be a variable.</p>
</div>
<div class="exampleblock">
<div class="title">Example 152. Literal Constraint with Collections</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">CheeseCounter( cheese <span class="hljs-keyword">not</span> memberOf <span class="hljs-variable">$matureCheeses</span> )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_the_operator_code_soundslike_code"><a class="anchor" href="#_the_operator_code_soundslike_code"></a><a class="link" href="#_the_operator_code_soundslike_code">The operator <code>soundslike</code></a></h6>
<div class="paragraph">
<p>This operator is similar to <code>matches</code>, but it checks whether a word has almost the same sound (using English pronunciation) as the given value.
This is based on the Soundex algorithm (see <code><a href="http://en.wikipedia.org/wiki/Soundex" class="bare">http://en.wikipedia.org/wiki/Soundex</a></code>).</p>
</div>
<div class="exampleblock">
<div class="title">Example 153. Test with soundslike</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-regexp">//</span> match cheese <span class="hljs-string">"fubar"</span> <span class="hljs-keyword">or</span> <span class="hljs-string">"foobar"</span>
Cheese( name soundslike <span class="hljs-string">'foobar'</span> )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_the_operator_code_str_code"><a class="anchor" href="#_the_operator_code_str_code"></a><a class="link" href="#_the_operator_code_str_code">The operator <code>str</code></a></h6>
<div class="paragraph">
<p>This operator <code>str</code> is used to check whether a field that is a <code>String</code> starts with or ends with a certain value.
It can also be used to check the length of the String.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-keyword">Message</span>( routingValue str[startsWith] <span class="hljs-string">"R1"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-keyword">Message</span>( routingValue str[endsWith] <span class="hljs-string">"R2"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Message( routingValue str[length] <span class="hljs-number">17</span> )</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_the_operators_code_in_code_and_code_notin_code_compound_value_restriction"><a class="anchor" href="#_the_operators_code_in_code_and_code_notin_code_compound_value_restriction"></a><a class="link" href="#_the_operators_code_in_code_and_code_notin_code_compound_value_restriction">The operators <code>in</code> and <code>notin</code> (compound value restriction)</a></h6>
<div class="paragraph">
<p>The compound value restriction is used where there is more than one possible value to match.
Currently only the <code>in</code> and <code>not in</code> evaluators support this.
The second operand of this operator must be a comma-separated list of values, enclosed in parentheses.
Values may be given as variables, literals, return values or qualified identifiers.
Both evaluators are actually <em>syntactic
          sugar</em>, internally rewritten as a list of multiple restrictions using the operators <code>!=</code> and <code>==</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/compoundValueRestriction.png" alt="compoundValueRestriction">
</div>
<div class="title">Figure 187. compoundValueRestriction</div>
</div>
<div class="exampleblock">
<div class="title">Example 154. Compound Restriction using "in"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Person( <span class="hljs-variable">$cheese</span> : favouriteCheese )
Cheese( <span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> ( <span class="hljs-string">"stilton"</span>, <span class="hljs-string">"cheddar"</span>, <span class="hljs-variable">$cheese</span> ) )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_inline_eval_operator_deprecated"><a class="anchor" href="#_inline_eval_operator_deprecated"></a><a class="link" href="#_inline_eval_operator_deprecated">Inline eval operator (deprecated)</a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/inlineEvalConstraint.png" alt="inlineEvalConstraint">
</div>
<div class="title">Figure 188. Inline Eval Expression</div>
</div>
<div class="paragraph">
<p>An

inline eval constraint can use any valid dialect expression as long as it results to a primitive boolean.
The expression must be constant over time.
Any previously bound variable, from the current or previous pattern, can be used; autovivification is also used to auto-create field binding variables.
When an identifier is found that is not a current variable, the builder looks to see if the identifier is a field on the current object type, if it is, the field binding is auto-created as a variable of the same name.
This is called autovivification of field variables inside of inline eval’s.</p>
</div>
<div class="paragraph">
<p>This example will find all male-female pairs where the male is 2 years older than the female; the variable <code>age</code> is auto-created in the second pattern by the autovivification process.</p>
</div>
<div class="exampleblock">
<div class="title">Example 155. Return Value operator</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Person( girlAge : age, sex = <span class="hljs-string">"F"</span> )
Person( <span class="hljs-built_in">eval</span>( age == girlAge + <span class="hljs-number">2</span> ), sex = <span class="hljs-string">'M'</span> ) // <span class="hljs-built_in">eval</span>() is actually obsolete <span class="hljs-keyword">in</span> this example</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Inline eval’s are effectively obsolete as their inner syntax is now directly supported.
It’s recommended not to use them.
Simply write the expression without wrapping eval() around it.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_operator_precedence"><a class="anchor" href="#_operator_precedence"></a><a class="link" href="#_operator_precedence">Operator precedence</a></h6>
<div class="paragraph">
<p>The operators are evaluated in this precedence:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. Operator precedence</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator type</th>
<th class="tableblock halign-left valign-top">Operators</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(nested / null safe) property access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.</code><code>!.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not normal Java semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List/Map access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[ ]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not normal Java semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constraint binding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not normal Java semantics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multiplicative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\*</code><code>/</code><code>%</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">additive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\+</code><code>-</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">shift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&lt;</code><code>&gt;&gt;</code><code>&gt;&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">relational</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code><code>&gt;</code><code>⇐</code><code>&gt;=</code><code>instanceof</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">equality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>==</code><code>!=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does not use normal Java (<em>not</em>)
                <em>same</em> semantics: uses
                (<em>not</em>) <em>equals</em>
                semantics instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">non-short circuiting AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">non-short circuiting exclusive OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">non-short circuiting inclusive OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;&amp;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>||</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ternary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>? :</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>,</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not normal Java semantics</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_positional_arguments"><a class="anchor" href="#_positional_arguments"></a><a class="link" href="#_positional_arguments">8.8.3.4. Positional Arguments</a></h5>
<div class="paragraph">
<p>Patterns now support positional arguments on type declarations.</p>
</div>
<div class="paragraph">
<p>Positional arguments are ones where you don’t need to specify the field name, as the position maps to a known named field.
i.e.
Person( name == "mark" ) can be rewritten as Person( "mark"; ). The semicolon ';' is important so that the engine knows that everything before it is a positional argument.
Otherwise we might assume it was a boolean expression, which is how it could be interpreted after the semicolon.
You can mix positional and named arguments on a pattern by using the semicolon ';' to separate them.
Any variables used in a positional that have not yet been bound will be bound to the field that maps to that position.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Cheese
    <span class="hljs-keyword">name</span> : <span class="hljs-keyword">String</span>
    shop : <span class="hljs-keyword">String</span>
    price : <span class="hljs-built_in">int</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example patterns, with two constraints and a binding.
Remember semicolon ';' is used to differentiate the positional section from the named argument section.
Variables and literals and expressions using just literals are supported in positional arguments, but not variables.
Positional arguments are always resolved using unification.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-keyword">Cheese</span>( <span class="hljs-string">"stilton"</span>, <span class="hljs-string">"Cheese Shop"</span>, p; )
<span class="hljs-keyword">Cheese</span>( <span class="hljs-string">"stilton"</span>, <span class="hljs-string">"Cheese Shop"</span>; p : price )
<span class="hljs-keyword">Cheese</span>( <span class="hljs-string">"stilton"</span>; shop == <span class="hljs-string">"Cheese Shop"</span>, p : price )
<span class="hljs-keyword">Cheese</span>( name == <span class="hljs-string">"stilton"</span>; shop == <span class="hljs-string">"Cheese Shop"</span>, p : price )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Positional arguments that are given a previously declared binding will constrain against that using unification; these are referred to as input arguments.
If the binding does not yet exist, it will create the declaration binding it to the field represented by the position argument; these are referred to as output arguments.</p>
</div>
</div>
<div class="sect4">
<h5 id="_fine_grained_property_change_listeners"><a class="anchor" href="#_fine_grained_property_change_listeners"></a><a class="link" href="#_fine_grained_property_change_listeners">8.8.3.5. Fine grained property change listeners</a></h5>
<div class="paragraph">
<p>When you call modify() (see the modify statement section) on a given object it will trigger a revaluation of all patterns of the matching object type in the knowledge base.
This can can lead to unwanted and useless evaluations and in the worst cases to infinite recursions.
The only workaround to avoid it was to split up your objects into smaller ones having a 1 to 1 relationship with the original object.</p>
</div>
<div class="paragraph">
<p>This  has been introduced to provide an easier and more consistent way to overcome this problem.
In fact it allows the pattern matching to only react to modification of properties actually constrained or bound inside of a given pattern.
That will help with performance and recursion and avoid artificial object splitting.</p>
</div>
<div class="paragraph">
<p>This feature is enabled by default, but in case you need or want to dectivate it on a specific bean you can annotate it with @classReactive.
This annotation works both on DRL type declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Person
@classReactive
    firstName : <span class="hljs-keyword">String</span>
    lastName : <span class="hljs-keyword">String</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and on Java classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs java"><span class="hljs-annotation">@ClassReactive</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>{
    <span class="hljs-keyword">private</span> String firstName;
    <span class="hljs-keyword">private</span> String lastName;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By using this feature, for instance, if you have a rule like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Every person named Mario is a male"</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$person</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>( firstName == <span class="hljs-string">"Mario"</span> )
<span class="hljs-keyword">then</span>
    modify ( <span class="hljs-variable">$person</span> )  { setMale( <span class="hljs-keyword">true</span> ) }
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>you won’t have to add the no-loop attribute to it in order to avoid an infinite recursion because the engine recognizes that the pattern matching is done on the 'firstName' property while the RHS of the rule modifies the 'male' one.
Note that this feature does not work for update(), and this is one of the reasons why we promote modify() since it encapsulates the field changes within the statement.
Moreover, on Java classes, you can also annotate any method to say that its invocation actually modifies other properties.
For instance in the former Person class you could have a method like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">@Modifies( { <span class="hljs-string">"firstName"</span>, <span class="hljs-string">"lastName"</span> } )
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>{
    String[] names = name.split(<span class="hljs-string">"\\s"</span>);
    <span class="hljs-keyword">this</span>.firstName = names[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">this</span>.lastName = names[<span class="hljs-number">1</span>];
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That means that if a rule has a RHS like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">modify(<span class="hljs-variable">$person</span>) { <span class="hljs-built_in">set</span>Name(<span class="hljs-string">"Mario Fusco"</span>) }</code></pre>
</div>
</div>
<div class="paragraph">
<p>it will correctly recognize that the values of both properties 'firstName' and 'lastName' could have potentially been modified and act accordingly, not missing of reevaluating the patterns constrained on them.
At the moment the usage of @Modifies is not allowed on fields but only on methods.
This is coherent with the most common scenario where the @Modifies will be used for methods that are not related with a class field as in the Person.setName() in the former example.
Also note that @Modifies is not transitive, meaning that if another method internally invokes the Person.setName() one it won’t be enough to annotate it with @Modifies( { "name" } ), but it is necessary to use @Modifies( { "firstName", "lastName" } ) even on it.
Very likely @Modifies transitivity will be implemented in the next release.</p>
</div>
<div class="paragraph">
<p>For what regards nested accessors, the engine will be notified only for top level fields.
In other words a pattern matching like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">Person</span> ( address.city.name == <span class="hljs-string">"London )</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>will be revaluated only for modification of the 'address' property of a Person object.
In the same way the constraints analysis is currently strictly limited to what there is inside a pattern.
Another example could help to clarify this.
An LHS like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$p</span> : Person( )
Car( owner = <span class="hljs-variable">$p</span>.name )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will not listen on modifications of the person’s name, while this one will do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Person( <span class="hljs-variable">$name</span> : name )
Car( owner = <span class="hljs-variable">$name</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>To overcome this problem it is possible to annotate a pattern with @watch as it follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-variable">$p</span> : Person( ) <span class="hljs-variable">@watch</span> ( name )
Car( owner = <span class="hljs-variable">$p</span>.name )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Indeed, annotating a pattern with @watch allows you to modify the inferred set of properties for which that pattern will react.
Note that the properties named in the @watch annotation are actually added to the ones automatically inferred, but it is also possible to explicitly exclude one or more of them prepending their name with a ! and to make the pattern to listen for all or none of the properties of the type used in the pattern respectively with the wildcrds * and !*. So, for example, you can annotate a pattern in the LHS of a rule like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-regexp">//</span> listens <span class="hljs-keyword">for</span> changes <span class="hljs-literal">on</span> both firstName (inferred) <span class="hljs-keyword">and</span> lastName
Person( firstName == $expectedFirstName ) <span class="hljs-property">@watch</span>( lastName )

<span class="hljs-regexp">//</span> listens <span class="hljs-keyword">for</span> all the properties <span class="hljs-keyword">of</span> the Person bean
Person( firstName == $expectedFirstName ) <span class="hljs-property">@watch</span>( * )

<span class="hljs-regexp">//</span> listens <span class="hljs-keyword">for</span> changes <span class="hljs-literal">on</span> lastName <span class="hljs-keyword">and</span> explicitly exclude firstName
Person( firstName == $expectedFirstName ) <span class="hljs-property">@watch</span>( lastName, !firstName )

<span class="hljs-regexp">//</span> listens <span class="hljs-keyword">for</span> changes <span class="hljs-literal">on</span> all the properties except the age one
Person( firstName == $expectedFirstName ) <span class="hljs-property">@watch</span>( *, !age )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since it doesn’t make sense to use this annotation on a pattern using a type annotated with @ClassReactive the rule compiler will raise a compilation error if you try to do so.
Also the duplicated usage of the same property in @watch (for example like in: @watch( firstName, ! firstName ) ) will end up in a compilation error.
In a next release we will make the automatic detection of the properties to be listened smarter by doing analysis even outside of the pattern.</p>
</div>
<div class="paragraph">
<p>It is also possible to enable this feature only on specific types of your model or to completely disallow it by using on option of the KnowledgeBuilderConfiguration.
In particular this new PropertySpecificOption can have one of the following 3 values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">- DISABLED =&gt; the feature <span class="hljs-keyword">is</span> turned <span class="hljs-literal">off</span> <span class="hljs-keyword">and</span> all the other related annotations are just ignored
- ALLOWED =&gt; types are <span class="hljs-keyword">not</span> property reactive <span class="hljs-keyword">unless</span> they are <span class="hljs-keyword">not</span> annotated with <span class="hljs-property">@PropertyReactive</span> (which <span class="hljs-keyword">is</span> the dual <span class="hljs-keyword">of</span> <span class="hljs-property">@ClassReactive</span>)
- ALWAYS =&gt; all types are property reactive. This <span class="hljs-keyword">is</span> the default behavior</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, for example, to have a KnowledgeBuilder for which property reactivity is disabled by default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">KnowledgeBuilderConfiguration config = KnowledgeBuilderFactory.newKnowledgeBuilderConfiguration();
config.setOption(PropertySpecificOption.ALLOWED);
KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder(config);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this last case it will be possible to reenable the property reactivity feature on a specific type by annotating it with @PropertyReactive.</p>
</div>
<div class="paragraph">
<p>It is important to notice that property reactivity is automatically available only for modifications performed inside the consequence of a rule.
Conversely a programmatic update is unaware of the object’s properties that have been changed, so it is unable of using this feature.</p>
</div>
<div class="paragraph">
<p>To workaround this limitation it is possible to optionally specify in an update statement the names of the properties that
have been changed in the modified object as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Person me = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"me"</span>, <span class="hljs-number">40</span>);
FactHandle meHandle = ksession.insert( me );

me.setAge(<span class="hljs-number">41</span>);
me.setAddress(<span class="hljs-string">"California Avenue"</span>);
ksession.update( meHandle, me, <span class="hljs-string">"age"</span>, <span class="hljs-string">"address"</span> );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_basic_conditional_elements"><a class="anchor" href="#_basic_conditional_elements"></a><a class="link" href="#_basic_conditional_elements">8.8.3.6. Basic conditional elements</a></h5>
<div class="sect5">
<h6 id="_conditional_element_code_and_code"><a class="anchor" href="#_conditional_element_code_and_code"></a><a class="link" href="#_conditional_element_code_and_code">Conditional Element <code>and</code></a></h6>
<div class="paragraph">
<p>The Conditional Element <code>"and"</code> is used to group other Conditional Elements into a logical conjunction.
Drools supports both prefix <code>and</code> and infix <code>and</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/infixAnd.png" alt="infixAnd">
</div>
<div class="title">Figure 189. infixAnd</div>
</div>
<div class="paragraph">
<p>Traditional infix <code>and</code> is supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php"><span class="hljs-comment">//infixAnd</span>
Cheese( cheeseType : type ) <span class="hljs-keyword">and</span> Person( favouriteCheese == cheeseType )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Explicit grouping with parentheses is also supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php"><span class="hljs-comment">//infixAnd with grouping</span>
( Cheese( cheeseType : type ) <span class="hljs-keyword">and</span>
  ( Person( favouriteCheese == cheeseType ) <span class="hljs-keyword">or</span>
    Person( favouriteCheese == cheeseType ) )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The symbol <code>&amp;&amp;</code> (as an alternative to <code>and</code>) is deprecated.
But it is still supported in the syntax for backwards compatibility.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/prefixAnd.png" alt="prefixAnd">
</div>
<div class="title">Figure 190. prefixAnd</div>
</div>
<div class="paragraph">
<p>Prefix <code>and</code> is also supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">(and Cheese( cheeseType : <span class="hljs-built_in">type</span> )
     Person( favouriteCheese == cheeseType ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The root element of the LHS is an implicit prefix <code>and</code> and doesn’t need to be specified:</p>
</div>
<div class="exampleblock">
<div class="title">Example 156. implicit root prefixAnd</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">when
    Cheese( cheeseType : <span class="hljs-built_in">type</span> )
    Person( favouriteCheese == cheeseType )
<span class="hljs-keyword">then</span>
    ...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_conditional_element_code_or_code"><a class="anchor" href="#_conditional_element_code_or_code"></a><a class="link" href="#_conditional_element_code_or_code">Conditional Element <code>or</code></a></h6>
<div class="paragraph">
<p>The Conditional Element <code>or</code> is used to group other Conditional Elements into a logical disjunction.
Drools supports both prefix <code>or</code> and infix <code>or</code>.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/infixOr.png" alt="infixOr">
</div>
<div class="title">Figure 191. infixOr</div>
</div>
<div class="paragraph">
<p>Traditional infix <code>or</code> is supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php"><span class="hljs-comment">//infixOr</span>
Cheese( cheeseType : type ) <span class="hljs-keyword">or</span> Person( favouriteCheese == cheeseType )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Explicit grouping with parentheses is also supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php"><span class="hljs-comment">//infixOr with grouping</span>
( Cheese( cheeseType : type ) <span class="hljs-keyword">or</span>
  ( Person( favouriteCheese == cheeseType ) <span class="hljs-keyword">and</span>
    Person( favouriteCheese == cheeseType ) )</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The symbol <code>||</code> (as an alternative to <code>or</code>) is deprecated.
But it is still supported in the syntax for backwards compatibility.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/prefixOr.png" alt="prefixOr">
</div>
<div class="title">Figure 192. prefixOr</div>
</div>
<div class="paragraph">
<p>Prefix <code>or</code> is also supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">(<span class="hljs-function">or <span class="hljs-title">Person</span><span class="hljs-params">( sex == <span class="hljs-string">"f"</span>, age &gt; <span class="hljs-number">60</span> )</span>
    <span class="hljs-title">Person</span><span class="hljs-params">( sex == <span class="hljs-string">"m"</span>, age &gt; <span class="hljs-number">65</span> )</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The behavior of the Conditional Element <code>or</code> is different from the connective <code>||</code> for constraints and restrictions in field constraints.
The engine actually has no understanding of the Conditional Element <code>or</code>.
Instead, via a number of different logic transformations, a rule with <code>or</code> is rewritten as a number of subrules.
This process ultimately results in a rule that has a single <code>or</code> as the root node and one subrule for each of its CEs.
Each subrule can activate and fire like any normal rule; there is no special behavior or interaction between these subrules.
- This can be most confusing to new rule authors.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The Conditional Element <code>or</code> also allows for optional pattern binding.
This means that each resulting subrule will bind its pattern to the pattern binding.
Each pattern must be bound separately, using eponymous variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">pensioner : ( Person( sex == <span class="hljs-string">"f"</span>, age &gt; <span class="hljs-number">60</span> ) <span class="hljs-keyword">or</span> Person( sex == <span class="hljs-string">"m"</span>, age &gt; <span class="hljs-number">65</span> ) )</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">(or pensioner : Person( sex == <span class="hljs-string">"f"</span>, age &gt; <span class="hljs-number">60</span> )
    pensioner : Person( sex == <span class="hljs-string">"m"</span>, age &gt; <span class="hljs-number">65</span> ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the conditional element <code>or</code> results in multiple subrule generation, one for each possible logically outcome, the example above would result in the internal generation of two rules.
These two rules work independently within the Working Memory, which means both can match, activate and fire - there is no shortcutting.</p>
</div>
<div class="paragraph">
<p>The best way to think of the conditional element <code>or</code> is as a shortcut for generating two or more similar rules.
When you think of it that way, it’s clear that for a single rule there could be multiple activations if two or more terms of the disjunction are true.</p>
</div>
</div>
<div class="sect5">
<h6 id="_conditional_element_code_not_code"><a class="anchor" href="#_conditional_element_code_not_code"></a><a class="link" href="#_conditional_element_code_not_code">Conditional Element <code>not</code></a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/not.png" alt="not">
</div>
<div class="title">Figure 193. not</div>
</div>
<div class="paragraph">
<p>The CE <code>not</code> is first order logic’s non-existential quantifier and checks for the non-existence of something in the Working Memory.
Think of "not" as meaning "there must be none of…​".</p>
</div>
<div class="paragraph">
<p>The keyword <code>not</code> may be followed by parentheses around the CEs that it applies to.
In the simplest case of a single pattern (like below) you may optionally omit the parentheses.</p>
</div>
<div class="exampleblock">
<div class="title">Example 157. No Busses</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-keyword">not</span> Bus()</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 158. No red Busses</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php"><span class="hljs-comment">// Brackets are optional:</span>
not Bus(color == <span class="hljs-string">"red"</span>)
<span class="hljs-comment">// Brackets are optional:</span>
not ( Bus(color == <span class="hljs-string">"red"</span>, number == <span class="hljs-number">42</span>) )
<span class="hljs-comment">// "not" with nested infix and - two patterns,</span>
<span class="hljs-comment">// brackets are requires:</span>
not ( Bus(color == <span class="hljs-string">"red"</span>) <span class="hljs-keyword">and</span>
      Bus(color == <span class="hljs-string">"blue"</span>) )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_conditional_element_code_exists_code"><a class="anchor" href="#_conditional_element_code_exists_code"></a><a class="link" href="#_conditional_element_code_exists_code">Conditional Element <code>exists</code></a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/exists.png" alt="exists">
</div>
<div class="title">Figure 194. exists</div>
</div>
<div class="paragraph">
<p>The CE <code>exists</code> is first order logic’s existential quantifier and checks for the existence of something in the Working Memory.
Think of "exists" as meaning "there is at least one..". It is different from just having the pattern on its own, which is more like saying "for each one of…​". If you use <code>exists</code> with a pattern, the rule will only activate at most once, regardless of how much data there is in working memory that matches the condition inside of the <code>exists</code> pattern.
Since only the existence matters, no bindings will be established.</p>
</div>
<div class="paragraph">
<p>The keyword <code>exists</code> must be followed by parentheses around the CEs that it applies to.
In the simplest case of a single pattern (like below) you may omit the parentheses.</p>
</div>
<div class="exampleblock">
<div class="title">Example 159. At least one Bus</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">exists</span> Bus()</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 160. At least one red Bus</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-keyword">exists</span> Bus(color == <span class="hljs-string">"red"</span>)
// brackets are optional:
<span class="hljs-keyword">exists</span> ( Bus(color == <span class="hljs-string">"red"</span>, number == <span class="hljs-number">42</span>) )
// <span class="hljs-string">"exists"</span> with nested infix <span class="hljs-keyword">and</span>,
<span class="hljs-regexp">//</span> brackets are required:
<span class="hljs-keyword">exists</span> ( Bus(color == <span class="hljs-string">"red"</span>) <span class="hljs-keyword">and</span>
         Bus(color == <span class="hljs-string">"blue"</span>) )</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_conditional_elements"><a class="anchor" href="#_advanced_conditional_elements"></a><a class="link" href="#_advanced_conditional_elements">8.8.3.7. Advanced conditional elements</a></h5>
<div class="sect5">
<h6 id="_conditional_element_code_forall_code"><a class="anchor" href="#_conditional_element_code_forall_code"></a><a class="link" href="#_conditional_element_code_forall_code">Conditional Element <code>forall</code></a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/forall.png" alt="forall">
</div>
<div class="title">Figure 195. forall</div>
</div>
<div class="paragraph">
<p>The Conditional Element <code>forall</code> completes the First Order Logic support in Drools.
The Conditional Element <code>forall</code> evaluates to true when all facts that match the first pattern match all the remaining patterns.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"All English buses are red"</span>
when
    forall( <span class="hljs-variable">$bus</span> : Bus( <span class="hljs-built_in">type</span> == <span class="hljs-string">'english'</span>)
                   Bus( this == <span class="hljs-variable">$bus</span>, color = <span class="hljs-string">'red'</span> ) )
<span class="hljs-keyword">then</span>
    // all English buses are red
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above rule, we "select" all Bus objects whose type is "english". Then, for each fact that matches this pattern we evaluate the following patterns and if they match, the forall CE will evaluate to true.</p>
</div>
<div class="paragraph">
<p>To state that all facts of a given type in the working memory must match a set of constraints, <code>forall</code> can be written with a single pattern for simplicity.
Example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 161. Single Pattern Forall</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"All Buses are Red"</span>
<span class="hljs-function"><span class="hljs-keyword">when</span>
    <span class="hljs-title">forall</span>(<span class="hljs-params"> Bus( color == <span class="hljs-string">'red'</span> </span>) )
then
    <span class="hljs-comment">// all Bus facts are red</span>
end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Another example shows multiple patterns inside the <code>forall</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 162. Multi-Pattern Forall</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"all employees have health and dental care programs"</span>
<span class="hljs-keyword">when</span>
    forall( <span class="hljs-variable">$emp</span> : Employee()
            HealthCare( employee == <span class="hljs-variable">$emp</span> )
            DentalCare( employee == <span class="hljs-variable">$emp</span> )
          )
then
    // all employees have health <span class="hljs-keyword">and</span> dental care
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Forall can be nested inside other CEs.
For instance, <code>forall</code> can be used inside a <code>not</code> CE.
Note that only single patterns have optional parentheses, so that with a nested <code>forall</code> parentheses must be used:</p>
</div>
<div class="exampleblock">
<div class="title">Example 163. Combining Forall with Not CE</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"not all employees have health and dental care"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-keyword">not</span> ( forall( <span class="hljs-variable">$emp</span> : Employee()
                  HealthCare( employee == <span class="hljs-variable">$emp</span> )
                  DentalCare( employee == <span class="hljs-variable">$emp</span> ) )
        )
then
    // <span class="hljs-keyword">not</span> all employees have health <span class="hljs-keyword">and</span> dental care
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As a side note, <code>forall( p1 p2 p3…​)</code> is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-keyword">not</span>(p1 <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span>(<span class="hljs-keyword">and</span> p2 p3...))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, it is important to note that <code>forall</code> is a <em>scope delimiter</em>.
Therefore, it can use any previously bound variable, but no variable bound inside it will be available for use outside of it.</p>
</div>
</div>
<div class="sect5">
<h6 id="_conditional_element_code_from_code"><a class="anchor" href="#_conditional_element_code_from_code"></a><a class="link" href="#_conditional_element_code_from_code">Conditional Element <code>from</code></a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/from.png" alt="from">
</div>
<div class="title">Figure 196. from</div>
</div>
<div class="paragraph">
<p>The Conditional Element <code>from</code> enables users to specify an arbitrary source for data to be matched by LHS patterns.
This allows the engine to reason over data not in the Working Memory.
The data source could be a sub-field on a bound variable or the results of a method call.
It is a powerful construction that allows out of the box integration with other application components and frameworks.
One common example is the integration with data retrieved on-demand from databases using hibernate named queries.</p>
</div>
<div class="paragraph">
<p>The expression used to define the object source is any expression that follows regular MVEL syntax.
Therefore, it allows you to easily use object property navigation, execute method calls and access maps and collections elements.</p>
</div>
<div class="paragraph">
<p>Here is a simple example of reasoning and binding on another pattern sub-field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"validate zipcode"</span>
when
    Person( <span class="hljs-variable">$personAddress</span> : address )
    Address( zipcode == <span class="hljs-string">"23920W"</span>) from <span class="hljs-variable">$personAddress</span>
<span class="hljs-keyword">then</span>
    // zip code is ok
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>With all the flexibility from the new expressiveness in the Drools engine you can slice and dice this problem many ways.
This is the same but shows how you can use a graph notation with the 'from':</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"validate zipcode"</span>
when
    <span class="hljs-variable">$p</span> : Person( )
    <span class="hljs-variable">$a</span> : Address( zipcode == <span class="hljs-string">"23920W"</span>) from <span class="hljs-variable">$p</span>.address
<span class="hljs-keyword">then</span>
    // zip code is ok
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Previous examples were evaluations using a single pattern.
The CE <code>from</code> also support object sources that return a collection of objects.
In that case, <code>from</code> will iterate over all objects in the collection and try to match each of them individually.
For instance, if we want a rule that applies 10% discount to each item in an order, we could do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"apply 10% discount to all items over US$ 100,00 in an order"</span>
when
    <span class="hljs-variable">$order</span> : Order()
    <span class="hljs-variable">$item</span>  : OrderItem( value &gt; <span class="hljs-number">100</span> ) from <span class="hljs-variable">$order</span>.items
<span class="hljs-keyword">then</span>
    // apply discount to <span class="hljs-variable">$item</span>
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will cause the rule to fire once for each item whose value is greater than 100 for each given order.</p>
</div>
<div class="paragraph">
<p>You must take caution, however, when using <code>from</code>, especially in conjunction with the <code>lock-on-active</code> rule attribute as it may produce unexpected results.
Consider the example provided earlier, but now slightly modified as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
<span class="hljs-operator"><span class="hljs-keyword">lock</span>-<span class="hljs-keyword">on</span>-active <span class="hljs-literal">true</span>
<span class="hljs-keyword">when</span>
    $<span class="hljs-keyword">p</span> : Person( )
    $a : Address( state == <span class="hljs-string">"NC"</span>) <span class="hljs-keyword">from</span> $<span class="hljs-keyword">p</span>.address
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">modify</span> ($<span class="hljs-keyword">p</span>) {} // Assign person <span class="hljs-keyword">to</span> sales region <span class="hljs-number">1</span> <span class="hljs-keyword">in</span> a <span class="hljs-keyword">modify</span> <span class="hljs-keyword">block</span>
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Apply a discount to people in the city of Raleigh"</span>
ruleflow-<span class="hljs-keyword">group</span> <span class="hljs-string">"test"</span>
<span class="hljs-keyword">lock</span>-<span class="hljs-keyword">on</span>-active <span class="hljs-literal">true</span>
<span class="hljs-keyword">when</span>
    $<span class="hljs-keyword">p</span> : Person( )
    $a : Address( city == <span class="hljs-string">"Raleigh"</span>) <span class="hljs-keyword">from</span> $<span class="hljs-keyword">p</span>.address
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">modify</span> ($<span class="hljs-keyword">p</span>) {} // <span class="hljs-keyword">Apply</span> discount <span class="hljs-keyword">to</span> person <span class="hljs-keyword">in</span> a <span class="hljs-keyword">modify</span> <span class="hljs-keyword">block</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, persons in Raleigh, NC should be assigned to sales region 1 and receive a discount; i.e., you would expect both rules to activate and fire.
Instead you will find that only the second rule fires.</p>
</div>
<div class="paragraph">
<p>If you were to turn on the audit log, you would also see that when the second rule fires, it deactivates the first rule.
Since the rule attribute <code>lock-on-active</code> prevents a rule from creating new activations when a set of facts change, the first rule fails to reactivate.
Though the set of facts have not changed, the use of <code>from</code> returns a new fact for all intents and purposes each time it is evaluated.</p>
</div>
<div class="paragraph">
<p>First, it’s important to review why you would use the above pattern.
You may have many rules across different rule-flow groups.
When rules modify working memory and other rules downstream of your RuleFlow (in different rule-flow groups) need to be reevaluated, the use of <code>modify</code> is critical.
You don’t, however, want other rules in the same rule-flow group to place activations on one another recursively.
In this case, the <code>no-loop</code> attribute is ineffective, as it would only prevent a rule from activating itself recursively.
Hence, you resort to <code>lock-on-active</code>.</p>
</div>
<div class="paragraph">
<p>There are several ways to address this issue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avoid the use of <code>from</code> when you can assert all facts into working memory or use nested object references in your constraint expressions (shown below).</p>
</li>
<li>
<p>Place the variable assigned used in the modify block as the last sentence in your condition (LHS).</p>
</li>
<li>
<p>Avoid the use of <code>lock-on-active</code> when you can explicitly manage how rules within the same rule-flow group place activations on one another (explained below).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The preferred solution is to minimize use of <code>from</code> when you can assert all your facts into working memory directly.
In the example above, both the Person and Address instance can be asserted into working memory.
In this case, because the graph is fairly simple, an even easier solution is to modify your rules as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
<span class="hljs-operator"><span class="hljs-keyword">lock</span>-<span class="hljs-keyword">on</span>-active <span class="hljs-literal">true</span>
<span class="hljs-keyword">when</span>
    $<span class="hljs-keyword">p</span> : Person(address.state == <span class="hljs-string">"NC"</span> )
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">modify</span> ($<span class="hljs-keyword">p</span>) {} // Assign person <span class="hljs-keyword">to</span> sales region <span class="hljs-number">1</span> <span class="hljs-keyword">in</span> a <span class="hljs-keyword">modify</span> <span class="hljs-keyword">block</span>
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Apply a discount to people in the city of Raleigh"</span>
ruleflow-<span class="hljs-keyword">group</span> <span class="hljs-string">"test"</span>
<span class="hljs-keyword">lock</span>-<span class="hljs-keyword">on</span>-active <span class="hljs-literal">true</span>
<span class="hljs-keyword">when</span>
    $<span class="hljs-keyword">p</span> : Person(address.city == <span class="hljs-string">"Raleigh"</span> )
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">modify</span> ($<span class="hljs-keyword">p</span>) {} //<span class="hljs-keyword">Apply</span> discount <span class="hljs-keyword">to</span> person <span class="hljs-keyword">in</span> a <span class="hljs-keyword">modify</span> <span class="hljs-keyword">block</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, you will find that both rules fire as expected.
However, it is not always possible to access nested facts as above.
Consider an example where a Person holds one or more Addresses and you wish to use an existential quantifier to match people with at least one address that meets certain conditions.
In this case, you would have to resort to the use of <code>from</code> to reason over the collection.</p>
</div>
<div class="paragraph">
<p>There are several ways to use <code>from</code> to achieve this and not all of them exhibit an issue with the use of <code>lock-on-active</code>.
For example, the following use of <code>from</code> causes both rules to fire as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
<span class="hljs-operator"><span class="hljs-keyword">lock</span>-<span class="hljs-keyword">on</span>-active <span class="hljs-literal">true</span>
<span class="hljs-keyword">when</span>
    $<span class="hljs-keyword">p</span> : Person($addresses : addresses)
    <span class="hljs-keyword">exists</span> (Address(state == <span class="hljs-string">"NC"</span>) <span class="hljs-keyword">from</span> $addresses)
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">modify</span> ($<span class="hljs-keyword">p</span>) {} // Assign person <span class="hljs-keyword">to</span> sales region <span class="hljs-number">1</span> <span class="hljs-keyword">in</span> a <span class="hljs-keyword">modify</span> <span class="hljs-keyword">block</span>
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Apply a discount to people in the city of Raleigh"</span>
ruleflow-<span class="hljs-keyword">group</span> <span class="hljs-string">"test"</span>
<span class="hljs-keyword">lock</span>-<span class="hljs-keyword">on</span>-active <span class="hljs-literal">true</span>
<span class="hljs-keyword">when</span>
    $<span class="hljs-keyword">p</span> : Person($addresses : addresses)
    <span class="hljs-keyword">exists</span> (Address(city == <span class="hljs-string">"Raleigh"</span>) <span class="hljs-keyword">from</span> $addresses)
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">modify</span> ($<span class="hljs-keyword">p</span>) {} // <span class="hljs-keyword">Apply</span> discount <span class="hljs-keyword">to</span> person <span class="hljs-keyword">in</span> a <span class="hljs-keyword">modify</span> <span class="hljs-keyword">block</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the following slightly different approach does exhibit the problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">rule "Assign people in North Carolina (NC) to sales region 1"
ruleflow-group "test"
<span class="hljs-operator"><span class="hljs-keyword">lock</span>-<span class="hljs-keyword">on</span>-active <span class="hljs-literal">true</span>
<span class="hljs-keyword">when</span>
    $assessment : Assessment()
    $<span class="hljs-keyword">p</span> : Person()
    $addresses : <span class="hljs-keyword">List</span>() <span class="hljs-keyword">from</span> $<span class="hljs-keyword">p</span>.addresses
    <span class="hljs-keyword">exists</span> (Address( state == <span class="hljs-string">"NC"</span>) <span class="hljs-keyword">from</span> $addresses)
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">modify</span> ($assessment) {} // <span class="hljs-keyword">Modify</span> assessment <span class="hljs-keyword">in</span> a <span class="hljs-keyword">modify</span> <span class="hljs-keyword">block</span>
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Apply a discount to people in the city of Raleigh"</span>
ruleflow-<span class="hljs-keyword">group</span> <span class="hljs-string">"test"</span>
<span class="hljs-keyword">lock</span>-<span class="hljs-keyword">on</span>-active <span class="hljs-literal">true</span>
<span class="hljs-keyword">when</span>
    $assessment : Assessment()
    $<span class="hljs-keyword">p</span> : Person()
    $addresses : <span class="hljs-keyword">List</span>() <span class="hljs-keyword">from</span> $<span class="hljs-keyword">p</span>.addresses
    <span class="hljs-keyword">exists</span> (Address( city == <span class="hljs-string">"Raleigh"</span>) <span class="hljs-keyword">from</span> $addresses)
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">modify</span> ($assessment) {} // <span class="hljs-keyword">Modify</span> assessment <span class="hljs-keyword">in</span> a <span class="hljs-keyword">modify</span> <span class="hljs-keyword">block</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the $addresses variable is returned from the use of <code>from</code>.
The example also introduces a new object, assessment, to highlight one possible solution in this case.
If the $assessment variable assigned in the condition (LHS) is moved to the last condition in each rule, both rules fire as expected.</p>
</div>
<div class="paragraph">
<p>Though the above examples demonstrate how to combine the use of <code>from</code> with <code>lock-on-active</code> where no loss of rule activations occurs, they carry the drawback of placing a dependency on the order of conditions on the LHS.
In addition, the solutions present greater complexity for the rule author in terms of keeping track of which conditions may create issues.</p>
</div>
<div class="paragraph">
<p>A better alternative is to assert more facts into working memory.
In this case, a person’s addresses may be asserted into working memory and the use of <code>from</code> would not be necessary.</p>
</div>
<div class="paragraph">
<p>There are cases, however, where asserting all data into working memory is not practical and we need to find other solutions.
Another option is to reevaluate the need for <code>lock-on-active</code>.
An alternative to <code>lock-on-active</code> is to directly manage how rules within the same rule-flow group activate one another by including conditions in each rule that prevent rules from activating each other recursively when working memory is modified.
For example, in the case above where a discount is applied to citizens of Raleigh, a condition may be added to the rule that checks whether the discount has already been applied.
If so, the rule does not activate.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The pattern containing a from clause cannot be followed by another pattern starting with a parenthesis as in the following example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-constant">R</span> <span class="hljs-keyword">when</span>
  <span class="hljs-variable">$l</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">List</span>( )
  <span class="hljs-constant">String</span>() from <span class="hljs-variable">$l</span>
  (<span class="hljs-constant">String</span>() <span class="hljs-keyword">or</span> <span class="hljs-constant">Number</span>())
<span class="hljs-keyword">then</span> <span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is because in that case the DRL parser reads the from expression as "from $l (String() or Number())" and it is impossible to disambiguate this expression from a function call. The straightforward fix to this is wrapping also the from clause in parenthesis as it follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-constant">R</span> <span class="hljs-keyword">when</span>
  <span class="hljs-variable">$l</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">List</span>( )
  (<span class="hljs-constant">String</span>() from <span class="hljs-variable">$l</span>)
  (<span class="hljs-constant">String</span>() <span class="hljs-keyword">or</span> <span class="hljs-constant">Number</span>())
<span class="hljs-keyword">then</span> <span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_conditional_element_code_collect_code"><a class="anchor" href="#_conditional_element_code_collect_code"></a><a class="link" href="#_conditional_element_code_collect_code">Conditional Element <code>collect</code></a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/collect.png" alt="collect">
</div>
<div class="title">Figure 197. collect</div>
</div>
<div class="paragraph">
<p>The Conditional Element <code>collect</code> allows rules to reason over a collection of objects obtained from the given source or from the working memory.
In First Oder Logic terms this is the cardinality quantifier.
A simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">import java.util.ArrayList

rule <span class="hljs-string">"Raise priority if system has more than 3 pending alarms"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$system</span> : System()
    <span class="hljs-variable">$alarms</span> : ArrayList( size &gt;= <span class="hljs-number">3</span> )
              from collect( Alarm( <span class="hljs-keyword">system</span> == <span class="hljs-variable">$system</span>, status == <span class="hljs-string">'pending'</span> ) )
then
    // Raise priority, because <span class="hljs-keyword">system</span> <span class="hljs-variable">$system</span> has
    // <span class="hljs-number">3</span> <span class="hljs-keyword">or</span> more alarms pending. The pending alarms
    // are <span class="hljs-variable">$alarms</span>.
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the rule will look for all pending alarms in the working memory for each given system and group them in ArrayLists.
If 3 or more alarms are found for a given system, the rule will fire.</p>
</div>
<div class="paragraph">
<p>The result pattern of <code>collect</code> can be any concrete class that implements the <code>java.util.Collection</code> interface and provides a default no-arg public constructor.
This means that you can use Java collections like ArrayList, LinkedList, HashSet, etc., or your own class, as long as it implements the <code>java.util.Collection</code> interface and provide a default no-arg public constructor.</p>
</div>
<div class="paragraph">
<p>Both source and result patterns can be constrained as any other pattern.</p>
</div>
<div class="paragraph">
<p>Variables bound before the <code>collect</code> CE are in the scope of both source and result patterns and therefore you can use them to constrain both your source and result patterns.
But note that <code>collect</code> is a scope delimiter for bindings, so that any binding made inside of it is not available for use outside of it.</p>
</div>
<div class="paragraph">
<p>Collect accepts nested <code>from</code> CEs.
The following example is a valid use of "collect":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">import java.util.LinkedList;

rule <span class="hljs-string">"Send a message to all mothers"</span>
<span class="hljs-keyword">when</span>
    $town : Town( name == <span class="hljs-string">'Paris'</span> )
    $mothers : LinkedList()
               <span class="hljs-function"><span class="hljs-keyword">from</span> <span class="hljs-title">collect</span>(<span class="hljs-params"> Person( gender == <span class="hljs-string">'F'</span>, children &gt; <span class="hljs-number">0</span> </span>)
                             <span class="hljs-keyword">from</span> $town.<span class="hljs-title">getPeople</span>(<span class="hljs-params"></span>)
                           )
then
    <span class="hljs-comment">// send a message to all mothers</span>
end</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_conditional_element_code_accumulate_code"><a class="anchor" href="#_conditional_element_code_accumulate_code"></a><a class="link" href="#_conditional_element_code_accumulate_code">Conditional Element <code>accumulate</code></a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/accumulate.png" alt="accumulate">
</div>
<div class="title">Figure 198. accumulate</div>
</div>
<div class="paragraph">
<p>The Conditional Element <code>accumulate</code> is a more flexible and powerful form of <code>collect</code>, in the sense that it can be used to do what <code>collect</code> does and also achieve results that the CE <code>collect</code> is not capable of achieving.
Accumulate allows a rule to iterate over a collection of objects, executing custom actions for each of the elements, and at the end, it returns a result object.</p>
</div>
<div class="paragraph">
<p>Accumulate supports both the use of pre-defined accumulate functions, or the use of inline custom code.
Inline custom code should be avoided though, as it is harder for rule authors to maintain, and frequently leads to code duplication.
Accumulate functions are easier to test and reuse.</p>
</div>
<div class="paragraph">
<p>The Accumulate CE also supports multiple different syntaxes.
The preferred syntax is the top level accumulate, as noted bellow, but all other syntaxes are supported for backward compatibility.</p>
</div>
</div>
<div class="sect5">
<h6 id="_accumulate_ce_preferred_syntax"><a class="anchor" href="#_accumulate_ce_preferred_syntax"></a><a class="link" href="#_accumulate_ce_preferred_syntax">Accumulate CE (preferred syntax)</a></h6>
<div class="paragraph">
<p>The top level accumulate syntax is the most compact and flexible syntax.
The simplified syntax is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml">accumulate( <span class="hljs-tag">&lt;<span class="hljs-title">source</span> <span class="hljs-attribute">pattern</span>&gt;</span>; <span class="hljs-tag">&lt;<span class="hljs-title">functions</span>&gt;</span> [;<span class="hljs-tag">&lt;<span class="hljs-title">constraints</span>&gt;</span>] )</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance, a rule to calculate the minimum, maximum and average temperature reading for a given sensor and that raises an alarm if the minimum temperature is under 20C degrees and the average is over 70C degrees could be written in the following way, using Accumulate:</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The DRL language defines “`acc`” as a synonym of “`accumulate`”. The author might prefer to use “`acc`” as a less verbose keyword or the full keyword “`accumulate`” for legibility.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"Raise alarm"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$s</span> : Sensor()
    accumulate( Reading( sensor == <span class="hljs-variable">$s</span>, <span class="hljs-variable">$temp</span> : temperature );
                <span class="hljs-variable">$min</span> : min( <span class="hljs-variable">$temp</span> ),
                <span class="hljs-variable">$max</span> : max( <span class="hljs-variable">$temp</span> ),
                <span class="hljs-variable">$avg</span> : average( <span class="hljs-variable">$temp</span> );
                <span class="hljs-variable">$min</span> &lt; <span class="hljs-number">20</span>, <span class="hljs-variable">$avg</span> &gt; <span class="hljs-number">70</span> )
then
    // raise the <span class="hljs-keyword">alarm</span>
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, min, max and average are Accumulate Functions and will calculate the minimum, maximum and average temperature values over all the readings for each sensor.</p>
</div>
<div class="paragraph">
<p>Drools ships with several built-in accumulate functions, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>average</p>
</li>
<li>
<p>min</p>
</li>
<li>
<p>max</p>
</li>
<li>
<p>count</p>
</li>
<li>
<p>sum</p>
</li>
<li>
<p>variance</p>
</li>
<li>
<p>standardDeviation</p>
</li>
<li>
<p>collectList</p>
</li>
<li>
<p>collectSet</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These common functions accept any expression as input.
For instance, if someone wants to calculate the average profit on all items of an order, a rule could be written using the average function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"Average profit"</span>
when
    <span class="hljs-variable">$order</span> : Order()
    accumulate( OrderItem( order == <span class="hljs-variable">$order</span>, <span class="hljs-variable">$cost</span> : cost, <span class="hljs-variable">$price</span> : price );
                <span class="hljs-variable">$avgProfit</span> : average( <span class="hljs-number">1</span> - <span class="hljs-variable">$cost</span> / <span class="hljs-variable">$price</span> ) )
<span class="hljs-keyword">then</span>
    // average profit <span class="hljs-keyword">for</span> <span class="hljs-variable">$order</span> is <span class="hljs-variable">$avgProfit</span>
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Accumulate Functions are all pluggable.
That means that if needed, custom, domain specific functions can easily be added to the engine and rules can start to use them without any restrictions.
To implement a new Accumulate Function all one needs to do is to create a Java class that implements the <code>org.kie.api.runtime.rule.AccumulateFunction</code> interface.
As an example of an Accumulate Function implementation, the following is the implementation of the <code>average</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">/**
 * An implementation of an accumulator capable of calculating average values
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AverageAccumulateFunction</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">org</span>.<span class="hljs-title">kie</span>.<span class="hljs-title">api</span>.<span class="hljs-title">runtime</span>.<span class="hljs-title">rule</span>.<span class="hljs-title">AccumulateFunction</span>&lt;<span class="hljs-title">AverageAccumulateFunction</span>.<span class="hljs-title">AverageData</span>&gt; </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readExternal</span><span class="hljs-params">(ObjectInput in)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException </span>{

    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeExternal</span><span class="hljs-params">(ObjectOutput out)</span> <span class="hljs-keyword">throws</span> IOException </span>{

    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AverageData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Externalizable</span> </span>{
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span>    count = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> total = <span class="hljs-number">0</span>;

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AverageData</span><span class="hljs-params">()</span> </span>{}

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">readExternal</span><span class="hljs-params">(ObjectInput in)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException </span>{
            count   = in.readInt();
            total   = in.readDouble();
        }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writeExternal</span><span class="hljs-params">(ObjectOutput out)</span> <span class="hljs-keyword">throws</span> IOException </span>{
            out.writeInt(count);
            out.writeDouble(total);
        }

    }

    <span class="hljs-comment">/* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#createContext()
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> AverageData <span class="hljs-title">createContext</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AverageData();
    }

    <span class="hljs-comment">/* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#init(java.io.Serializable)
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(AverageData context)</span> </span>{
        context.count = <span class="hljs-number">0</span>;
        context.total = <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">/* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#accumulate(java.io.Serializable, java.lang.Object)
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">accumulate</span><span class="hljs-params">(AverageData context,
                           Object value)</span> </span>{
        context.count++;
        context.total += ((Number) value).doubleValue();
    }

    <span class="hljs-comment">/* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#reverse(java.io.Serializable, java.lang.Object)
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">reverse</span><span class="hljs-params">(AverageData context, Object value)</span> </span>{
        context.count--;
        context.total -= ((Number) value).doubleValue();
    }

    <span class="hljs-comment">/* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#getResult(java.io.Serializable)
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getResult</span><span class="hljs-params">(AverageData context)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Double( context.count == <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : context.total / context.count );
    }

    <span class="hljs-comment">/* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#supportsReverse()
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">supportsReverse</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-comment">/* (non-Javadoc)
     * @see org.kie.api.runtime.rule.AccumulateFunction#getResultType()
     */</span>
    <span class="hljs-keyword">public</span> Class&lt; ? &gt; getResultType() {
        <span class="hljs-keyword">return</span> Number.class;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code for the function is very simple, as we could expect, as all the "dirty" integration work is done by the engine.
Finally, to use the function in the rules, the author can import it using the "import accumulate" statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml">import accumulate <span class="hljs-tag">&lt;<span class="hljs-title">class_name</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-title">function_name</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance, if one implements the class <code>some.package.VarianceFunction</code> function that implements the <code>variance</code> function and wants to use it in the rules, he would do the following:</p>
</div>
<div class="exampleblock">
<div class="title">Example 164. Example of importing and using the custom “`variance`” accumulate function</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">import accumulate some.package.VarianceFunction variance

rule <span class="hljs-string">"Calculate Variance"</span>
when
    accumulate( Test( <span class="hljs-variable">$s</span> : score ), <span class="hljs-variable">$v</span> : variance( <span class="hljs-variable">$s</span> ) )
<span class="hljs-keyword">then</span>
    // the variance of the <span class="hljs-built_in">test</span> scores is <span class="hljs-variable">$v</span>
end</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The built in functions (sum, average, etc) are imported automatically by the engine.
Only user-defined custom accumulate functions need to be explicitly imported.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For backward compatibility, Drools still supports the configuration of accumulate functions through configuration files and system properties, but this is a deprecated method.
In order to configure the variance function from the previous example using the configuration file or system property, the user would set a property like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs java">drools.accumulate.function.variance = some.<span class="hljs-keyword">package</span>.VarianceFunction</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that "<code>drools.accumulate.function.</code>" is a prefix that must always be used,
"<code>variance</code>" is how the function will be used in the drl files, and
"<code>some.package.VarianceFunction</code>" is the fully qualified name of the class that implements the
function behavior.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_alternate_syntax_single_function_with_return_type"><a class="anchor" href="#_alternate_syntax_single_function_with_return_type"></a><a class="link" href="#_alternate_syntax_single_function_with_return_type">Alternate Syntax: single function with return type</a></h6>
<div class="paragraph">
<p>The accumulate syntax evolved over time with the goal of becoming more compact and expressive.
Nevertheless, Drools still supports previous syntaxes for backward compatibility purposes.</p>
</div>
<div class="paragraph">
<p>In case the rule is using a single accumulate function on a given accumulate, the author may add a pattern for the result object and use the "from" keyword to link it to the accumulate result.
Example: a rule to apply a 10% discount on orders over $100 could be written in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"Apply 10% discount to orders over US$ 100,00"</span>
when
    <span class="hljs-variable">$order</span> : Order()
    <span class="hljs-variable">$total</span> : Number( doubleValue &gt; <span class="hljs-number">100</span> )
             from accumulate( OrderItem( order == <span class="hljs-variable">$order</span>, <span class="hljs-variable">$value</span> : value ),
                              sum( <span class="hljs-variable">$value</span> ) )
<span class="hljs-keyword">then</span>
    // apply discount to <span class="hljs-variable">$order</span>
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the accumulate element is using only one function (sum), and so, the rules author opted to explicitly write a pattern for the result type of the accumulate function (Number) and write the constraints inside it.
There are no problems in using this syntax over the compact syntax presented before, except that is is a bit more verbose.
Also note that it is not allowed to use both the return type and the functions binding in the same accumulate statement.</p>
</div>
<div class="paragraph">
<p>Compile-time checks are performed in order to ensure the pattern used with the "<code>from</code>" keyword is  assignable from the result of the accumulate function used.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With this syntax, the "<code>from</code>" binds to the single result returned by the accumulate function, and it does not iterate.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In the above example, "<code>$total</code>" is bound to the result returned by the accumulate sum() function.</p>
</div>
<div class="paragraph">
<p>As another example however, if the result of the accumulate function is a collection, "<code>from</code>" still binds to the single result and it does not iterate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"Person names"</span>
when
  <span class="hljs-variable">$x</span> : Object() from accumulate(MyPerson( <span class="hljs-variable">$val</span> : name );
                                collectList( <span class="hljs-variable">$val</span> ) )
<span class="hljs-keyword">then</span>
  // <span class="hljs-variable">$x</span> is a List
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The binded "<code>$x : Object()</code>" is the List itself, returned by the collectList accumulate function used.</p>
</div>
<div class="paragraph">
<p>This is an important distinction to highlight, as the "<code>from</code>" keyword can also be used separately of accumulate, to iterate over the elements of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"Iterate the numbers"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$xs</span> : List()
    <span class="hljs-variable">$x</span> : Integer() from <span class="hljs-variable">$xs</span>
then
  // <span class="hljs-variable">$x</span> matches <span class="hljs-keyword">and</span> binds to <span class="hljs-keyword">each</span> Integer in the collection
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this syntax is still supported for backward compatibility purposes, for this and other reasons we encourage rule authors to make use instead of the Accumulate CE preferred syntax (described in the previous chapter), so to avoid any potential pitfalls, as described by these examples.</p>
</div>
</div>
<div class="sect5">
<h6 id="_accumulate_with_inline_custom_code"><a class="anchor" href="#_accumulate_with_inline_custom_code"></a><a class="link" href="#_accumulate_with_inline_custom_code">Accumulate with inline custom code</a></h6>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The use of accumulate with inline custom code is not a good practice for several reasons, including difficulties on maintaining and testing rules that use them, as well as the inability of reusing that code.
Implementing your own accumulate functions is very simple and straightforward, they are easy to unit test and to use.
This form of accumulate is supported for backward compatibility only.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Another possible syntax for the accumulate is to define inline custom code, instead of using accumulate functions.
As noted on the previous warned, this is discouraged though for the stated reasons.</p>
</div>
<div class="paragraph">
<p>The general syntax of the <code>accumulate</code> CE with inline custom code is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">pattern</span>&gt;</span> from accumulate( <span class="hljs-tag">&lt;<span class="hljs-title">source</span> <span class="hljs-attribute">pattern</span>&gt;</span>,
                                  init( <span class="hljs-tag">&lt;<span class="hljs-title">init</span> <span class="hljs-attribute">code</span>&gt;</span> ),
                                  action( <span class="hljs-tag">&lt;<span class="hljs-title">action</span> <span class="hljs-attribute">code</span>&gt;</span> ),
                                  reverse( <span class="hljs-tag">&lt;<span class="hljs-title">reverse</span> <span class="hljs-attribute">code</span>&gt;</span> ),
                                  result( <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">expression</span>&gt;</span> ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The meaning of each of the elements is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>&lt;source pattern&gt;</em>: the source pattern is a regular pattern that the engine will try to match against each of the source objects.</p>
</li>
<li>
<p><em>&lt;init code&gt;</em>: this is a semantic block of code in the selected dialect that will be executed once for each tuple, before iterating over the source objects.</p>
</li>
<li>
<p><em>&lt;action code&gt;</em>: this is a semantic block of code in the selected dialect that will be executed for each of the source objects.</p>
</li>
<li>
<p><em>&lt;reverse code&gt;</em>: this is an optional semantic block of code in the selected dialect that if present will be executed for each source object that no longer matches the source pattern. The objective of this code block is to undo any calculation done in the <em>&lt;action code&gt;</em> block, so that the engine can do decremental calculation when a source object is modified or deleted, hugely improving performance of these operations.</p>
</li>
<li>
<p><em>&lt;result expression&gt;</em>: this is a semantic expression in the selected dialect that is executed after all source objects are iterated.</p>
</li>
<li>
<p><em>&lt;result pattern&gt;</em>: this is a regular pattern that the engine tries to match against the object returned from the <em>&lt;result expression&gt;</em>. If it matches, the <code>accumulate</code> conditional element evaluates to <em>true</em> and the engine proceeds with the evaluation of the next CE in the rule. If it does not matches, the <code>accumulate</code> CE evaluates to <em>false</em> and the engine stops evaluating CEs for that rule.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is easier to understand if we look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"Apply 10% discount to orders over US$ 100,00"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$order</span> : Order()
    <span class="hljs-variable">$total</span> : Number( doubleValue &gt; <span class="hljs-number">100</span> )
             from accumulate( OrderItem( order == <span class="hljs-variable">$order</span>, <span class="hljs-variable">$value</span> : value ),
                              init( double total = <span class="hljs-number">0</span>; ),
                              action( total += <span class="hljs-variable">$value</span>; ),
                              <span class="hljs-keyword">reverse</span>( total -= <span class="hljs-variable">$value</span>; ),
                              result( total ) )
then
    // apply discount to <span class="hljs-variable">$order</span>
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, for each <code>Order</code> in the Working Memory, the engine will execute the <em>init
          code</em> initializing the total variable to zero.
Then it will iterate over all <code>OrderItem</code> objects for that order, executing the <em>action</em> for each one (in the example, it will sum the value of all items into the total variable). After iterating over all <code>OrderItem</code> objects, it will return the value corresponding to the <em>result
          expression</em> (in the above example, the value of variable <code>total</code>). Finally, the engine will try to match the result with the <code>Number</code> pattern, and if the double value is greater than 100, the rule will fire.</p>
</div>
<div class="paragraph">
<p>The example used Java as the semantic dialect, and as such, note that the usage of the semicolon as statement delimiter is mandatory in the init, action and reverse code blocks.
The result is an expression and, as such, it does not admit ';'. If the user uses any other dialect, he must comply to that dialect’s specific syntax.</p>
</div>
<div class="paragraph">
<p>As mentioned before, the <em>reverse code</em> is optional, but it is strongly recommended that the user writes it in order to benefit from the <em>improved performance on update
          and delete</em>.</p>
</div>
<div class="paragraph">
<p>The <code>accumulate</code> CE can be used to execute any action on source objects.
The following example instantiates and populates a custom object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"Accumulate using custom objects"</span>
when
    <span class="hljs-variable">$person</span>   : Person( <span class="hljs-variable">$likes</span> : likes )
    <span class="hljs-variable">$cheesery</span> : Cheesery( totalAmount &gt; <span class="hljs-number">100</span> )
                from accumulate( <span class="hljs-variable">$cheese</span> : Cheese( <span class="hljs-built_in">type</span> == <span class="hljs-variable">$likes</span> ),
                                 init( Cheesery cheesery = new Cheesery(); ),
                                 action( cheesery.addCheese( <span class="hljs-variable">$cheese</span> ); ),
                                 reverse( cheesery.removeCheese( <span class="hljs-variable">$cheese</span> ); ),
                                 result( cheesery ) );
<span class="hljs-keyword">then</span>
    // <span class="hljs-keyword">do</span> something
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_conditional_element_code_eval_code"><a class="anchor" href="#_conditional_element_code_eval_code"></a><a class="link" href="#_conditional_element_code_eval_code">8.8.3.8. Conditional Element <code>eval</code></a></h5>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/eval.png" alt="eval">
</div>
<div class="title">Figure 199. eval</div>
</div>
<div class="paragraph">
<p>The conditional element <code>eval</code> is essentially a catch-all which allows any semantic code (that returns a primitive boolean) to be executed.
This code can refer to variables that were bound in the LHS of the rule, and functions in the rule package.
Overuse of eval reduces the declarativeness of your rules and can result in a poorly performing engine.
While <code>eval</code> can be used anywhere in the patterns, the best practice is to add it as the last conditional element in the LHS of a rule.</p>
</div>
<div class="paragraph">
<p>Evals cannot be indexed and thus are not as efficient as Field Constraints.
However this makes them ideal for being used when functions return values that change over time, which is not allowed within Field Constraints.</p>
</div>
<div class="paragraph">
<p>For folks who are familiar with Drools 2.x lineage, the old Drools parameter and condition tags are equivalent to binding a variable to an appropriate type, and then using it in an eval node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">p1</span> : <span class="hljs-tag">Parameter</span>()
<span class="hljs-tag">p2</span> : <span class="hljs-tag">Parameter</span>()
<span class="hljs-tag">eval</span>( <span class="hljs-tag">p1</span><span class="hljs-class">.getList</span>()<span class="hljs-class">.containsKey</span>( <span class="hljs-tag">p2</span><span class="hljs-class">.getItem</span>() ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">p1 : Parameter()
p2 : Parameter()
// call <span class="hljs-keyword">function</span> isValid <span class="hljs-keyword">in</span> the LHS
<span class="hljs-built_in">eval</span>( isValid( p1, p2 ) )</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_railroad_diagrams"><a class="anchor" href="#_railroad_diagrams"></a><a class="link" href="#_railroad_diagrams">8.8.3.9. Railroad diagrams</a></h5>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AccumulateAction.png" alt="AccumulateAction">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AccumulateClause.png" alt="AccumulateClause">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AccumulateFunction.png" alt="AccumulateFunction">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AccumulateInit.png" alt="AccumulateInit">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AccumulateResult.png" alt="AccumulateResult">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AccumulateReverse.png" alt="AccumulateReverse">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AccumulateSteps.png" alt="AccumulateSteps">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Accumulations.png" alt="Accumulations">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AdditiveExpr.png" alt="AdditiveExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Annotation.png" alt="Annotation">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Arguments.png" alt="Arguments">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ArrayCreatorRest.png" alt="ArrayCreatorRest">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ArrayInitializer.png" alt="ArrayInitializer">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AssignmentOperator.png" alt="AssignmentOperator">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/BindingPattern.png" alt="BindingPattern">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Block.png" alt="Block">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/BooleanLiteral.png" alt="BooleanLiteral">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/CompilationUnit.png" alt="CompilationUnit">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ConditionalAnd.png" alt="ConditionalAnd">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ConditionalElementAccumulate.png" alt="ConditionalElementAccumulate">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ConditionalElementEval.png" alt="ConditionalElementEval">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ConditionalElementExists.png" alt="ConditionalElementExists">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ConditionalElementForall.png" alt="ConditionalElementForall">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ConditionalElementNot.png" alt="ConditionalElementNot">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ConditionalElement.png" alt="ConditionalElement">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ConditionalExpr.png" alt="ConditionalExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ConditionalOrExpr.png" alt="ConditionalOrExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ConditionalOr.png" alt="ConditionalOr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Constraints.png" alt="Constraints">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/CreatedName.png" alt="CreatedName">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Creator.png" alt="Creator">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Definition.png" alt="Definition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Digit.png" alt="Digit">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ExplicitGenericInvocationSuffix.png" alt="ExplicitGenericInvocationSuffix">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ExplicitGenericInvocation.png" alt="ExplicitGenericInvocation">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Exponent.png" alt="Exponent">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ExpressionList.png" alt="ExpressionList">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Expression.png" alt="Expression">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Field.png" alt="Field">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Fraction.png" alt="Fraction">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/FromAccumulateClause.png" alt="FromAccumulateClause">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/FromClause.png" alt="FromClause">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/FromCollectClause.png" alt="FromCollectClause">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/FunctionDefinition.png" alt="FunctionDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GlobalDefinition.png" alt="GlobalDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/IdentifierSuffix.png" alt="IdentifierSuffix">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ImportDefinition.png" alt="ImportDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/InExpr.png" alt="InExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/InlineListExpr.png" alt="InlineListExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/InlineMapExpr.png" alt="InlineMapExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/InnerCreator.png" alt="InnerCreator">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/InstanceOfExpr.png" alt="InstanceOfExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/IntLiteral.png" alt="IntLiteral">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Literal.png" alt="Literal">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ModifyStatement.png" alt="ModifyStatement">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NonWildcardTypeArguments.png" alt="NonWildcardTypeArguments">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/OrRestriction.png" alt="OrRestriction">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/OverClause.png" alt="OverClause">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Parameters.png" alt="Parameters">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Pattern.png" alt="Pattern">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Placeholders.png" alt="Placeholders">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Primary.png" alt="Primary">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/PrimitiveType.png" alt="PrimitiveType">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QualifiedName.png" alt="QualifiedName">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QueryDefinition.png" alt="QueryDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QueryOptions.png" alt="QueryOptions">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RealLiteral.png" alt="RealLiteral">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RealTypeSuffix.png" alt="RealTypeSuffix">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RelationalExpr.png" alt="RelationalExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RelationalOperator.png" alt="RelationalOperator">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RhsStatement.png" alt="RhsStatement">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RuleAttributes.png" alt="RuleAttributes">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RuleAttribute.png" alt="RuleAttribute">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RuleDefinition.png" alt="RuleDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RuleOptions.png" alt="RuleOptions">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Selector.png" alt="Selector">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ShiftExpr.png" alt="ShiftExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/SingleRestriction.png" alt="SingleRestriction">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/SourcePattern.png" alt="SourcePattern">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/StringId.png" alt="StringId">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/SuperSuffix.png" alt="SuperSuffix">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ThenPart.png" alt="ThenPart">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/TypeArguments.png" alt="TypeArguments">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/TypeArgument.png" alt="TypeArgument">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/TypeDefinition.png" alt="TypeDefinition">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/TypeOptions.png" alt="TypeOptions">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Type.png" alt="Type">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/UnaryExprNotPlusMinus.png" alt="UnaryExprNotPlusMinus">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/UnaryExpr.png" alt="UnaryExpr">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Value.png" alt="Value">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/VariableInitializer.png" alt="VariableInitializer">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/WhenPart.png" alt="WhenPart">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_right_hand_side_then"><a class="anchor" href="#_the_right_hand_side_then"></a><a class="link" href="#_the_right_hand_side_then">8.8.4. The Right Hand Side (then)</a></h4>
<div class="sect4">
<h5 id="_usage"><a class="anchor" href="#_usage"></a><a class="link" href="#_usage">8.8.4.1. Usage</a></h5>
<div class="paragraph">
<p>The Right Hand Side (RHS) is a common name for the consequence or action part of the rule; this part should contain a list of actions to be executed.
It is bad practice to use imperative or conditional code in the RHS of a rule; as a rule should be atomic in nature - "when this, then do this", not "when this, maybe do this". The RHS part of a rule should also be kept small, thus keeping it declarative and readable.
If you find you need imperative and/or conditional code in the RHS, then maybe you should be breaking that rule down into multiple rules.
The main purpose of the RHS is to insert, delete or modify working memory data.
To assist with that there are a few convenience methods you can use to modify working memory; without having to first reference a working memory instance.</p>
</div>
<div class="paragraph">
<p><code>update(</code><em>object,
      handle</em><code>);</code> will tell the engine that an object has changed (one that has been bound to something on the LHS) and rules may need to be reconsidered.</p>
</div>
<div class="paragraph">
<p><code>update(</code><em>object</em><code>);</code> can also be used; here the Knowledge Helper will look up the facthandle for you, via an identity check, for the passed object.
(Note that if you provide Property Change Listeners to your Java beans that you are inserting into the engine, you can avoid the need to call <code>update()</code> when the object changes.). After a fact’s field values have changed you must call update before changing another fact, or you will cause problems with the indexing within the rule engine.
The modify keyword avoids this problem.</p>
</div>
<div class="paragraph">
<p><code>insert(new</code><em>Something</em><code>());</code> will place a new object of your creation into the Working Memory.</p>
</div>
<div class="paragraph">
<p><code>insertLogical(new</code><em>Something</em><code>());</code> is similar to insert, but the object will be automatically deleted when there are no more facts to support the truth of the currently firing rule.</p>
</div>
<div class="paragraph">
<p><code>delete(</code><em>handle</em><code>);</code> removes an object from Working Memory.</p>
</div>
<div class="paragraph">
<p>These convenience methods are basically macros that provide short cuts to the <code>KnowledgeHelper</code> instance that lets you access your Working Memory from rules files.
The predefined variable <code>drools</code> of type <code>KnowledgeHelper</code> lets you call several other useful methods.
(Refer to the <code>KnowledgeHelper</code> interface documentation for more advanced operations).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The call <code>drools.halt()</code> terminates rule execution immediately. This is required for returning control to the point whence the current session was put to work with <code>fireUntilHalt()</code>.</p>
</li>
<li>
<p>Methods <code>insert(Object o)</code>, <code>update(Object o)</code> and <code>delete(Object o)</code> can be called on <code>drools</code> as well, but due to their frequent use they can be called without the object reference.</p>
</li>
<li>
<p><code>drools.getWorkingMemory()</code> returns the <code>WorkingMemory</code> object.</p>
</li>
<li>
<p><code>drools.setFocus( String s)</code> sets the focus to the specified agenda group.</p>
</li>
<li>
<p><code>drools.getRule().getName()</code>, called from a rule’s RHS, returns the name of the rule.</p>
</li>
<li>
<p><code>drools.getTuple()</code> returns the Tuple that matches the currently executing rule, and <code>drools.getActivation()</code> delivers the corresponding Activation. (These calls are useful for logging and debugging purposes.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The full Knowledge Runtime API is exposed through another predefined variable, <code>kcontext</code>, of type <code>KieContext</code>.
Its method <code>getKieRuntime()</code> delivers an object of type <code>KieRuntime</code>, which, in turn, provides access to a wealth of methods, many of which are quite useful for coding RHS logic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The call <code>kcontext.getKieRuntime().halt()</code> terminates rule execution immediately.</p>
</li>
<li>
<p>The accessor <code>getAgenda()</code> returns a reference to this session’s <code>Agenda</code>, which in turn provides access to the various rule groups: activation groups, agenda groups, and rule flow groups. A fairly common paradigm is the activation of some agenda group, which could be done with the lengthy call:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// give focus to the agenda group CleanUp</span>
kcontext.getKieRuntime().getAgenda().getAgendaGroup( <span class="hljs-string">"CleanUp"</span> ).setFocus();</code></pre>
</div>
</div>
<div class="paragraph">
<p>(You can achieve the same using <code>drools.setFocus(
"CleanUp" )</code>.)</p>
</div>
</li>
<li>
<p>To run a query, you call <code>getQueryResults(String query)</code>, whereupon you may process the results, as explained in section <a href="#_querysection">Query</a>. Using <code>kcontext.getKieRuntime().getQueryResults()</code> or using <code>drools.getKieRuntime().getQueryResults()</code> is the proper method of running a query from a rule’s RHS, and the only supported way.</p>
</li>
<li>
<p>A set of methods dealing with event management lets you, among other things, add and remove event listeners for the Working Memory and the Agenda.</p>
</li>
<li>
<p>Method <code>getKieBase()</code> returns the <code>KieBase</code> object, the backbone of all the Knowledge in your system, and the originator of the current session.</p>
</li>
<li>
<p>You can manage globals with <code>setGlobal(…​)</code>, <code>getGlobal(…​)</code> and <code>getGlobals()</code>.</p>
</li>
<li>
<p>Method <code>getEnvironment()</code> returns the runtime’s <code>Environment</code> which works much like what you know as your operating system’s environment.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_the_code_modify_code_statement"><a class="anchor" href="#_the_code_modify_code_statement"></a><a class="link" href="#_the_code_modify_code_statement">8.8.4.2. The <code>modify</code> Statement</a></h5>
<div class="paragraph">
<p>This language extension provides a structured approach to fact updates.
It combines the update operation with a number of setter calls to change the object’s fields.
This is the syntax schema for the <code>modify</code> statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml">modify ( <span class="hljs-tag">&lt;<span class="hljs-title">fact-expression</span>&gt;</span> ) {
    <span class="hljs-tag">&lt;<span class="hljs-title">expression</span>&gt;</span> [ , <span class="hljs-tag">&lt;<span class="hljs-title">expression</span>&gt;</span> ]*
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parenthesized <em>&lt;fact-expression&gt;</em> must yield a fact object reference.
The expression list in the block should consist of setter calls for the given object, to be written without the usual object reference, which is automatically prepended by the compiler.</p>
</div>
<div class="paragraph">
<p>The example illustrates a simple fact modification.</p>
</div>
<div class="exampleblock">
<div class="title">Example 165. A modify statement</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"modify stilton"</span>
when
    <span class="hljs-variable">$stilton</span> : Cheese(<span class="hljs-built_in">type</span> == <span class="hljs-string">"stilton"</span>)
<span class="hljs-keyword">then</span>
    modify( <span class="hljs-variable">$stilton</span> ){
        <span class="hljs-built_in">set</span>Price( <span class="hljs-number">20</span> ),
        <span class="hljs-built_in">set</span>Age( <span class="hljs-string">"overripe"</span> )
    }
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The advantages in using the modify statment are particularly clear when used in conjuction with fine grained property change listeners.
See the corresponding section for more details.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_conditional_named_consequences"><a class="anchor" href="#_conditional_named_consequences"></a><a class="link" href="#_conditional_named_consequences">8.8.5. Conditional named consequences</a></h4>
<div class="paragraph">
<p>Sometimes the constraint of having one single consequence for each rule can be somewhat limiting and leads to verbose and difficult to be maintained repetitions like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Give 10% discount to customers older than 60"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$customer</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Customer</span>( age &gt; <span class="hljs-number">60</span> )
<span class="hljs-keyword">then</span>
    modify(<span class="hljs-variable">$customer</span>) { setDiscount( <span class="hljs-number">0</span>.<span class="hljs-number">1</span> ) };
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Give free parking to customers older than 60"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$customer</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Customer</span>( age &gt; <span class="hljs-number">60</span> )
    <span class="hljs-variable">$car</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Car</span> ( owner == <span class="hljs-variable">$customer</span> )
<span class="hljs-keyword">then</span>
    modify(<span class="hljs-variable">$car</span>) { setFreeParking( <span class="hljs-keyword">true</span> ) };
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is already possible to partially overcome this problem by making the second rule extending the first one like in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Give 10% discount to customers older than 60"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$customer</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Customer</span>( age &gt; <span class="hljs-number">60</span> )
<span class="hljs-keyword">then</span>
    modify(<span class="hljs-variable">$customer</span>) { setDiscount( <span class="hljs-number">0</span>.<span class="hljs-number">1</span> ) };
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Give free parking to customers older than 60"</span>
    extends <span class="hljs-string">"Give 10% discount to customers older than 60"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$car</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Car</span> ( owner == <span class="hljs-variable">$customer</span> )
<span class="hljs-keyword">then</span>
    modify(<span class="hljs-variable">$car</span>) { setFreeParking( <span class="hljs-keyword">true</span> ) };
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Anyway this feature makes it possible to define more labelled consequences other than the default one in a single rule, so, for example, the 2 former rules can be compacted in only one like it follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"Give 10% discount and free parking to customers older than 60"</span>
when
    <span class="hljs-variable">$customer</span> : Customer( age &gt; <span class="hljs-number">60</span> )
    <span class="hljs-keyword">do</span>[giveDiscount]
    <span class="hljs-variable">$car</span> : Car ( owner == <span class="hljs-variable">$customer</span> )
<span class="hljs-keyword">then</span>
    modify(<span class="hljs-variable">$car</span>) { <span class="hljs-built_in">set</span>FreeParking( <span class="hljs-literal">true</span> ) };
<span class="hljs-keyword">then</span>[giveDiscount]
    modify(<span class="hljs-variable">$customer</span>) { <span class="hljs-built_in">set</span>Discount( <span class="hljs-number">0.1</span> ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This last rule has 2 consequences, the usual default one, plus another one named "giveDiscount" that is activated, using the keyword do, as soon as a customer older than 60 is found in the knowledge base, regardless of the fact that he owns a car or not.
The activation of a named consequence can be also guarded by an additional condition like in this further example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"Give free parking to customers older than 60 and 10% discount to golden ones among them"</span>
when
    <span class="hljs-variable">$customer</span> : Customer( age &gt; <span class="hljs-number">60</span> )
    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">type</span> == <span class="hljs-string">"Golden"</span> ) <span class="hljs-keyword">do</span>[giveDiscount]
    <span class="hljs-variable">$car</span> : Car ( owner == <span class="hljs-variable">$customer</span> )
<span class="hljs-keyword">then</span>
    modify(<span class="hljs-variable">$car</span>) { <span class="hljs-built_in">set</span>FreeParking( <span class="hljs-literal">true</span> ) };
<span class="hljs-keyword">then</span>[giveDiscount]
    modify(<span class="hljs-variable">$customer</span>) { <span class="hljs-built_in">set</span>Discount( <span class="hljs-number">0.1</span> ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The condition in the if statement is always evaluated on the pattern immediately preceding it.
In the end this last, a bit more complicated, example shows how it is possible to switch over different conditions using a nested if/else statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"Give free parking and 10% discount to over 60 Golden customer and 5% to Silver ones"</span>
when
    <span class="hljs-variable">$customer</span> : Customer( age &gt; <span class="hljs-number">60</span> )
    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">type</span> == <span class="hljs-string">"Golden"</span> ) <span class="hljs-keyword">do</span>[giveDiscount10]
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">type</span> == <span class="hljs-string">"Silver"</span> ) <span class="hljs-built_in">break</span>[giveDiscount5]
    <span class="hljs-variable">$car</span> : Car ( owner == <span class="hljs-variable">$customer</span> )
<span class="hljs-keyword">then</span>
    modify(<span class="hljs-variable">$car</span>) { <span class="hljs-built_in">set</span>FreeParking( <span class="hljs-literal">true</span> ) };
<span class="hljs-keyword">then</span>[giveDiscount10]
    modify(<span class="hljs-variable">$customer</span>) { <span class="hljs-built_in">set</span>Discount( <span class="hljs-number">0.1</span> ) };
<span class="hljs-keyword">then</span>[giveDiscount5]
    modify(<span class="hljs-variable">$customer</span>) { <span class="hljs-built_in">set</span>Discount( <span class="hljs-number">0.05</span> ) };
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the purpose is to give a 10% discount AND a free parking to Golden customers over 60, but only a 5% discount (without free parking) to the Silver ones.
This result is achieved by activating the consequence named "giveDiscount5" using the keyword break instead of do.
In fact do just schedules a consequence in the agenda, allowing the remaining part of the LHS to continue of being evaluated as per normal, while break also blocks any further pattern matching evaluation.
Note, of course, that the activation of a named consequence not guarded by any condition with break doesn’t make sense (and generates a compile time error) since otherwise the LHS part following it would be never reachable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_note_on_auto_boxing_and_primitive_types"><a class="anchor" href="#_a_note_on_auto_boxing_and_primitive_types"></a><a class="link" href="#_a_note_on_auto_boxing_and_primitive_types">8.8.6. A Note on Auto-boxing and Primitive Types</a></h4>
<div class="paragraph">
<p>Drools attempts to preserve numbers in their primitive or object wrapper form, so a variable bound to an int primitive when used in a code block or expression will no longer need manual unboxing; unlike Drools 3.0 where all primitives were autoboxed, requiring manual unboxing.
A variable bound to an object wrapper will remain as an object; the existing JDK 1.5 and JDK 5 rules to handle auto-boxing and unboxing apply in this case.
When evaluating field constraints, the system attempts to coerce one of the values into a comparable format; so a primitive is comparable to an object wrapper.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_querysection"><a class="anchor" href="#_querysection"></a><a class="link" href="#_querysection">8.9. Query</a></h3>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/query.png" alt="query">
</div>
<div class="title">Figure 200. query</div>
</div>
<div class="paragraph">
<p>A query is a simple way to search the working memory for facts that match the stated conditions.
Therefore, it contains only the structure of the LHS of a rule, so that you specify neither "when" nor "then". A query has an optional set of parameters, each of which can be optionally typed.
If the type is not given, the type Object is assumed.
The engine will attempt to coerce the values as needed.
Query names are global to the KieBase; so do not add queries of the same name to different packages for the same RuleBase.</p>
</div>
<div class="paragraph">
<p>To return the results use <code>ksession.getQueryResults("name")</code>, where "name" is the query’s name.
This returns a list of query results, which allow you to retrieve the objects that matched the query.</p>
</div>
<div class="paragraph">
<p>The first example presents a simple query for all the people over the age of 30.
The second one, using parameters, combines the age limit with a location.</p>
</div>
<div class="exampleblock">
<div class="title">Example 166. Query People over the age of 30</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">query <span class="hljs-string">"people over the age of 30"</span>
    person : Person( age &gt; <span class="hljs-number">30</span> )
end</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 167. Query People over the age of x, and who live in y</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">query <span class="hljs-string">"people over the age of x"</span>  (<span class="hljs-keyword">int</span> x, String y)
    person : Person( age &gt; x, location == y )
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We iterate over the returned QueryResults using a standard "for" loop.
Each element is a QueryResultsRow which we can use to access each of the columns in the tuple.
These columns can be accessed by bound declaration name or index position.</p>
</div>
<div class="exampleblock">
<div class="title">Example 168. Query People over the age of 30</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">QueryResults results = ksession.getQueryResults( <span class="hljs-string">"people over the age of 30"</span> );
System.out.println( <span class="hljs-string">"we have "</span> + results.size() + <span class="hljs-string">" people over the age  of 30"</span> );

System.out.println( <span class="hljs-string">"These people are are over 30:"</span> );

<span class="hljs-keyword">for</span> ( QueryResultsRow row : results ) {
    Person person = ( Person ) row.get( <span class="hljs-string">"person"</span> );
    System.out.println( person.getName() + <span class="hljs-string">"\n"</span> );
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Support for positional syntax has been added for more compact code.
By default the declared type order in the type declaration matches the argument position.
But it possible to override these using the @position annotation.
This allows patterns to be used with positional arguments, instead of the more verbose named arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Cheese
    <span class="hljs-keyword">name</span> : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">position</span>(<span class="hljs-number">1</span>)
    shop : <span class="hljs-keyword">String</span> @<span class="hljs-keyword">position</span>(<span class="hljs-number">2</span>)
    price : <span class="hljs-built_in">int</span> @<span class="hljs-keyword">position</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The @Position annotation, in the org.drools.definition.type package, can be used to annotate original pojos on the classpath.
Currently only fields on classes can be annotated.
Inheritance of classes is supported, but not interfaces or methods.
The isContainedIn query below demonstrates the use of positional arguments in a pattern; <code>Location(x, y;)</code> instead of <code>Location( thing == x, location == y).</code></p>
</div>
<div class="paragraph">
<p>Queries can now call other queries, this combined with optional query arguments provides derivation query style backward chaining.
Positional and named syntax is supported for arguments.
It is also possible to mix both positional and named, but positional must come first, separated by a semi colon.
Literal expressions can be passed as query arguments, but at this stage you cannot mix expressions with variables.
Here is an example of a query that calls another query.
Note that 'z' here will always be an 'out' variable.
The '?' symbol means the query is pull only, once the results are returned you will not receive further results as the underlying data changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Location
    thing : <span class="hljs-keyword">String</span>
    location : <span class="hljs-keyword">String</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">query</span> isContainedIn( <span class="hljs-keyword">String</span> x, <span class="hljs-keyword">String</span> y )
    Location(x, y;</span>)
    or
    ( Location(z, y;) and ?isContainedIn(x, z;) )
<span class="hljs-operator"><span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As previously mentioned you can use live "open" queries to reactively receive changes over time from the query results, as the underlying data it queries against changes.
Notice the "look" rule calls the query without using '?'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">query isContainedIn( <span class="hljs-constant">String</span> x, <span class="hljs-constant">String</span> y )
    <span class="hljs-constant">Location</span>(x, y;)
    <span class="hljs-keyword">or</span>
    ( <span class="hljs-constant">Location</span>(z, y;) <span class="hljs-keyword">and</span> isContainedIn(x, z;) )
<span class="hljs-keyword">end</span>

rule look <span class="hljs-keyword">when</span>
    <span class="hljs-constant">Person</span>( <span class="hljs-variable">$l</span> <span class="hljs-symbol">:</span> likes )
    isContainedIn( <span class="hljs-variable">$l</span>, <span class="hljs-string">'office'</span>; )
<span class="hljs-keyword">then</span>
   insertLogical( <span class="hljs-variable">$l</span> <span class="hljs-string">'is in the office'</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools supports unification for derivation queries, in short this means that arguments are optional.
It is possible to call queries from Java leaving arguments unspecified using the static field org.drools.core.runtime.rule.Variable.v - note you must use 'v' and not an alternative instance of Variable.
These are referred to as 'out' arguments.
Note that the query itself does not declare at compile time whether an argument is in or an out, this can be defined purely at runtime on each use.
The following example will return all objects contained in the office.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs javascript">results = ksession.getQueryResults( <span class="hljs-string">"isContainedIn"</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>[] {  Variable.v, <span class="hljs-string">"office"</span> } );
l = <span class="hljs-keyword">new</span> ArrayList&lt;List&lt;<span class="hljs-built_in">String</span>&gt;&gt;();
<span class="hljs-keyword">for</span> ( QueryResultsRow r : results ) {
    l.add( Arrays.asList( <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>[] { (<span class="hljs-built_in">String</span>) r.get( <span class="hljs-string">"x"</span> ), (<span class="hljs-built_in">String</span>) r.get( <span class="hljs-string">"y"</span> ) } ) );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The algorithm uses stacks to handle recursion, so the method stack will not blow up.</p>
</div>
<div class="paragraph">
<p>It is also possible to use as input argument for a query both the field of a fact as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">query contains(<span class="hljs-constant">String</span> <span class="hljs-variable">$s</span>, <span class="hljs-constant">String</span> <span class="hljs-variable">$c</span>)
    <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span>= <span class="hljs-constant">String</span>( this.contains( <span class="hljs-variable">$c</span> ) )
<span class="hljs-keyword">end</span>

rule <span class="hljs-constant">PersonNamesWithA</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>()
    contains( <span class="hljs-variable">$p</span>.name, <span class="hljs-string">"a"</span>; )
<span class="hljs-keyword">then</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and more in general any kind of valid expression like in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">query checkLength(<span class="hljs-constant">String</span> <span class="hljs-variable">$s</span>, int <span class="hljs-variable">$l</span>)
    <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span>= <span class="hljs-constant">String</span>( length == <span class="hljs-variable">$l</span> )
<span class="hljs-keyword">end</span>

rule <span class="hljs-constant">CheckPersonNameLength</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$i</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Integer</span>()
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>()
    checkLength( <span class="hljs-variable">$p</span>.name, <span class="hljs-number">1</span> + <span class="hljs-variable">$i</span> + <span class="hljs-variable">$p</span>.age; )
<span class="hljs-keyword">then</span>
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is not yet supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List and Map unification</p>
</li>
<li>
<p>Expression unification - pred( X, X + 1, X * Y / 7 )</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_domain_specific_languages"><a class="anchor" href="#_domain_specific_languages"></a><a class="link" href="#_domain_specific_languages">8.10. Domain Specific Languages</a></h3>
<div class="paragraph">
<p>
Domain Specific Languages (or DSLs) are a way of creating a rule language that is dedicated to your problem domain.
A set of DSL definitions consists of transformations from DSL "sentences" to DRL constructs, which lets you use of all the underlying rule language and engine features.
Given a DSL, you write rules in DSL rule (or DSLR) files, which will be translated into DRL files.</p>
</div>
<div class="paragraph">
<p>DSL and DSLR files are plain text files, and you can use any text editor to create and modify them.
But there are also DSL and DSLR editors, both in the IDE as well as in the web based BRMS, and you can use those as well, although they may not provide you with the full DSL functionality.</p>
</div>
<div class="sect3">
<h4 id="_when_to_use_a_dsl"><a class="anchor" href="#_when_to_use_a_dsl"></a><a class="link" href="#_when_to_use_a_dsl">8.10.1. When to Use a DSL</a></h4>
<div class="paragraph">
<p>DSLs can serve as a layer of separation between rule authoring (and rule authors) and the technical intricacies resulting from the modelling of domain object and the rule engine’s native language and methods.
If your rules need to be read and validated by domain experts (such as business analysts, for instance) who are not programmers, you should consider  using a DSL; it hides implementation details and focuses on the rule logic proper.
DSL sentences can also act as "templates" for conditional elements and consequence actions that are used repeatedly in your rules, possibly with minor variations.
You may define DSL sentences as being mapped to these repeated phrases, with parameters providing a means for accommodating those variations.</p>
</div>
<div class="paragraph">
<p>DSLs have no impact on the rule engine at runtime, they are just a compile time feature, requiring a special parser and transformer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dsl_basics"><a class="anchor" href="#_dsl_basics"></a><a class="link" href="#_dsl_basics">8.10.2. DSL Basics</a></h4>
<div class="paragraph">
<p>The Drools DSL mechanism allows you to customise conditional expressions and consequence actions.
A global substitution mechanism ("keyword") is also available.</p>
</div>
<div class="exampleblock">
<div class="title">Example 169. Example  DSL mapping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">[<span class="hljs-keyword">when</span>]Something <span class="hljs-keyword">is</span> {colour}=Something(colour==<span class="hljs-string">"{colour}"</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, <code>[when]</code> indicates the scope of the expression, i.e., whether it is valid for the LHS or the RHS of a rule.
The part after the bracketed keyword is the expression that you use in the rule; typically a natural language expression, but it doesn’t have to be.
The part to the right of the equal sign ("=") is the mapping of the expression into the rule language.
The form of this string depends on its destination, RHS or  LHS.
If it is for the LHS, then it ought to be a term according to the regular LHS syntax; if it is for the RHS then it might be a Java statement.</p>
</div>
<div class="paragraph">
<p>Whenever the DSL parser matches a line from the rule file written in the DSL with an expression in the DSL definition, it performs three steps of string manipulation.
First, it extracts the string values appearing where the expression contains variable names in braces (here: <code>{colour}</code>). Then, the values obtained from these captures are then interpolated wherever that name, again enclosed in braces, occurs on the right hand side of the mapping.
Finally, the interpolated string replaces whatever was matched by the entire expression in the line of the DSL rule file.</p>
</div>
<div class="paragraph">
<p>Note that the expressions (i.e., the strings on the left hand side of the equal sign) are used as regular expressions in a pattern matching operation against a line of the DSL rule file, matching all or part of a line.
This means you can use (for instance) a '?' to indicate that the preceding character is optional.
One good reason to use this is to overcome variations in natural language phrases of your DSL.
But, given that these expressions are regular expression patterns, this also means that all "magic" characters of Java’s pattern syntax have to be escaped with a preceding backslash ('\').</p>
</div>
<div class="paragraph">
<p>It is important to note that the compiler transforms DSL rule files line by line.
In the above example, all the text after "Something is " to the end of the line is captured as the replacement value for "{colour}", and this is used for interpolating the target string.
This may not be exactly what you want.
For instance, when you intend to merge different DSL expressions to generate a composite DRL pattern, you need to transform a DSLR line in several independent operations.
The best way to achieve this is to ensure that the captures are surrounded by characteristic text - words or  even single characters.
As a result, the matching operation done by the parser plucks out a substring from  somewhere within the line.
In the example below, quotes are used as  distinctive characters.
Note that the characters that surround the capture are not included during interpolation, just the contents between them.</p>
</div>
<div class="paragraph">
<p>As a rule of thumb, use quotes for textual data that a rule editor may want to enter.
You can also enclose the capture with words to ensure that the text is correctly matched.
Both is illustrated by the following example.
Note that a single line such as <code>Something is "green" and
    another solid thing</code> is now correctly expanded.</p>
</div>
<div class="exampleblock">
<div class="title">Example 170. Example with quotes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">[<span class="hljs-keyword">when</span>]something <span class="hljs-keyword">is</span> <span class="hljs-string">"{colour}"</span>=Something(colour==<span class="hljs-string">"{colour}"</span>)
[<span class="hljs-keyword">when</span>]another {state} thing=OtherThing(state==<span class="hljs-string">"{state})"</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is a good idea to avoid punctuation (other than quotes or apostrophes) in your DSL expressions as much as possible.
The main reason is that punctuation is easy to forget for rule authors using your DSL.
Another reason is that parentheses, the period and the question mark are magic characters, requiring escaping in the DSL definition.</p>
</div>
<div class="paragraph">
<p>In a DSL mapping, the braces "{" and "}" should only be used to enclose a variable definition or reference, resulting in a capture.
If they should occur literally, either in the expression or within the replacement text on the right hand side, they must be escaped with a preceding backslash ("\"):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">[<span class="hljs-keyword">then</span>]<span class="hljs-keyword">do</span> something= <span class="hljs-keyword">if</span> (foo) \{ <span class="hljs-keyword">do</span>Something(); \}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If braces "{" and "}" should appear in the replacement string of a DSL definition, escape them with a backslash ('\').</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="exampleblock">
<div class="title">Example 171. Examples of DSL mapping entries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-comment"># This is a comment to be ignored.</span>
[<span class="hljs-keyword">when</span>]There <span class="hljs-keyword">is</span> a person with name <span class="hljs-keyword">of</span> <span class="hljs-string">"{name}"</span>=Person(name==<span class="hljs-string">"{name}"</span>)
[<span class="hljs-keyword">when</span>]Person <span class="hljs-keyword">is</span> at least {age} years old <span class="hljs-keyword">and</span> lives <span class="hljs-keyword">in</span> <span class="hljs-string">"{location}"</span>=
      Person(age &gt;= {age}, location==<span class="hljs-string">"{location}"</span>)
[<span class="hljs-keyword">then</span>]Log <span class="hljs-string">"{message}"</span>=System.out.println(<span class="hljs-string">"{message}"</span>);
[<span class="hljs-keyword">when</span>]And = <span class="hljs-keyword">and</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Given the above DSL examples, the following examples show the expansion of various DSLR snippets:</p>
</div>
<div class="exampleblock">
<div class="title">Example 172. Examples of DSL expansions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">There <span class="hljs-keyword">is</span> a person with name <span class="hljs-keyword">of</span> <span class="hljs-string">"Kitty"</span>
   =<span class="hljs-function">=&gt;</span> Person(name=<span class="hljs-string">"Kitty"</span>)
Person <span class="hljs-keyword">is</span> at least <span class="hljs-number">42</span> years old <span class="hljs-keyword">and</span> lives <span class="hljs-keyword">in</span> <span class="hljs-string">"Atlanta"</span>
   =<span class="hljs-function">=&gt;</span> Person(age &gt;= <span class="hljs-number">42</span>, location=<span class="hljs-string">"Atlanta"</span>)
Log <span class="hljs-string">"boo"</span>
   =<span class="hljs-function">=&gt;</span> System.out.println(<span class="hljs-string">"boo"</span>);
There <span class="hljs-keyword">is</span> a person with name <span class="hljs-keyword">of</span> <span class="hljs-string">"Bob"</span> And Person <span class="hljs-keyword">is</span> at least <span class="hljs-number">30</span> years old <span class="hljs-keyword">and</span> lives <span class="hljs-keyword">in</span> <span class="hljs-string">"Utah"</span>
   =<span class="hljs-function">=&gt;</span> Person(name=<span class="hljs-string">"Bob"</span>) <span class="hljs-keyword">and</span> Person(age &gt;= <span class="hljs-number">30</span>, location=<span class="hljs-string">"Utah"</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Don’t forget that if you are capturing plain text from a DSL rule line and want to use it as a string literal in the expansion, you must provide the quotes on the right hand side of the mapping.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can chain DSL expressions together on one line, as long as it is clear to the parser where one ends and the next one begins and where the text representing a parameter ends.
(Otherwise you risk getting all the text until the end of the line as a parameter value.) The DSL expressions are tried, one after the other, according to their order in the DSL definition file.
After any match, all remaining DSL expressions are investigated, too.</p>
</div>
<div class="paragraph">
<p>The resulting DRL text may consist of more than one line.
Line ends are in the replacement text are written as <code>\n</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_constraints_to_facts"><a class="anchor" href="#_adding_constraints_to_facts"></a><a class="link" href="#_adding_constraints_to_facts">8.10.3. Adding Constraints to Facts</a></h4>
<div class="paragraph">
<p>A common requirement when writing rule conditions is to be able to add an arbitrary combination of constraints to a pattern.
Given that a fact type may have many fields, having to provide an individual DSL statement for each combination would be plain folly.</p>
</div>
<div class="paragraph">
<p>The DSL facility allows you to add constraints to a pattern by a simple convention: if your DSL expression starts with a hyphen (minus character, "-") it is assumed to be a field constraint and, consequently, is is added to the last pattern line preceding it.</p>
</div>
<div class="paragraph">
<p>For an example, lets take look at class <code>Cheese</code>, with the following fields: type, price, age and country.
We can express some LHS condition in normal DRL like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Cheese(age &lt; <span class="hljs-number">5</span>, price == <span class="hljs-number">20</span>, type==<span class="hljs-string">"stilton"</span>, country==<span class="hljs-string">"ch"</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The DSL definitions given below result in three DSL phrases which may be used to create any combination of constraint involving these fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">[<span class="hljs-keyword">when</span>]There <span class="hljs-keyword">is</span> a Cheese with=Cheese()
[<span class="hljs-keyword">when</span>]- age <span class="hljs-keyword">is</span> less than {age}=age&lt;{age}
[<span class="hljs-keyword">when</span>]- type <span class="hljs-keyword">is</span> <span class="hljs-string">'{type}'</span>=type==<span class="hljs-string">'{type}'</span>
[<span class="hljs-keyword">when</span>]- country equal to <span class="hljs-string">'{country}'</span>=country==<span class="hljs-string">'{country}'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then write rules with conditions like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs python">There <span class="hljs-keyword">is</span> a Cheese <span class="hljs-keyword">with</span>
        - age <span class="hljs-keyword">is</span> less than <span class="hljs-number">42</span>
        - type <span class="hljs-keyword">is</span> <span class="hljs-string">'stilton'</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> The parser will pick up a line beginning with "-" and add it as a constraint to  the preceding pattern, inserting a comma when it is required.
For the preceding example, the resulting DRL is:</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Cheese(age&lt;<span class="hljs-number">42</span>, <span class="hljs-built_in">type</span>==<span class="hljs-string">'stilton'</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Combining all numeric fields with all relational operators (according to the DSL expression "age is less than…​" in the preceding example) produces an unwieldy amount of DSL entries.
But you can define DSL phrases for the various operators and even a generic expression that handles any field constraint, as shown below.
(Notice that the expression definition contains a regular expression in addition to the variable name.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs markdown">[<span class="hljs-link_label">when</span>][<span class="hljs-link_reference"></span>]is less than or equal to=<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">=</span>
[<span class="hljs-attribute">when</span>][]<span class="hljs-attribute">is</span> <span class="hljs-attribute">less</span> <span class="hljs-attribute">than</span>=<span class="hljs-value">&lt;</span>
[<span class="hljs-attribute">when</span>][]<span class="hljs-attribute">is</span> <span class="hljs-attribute">greater</span> <span class="hljs-attribute">than</span> <span class="hljs-attribute">or</span> <span class="hljs-attribute">equal</span> <span class="hljs-attribute">to</span>=&gt;</span></span>=
[<span class="hljs-link_label">when</span>][<span class="hljs-link_reference"></span>]is greater than=&gt;
[<span class="hljs-link_label">when</span>][<span class="hljs-link_reference"></span>]is equal to===
[<span class="hljs-link_label">when</span>][<span class="hljs-link_reference"></span>]equals===
[<span class="hljs-link_label">when</span>][<span class="hljs-link_reference"></span>]There is a Cheese with=Cheese()
[<span class="hljs-link_label">when</span>][<span class="hljs-link_reference"></span>]- {field:\w<span class="hljs-emphasis">*} {operator} {value:\d*</span>}={field} {operator} {value}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given these DSL definitions, you can write rules with conditions such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs python">There <span class="hljs-keyword">is</span> a Cheese <span class="hljs-keyword">with</span>
   - age <span class="hljs-keyword">is</span> less than <span class="hljs-number">42</span>
   - rating <span class="hljs-keyword">is</span> greater than <span class="hljs-number">50</span>
   - type equals <span class="hljs-string">'stilton'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this specific case, a phrase such as "is less than" is replaced by <code>&lt;</code>, and then the line matches the last DSL entry.
This removes the hyphen, but the final result is still added as a constraint to the preceding pattern.
After processing all of the lines, the resulting DRL text is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Cheese(age&lt;<span class="hljs-number">42</span>, rating &gt; <span class="hljs-number">50</span>, <span class="hljs-built_in">type</span>==<span class="hljs-string">'stilton'</span>)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The order of the entries in the DSL is important if separate DSL expressions are intended to match the same line, one after the other.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_developing_a_dsl"><a class="anchor" href="#_developing_a_dsl"></a><a class="link" href="#_developing_a_dsl">8.10.4. Developing a DSL</a></h4>
<div class="paragraph">
<p>A good way to get started is to write representative samples of the rules your application requires, and to test them as you develop.
This will provide you with a stable framework of conditional elements and their constraints.
Rules, both in DRL and in DSLR, refer to entities according to the data model representing the application data that should be subject to the reasoning process defined in rules.
Notice that writing rules is generally easier if most of the data model’s types are facts.</p>
</div>
<div class="paragraph">
<p>Given an initial set of rules, it should be possible to identify recurring or similar code snippets and to mark variable parts as parameters.
This provides reliable leads as to what might be a handy DSL entry.
Also, make sure you have a full grasp of the jargon the  domain experts are using, and base your DSL phrases on this vocabulary.</p>
</div>
<div class="paragraph">
<p>You may postpone implementation decisions concerning conditions and actions during this first design phase by leaving certain conditional elements and actions in their DRL form by prefixing a line with a greater sign ("&gt;"). (This is also handy for inserting debugging statements.)</p>
</div>
<div class="paragraph">
<p>During the next development phase, you should find that the DSL configuration stabilizes pretty quickly.
New rules can be written by reusing the existing DSL definitions, or by adding a parameter to an existing condition or consequence entry.</p>
</div>
<div class="paragraph">
<p>Try to keep the number of DSL entries small.
Using parameters lets you apply the same DSL sentence for similar rule patterns or constraints.
But do not exaggerate: authors using the DSL should still be able to identify DSL phrases by some fixed text.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dsl_and_dslr_reference"><a class="anchor" href="#_dsl_and_dslr_reference"></a><a class="link" href="#_dsl_and_dslr_reference">8.10.5. DSL and DSLR Reference</a></h4>
<div class="paragraph">
<p>A DSL file is a text file in a line-oriented format.
Its entries are used for transforming a DSLR file into a file according to DRL syntax.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A line starting with "<mark>" or "//" (with or without preceding white space) is treated as a comment. A comment line starting with "</mark>/" is scanned for words requesting a debug option, see below.</p>
</li>
<li>
<p>Any line starting with an opening bracket ("[") is assumed to be the first line of a DSL entry definition.</p>
</li>
<li>
<p>Any other line is appended to the preceding DSL entry definition, with the line end replaced by a space.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A DSL entry consists of the following four parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A scope definition, written as one of the keywords "when" or "condition", "then" or "consequence", "*" and "keyword", enclosed in brackets ("[" and "]"). This indicates whether the DSL entry is valid for the condition or the consequence of a rule, or both. A scope indication of "keyword" means that the entry has global significance, i.e., it is recognized anywhere in a DSLR file.</p>
</li>
<li>
<p>A type definition, written as a Java class name, enclosed in brackets. This part is optional unless the the next part begins with an opening bracket. An empty pair of brackets is valid, too.</p>
</li>
<li>
<p>A DSL expression consists of a (Java) regular expression, with any number of embedded <em>variable definitions,</em> terminated by an equal sign ("="). A variable definition is enclosed in braces ("{" and "}"). It consists of a variable name and two optional attachments, separated by colons (":"). If there is one attachment, it is a regular expression for matching text that is to be assigned to the variable; if there are two attachments, the first one is a hint for the GUI editor and the second one the regular expression.</p>
<div class="paragraph">
<p>Note that all characters that are "magic" in regular expressions must be escaped with a preceding backslash ("\") if they should occur literally within the expression.</p>
</div>
</li>
<li>
<p>The remaining part of the line after the delimiting equal sign is the replacement text for any DSLR text matching the regular expression. It may contain variable references, i.e., a variable name enclosed in braces. Optionally, the variable name may be followed by an exclamation mark ("!") and a transformation function, see below.</p>
<div class="paragraph">
<p>Note that braces ("{" and "}") must be escaped with a preceding backslash ("\") if they should occur literally within the replacement string.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debugging of DSL expansion can be turned on, selectively, by using a comment line starting with "#/" which may contain one or more words from the table presented below.
The resulting output is written to standard output.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. Debug options for DSL expansion</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Word</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the resulting DRL text, with line numbers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">steps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints each expansion step of condition and consequence
            lines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dumps the internal representation of all DSL entries with
            scope "keyword".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">when</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dumps the internal representation of all DSL entries with
            scope "when" or "*".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">then</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dumps the internal representation of all DSL entries with
            scope "then" or "*".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a usage statistic of all DSL entries.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Below are some sample DSL definitions, with comments describing the language features they illustrate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs markdown"><span class="hljs-header"># Comment: DSL examples</span>

<span class="hljs-header">#/ debug: display result and usage</span>

<span class="hljs-header"># keyword definition: replaces "regula" by "rule"</span>
[<span class="hljs-link_label">keyword</span>][<span class="hljs-link_reference"></span>]regula=rule

<span class="hljs-header"># conditional element: "T" or "t", "a" or "an", convert matched word</span>
[<span class="hljs-link_label">when</span>][<span class="hljs-link_reference"></span>][<span class="hljs-link_label">Tt</span>]here is an? {entity:\w+}=
<span class="hljs-code">        ${entity!lc}: {entity!ucfirst} ()</span>

<span class="hljs-header"># consequence statement: convert matched word, literal braces</span>
[<span class="hljs-link_label">then</span>][<span class="hljs-link_reference"></span>]update {entity:\w+}=modify( ${entity!lc} )\{ \}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The transformation of a DSLR file proceeds as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The text is read into memory.</p>
</li>
<li>
<p>Each of the "keyword" entries is applied to the entire text. First, the regular expression from the keyword definition is modified by replacing white space sequences with a pattern matching any number of white space characters, and by replacing variable definitions with a capture made from the regular expression provided with the definition, or with the default (".*?"). Then, the DSLR text is searched exhaustively for occurrences of strings matching the modified regular expression. Substrings of a matching string corresponding to variable captures are extracted and replace variable references in the corresponding replacement text, and this text replaces the matching string in the DSLR text.</p>
</li>
<li>
<p>Sections of the DSLR text between "when" and "then", and "then" and "end", respectively, are located and processed in a uniform manner, line by line, as described below.</p>
<div class="paragraph">
<p>For a line, each DSL entry pertaining to the line’s section is taken in turn, in the order it appears in the DSL file.
Its regular expression part is modified: white space is replaced by a pattern matching any number of white space characters; variable definitions with a regular expression are replaced by a capture with this regular expression, its default being ".*?". If the resulting regular expression matches all or part of the line, the matched part is replaced by the suitably modified replacement text.</p>
</div>
<div class="paragraph">
<p>Modification of the replacement text is done by replacing variable references with the text corresponding to the regular expression capture.
This text may be modified according to the string transformation function given in the variable reference; see below for details.</p>
</div>
<div class="paragraph">
<p>If there is a variable reference naming a variable that is not defined in the same entry, the expander substitutes a value bound to a variable of that name, provided it was defined in one of the preceding lines of the current rule.</p>
</div>
</li>
<li>
<p>If a DSLR line in a condition is written with a leading hyphen, the expanded result is inserted into the last line, which should contain a pattern CE, i.e., a type name followed by a pair of parentheses. if this pair is empty, the expanded line (which should contain a valid constraint) is simply inserted, otherwise a comma (",") is inserted beforehand.</p>
<div class="paragraph">
<p>If a DSLR line in a consequence is written with a leading hyphen, the expanded result is inserted into the last line, which should contain a "modify" statement, ending in a pair of braces ("{" and "}"). If this pair is empty, the expanded line (which should contain a valid method call) is simply inserted, otherwise a comma (",") is inserted beforehand.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is currently <em>not</em> possible to use a line with a leading hyphen to insert text into other conditional element forms (e.g., "accumulate") or it may only work for the first insertion (e.g., "eval").</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>All string transformation functions are described in the following table.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. String transformation functions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts all letters to upper case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts all letters to lower case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ucfirst</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts the first letter to upper case, and
            all other letters to lower case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">num</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts all digits and "-" from the string. If the
            last two digits in the original string are preceded by "." or
            ",", a decimal period is inserted in the corresponding position.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>a</em>?<em>b</em>/<em>c</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compares the string with string <em>a</em>, and if they
            are equal, replaces it with <em>b</em>, otherwise with
            <em>c</em>. But <em>c</em> can be another triplet
            <em>a</em>, <em>b</em>, <em>c</em>, so
            that the entire structure is, in fact, a translation table.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following DSL examples show how to use string transformation functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs markdown"><span class="hljs-header"># definitions for conditions</span>
[<span class="hljs-link_label">when</span>][<span class="hljs-link_reference"></span>]There is an? {entity}=${entity!lc}: {entity!ucfirst}()
[<span class="hljs-link_label">when</span>][<span class="hljs-link_reference"></span>]- with an? {attr} greater than {amount}={attr} <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">=</span> {<span class="hljs-attribute">amount</span>!<span class="hljs-attribute">num</span>}
[<span class="hljs-attribute">when</span>][]<span class="hljs-attribute">-</span> <span class="hljs-attribute">with</span> <span class="hljs-attribute">a</span> {<span class="hljs-attribute">what</span>} {<span class="hljs-attribute">attr</span>}=<span class="hljs-value">{attr}</span> {<span class="hljs-attribute">what</span>!<span class="hljs-attribute">positive</span>?&gt;</span></span>0/negative?%lt;0/zero?==0/ERROR}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A file containing a DSL definition has to be put under the resources folder or any of its subfolders like any other drools artifact.
It must have the extension <code>.dsl</code>, or alternatively be marked with type <code>ResourceType.DSL</code>.
when programmatically added to a <code>KieFileSystem</code>.
For a file using DSL definition, the extension <code>.dslr</code> should be used, while it can be added to a <code>KieFileSystem</code> with type <code>ResourceType.DSLR</code>.</p>
</div>
<div class="paragraph">
<p>For parsing and expanding a DSLR file the DSL configuration is read and supplied to the parser.
Thus, the parser can "recognize" the DSL expressions and transform them into native rule language expressions.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="DroolsComplexEventProcessingChapter"><a class="anchor" href="#DroolsComplexEventProcessingChapter"></a><a class="link" href="#DroolsComplexEventProcessingChapter">9. Complex Event Processing</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_complex_event_processing"><a class="anchor" href="#_complex_event_processing"></a><a class="link" href="#_complex_event_processing">9.1. Complex Event Processing</a></h3>
<div class="paragraph">
<p>There is no broadly accepted definition on the term Complex Event Processing.
The term Event by itself is frequently overloaded and used to refer to several different things, depending on the context it is used.
Defining terms is not the goal of this guide and as so, lets adopt a loose definition that, although not formal, will allow us to proceed with a common understanding.</p>
</div>
<div class="paragraph">
<p>So, in the scope of this guide:</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Event</strong>, is a record of a significant change of state in the application domain at a given point in time.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For instance, on a Stock Broker application, when a sale operation is executed, it causes a change of state in the domain.
This change of state can be observed on several entities in the domain, like the price of the securities that changed to match the value of the operation, the ownership of the traded assets that changed from the seller to the buyer, the balance of the accounts from both seller and buyer that are credited and debited, etc.
Depending on how the domain is modelled, this change of state may be represented by a single event, multiple atomic events or even hierarchies of correlated events.
In any case, in the context of this guide, Event is the record of the change of a particular piece of data in the domain.</p>
</div>
<div class="paragraph">
<p>Events are processed by computer systems since they were invented, and throughout the history, systems responsible for that were given different names and different methodologies were employed.
It wasn’t until the 90’s though, that a more focused work started on EDA (Event Driven Architecture) with a more formal definition on the requirements and goals for event processing.
Old messaging systems started to change to address such requirements and new systems started to be developed with the single purpose of event processing.
Two trends were born under the names of Event Stream Processing and Complex Event Processing.</p>
</div>
<div class="paragraph">
<p>In the very beginnings, Event Stream Processing was focused on the capabilities of processing streams of events in (near) real time, while the main focus of Complex Event Processing was on the correlation and composition of atomic events into complex (compound) events.
An important (maybe the most important) milestone was the publishing of Dr.
David Luckham’s book "The Power of Events" in 2002.
In the book, Dr Luckham introduces the concept of Complex Event Processing and how it can be used to enhance systems that deal with events.
Over the years, both trends converged to a common understanding and today these systems are all referred to as CEP systems.</p>
</div>
<div class="paragraph">
<p>This is a very simplistic explanation to a really complex and fertile field of research, but sets a high level and common understanding of the concepts that this guide will introduce.</p>
</div>
<div class="paragraph">
<p>The current understanding of what Complex Event Processing is may be briefly described as the following quote from Wikipedia:</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>"<strong>Complex Event Processing</strong>, or CEP, is primarily an event processing concept that deals with the task of processing multiple events with the goal of identifying the meaningful events within the event cloud.
CEP employs techniques such as detection of complex patterns of many events, event correlation and abstraction, event hierarchies, and relationships between events such as causality, membership, and timing, and event-driven processes."</p>
</div>
</blockquote>
<div class="attribution">
— http://en.wikipedia.org/wiki/Complex_event_processing
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In other words, CEP is about detecting and selecting the interesting events (and only them) from an event cloud, finding their relationships and inferring new data from them and their relationships.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the remaining of this guide, we will use the terms  <strong>Complex Event Processing</strong> and <strong>CEP</strong> as a broad reference for any of  the related technologies and techniques, including but not limited to, CEP, Complex Event Processing, ESP, Event Stream Processing and Event Processing in general.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_drools_fusion"><a class="anchor" href="#_drools_fusion"></a><a class="link" href="#_drools_fusion">9.2. Drools Fusion</a></h3>
<div class="paragraph">
<p>Event Processing use cases, in general, share several requirements and goals with Business Rules use cases.
These overlaps happen both on the business side and on the technical side.</p>
</div>
<div class="paragraph">
<p>On the Business side:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Business rules are frequently defined based on the occurrence of scenarios triggered by events. Examples could be:</p>
<div class="ulist">
<ul>
<li>
<p>On an algorithmic trading application: take an action if the security price increases X% compared to the day opening price, where the price increases are usually denoted by events on a Stock Trade application.</p>
</li>
<li>
<p>On a monitoring application: take an action if the temperature on the server room increases X degrees in Y minutes, where sensor readings are usually denoted by events.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Both business rules and event processing queries change frequently and require immediate response for the business to adapt itself to new market conditions, new regulations and new enterprise policies.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From a technical perspective:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Both require seamless integration with the enterprise infrastructure and applications, specially on autonomous governance, including, but not limited to, lifecycle management, auditing, security, etc.</p>
</li>
<li>
<p>Both have functional requirements like pattern matching and non-functional requirements like response time and query/rule explanation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even sharing requirements and goals, historically, both fields were born appart and although the industry evolved and one can find good products on the market, they either focus on event processing or on business rules management.
That is due not only because of historical reasons but also because, even overlapping in part, use cases do have some different requirements.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Drools was also born as a rules engine several years ago, but following the vision of becoming a single platform for behavioral modelling, it soon realized that it could only achieve this goal by crediting the same importance to the three complementary business modelling techniques:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Business Rules Management</p>
</li>
<li>
<p>Business Processes Management</p>
</li>
<li>
<p>Complex Event Processing</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In this context, Drools Fusion is the module responsible for adding event processing capabilities into the platform.</p>
</div>
<div class="paragraph">
<p>Supporting Complex Event Processing, though, is much more than simply understanding what an event is.
CEP scenarios share several common and distinguishing characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Usually required to process huge volumes of events, but only a small percentage of the events are of real interest.</p>
</li>
<li>
<p>Events are usually immutable, since they are a record of state change.</p>
</li>
<li>
<p>Usually the rules and queries on events must run in reactive modes, i.e., react to the detection of event patterns.</p>
</li>
<li>
<p>Usually there are strong temporal relationships between related events.</p>
</li>
<li>
<p>Individual events are usually not important. The system is concerned about patterns of related events and their relationships.</p>
</li>
<li>
<p>Usually, the system is required to perform composition and aggregation of events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Based on this general common characteristics, Drools Fusion defined a set of goals to be achieved in order to support Complex Event Processing appropriately:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support Events, with their proper semantics, as first class citizens.</p>
</li>
<li>
<p>Allow detection, correlation, aggregation and composition of events.</p>
</li>
<li>
<p>Support processing of Streams of events.</p>
</li>
<li>
<p>Support temporal constraints in order to model the temporal relationships between events.</p>
</li>
<li>
<p>Support sliding windows of interesting events.</p>
</li>
<li>
<p>Support a session scoped unified clock.</p>
</li>
<li>
<p>Support the required volumes of events for CEP use cases.</p>
</li>
<li>
<p>Support to (re)active rules.</p>
</li>
<li>
<p>Support adapters for event input into the engine (pipeline).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above list of goals are based on the requirements not covered by Drools Expert itself, since in a unified platform, all features of one module are leveraged by the other modules.
This way, Drools Fusion is born with enterprise grade features like Pattern Matching, that is paramount to a CEP product, but that is already provided by Drools Expert.
In the same way, all features provided by Drools Fusion are leveraged by Drools Flow (and vice-versa) making process management aware of event processing and vice-versa.</p>
</div>
<div class="paragraph">
<p>For the remaining of this guide, we will go through each of the features Drools Fusion adds to the platform.
All these features are available to support different use cases in the CEP world, and the user is free to select and use the ones that will help him model his business use case.</p>
</div>
</div>
<div class="sect2">
<h3 id="_event_semantics"><a class="anchor" href="#_event_semantics"></a><a class="link" href="#_event_semantics">9.3. Event Semantics</a></h3>
<div class="paragraph">
<p>An <em>event</em> is a fact that present a few distinguishing characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Usually immutables:</strong> since, by the previously discussed definition, events are a record of a state change in the application domain, i.e., a record of something that already happened, and the past can not be "changed", events are immutables. This constraint is an important requirement for the development of several optimizations and for the specification of the event lifecycle. This does not mean that the Java object representing the object must be immutable. Quite the contrary, the engine does not enforce immutability of the object model, because one of the most common use cases for rules is event data enrichment.</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As a best practice, the application is allowed to populate un-populated event attributes (to enrich the event with inferred data), but already populated attributes should never be changed.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><strong>Strong temporal constraints:</strong> rules involving events usually require the correlation of multiple events, specially temporal correlations where events are said to happen at some point in time relative to other events.</p>
</li>
<li>
<p><strong>Managed lifecycle:</strong> due to their immutable nature and the temporal constraints, events usually will only match other events and facts during a limited window of time, making it possible for the engine to manage the lifecycle of the events automatically. In other words, one an event is inserted into the working memory, it is possible for the engine to find out when an event can no longer match other facts and automatically delete it, releasing its associated resources.</p>
</li>
<li>
<p><strong>Use of sliding windows:</strong> since all events have timestamps associated to them, it is possible to define and use sliding windows over them, allowing the creation of rules on aggregations of values over a period of time. Example: average of an event value over 60 minutes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools supports the declaration and usage of events with both semantics: <strong>point-in-time</strong> events and <strong>interval-based</strong> events.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A simplistic way to understand the unitification of the semantics is to consider a <em>point-in-time</em> event as an <em>interval-based</em> event whose <em>duration is zero</em>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_event_processing_modes"><a class="anchor" href="#_event_processing_modes"></a><a class="link" href="#_event_processing_modes">9.4. Event Processing Modes</a></h3>
<div class="paragraph">
<p>Rules engines in general have a well known way of processing data and rules and provide the application with the results.
Also, there is not many requirements on how facts should be presented to the rules engine, specially because in general, the processing itself is time independent.
That is a good assumption for most scenarios, but not for all of them.
When the requirements include the processing of real time or near real time events, time becomes and important variable of the reasoning process.</p>
</div>
<div class="paragraph">
<p>The following sections will explain the impact of time on rules reasoning and the two modes provided by Drools for the reasoning process.</p>
</div>
<div class="sect3">
<h4 id="_cloud_mode"><a class="anchor" href="#_cloud_mode"></a><a class="link" href="#_cloud_mode">9.4.1. Cloud Mode</a></h4>
<div class="paragraph">
<p>The CLOUD processing mode is the default processing mode.
Users of rules engine are familiar with this mode because it behaves in exactly the same way as any pure forward chaining rules engine, including previous versions of Drools.</p>
</div>
<div class="paragraph">
<p>When running in CLOUD mode, the engine sees all facts in the working memory, does not matter if they are regular facts or events, as a whole.
There is no notion of flow of time, although events have a timestamp as usual.
In other words, although the engine knows that a given event was created, for instance, on January 1st 2009, at 09:35:40.767, it is not possible for the engine to determine how "old" the event is, because there is no concept of "now".</p>
</div>
<div class="paragraph">
<p>In this mode, the engine will apply its usual many-to-many pattern matching algorithm, using the rules constraints to find the matching tuples, activate and fire rules as usual.</p>
</div>
<div class="paragraph">
<p>This mode does not impose any kind of additional requirements on facts.
So for instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is no notion of time. No requirements clock synchronization.</p>
</li>
<li>
<p>There is no requirement on event ordering. The engine looks at the events as an unordered cloud against which the engine tries to match rules.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On the other hand, since there is no requirements, some benefits are not available either.
For instance, in CLOUD mode, it is not possible to use sliding windows, because sliding windows are based on the concept of "now" and there is no concept of "now" in CLOUD mode.</p>
</div>
<div class="paragraph">
<p>Since there is no ordering requirement on events, it is not possible for the engine to determine when events can no longer match and as so, there is no automatic life-cycle management for events.
I.e., the application must explicitly delete events when they are no longer necessary, in the same way the application does with regular facts.</p>
</div>
<div class="paragraph">
<p>Cloud mode is the default execution mode for Drools, but in any case, as any other configuration in Drools, it is possible to change this behavior either by setting a system property, using configuration property files or using the API.
The corresponding property is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieBaseConfiguration config = KieServices.Factory.get().newKieBaseConfiguration();
config.setOption( EventProcessingOption.CLOUD );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent property is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">drools.eventProcessingMode = cloud</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_stream_mode"><a class="anchor" href="#_stream_mode"></a><a class="link" href="#_stream_mode">9.4.2. Stream Mode</a></h4>
<div class="paragraph">
<p>The STREAM processing mode is the mode of choice when the application needs to process streams of events.
It adds a few common requirements to the regular processing, but enables a whole lot of features that make stream event processing a lot simpler.</p>
</div>
<div class="paragraph">
<p>The main requirements to use STREAM mode are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Events in each stream must be time-ordered. I.e., inside a given stream, events that happened first must be inserted first into the engine.</p>
</li>
<li>
<p>The engine will force synchronization between streams through the use of the session clock, so, although the application does not need to enforce time ordering between streams, the use of non-time-synchronized streams may result in some unexpected results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given that the above requirements are met, the application may enable the STREAM mode using the following API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieBaseConfiguration config = KieServices.Factory.get().newKieBaseConfiguration();
config.setOption( EventProcessingOption.STREAM );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, the equivalent property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">drools.eventProcessingMode = stream</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the STREAM, the engine knows the concept of flow of time and the concept of "now", i.e., the engine understands how old events are based on the current timestamp read from the Session Clock.
This characteristic allows the engine to provide the following additional features to the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sliding Window support</p>
</li>
<li>
<p>Automatic Event Lifecycle Management</p>
</li>
<li>
<p>Automatic Rule Delaying when using Negative Patterns</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All these features are explained in the following sections.</p>
</div>
<div class="sect4">
<h5 id="_role_of_session_clock_in_stream_mode"><a class="anchor" href="#_role_of_session_clock_in_stream_mode"></a><a class="link" href="#_role_of_session_clock_in_stream_mode">9.4.2.1. Role of Session Clock in Stream mode</a></h5>
<div class="paragraph">
<p>When running the engine in CLOUD mode, the session clock is used only to time stamp the arriving events that don’t have a previously defined timestamp attribute.
Although, in STREAM mode, the Session Clock assumes an even more important role.</p>
</div>
<div class="paragraph">
<p>In STREAM mode, the session clock is responsible for keeping the current timestamp, and based on it, the engine does all the temporal calculations on event’s aging, synchronizes streams from multiple sources, schedules future tasks and so on.</p>
</div>
<div class="paragraph">
<p>Check the documentation on the Session Clock section to know how to configure and use different session clock implementations.</p>
</div>
</div>
<div class="sect4">
<h5 id="_negative_patterns_in_stream_mode"><a class="anchor" href="#_negative_patterns_in_stream_mode"></a><a class="link" href="#_negative_patterns_in_stream_mode">9.4.2.2. Negative Patterns in Stream Mode</a></h5>
<div class="paragraph">
<p>Negative patterns behave different in STREAM mode when compared to CLOUD mode.
In CLOUD mode, the engine assumes that all facts and events are known in advance (there is no concept of flow of time) and so, negative patterns are evaluated immediately.</p>
</div>
<div class="paragraph">
<p>When running in STREAM mode, negative patterns with temporal constraints may require the engine to wait for a time period before activating a rule.
The time period is automatically calculated by the engine in a way that the user does not need to use any tricks to achieve the desired result.</p>
</div>
<div class="paragraph">
<p>For instance:</p>
</div>
<div class="exampleblock">
<div class="title">Example 173. a rule that activates immediately upon matching</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"Sound the alarm"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$f</span> : FireDetected( )
    <span class="hljs-keyword">not</span>( SprinklerActivated( ) )
then
    // sound the <span class="hljs-keyword">alarm</span>
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above rule has no temporal constraints that would require delaying the rule, and so, the rule activates immediately.
The following rule on the other hand, must wait for 10 seconds before activating, since it may take up to 10 seconds for the sprinklers to activate:</p>
</div>
<div class="exampleblock">
<div class="title">Example 174. a rule that automatically delays activation due to temporalconstraints</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">rule <span class="hljs-string">"Sound the alarm"</span>
when
    $f : FireDetected( )
    not( SprinklerActivated( <span class="hljs-keyword">this</span> after[<span class="hljs-number">0</span>s,<span class="hljs-number">10</span>s] $f ) )
then
    <span class="hljs-comment">// sound the alarm</span>
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This behaviour allows the engine to keep consistency when dealing with negative patterns and temporal constraints at the same time.
The above would be the same as writing the rule as below, but does not burden the user to calculate and explicitly write the appropriate duration parameter:</p>
</div>
<div class="exampleblock">
<div class="title">Example 175. same rule with explicit duration parameter</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">rule <span class="hljs-string">"Sound the alarm"</span>
    duration( <span class="hljs-number">10</span>s )
when
    $f : FireDetected( )
    not( SprinklerActivated( <span class="hljs-keyword">this</span> after[<span class="hljs-number">0</span>s,<span class="hljs-number">10</span>s] $f ) )
then
    <span class="hljs-comment">// sound the alarm</span>
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following rule expects every 10 seconds at least one “Heartbeat” event, if not the rule fires.
The special case in this rule is that we use the same type of the object in the first pattern and in the negative pattern.
The negative pattern has the temporal constraint to wait between 0 to 10 seconds before firing and it excludes the Heartbeat bound to $h.
Excluding the bound Heartbeat is important since the temporal constraint [0s, …​] does not exclude by itself the bound event $h from being matched again, thus preventing the rule to fire.</p>
</div>
<div class="exampleblock">
<div class="title">Example 176. excluding bound events in negative patterns</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"Sound the alarm"</span>
<span class="hljs-keyword">when</span>
    $h: Heartbeat( ) <span class="hljs-keyword">from</span> entry-point <span class="hljs-string">"MonitoringStream"</span>
    not( Heartbeat( <span class="hljs-keyword">this</span> != $h, <span class="hljs-keyword">this</span> after[<span class="hljs-number">0</span>s,<span class="hljs-number">10</span>s] $h ) <span class="hljs-keyword">from</span> entry-point <span class="hljs-string">"MonitoringStream"</span> )
then
    <span class="hljs-comment">// Sound the alarm</span>
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_session_clock"><a class="anchor" href="#_session_clock"></a><a class="link" href="#_session_clock">9.5. Session Clock</a></h3>
<div class="paragraph">
<p>Reasoning over time requires a reference clock.
Just to mention one example, if a rule reasons over the average price of a given stock over the last 60 minutes, how the engine knows what stock price changes happened over the last 60 minutes in order to calculate the average? The obvious response is: by comparing the timestamp of the events with the "current time". How the engine knows what <strong>time is now</strong>? Again, obviously, by querying the Session Clock.</p>
</div>
<div class="paragraph">
<p>The session clock implements a strategy pattern, allowing different types of clocks to be plugged and used by the engine.
This is very important because the engine may be running in an elements of different scenarios that may require different clock implementations.
Just to mention a few:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Rules testing:</strong> testing always requires a controlled environment, and when the tests include rules with temporal constraints, it is necessary to not only control the input rules and facts, but also the flow of time.</p>
</li>
<li>
<p><strong>Regular execution:</strong> usually, when running rules in production, the application will require a real time clock that allows the rules engine to react immediately to the time progression.</p>
</li>
<li>
<p><strong>Special environments:</strong> specific environments may have specific requirements on time control. Cluster environments may require clock synchronization through heart beats, or JEE environments may require the use of an AppServer provided clock, etc.</p>
</li>
<li>
<p><strong>Rules replay or simulation: </strong>to replay scenarios or simulate scenarios it is necessary that the application also controls the flow of time.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_available_clock_implementations"><a class="anchor" href="#_available_clock_implementations"></a><a class="link" href="#_available_clock_implementations">9.5.1. Available Clock Implementations</a></h4>
<div class="paragraph">
<p>Drools 5 provides 2 clock implementations out of the box.
The default real time clock, based on the system clock, and an optional pseudo clock, controlled by the application.</p>
</div>
<div class="sect4">
<h5 id="_real_time_clock"><a class="anchor" href="#_real_time_clock"></a><a class="link" href="#_real_time_clock">9.5.1.1. Real Time Clock</a></h5>
<div class="paragraph">
<p>By default, Drools uses a real time clock implementation that internally uses the system clock to determine the current timestamp.</p>
</div>
<div class="paragraph">
<p>To explicitly configure the engine to use the real time clock, just set the session configuration parameter to real time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get(<span class="hljs-string">"realtime"</span>) );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pseudo_clock"><a class="anchor" href="#_pseudo_clock"></a><a class="link" href="#_pseudo_clock">9.5.1.2. Pseudo Clock</a></h5>
<div class="paragraph">
<p>Drools also offers out of the box an implementation of a clock that is controlled by the application that is called Pseudo Clock.
This clock is specially useful for unit testing temporal rules since it can be controlled by the application and so the results become deterministic.</p>
</div>
<div class="paragraph">
<p>To configure the pseudo session clock, do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
config.setOption( ClockTypeOption.get(<span class="hljs-string">"pseudo"</span>) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example of how to control the pseudo session clock:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieSessionConfiguration config = KieServices.Factory.get().newKieSessionConfiguration();
conf.setOption( ClockTypeOption.get( <span class="hljs-string">"pseudo"</span> ) );
KieSession session = kbase.newKieSession( conf, <span class="hljs-keyword">null</span> );

SessionPseudoClock clock = session.getSessionClock();

<span class="hljs-comment">// then, while inserting facts, advance the clock as necessary:</span>
FactHandle handle1 = session.insert( tick1 );
clock.advanceTime( <span class="hljs-number">10</span>, TimeUnit.SECONDS );
FactHandle handle2 = session.insert( tick2 );
clock.advanceTime( <span class="hljs-number">30</span>, TimeUnit.SECONDS );
FactHandle handle3 = session.insert( tick3 );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sliding_windows"><a class="anchor" href="#_sliding_windows"></a><a class="link" href="#_sliding_windows">9.6. Sliding Windows</a></h3>
<div class="paragraph">
<p>Sliding Windows are a way to scope the events of interest by defining a window that is constantly moving.
The two most common types of sliding window implementations are time based windows and length based windows.</p>
</div>
<div class="paragraph">
<p>The next sections will detail each of them.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Sliding Windows are only available when running the engine in STREAM mode.
Check the Event Processing Mode section for details on how the STREAM mode works.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Sliding windows start to match immediately and defining a sliding window does not imply that the rule has to wait for the sliding window to be "full" in order to match.
For instance, a rule that calculates the average of an event property on a window:length(10) will start calculating the average immediately, and it will start at 0 (zero) for no-events, and will update the average as events arrive one by one.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_sliding_time_windows"><a class="anchor" href="#_sliding_time_windows"></a><a class="link" href="#_sliding_time_windows">9.6.1. Sliding Time Windows</a></h4>
<div class="paragraph">
<p>Sliding Time Windows allow the user to write rules that will only match events occurring in the last X time units.</p>
</div>
<div class="paragraph">
<p>For instance, if the user wants to consider only the Stock Ticks that happened in the last 2 minutes, the pattern would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">StockTick() over window:time( <span class="hljs-number">2</span>m )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Drools uses the "over" keyword to associate windows to patterns.</p>
</div>
<div class="paragraph">
<p>On a more elaborate example, if the user wants to sound an alarm in case the average temperature over the last 10 minutes read from a sensor is above the threshold value, the rule would look like:</p>
</div>
<div class="exampleblock">
<div class="title">Example 177. aggregating values over time windows</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"Sound the alarm in case temperature rises above threshold"</span>
<span class="hljs-keyword">when</span>
    TemperatureThreshold( <span class="hljs-variable">$max</span> : max )
    Number( doubleValue &gt; <span class="hljs-variable">$max</span> ) from accumulate(
        SensorReading( <span class="hljs-variable">$temp</span> : temperature ) over window:<span class="hljs-keyword">time</span>( <span class="hljs-number">10</span><span class="hljs-keyword">m</span> ),
        average( <span class="hljs-variable">$temp</span> ) )
then
    // sound the <span class="hljs-keyword">alarm</span>
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The engine will automatically disregard any SensorReading older than 10 minutes and keep the calculated average consistent.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that time based windows are considered when calculating the interval an event remains in the working memory before being expired, but an event falling off a sliding window does not mean by itself that the event will be discarded from the working memory, as there might be other rules that depend on that event.
The engine will discard events only when no other rules depend on that event and the expiration policy for that event type is fulfilled.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_sliding_length_windows"><a class="anchor" href="#_sliding_length_windows"></a><a class="link" href="#_sliding_length_windows">9.6.2. Sliding Length Windows</a></h4>
<div class="paragraph">
<p>Sliding Length Windows work the same way as Time Windows, but consider events based on order of their insertion into the session instead of flow of time.</p>
</div>
<div class="paragraph">
<p>For instance, if the user wants to consider only the last 10 RHT Stock Ticks, independent of how old they are, the pattern would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">StockTick( company == <span class="hljs-string">"RHT"</span> ) over window:length( <span class="hljs-number">10</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the pattern is similar to the one presented in the previous section, but instead of using window:time to define the sliding window, it uses window:length.</p>
</div>
<div class="paragraph">
<p>Using a similar example to the one in the previous section, if the user wants to sound an alarm in case the average temperature over the last 100 readings from a sensor is above the threshold value, the rule would look like:</p>
</div>
<div class="exampleblock">
<div class="title">Example 178. aggregating values over length windows</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"Sound the alarm in case temperature rises above threshold"</span>
<span class="hljs-keyword">when</span>
    TemperatureThreshold( <span class="hljs-variable">$max</span> : max )
    Number( doubleValue &gt; <span class="hljs-variable">$max</span> ) from accumulate(
        SensorReading( <span class="hljs-variable">$temp</span> : temperature ) over window:<span class="hljs-keyword">length</span>( <span class="hljs-number">100</span> ),
        average( <span class="hljs-variable">$temp</span> ) )
then
    // sound the <span class="hljs-keyword">alarm</span>
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The engine will keep only consider the last 100 readings to calculate the average temperature.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that falling off a length based window is not criteria for event expiration in the session.
The engine disregards events that fall off a window when calculating that window, but does not remove the event from the session based on that condition alone as there might be other rules that depend on that event.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please note that length based windows do not define temporal constraints for event expiration from the session, and the engine will not consider them.
If events have no other rules defining temporal constraints and no explicit expiration policy, the engine will keep them in the session indefinitely.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When using a sliding window, alpha constraints are evaluated before the window is considered, but beta (join) constraints are evaluated afterwards.
This usually doesn’t make a difference when time windows are concerned, but it’s important when using a length window.
For example this pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">StockTick( company == <span class="hljs-string">"RHT"</span> ) over window:length( <span class="hljs-number">10</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>defines a window of (at most) 10 StockTicks all having company equal to "RHT", while the following one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-variable">$s</span> : String()
StockTick( company == <span class="hljs-variable">$s</span> ) over window:<span class="hljs-keyword">length</span>( <span class="hljs-number">10</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>first creates a window of (at most) 10 StockTicks regardless of the value of their company attribute and then filters among them only the ones having the company equal to the String selected from the working memory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_window_declaration"><a class="anchor" href="#_window_declaration"></a><a class="link" href="#_window_declaration">9.6.3. Window Declaration</a></h4>
<div class="paragraph">
<p>The engine also supports the declaration of Windows.
This promotes a clear separation between what are the filters applied to the window and what are the constraints applied to the result of window.
It also allows easy reuse of windows among multiple rules.</p>
</div>
<div class="paragraph">
<p>Another benefit is a new implementation of the basic window support in the engine, increasing the overall performance of the rules that use sliding windows.</p>
</div>
<div class="paragraph">
<p>The simplified EBNF to declare a window is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">windowDeclaration := <span class="hljs-operator"><span class="hljs-keyword">DECLARE</span> WINDOW <span class="hljs-keyword">ID</span> annotation* lhsPatternBind <span class="hljs-keyword">END</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For example a window containing only the last 10 stock ticks from a given source can be defined like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> window Ticks
    StockTick( <span class="hljs-keyword">source</span> == <span class="hljs-string">"NYSE"</span> )
        <span class="hljs-keyword">over</span> window:<span class="hljs-keyword">length</span>( <span class="hljs-number">10</span> )
        <span class="hljs-keyword">from</span> entry-point STStream
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Rules can then use this declared window by using it as a source for a FROM as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"RHT ticks in the window"</span>
    <span class="hljs-function"><span class="hljs-keyword">when</span>
        <span class="hljs-title">accumulate</span>(<span class="hljs-params"> StockTick( company == <span class="hljs-string">"RHT"</span> </span>) <span class="hljs-keyword">from</span> window Ticks,
                    $cnt : <span class="hljs-title">count</span>(<span class="hljs-params"><span class="hljs-number">1</span></span>) )
    then
        <span class="hljs-comment">// there has been $cnt RHT ticks over the last 10 ticks</span>
end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this example also demonstrates how the window declaration allows to separate the constraints applied to the window (only the StockTicks having "NYSE" as source are among the 10 events included into window) and the constraints applied to the window result (among the last 10 events having "NYSE" as source only the ones with company equal to "RHT" are selected).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_streams_support"><a class="anchor" href="#_streams_support"></a><a class="link" href="#_streams_support">9.7. Streams Support</a></h3>
<div class="paragraph">
<p>Most CEP use cases have to deal with streams of events.
The streams can be provided to the application in various forms, from JMS queues to flat text files, from database tables to raw sockets or even through web service calls.
In any case, the streams share a common set of characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>events in the stream are ordered by a timestamp. The timestamp may have different semantics for different streams but they are always ordered internally.</p>
</li>
<li>
<p>volumes of events are usually high.</p>
</li>
<li>
<p>atomic events are rarely useful by themselves. Usually meaning is extracted from the correlation between multiple events from the stream and also from other sources.</p>
</li>
<li>
<p>streams may be homogeneous, i.e. contain a single type of events, or heterogeneous, i.e. contain multiple types of events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools generalized the concept of a stream as an "entry point" into the engine.
An entry point is for drools a gate from which facts come.
The facts may be regular facts or special facts like events.</p>
</div>
<div class="paragraph">
<p>In Drools, facts from one entry point (stream) may join with facts from any other entry point or event with facts from the working memory.
Although, they never mix, i.e., they never lose the reference to the entry point through which they entered the engine.
This is important because one may have the same type of facts coming into the engine through several entry points, but one fact that is inserted into the engine through entry point A will never match a pattern from a entry point B, for example.</p>
</div>
<div class="sect3">
<h4 id="_declaring_and_using_entry_points"><a class="anchor" href="#_declaring_and_using_entry_points"></a><a class="link" href="#_declaring_and_using_entry_points">9.7.1. Declaring and Using Entry Points</a></h4>
<div class="paragraph">
<p>Entry points are declared implicitly in Drools by directly making use of them in rules.
I.e.
referencing an entry point in a rule will make the engine, at compile time, to identify and create the proper internal structures to support that entry point.</p>
</div>
<div class="paragraph">
<p>So, for instance, lets imagine a banking application, where transactions are fed into the system coming from streams.
One of the streams contains all the transactions executed in ATM machines.
So, if one of the rules says: a withdraw is authorized if and only if the account balance is over the requested withdraw amount, the rule would look like:</p>
</div>
<div class="exampleblock">
<div class="title">Example 179. Example of Stream Usage</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"authorize withdraw"</span>
when
    WithdrawRequest( <span class="hljs-variable">$ai</span> : accountId, <span class="hljs-variable">$am</span> : amount ) from entry-point <span class="hljs-string">"ATM Stream"</span>
    CheckingAccount( accountId == <span class="hljs-variable">$ai</span>, balance &gt; <span class="hljs-variable">$am</span> )
<span class="hljs-keyword">then</span>
    // authorize withdraw
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the previous example, the engine compiler will identify that the pattern is tied to the entry point "ATM Stream" and will both create all the necessary structures for the rulebase to support the "ATM Stream" and will only match WithdrawRequests coming from the "ATM Stream". In the previous example, the rule is also joining the event from the stream with a fact from the main working memory (CheckingAccount).</p>
</div>
<div class="paragraph">
<p>Now, lets imagine a second rule that states that a fee of $2 must be applied to any account for which a withdraw request is placed at a bank branch:</p>
</div>
<div class="exampleblock">
<div class="title">Example 180. Using a different Stream</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">rule</span> <span class="hljs-string">"apply fee on withdraws on branches"</span>
when
    WithdrawRequest( <span class="hljs-variable">$ai</span> : accountId, processed == <span class="hljs-built_in">true</span> ) from entry-point <span class="hljs-string">"Branch Stream"</span>
    CheckingAccount( accountId == <span class="hljs-variable">$ai</span> )
then
    // apply a <span class="hljs-variable">$2</span> fee <span class="hljs-built_in">on</span> the account
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The previous rule will match events of the exact same type as the first rule (WithdrawRequest), but from two different streams, so an event inserted into "ATM Stream" will never be evaluated against the pattern on the second rule, because the rule states that it is only interested in patterns coming from the "Branch Stream".</p>
</div>
<div class="paragraph">
<p>So, entry points, besides being a proper abstraction for streams, are also a way to scope facts in the working memory, and a valuable tool for reducing cross products explosions.
But that is a subject for another time.</p>
</div>
<div class="paragraph">
<p>Inserting events into an entry point is equally simple.
Instead of inserting events directly into the working memory, insert them into the entry point as shown in the example below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 181. Inserting facts into an entry point</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// create your rulebase and your session as usual</span>
KieSession session = ...

<span class="hljs-comment">// get a reference to the entry point</span>
EntryPoint atmStream = session.getEntryPoint( <span class="hljs-string">"ATM Stream"</span> );

<span class="hljs-comment">// and start inserting your facts into the entry point</span>
atmStream.insert( aWithdrawRequest );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The previous example shows how to manually insert facts into a given entry point.
Although, usually, the application will use one of the many adapters to plug a stream end point, like a JMS queue, directly into the engine entry point, without coding the inserts manually.
The Drools pipeline API has several adapters and helpers to do that as well as examples on how to do it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_memory_management_for_events"><a class="anchor" href="#_memory_management_for_events"></a><a class="link" href="#_memory_management_for_events">9.8. Memory Management for Events</a></h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The automatic memory management for events is only performed when running the engine in STREAM mode.
Check the Event Processing Mode section for details on how the STREAM mode works.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>One of the benefits of running the engine in STREAM mode is that the engine can detect when an event can no longer match any rule due to its temporal constraints.
When that happens, the engine can safely delete the event from the session without side effects and release any resources used by that event.</p>
</div>
<div class="paragraph">
<p>There are basically 2 ways for the engine to calculate the matching window for a given event:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>explicitly, using the expiration policy</p>
</li>
<li>
<p>implicitly, analyzing the temporal constraints on events</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_explicit_expiration_offset"><a class="anchor" href="#_explicit_expiration_offset"></a><a class="link" href="#_explicit_expiration_offset">9.8.1. Explicit expiration offset</a></h4>
<div class="paragraph">
<p>The first way of allowing the engine to calculate the window of interest for a given event type is by explicitly setting it.
To do that, just use the declare statement and define an expiration for the fact type:</p>
</div>
<div class="exampleblock">
<div class="title">Example 182. explicitly defining an expiration offset of 30 minutes forStockTick events</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> StockTick
    @expires( <span class="hljs-number">30</span><span class="hljs-keyword">m</span> )
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example declares an expiration offset of 30 minutes for StockTick events.
After that time, assuming no rule still needs the event, the engine will expire and remove the event from the session automatically.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An explicit expiration policy for a given event type overrides any inferred expiration offset for that same type.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_inferred_expiration_offset"><a class="anchor" href="#_inferred_expiration_offset"></a><a class="link" href="#_inferred_expiration_offset">9.8.2. Inferred expiration offset</a></h4>
<div class="paragraph">
<p>Another way for the engine to calculate the expiration offset for a given event is implicitly, by analyzing the temporal constraints in the rules.
For instance, given the following rule:</p>
</div>
<div class="exampleblock">
<div class="title">Example 183. example rule with temporal constraints</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"correlate orders"</span>
when
    <span class="hljs-variable">$bo</span> : BuyOrderEvent( <span class="hljs-variable">$id</span> : id )
    <span class="hljs-variable">$ae</span> : AckEvent( id == <span class="hljs-variable">$id</span>, this after[<span class="hljs-number">0</span>,<span class="hljs-number">10</span>s] <span class="hljs-variable">$bo</span> )
<span class="hljs-keyword">then</span>
    // <span class="hljs-keyword">do</span> something
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Analyzing the above rule, the engine automatically calculates that whenever a BuyOrderEvent matches, it needs to store it for up to 10 seconds to wait for matching AckEvent’s.
So, the implicit expiration offset for BuyOrderEvent will be 10 seconds.
AckEvent, on the other hand, can only match existing BuyOrderEvent’s, and so its expiration offset will be zero seconds.</p>
</div>
<div class="paragraph">
<p>The engine will make this analysis for the whole rulebase and find the offset for every event type.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An explicit expiration policy for a given event type overrides any inferred expiration offset for that same type.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_temporal_reasoning"><a class="anchor" href="#_temporal_reasoning"></a><a class="link" href="#_temporal_reasoning">9.9. Temporal Reasoning</a></h3>
<div class="paragraph">
<p>Temporal reasoning is another requirement of any CEP system.
As discussed previously, one of the distinguishing characteristics of events is their strong temporal relationships.</p>
</div>
<div class="paragraph">
<p>Temporal reasoning is an extensive field of research, from its roots on Temporal Modal Logic to its more practical applications in business systems.
There are hundreds of papers and thesis written and approaches are described for several applications.
Drools once more takes a pragmatic and simple approach based on several sources, but specially worth noting the following papers:</p>
</div>
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="ALLEN81"></a>[ALLEN81] Allen, J.F.. <em>An Interval-based Representation of Temporal Knowledge</em>. 1981.</p>
</li>
<li>
<p><a id="ALLEN83"></a>[ALLEN83] Allen, J.F.. <em>Maintaining knowledge about temporal intervals</em>. 1983.</p>
</li>
<li>
<p><a id="BENNE00"></a>[BENNE00] Bennet, Brandon and Galton, Antony P.. <em>A Unifying Semantics for Time and Events</em>. 2005.</p>
</li>
<li>
<p><a id="YONEK05"></a>[YONEK05] Yoneki, Eiko and Bacon, Jean. <em>Unified Semantics for Event Correlation Over Time and Space in Hybrid Network Environments</em>. 2005.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools implements the Interval-based Time Event Semantics described by Allen, and represents Point-in-Time Events as Interval-based evens with duration 0 (zero).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For all temporal operator intervals, the "<strong>" (star) symbol is used to indicate <em>positive infinity</em> and the "-</strong>" (minus star) is used to indicate <em>negative infinity</em>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_temporal_operators"><a class="anchor" href="#_temporal_operators"></a><a class="link" href="#_temporal_operators">9.9.1. Temporal Operators</a></h4>
<div class="paragraph">
<p>Drools implements all 13 operators defined by Allen and also their logical complement (negation). This section details each of the operators and their parameters.</p>
</div>
<div class="sect4">
<h5 id="_after"><a class="anchor" href="#_after"></a><a class="link" href="#_after">9.9.1.1. After</a></h5>
<div class="paragraph">
<p>The after evaluator correlates two events and matches when the temporal distance from the current event to the event being correlated belongs to the distance range declared for the operator.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> after[ <span class="hljs-number">3</span>m30s, <span class="hljs-number">4</span>m ] $eventB )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the temporal distance between the time when $eventB finished and the time when $eventA started is between ( 3 minutes and 30 seconds ) and ( 4 minutes ). In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"> <span class="hljs-number">3</span>m30s &lt;= <span class="hljs-variable">$eventA</span>.startTimestamp - <span class="hljs-variable">$eventB</span>.endTimeStamp &lt;= <span class="hljs-number">4</span>m</code></pre>
</div>
</div>
<div class="paragraph">
<p>The temporal distance interval for the after operator is optional:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If two values are defined (like in the example below), the interval starts on the first value and finishes on the second.</p>
</li>
<li>
<p>If only one value is defined, the interval starts on the value and finishes on the positive infinity.</p>
</li>
<li>
<p>If no value is defined, it is assumed that the initial value is 1ms and the final value is the positive infinity.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is possible to define negative distances for this operator.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> after[ -<span class="hljs-number">3</span>m30s, -<span class="hljs-number">2</span>m ] $eventB )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the first value is greater than the second value, the engine automatically reverses them, as there is no reason to have the first value greater than the second value.
Example: the following two patterns are considered to have the same semantics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> after[ -<span class="hljs-number">3</span>m30s, -<span class="hljs-number">2</span>m ] $eventB )
$eventA : EventA( <span class="hljs-keyword">this</span> after[ -<span class="hljs-number">2</span>m, -<span class="hljs-number">3</span>m30s ] $eventB )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>after</em>, <em>before</em> and <em>coincides</em> operators can be used to define constraints between events, java.util.Date attributes, and long attributes (interpreted as timestamps since epoch) in any combination.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">EventA( this after <span class="hljs-variable">$someDate</span> )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_before"><a class="anchor" href="#_before"></a><a class="link" href="#_before">9.9.1.2. Before</a></h5>
<div class="paragraph">
<p>The before evaluator correlates two events and matches when the temporal distance from the event being correlated to the current correlated belongs to the distance range declared for the operator.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> before[ <span class="hljs-number">3</span>m30s, <span class="hljs-number">4</span>m ] $eventB )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the temporal distance between the time when $eventA finished and the time when $eventB started is between ( 3 minutes and 30 seconds ) and ( 4 minutes ). In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"> <span class="hljs-number">3</span>m30s &lt;= <span class="hljs-variable">$eventB</span>.startTimestamp - <span class="hljs-variable">$eventA</span>.endTimeStamp &lt;= <span class="hljs-number">4</span>m</code></pre>
</div>
</div>
<div class="paragraph">
<p>The temporal distance interval for the before operator is optional:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If two values are defined (like in the example below), the interval starts on the first value and finishes on the second.</p>
</li>
<li>
<p>If only one value is defined, then the interval starts on the value and finishes on the positive infinity.</p>
</li>
<li>
<p>If no value is defined, it is assumed that the initial value is 1ms and the final value is the positive infinity.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is possible to define negative distances for this operator.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> before[ -<span class="hljs-number">3</span>m30s, -<span class="hljs-number">2</span>m ] $eventB )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the first value is greater than the second value, the engine automatically reverses them, as there is no reason to have the first value greater than the second value.
Example: the following two patterns are considered to have the same semantics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> before[ -<span class="hljs-number">3</span>m30s, -<span class="hljs-number">2</span>m ] $eventB )
$eventA : EventA( <span class="hljs-keyword">this</span> before[ -<span class="hljs-number">2</span>m, -<span class="hljs-number">3</span>m30s ] $eventB )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>after</em>, <em>before</em> and <em>coincides</em> operators can be used to define constraints between events, java.util.Date attributes, and long attributes (interpreted as timestamps since epoch) in any combination.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">EventA( this after <span class="hljs-variable">$someDate</span> )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_coincides"><a class="anchor" href="#_coincides"></a><a class="link" href="#_coincides">9.9.1.3. Coincides</a></h5>
<div class="paragraph">
<p>The coincides evaluator correlates two events and matches when both happen at the same time.
Optionally, the evaluator accept thresholds for the distance between events' start and finish timestamps.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this coincides <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the start timestamps of both $eventA and $eventB are the same AND the end timestamp of both $eventA and $eventB also are the same.</p>
</div>
<div class="paragraph">
<p>Optionally, this operator accepts one or two parameters.
These parameters are the thresholds for the distance between matching timestamps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If only one parameter is given, it is used for both start and end timestamps.</p>
</li>
<li>
<p>If two parameters are given, then the first is used as a threshold for the start timestamp and the second one is used as a threshold for the end timestamp.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> coincides[<span class="hljs-number">15</span>s, <span class="hljs-number">10</span>s] $eventB )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Above pattern will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-keyword">abs</span>( <span class="hljs-variable">$eventA</span>.startTimestamp - <span class="hljs-variable">$eventB</span>.startTimestamp ) &lt;= <span class="hljs-number">15</span><span class="hljs-keyword">s</span> &amp;&amp;
<span class="hljs-keyword">abs</span>( <span class="hljs-variable">$eventA</span>.endTimestamp - <span class="hljs-variable">$eventB</span>.endTimestamp ) &lt;= <span class="hljs-number">10</span><span class="hljs-keyword">s</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It makes no sense to use negative interval values for the parameters and the engine will raise an error if that happens.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>after</em>, <em>before</em> and <em>coincides</em> operators can be used to define constraints between events, java.util.Date attributes, and long attributes (interpreted as timestamps since epoch) in any combination.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">EventA( this after <span class="hljs-variable">$someDate</span> )</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_during"><a class="anchor" href="#_during"></a><a class="link" href="#_during">9.9.1.4. During</a></h5>
<div class="paragraph">
<p>The during evaluator correlates two events and matches when the current event happens during the occurrence of the event being correlated.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this during <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the $eventA starts after $eventB starts and finishes before $eventB finishes.</p>
</div>
<div class="paragraph">
<p>In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventB</span>.startTimestamp &lt; <span class="hljs-variable">$eventA</span>.startTimestamp &lt;= <span class="hljs-variable">$eventA</span>.endTimestamp &lt; <span class="hljs-variable">$eventB</span>.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The during operator accepts 1, 2 or 4 optional parameters as follow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If one value is defined, this will be the maximum distance between the start timestamp of both event and the maximum distance between the end timestamp of both events in order to operator match. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this during[ <span class="hljs-number">5</span>s ] <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-number">0</span> &lt; <span class="hljs-variable">$eventA</span>.startTimestamp - <span class="hljs-variable">$eventB</span>.startTimestamp &lt;= <span class="hljs-number">5</span>s &amp;&amp;
<span class="hljs-number">0</span> &lt; <span class="hljs-variable">$eventB</span>.endTimestamp - <span class="hljs-variable">$eventA</span>.endTimestamp &lt;= <span class="hljs-number">5</span>s</code></pre>
</div>
</div>
</li>
<li>
<p>If two values are defined, the first value will be the minimum distance between the timestamps of both events, while the second value will be the maximum distance between the timestamps of both events. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> during[ <span class="hljs-number">5</span>s, <span class="hljs-number">10</span>s ] $eventB )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-number">5</span>s &lt;= <span class="hljs-variable">$eventA</span>.startTimestamp - <span class="hljs-variable">$eventB</span>.startTimestamp &lt;= <span class="hljs-number">10</span>s &amp;&amp;
<span class="hljs-number">5</span>s &lt;= <span class="hljs-variable">$eventB</span>.endTimestamp - <span class="hljs-variable">$eventA</span>.endTimestamp &lt;= <span class="hljs-number">10</span>s</code></pre>
</div>
</div>
</li>
<li>
<p>If four values are defined, the first two values will be the minimum and maximum distances between the start timestamp of both events, while the last two values will be the minimum and maximum distances between the end timestamp of both events. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> during[ <span class="hljs-number">2</span>s, <span class="hljs-number">6</span>s, <span class="hljs-number">4</span>s, <span class="hljs-number">10</span>s ] $eventB )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-number">2</span>s &lt;= <span class="hljs-variable">$eventA</span>.startTimestamp - <span class="hljs-variable">$eventB</span>.startTimestamp &lt;= <span class="hljs-number">6</span>s &amp;&amp;
<span class="hljs-number">4</span>s &lt;= <span class="hljs-variable">$eventB</span>.endTimestamp - <span class="hljs-variable">$eventA</span>.endTimestamp &lt;= <span class="hljs-number">10</span>s</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_finishes"><a class="anchor" href="#_finishes"></a><a class="link" href="#_finishes">9.9.1.5. Finishes</a></h5>
<div class="paragraph">
<p>The finishes evaluator correlates two events and matches when the current event’s start timestamp happens after the correlated event’s start timestamp, but both end timestamps occur at the same time.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this finishes <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the $eventA starts after $eventB starts and finishes at the same time $eventB finishes.</p>
</div>
<div class="paragraph">
<p>In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventB</span>.startTimestamp &lt; <span class="hljs-variable">$eventA</span>.startTimestamp &amp;&amp;
<span class="hljs-variable">$eventA</span>.endTimestamp == <span class="hljs-variable">$eventB</span>.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The finishes evaluator accepts one optional parameter.
If it is defined, it determines the maximum distance between the end timestamp of both events in order for the operator to match.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this finishes[ <span class="hljs-number">5</span>s ] <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-variable">$eventB</span>.startTimestamp &lt; <span class="hljs-variable">$eventA</span>.startTimestamp &amp;&amp;
<span class="hljs-keyword">abs</span>( <span class="hljs-variable">$eventA</span>.endTimestamp - <span class="hljs-variable">$eventB</span>.endTimestamp ) &lt;= <span class="hljs-number">5</span><span class="hljs-keyword">s</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It makes no sense to use a negative interval value for the parameter and the engine will raise an exception if that happens.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_finished_by"><a class="anchor" href="#_finished_by"></a><a class="link" href="#_finished_by">9.9.1.6. Finished By</a></h5>
<div class="paragraph">
<p>The finishedby evaluator correlates two events and matches when the current event start timestamp happens before the correlated event start timestamp, but both end timestamps occur at the same time.
This is the symmetrical opposite of finishes evaluator.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this finishedby <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the $eventA starts before $eventB starts and finishes at the same time $eventB finishes.</p>
</div>
<div class="paragraph">
<p>In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span>.startTimestamp &lt; <span class="hljs-variable">$eventB</span>.startTimestamp &amp;&amp;
<span class="hljs-variable">$eventA</span>.endTimestamp == <span class="hljs-variable">$eventB</span>.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The finishedby evaluator accepts one optional parameter.
If it is defined, it determines the maximum distance between the end timestamp of both events in order for the operator to match.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this finishedby[ <span class="hljs-number">5</span>s ] <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-variable">$eventA</span>.startTimestamp &lt; <span class="hljs-variable">$eventB</span>.startTimestamp &amp;&amp;
<span class="hljs-keyword">abs</span>( <span class="hljs-variable">$eventA</span>.endTimestamp - <span class="hljs-variable">$eventB</span>.endTimestamp ) &lt;= <span class="hljs-number">5</span><span class="hljs-keyword">s</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It makes no sense to use a negative interval value for the parameter and the engine will raise an exception if that happens.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_includes"><a class="anchor" href="#_includes"></a><a class="link" href="#_includes">9.9.1.7. Includes</a></h5>
<div class="paragraph">
<p>The includes evaluator correlates two events and matches when the event being correlated happens during the current event.
It is the symmetrical opposite of during evaluator.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this includes <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the $eventB starts after $eventA starts and finishes before $eventA finishes.</p>
</div>
<div class="paragraph">
<p>In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span>.startTimestamp &lt; <span class="hljs-variable">$eventB</span>.startTimestamp &lt;= <span class="hljs-variable">$eventB</span>.endTimestamp &lt; <span class="hljs-variable">$eventA</span>.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The includes operator accepts 1, 2 or 4 optional parameters as follow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If one value is defined, this will be the maximum distance between the start timestamp of both event and the maximum distance between the end timestamp of both events in order to operator match. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this includes[ <span class="hljs-number">5</span>s ] <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-number">0</span> &lt; <span class="hljs-variable">$eventB</span>.startTimestamp - <span class="hljs-variable">$eventA</span>.startTimestamp &lt;= <span class="hljs-number">5</span>s &amp;&amp;
<span class="hljs-number">0</span> &lt; <span class="hljs-variable">$eventA</span>.endTimestamp - <span class="hljs-variable">$eventB</span>.endTimestamp &lt;= <span class="hljs-number">5</span>s</code></pre>
</div>
</div>
</li>
<li>
<p>If two values are defined, the first value will be the minimum distance between the timestamps of both events, while the second value will be the maximum distance between the timestamps of both events. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> includes[ <span class="hljs-number">5</span>s, <span class="hljs-number">10</span>s ] $eventB )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-number">5</span>s &lt;= <span class="hljs-variable">$eventB</span>.startTimestamp - <span class="hljs-variable">$eventA</span>.startTimestamp &lt;= <span class="hljs-number">10</span>s &amp;&amp;
<span class="hljs-number">5</span>s &lt;= <span class="hljs-variable">$eventA</span>.endTimestamp - <span class="hljs-variable">$eventB</span>.endTimestamp &lt;= <span class="hljs-number">10</span>s</code></pre>
</div>
</div>
</li>
<li>
<p>If four values are defined, the first two values will be the minimum and maximum distances between the start timestamp of both events, while the last two values will be the minimum and maximum distances between the end timestamp of both events. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> includes[ <span class="hljs-number">2</span>s, <span class="hljs-number">6</span>s, <span class="hljs-number">4</span>s, <span class="hljs-number">10</span>s ] $eventB )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-number">2</span>s &lt;= <span class="hljs-variable">$eventB</span>.startTimestamp - <span class="hljs-variable">$eventA</span>.startTimestamp &lt;= <span class="hljs-number">6</span>s &amp;&amp;
<span class="hljs-number">4</span>s &lt;= <span class="hljs-variable">$eventA</span>.endTimestamp - <span class="hljs-variable">$eventB</span>.endTimestamp &lt;= <span class="hljs-number">10</span>s</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_meets"><a class="anchor" href="#_meets"></a><a class="link" href="#_meets">9.9.1.8. Meets</a></h5>
<div class="paragraph">
<p>The meets evaluator correlates two events and matches when the current event’s end timestamp happens at the same time as the correlated event’s start timestamp.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this meets <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the $eventA finishes at the same time $eventB starts.</p>
</div>
<div class="paragraph">
<p>In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-keyword">abs</span>( <span class="hljs-variable">$eventB</span>.startTimestamp - <span class="hljs-variable">$eventA</span>.endTimestamp ) == <span class="hljs-number">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The meets evaluator accepts one optional parameter.
If it is defined, it determines the maximum distance between the end timestamp of current event and the start timestamp of the correlated event in order for the operator to match.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this meets[ <span class="hljs-number">5</span>s ] <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-keyword">abs</span>( <span class="hljs-variable">$eventB</span>.startTimestamp - <span class="hljs-variable">$eventA</span>.endTimestamp) &lt;= <span class="hljs-number">5</span><span class="hljs-keyword">s</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It makes no sense to use a negative interval value for the parameter and the engine will raise an exception if that happens.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_met_by"><a class="anchor" href="#_met_by"></a><a class="link" href="#_met_by">9.9.1.9. Met By</a></h5>
<div class="paragraph">
<p>The metby evaluator correlates two events and matches when the current event’s start timestamp happens at the same time as the correlated event’s end timestamp.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this metby <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the $eventA starts at the same time $eventB finishes.</p>
</div>
<div class="paragraph">
<p>In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-keyword">abs</span>( <span class="hljs-variable">$eventA</span>.startTimestamp - <span class="hljs-variable">$eventB</span>.endTimestamp ) == <span class="hljs-number">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The metby evaluator accepts one optional parameter.
If it is defined, it determines the maximum distance between the end timestamp of the correlated event and the start timestamp of the current event in order for the operator to match.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this metby[ <span class="hljs-number">5</span>s ] <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-keyword">abs</span>( <span class="hljs-variable">$eventA</span>.startTimestamp - <span class="hljs-variable">$eventB</span>.endTimestamp) &lt;= <span class="hljs-number">5</span><span class="hljs-keyword">s</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It makes no sense to use a negative interval value for the parameter and the engine will raise an exception if that happens.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_overlaps"><a class="anchor" href="#_overlaps"></a><a class="link" href="#_overlaps">9.9.1.10. Overlaps</a></h5>
<div class="paragraph">
<p>The overlaps evaluator correlates two events and matches when the current event starts before the correlated event starts and finishes after the correlated event starts, but before the correlated event finishes.
In other words, both events have an overlapping period.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this overlaps <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span>.startTimestamp &lt; <span class="hljs-variable">$eventB</span>.startTimestamp &lt; <span class="hljs-variable">$eventA</span>.endTimestamp &lt; <span class="hljs-variable">$eventB</span>.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The overlaps operator accepts 1 or 2 optional parameters as follow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If one parameter is defined, this will be the maximum distance between the start timestamp of the correlated event and the end timestamp of the current event. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this overlaps[ <span class="hljs-number">5</span>s ] <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span>.startTimestamp &lt; <span class="hljs-variable">$eventB</span>.startTimestamp &lt; <span class="hljs-variable">$eventA</span>.endTimestamp &lt; <span class="hljs-variable">$eventB</span>.endTimestamp &amp;&amp;
<span class="hljs-number">0</span> &lt;= <span class="hljs-variable">$eventA</span>.endTimestamp - <span class="hljs-variable">$eventB</span>.startTimestamp &lt;= <span class="hljs-number">5</span>s</code></pre>
</div>
</div>
</li>
<li>
<p>If two values are defined, the first value will be the minimum distance and the second value will be the maximum distance between the start timestamp of the correlated event and the end timestamp of the current event. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> overlaps[ <span class="hljs-number">5</span>s, <span class="hljs-number">10</span>s ] $eventB )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span>.startTimestamp &lt; <span class="hljs-variable">$eventB</span>.startTimestamp &lt; <span class="hljs-variable">$eventA</span>.endTimestamp &lt; <span class="hljs-variable">$eventB</span>.endTimestamp &amp;&amp;
<span class="hljs-number">5</span>s &lt;= <span class="hljs-variable">$eventA</span>.endTimestamp - <span class="hljs-variable">$eventB</span>.startTimestamp &lt;= <span class="hljs-number">10</span>s</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_overlapped_by"><a class="anchor" href="#_overlapped_by"></a><a class="link" href="#_overlapped_by">9.9.1.11. Overlapped By</a></h5>
<div class="paragraph">
<p>The overlappedby evaluator correlates two events and matches when the correlated event starts before the current event starts and finishes after the current event starts, but before the current event finishes.
In other words, both events have an overlapping period.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this overlappedby <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventB</span>.startTimestamp &lt; <span class="hljs-variable">$eventA</span>.startTimestamp &lt; <span class="hljs-variable">$eventB</span>.endTimestamp &lt; <span class="hljs-variable">$eventA</span>.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The overlappedby operator accepts 1 or 2 optional parameters as follow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If one parameter is defined, this will be the maximum distance between the start timestamp of the current event and the end timestamp of the correlated event. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this overlappedby[ <span class="hljs-number">5</span>s ] <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventB</span>.startTimestamp &lt; <span class="hljs-variable">$eventA</span>.startTimestamp &lt; <span class="hljs-variable">$eventB</span>.endTimestamp &lt; <span class="hljs-variable">$eventA</span>.endTimestamp &amp;&amp;
<span class="hljs-number">0</span> &lt;= <span class="hljs-variable">$eventB</span>.endTimestamp - <span class="hljs-variable">$eventA</span>.startTimestamp &lt;= <span class="hljs-number">5</span>s</code></pre>
</div>
</div>
</li>
<li>
<p>If two values are defined, the first value will be the minimum distance and the second value will be the maximum distance between the start timestamp of the current event and the end timestamp of the correlated event. Example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$eventA : EventA( <span class="hljs-keyword">this</span> overlappedby[ <span class="hljs-number">5</span>s, <span class="hljs-number">10</span>s ] $eventB )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventB</span>.startTimestamp &lt; <span class="hljs-variable">$eventA</span>.startTimestamp &lt; <span class="hljs-variable">$eventB</span>.endTimestamp &lt; <span class="hljs-variable">$eventA</span>.endTimestamp &amp;&amp;
<span class="hljs-number">5</span>s &lt;= <span class="hljs-variable">$eventB</span>.endTimestamp - <span class="hljs-variable">$eventA</span>.startTimestamp &lt;= <span class="hljs-number">10</span>s</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_starts"><a class="anchor" href="#_starts"></a><a class="link" href="#_starts">9.9.1.12. Starts</a></h5>
<div class="paragraph">
<p>The starts evaluator correlates two events and matches when the current event’s end timestamp happens before the correlated event’s end timestamp, but both start timestamps occur at the same time.</p>
</div>
<div class="paragraph">
<p>Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this starts <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the $eventA finishes before $eventB finishes and starts at the same time $eventB starts.</p>
</div>
<div class="paragraph">
<p>In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span>.startTimestamp == <span class="hljs-variable">$eventB</span>.startTimestamp &amp;&amp;
<span class="hljs-variable">$eventA</span>.endTimestamp &lt; <span class="hljs-variable">$eventB</span>.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The starts evaluator accepts one optional parameter.
If it is defined, it determines the maximum distance between the start timestamp of both events in order for the operator to match.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this starts[ <span class="hljs-number">5</span>s ] <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-keyword">abs</span>( <span class="hljs-variable">$eventA</span>.startTimestamp - <span class="hljs-variable">$eventB</span>.startTimestamp ) &lt;= <span class="hljs-number">5</span><span class="hljs-keyword">s</span> &amp;&amp;
<span class="hljs-variable">$eventA</span>.endTimestamp &lt; <span class="hljs-variable">$eventB</span>.endTimestamp</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It makes no sense to use a negative interval value for the parameter and the engine will raise an exception if that happens.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_started_by"><a class="anchor" href="#_started_by"></a><a class="link" href="#_started_by">9.9.1.13. Started By</a></h5>
<div class="paragraph">
<p>The startedby evaluator correlates two events and matches when the correlating event’s end timestamp happens before the current event’s end timestamp, but both start timestamps occur at the same time.
Lets look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this startedby <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous pattern will match if and only if the $eventB finishes before $eventA finishes and starts at the same time $eventB starts.</p>
</div>
<div class="paragraph">
<p>In other words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span>.startTimestamp == <span class="hljs-variable">$eventB</span>.startTimestamp &amp;&amp;
<span class="hljs-variable">$eventA</span>.endTimestamp &gt; <span class="hljs-variable">$eventB</span>.endTimestamp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The startedby evaluator accepts one optional parameter.
If it is defined, it determines the maximum distance between the start timestamp of both events in order for the operator to match.
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$eventA</span> : EventA( this starts[ <span class="hljs-number">5</span>s ] <span class="hljs-variable">$eventB</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will match if and only if:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-keyword">abs</span>( <span class="hljs-variable">$eventA</span>.startTimestamp - <span class="hljs-variable">$eventB</span>.startTimestamp ) &lt;= <span class="hljs-number">5</span><span class="hljs-keyword">s</span> &amp;&amp;
<span class="hljs-variable">$eventA</span>.endTimestamp &gt; <span class="hljs-variable">$eventB</span>.endTimestamp</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It makes no sense to use a negative interval value for the parameter and the engine will raise an exception if that happens.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="drools.DMN"><a class="anchor" href="#drools.DMN"></a><a class="link" href="#drools.DMN">10. Decision Model and Notation</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="decision_model_and_notation_overview"><a class="anchor" href="#decision_model_and_notation_overview"></a><a class="link" href="#decision_model_and_notation_overview">10.1. Decision Model and Notation</a></h3>
<div class="paragraph">
<p>The <a href="http://www.omg.org/spec/DMN/1.1"><strong>Decision Model and Notation</strong></a>, or <strong>DMN</strong>, is a relatively new standard by the <a href="http://www.omg.org/"><strong>Object Management Group</strong></a>, or <strong>OMG</strong>.
It bridges the gap between business models and executable implementations by defining a high level language with a common notation that is readily understandable
by users across the business, from analysts to developers.</p>
</div>
<div class="paragraph">
<p>The actual specification builds on the experience acquired defining the <strong>Business Process Model and Notation</strong>, or <strong>BPMN</strong>, it’s sibling specification, that is used to model
Business Processes. Interoperability and seamless integration between BPMN and DMN is also a goal of the specification.</p>
</div>
<div class="sect3">
<h4 id="dmn_conformance_levels"><a class="anchor" href="#dmn_conformance_levels"></a><a class="link" href="#dmn_conformance_levels">10.1.1. Conformance Levels</a></h4>
<div class="paragraph">
<p>The DMN specification defines three incremental levels of conformance. For the formal definition of each conformance level, please refer to the
<a href="http://www.omg.org/spec/DMN/1.1"><strong>DMN 1.1 specification, page 9</strong></a>. Here is an informal way of understanding the compliance levels:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Conformance Level 1</dt>
<dd>
<p>A conformance level 1 implementation is required to support Decision Requirement Diagrams, Decision Logic, and Decision Tables, but the model does not need to be executable.
Any language can be used to define the expressions, including natural, unstructured languages.</p>
</dd>
<dt class="hdlist1">Conformance Level 2</dt>
<dd>
<p>A conformance level 2 implementation is required to support the same as Conformance Level 1, but expressions should be written using the <strong>S-FEEL</strong> (<em>Simplified FEEL</em>) language,
as defined in chapter 9 of the specification and the models should be fully executable.</p>
</dd>
<dt class="hdlist1">Conformance Level 3</dt>
<dd>
<p>A conformance level 3 implementation is required to support the same as Conformance Level 2, but expressions can be written using the full <strong>FEEL</strong> language, as defined in chapter
10 of the specification. The implementation also has to support the full set of boxed expressions and be fully executable.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="executing_decision_services_from_kie_container"><a class="anchor" href="#executing_decision_services_from_kie_container"></a><a class="link" href="#executing_decision_services_from_kie_container">10.2. Executing DMN services embedded in the application</a></h3>
<div class="paragraph">
<p>This section explains how to interact with a Kie Container in order to execute decision services for the DMN models.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>a KJAR containing the DMN model to be executed</p>
</li>
<li>
<p>the following dependencies are required:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-ci<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-dmn-core<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Kie Container, either from ReleaseId or classpath:</p>
<div class="paragraph">
<p>The following snippet provides a basic example:</p>
</div>
<div class="listingblock">
<div class="title">Creating a Kie Container from ReleaseId</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

ReleaseId releaseId = kieServices.newReleaseId( <span class="hljs-string">"org.acme"</span>, <span class="hljs-string">"my-kjar"</span>, <span class="hljs-string">"1.0.0"</span> );
KieContainer kieContainer = kieServices.newKieContainer( releaseId );</code></pre>
</div>
</div>
<div class="paragraph">
<p>or alternatively:</p>
</div>
<div class="listingblock">
<div class="title">Creating a Kie Container from classpath</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieServices kieServices = KieServices.Factory.get();

KieContainer kieContainer = kieServices.getKieClasspathContainer();</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
in case the Kie Container is created from the classpath, the dependency <code>kie-ci</code> is not required.
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>Obtain <code>DMNRuntime</code> from the Kie Container, and in turn a reference to the DMN model to be evaluated, by using the <em>model namespace</em> and <em>model name</em>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNRuntime dmnRuntime = kieContainer.newKieSession().getKieRuntime( DMNRuntime.class );

DMNModel dmnModel = dmnRuntime.getModel(
        <span class="hljs-string">"https://github.com/kiegroup/kie-dmn/input-data-string"</span>,  <span class="hljs-comment">// model namespace</span>
        <span class="hljs-string">"input-data-string"</span>                                       <span class="hljs-comment">// model name</span>
        );</code></pre>
</div>
</div>
</li>
<li>
<p>Execute the decision services for the desired model</p>
<div class="paragraph">
<p>The following snippet provides a basic example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNContext dmnContext = dmnRuntime.newContext();  <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
dmnContext.set( <span class="hljs-string">"Full Name"</span>, <span class="hljs-string">"John Doe"</span> );        <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>

DMNResult dmnResult = dmnRuntime.evaluateAll( dmnModel, dmnContext );  <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>

<span class="hljs-keyword">for</span> ( DMNDecisionResult dr : dmnResult.getDecisionResults() ) {
    System.out.println( <span class="hljs-string">"Decision '"</span> + dr.getDecisionName() + <span class="hljs-string">"' : "</span> + dr.getResult() );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instantiate a new DMN Context to be the input for the model evaluation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assign input variables for the input DMN Context</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Evaluate all the DMN Decisions defined in the DMN model; the DMN Result contains the result of all the evluations</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>and would print the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">Decision</span> <span class="hljs-string">'Greeting Message'</span> : Hello John Doe</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to cycle over all the evaluations, in order to get the result for each decision respectively as shown in the example</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Related Information</div>
<ul>
<li>
<p>For creating a KJAR and for creating a Kie Container, reference "Build, Deploy, Utilize and Run". Ref. <a href="#_builddeployutilizeandrunsection">Build, Deploy, Utilize and Run</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="executing_decision_services_on_the_kie_execution_server"><a class="anchor" href="#executing_decision_services_on_the_kie_execution_server"></a><a class="link" href="#executing_decision_services_on_the_kie_execution_server">10.3. Executing DMN services remotely on the Kie Server</a></h3>
<div class="paragraph">
<p>This section explain how to interact with a Kie Container deployed on a Kie Execution Server, in order to execute decision services for the DMN models available inside the Kie Container.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Kie Execution Server installed and configured</p>
</li>
<li>
<p>a Kie Container deployed in the Kie Execution Server, for a KJAR containing the DMN model to be executed</p>
</li>
<li>
<p>a Kie Server Java Client connected to the related Kie Execution Server</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Obtain a DMNServicesClient from the Kie Server Java Client connected to the related Kie Execution Server</p>
<div class="paragraph">
<p>This can be obtained invoking the method <code>getServicesClient()</code> on the Kie Server Java client instance, as shown in the following snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNServicesClient dmnClient = kieServicesClient.getServicesClient( DMNServicesClient.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>dmnClient</code> can now be used to execute decision services on the Kie Execution Server.</p>
</div>
</li>
<li>
<p>Execute the decision services for the desired model</p>
<div class="paragraph">
<p>The following snippet provides a basic example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DMNContext dmnContext = dmnClient.newContext();   <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
dmnContext.set( <span class="hljs-string">"Full Name"</span>, <span class="hljs-string">"John Doe"</span> );        <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>

ServiceResponse&lt;DMNResult&gt; serverResp = dmnClient.evaluateAll($containerId, <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b>
        $modelnamespace, $modelname,
        dmnContext);

DMNResult dmnResult = serverResp.getResult();     <i class="conum" data-value="4"></i><b>(<span class="hljs-number">4</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Instantiate a new DMN Context to be the input for the model evaluation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assign input variables for the input DMN Context</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Evaluate all the DMN Decisions defined in the DMN model</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The DMN Result object is available from the server response</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>where <code>$containerId</code> is the ID of the container where the kjar containing the DMN model is deployed,
<code>$modelnamespace</code> the namespace for the model,
<code>$modelname</code> is the name for the model.</p>
</div>
<div class="paragraph">
<p>At this point, the <code>dmnResult</code> contains all the decision results from the evaluated DMN model.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is possible to execute only a specific DMN Decision in the model, by making use of alternative methods of the <code>DMNServicesClient</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the Kie Container contains 1 and only 1 DMN Model, it is possible to omit <code>$modelnamespace</code> and <code>$modelname</code>; the only model available will be the one referenced by default in order to execute the decision services.
</td>
</tr>
</tbody></table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Related Information</div>
<ul>
<li>
<p>Installing the KIE Server. Ref. <a href="#_installing_the_kie_server">Installing the KIE Server</a></p>
</li>
<li>
<p>Creating a Kie Container. Ref. <a href="#_creating_a_kie_container">Creating a Kie Container</a></p>
</li>
<li>
<p>Kie Server Java Client API, describes also the required dependencies. Ref. <a href="#_kie_server_java_client_api">Kie Server Java Client API</a></p>
</li>
<li>
<p>Available Clients for the Decision Server. Ref. <a href="#_available_clients_for_the_decision_server">Available Clients for the Decision Server</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="feel_language_reference"><a class="anchor" href="#feel_language_reference"></a><a class="link" href="#feel_language_reference">10.4. FEEL Language Reference</a></h3>
<div class="paragraph">
<p>Friendly Enough Expression Language (FEEL) is an expression language defined by the DMN specification. Any user capable of authoring expressions in a spreadsheet can easily write FEEL expressions.</p>
</div>
<div class="paragraph">
<p>DMN completely defines the semantics of FEEL execution. Any expression that does not invoke externally defined functions should produce the exact same result in any compliant implementation. The FEEL language is side-effect free and any externally defined function should be side-effect free as well.</p>
</div>
<div class="sect3">
<h4 id="feel_language_reference_semantics"><a class="anchor" href="#feel_language_reference_semantics"></a><a class="link" href="#feel_language_reference_semantics">10.4.1. FEEL Language Semantics</a></h4>
<div class="sect4">
<h5 id="feel_semantics_names"><a class="anchor" href="#feel_semantics_names"></a><a class="link" href="#feel_semantics_names">10.4.1.1. Variable and Function Names</a></h5>
<div class="paragraph">
<p>One of the biggest differences between FEEL and traditional languages is the support for
spaces and a few special characters as part of variable and function names in FEEL.</p>
</div>
<div class="paragraph">
<p>A FEEL name must start with a <code>letter</code>, <code>?</code> or <code>_</code>. The unicode letter characters are also allowed.
The remaining characters in the name can be any of the starting characters, as well as <code>digits</code>,
white spaces, and special characters like <code>+</code>, <code>-</code>, <code>/</code>, <code>*</code>, <code>'</code> and <code>.</code>. The following names are all valid
FEEL names:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Age</p>
</li>
<li>
<p>Birth Date</p>
</li>
<li>
<p>Flight 234 pre-check procedure</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that, a variable name can not start with a language keyword, like <code>and</code>, <code>true</code>, <code>every</code>, etc.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Ambiguity</div>
<div class="paragraph">
<p>The use of spaces, keywords and other special characters as part of names makes the language
ambiguous. The ambiguities are resolved in the context of the expression, matching names from
left to right. The parser resolves the variable name as the longest name matched in scope.
The user can use <code>( )</code> to disambiguate names if necessary.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Spaces in Names</div>
<div class="paragraph">
<p>The specification limits the use of spaces in FEEL names. According to the specification,
names can contain multiple spaces as long as there are no two consecutive spaces.</p>
</div>
<div class="paragraph">
<p>The use of spaces in names makes expressions easier to read for non-technical users, However, this
might lead to problems that are difficult to find. For instance, it might be difficult for a user to visually
distinguish one space from two consecutive spaces.</p>
</div>
<div class="paragraph">
<p>In order to make the language easier to use and avoid common errors due to spaces, Drools
removed the limitation on the use of consecutive spaces. Instead, Drools supports variable
names with any number of consecutive spaces, but normalizes them into a single space. For
instance, the two variable references <code>First Name</code> and <code>First  Name</code> are equivalent.</p>
</div>
<div class="paragraph">
<p>Drools also normalizes the use of other white spaces, like the <code>non-breakable white space</code> that
is common in web pages (html), tabs, and line breaks. From a Drools FEEL engine perspective,
all of these characters are normalized into a single white space before processing.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">The keyword <code>in</code></div>
<div class="paragraph">
<p>The keyword <code>in</code> is the only keyword in the language that <strong>cannot</strong> be used as part of a variable
name. Although the specifications allow the use of keywords in the middle of variable names, the
use of <code>in</code> in variable names conflicts with the grammar definition of <code>for</code>, <code>every</code> and <code>some</code>
expression constructs.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes"><a class="anchor" href="#feel_semantics_datatypes"></a><a class="link" href="#feel_semantics_datatypes">10.4.1.2. Data Types</a></h5>
<div class="paragraph">
<p>FEEL explicitly defines several built-in data types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesNumber-section.html#feel_semantics_datatypes_number">number</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesString-section.html#feel_semantics_datatypes_string">string</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesBoolean-section.html#feel_semantics_datatypes_boolean">boolean</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesDate-section.html#feel_semantics_datatypes_date">date</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesTime-section.html#feel_semantics_datatypes_time">time</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesDateTime-section.html#feel_semantics_datatypes_datetime">date and time</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesDateTime-section.html#feel_semantics_datatypes_daystimeduration">days and time duration</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesDateTime-section.html#feel_semantics_datatypes_yearsmonthsduration">years and month duration</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FEEL also implicitly defines a few other built-in data types. These types are not a
consensus between different implementations but are supported by Drools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesDateTime-section.html#feel_semantics_datatypes_function">function</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesDateTime-section.html#feel_semantics_datatypes_context">context</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesDateTime-section.html#feel_semantics_datatypes_range">range</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesDateTime-section.html#feel_semantics_datatypes_range">list</a></p>
</li>
<li>
<p>unary test</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_number"><a class="anchor" href="#feel_semantics_datatypes_number"></a><a class="link" href="#feel_semantics_datatypes_number">10.4.1.3. Numbers</a></h5>
<div class="paragraph">
<p>Numbers in FEEL are based on the <a href="http://ieeexplore.ieee.org/document/4610935/">IEEE 754-2008</a> Decimal 128
format, with 34 digits of precision. Internally they are represented in Java as
<a href="https://docs.oracle.com/javase/8/docs/api/java/math/BigDecimal.html"><code>BigDecimals</code></a> with MathContext DECIMAL128.
There is only one "type" of numbers in FEEL, so the same type is used to represent both integers and floating
point numbers.</p>
</div>
<div class="paragraph">
<p>FEEL numbers use '.' (dot) as its decimal separator. There is no support for <code>-INF</code>, <code>+INF</code> or <code>NaN</code>. FEEL uses
<code>null</code> to represent invalid numbers.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Additional Supported Number Syntaxes</div>
<div class="paragraph">
<p>Drools extends the specification and supports additional number notations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>scientific</strong>: scientific notation can be used with the sufix <code>e&lt;exp&gt;</code> or <code>E&lt;exp&gt;</code>. E.g.: <code>1.2e3</code> is the same as writing the
expression <code>1.2*10**3</code> , but it is a literal instead of an expression.</p>
</li>
<li>
<p><strong>hexadecimal</strong>: hexadecimal numbers can be written using the preffix <code>0x</code>. E.g: <code>0xff</code> is the same as the decimal
number 255. Both uppercase and lowercase letters are supported. E.g.: <code>0XFF</code> is the same as <code>0xff</code>.</p>
</li>
<li>
<p><strong>type suffixes</strong>: type suffixes <code>f</code>, <code>F, `d</code>, <code>D</code>, <code>l</code> and <code>L</code> are supported, but ignored.</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_string"><a class="anchor" href="#feel_semantics_datatypes_string"></a><a class="link" href="#feel_semantics_datatypes_string">10.4.1.4. Strings</a></h5>
<div class="paragraph">
<p>Strings in FEEL are any sequence of characters delimited by double quotes. For example, <code>"John Doe"</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_boolean"><a class="anchor" href="#feel_semantics_datatypes_boolean"></a><a class="link" href="#feel_semantics_datatypes_boolean">10.4.1.5. Boolean Values</a></h5>
<div class="paragraph">
<p>FEEL uses the literal symbols <code>true</code> and <code>false</code> to represent boolean values.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
FEEL uses 3-valued boolean logic, so a boolean logic expression may have results
 <code>true</code>, <code>false</code> or <code>null</code>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_date"><a class="anchor" href="#feel_semantics_datatypes_date"></a><a class="link" href="#feel_semantics_datatypes_date">10.4.1.6. Dates</a></h5>
<div class="paragraph">
<p>FEEL does not have date literals, but the built-in <code>date()</code> function can be used to construct
date values. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-keyword">date</span>( <span class="hljs-string">"2017-06-23"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The date strings in FEEL follow the format defined in the <a href="https://www.w3.org/TR/xmlschema-2/#date">XML Schema Part 2 Datatypes</a>
document. The format is <code>"YYYY-MM-DD"</code> where <code>YYYY</code> is the year with 4 digits, <code>MM</code> is the number of the month with
2 digits (such as January is 01, February is 02), and <code>DD</code> is the number of the day.</p>
</div>
<div class="paragraph">
<p>Date objects have time part equal to <code>"00:00:00"</code>, which is midnight. The dates are considered to be local, without a timezone.</p>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_time"><a class="anchor" href="#feel_semantics_datatypes_time"></a><a class="link" href="#feel_semantics_datatypes_time">10.4.1.7. Time</a></h5>
<div class="paragraph">
<p>FEEL does not have time literals, but the built-in <code>time()</code> function can be used to construct
time values. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">time</span>( "04<span class="hljs-pseudo">:25</span><span class="hljs-pseudo">:12"</span> )
<span class="hljs-tag">time</span>( "14<span class="hljs-pseudo">:10</span><span class="hljs-pseudo">:00+02</span><span class="hljs-pseudo">:00"</span> )
<span class="hljs-tag">time</span>( "22<span class="hljs-pseudo">:35</span><span class="hljs-pseudo">:40</span><span class="hljs-class">.345-05</span><span class="hljs-pseudo">:00"</span> )
<span class="hljs-tag">time</span>( "15<span class="hljs-pseudo">:00</span><span class="hljs-pseudo">:30z"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Time strings in FEEL follow the format defined in the <a href="https://www.w3.org/TR/xmlschema-2/#time">XML Schema Part 2 Datatypes</a>
document. I.e., the format is <code>"hh:mm:ss[.uuu][(+-)hh:mm]"</code> where <code>hh</code> is the hour of the day (from 00 to 24), <code>mm</code> is the
minutes in the hour and <code>ss</code> is the number of seconds in the minute. Optionally, the string may define the
number of milliseconds (<code>uuu</code>) within the second and/or contain a positive (<code>+</code>)
or negative (<code>-</code>) offset from UTC time to define it’s timezone.  Instead of an offset, the letter "z" can be
used to represent the UTC time, that is same as offset -00:00. If no offset is defined, the time is considered
to be local.</p>
</div>
<div class="paragraph">
<p>Time values that define an offset/timezone cannot be compared to local times that do not define an offset/timezone.</p>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_datetime"><a class="anchor" href="#feel_semantics_datatypes_datetime"></a><a class="link" href="#feel_semantics_datatypes_datetime">10.4.1.8. Date and Time</a></h5>
<div class="paragraph">
<p>FEEL does not have <em>date and time</em> literals, but the built-in <code>date and time()</code> function can be used to construct
<em>date and time</em> values. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">date <span class="hljs-keyword">and</span> <span class="hljs-keyword">time</span>( <span class="hljs-string">"2017-10-22T23:59:00"</span> )
date <span class="hljs-keyword">and</span> <span class="hljs-keyword">time</span>( <span class="hljs-string">"2017-06-13T14:10:00+02:00"</span> )
date <span class="hljs-keyword">and</span> <span class="hljs-keyword">time</span>( <span class="hljs-string">"2017-02-05T22:35:40.345-05:00"</span> )
date <span class="hljs-keyword">and</span> <span class="hljs-keyword">time</span>( <span class="hljs-string">"2017-06-13T15:00:30z"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Date and Time</em> strings in FEEL follow the format defined in the
<a href="https://www.w3.org/TR/xmlschema-2/#dateTime">XML Schema Part 2 Datatypes</a>document. The format is a
<em>date</em> string and a <em>time</em> concatenated with a character "T" dividing the <em>date</em> part from the <em>time</em> part. See
the sections in <em><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesDate-section.html#feel_semantics_datatypes_date">FEEL date</a></em> and
<em><a href="https://docs.jboss.org/drools/release/7.7.0.Final/drools-docs/html_single/FEELDataTypesTime-section.html#feel_semantics_datatypes_time">FEEL time</a></em> for details.</p>
</div>
<div class="paragraph">
<p><em>Date and Time</em> values that define an offset/timezone cannot be compared to local <em>date and time</em> values
that do not define an offset/timezone.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
the keyword <code>dateTime</code> is a synonym of <code>date and time</code>. It is useful when defining a <em>date and time</em>
variable in DMN, as the XML schema does not support type names that contain spaces.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_daystimeduration"><a class="anchor" href="#feel_semantics_datatypes_daystimeduration"></a><a class="link" href="#feel_semantics_datatypes_daystimeduration">10.4.1.9. Days and Time Duration</a></h5>
<div class="paragraph">
<p>FEEL does not have <em>days and time duration</em> literals, but the built-in <code>duration()</code> function can be used to construct
<em>days and time duration</em> values. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-keyword">duration</span>( <span class="hljs-string">"P1DT23H12M30S"</span> )
<span class="hljs-keyword">duration</span>( <span class="hljs-string">"P23D"</span> )
<span class="hljs-keyword">duration</span>( <span class="hljs-string">"PT12H"</span> )
<span class="hljs-keyword">duration</span>( <span class="hljs-string">"PT35M"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Days and Time Duration</em> strings in FEEL follow the format defined in the
<a href="https://www.w3.org/TR/xmlschema-2/#duration">XML Schema Part 2 Datatypes</a> document, but restricted to only days,
hours, minutes and seconds. Months and years are not allowed.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The keyword <code>dayTimeDuration</code> is a synonym of <code>days and time duration</code>. It is useful when defining a
<em>days and time duration</em> variable in DMN, as the XML schema does not support type names that contain spaces.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_yearsmonthsduration"><a class="anchor" href="#feel_semantics_datatypes_yearsmonthsduration"></a><a class="link" href="#feel_semantics_datatypes_yearsmonthsduration">10.4.1.10. Years and Months Duration</a></h5>
<div class="paragraph">
<p>FEEL does not have <em>years and months duration</em> literals, but the built-in <code>duration()</code> function can be used to construct
<em>days and time duration</em> values. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-keyword">duration</span>( <span class="hljs-string">"P3Y5M"</span> )
<span class="hljs-keyword">duration</span>( <span class="hljs-string">"P2Y"</span> )
<span class="hljs-keyword">duration</span>( <span class="hljs-string">"P10M"</span> )
<span class="hljs-keyword">duration</span>( <span class="hljs-string">"P25M"</span> )</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Years and Months Duration</em> strings in FEEL follow the format defined in the
<a href="https://www.w3.org/TR/xmlschema-2/#duration">XML Schema Part 2 Datatypes</a> document, but restricted to only years and
months. Days, hours, minutes, or seconds are not allowed.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The keyword <code>yearMonthDuration</code> is a synonym of <code>years and months duration</code>. It is useful when defining a
<em>years and months duration</em> variable in DMN, as the XML schema does not support type names that contain spaces.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_function"><a class="anchor" href="#feel_semantics_datatypes_function"></a><a class="link" href="#feel_semantics_datatypes_function">10.4.1.11. Functions</a></h5>
<div class="paragraph">
<p>FEEL allows the creation of functions through function literals (or anonymous functions). For example, the following
FEEL expression creates a function that adds the parameters <code>a</code> and <code>b</code> and returns the result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) <span class="hljs-title">a</span> + <span class="hljs-title">b</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no explicit way of declaring a variable as a <code>function</code> in the DMN specification. Drools extends the
DMN built-in types with the function type for that reason.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
A <code>function</code> datatype is an extension of the specification and is subject to change if the DMN specification
provides a standard way to declare functions in the future.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_context"><a class="anchor" href="#feel_semantics_datatypes_context"></a><a class="link" href="#feel_semantics_datatypes_context">10.4.1.12. Contexts</a></h5>
<div class="paragraph">
<p>FEEL allows creating contexts through <code>context literals</code>. A <code>context</code> in FEEL is a list of key/value pairs,
similar to Maps in languages like Java. For example, the following literal expression creates a context with two entries,
x and y, representing a coordinate in a chart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">x </span>:<span class="hljs-value"> <span class="hljs-number">5</span>, y : <span class="hljs-number">3</span> </span></span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no explicit way of declaring a variable as a <code>context</code> in the DMN specification. Drools extends the
DMN built-in types with the <code>context</code> type for that reason.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
A <code>context</code> datatype is an extension of the specification and is subject to change if the DMN specification
provides a standard way to declare contexts in the future. In DMN 1.1, the recommended way of declaring contexts is to
create an item definition that contains the list of keys as attributes, and then declare the variable as having that
item definition type.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_range"><a class="anchor" href="#feel_semantics_datatypes_range"></a><a class="link" href="#feel_semantics_datatypes_range">10.4.1.13. Ranges (or Intervals)</a></h5>
<div class="paragraph">
<p>FEEL allows the creation of ranges, also known as intervals, through <code>range literals</code>. A <code>range</code> in FEEL is a
value that defines a lower and an upper bound, where either can be open or closed. The syntax of a range is defined
as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs makefile"><span class="hljs-constant">range</span>          := interval_start endpoint '..' endpoint interval_end
<span class="hljs-constant">interval_start</span> := open_start | closed_start
<span class="hljs-constant">open_start</span>     := '(' | ']'
<span class="hljs-constant">closed_start</span>   := '['
<span class="hljs-constant">interval_end</span>   := open_end | closed_end
<span class="hljs-constant">open_end</span>       := ')' | '['
<span class="hljs-constant">closed_end</span>     := ']'
<span class="hljs-constant">endpoint</span>       := expression</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression for the endpoint must return a comparable value, and the lower bound endpoint must be lower than the
upper bound endpoint.</p>
</div>
<div class="paragraph">
<p>For instance, the following literal expression defines an interval between 1 and 10, including the boundaries (that is,
a closed interval on both endpoints):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">[ <span class="hljs-number">1</span> .. <span class="hljs-number">10</span> ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following literal expression defines an interval between 1 hour and 12 hours, including the lower boundary (that is,
a closed interval), but excluding the upper boundary (an open interval):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">[ duration(<span class="hljs-string">"PT1H"</span>) .. duration(<span class="hljs-string">"PT12H"</span>) [</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ranges are specially useful in decision tables when testing for ranges of value, but can also be used in simple
literal expressions. For instance, the following literal expression returns true if the value of a variable x is
between 0 and 100:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">x in [ <span class="hljs-number">1</span> .. <span class="hljs-number">100</span> ]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
A range literal is not a valid expression in the FEEL specification. It has to always be contained within
 other expressions. Drools extends the specification and allows range values to be defined directly and even assigned
 to variables.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="feel_semantics_datatypes_list"><a class="anchor" href="#feel_semantics_datatypes_list"></a><a class="link" href="#feel_semantics_datatypes_list">10.4.1.14. Lists</a></h5>
<div class="paragraph">
<p>Lists in FEEL are represented by a comma separated list of values enclosed in square brackets. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">[ <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span> ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>All lists in FEEL are homogeneous (that is, all elements in a list are of the same type) and immutable. Elements in a list
can be accessed by index, where the first element is 1. Negative indexes can be used to access elements starting from the
end of the list, so -1 is the last element. For instance, the following expression returns the second element of a list x:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">x[<span class="hljs-number">2</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression returns the second to last element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">x[-<span class="hljs-number">2</span>]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The DMN specification does not allow a variable to be defined as a generic list type. Drools extends the
specification to support that.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dmn_support_in_drools"><a class="anchor" href="#dmn_support_in_drools"></a><a class="link" href="#dmn_support_in_drools">10.5. DMN Support in Drools</a></h3>
<div class="paragraph">
<p>Drools 7.0 includes full runtime support for DMN 1.1 models at <strong>conformance level 3</strong>. It does not, however, include any editor for DMN models. Editors for DMN models will be
added to the platform in the near future, but meanwhile we recommend looking at one of several DMN compliant editors available in the market.</p>
</div>
<div class="paragraph">
<p>From a platform perspective, DMN models are just another type of asset that can be included in a Drools kjar and deployed to the runtime. It means that Drool 7.0 can consume and
execute DMN models as well as any of the other supported assets (such as DRL files and native decision tables) from the same kjar. This enables users to always use the best tool for
the job at hand. In fact, it is common to have BPMN models directly invoke DMN decision services from their decision task nodes.</p>
</div>
<div class="sect3">
<h4 id="dmn_support_in_drools_details"><a class="anchor" href="#dmn_support_in_drools_details"></a><a class="link" href="#dmn_support_in_drools_details">10.5.1. DMN Implementation Details</a></h4>
<div class="paragraph">
<p>The DMN specification defines both syntax and semantic for the models. Note that, there are a few bugs and ambiguities in the specifications. At the moment, there is no Technology Compatibility Kit (TCK) or official reference implementation for DMN v1.1, to resolve these ambiguities. A vendor neutral effort for a TCK is available <a href="https://agilepro.github.io/dmn-tck/index.html">here</a>.</p>
</div>
<div class="paragraph">
<p>Drools strives to be as compliant as possible with the specification, however the following categories of differences exist:
* Fixes to bugs in the specification, and
* Extensions to the specification to better support use cases, without prejudice to strict models.</p>
</div>
<div class="paragraph">
<p>The differences are also categorized between the FEEL language differences and the DMN model differences.</p>
</div>
<div class="sect4">
<h5 id="_a_fixes_to_bugs_and_changes_in_the_feel_language"><a class="anchor" href="#_a_fixes_to_bugs_and_changes_in_the_feel_language"></a><a class="link" href="#_a_fixes_to_bugs_and_changes_in_the_feel_language">10.5.1.1. a. Fixes to bugs and changes in the FEEL language</a></h5>
<div class="ulist">
<ul>
<li>
<p><em>Space Sensitivity</em>: This implementation of the FEEL language is space <strong><em>insensitive</em></strong>. The goal is to avoid
non-deterministic behavior based on the context and differences in behavior based on invisible characters (For example,
 white spaces). This means that for this implementation, a variable named <code>first name</code> with one space is exactly
 the same as <code>first  name</code> with two spaces in it.</p>
</li>
<li>
<p><em>List functions <code>or()</code> and <code>and()</code> </em>: The specification defines two list functions named <code>or()</code> and <code>and()</code>. However,
according to the FEEL grammar, these are not valid function names, as <code>and</code> and <code>or</code> are reserved keywords.
 This implementation renames these functions to <code>any()</code> and <code>all()</code> respectively, in anticipation for DMN 1.2.</p>
</li>
<li>
<p><em>Keyword <code>in</code> can not be used in variable names</em>: The specification defines that any keyword can be reused as part
of a variable name, but the ambiguities caused with the <code>for …​ in …​ return</code> loop prevent the reuse of the <code>in</code>
keyword. All other keywords are supported as part of variable names.</p>
</li>
<li>
<p><em>Support for date and time literals on ranges</em>: According to the grammar rules #8, #18, #19, #34 and #62, <code>date
and time</code> literals are supported in ranges (pages 110-111). Chapter 10.3.2.7 on page 114, on the other hand, contradicts
the grammar and says they are not supported. This implementation chose to follow the grammar and support <code>date and
time</code> literals on ranges, as well as extend the specification to support any arbitrary expression (see extensions below).</p>
</li>
<li>
<p><em>Invalid time syntax</em>: Chapter 10.3.2.3.4 on page 112 and bullet point about <code>time</code> on page 131 both state that
the <code>time</code> string lexical representation follows the XML Schema Datatypes specification as well as ISO 8601. According
to the XML Schema specification (<a href="https://www.w3.org/TR/xmlschema-2/#time" class="bare">https://www.w3.org/TR/xmlschema-2/#time</a>), the lexical representation of a time follows
the pattern <code>hh:mm:ss.sss</code> without any leading character. The DMN specification uses a leading "T" in several examples,
that we understand is a typo and not in accordance with the standard.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_b_extensions_to_the_feel_language_specification"><a class="anchor" href="#_b_extensions_to_the_feel_language_specification"></a><a class="link" href="#_b_extensions_to_the_feel_language_specification">10.5.1.2. b. Extensions to the FEEL language specification</a></h5>
<div class="ulist">
<ul>
<li>
<p><em>Support for scientific and hexadecimal notations</em>: This implementation supports scientific and hexadecimal
notation for numbers. For example, <code>1.2e5</code> (scientific notation), <code>0xD5</code> (hexadecimal notation).</p>
</li>
<li>
<p><em>Support for expressions as end points in ranges</em>: This implementation supports expressions as endpoints
for ranges. For example, <code>[date("2016-11-24")..date("2016-11-27")]</code></p>
</li>
<li>
<p><em>Support for additional types</em>: The specification only defines the following as basic types of the language:</p>
<div class="ulist">
<ul>
<li>
<p>number</p>
</li>
<li>
<p>string</p>
</li>
<li>
<p>boolean</p>
</li>
<li>
<p>days and time duration</p>
</li>
<li>
<p>years and month duration</p>
</li>
<li>
<p>time</p>
</li>
<li>
<p>date and time</p>
<div class="paragraph">
<p>For completeness and orthogonality, this implementation also supports the following types:</p>
</div>
</li>
<li>
<p>context</p>
</li>
<li>
<p>list</p>
</li>
<li>
<p>range</p>
</li>
<li>
<p>function</p>
</li>
<li>
<p>unary test</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Support for unary tests</em>: For completeness and orthogonality, unary tests are supported
as first class citizens in the language. They are functions with an implicit single
parameter and can be invoked in the same way as functions. For example,</p>
<div class="listingblock">
<div class="title">UnaryTestAsFunction.feel</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  {
      is minor : &lt; 18,
      Bob is minor : is minor( bob.age )
  }</code></pre>
</div>
</div>
</li>
<li>
<p><em>Support for additional built-in functions</em>: The following additional functions are supported:</p>
<div class="ulist">
<ul>
<li>
<p><code>now()</code> : Returns the current local date and time.</p>
</li>
<li>
<p><code>today()</code> : Returns the current local date.</p>
</li>
<li>
<p><code>decision table()</code> : Returns a decision table function, although the specification mentions a decision table.
The function on page 114 is not implementable as defined.</p>
</li>
<li>
<p><code>string( mask, p…​ )</code> : Returns a string formatted as per the mask. See Java String.format() for
details on the mask syntax. For example, <code>string( "%4.2f", 7.1298 )</code> returns the string <code>"7.12"</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Support for additional date and time arithmetics</em>: Subtracting two dates returns a day and time duration with the number of days between the two
dates, ignoring daylight savings. For example,</p>
<div class="listingblock">
<div class="title">DateArithmetic.feel</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">date( <span class="hljs-string">"2017-05-12"</span> ) - date( <span class="hljs-string">"2017-04-25"</span> ) = duration( <span class="hljs-string">"P17D"</span> )</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_c_fixes_to_bugs_and_changes_to_the_dmn_model"><a class="anchor" href="#_c_fixes_to_bugs_and_changes_to_the_dmn_model"></a><a class="link" href="#_c_fixes_to_bugs_and_changes_to_the_dmn_model">10.5.1.3. c. Fixes to bugs and changes to the DMN model</a></h5>
<div class="ulist">
<ul>
<li>
<p><em>Support for types with spaces on names</em>: The DMN XML schema defines type refs as QNames.
The QNames do not allow spaces. Therefore, it is not possible to use types like FEEL <code>date and time</code>,
<code>days and time duration</code> or <code>years and months duration</code>. This implementation does parse such
typerefs as strings and allows type names with spaces. However, in order to comply with the XML schema,
it also adds the following aliases to such types that can be used instead:</p>
<div class="ulist">
<ul>
<li>
<p><code>date and time</code> = <code>dateTime</code></p>
</li>
<li>
<p><code>days and time duration</code> = <code>duration</code> or <code>dayTimeDuration</code></p>
</li>
<li>
<p><code>years and months duration</code> = <code>duration</code> or <code>yearMonthDuration</code></p>
<div class="paragraph">
<p>Note that, for the "duration" types, the user can simply use <code>duration</code> and the engine will
infer the proper duration, either <code>days and time duration</code> or <code>years and months duration</code>.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_d_extensions_to_the_dmn_model_specification"><a class="anchor" href="#_d_extensions_to_the_dmn_model_specification"></a><a class="link" href="#_d_extensions_to_the_dmn_model_specification">10.5.1.4. d. Extensions to the DMN model specification</a></h5>
<div class="ulist">
<ul>
<li>
<p><em>Lists support heterogeneous element types</em>: Currently this implementation supports
lists with heterogeneous element types. This is an experimental extension and does limit the
functionality of some functions and filters. This decision will be re-evaluated in the future.</p>
</li>
<li>
<p><em>TypeRef link between Decision Tables and Item Definitions</em>: On decision tables/input clause,
if no values list is defined, the engine automatically checks the type reference and applies the
allowed values check if it is defined.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_experimentalfeatureschapter"><a class="anchor" href="#_experimentalfeatureschapter"></a><a class="link" href="#_experimentalfeatureschapter">11. Experimental Features</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_declarative_agenda"><a class="anchor" href="#_declarative_agenda"></a><a class="link" href="#_declarative_agenda">11.1. Declarative Agenda</a></h3>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Declarative Agenda is experimental, and all aspects are highly likely to change in the future.
@Eager and @Direct are temporary annotations to control the behaviour of rules, which will also change as Declarative Agenda evolves.
Annotations instead of attributes where chosen, to reflect their experimental nature.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The declarative agenda allows to use rules to control which other rules can fire and when.
While this will add a lot more overhead than the simple use of salience, the advantage is it is declarative and thus more readable and maintainable and should allow more use cases to be achieved in a simpler fashion.</p>
</div>
<div class="paragraph">
<p>This feature is off by default and must be explicitly enabled, that is because it is considered highly experimental for the moment and will be subject to change, but can be activated on a given KieBase by adding the declarativeAgenda='enabled' attribute in the corresponding kbase tag of the kmodule.xml file as in the following example.</p>
</div>
<div class="exampleblock">
<div class="title">Example 184. Enabling the Declarative Agenda</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kmodule</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.drools.org/xsd/kmodule"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"DeclarativeKBase"</span> <span class="hljs-attribute">declarativeAgenda</span>=<span class="hljs-value">"enabled"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"KSession"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kbase</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The basic idea is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All rule’s Matches are inserted into WorkingMemory as facts. So you can now do pattern matching against a Match. The rule’s metadata and declarations are available as fields on the Match object.</p>
</li>
<li>
<p>You can use the kcontext.blockMatch( Match match ) for the current rule to block the selected match. Only when that rule becomes false will the match be eligible for firing. If it is already eligible for firing and is later blocked, it will be removed from the agenda until it is unblocked.</p>
</li>
<li>
<p>A match may have multiple blockers and a count is kept. All blockers must became false for the counter to reach zero to enable the Match to be eligible for firing.</p>
</li>
<li>
<p>kcontext.unblockAllMatches( Match match ) is an over-ride rule that will remove all blockers regardless</p>
</li>
<li>
<p>An activation may also be cancelled, so it never fires with cancelMatch</p>
</li>
<li>
<p>An unblocked Match is added to the Agenda and obeys normal salience, agenda groups, ruleflow groups etc.</p>
</li>
<li>
<p>The @Direct annotations allows a rule to fire as soon as it’s matched, this is to be used for rules that block/unblock matches, it is not desirable for these rules to have side effects that impact else where.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 185. New RuleContext methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">blockMatch</span><span class="hljs-params">(Match match)</span></span>;
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unblockAllMatches</span><span class="hljs-params">(Match match)</span></span>;
      <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">cancelMatch</span><span class="hljs-params">(Match match)</span></span>;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here is a basic example that will block all matches from rules that have metadata @department('sales'). They will stay blocked until the blockerAllSalesRules rule becomes false, i.e.
"go2" is retracted.</p>
</div>
<div class="exampleblock">
<div class="title">Example 186. Block rules based on rule metadata</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule rule1 <span class="hljs-variable">@Eager</span> <span class="hljs-variable">@department</span>(<span class="hljs-string">'sales'</span>) <span class="hljs-keyword">when</span>
      <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>( this == <span class="hljs-string">'go1'</span> )
      <span class="hljs-keyword">then</span>
      list.add( kcontext.rule.name + <span class="hljs-string">':'</span> + <span class="hljs-variable">$s</span> );
      <span class="hljs-keyword">end</span>
      rule rule2 <span class="hljs-variable">@Eager</span> <span class="hljs-variable">@department</span>(<span class="hljs-string">'sales'</span>) <span class="hljs-keyword">when</span>
      <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>( this == <span class="hljs-string">'go1'</span> )
      <span class="hljs-keyword">then</span>
      list.add( kcontext.rule.name + <span class="hljs-string">':'</span> + <span class="hljs-variable">$s</span> );
      <span class="hljs-keyword">end</span>
      rule blockerAllSalesRules <span class="hljs-variable">@Direct</span> <span class="hljs-variable">@Eager</span> <span class="hljs-keyword">when</span>
      <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>( this == <span class="hljs-string">'go2'</span> )
      <span class="hljs-variable">$i</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Match</span>( department == <span class="hljs-string">'sales'</span> )
      <span class="hljs-keyword">then</span>
      list.add( <span class="hljs-variable">$i</span>.rule.name + <span class="hljs-string">':'</span> + <span class="hljs-variable">$s</span>  );
      kcontext.blockMatch( <span class="hljs-variable">$i</span> );
      <span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Further than annotate the blocking rule with @Direct, it is also necessary to annotate all the rules that could be potentially blocked by it with @Eager.
This is because, since the Match has to be evaluated by the pattern matching of the blocking rule, the potentially blocked ones cannot be evaluated lazily, otherwise won’t be any Match to be evaluated.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This example shows how you can use active property to count the number of active or inactive (already fired) matches.</p>
</div>
<div class="exampleblock">
<div class="title">Example 187. Count the number of active/inactive Matches</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule rule1 <span class="hljs-variable">@Eager</span> <span class="hljs-variable">@department</span>(<span class="hljs-string">'sales'</span>) <span class="hljs-keyword">when</span>
      <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>( this == <span class="hljs-string">'go1'</span> )
      <span class="hljs-keyword">then</span>
      list.add( kcontext.rule.name + <span class="hljs-string">':'</span> + <span class="hljs-variable">$s</span> );
      <span class="hljs-keyword">end</span>
      rule rule2 <span class="hljs-variable">@Eager</span> <span class="hljs-variable">@department</span>(<span class="hljs-string">'sales'</span>) <span class="hljs-keyword">when</span>
      <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>( this == <span class="hljs-string">'go1'</span> )
      <span class="hljs-keyword">then</span>
      list.add( kcontext.rule.name + <span class="hljs-string">':'</span> + <span class="hljs-variable">$s</span> );
      <span class="hljs-keyword">end</span>
      rule rule3 <span class="hljs-variable">@Eager</span> <span class="hljs-variable">@department</span>(<span class="hljs-string">'sales'</span>) <span class="hljs-keyword">when</span>
      <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>( this == <span class="hljs-string">'go1'</span> )
      <span class="hljs-keyword">then</span>
      list.add( kcontext.rule.name + <span class="hljs-string">':'</span> + <span class="hljs-variable">$s</span> );
      <span class="hljs-keyword">end</span>
      rule countActivateInActive <span class="hljs-variable">@Direct</span> <span class="hljs-variable">@Eager</span> <span class="hljs-keyword">when</span>
      <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>( this == <span class="hljs-string">'go2'</span> )
      <span class="hljs-variable">$active</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Number</span>( this == <span class="hljs-number">1</span> ) from accumulate( <span class="hljs-variable">$a</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Match</span>( department == <span class="hljs-string">'sales'</span>, active == <span class="hljs-keyword">true</span> ), count( <span class="hljs-variable">$a</span> ) )
      <span class="hljs-variable">$inActive</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Number</span>( this == <span class="hljs-number">2</span> ) from  accumulate( <span class="hljs-variable">$a</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Match</span>( department == <span class="hljs-string">'sales'</span>, active == <span class="hljs-keyword">false</span> ), count( <span class="hljs-variable">$a</span> ) )
      <span class="hljs-keyword">then</span>
      kcontext.halt( );
      <span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_browsing_graphs_of_objects_with_oopath_2"><a class="anchor" href="#_browsing_graphs_of_objects_with_oopath_2"></a><a class="link" href="#_browsing_graphs_of_objects_with_oopath_2">11.2. Browsing graphs of objects with OOPath</a></h3>
<div class="paragraph">
<p>When the field of a fact is a collection it is possible to bind and reason over all the items in that collection on by one using the <code>from</code> keyword.
Nevertheless, when it is required to browse a graph of object the extensive use of the <code>from</code> conditional element may result in a verbose and cubersome syntax like in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 188. Browsing a graph of objects with from</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Find all grades for Big Data exam"</span> <span class="hljs-keyword">when</span>
      <span class="hljs-variable">$student</span><span class="hljs-symbol">:</span> <span class="hljs-constant">Student</span>( <span class="hljs-variable">$plan</span><span class="hljs-symbol">:</span> plan )
      <span class="hljs-variable">$exam</span><span class="hljs-symbol">:</span> <span class="hljs-constant">Exam</span>( course == <span class="hljs-string">"Big Data"</span> ) from <span class="hljs-variable">$plan</span>.exams
      <span class="hljs-variable">$grade</span><span class="hljs-symbol">:</span> <span class="hljs-constant">Grade</span>() from <span class="hljs-variable">$exam</span>.grades
      <span class="hljs-keyword">then</span> /* <span class="hljs-constant">RHS</span> *<span class="hljs-regexp">/ end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this example it has been assumed to use a domain model consisting of a <code>Student</code> who has a <code>Plan</code> of study: a <code>Plan</code> can have zero or more <code>Exam</code>s and an <code>Exam</code> zero or more <code>Grade</code>s.
Note that only the root object of the graph (the <code>Student</code> in this case) needs to be in the working memory in order to make this works.</p>
</div>
<div class="paragraph">
<p>By borrowing ideas from XPath, this syntax can be made more succinct, as XPath has a compact notation for navigating through related elements while handling collections and filtering constraints.
This XPath-inspired notation has been called <code>OOPath</code> since it is explictly intended to browse graph of objects.
Using this notation the former example can be rewritten as it follows:</p>
</div>
<div class="exampleblock">
<div class="title">Example 189. Browsing a graph of objects with OOPath</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Find all grades for Big Data exam"</span> <span class="hljs-keyword">when</span>
      <span class="hljs-constant">Student</span>( <span class="hljs-variable">$grade</span><span class="hljs-symbol">:</span> /plan/exams[course == <span class="hljs-string">"Big Data"</span>]/grades )
      <span class="hljs-keyword">then</span> /* <span class="hljs-constant">RHS</span> *<span class="hljs-regexp">/ end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Formally, the core grammar of an <code>OOPath</code> expression can be defined in EBNF notation in this way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ini"><span class="hljs-setting">OOPExpr = <span class="hljs-value">[ID ( <span class="hljs-string">":"</span> | <span class="hljs-string">":="</span> )] ( <span class="hljs-string">"/"</span> | <span class="hljs-string">"?/"</span> ) OOPSegment { ( <span class="hljs-string">"/"</span> | <span class="hljs-string">"?/"</span> | <span class="hljs-string">"."</span> ) OOPSegment } ;</span></span>
<span class="hljs-setting">OOPSegment = <span class="hljs-value">ID [<span class="hljs-string">"#"</span> ID] [<span class="hljs-string">"["</span> ( Number | Constraints ) <span class="hljs-string">"]"</span>]</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In practice an <code>OOPath</code> expression has the following features.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It has to start with <code>/</code> or with a <code>?/</code> in case of a completely non-reactive OOPath (see below).</p>
</li>
<li>
<p>It can dereference a single property of an object with the <code>.</code> operator</p>
</li>
<li>
<p>It can dereference a multiple property of an object using the <code>/</code> operator. If a collection is returned, it will iterate over the values in the collection</p>
</li>
<li>
<p>While traversing referenced objects it can filter away those not satisfying one or more constraints, written as predicate expressions between square brackets like in:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan/exams[ course == <span class="hljs-string">"Big Data"</span> ]/grades )</code></pre>
</div>
</div>
</li>
<li>
<p>During oopath traversal it is also possible to downcast the traversed object to a subclass of the class declared in the generic
collection. In this way subsequent constraints can also safely access to properties declared only in that subclass like in:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Student( $grade: /plan/exams<span class="hljs-preprocessor">#AdvancedExam[ course == <span class="hljs-string">"Big Data"</span>, level &gt; <span class="hljs-number">3</span> ]/grades )</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Objects that are not instances of the class specificed in this inline cast will be automatically filtered away.</p>
</div>
</li>
<li>
<p>A constraint can also have a beckreference to an object of the graph traversed before the currently iterated one. For example the following OOPath:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan/exams/grades[ result &gt; ../averageResult ] )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will match only the grades having a result above the average for the passed exam.</p>
</div>
</li>
<li>
<p>A constraint can also recursively be another OOPath as it follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$exam</span>: /plan/exams[ /grades[ result &gt; <span class="hljs-number">20</span> ] ] )</code></pre>
</div>
</div>
</li>
<li>
<p>Items can also be accessed by their index by putting it between square brackets like in:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan/exams[<span class="hljs-number">0</span>]/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>To adhere to Java convention OOPath indexes are 0-based, compared to XPath 1-based</p>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_reactive_and_non_reactive_oopath"><a class="anchor" href="#_reactive_and_non_reactive_oopath"></a><a class="link" href="#_reactive_and_non_reactive_oopath">11.2.1. Reactive and Non-Reactive OOPath</a></h4>
<div class="paragraph">
<p>At the moment Drools is not able to react to updates involving a deeply nested object traversed during the evaluation of an <code>OOPath</code> expression.
To make these objects reactive to changes it is then necessary to make them extend the class <code>org.drools.core.phreak.ReactiveObject</code>.
It is planned to overcome this limitation by implementing a mechanism that automatically instruments the classes belonging to a specific domain model.</p>
</div>
<div class="paragraph">
<p>Having extendend that class, the domain objects can notify the engine when one of its field has been updated by invoking the inherited method <code>notifyModification</code> as in the following example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 190. Notifying the engine that an exam has been moved to a different course</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCourse</span><span class="hljs-params">(String course)</span> </span>{
        <span class="hljs-keyword">this</span>.course = course;
        notifyModification(<span class="hljs-keyword">this</span>);
        }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In this way when using an OOPath like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan/exams[ course == <span class="hljs-string">"Big Data"</span> ]/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>if an exam is moved to a different course, the rule is re-triggered and the list of grades matching the rule recomputed.</p>
</div>
<div class="paragraph">
<p>It is also possible to have reactivity only in one subpart of the OOPath as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan/exams[ course == <span class="hljs-string">"Big Data"</span> ]?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, using the <code>?/</code> separator instead of the <code>/</code> one, the engine will react to a change made to an exam, or if an exam is added to the plan, but not if a new grade is added to an existing exam.
Of course if a OOPath chunk is not reactive, all remaining part of the OOPath from there till the end of the expression will be non-reactive as well.
For instance the following OOPath</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: ?/plan/exams[ course == <span class="hljs-string">"Big Data"</span> ]/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will be completely non-reactive.
For this reason it is not allowed to use the <code>?/</code> separator more than once in the same OOPath so an expression like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Student( <span class="hljs-variable">$grade</span>: /plan?/exams[ course == <span class="hljs-string">"Big Data"</span> ]?/grades )</code></pre>
</div>
</div>
<div class="paragraph">
<p>will cause a compile time error.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_traits"><a class="anchor" href="#_traits"></a><a class="link" href="#_traits">11.3. Traits</a></h3>
<div class="paragraph">
<p>WARNING : this feature is still experimental and subject to changes</p>
</div>
<div class="paragraph">
<p>The same fact may have multiple dynamic types which do not fit naturally in a class hierarchy.
Traits allow to model this very common scenario.
A trait is an interface that can be applied (and eventually removed) to an individual object at runtime.
To create a trait rather than a traditional bean, one has to declare them explicitly as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> trait GoldenCustomer
    // <span class="hljs-keyword">fields</span> will <span class="hljs-keyword">map</span> <span class="hljs-keyword">to</span> getters/setters
    code     : <span class="hljs-keyword">String</span>
    balance  : <span class="hljs-keyword">long</span>
    discount : <span class="hljs-built_in">int</span>
    maxExpense : <span class="hljs-keyword">long</span>
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At runtime, this declaration results in an interface, which can be used to write patterns, but can not be instantiated directly.
In order to apply a trait to an object, we provide the new don keyword, which can be used as simply as this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby"><span class="hljs-keyword">when</span>
    <span class="hljs-variable">$c</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Customer</span>()
<span class="hljs-keyword">then</span>
    <span class="hljs-constant">GoldenCustomer</span> gc = don( <span class="hljs-variable">$c</span>, <span class="hljs-constant">GoldenCustomer</span>.<span class="hljs-keyword">class</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>when a core object dons a trait, a proxy class is created on the fly (one such class will be generated lazily for each core/trait class combination). The proxy instance, which wraps the core object and implements the trait interface, is inserted automatically and will possibly activate other rules.
An immediate advantage of declaring and using interfaces, getting the implementation proxy for free from the engine, is that multiple inheritance hierarchies can be exploited when writing rules.
The core classes, however, need not implement any of those interfaces statically, also facilitating the use of legacy classes as cores.
In fact, any object can don a trait, provided that they are declared as @Traitable.
Notice that this annotation used to be optional, but now is mandatory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">import</span> <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.core</span><span class="hljs-class">.factmodel</span><span class="hljs-class">.traits</span><span class="hljs-class">.Traitable</span>;
<span class="hljs-tag">declare</span> <span class="hljs-tag">Customer</span>
    <span class="hljs-at_rule">@<span class="hljs-keyword">Traitable</span>
    code    : String
    balance : long
end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The only connection between core classes and trait interfaces is at the proxy level: a trait is not specifically tied to a core class.
This means that the same trait can be applied to totally different objects.
For this reason, the trait does not transparently expose the fields of its core object.
So, when writing a rule using a trait interface, only the fields of the interface will be available, as usual.
However, any field in the interface that corresponds to a core object field, will be mapped by the proxy class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby"><span class="hljs-keyword">when</span>
    <span class="hljs-variable">$o</span><span class="hljs-symbol">:</span> <span class="hljs-constant">OrderItem</span>( <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> price, <span class="hljs-variable">$code</span> <span class="hljs-symbol">:</span> custCode )
    <span class="hljs-variable">$c</span><span class="hljs-symbol">:</span> <span class="hljs-constant">GoldenCustomer</span>( code == <span class="hljs-variable">$code</span>, <span class="hljs-variable">$a</span> <span class="hljs-symbol">:</span> balance, <span class="hljs-variable">$d</span><span class="hljs-symbol">:</span> discount )
<span class="hljs-keyword">then</span>
    <span class="hljs-variable">$c</span>.setBalance( <span class="hljs-variable">$a</span> - <span class="hljs-variable">$p</span>*<span class="hljs-variable">$d</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the code and balance would be read from the underlying Customer object.
Likewise, the setAccount will modify the underlying object, preserving a strongly typed access to the data structures.
A hard field must have the same name and type both in the core class and all donned interfaces.
The name is used to establish the mapping: if two fields have the same name, then they must also have the same declared type.
The annotation @org.drools.core.factmodel.traits.Alias allows to relax this restriction.
If an @Alias is provided, its value string will be used to resolve mappings instead of the original field name.
@Alias can be applied both to traits and core beans.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs java"><span class="hljs-keyword">import</span> org.drools.core.factmodel.traits.*;
declare trait GoldenCustomer
    balance : <span class="hljs-keyword">long</span> <span class="hljs-annotation">@Alias</span>( <span class="hljs-string">"org.acme.foo.accountBalance"</span> )
end

declare Person
    <span class="hljs-annotation">@Traitable</span>
    name : String
    savings : <span class="hljs-keyword">long</span> <span class="hljs-annotation">@Alias</span>( <span class="hljs-string">"org.acme.foo.accountBalance"</span> )
<span class="hljs-function">end

when
    <span class="hljs-title">GoldenCustomer</span><span class="hljs-params">( balance &amp;gt; <span class="hljs-number">1000</span> )</span> <span class="hljs-comment">// will react to new Person( 2000 )</span>
then
end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>More work is being done on relaxing this constraint (see the experimental section on "logical" traits later). Now, one might wonder what happens when a core class does NOT provide the implementation for a field defined in an interface.
We call hard fields those trait fields which are also core fields and thus readily available, while we define soft those fields which are NOT provided by the core class.
Hidden fields, instead, are fields in the core class not exposed by the interface.</p>
</div>
<div class="paragraph">
<p>So, while hard field management is intuitive, there remains the problem of soft and hidden fields.
Hidden fields are normally only accessible using the core class directly.
However, the "fields" Map can be used on a trait interface to access a hidden field.
If the field can’t be resolved, null will be returned.
Notice that this feature is likely to change in the future.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-keyword">when</span>
    $sc : GoldenCustomer( fields[ <span class="hljs-string">"age"</span> ] &gt; <span class="hljs-number">18</span> )  <span class="hljs-regexp">//</span> age <span class="hljs-keyword">is</span> declared <span class="hljs-keyword">by</span> the underlying core <span class="hljs-class"><span class="hljs-keyword">class</span>, <span class="hljs-title">but</span> <span class="hljs-title">not</span> <span class="hljs-title">by</span> <span class="hljs-title">GoldenCustomer</span></span>
<span class="hljs-keyword">then</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Soft fields, instead, are stored in a Map-like data structure that is specific to each core object and referenced by the proxy(es), so that they are effectively shared even when an object dons multiple traits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php">when
    <span class="hljs-variable">$sc</span> : GoldenCustomer( <span class="hljs-variable">$c</span> : code, <span class="hljs-comment">// hard getter</span>
                          <span class="hljs-variable">$maxExpense</span> : maxExpense &gt; <span class="hljs-number">1000</span> <span class="hljs-comment">// soft getter</span>
    )
then
    <span class="hljs-variable">$sc</span>.setDiscount( ... ); <span class="hljs-comment">// soft setter</span>
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>A core object also holds a reference to all its proxies, so that it is possible to track which type(s) have been added to an object, using a sort of dynamic "instanceof" operator, which we called isA.
The operator can accept a String, a class literal or a list of class literals.
In the latter case, the constraint is satisfied only if all the traits have been donned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$sc : GoldenCustomer( $maxExpense : maxExpense &gt; <span class="hljs-number">1000</span>,
                      <span class="hljs-keyword">this</span> isA <span class="hljs-string">"SeniorCustomer"</span>, <span class="hljs-keyword">this</span> isA [ NationalCustomer.<span class="hljs-keyword">class</span>, OnlineCustomer.<span class="hljs-keyword">class</span> ]
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Eventually, the business logic may require that a trait is removed from a wrapped object.
To this end, we provide two options.
The first is a "logical don", which will result in a logical insertion of the proxy resulting from the traiting operation.
The TMS will ensure that the trait is removed when its logical support is removed in the first place.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-keyword">then</span>
    don( $x, <span class="hljs-regexp">//</span> core object
         Customer.class, <span class="hljs-regexp">//</span> trait <span class="hljs-class"><span class="hljs-keyword">class</span></span>
         <span class="hljs-literal">true</span> <span class="hljs-regexp">//</span> optional flag <span class="hljs-keyword">for</span> logical insertion
    )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second is the use of the "shed" keyword, which causes the removal of any type that is a subtype (or equivalent) of the one passed as an argument.
Notice that, as of version 5.5, shed would only allow to remove a single specific trait.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby"><span class="hljs-keyword">then</span>
    <span class="hljs-constant">Thing</span> t = shed( <span class="hljs-variable">$x</span>, <span class="hljs-constant">GoldenCustomer</span>.<span class="hljs-keyword">class</span> ) /<span class="hljs-regexp">/ also removes any trait that</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This operation returns another proxy implementing the org.drools.core.factmodel.traits.Thing interface, where the getFields() and getCore() methods are defined.
Internally, in fact, all declared traits are generated to extend this interface (in addition to any others specified).      This allows to preserve the wrapper with the soft fields which would otherwise be lost.</p>
</div>
<div class="paragraph">
<p>A trait and its proxies are also correlated in another way.
Starting from version 5.6, whenever a core object is "modified", its proxies are "modified" automatically as well, to allow trait-based patterns to react to potential changes in hard fields.
Likewise, whenever a trait proxy (mached by a trait pattern) is modified, the modification is propagated to the core class and the other traits.
Morover, whenever a don operation is performed, the core object is also modified automatically, to reevaluate any "isA" operation which may be triggered.</p>
</div>
<div class="paragraph">
<p>Potentially, this may result in a high number of modifications, impacting performance (and correctness) heavily.
So two solutions are currently implemented.
First, whenever a core object is modified, only the most specific traits (in the sense of inheritance between trait interfaces) are updated and an internal blocking mechanism is in place to ensure that each potentially matching pattern is evaluated once and only once.
So, in the following situation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php"><span class="hljs-keyword">declare</span> <span class="hljs-keyword">trait</span> GoldenCustomer end
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">trait</span> NationalGoldenustomer extends GoldenCustomer end
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">trait</span> SeniorGoldenCustomer extends GoldenCustomer end</code></pre>
</div>
</div>
<div class="paragraph">
<p>a modification of an object that is both a GoldenCustomer, a NationalGoldenCustomer and a SeniorGoldenCustomer wold cause only the latter two proxies to be actually modified.
The first would match any pattern for GoldenCustomer and NationalGoldenCustomer; the latter would instead be prevented from rematching GoldenCustomer, but would be allowed to match SeniorGoldenCustomer patterns.
It is not necessary, instead, to modify the GoldenCustomer proxy since it is already covered by at least one other more specific trait.</p>
</div>
<div class="paragraph">
<p>The second method, up to the usr, is to mark traits as @PropertyReactive.
Property reactivity is trait-enabled and takes into account the trait field mappings, so to block unnecessary propagations.</p>
</div>
<div class="sect3">
<h4 id="_cascading_traits"><a class="anchor" href="#_cascading_traits"></a><a class="link" href="#_cascading_traits">11.3.1. Cascading traits</a></h4>
<div class="paragraph">
<p><strong>WARNING</strong> : This feature is extremely experimental and subject to changes</p>
</div>
<div class="paragraph">
<p>Normally, a hard field must be exposed with its original type by all traits donned by an object, to prevent situations such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Person
  @Traitable
  <span class="hljs-keyword">name</span> : <span class="hljs-keyword">String</span>
  <span class="hljs-keyword">id</span> : <span class="hljs-keyword">String</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">declare</span> trait Customer
  <span class="hljs-keyword">id</span> : <span class="hljs-keyword">String</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">declare</span> trait Patient
  <span class="hljs-keyword">id</span> : <span class="hljs-keyword">long</span>  // Person can<span class="hljs-string">'t don Patient, or an exception will be thrown
end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Should a Person don both Customer and Patient, the type of the hard field id would be ambiguous.
However, consider the following example, where GoldenCustomers refer their best friends so that they become Customers as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql"><span class="hljs-operator"><span class="hljs-keyword">declare</span> Person
  @Traitable( <span class="hljs-keyword">logical</span>=<span class="hljs-literal">true</span> )
  bestFriend : Person
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">declare</span> trait Customer <span class="hljs-keyword">end</span>

<span class="hljs-keyword">declare</span> trait GoldenCustomer extends Customer
  refers : Customer @<span class="hljs-keyword">Alias</span>( <span class="hljs-string">"bestFriend"</span> )
<span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aside from the @Alias, a Person-as-GoldenCustomer’s best friend might be compatible with the requirements of the trait GoldenCustomer, provided that they are some kind of Customer themselves.
Marking a Person as "logically traitable" - i.e.
adding the annotation @Traitable( logical = true ) - will instruct the engine to try and preserve the logical consistency rather than throwing an exception due to a hard field with different type declarations (Person vs Customer). The following operations would then work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Person p1 = <span class="hljs-keyword">new</span> Person();
Person p2 = <span class="hljs-keyword">new</span> Person();
p1.setBestFriend( p2 );
...
Customer c2 = don( p2, Customer.class );
...
GoldenCustomer gc1 = don( p1, GoldenCustomer.class );
...
p1.getBestFriend(); <span class="hljs-comment">// returns p2</span>
gc1.getRefers(); <span class="hljs-comment">// returns c2, a Customer proxy wrapping p2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that, by the time p1 becomes GoldenCustomer, p2 must have already become a Customer themselves, otherwise a runtime exception will be thrown since the very definition of GoldenCustomer would have been violated.</p>
</div>
<div class="paragraph">
<p>In some cases, however, one might want to infer, rather than verify, that p2 is a Customer by virtue that p1 is a GoldenCustomer.
This modality can be enabled by marking Customer as "logical", using the annotation @org.drools.core.factmodel.traits.Trait( logical = true ). In this case, should p2 not be a Customer by the time that p1 becomes a GoldenCustomer, it will be automatically don the trait Customer to preserve the logical integrity of the system.</p>
</div>
<div class="paragraph">
<p>Notice that the annotation on the core class enables the dynamic type management for its fields, whereas the annotation on the traits determines whether they will be enforced as integrity constraints or cascaded dynamically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">import</span> <span class="hljs-regexp">org.drools.factmodel.traits.*</span>;

<span class="hljs-title">declare</span> trait Customer
    <span class="hljs-variable">@Trait</span>( logical = <span class="hljs-built_in">true</span> )
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rule_units_2"><a class="anchor" href="#_rule_units_2"></a><a class="link" href="#_rule_units_2">11.4. Rule Units</a></h3>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is experimental</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Rule units represent a declarative approach to partition a rule set into smaller units, binding different data sources
to those units, and orchestrate the execution of the individual unit. A rule unit is an aggregate of data sources, global variables,
and rules. You can define a rule unit by implementing the <code>RuleUnit</code> marker interface as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">A RuleUnit class:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> org.mypackage.myunit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdultUnit</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RuleUnit</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> adultAge;
    <span class="hljs-keyword">private</span> DataSource&lt;Person&gt; persons;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AdultUnit</span><span class="hljs-params">( )</span> </span>{ }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AdultUnit</span><span class="hljs-params">( DataSource&lt;Person&gt; persons, <span class="hljs-keyword">int</span> age )</span> </span>{
        <span class="hljs-keyword">this</span>.persons = persons;
        <span class="hljs-keyword">this</span>.age = age;
    }

    <span class="hljs-comment">// A DataSource of Persons for this RuleUnit</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource&lt;Person&gt; <span class="hljs-title">getPersons</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> persons;
    }

    <span class="hljs-comment">// A global variable valid in this RuleUnit</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getAdultAge</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> adultAge;
    }

    <span class="hljs-comment">// --- life cycle methods</span>

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStart</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">"AdultUnit started."</span>);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onEnd</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">"AdultUnit ended."</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>persons</code> is a source of facts of type Person. It represents that part of the working memory, which is related to that specific
entry-point used when the rule unit is evaluated. <code>adultAge</code> is a global variable accessible from all the rules
belonging to this rule unit. The last two methods are part of the rule unit life cycle and are invoked by the engine.
The lifecycle of a RuleUnit can be monitored overriding the following methods:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. Rule Unit life cycle methods</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Invoked when</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">onStart()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the rule engine starts evaluating the unit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">onEnd()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the evaluation of this unit terminates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">onSuspend()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the execution of unit is suspended (only for runUntilHalt)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">onResume()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the execution of unit is resumed (only for runUntilHalt)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">onYield(RuleUnit other)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the consequence of rule in a given rule unit triggers the execution of a different unit</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All these methods have an empty default implemention inside the <code>RuleUnit</code> interface, so their implementation is optional.
At this point, it is possible to add one or more rules to this rule unit. By default all the rules in a drl file are automatically
associated to a rule unit following a naming convention of the name of drl file itself: if the drl file is in the same package
and has the same name of a class implementing the <code>RuleUnit</code> interface all the rules in that drl file will implicitly belong
to that unit. For example, all the rules in the drl file named AdultUnit.drl in package org.mypackage.myunit will be automatically
part of the rule unit <code>org.mypackage.myunit.AdultUnit</code>.</p>
</div>
<div class="paragraph">
<p>You can avoid using this naming convention and explictly declare the unit to which the rules in a drl file belongs
by using the new <code>unit</code> keyword. The unit declaration must always immediately follow the package declaration and contain
the name of the class (in that package) to which the rules of the drl file are part of. For example,</p>
</div>
<div class="listingblock">
<div class="title">A rule belonging to the rule unit</div>
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package org.mypackage.myunit
unit <span class="hljs-constant">AdultUnit</span>

rule <span class="hljs-constant">Adult</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>(age &gt;= adultAge) from persons
<span class="hljs-keyword">then</span>
    <span class="hljs-constant">System</span>.out.println(<span class="hljs-variable">$p</span>.getName() + <span class="hljs-string">" is adult and greater than "</span> + adultAge);
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is not allowed to mix rules with and without a rule unit in the same KieBase.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Additionally, you can rewrite the same pattern in a more convenient way using the oopath notation introduced in drools 6
as shown below:</p>
</div>
<div class="listingblock">
<div class="title">A rule belonging to a rule unit using the oopath notation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package org.mypackage.myunit
unit <span class="hljs-constant">AdultUnit</span>

rule <span class="hljs-constant">Adult</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> /persons[age &gt;= adultAge]
<span class="hljs-keyword">then</span>
    <span class="hljs-constant">System</span>.out.println(<span class="hljs-variable">$p</span>.getName() + <span class="hljs-string">" is adult and greater than "</span> + adultAge);
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the persons matched by the left hand side of the rule is retrieved from the <code>DataSource</code> contained in the RuleUnit class with
the same name. The <code>adultAge</code> variable is used in both the left and right hand side of the rule in the same way as a global is
defined at drl level. In other words the <code>persons</code> DataSource acts as a specific entry-point, feeding the working memory.</p>
</div>
<div class="paragraph">
<p>The easiest way to create a <code>DataSource</code> is using a fixed set of data, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource&lt;Person&gt; persons = DataSource.create( <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Mario"</span>, <span class="hljs-number">42</span> ),
                                                <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Marilena"</span>, <span class="hljs-number">44</span> ),
                                                <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Sofia"</span>, <span class="hljs-number">4</span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>To execute one or more rule units defined in a given <code>KieBase</code>, create a new <code>RuleUnitExecutor</code> and
bind it to the <code>KieBase</code> itself. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">KieBase kbase = kieContainer.getKieBase();
RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, create the <code>AdultUnit</code> by passing the persons <code>DataSource</code> to it and running it on the <code>RuleUnitExecutor</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnit adultUnit = <span class="hljs-keyword">new</span> AdultUnit(persons, <span class="hljs-number">18</span>);
executor.run( adultUnit );</code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">org</span><span class="hljs-class">.mypackage</span><span class="hljs-class">.myunit</span><span class="hljs-class">.AdultUnit</span> <span class="hljs-tag">started</span>.
<span class="hljs-tag">Marilena</span> <span class="hljs-tag">is</span> <span class="hljs-tag">adult</span> <span class="hljs-tag">and</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 18
<span class="hljs-tag">Mario</span> <span class="hljs-tag">is</span> <span class="hljs-tag">adult</span> <span class="hljs-tag">and</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 18
<span class="hljs-tag">org</span><span class="hljs-class">.mypackage</span><span class="hljs-class">.myunit</span><span class="hljs-class">.AdultUnit</span> <span class="hljs-tag">ended</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of explicitly creating the rule unit instance, it is more convenient to pass to the executor the rule unit class that you want to run and let the executor create an instance of it. You can then set the <code>DataSource</code>s and other variables before running it. In order to do so, ensure that you have previously registered those variables on the executor itself, so that the following code produces exactly the same result as the former one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executor.bindVariable( <span class="hljs-string">"persons"</span>, persons );
        .bindVariable( <span class="hljs-string">"adultAge"</span>, <span class="hljs-number">18</span> );
executor.run( AdultUnit.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name passed to the <code>RuleUnitExecutor.bindVariable()</code> method is used at runtime to bind said variable to the field of the
RuleUnit class having the same name. For instance in the former example the <code>RuleUnitExecutor</code> injects into the new rule unit
the data source formerly bound to the "persons" name and the value 18 bound to the String "adultAge" to the fields with the
corresponding names inside the <code>AdultUnit</code> class. It is possible to override this default and explictly define a logical
binding name for each field of the rule unit class using the <code>@UnitVar</code> annotation. For example, the field binding in the
following class can be redefined with alternative names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> org.mypackage.myunit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdultUnit</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RuleUnit</span> </span>{
    <span class="hljs-annotation">@UnitVar</span>(<span class="hljs-string">"minAge"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> adultAge = <span class="hljs-number">18</span>;

    <span class="hljs-annotation">@UnitVar</span>(<span class="hljs-string">"data"</span>)
    <span class="hljs-keyword">private</span> DataSource&lt;Person&gt; persons;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then bind the variables to the executor using those alternative names and run the unit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executor.bindVariable( <span class="hljs-string">"data"</span>, persons );
        .bindVariable( <span class="hljs-string">"minAge"</span>, <span class="hljs-number">18</span> );
executor.run( AdultUnit.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>A rule unit can be executed in passive mode as shown above (corresponding to invoking <code>fireAllRules</code> on a whole session)
or in active mode using the <code>runUntilHalt</code> that is equivalent to the session <code>fireUntilHalt</code>. As for the fireUntilHalt,
the runUntilHalt is blocking and therefore has to be issued on a separated thread. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">new</span> Thread( () -&gt; executor.runUntilHalt( adultUnit ) ).start();</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_data_sources"><a class="anchor" href="#_data_sources"></a><a class="link" href="#_data_sources">11.4.1. Data sources</a></h4>
<div class="paragraph">
<p>A <code>DataSource</code> is a source of the data processed by a given rule unit. A rule unit can have zero or more data sources and
to each DataSource declared inside a rule unit corresponds a different entry-point into the rule unit executor. A DataSource
can be shared by different units, but in this case there will be many different entry-points, one for each unit, through which
the same objects will be inserted.</p>
</div>
<div class="paragraph">
<p>In other terms the <code>DataSource</code> represents the entry-point of the rule unit, so it is possible to insert a new fact into it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Person mario = <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Mario"</span>, <span class="hljs-number">42</span> );
FactHandle marioFh = persons.insert( mario );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modify the fact, optionally specifying the set of properties that have been modified in order to leverage property reactivity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">mario.setAge( <span class="hljs-number">43</span> );
persons.update( marioFh, mario, <span class="hljs-string">"age"</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>or delete it</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">persons.delete( marioFh );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_imperatively_running_and_declaratively_guarding_a_ruleunit"><a class="anchor" href="#_imperatively_running_and_declaratively_guarding_a_ruleunit"></a><a class="link" href="#_imperatively_running_and_declaratively_guarding_a_ruleunit">11.4.2. Imperatively running and declaratively guarding a RuleUnit</a></h4>
<div class="paragraph">
<p>As anticipated, you can define multiple rule units in the same knowledge base and these units can work in a coordinated way
by invoking or guarding the execution of each other. To demonstrate this let’s suppose having the following 2 drl files
each of them containing a rule belonging to a distinct rule unit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package org.mypackage.myunit
unit <span class="hljs-constant">AdultUnit</span>

rule <span class="hljs-constant">Adult</span> <span class="hljs-keyword">when</span>
    <span class="hljs-constant">Person</span>(age &gt;= <span class="hljs-number">18</span>, <span class="hljs-variable">$name</span> <span class="hljs-symbol">:</span> name) from persons
<span class="hljs-keyword">then</span>
    <span class="hljs-constant">System</span>.out.println(<span class="hljs-variable">$name</span> + <span class="hljs-string">" is adult"</span>);
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package org.mypackage.myunit
unit <span class="hljs-constant">NotAdultUnit</span>

rule <span class="hljs-constant">NotAdult</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Person</span>(age &lt; <span class="hljs-number">18</span>, <span class="hljs-variable">$name</span> <span class="hljs-symbol">:</span> name) from persons
<span class="hljs-keyword">then</span>
    <span class="hljs-constant">System</span>.out.println(<span class="hljs-variable">$name</span> + <span class="hljs-string">" is NOT adult"</span>);
    modify(<span class="hljs-variable">$p</span>) { setAge(<span class="hljs-number">18</span>); }
    drools.run( <span class="hljs-constant">AdultUnit</span>.<span class="hljs-keyword">class</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also suppose to have a <code>RuleUnitExecutor</code> created from the <code>KieBase</code> built out of these rules and a <code>DataSource</code> of Persons
bound to it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );
DataSource&lt;Person&gt; persons = executor.newDataSource( <span class="hljs-string">"persons"</span>,
                                                     <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Mario"</span>, <span class="hljs-number">42</span> ),
                                                     <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Marilena"</span>, <span class="hljs-number">44</span> ),
                                                     <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Sofia"</span>, <span class="hljs-number">4</span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this case we are creating the <code>DataSource</code> directly out of the <code>RuleUnitExecutor</code> and binding it to the
"persons" variable in a single statement.</p>
</div>
<div class="paragraph">
<p>At this point trying to execute the NotAdultUnit unit we obtain the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">Sofia <span class="hljs-keyword">is</span> NOT adult
Mario <span class="hljs-keyword">is</span> adult
Marilena <span class="hljs-keyword">is</span> adult
Sofia <span class="hljs-keyword">is</span> adult</code></pre>
</div>
</div>
<div class="paragraph">
<p>In fact the NotAdult rule finds a match when evaluating the person "Sofia" who has an age lower than 18. Then it modifies
her age to 18 and with the statement <code>drools.run( AdultUnit.class )</code> triggers the execution of the other unit which has a
rule that now can fire for all the 3 persons in the <code>DataSource</code>. This means that the <code>drools.run()</code> statement inside a
consequence is the way to imperatively interrupt the execution of a rule unit and cede the control to a different rule unit.</p>
</div>
<div class="paragraph">
<p>Conversely the <code>drools.guard()</code> statement allows to declaratively schedule the execution of another rule unit when the
condition in the LHS of the rule containing that statement is met. More precisely, using this mechanism a rule in a given
rule unit acts as a guard for a different unit. This means that, when the rule engine produces at least one match for the LHS
of the guarding rule, the guarded RuleUnit is considered active. Of course a RuleUnit can have more than one guarding rule.</p>
</div>
<div class="paragraph">
<p>Let’s see how this works with another practical example. Suppose of having a simple <code>BoxOffice</code> class</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BoxOffice</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> open;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BoxOffice</span><span class="hljs-params">( <span class="hljs-keyword">boolean</span> open )</span> </span>{
        <span class="hljs-keyword">this</span>.open = open;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isOpen</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> open;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setOpen</span><span class="hljs-params">( <span class="hljs-keyword">boolean</span> open )</span> </span>{
        <span class="hljs-keyword">this</span>.open = open;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and a <code>BoxOfficeUnit</code> with a data source of box offices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BoxOfficeUnit</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RuleUnit</span> </span>{
    <span class="hljs-keyword">private</span> DataSource&lt;BoxOffice&gt; boxOffices;

    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource&lt;BoxOffice&gt; <span class="hljs-title">getBoxOffices</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> boxOffices;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We introduce now the requirement to keep selling tickets for the event as long as there is at least one opened box office.
To achieve this let’s define a second unit with a <code>DataSource</code> of person and a second one of tickets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TicketIssuerUnit</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RuleUnit</span> </span>{
    <span class="hljs-keyword">private</span> DataSource&lt;Person&gt; persons;
    <span class="hljs-keyword">private</span> DataSource&lt;AdultTicket&gt; tickets;

    <span class="hljs-keyword">private</span> List&lt;String&gt; results;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TicketIssuerUnit</span><span class="hljs-params">()</span> </span>{ }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TicketIssuerUnit</span><span class="hljs-params">( DataSource&lt;Person&gt; persons, DataSource&lt;AdultTicket&gt; tickets )</span> </span>{
        <span class="hljs-keyword">this</span>.persons = persons;
        <span class="hljs-keyword">this</span>.tickets = tickets;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource&lt;Person&gt; <span class="hljs-title">getPersons</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> persons;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource&lt;AdultTicket&gt; <span class="hljs-title">getTickets</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> tickets;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getResults</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can define a first rule in the BoxOfficeUnit that guards for this second unit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package org.mypackage.myunit;
unit <span class="hljs-constant">BoxOfficeUnit</span>;

rule <span class="hljs-constant">BoxOfficeIsOpen</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$box</span><span class="hljs-symbol">:</span> /boxOffices[ open ]
<span class="hljs-keyword">then</span>
    drools.guard( <span class="hljs-constant">TicketIssuerUnit</span>.<span class="hljs-keyword">class</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this way we achieved what we have anticipated: by running the BoxOfficeUnit at some point it will also evaluates the
rules in the TicketIssuerUnit defined as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package org.mypackage.myunit;
unit <span class="hljs-constant">TicketIssuerUnit</span>;

rule <span class="hljs-constant">IssueAdultTicket</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span><span class="hljs-symbol">:</span> /persons[ age &gt;= <span class="hljs-number">18</span> ]
<span class="hljs-keyword">then</span>
    tickets.insert(new <span class="hljs-constant">AdultTicket</span>(<span class="hljs-variable">$p</span>));
<span class="hljs-keyword">end</span>
rule <span class="hljs-constant">RegisterAdultTicket</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$t</span><span class="hljs-symbol">:</span> /tickets
<span class="hljs-keyword">then</span>
    results.add( <span class="hljs-variable">$t</span>.getPerson().getName() );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>that is guarded by the BoxOfficeIsOpen rule, until there will exist at least a set of facts satisfying the LHS patterns
of that rule. In other terms the existence of at least one open box office will keep the guarding rule and in turn its
guarded unit active as it is evident in the following use case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DataSource&lt;Person&gt; persons = executor.newDataSource( <span class="hljs-string">"persons"</span> );
DataSource&lt;BoxOffice&gt; boxOffices = executor.newDataSource( <span class="hljs-string">"boxOffices"</span> );
DataSource&lt;AdultTicket&gt; tickets = executor.newDataSource( <span class="hljs-string">"tickets"</span> );

List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
executor.bindVariable( <span class="hljs-string">"results"</span>, list );

<span class="hljs-comment">// two open box offices</span>
BoxOffice office1 = <span class="hljs-keyword">new</span> BoxOffice(<span class="hljs-keyword">true</span>);
FactHandle officeFH1 = boxOffices.insert( office1 );
BoxOffice office2 = <span class="hljs-keyword">new</span> BoxOffice(<span class="hljs-keyword">true</span>);
FactHandle officeFH2 = boxOffices.insert( office2 );

persons.insert(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"Mario"</span>, <span class="hljs-number">40</span>));
<span class="hljs-comment">// fire BoxOfficeIsOpen -&gt; run TicketIssuerUnit -&gt; fire RegisterAdultTicket</span>
executor.run(BoxOfficeUnit.class);

assertEquals( <span class="hljs-number">1</span>, list.size() );
assertEquals( <span class="hljs-string">"Mario"</span>, list.get(<span class="hljs-number">0</span>) );
list.clear();

persons.insert(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"Matteo"</span>, <span class="hljs-number">30</span>));
executor.run(BoxOfficeUnit.class); <span class="hljs-comment">// fire RegisterAdultTicket</span>

assertEquals( <span class="hljs-number">1</span>, list.size() );
assertEquals( <span class="hljs-string">"Matteo"</span>, list.get(<span class="hljs-number">0</span>) );
list.clear();

<span class="hljs-comment">// close one box office, the other is still open</span>
office1.setOpen(<span class="hljs-keyword">false</span>);
boxOffices.update(officeFH1, office1);
persons.insert(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"Mark"</span>, <span class="hljs-number">35</span>));
executor.run(BoxOfficeUnit.class);

assertEquals( <span class="hljs-number">1</span>, list.size() );
assertEquals( <span class="hljs-string">"Mark"</span>, list.get(<span class="hljs-number">0</span>) );
list.clear();

<span class="hljs-comment">// all box offices, are now closed</span>
office2.setOpen(<span class="hljs-keyword">false</span>);
boxOffices.update(officeFH2, office2); <span class="hljs-comment">// guarding rule no longer true</span>
persons.insert(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"Edson"</span>, <span class="hljs-number">35</span>));
executor.run(BoxOfficeUnit.class); <span class="hljs-comment">// no fire</span>

assertEquals( <span class="hljs-number">0</span>, list.size() );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ruleunit_identity"><a class="anchor" href="#_ruleunit_identity"></a><a class="link" href="#_ruleunit_identity">11.4.3. RuleUnit identity</a></h4>
<div class="paragraph">
<p>Since a rule can guard multiple rule units and at the same time a unit can be guarded and then activated by multiple rules,
it is necessary to clearly define what is the identity of a given unit. By the default the identity of a unit is simply the
rule unit class. This is encoded in the <code>getUnitIdentity()</code> default method of the <code>RuleUnit</code> interface</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">default</span> Identity <span class="hljs-title">getUnitIdentity</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Identity( getClass() );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and implies that each unit is threated as a singleton by the <code>RuleUnitExecutor</code>. To demonstrate this let’s suppose of
having a simple <code>RuleUnit</code> class with only a <code>DataSource</code> accepting any kind of object</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Unit0</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RuleUnit</span> </span>{
    <span class="hljs-keyword">private</span> DataSource&lt;Object&gt; input;

    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource&lt;Object&gt; <span class="hljs-title">getInput</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> input;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>together with a rule belonging to this unit that guards another unit using 2 different conditions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package org.mypackage.myunit
unit <span class="hljs-constant">Unit0</span>

rule <span class="hljs-constant">GuardAgeCheck</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$i</span><span class="hljs-symbol">:</span> /input<span class="hljs-comment">#Integer</span>
    <span class="hljs-variable">$s</span><span class="hljs-symbol">:</span> /input<span class="hljs-comment">#String</span>
<span class="hljs-keyword">then</span>
    drools.guard( new <span class="hljs-constant">AgeCheckUnit</span>(<span class="hljs-variable">$i</span>) );
    drools.guard( new <span class="hljs-constant">AgeCheckUnit</span>(<span class="hljs-variable">$s</span>.length()) );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This second <code>RuleUnit</code> is intended to check the age of a set of persons. Then it has a <code>DataSource</code> of the persons to check,
a minAge variable against which doing this check and a list were accumulating the results</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AgeCheckUnit</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RuleUnit</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> minAge;
    <span class="hljs-keyword">private</span> DataSource&lt;Person&gt; persons;
    <span class="hljs-keyword">private</span> List&lt;String&gt; results;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AgeCheckUnit</span><span class="hljs-params">( <span class="hljs-keyword">int</span> minAge )</span> </span>{
        <span class="hljs-keyword">this</span>.minAge = minAge;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource&lt;Person&gt; <span class="hljs-title">getPersons</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> persons;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getMinAge</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> minAge;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">getResults</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> results;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>while the corresponding rule actually performing the check of the persons in the <code>DataSource</code> is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">package org.mypackage.myunit
unit <span class="hljs-constant">AgeCheckUnit</span>

rule <span class="hljs-constant">CheckAge</span> <span class="hljs-keyword">when</span>
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> /persons{ age &gt; minAge }
<span class="hljs-keyword">then</span>
    results.add(<span class="hljs-variable">$p</span>.getName() + <span class="hljs-string">"&gt;"</span> + minAge);
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point we can create a <code>RuleUnitExecutor</code>, bind it to the knowledge base containing these 2 units and also create
the 2 <code>DataSource</code>s to feed the same units.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">RuleUnitExecutor executor = RuleUnitExecutor.create().bind( kbase );

DataSource&lt;Object&gt; input = executor.newDataSource( <span class="hljs-string">"input"</span> );
DataSource&lt;Person&gt; persons = executor.newDataSource( <span class="hljs-string">"persons"</span>,
                                                     <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Mario"</span>, <span class="hljs-number">42</span> ),
                                                     <span class="hljs-keyword">new</span> Person( <span class="hljs-string">"Sofia"</span>, <span class="hljs-number">4</span> ) );

List&lt;String&gt; results = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
executor.bindVariable( <span class="hljs-string">"results"</span>, results );</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are now ready to insert some objects into the input data source and execute the Unit0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ds.insert(<span class="hljs-string">"test"</span>);
ds.insert(<span class="hljs-number">3</span>);
ds.insert(<span class="hljs-number">4</span>);
executor.run(Unit0.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As outcome of this execution the results list will contain the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">[Sofia&gt;<span class="hljs-number">3</span>, Mario&gt;<span class="hljs-number">3</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As anticipated the rule unit named AgeCheckUnit is seen as a singleton and then executed only once, this time with <code>minAge</code>
equals to 3 (but this is not deterministic). Both the String "test" and the Integer 4 inserted into the input data source
could also trigger a second execution with <code>minAge</code> set to 4, but this is not happening because another unit with the same
identity has been already evaluated. To fix this problem it is enough to override the <code>getUnitIdentity()</code> method in the
<code>AgeCheckUnit</code> class to also include the variable minAge in its identity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AgeCheckUnit</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RuleUnit</span> </span>{

    ...

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Identity <span class="hljs-title">getUnitIdentity</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Identity(getClass(), minAge);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having done so, the units with minAge 3 and 4 are considered two different units and then both evaluated, so trying to rerun
the former example the result list will now contain</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">[Mario&gt;<span class="hljs-number">4</span>, Sofia&gt;<span class="hljs-number">3</span>, Mario&gt;<span class="hljs-number">3</span>]</code></pre>
</div>
</div>
<h1 id="_drools_integration" class="discrete">Drools Integration</h1>
<div class="paragraph">
<p>Integration Documentation</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.commands"><a class="anchor" href="#_ch.commands"></a><a class="link" href="#_ch.commands">12. Drools Commands</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_commandsapisection"><a class="anchor" href="#_commandsapisection"></a><a class="link" href="#_commandsapisection">12.1. API</a></h3>
<div class="paragraph">
<p>XML marshalling/unmarshalling of the Drools Commands requires the use of special classes, which are going to be described in the following sections.</p>
</div>
<div class="paragraph">
<p>The following urls show sample script examples for jaxb, xstream and json marshalling using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</a></p>
</li>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</a></p>
</li>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_xstream"><a class="anchor" href="#_xstream"></a><a class="link" href="#_xstream">12.1.1. XStream</a></h4>
<div class="paragraph">
<p>To use the XStream commands marshaller you need to use the DroolsHelperProvider to obtain an XStream instance.
We need to use this because it has the commands converters registered.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Marshalling</p>
<div class="paragraph">
<p>BatchExecutionHelperProviderImpl.newXStreamMarshaller().toXML(command);</p>
</div>
</li>
<li>
<p>Unmarshalling</p>
<div class="paragraph">
<p>BatchExecutionHelperProviderImpl.newXStreamMarshaller().fromXML(xml)</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_json"><a class="anchor" href="#_json"></a><a class="link" href="#_json">12.1.2. JSON</a></h4>
<div class="paragraph">
<p>JSON API to marshalling/unmarshalling is similar to XStream API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Marshalling</p>
<div class="paragraph">
<p>BatchExecutionHelper.newJSonMarshaller().toXML(command);</p>
</div>
</li>
<li>
<p>Unmarshalling</p>
<div class="paragraph">
<p>BatchExecutionHelper.newJSonMarshaller().fromXML(xml)</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_jaxb"><a class="anchor" href="#_jaxb"></a><a class="link" href="#_jaxb">12.1.3. JAXB</a></h4>
<div class="paragraph">
<p>There are two options for using JAXB, you can define your model in an XSD file or you can have a POJO model.
In both cases you have to declare your model inside JAXBContext, and in order to do that you need to use Drools Helper classes.
Once you have the JAXBContext you need to create the Unmarshaller/Marshaller as needed.</p>
</div>
<div class="sect4">
<h5 id="_using_an_xsd_file_to_define_the_model"><a class="anchor" href="#_using_an_xsd_file_to_define_the_model"></a><a class="link" href="#_using_an_xsd_file_to_define_the_model">12.1.3.1. Using an XSD file to define the model</a></h5>
<div class="paragraph">
<p>With your model defined in a XSD file you need to have a KnowledgeBase that has your XSD model added as a resource.</p>
</div>
<div class="paragraph">
<p>To do this, the XSD file must be added as a XSD ResourceType into the KnowledgeBuilder.
Finally you can create the JAXBContext using the KnowledgeBase created with the KnowledgeBuilder  </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Options xjcOpts = <span class="hljs-keyword">new</span> Options();
xjcOpts.setSchemaLanguage(Language.XMLSCHEMA);
JaxbConfiguration jaxbConfiguration = KnowledgeBuilderFactory.newJaxbConfiguration( xjcOpts, <span class="hljs-string">"xsd"</span> );
kbuilder.add(ResourceFactory.newClassPathResource(<span class="hljs-string">"person.xsd"</span>, getClass()), ResourceType.XSD, jaxbConfiguration);
KnowledgeBase kbase = kbuilder.newKnowledgeBase();

List&lt;String&gt; classesName = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();
classesName.add(<span class="hljs-string">"org.drools.compiler.test.Person"</span>);

JAXBContext jaxbContext = KnowledgeBuilderHelper.newJAXBContext(classesName.toArray(<span class="hljs-keyword">new</span> String[classesName.size()]), kbase);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_a_pojo_model"><a class="anchor" href="#_using_a_pojo_model"></a><a class="link" href="#_using_a_pojo_model">12.1.3.2. Using a POJO model</a></h5>
<div class="paragraph">
<p>In this case you need to use DroolsJaxbHelperProviderImpl to create the JAXBContext.
This class has two parameters:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>classNames: A List with the canonical name of the classes that you want to use in the marshalling/unmarshalling process.</p>
</li>
<li>
<p>properties: JAXB custom properties</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;String&gt; classNames = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();
classNames.add(<span class="hljs-string">"org.drools.compiler.test.Person"</span>);
JAXBContext jaxbContext = DroolsJaxbHelperProviderImpl.createDroolsJaxbContext(classNames, <span class="hljs-keyword">null</span>);
Marshaller marshaller = jaxbContext.createMarshaller();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_commands_supported"><a class="anchor" href="#_commands_supported"></a><a class="link" href="#_commands_supported">12.2. Commands supported</a></h3>
<div class="paragraph">
<p>Currently, the following commands are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BatchExecutionCommand</p>
</li>
<li>
<p>InsertObjectCommand</p>
</li>
<li>
<p>RetractCommand</p>
</li>
<li>
<p>ModifyCommand</p>
</li>
<li>
<p>GetObjectCommand</p>
</li>
<li>
<p>InsertElementsCommand</p>
</li>
<li>
<p>FireAllRulesCommand</p>
</li>
<li>
<p>StartProcessCommand</p>
</li>
<li>
<p>SignalEventCommand</p>
</li>
<li>
<p>CompleteWorkItemCommand</p>
</li>
<li>
<p>AbortWorkItemCommand</p>
</li>
<li>
<p>QueryCommand</p>
</li>
<li>
<p>SetGlobalCommand</p>
</li>
<li>
<p>GetGlobalCommand</p>
</li>
<li>
<p>GetObjectsCommand</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the next snippets code we are going to use a POJO org.drools.compiler.test.Person that has two fields</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name: String</p>
</li>
<li>
<p>age: Integer</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the next examples, to marshall the commands we have used the next snippet codes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String xml = BatchExecutionHelper.newXStreamMarshaller().toXML(command);</code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String xml = BatchExecutionHelper.newJSonMarshaller().toXML(command);</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Marshaller marshaller = jaxbContext.createMarshaller();
StringWriter xml = <span class="hljs-keyword">new</span> StringWriter();
marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, <span class="hljs-keyword">true</span>);
marshaller.marshal(command, xml);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_batchexecutioncommand"><a class="anchor" href="#_batchexecutioncommand"></a><a class="link" href="#_batchexecutioncommand">12.2.1. BatchExecutionCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: The command that contains a list of commands, which will be sent and executed.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 13. BatchExecutionCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lookup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the knowledge session id on which the commands are
              going to be executed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commands</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of commands to be executed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
InsertObjectCommand insertObjectCommand = <span class="hljs-keyword">new</span> InsertObjectCommand(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"john"</span>, <span class="hljs-number">25</span>));
FireAllRulesCommand fireAllRulesCommand = <span class="hljs-keyword">new</span> FireAllRulesCommand();
command.getCommands().add(insertObjectCommand);
command.getCommands().add(fireAllRulesCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">insert</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.test.Person</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>john<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.test.Person</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">insert</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">fire-all-rules</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">[{"<span class="hljs-attribute">insert</span>":<span class="hljs-value">{"<span class="hljs-attribute">object</span>":<span class="hljs-value">{"<span class="hljs-attribute">org.drools.compiler.test.Person</span>":<span class="hljs-value">{"<span class="hljs-attribute">name</span>":<span class="hljs-value"><span class="hljs-string">"john"</span></span>,"<span class="hljs-attribute">age</span>":<span class="hljs-value"><span class="hljs-number">25</span></span>}</span>}</span>}</span>},{"<span class="hljs-attribute">fire-all-rules</span>":<span class="hljs-value"><span class="hljs-string">""</span></span>}]</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">insert</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"person"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>john<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">insert</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">fire-all-rules</span> <span class="hljs-attribute">max</span>=<span class="hljs-value">"-1"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_insertobjectcommand"><a class="anchor" href="#_insertobjectcommand"></a><a class="link" href="#_insertobjectcommand">12.2.2. InsertObjectCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Insert an object in the knowledge session.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 14. InsertObjectCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The object to be inserted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outIdentifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id to identify the FactHandle created in the object
              insertion and added to the execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">returnObject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to establish if the object must be returned in
              the execution results. Default value: true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entryPoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entrypoint for the insertion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Command&gt; cmds = ArrayList&lt;Command&gt;();

Command insertObjectCommand = CommandFactory.newInsert(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"john"</span>, <span class="hljs-number">25</span>), <span class="hljs-string">"john"</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);
cmds.add( insertObjectCommand );

BatchExecutionCommand command = CommandFactory.createBatchExecution(cmds, <span class="hljs-string">"ksession1"</span> );</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">insert</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"john"</span> <span class="hljs-attribute">entry-point</span>=<span class="hljs-value">"my stream"</span> <span class="hljs-attribute">return-object</span>=<span class="hljs-value">"false"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.test.Person</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>john<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.test.Person</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">insert</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">insert</span>":<span class="hljs-value">{"<span class="hljs-attribute">entry-point</span>":<span class="hljs-value"><span class="hljs-string">"my stream"</span></span>, "<span class="hljs-attribute">out-identifier</span>":<span class="hljs-value"><span class="hljs-string">"john"</span></span>,"<span class="hljs-attribute">return-object</span>":<span class="hljs-value"><span class="hljs-literal">false</span></span>,"<span class="hljs-attribute">object</span>":<span class="hljs-value">{"<span class="hljs-attribute">org.drools.compiler.test.Person</span>":<span class="hljs-value">{"<span class="hljs-attribute">name</span>":<span class="hljs-value"><span class="hljs-string">"john"</span></span>,"<span class="hljs-attribute">age</span>":<span class="hljs-value"><span class="hljs-number">25</span></span>}</span>}</span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">insert</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"john"</span> <span class="hljs-attribute">entry-point</span>=<span class="hljs-value">"my stream"</span> &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"person"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>john<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">insert</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_retractcommand"><a class="anchor" href="#_retractcommand"></a><a class="link" href="#_retractcommand">12.2.3. RetractCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Retract an object from the knowledge session.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 15. RetractCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">handle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The FactHandle associated to the object to be
              retracted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation: we have two options, with the same output result:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create the Fact Handle from a string</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
RetractCommand retractCommand = <span class="hljs-keyword">new</span> RetractCommand();
retractCommand.setFactHandleFromString(<span class="hljs-string">"123:234:345:456:567"</span>);
command.getCommands().add(retractCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>Set the Fact Handle that you received when the object was inserted</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
RetractCommand retractCommand = <span class="hljs-keyword">new</span> RetractCommand(factHandle);
command.getCommands().add(retractCommand);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">retract</span> <span class="hljs-attribute">fact-handle</span>=<span class="hljs-value">"0:234:345:456:567"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">retract</span>":<span class="hljs-value">{"<span class="hljs-attribute">fact-handle</span>":<span class="hljs-value"><span class="hljs-string">"0:234:345:456:567"</span></span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">retract</span> <span class="hljs-attribute">fact-handle</span>=<span class="hljs-value">"0:234:345:456:567"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_modifycommand"><a class="anchor" href="#_modifycommand"></a><a class="link" href="#_modifycommand">12.2.4. ModifyCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Allows you to modify a previously inserted object in the knowledge session.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 16. ModifyCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">handle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The FactHandle associated to the object to be
              retracted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">setters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of setters object’s modifications</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
ModifyCommand modifyCommand = <span class="hljs-keyword">new</span> ModifyCommand();
modifyCommand.setFactHandleFromString(<span class="hljs-string">"123:234:345:456:567"</span>);
List&lt;Setter&gt; setters = <span class="hljs-keyword">new</span> ArrayList&lt;Setter&gt;();
setters.add(<span class="hljs-keyword">new</span> SetterImpl(<span class="hljs-string">"age"</span>, <span class="hljs-string">"30"</span>));
modifyCommand.setSetters(setters);
command.getCommands().add(modifyCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">modify</span> <span class="hljs-attribute">fact-handle</span>=<span class="hljs-value">"0:234:345:456:567"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">set</span> <span class="hljs-attribute">accessor</span>=<span class="hljs-value">"age"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"30"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">modify</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">modify</span>":<span class="hljs-value">{"<span class="hljs-attribute">fact-handle</span>":<span class="hljs-value"><span class="hljs-string">"0:234:345:456:567"</span></span>,"<span class="hljs-attribute">setters</span>":<span class="hljs-value">{"<span class="hljs-attribute">accessor</span>":<span class="hljs-value"><span class="hljs-string">"age"</span></span>,"<span class="hljs-attribute">value</span>":<span class="hljs-value"><span class="hljs-number">30</span></span>}</span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">modify</span> <span class="hljs-attribute">fact-handle</span>=<span class="hljs-value">"0:234:345:456:567"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">set</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"30"</span> <span class="hljs-attribute">accessor</span>=<span class="hljs-value">"age"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">modify</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_getobjectcommand"><a class="anchor" href="#_getobjectcommand"></a><a class="link" href="#_getobjectcommand">12.2.5. GetObjectCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Used to get an object from a knowledge session</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 17. GetObjectCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">factHandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The FactHandle associated to the object to be
              retracted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outIdentifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id to identify the FactHandle created in the object
              insertion and added to the execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
GetObjectCommand getObjectCommand = <span class="hljs-keyword">new</span> GetObjectCommand();
getObjectCommand.setFactHandleFromString(<span class="hljs-string">"123:234:345:456:567"</span>);
getObjectCommand.setOutIdentifier(<span class="hljs-string">"john"</span>);
command.getCommands().add(getObjectCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">get-object</span> <span class="hljs-attribute">fact-handle</span>=<span class="hljs-value">"0:234:345:456:567"</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"john"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">get-object</span>":<span class="hljs-value">{"<span class="hljs-attribute">fact-handle</span>":<span class="hljs-value"><span class="hljs-string">"0:234:345:456:567"</span></span>,"<span class="hljs-attribute">out-identifier</span>":<span class="hljs-value"><span class="hljs-string">"john"</span></span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">get-object</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"john"</span> <span class="hljs-attribute">fact-handle</span>=<span class="hljs-value">"0:234:345:456:567"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_insertelementscommand"><a class="anchor" href="#_insertelementscommand"></a><a class="link" href="#_insertelementscommand">12.2.6. InsertElementsCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Used to insert a list of objects.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 18. InsertElementsCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">objects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of objects to be inserted on the knowledge
              session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outIdentifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id to identify the FactHandle created in the object
              insertion and added to the execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">returnObject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean to establish if the object must be returned in
              the execution results. Default value: true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entryPoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entrypoint for the insertion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;Command&gt; cmds = ArrayList&lt;Command&gt;();

List&lt;Object&gt; objects = <span class="hljs-keyword">new</span> ArrayList&lt;Object&gt;();
objects.add(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"john"</span>, <span class="hljs-number">25</span>));
objects.add(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"sarah"</span>, <span class="hljs-number">35</span>));

Command insertElementsCommand = CommandFactory.newInsertElements( objects );
cmds.add( insertElementsCommand );

BatchExecutionCommand command = CommandFactory.createBatchExecution(cmds, <span class="hljs-string">"ksession1"</span> );</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">insert-elements</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.test.Person</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>john<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.test.Person</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.test.Person</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>sarah<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>35<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.test.Person</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">insert-elements</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">insert-elements</span>":<span class="hljs-value">{"<span class="hljs-attribute">objects</span>":<span class="hljs-value">[{"<span class="hljs-attribute">containedObject</span>":<span class="hljs-value">{"<span class="hljs-attribute">@class</span>":<span class="hljs-value"><span class="hljs-string">"org.drools.compiler.test.Person"</span></span>,"<span class="hljs-attribute">name</span>":<span class="hljs-value"><span class="hljs-string">"john"</span></span>,"<span class="hljs-attribute">age</span>":<span class="hljs-value"><span class="hljs-number">25</span></span>}</span>},{"<span class="hljs-attribute">containedObject</span>":<span class="hljs-value">{"<span class="hljs-attribute">@class</span>":<span class="hljs-value"><span class="hljs-string">"Person"</span></span>,"<span class="hljs-attribute">name</span>":<span class="hljs-value"><span class="hljs-string">"sarah"</span></span>,"<span class="hljs-attribute">age</span>":<span class="hljs-value"><span class="hljs-number">35</span></span>}</span>}]</span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">insert-elements</span> <span class="hljs-attribute">return-objects</span>=<span class="hljs-value">"true"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">list</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">element</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"person"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>john<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">element</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">element</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"person"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>35<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>sarah<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">element</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">list</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">insert-elements</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_fireallrulescommand"><a class="anchor" href="#_fireallrulescommand"></a><a class="link" href="#_fireallrulescommand">12.2.7. FireAllRulesCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Allow execution of the rules activations created.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 19. FireAllRulesCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The max number of rules activations to be executed.
              default is -1 and will not put any restriction on
              execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outIdentifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add the number of rules activations fired on the
              execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">agendaFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow the rules execution using an Agenda Filter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
FireAllRulesCommand fireAllRulesCommand = <span class="hljs-keyword">new</span> FireAllRulesCommand();
fireAllRulesCommand.setMax(<span class="hljs-number">10</span>);
fireAllRulesCommand.setOutIdentifier(<span class="hljs-string">"firedActivations"</span>);
command.getCommands().add(fireAllRulesCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">fire-all-rules</span> <span class="hljs-attribute">max</span>=<span class="hljs-value">"10"</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"firedActivations"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">fire-all-rules</span>":<span class="hljs-value">{"<span class="hljs-attribute">max</span>":<span class="hljs-value"><span class="hljs-number">10</span></span>,"<span class="hljs-attribute">out-identifier</span>":<span class="hljs-value"><span class="hljs-string">"firedActivations"</span></span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">fire-all-rules</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"firedActivations"</span> <span class="hljs-attribute">max</span>=<span class="hljs-value">"10"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_startprocesscommand"><a class="anchor" href="#_startprocesscommand"></a><a class="link" href="#_startprocesscommand">12.2.8. StartProcessCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Allows you to start a process using the ID. Also you can pass parameters and initial data to be inserted.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 20. StartProcessCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the process to be started</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Map&lt;String, Object&gt; to pass parameters in the
              process startup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of objects to be inserted in the knowledge session
              before the process startup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
StartProcessCommand startProcessCommand = <span class="hljs-keyword">new</span> StartProcessCommand();
startProcessCommand.setProcessId(<span class="hljs-string">"org.drools.task.processOne"</span>);
command.getCommands().add(startProcessCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">start-process</span> <span class="hljs-attribute">processId</span>=<span class="hljs-value">"org.drools.task.processOne"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">start-process</span>":<span class="hljs-value">{"<span class="hljs-attribute">process-id</span>":<span class="hljs-value"><span class="hljs-string">"org.drools.task.processOne"</span></span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">start-process</span> <span class="hljs-attribute">processId</span>=<span class="hljs-value">"org.drools.task.processOne"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">parameter</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">start-process</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_signaleventcommand"><a class="anchor" href="#_signaleventcommand"></a><a class="link" href="#_signaleventcommand">12.2.9. SignalEventCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Send a signal event.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 21. SignalEventCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">event-type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">event</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
SignalEventCommand signalEventCommand = <span class="hljs-keyword">new</span> SignalEventCommand();
signalEventCommand.setProcessInstanceId(<span class="hljs-number">1001</span>);
signalEventCommand.setEventType(<span class="hljs-string">"start"</span>);
signalEventCommand.setEvent(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"john"</span>, <span class="hljs-number">25</span>));
command.getCommands().add(signalEventCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">signal-event</span> <span class="hljs-attribute">process-instance-id</span>=<span class="hljs-value">"1001"</span> <span class="hljs-attribute">event-type</span>=<span class="hljs-value">"start"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.pipeline.camel.Person</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>john<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.pipeline.camel.Person</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">signal-event</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">signal-event</span>":<span class="hljs-value">{"<span class="hljs-attribute">process-instance-id</span>":<span class="hljs-value"><span class="hljs-number">1001</span></span>,"<span class="hljs-attribute">@event-type</span>":<span class="hljs-value"><span class="hljs-string">"start"</span></span>,"<span class="hljs-attribute">event-type</span>":<span class="hljs-value"><span class="hljs-string">"start"</span></span>,"<span class="hljs-attribute">object</span>":<span class="hljs-value">{"<span class="hljs-attribute">org.drools.pipeline.camel.Person</span>":<span class="hljs-value">{"<span class="hljs-attribute">name</span>":<span class="hljs-value"><span class="hljs-string">"john"</span></span>,"<span class="hljs-attribute">age</span>":<span class="hljs-value"><span class="hljs-number">25</span></span>}</span>}</span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">signal-event</span> <span class="hljs-attribute">event-type</span>=<span class="hljs-value">"start"</span> <span class="hljs-attribute">process-instance-id</span>=<span class="hljs-value">"1001"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">event</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"person"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>john<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">event</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">signal-event</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_completeworkitemcommand"><a class="anchor" href="#_completeworkitemcommand"></a><a class="link" href="#_completeworkitemcommand">12.2.10. CompleteWorkItemCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Allows you to complete a WorkItem.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 22. CompleteWorkItemCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">workItemId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the WorkItem to be completed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">results</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
CompleteWorkItemCommand completeWorkItemCommand = <span class="hljs-keyword">new</span> CompleteWorkItemCommand();
completeWorkItemCommand.setWorkItemId(<span class="hljs-number">1001</span>);
command.getCommands().add(completeWorkItemCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">complete-work-item</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"1001"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">complete-work-item</span>":<span class="hljs-value">{"<span class="hljs-attribute">id</span>":<span class="hljs-value"><span class="hljs-number">1001</span></span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">complete-work-item</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"1001"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_abortworkitemcommand"><a class="anchor" href="#_abortworkitemcommand"></a><a class="link" href="#_abortworkitemcommand">12.2.11. AbortWorkItemCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Allows you abort an WorkItem. The same as session.getWorkItemManager().abortWorkItem(workItemId)</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 23. AbortWorkItemCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">workItemId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the WorkItem to be completed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
AbortWorkItemCommand abortWorkItemCommand = <span class="hljs-keyword">new</span> AbortWorkItemCommand();
abortWorkItemCommand.setWorkItemId(<span class="hljs-number">1001</span>);
command.getCommands().add(abortWorkItemCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">abort-work-item</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"1001"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">abort-work-item</span>":<span class="hljs-value">{"<span class="hljs-attribute">id</span>":<span class="hljs-value"><span class="hljs-number">1001</span></span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">abort-work-item</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"1001"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_querycommand"><a class="anchor" href="#_querycommand"></a><a class="link" href="#_querycommand">12.2.12. QueryCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Executes a query defined in knowledge base.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 24. QueryCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The query name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outIdentifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the query results. The query results
              are going to be added in the execution results with this
              identifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of objects to be passed as a query
              parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
QueryCommand queryCommand = <span class="hljs-keyword">new</span> QueryCommand();
queryCommand.setName(<span class="hljs-string">"persons"</span>);
queryCommand.setOutIdentifier(<span class="hljs-string">"persons"</span>);
command.getCommands().add(queryCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">query</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"persons"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"persons"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">query</span>":<span class="hljs-value">{"<span class="hljs-attribute">out-identifier</span>":<span class="hljs-value"><span class="hljs-string">"persons"</span></span>,"<span class="hljs-attribute">name</span>":<span class="hljs-value"><span class="hljs-string">"persons"</span></span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">query</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"persons"</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"persons"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_setglobalcommand"><a class="anchor" href="#_setglobalcommand"></a><a class="link" href="#_setglobalcommand">12.2.13. SetGlobalCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Allows you to set a global.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 25. SetGlobalCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the global defined in the knowledge
              base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The object to be set into the global</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean to add, or not, the set global result into the
              execution results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outIdentifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the global execution result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
SetGlobalCommand setGlobalCommand = <span class="hljs-keyword">new</span> SetGlobalCommand();
setGlobalCommand.setIdentifier(<span class="hljs-string">"helper"</span>);
setGlobalCommand.setObject(<span class="hljs-keyword">new</span> Person(<span class="hljs-string">"kyle"</span>, <span class="hljs-number">30</span>));
setGlobalCommand.setOut(<span class="hljs-keyword">true</span>);
setGlobalCommand.setOutIdentifier(<span class="hljs-string">"output"</span>);
command.getCommands().add(setGlobalCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">set-global</span> <span class="hljs-attribute">identifier</span>=<span class="hljs-value">"helper"</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"output"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">org.drools.compiler.test.Person</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>kyle<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">org.drools.compiler.test.Person</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">set-global</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">set-global</span>":<span class="hljs-value">{"<span class="hljs-attribute">identifier</span>":<span class="hljs-value"><span class="hljs-string">"helper"</span></span>,"<span class="hljs-attribute">out-identifier</span>":<span class="hljs-value"><span class="hljs-string">"output"</span></span>,"<span class="hljs-attribute">object</span>":<span class="hljs-value">{"<span class="hljs-attribute">org.drools.compiler.test.Person</span>":<span class="hljs-value">{"<span class="hljs-attribute">name</span>":<span class="hljs-value"><span class="hljs-string">"kyle"</span></span>,"<span class="hljs-attribute">age</span>":<span class="hljs-value"><span class="hljs-number">30</span></span>}</span>}</span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">set-global</span> <span class="hljs-attribute">out</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"output"</span> <span class="hljs-attribute">identifier</span>=<span class="hljs-value">"helper"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"person"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">age</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-title">age</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">name</span>&gt;</span>kyle<span class="hljs-tag">&lt;/<span class="hljs-title">name</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">set-global</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_getglobalcommand"><a class="anchor" href="#_getglobalcommand"></a><a class="link" href="#_getglobalcommand">12.2.14. GetGlobalCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Allows you to get a global previously defined.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 26. GetGlobalCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">identifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier of the global defined in the knowledge
              base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outIdentifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier to be used in the execution
              results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
GetGlobalCommand getGlobalCommand = <span class="hljs-keyword">new</span> GetGlobalCommand();
getGlobalCommand.setIdentifier(<span class="hljs-string">"helper"</span>);
getGlobalCommand.setOutIdentifier(<span class="hljs-string">"helperOutput"</span>);
command.getCommands().add(getGlobalCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">get-global</span> <span class="hljs-attribute">identifier</span>=<span class="hljs-value">"helper"</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"helperOutput"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">get-global</span>":<span class="hljs-value">{"<span class="hljs-attribute">identifier</span>":<span class="hljs-value"><span class="hljs-string">"helper"</span></span>,"<span class="hljs-attribute">out-identifier</span>":<span class="hljs-value"><span class="hljs-string">"helperOutput"</span></span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">get-global</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"helperOutput"</span> <span class="hljs-attribute">identifier</span>=<span class="hljs-value">"helper"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_getobjectscommand"><a class="anchor" href="#_getobjectscommand"></a><a class="link" href="#_getobjectscommand">12.2.15. GetObjectsCommand</a></h4>
<div class="ulist">
<ul>
<li>
<p>Description: Returns all the objects from the current session as a Collection.</p>
</li>
<li>
<p>Attributes</p>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 27. GetObjectsCommand attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">objectFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An ObjectFilter to filter the objects returned from the
              current session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outIdentifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identifier to be used in the execution
              results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Command creation</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">BatchExecutionCommand command = <span class="hljs-keyword">new</span> BatchExecutionCommand();
command.setLookup(<span class="hljs-string">"ksession1"</span>);
GetObjectsCommand getObjectsCommand = <span class="hljs-keyword">new</span> GetObjectsCommand();
getObjectsCommand.setOutIdentifier(<span class="hljs-string">"objects"</span>);
command.getCommands().add(getObjectsCommand);</code></pre>
</div>
</div>
</li>
<li>
<p>XML output</p>
<div class="ulist">
<ul>
<li>
<p>XStream</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">get-objects</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"objects"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>JSON</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs json">{"<span class="hljs-attribute">batch-execution</span>":<span class="hljs-value">{"<span class="hljs-attribute">lookup</span>":<span class="hljs-value"><span class="hljs-string">"ksession1"</span></span>,"<span class="hljs-attribute">commands</span>":<span class="hljs-value">{"<span class="hljs-attribute">get-objects</span>":<span class="hljs-value">{"<span class="hljs-attribute">out-identifier</span>":<span class="hljs-value"><span class="hljs-string">"objects"</span></span>}</span>}</span>}</span>}</code></pre>
</div>
</div>
</li>
<li>
<p>JAXB</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">batch-execution</span> <span class="hljs-attribute">lookup</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">get-objects</span> <span class="hljs-attribute">out-identifier</span>=<span class="hljs-value">"objects"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">batch-execution</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cdichapter"><a class="anchor" href="#_cdichapter"></a><a class="link" href="#_cdichapter">13. CDI</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a><a class="link" href="#_introduction_2">13.1. Introduction</a></h3>
<div class="paragraph">
<p><a href="http://www.cdi-spec.org/">CDI</a>, Contexts and  Dependency Injection, is Java specification that provides declarative controls and strucutres to an application.
KIE can use it to automatically instantiate and bind things, without the need to use the programmatic API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_annotations"><a class="anchor" href="#_annotations"></a><a class="link" href="#_annotations">13.2. Annotations</a></h3>
<div class="paragraph">
<p>@KContainer, @KBase and @KSession all support an optional 'name' attribute.
CDI typically does "getOrCreate" when it injects, all injections receive the same instance for the same set of annotations.
the 'name' annotation forces a unique instance for each name, although all instance for that name will be identity equals.</p>
</div>
<div class="sect3">
<h4 id="__kreleaseid"><a class="anchor" href="#__kreleaseid"></a><a class="link" href="#__kreleaseid">13.2.1. @KReleaseId</a></h4>
<div class="paragraph">
<p>Used to bind an instance to a specific version of a KieModule.
If kie-ci is on the classpath this will resolve dependencies automatically, downloading from remote repositories.</p>
</div>
</div>
<div class="sect3">
<h4 id="__kcontainer"><a class="anchor" href="#__kcontainer"></a><a class="link" href="#__kcontainer">13.2.2. @KContainer</a></h4>
<div class="paragraph">
<p>@KContainer is optional as it can be detected and added by the use of @Inject and variable type inferrence.</p>
</div>
<div class="listingblock">
<div class="title">Injects Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-keyword">private</span> KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects KieContainer for Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KReleaseId</span>(groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects named KieContainer for Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KContainer</span>(name = <span class="hljs-string">"kc1"</span>)
<span class="hljs-annotation">@KReleaseId</span>(groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieContainer kContainer;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__kbase"><a class="anchor" href="#__kbase"></a><a class="link" href="#__kbase">13.2.3. @KBase</a></h4>
<div class="paragraph">
<p>@KBase is optional as it can be detected and added by the use of @Inject and variable type inference.</p>
</div>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieBase from the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieBase from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-keyword">private</span> KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieBase from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KBase</span>(<span class="hljs-string">"kbase1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieBase kbase1v10;

<span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KBase</span>(<span class="hljs-string">"kbase1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieBase kbase1v10;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Use 'name' attribute to force new Instance for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(value=<span class="hljs-string">"kbase1"</span>, name=<span class="hljs-string">"kb1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieBase kbase1kb1;

<span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(value=<span class="hljs-string">"kbase1"</span>, name=<span class="hljs-string">"kb2"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieBase kbase1kb2;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__ksession_for_kiesession"><a class="anchor" href="#__ksession_for_kiesession"></a><a class="link" href="#__ksession_for_kiesession">13.2.4. @KSession for KieSession</a></h4>
<div class="paragraph">
<p>@KSession is optional as it can be detected and added by the use of @Inject and variable type inference.</p>
</div>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml file</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-keyword">private</span> KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieSession from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieSession ksessionv10;

<span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Use 'name' attribute to force new Instance for 'jar1.KBase1' KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(value=<span class="hljs-string">"ksession1"</span>, name=<span class="hljs-string">"ks1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieSession ksession1ks1

<span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(value=<span class="hljs-string">"ksession1"</span>, name=<span class="hljs-string">"ks2"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieSession ksession1ks2</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__ksession_for_statelesskiesession"><a class="anchor" href="#__ksession_for_statelesskiesession"></a><a class="link" href="#__ksession_for_statelesskiesession">13.2.5. @KSession for StatelessKieSession</a></h4>
<div class="paragraph">
<p>@KSession is optional as it can be detected and added by the use of @Inject and variable type inference.</p>
</div>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default StatelessKieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-keyword">private</span> StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default StatelessKieSession from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, rtifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksessionv10;

<span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, rtifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Use 'name' attribute to force new Instance for 'jar1.KBase1’StatelessKieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(value=<span class="hljs-string">"ksession1"</span>, name=<span class="hljs-string">"ks1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksession1ks1

<span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(value=<span class="hljs-string">"ksession1"</span>, name=<span class="hljs-string">"ks2"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksession1ks2</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_api_example_comparison"><a class="anchor" href="#_api_example_comparison"></a><a class="link" href="#_api_example_comparison">13.3. API Example Comparison</a></h3>
<div class="paragraph">
<p>CDI can inject instances into fields, or even pass them as arguments.
In this example field injection is used.</p>
</div>
<div class="listingblock">
<div class="title">CDI example for a named KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
KieSession kSession;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">go</span><span class="hljs-params">(PrintStream out)</span> </span>{
    kSession.setGlobal(<span class="hljs-string">"out"</span>, out);
    kSession.insert(<span class="hljs-keyword">new</span> Message(<span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>));
    kSession.fireAllRules();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is less code and more declarative than the API approach.</p>
</div>
<div class="listingblock">
<div class="title">API equivalent example for a named KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">go</span><span class="hljs-params">(PrintStream out)</span> </span>{
    KieServices ks = KieServices.Factory.get();
    KieContainer kContainer = ks.getKieClasspathContainer();

    KieSession kSession = kContainer.newKieSession(<span class="hljs-string">"ksession1"</span>);
    kSession.setGlobal(<span class="hljs-string">"out"</span>, out);
    kSession.insert(<span class="hljs-keyword">new</span> Message(<span class="hljs-string">"Dave"</span>, <span class="hljs-string">"Hello, HAL. Do you read me, HAL?"</span>));
    kSession.fireAllRules();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.spring"><a class="anchor" href="#_ch.kie.spring"></a><a class="link" href="#_ch.kie.spring">14. Integration with Spring</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_important_changes_for_drools_6_0"><a class="anchor" href="#_important_changes_for_drools_6_0"></a><a class="link" href="#_important_changes_for_drools_6_0">14.1. Important Changes for Drools 6.0</a></h3>
<div class="paragraph">
<p>Drools Spring integration has undergone a complete makeover inline with the changes for Drools 6.0.
The following are some of the major changes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The recommended prefix for the Drools Spring has changed from 'drools:' to 'kie:'</p>
</li>
<li>
<p>New Top Level Tags in 6.0</p>
<div class="ulist">
<ul>
<li>
<p>kie:kmodule</p>
</li>
<li>
<p>kie:import (from version 6.2)</p>
</li>
<li>
<p>kie:releaseId (from version 6.2)</p>
</li>
</ul>
</div>
</li>
<li>
<p>The following tags are no longer valid as top level tags.</p>
<div class="ulist">
<ul>
<li>
<p>kie:kbase - A child of the <em>kie:kmodule</em> tag.</p>
</li>
<li>
<p>kie:ksession - A child of the <em>kie:kbase</em> tag.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Removed Tags from previous versions Drools 5.x</p>
<div class="ulist">
<ul>
<li>
<p>drools:resources</p>
</li>
<li>
<p>drools:resource</p>
</li>
<li>
<p>drools:grid</p>
</li>
<li>
<p>drools:grid-node</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_drools_expert"><a class="anchor" href="#_integration_with_drools_expert"></a><a class="link" href="#_integration_with_drools_expert">14.2. Integration with Drools Expert</a></h3>
<div class="paragraph">
<p>In this section we will explain the <em>kie</em> namespace.</p>
</div>
<div class="sect3">
<h4 id="_kiemodule"><a class="anchor" href="#_kiemodule"></a><a class="link" href="#_kiemodule">14.2.1. KieModule</a></h4>
<div class="paragraph">
<p>The <em>&lt;kie:kmodule&gt;</em> defines a collection of KieBase and associated KieSession’s.
The <em>kmodule</em> tag has one MANDATORY parameter 'id'.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 28. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean’s <em>id</em> is the name to be
              referenced from other beans. Standard Spring ID semantics
              apply.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <em>kmodule</em> tag can contain only the following tags as children.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kie:kbase</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to the documentation of kmodule.xml in the Drools Expert documentation for detailed explanation of the need for kmodule.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiebase_3"><a class="anchor" href="#_kiebase_3"></a><a class="link" href="#_kiebase_3">14.2.2. KieBase</a></h4>
<div class="sect4">
<h5 id="__kie_kbase_s_parameters_as_attributes"><a class="anchor" href="#__kie_kbase_s_parameters_as_attributes"></a><a class="link" href="#__kie_kbase_s_parameters_as_attributes">14.2.2.1. &lt;kie:kbase&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 29. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the KieBase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of resource packages to be
                included in this kbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kbase names to be included. All resources from the
                corresponding kbase are included in this kbase.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean (TRUE/FALSE). Default kbase, if not provided,
                it is assumed to be FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prototype | singleton. If not provided assumed to be singleton (default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eventProcessingMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event Processing Mode. Valid options are STREAM,
                CLOUD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">equalsBehavior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid options are IDENTITY, EQUALITY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">declarativeAgenda</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid options are enabled, disabled, true,
                false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_a_em_kbase_em_tag_can_contain_only_the_followingtags_as_children"><a class="anchor" href="#_a_em_kbase_em_tag_can_contain_only_the_followingtags_as_children"></a><a class="link" href="#_a_em_kbase_em_tag_can_contain_only_the_followingtags_as_children">14.2.2.2. A <em>kbase</em> tag can contain only the followingtags as children.</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie:ksession</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="__kie_kbase_s_definition_example"><a class="anchor" href="#__kie_kbase_s_definition_example"></a><a class="link" href="#__kie_kbase_s_definition_example">14.2.2.3. &lt;kie:kbase&gt;'s definition example</a></h5>
<div class="paragraph">
<p>A kmodule can contain multiple (1..n) kbase elements.</p>
</div>
<div class="exampleblock">
<div class="title">Example 191. kbase definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sample_module"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase1"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.drools.spring.sample"</span>&gt;</span>
     ...
   <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spring_bean_scope_for_kiebase_and_kiesession"><a class="anchor" href="#_spring_bean_scope_for_kiebase_and_kiesession"></a><a class="link" href="#_spring_bean_scope_for_kiebase_and_kiesession">14.2.2.4. Spring Bean Scope (for KieBase and KieSession)</a></h5>
<div class="paragraph">
<p>When defining a KieBase or a KieSession, you have the option of declaring a scope for that bean.
For example, To force Spring to produce a new bean instance each time one is needed, you should declare the bean’s scope attribute to be 'prototype'. Similar way if you want Spring to return the same bean instance each time one is needed, you should declare the bean’s scope attribute to be 'singleton'.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_important_note"><a class="anchor" href="#_important_note"></a><a class="link" href="#_important_note">14.2.3. IMPORTANT NOTE</a></h4>
<div class="paragraph">
<p>For proper initialization of the kmodule objects (kbase/ksession), it is mandatory for a bean of type <code>org.kie.spring.KModuleBeanFactoryPostProcessor</code> or <code>org.kie.spring.annotations.KModuleAnnotationPostProcessor</code> be defined.</p>
</div>
<div class="exampleblock">
<div class="title">Example 192. Regular kie-spring post processorbean definition</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 193. kie-spring post processorbean definition when annotations are used</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.annotations.KModuleAnnotationPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Without the org.kie.spring.KModuleBeanFactoryPostProcessor or org.kie.spring.annotations.KModuleAnnotationPostProcessor bean definition, the kie-spring integration will fail to work.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_kiesessions"><a class="anchor" href="#_kiesessions"></a><a class="link" href="#_kiesessions">14.2.4. KieSessions</a></h4>
<div class="paragraph">
<p>&lt;kie:ksession&gt; element defines KieSessions.
The same tag is used to define both Stateful (<em>org.kie.api.runtime.KieSession</em>) and Stateless (<em>org.kie.api.runtime.StatelessKieSession</em>) sessions.</p>
</div>
<div class="sect4">
<h5 id="__kie_ksession_s_parameters_as_attributes"><a class="anchor" href="#__kie_ksession_s_parameters_as_attributes"></a><a class="link" href="#__kie_ksession_s_parameters_as_attributes">14.2.4.1. &lt;kie:ksession&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 30. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ksession’s name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is the session <em>stateful</em> or
                <em>stateless?</em>. If this attribute is empty or
                missing, the session is assumed to be of type
                Stateful.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is this the default session?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prototype | singleton. If not provided assumed to be singleton (default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clockType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REALTIME or PSEUDO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listeners-ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the reference to the event listeners group
                (see <a href="#_kie_grouping_listeners">'Defining a Group
                of listeners'</a> section below).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 194. ksession definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sample-kmodule"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample3"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateless"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession2"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spring_bean_scope_for_kiebase_and_kiesession_2"><a class="anchor" href="#_spring_bean_scope_for_kiebase_and_kiesession_2"></a><a class="link" href="#_spring_bean_scope_for_kiebase_and_kiesession_2">14.2.4.2. Spring Bean Scope (for KieBase and KieSession)</a></h5>
<div class="paragraph">
<p>When defining a KieBase or a KieSession, you have the option of declaring a scope for that bean.
For example, To force Spring to produce a new bean instance each time one is needed, you should declare the bean’s scope attribute to be 'prototype'. Similar way if you want Spring to return the same bean instance each time one is needed, you should declare the bean’s scope attribute to be 'singleton'.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kie_releaseid"><a class="anchor" href="#_kie_releaseid"></a><a class="link" href="#_kie_releaseid">14.2.5. Kie:ReleaseId</a></h4>
<div class="sect4">
<h5 id="__kie_releaseid_s_parameters_as_attributes"><a class="anchor" href="#__kie_releaseid_s_parameters_as_attributes"></a><a class="link" href="#__kie_releaseid_s_parameters_as_attributes">14.2.5.1. &lt;kie:releaseId&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 31. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean’s <em>id</em> is the name to be
                  referenced from other beans. Standard Spring ID semantics
                  apply.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId from Maven GAV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifactId from Maven GAV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version from Maven GAV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 195. releaseId definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:releaseId</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"beanId"</span> <span class="hljs-attribute">groupId</span>=<span class="hljs-value">"org.kie.spring"</span>
            <span class="hljs-attribute">artifactId</span>=<span class="hljs-value">"named-artifactId"</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"1.0.0-SNAPSHOT"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kie_import"><a class="anchor" href="#_kie_import"></a><a class="link" href="#_kie_import">14.2.6. Kie:Import</a></h4>
<div class="paragraph">
<p>Starting with version 6.2, kie-spring allows for importing of kie objects from kjars found on the classpath.
Two modes of importing the kie objects are currently supported.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">releaseId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference to a Bean ID. Standard Spring ID semantics
                apply.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableScanner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Scanner. This attribute is used only if 'releaseId' is specified.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scannerInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scanning Interval in milli seconds. This attribute is used only if 'releaseId' is specified.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_global_import"><a class="anchor" href="#_global_import"></a><a class="link" href="#_global_import">14.2.6.1. Global Import</a></h5>
<div class="paragraph">
<p>The <em>import</em> tag will force the automatic scan of all the jars on the classpath, initialize the Kie Objects (Kbase/KSessions) and import these objects into the spring context.</p>
</div>
<div class="listingblock">
<div class="title">Global Import</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:import</span> /&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specific_import_releaseid"><a class="anchor" href="#_specific_import_releaseid"></a><a class="link" href="#_specific_import_releaseid">14.2.6.2. Specific Import - ReleaseId</a></h5>
<div class="paragraph">
<p>Using the <em>releaseId-ref</em> attribute on the import tag will initialize the specific Kie Objects (Kbase/KSessions) and import these objects into the spring context.</p>
</div>
<div class="listingblock">
<div class="title">Import Kie Objects using a releaseId</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:import</span> <span class="hljs-attribute">releaseId-ref</span>=<span class="hljs-value">"namedKieSession"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">kie:releaseId</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"namedKieSession"</span> <span class="hljs-attribute">groupId</span>=<span class="hljs-value">"org.drools"</span>
            <span class="hljs-attribute">artifactId</span>=<span class="hljs-value">"named-kiesession"</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"7.7.0.Final"</span>/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Kie Scanning feature can be enabled for KieBase’s imported with a specific releaseId.
This feature is currently not available for global imports.</p>
</div>
<div class="listingblock">
<div class="title">Import Kie Objects using a releaseId - Enable Scanner</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:import</span> <span class="hljs-attribute">releaseId-ref</span>=<span class="hljs-value">"namedKieSession"</span>
            <span class="hljs-attribute">enableScanner</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">scannerInterval</span>=<span class="hljs-value">"1000"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:releaseId</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"namedKieSession"</span> <span class="hljs-attribute">groupId</span>=<span class="hljs-value">"org.drools"</span>
            <span class="hljs-attribute">artifactId</span>=<span class="hljs-value">"named-kiesession"</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"7.7.0.Final"</span>/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the scanner is defined and enabled, an implicit <em>KieScanner</em> object is created and inserted into the spring context.
It can be retrived from the spring context.</p>
</div>
<div class="listingblock">
<div class="title">Retriving the KieScanner from Spring Context</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// the implicit name would be releaseId#scanner</span>
KieScanner releaseIdScanner = context.getBean(<span class="hljs-string">"namedKieSession#scanner"</span>, KieScanner.class);
releaseIdScanner.scanNow();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>kie-ci must be available on the classpath for the releaseId importing feature to work.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_annotations_2"><a class="anchor" href="#_annotations_2"></a><a class="link" href="#_annotations_2">14.2.7. Annotations</a></h4>
<div class="paragraph">
<p>@KContainer, @KBase and @KSession all support an optional 'name' attribute.
Spring typically does "get" when it injects, all injections receive the same instance for the same set of annotations.
the 'name' annotation forces a unique instance for each name, although all instance for that name will be identity equals.</p>
</div>
<div class="sect4">
<h5 id="__kreleaseid_2"><a class="anchor" href="#__kreleaseid_2"></a><a class="link" href="#__kreleaseid_2">14.2.7.1. @KReleaseId</a></h5>
<div class="paragraph">
<p>Used to bind an instance to a specific version of a KieModule.
If kie-ci is on the classpath this will resolve dependencies automatically, downloading from remote repositories.</p>
</div>
</div>
<div class="sect4">
<h5 id="__kcontainer_2"><a class="anchor" href="#__kcontainer_2"></a><a class="link" href="#__kcontainer_2">14.2.7.2. @KContainer</a></h5>
<div class="listingblock">
<div class="title">Injects Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KContainer</span>
<span class="hljs-keyword">private</span> KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects KieContainer for Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KContainer</span>
<span class="hljs-annotation">@KReleaseId</span>(groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieContainer kContainer;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects named KieContainer for Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KContainer</span>(name = <span class="hljs-string">"kc1"</span>)
<span class="hljs-annotation">@KReleaseId</span>(groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieContainer kContainer;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__kbase_2"><a class="anchor" href="#__kbase_2"></a><a class="link" href="#__kbase_2">14.2.7.3. @KBase</a></h5>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieBase from the spring xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieBase from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KBase</span>
<span class="hljs-keyword">private</span> KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieBase from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KBase</span>
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KBase</span>(<span class="hljs-string">"kbase1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieBase kbase1v10;

<span class="hljs-annotation">@KBase</span>(<span class="hljs-string">"kbase1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieBase kbase1v11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.ksession1' KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieSession ksession11kb2;

<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieSession ksession11kb2;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__ksession_for_kiesession_2"><a class="anchor" href="#__ksession_for_kiesession_2"></a><a class="link" href="#__ksession_for_kiesession_2">14.2.7.4. @KSession for KieSession</a></h5>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml or spring xml file</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KSession</span>
<span class="hljs-keyword">private</span> KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieSession from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KSession</span>
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieSession ksessionv10;

<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> KieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Use 'name' attribute to force new Instance for 'jar1.KBase1' KieSession</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieSession ksession1ks1

<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> KieSession ksession1ks2</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__ksession_for_statelesskiesession_2"><a class="anchor" href="#__ksession_for_statelesskiesession_2"></a><a class="link" href="#__ksession_for_statelesskiesession_2">14.2.7.5. @KSession for StatelessKieSession</a></h5>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml or spring xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default StatelessKieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KSession</span>
<span class="hljs-keyword">private</span> StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects the Default StatelessKieSession from a Dynamic KieModule</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KSession</span>
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Side by side version loading for 'jar1.KBase1' KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, rtifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksessionv10;

<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, rtifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.1"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksessionv11;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KSession</span>(value=<span class="hljs-string">"ksession1"</span>, name=<span class="hljs-string">"ks1"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksession1ks1

<span class="hljs-annotation">@KSession</span>(value=<span class="hljs-string">"ksession1"</span>, name=<span class="hljs-string">"ks2"</span>)
<span class="hljs-annotation">@KReleaseId</span>( groupId = <span class="hljs-string">"jar1"</span>, artifactId = <span class="hljs-string">"art1"</span>, version = <span class="hljs-string">"1.0"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksession1ks2</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_important_note_2"><a class="anchor" href="#_important_note_2"></a><a class="link" href="#_important_note_2">14.2.7.6. IMPORTANT NOTE</a></h5>
<div class="paragraph">
<p>When annotations are used, For proper initialization of the kmodule objects (kbase/ksession), it is mandatory for either a bean of type <code>org.kie.spring.annotations.KModuleAnnotationPostProcessor</code> be defined</p>
</div>
<div class="exampleblock">
<div class="title">Example 196. kie-spring annotations post processor bean definition</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
            <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.annotations.KModuleAnnotationPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 197. kie-spring annotations - Component Scanning</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">context:component-scan</span> <span class="hljs-attribute">base-package</span>=<span class="hljs-value">"org.kie.spring.annotations"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The post processor is different when annotations are used.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_listeners"><a class="anchor" href="#_event_listeners"></a><a class="link" href="#_event_listeners">14.2.8. Event Listeners</a></h4>
<div class="paragraph">
<p>Drools supports adding 3 types of listeners to KieSessions - <em>AgendaListener</em>, <em>WorkingMemoryListener</em>, <em>ProcessEventListener</em></p>
</div>
<div class="paragraph">
<p>The kie-spring module allows you to configure these listeners to KieSessions using XML tags.
These tags have identical names as the actual listener interfaces i.e., &lt;kie:agendaEventListener…​.&gt;, &lt;kie:ruleRuntimeEventListener…​.&gt; and &lt;kie:processEventListener…​.&gt;.</p>
</div>
<div class="paragraph">
<p>kie-spring provides features to define the listeners as standalone (individual) listeners and also to define them as a group.</p>
</div>
<div class="sect4">
<h5 id="_defining_stand_alone_listeners"><a class="anchor" href="#_defining_stand_alone_listeners"></a><a class="link" href="#_defining_stand_alone_listeners">14.2.8.1. Defining Stand alone Listeners:</a></h5>

</div>
<div class="sect4">
<h5 id="_attributes"><a class="anchor" href="#_attributes"></a><a class="link" href="#_attributes">14.2.8.2. Attributes:</a></h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 32. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to another declared bean.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 198. Listener configuration example - using a bean:ref.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-agenda-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockAgendaEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-rr-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockRuleRuntimeEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-process-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockProcessEventListener"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"listeners_kmodule"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession2"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-agenda-listener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:processEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-process-listener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:ruleRuntimeEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-rr-listener"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_nested_elements"><a class="anchor" href="#_nested_elements"></a><a class="link" href="#_nested_elements">14.2.8.3. Nested Elements:</a></h5>
<div class="ulist">
<ul>
<li>
<p>bean</p>
<div class="ulist">
<ul>
<li>
<p>class = String</p>
</li>
<li>
<p>name = String (optional)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 199. Listener configuration example - using nested bean.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"listeners_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
	  <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockAgendaEventListener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kie:agendaEventListener</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_empty_tag_declaration_with_no_ref_and_without_a_nestedbean"><a class="anchor" href="#_empty_tag_declaration_with_no_ref_and_without_a_nestedbean"></a><a class="link" href="#_empty_tag_declaration_with_no_ref_and_without_a_nestedbean">14.2.8.4. Empty Tag : Declaration with no 'ref' and without a nestedbean</a></h5>
<div class="paragraph">
<p>When a listener is defined without a reference to a implementing bean and does not contain a nested bean, <em>&lt;drools:ruleRuntimeEventListener/&gt;</em> the underlying implementation adds the Debug version of the listener defined in the API.</p>
</div>
<div class="paragraph">
<p>The debug listeners print the corresponding Event toString message to _System.err. _</p>
</div>
<div class="exampleblock">
<div class="title">Example 200. Listener configuration example - defaulting to the debugversions provided by the Knowledge-API .</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-agenda-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockAgendaEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-rr-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockRuleRuntimeEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-process-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockProcessEventListener"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"listeners_module"</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession2"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:processEventListener</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:ruleRuntimeEventListener</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mix_and_match_of_different_declaration_styles"><a class="anchor" href="#_mix_and_match_of_different_declaration_styles"></a><a class="link" href="#_mix_and_match_of_different_declaration_styles">14.2.8.5. Mix and Match of different declaration styles</a></h5>
<div class="paragraph">
<p>The drools-spring module allows you to mix and match the different declarative styles within the same KieSession.
The below sample provides more clarity.</p>
</div>
<div class="exampleblock">
<div class="title">Example 201. Listener configuration example - mix and match of’ref'/nested-bean/empty styles.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-agenda-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockAgendaEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-rr-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockRuleRuntimeEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-process-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockProcessEventListener"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"listeners_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.mocks.MockAgendaEventListener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kie:agendaEventListener</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession2"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-agenda-listener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:processEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-process-listener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:ruleRuntimeEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-rr-listener"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_multiple_listeners_of_the_same_type"><a class="anchor" href="#_defining_multiple_listeners_of_the_same_type"></a><a class="link" href="#_defining_multiple_listeners_of_the_same_type">14.2.8.6. Defining multiple listeners of the same type</a></h5>
<div class="paragraph">
<p>It is also valid to define multiple beans of the same event listener types for a KieSession.</p>
</div>
<div class="exampleblock">
<div class="title">Example 202. Listener configuration example - multiple listeners of thesame type.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-agenda-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockAgendaEventListener"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"listeners_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-agenda-listener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.mocks.MockAgendaEventListener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kie:agendaEventListener</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kie_grouping_listeners"><a class="anchor" href="#_kie_grouping_listeners"></a><a class="link" href="#_kie_grouping_listeners">14.2.8.7. Defining a Group of listeners:</a></h5>
<div class="paragraph">
<p>drools-spring allows for grouping of listeners.
This is particularly useful when you define a set of listeners and want to attach them to multiple sessions.
The grouping feature is also very useful, when we define a set of listeners for 'testing' and then want to switch them for 'production' use.</p>
</div>
</div>
<div class="sect4">
<h5 id="_attributes_2"><a class="anchor" href="#_attributes_2"></a><a class="link" href="#_attributes_2">14.2.8.8. Attributes:</a></h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 33. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique identifier</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_nested_elements_2"><a class="anchor" href="#_nested_elements_2"></a><a class="link" href="#_nested_elements_2">14.2.8.9. Nested Elements:</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie:agendaEventListener…​</p>
</li>
<li>
<p>kie:ruleRuntimeEventListener…​</p>
</li>
<li>
<p>kie:processEventListener…​</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above mentioned child elements can be declared in any order.
Only one declaration of each type is allowed in a group.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_example"><a class="anchor" href="#_example"></a><a class="link" href="#_example">14.2.8.10. Example:</a></h5>
<div class="exampleblock">
<div class="title">Example 203. Group of listeners - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-agenda-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockAgendaEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-rr-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockRuleRuntimeEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-process-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockProcessEventListener"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"listeners_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"statelessWithGroupedListeners"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateless"</span>
             <span class="hljs-attribute">listeners-ref</span>=<span class="hljs-value">"debugListeners"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">kie:eventListeners</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"debugListeners"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-agenda-listener"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:processEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-process-listener"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:ruleRuntimeEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-rr-listener"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:eventListeners</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loggers"><a class="anchor" href="#_loggers"></a><a class="link" href="#_loggers">14.2.9. Loggers</a></h4>
<div class="paragraph">
<p>Drools supports adding 2 types of loggers to KieSessions - <em>ConsoleLogger</em>, <em>FileLogger.</em></p>
</div>
<div class="paragraph">
<p>The kie-spring module allows you to configure these loggers to KieSessions using XML tags.
These tags have identical names as the actual logger interfaces i.e., &lt;kie:consoleLogger…​.&gt; and &lt;kie:fileLogger…​.&gt;.</p>
</div>
<div class="sect4">
<h5 id="_defining_a_console_logger"><a class="anchor" href="#_defining_a_console_logger"></a><a class="link" href="#_defining_a_console_logger">14.2.9.1. Defining a console logger:</a></h5>
<div class="paragraph">
<p>A console logger can be attached to a KieSession by using the <em>&lt;kie:consoleLogger/&gt;</em> tag.
This tag has no attributes and must be present directly under a &lt;kie:ksession…​.&gt; element.</p>
</div>
<div class="exampleblock">
<div class="title">Example 204. Defining a console logger - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"loggers_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ConsoleLogger-statefulSession"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateful"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:consoleLogger</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_a_file_logger"><a class="anchor" href="#_defining_a_file_logger"></a><a class="link" href="#_defining_a_file_logger">14.2.9.2. Defining a file logger:</a></h5>
<div class="paragraph">
<p>A file logger can be attached to a KieSession by using the <em>&lt;kie:fileLogger/&gt;</em> tag.
This tag has the following attributes and must be present directly under a &lt;kie:ksession…​.&gt; element.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 34. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the actual file on the disk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threaded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defaults to false. Valid values are 'true’or
                'false'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer. Specifies the interval for flushing the
                contents from memory to the disk.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 205. Defining a file logger - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"loggers_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ConsoleLogger-statefulSession"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateful"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:fileLogger</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"fl_logger"</span> <span class="hljs-attribute">file</span>=<span class="hljs-value">"#{ systemProperties['java.io.tmpdir'] }/log1"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:fileLogger</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"tfl_logger"</span> <span class="hljs-attribute">file</span>=<span class="hljs-value">"#{ systemProperties['java.io.tmpdir'] }/log2"</span>
                          <span class="hljs-attribute">threaded</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">interval</span>=<span class="hljs-value">"5"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_closing_a_filelogger"><a class="anchor" href="#_closing_a_filelogger"></a><a class="link" href="#_closing_a_filelogger">14.2.9.3. Closing a FileLogger</a></h5>
<div class="paragraph">
<p>To prevent leaks, it is advised to close the _&lt;kie:fileLogger …​&gt; _ programmatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">LoggerAdaptor adaptor = (LoggerAdaptor) context.getBean(<span class="hljs-string">"fl_logger"</span>);
adaptor.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_defining_batch_commands"><a class="anchor" href="#_defining_batch_commands"></a><a class="link" href="#_defining_batch_commands">14.2.10. Defining Batch Commands</a></h4>
<div class="paragraph">
<p>A <em>&lt;kie:batch&gt;</em> element can be used to define a set of batch commands for a given ksession.This tag has no attributes and must be present directly under a &lt;kie:ksession…​.&gt; element.
The commands supported are</p>
</div>
<div class="ulist">
<div class="title">Initialization Batch Commands</div>
<ul>
<li>
<p>insert-object</p>
<div class="ulist">
<ul>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
<li>
<p>set-global</p>
<div class="ulist">
<ul>
<li>
<p>identifier = String (required)</p>
</li>
<li>
<p>reg = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
<li>
<p>fire-all-rules</p>
<div class="ulist">
<ul>
<li>
<p>max : n</p>
</li>
</ul>
</div>
</li>
<li>
<p>fire-until-halt</p>
</li>
<li>
<p>start-process</p>
<div class="ulist">
<ul>
<li>
<p>parameter</p>
<div class="ulist">
<ul>
<li>
<p>identifier = String (required)</p>
</li>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>signal-event</p>
<div class="ulist">
<ul>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>event-type = String (required)</p>
</li>
<li>
<p>process-instance-id =n (optional)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 206. Batch commands - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"batch_commands_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksessionForCommands"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateful"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:batch</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">kie:insert-object</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"person2"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">kie:set-global</span> <span class="hljs-attribute">identifier</span>=<span class="hljs-value">"persons"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"personsList"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">kie:fire-all-rules</span> <span class="hljs-attribute">max</span>=<span class="hljs-value">"10"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kie:batch</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_persistence"><a class="anchor" href="#_persistence"></a><a class="link" href="#_persistence">14.2.11. Persistence</a></h4>
<div class="ulist">
<div class="title">Persistence Configuration Options</div>
<ul>
<li>
<p>jpa-persistence</p>
<div class="ulist">
<ul>
<li>
<p>transaction-manager</p>
<div class="ulist">
<ul>
<li>
<p>ref = String</p>
</li>
</ul>
</div>
</li>
<li>
<p>entity-manager-factory</p>
<div class="ulist">
<ul>
<li>
<p>ref = String</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 207. ksession JPA configuration example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kstore</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kstore"</span> /&gt;</span> <span class="hljs-comment">&lt;!-- provides KnowledgeStoreService implementation --&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"myEmf"</span>
       <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"dataSource"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"ds"</span> /&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"persistenceUnitName"</span>
       <span class="hljs-attribute">value</span>=<span class="hljs-value">"org.drools.persistence.jpa.local"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"txManager"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.orm.jpa.JpaTransactionManager"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"entityManagerFactory"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"myEmf"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"persistence_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"jpaSingleSessionCommandService"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:configuration</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">kie:jpa-persistence</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-title">kie:transaction-manager</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"txManager"</span>/&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-title">kie:entity-manager-factory</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"myEmf"</span>/&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-title">kie:jpa-persistence</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kie:configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
          <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_leveraging_other_spring_features"><a class="anchor" href="#_leveraging_other_spring_features"></a><a class="link" href="#_leveraging_other_spring_features">14.2.12. Leveraging Other Spring Features</a></h4>
<div class="paragraph">
<p>This section provides details on leveraging other standard spring features when integrating with Drools Expert.</p>
</div>
<div class="sect4">
<h5 id="_using_spring_expressions_spel"><a class="anchor" href="#_using_spring_expressions_spel"></a><a class="link" href="#_using_spring_expressions_spel">14.2.12.1. Using Spring Expressions (Spel)</a></h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"batch_commands_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"#{packageRepository.packages}"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksessionForCommands"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateful"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
      <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"packageRepository"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"sample.package.class.PackageRepo"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"packages"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"drl_kiesample3"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"loggers_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ConsoleLogger-statefulSession"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateful"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:fileLogger</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"fl"</span> <span class="hljs-attribute">file</span>=<span class="hljs-value">"#{ systemProperties['java.io.tmpdir'] }/log1"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:fileLogger</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"tfl"</span> <span class="hljs-attribute">file</span>=<span class="hljs-value">"#{ systemProperties['java.io.tmpdir'] }/log2"</span>
            <span class="hljs-attribute">threaded</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">interval</span>=<span class="hljs-value">"5"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
            <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_spring_profiles"><a class="anchor" href="#_using_spring_profiles"></a><a class="link" href="#_using_spring_profiles">14.2.12.2. Using Spring Profiles</a></h5>
<div class="paragraph">
<p>Spring 3.1 introduces a new profile attribute to the beans element of the spring-beans schema.
This attribute acts as a switch when enabling and disabling profiles in different environments.
One potential use of this attribute can be to have the same kbase defined with debug loggers in 'dev' environment and without loggers in 'prod' environment.</p>
</div>
<div class="paragraph">
<p>The below code snippet illustrates the concept of 'profiles'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">beans</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans"</span>
<span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
<span class="hljs-attribute">xmlns:kie</span>=<span class="hljs-value">"http://drools.org/schema/kie-spring"</span>
<span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
http://drools.org/schema/kie-spring http://drools.org/schema/kie-spring.xsd"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">beans</span> <span class="hljs-attribute">profile</span>=<span class="hljs-value">"development"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"test-kmodule"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateless"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">kie:consoleLogger</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>
    ...
  <span class="hljs-tag">&lt;/<span class="hljs-title">beans</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">beans</span> <span class="hljs-attribute">profile</span>=<span class="hljs-value">"production"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"test-kmodule"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateless"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>
    ...
  <span class="hljs-tag">&lt;/<span class="hljs-title">beans</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown above, the Spring XML contains the definition of the profiles.
While loading the <em>ApplicationContext</em> you have to tell Spring which profile you’re loading.</p>
</div>
<div class="paragraph">
<p>There are several ways of selecting your profile and the most useful is by using the "spring.profiles.active" system property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">System.setProperty(<span class="hljs-string">"spring.profiles.active"</span>, <span class="hljs-string">"development"</span>);
ApplicationContext ctx = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"beans.xml"</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously, it is not a good practice to hard code things as shown above and the recommended practice is to keep the system properties definitions independent of the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">-Dspring.profiles.active=<span class="hljs-string">"development"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The profiles can also be loaded and enabled programmtically</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">...
GenericXmlApplicationContext ctx = <span class="hljs-keyword">new</span> GenericXmlApplicationContext(<span class="hljs-string">"beans.xml"</span>);
ConfigurableEnvironment env = ctx.getEnvironment();
env.setActiveProfiles(<span class="hljs-string">"development"</span>);
ctx.refresh();
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_jbpm_human_task"><a class="anchor" href="#_integration_with_jbpm_human_task"></a><a class="link" href="#_integration_with_jbpm_human_task">14.3. Integration with jBPM Human Task</a></h3>
<div class="paragraph">
<p>This chapter describes the infrastructure used when configuring a human task server with Spring as well as a little bit about the infrastructure used when doing this.</p>
</div>
<div class="sect3">
<h4 id="_how_to_configure_spring_with_jbpm_human_task"><a class="anchor" href="#_how_to_configure_spring_with_jbpm_human_task"></a><a class="link" href="#_how_to_configure_spring_with_jbpm_human_task">14.3.1. How to configure Spring with jBPM Human task</a></h4>
<div class="paragraph">
<p>The jBPM human task server can be configured to use Spring persistence. <a href="#_kie_spring_human_task_example">[_kie_spring_human_task_example]</a>
 is an example of this which uses local transactions and Spring’s thread-safe EntityManager proxy.</p>
</div>
<div class="paragraph">
<p>The following diagram shows the dependency graph used in <a href="#_kie_spring_human_task_example">[_kie_spring_human_task_example]</a>
.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ht-spring-deps.png" alt="ht spring deps">
</div>
<div class="title">Figure 201. Spring Human Task integration injection dependencies</div>
</div>
<div class="paragraph">
<p>A <code>TaskService</code> instance is dependent on two other bean types: a drools <code>SystemEventListener</code> bean as well as a <code>TaskSessionSpringFactoryImpl</code> bean.
The <code>TaskSessionSpringFactoryImpl</code> bean is howerver <em>not</em> injected into the <code>TaskService</code> bean because this would cause a circular dependency.
To solve this problem, when the <code>TaskService</code> bean is injected into the <code>TaskSessionSpringFactoryImpl</code> bean, the setter method used secretly injects the <code>TaskSessionSpringFactoryImpl</code> instance back into the <code>TaskService</code> bean and initializes the <code>TaskService</code> bean as well.</p>
</div>
<div class="paragraph">
<p>The <code>TaskSessionSpringFactoryImpl</code> bean is responsible for creating all the internal instances in human task that deal with transactions and persistence context management.
Besides a <code>TaskService</code> instance, this bean also requires a transaction manager and a persistence context to be injected.
Specifically, it requires an instance of a <code>HumanTaskSpringTransactionManager</code> bean (as a transaction manager) and an instance of a <code>SharedEntityManagerBean</code> bean (as a persistence context instance).</p>
</div>
<div class="paragraph">
<p>We also use some of the standard Spring beans in order to configure persistence: there’s a bean to hold the <code>EntityManagerFactory</code> instance as well as the <code>SharedEntityManagerBean</code> instance.
The <code>SharedEntityManagerBean</code> provides a shared, thread-safe proxy for the actual <code>EntityManager</code>.</p>
</div>
<div class="paragraph">
<p>The <code>HumanTaskSpringTransactionManager</code> bean serves as a wrapper around the Spring transaction manager, in this case the <code>JpaTransactionManager</code>.
An instance of a <code>JpaTransactionManager</code> bean is also instantiated because of this.</p>
</div>
<div class="exampleblock">
<div class="title">Example 208. Configuring Human Task with Spring</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">beans</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attribute">xmlns:jbpm</span>=<span class="hljs-value">"http://drools.org/schema/drools-spring"</span>
       <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://drools.org/schema/drools-spring org/drools/container/spring/drools-spring-1.2.0.xsd"</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- persistence &amp; transactions--&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"htEmf"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"persistenceUnitName"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"org.jbpm.task"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"htEm"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.orm.jpa.support.SharedEntityManagerBean"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"entityManagerFactory"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"htEmf"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"jpaTxMgr"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.orm.jpa.JpaTransactionManager"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"entityManagerFactory"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"htEmf"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- this must be true if using the SharedEntityManagerBean, and false otherwise --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"nestedTransactionAllowed"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"true"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"htTxMgr"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.drools.container.spring.beans.persistence.HumanTaskSpringTransactionManager"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">constructor-arg</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"jpaTxMgr"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- human-task beans --&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"systemEventListener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.drools.SystemEventListenerFactory"</span> <span class="hljs-attribute">factory-method</span>=<span class="hljs-value">"getSystemEventListener"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"taskService"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.jbpm.task.service.TaskService"</span> &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"systemEventListener"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"systemEventListener"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"springTaskSessionFactory"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.jbpm.task.service.persistence.TaskSessionSpringFactoryImpl"</span>
        <span class="hljs-attribute">init-method</span>=<span class="hljs-value">"initialize"</span> <span class="hljs-attribute">depends-on</span>=<span class="hljs-value">"taskService"</span> &gt;</span>
    <span class="hljs-comment">&lt;!-- if using the SharedEntityManagerBean, make sure to enable nested transactions --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"entityManager"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"htEm"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"transactionManager"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"htTxMgr"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"useJTA"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"false"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"taskService"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"taskService"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using the <code>SharedEntityManagerBean</code> instance, it’s important to configure the Spring transaction manager to use nested transactions.
This is because the <code>SharedEntityManagerBean</code> is a <em>transactional</em> persistence context and will close the persistence context after every operation.
However, the human task server needs to be able to access (persisted) entities after operations.
Nested transactions allow us to still have access to entities that otherwise would have been detached and are no longer accessible, especially when using an ORM framework that uses lazy-initialization of entities.</p>
</div>
<div class="paragraph">
<p>Also, while the <code>TaskSessionSpringFactoryImpl</code> bean takes an “useJTA”
 parameter, at the moment, JTA transactions with Spring have not yet been fully tested.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.blueprint"><a class="anchor" href="#_ch.kie.blueprint"></a><a class="link" href="#_ch.kie.blueprint">15. Integration with Aries Blueprint</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_integration_with_drools_expert_2"><a class="anchor" href="#_integration_with_drools_expert_2"></a><a class="link" href="#_integration_with_drools_expert_2">15.1. Integration with Drools Expert</a></h3>
<div class="paragraph">
<p>In this section we will explain the <em>kie</em> namespace.</p>
</div>
<div class="sect3">
<h4 id="_kiemodule_2"><a class="anchor" href="#_kiemodule_2"></a><a class="link" href="#_kiemodule_2">15.1.1. KieModule</a></h4>
<div class="paragraph">
<p>The <em>&lt;kie:kmodule&gt;</em> defines a collection of KieBase and associated KieSession’s.
The <em>kmodule</em> tag has one MANDATORY parameter 'id'.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 35. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean’s <em>id</em> is the name to be
              referenced from other beans. Standard Blueprint ID semantics
              applies.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <em>kmodule</em> tag can contain only the following tags as children.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kie:kbase</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to the documentation of kmodule.xml in the Drools Expert documentation for detailed explanation of the need for kmodule.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kiebase_4"><a class="anchor" href="#_kiebase_4"></a><a class="link" href="#_kiebase_4">15.1.2. KieBase</a></h4>
<div class="sect4">
<h5 id="__kie_kbase_s_parameters_as_attributes_2"><a class="anchor" href="#__kie_kbase_s_parameters_as_attributes_2"></a><a class="link" href="#__kie_kbase_s_parameters_as_attributes_2">15.1.2.1. &lt;kie:kbase&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 36. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the KieBase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of resource packages to be
                included in this kbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kbase names to be included. All resources from the
                corresponding kbase are included in this kbase.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean (TRUE/FALSE). Default kbase, if not provided,
                it is assumed to be FALSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prototype | singleton. If not provided assumed to be singleton (default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eventProcessingMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event Processing Mode. Valid options are STREAM,
                CLOUD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">equalsBehavior</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valid options are IDENTITY, EQUALITY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_a_em_kbase_em_tag_can_contain_only_the_following_tags_as_children"><a class="anchor" href="#_a_em_kbase_em_tag_can_contain_only_the_following_tags_as_children"></a><a class="link" href="#_a_em_kbase_em_tag_can_contain_only_the_following_tags_as_children">15.1.2.2. A <em>kbase</em> tag can contain only the following tags as children.</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie:ksession</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="__kie_kbase_s_definition_example_2"><a class="anchor" href="#__kie_kbase_s_definition_example_2"></a><a class="link" href="#__kie_kbase_s_definition_example_2">15.1.2.3. &lt;kie:kbase&gt;'s definition example</a></h5>
<div class="paragraph">
<p>A kmodule can contain multiple (1..n) kbase elements.</p>
</div>
<div class="exampleblock">
<div class="title">Example 209. kbase definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sample_module"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase1"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.drools.blueprint.sample"</span>&gt;</span>
     ...
   <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_blueprint_bean_scope_for_kiebase_and_kiesession"><a class="anchor" href="#_blueprint_bean_scope_for_kiebase_and_kiesession"></a><a class="link" href="#_blueprint_bean_scope_for_kiebase_and_kiesession">15.1.2.4. Blueprint Bean Scope (for KieBase and KieSession)</a></h5>
<div class="paragraph">
<p>When defining a KieBase or a KieSession, you have the option of declaring a scope for that bean.
For example, To force Blueprint to produce a new bean instance each time one is needed, you should declare the bean’s scope attribute to be 'prototype'. Similar way if you want Blueprint to return the same bean instance each time one is needed, you should declare the bean’s scope attribute to be 'singleton'.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiesessions_2"><a class="anchor" href="#_kiesessions_2"></a><a class="link" href="#_kiesessions_2">15.1.3. KieSessions</a></h4>
<div class="paragraph">
<p>&lt;kie:ksession&gt; element defines KieSessions.
The same tag is used to define both Stateful (<em>org.kie.api.runtime.KieSession</em>) and Stateless (<em>org.kie.api.runtime.StatelessKieSession</em>) sessions.</p>
</div>
<div class="sect4">
<h5 id="__kie_ksession_s_parameters_as_attributes_2"><a class="anchor" href="#__kie_ksession_s_parameters_as_attributes_2"></a><a class="link" href="#__kie_ksession_s_parameters_as_attributes_2">15.1.3.1. &lt;kie:ksession&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 37. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ksession’s name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is the session <em>stateful</em> or
                <em>stateless?</em>. If this attribute is empty or
                missing, the session is assumed to be of type
                Stateful.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is this the default session?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prototype | singleton. If not provided assumed to be singleton (default)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clockType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REALTIME or PSEUDO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listeners-ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the reference to the event listeners group
                (see <a href="#_kie_grouping_listeners">'Defining a Group
                of listeners'</a> section below).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 210. ksession definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sample-kmodule"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample3"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateless"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession2"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kie_releaseid_2"><a class="anchor" href="#_kie_releaseid_2"></a><a class="link" href="#_kie_releaseid_2">15.1.4. Kie:ReleaseId</a></h4>
<div class="sect4">
<h5 id="__kie_releaseid_s_parameters_as_attributes_2"><a class="anchor" href="#__kie_releaseid_s_parameters_as_attributes_2"></a><a class="link" href="#__kie_releaseid_s_parameters_as_attributes_2">15.1.4.1. &lt;kie:releaseId&gt;'s parameters as attributes:</a></h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 38. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean’s <em>id</em> is the name to be
                  referenced from other beans. Standard Blueprint ID semantics
                  applies.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId from Maven GAV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifactId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifactId from Maven GAV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version from Maven GAV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 211. releaseId definition example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:releaseId</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"beanId"</span> <span class="hljs-attribute">groupId</span>=<span class="hljs-value">"org.kie.blueprint"</span>
            <span class="hljs-attribute">artifactId</span>=<span class="hljs-value">"named-artifactId"</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"1.0.0-SNAPSHOT"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kie_import_2"><a class="anchor" href="#_kie_import_2"></a><a class="link" href="#_kie_import_2">15.1.5. Kie:Import</a></h4>
<div class="paragraph">
<p>Starting with version 6.5, kie-aries-blueprint allows for importing of kie objects from kjars found on the classpath.
Two modes of importing the kie objects are currently supported.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">releaseId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference to a Bean ID. Standard Blueprint ID semantics
                applies.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableScanner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Scanner. This attribute is used only if 'releaseId' is specified.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scannerInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scanning Interval in milli seconds. This attribute is used only if 'releaseId' is specified.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_global_import_2"><a class="anchor" href="#_global_import_2"></a><a class="link" href="#_global_import_2">15.1.5.1. Global Import</a></h5>
<div class="paragraph">
<p>The <em>import</em> tag will force the automatic scan of all the jars on the classpath, initialize the Kie Objects (Kbase/KSessions) and import these objects into the blueprint context.</p>
</div>
<div class="listingblock">
<div class="title">Global Import</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:import</span> /&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_specific_import_releaseid_2"><a class="anchor" href="#_specific_import_releaseid_2"></a><a class="link" href="#_specific_import_releaseid_2">15.1.5.2. Specific Import - ReleaseId</a></h5>
<div class="paragraph">
<p>Using the <em>releaseId-ref</em> attribute on the import tag will initialize the specific Kie Objects (Kbase/KSessions) and import these objects into the blueprint context.</p>
</div>
<div class="listingblock">
<div class="title">Import Kie Objects using a releaseId</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:import</span> <span class="hljs-attribute">releaseId-ref</span>=<span class="hljs-value">"namedKieSession"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">kie:releaseId</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"namedKieSession"</span> <span class="hljs-attribute">groupId</span>=<span class="hljs-value">"org.drools"</span>
            <span class="hljs-attribute">artifactId</span>=<span class="hljs-value">"named-kiesession"</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"7.7.0.Final"</span>/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Kie Scanning feature can be enabled for KieBase’s imported with a specific releaseId.
This feature is currently not available for global imports.</p>
</div>
<div class="listingblock">
<div class="title">Import Kie Objects using a releaseId - Enable Scanner</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:import</span> <span class="hljs-attribute">releaseId-ref</span>=<span class="hljs-value">"namedKieSession"</span>
            <span class="hljs-attribute">enableScanner</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">scannerInterval</span>=<span class="hljs-value">"1000"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:releaseId</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"namedKieSession"</span> <span class="hljs-attribute">groupId</span>=<span class="hljs-value">"org.drools"</span>
            <span class="hljs-attribute">artifactId</span>=<span class="hljs-value">"named-kiesession"</span> <span class="hljs-attribute">version</span>=<span class="hljs-value">"7.7.0.Final"</span>/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the scanner is defined and enabled, an implicit <em>KieScanner</em> object is created and inserted into the blueprint container.
It can be programmatically retrived from the blueprint container using the <em>-scanner</em> suffix.</p>
</div>
<div class="listingblock">
<div class="title">Retriving the KieScanner from Blueprint Container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// the implicit name would be releaseId-scanner</span>
KieScanner releaseIdScanner = (KieScanner)container.getComponentInstance(<span class="hljs-string">"namedKieSession-scanner"</span>);
releaseIdScanner.scanNow();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>kie-ci must be available on the classpath for the releaseId importing feature to work.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_listeners_2"><a class="anchor" href="#_event_listeners_2"></a><a class="link" href="#_event_listeners_2">15.1.6. Event Listeners</a></h4>
<div class="paragraph">
<p>Drools supports adding 3 types of listeners to KieSessions - <em>AgendaListener</em>, <em>WorkingMemoryListener</em>, <em>ProcessEventListener</em></p>
</div>
<div class="paragraph">
<p>The kie-aries-blueprint module allows you to configure these listeners to KieSessions using XML tags.
These tags have identical names as the actual listener interfaces i.e., &lt;kie:agendaEventListener…​.&gt;, &lt;kie:ruleRuntimeEventListener…​.&gt; and &lt;kie:processEventListener…​.&gt;.</p>
</div>
<div class="paragraph">
<p>kie-aries-blueprint provides features to define the listeners as standalone (individual) listeners and also to define them as a group.</p>
</div>
<div class="sect4">
<h5 id="_defining_stand_alone_listeners_2"><a class="anchor" href="#_defining_stand_alone_listeners_2"></a><a class="link" href="#_defining_stand_alone_listeners_2">15.1.6.1. Defining Stand alone Listeners:</a></h5>

</div>
<div class="sect4">
<h5 id="_attributes_3"><a class="anchor" href="#_attributes_3"></a><a class="link" href="#_attributes_3">15.1.6.2. Attributes:</a></h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 39. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A reference to another declared bean.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 212. Listener configuration example - using a bean:ref.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-agenda-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockAgendaEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-rr-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockRuleRuntimeEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-process-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockProcessEventListener"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"listeners_kmodule"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession2"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-agenda-listener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:processEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-process-listener"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:ruleRuntimeEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-rr-listener"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_multiple_listeners_of_the_same_type_2"><a class="anchor" href="#_defining_multiple_listeners_of_the_same_type_2"></a><a class="link" href="#_defining_multiple_listeners_of_the_same_type_2">15.1.6.3. Defining multiple listeners of the same type</a></h5>
<div class="paragraph">
<p>It is also valid to define multiple beans of the same event listener types for a KieSession.</p>
</div>
<div class="exampleblock">
<div class="title">Example 213. Listener configuration example - multiple listeners of thesame type.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-agenda-listener1"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockAgendaEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-agenda-listener2"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockAgendaEventListener"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"listeners_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-agenda-listener1"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-agenda-listener2"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kie_grouping_listeners"><a class="anchor" href="#_kie_grouping_listeners"></a><a class="link" href="#_kie_grouping_listeners">15.1.6.4. Defining a Group of listeners:</a></h5>
<div class="paragraph">
<p>kie-aries-blueprinty allows for grouping of listeners.
This is particularly useful when you define a set of listeners and want to attach them to multiple sessions.
The grouping feature is also very useful, when we define a set of listeners for 'testing' and then want to switch them for 'production' use.</p>
</div>
</div>
<div class="sect4">
<h5 id="_attributes_4"><a class="anchor" href="#_attributes_4"></a><a class="link" href="#_attributes_4">15.1.6.5. Attributes:</a></h5>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 40. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique identifier</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_nested_elements_3"><a class="anchor" href="#_nested_elements_3"></a><a class="link" href="#_nested_elements_3">15.1.6.6. Nested Elements:</a></h5>
<div class="ulist">
<ul>
<li>
<p>kie:agendaEventListener…​</p>
</li>
<li>
<p>kie:ruleRuntimeEventListener…​</p>
</li>
<li>
<p>kie:processEventListener…​</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The above mentioned child elements can be declared in any order.
Only one declaration of each type is allowed in a group.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_example_2"><a class="anchor" href="#_example_2"></a><a class="link" href="#_example_2">15.1.6.7. Example:</a></h5>
<div class="exampleblock">
<div class="title">Example 214. Group of listeners - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-agenda-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockAgendaEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-rr-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockRuleRuntimeEventListener"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mock-process-listener"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"mocks.MockProcessEventListener"</span>/&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"listeners_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"statelessWithGroupedListeners"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateless"</span>
             <span class="hljs-attribute">listeners-ref</span>=<span class="hljs-value">"debugListeners"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">kie:eventListeners</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"debugListeners"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:agendaEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-agenda-listener"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:processEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-process-listener"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:ruleRuntimeEventListener</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"mock-rr-listener"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:eventListeners</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loggers_2"><a class="anchor" href="#_loggers_2"></a><a class="link" href="#_loggers_2">15.1.7. Loggers</a></h4>
<div class="paragraph">
<p>Drools supports adding 2 types of loggers to KieSessions - <em>ConsoleLogger</em>, <em>FileLogger.</em></p>
</div>
<div class="paragraph">
<p>The kie-aries-blueprint module allows you to configure these loggers to KieSessions using XML tags.
These tags have identical names as the actual logger interfaces i.e., &lt;kie:consoleLogger…​.&gt; and &lt;kie:fileLogger…​.&gt;.</p>
</div>
<div class="sect4">
<h5 id="_defining_a_console_logger_2"><a class="anchor" href="#_defining_a_console_logger_2"></a><a class="link" href="#_defining_a_console_logger_2">15.1.7.1. Defining a console logger:</a></h5>
<div class="paragraph">
<p>A console logger can be attached to a KieSession by using the <em>&lt;kie:consoleLogger/&gt;</em> tag.
This tag has no attributes and must be present directly under a &lt;kie:ksession…​.&gt; element.</p>
</div>
<div class="exampleblock">
<div class="title">Example 215. Defining a console logger - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"loggers_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ConsoleLogger-statefulSession"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateful"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:consoleLogger</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_defining_a_file_logger_2"><a class="anchor" href="#_defining_a_file_logger_2"></a><a class="link" href="#_defining_a_file_logger_2">15.1.7.2. Defining a file logger:</a></h5>
<div class="paragraph">
<p>A file logger can be attached to a KieSession by using the <em>&lt;kie:fileLogger/&gt;</em> tag.
This tag has the following attributes and must be present directly under a &lt;kie:ksession…​.&gt; element.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 41. Sample</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique identifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the actual file on the disk</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threaded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defaults to false. Valid values are 'true’or
                'false'</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer. Specifies the interval for flushing the
                contents from memory to the disk.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 216. Defining a file logger - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"loggers_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ConsoleLogger-statefulSession"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateful"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:fileLogger</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"fl_logger"</span> <span class="hljs-attribute">file</span>=<span class="hljs-value">"#{ systemProperties['java.io.tmpdir'] }/log1"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:fileLogger</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"tfl_logger"</span> <span class="hljs-attribute">file</span>=<span class="hljs-value">"#{ systemProperties['java.io.tmpdir'] }/log2"</span>
                          <span class="hljs-attribute">threaded</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">interval</span>=<span class="hljs-value">"5"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_closing_a_filelogger_2"><a class="anchor" href="#_closing_a_filelogger_2"></a><a class="link" href="#_closing_a_filelogger_2">15.1.7.3. Closing a FileLogger</a></h5>
<div class="paragraph">
<p>To prevent leaks, it is advised to close the <em>&lt;kie:fileLogger …​&gt;</em> programmatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">LoggerAdaptor adaptor = (LoggerAdaptor) container.getComponentInstance(<span class="hljs-string">"fl_logger"</span>);
adaptor.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_defining_batch_commands_2"><a class="anchor" href="#_defining_batch_commands_2"></a><a class="link" href="#_defining_batch_commands_2">15.1.8. Defining Batch Commands</a></h4>
<div class="paragraph">
<p>A <em>&lt;kie:batch&gt;</em> element can be used to define a set of batch commands for a given ksession.This tag has no attributes and must be present directly under a &lt;kie:ksession…​.&gt; element.
The commands supported are</p>
</div>
<div class="ulist">
<div class="title">Initialization Batch Commands</div>
<ul>
<li>
<p>insert-object</p>
<div class="ulist">
<ul>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
<li>
<p>set-global</p>
<div class="ulist">
<ul>
<li>
<p>identifier = String (required)</p>
</li>
<li>
<p>reg = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
<li>
<p>fire-all-rules</p>
<div class="ulist">
<ul>
<li>
<p>max : n</p>
</li>
</ul>
</div>
</li>
<li>
<p>fire-until-halt</p>
</li>
<li>
<p>start-process</p>
<div class="ulist">
<ul>
<li>
<p>parameter</p>
<div class="ulist">
<ul>
<li>
<p>identifier = String (required)</p>
</li>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>Anonymous bean</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>signal-event</p>
<div class="ulist">
<ul>
<li>
<p>ref = String (optional)</p>
</li>
<li>
<p>event-type = String (required)</p>
</li>
<li>
<p>process-instance-id =n (optional)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 217. Batch commands - example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"batch_commands_module"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"drl_kiesample"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"drl_kiesample"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksessionForCommands"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateful"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:batch</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">kie:insert-object</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"person2"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">kie:set-global</span> <span class="hljs-attribute">identifier</span>=<span class="hljs-value">"persons"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"personsList"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">kie:fire-all-rules</span> <span class="hljs-attribute">max</span>=<span class="hljs-value">"10"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">kie:batch</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:ksession</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.android"><a class="anchor" href="#_ch.kie.android"></a><a class="link" href="#_ch.kie.android">16. Android Integration</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_integration_with_drools_expert_3"><a class="anchor" href="#_integration_with_drools_expert_3"></a><a class="link" href="#_integration_with_drools_expert_3">16.1. Integration with Drools Expert</a></h3>
<div class="paragraph">
<p>Drools Android integration comes in two flavors, with or without the <em>drools-compiler</em> dependency.
Without the drools-compiler dependency the knowledge bases are pre-serialized at buildtime using the kie-maven-plugin.
They can be then deserialized using the API, or directly injected using Roboguice.
When using the drools-compiler dependency there are two options: (1) standard KieContainer API or (2) CDI-like injection with Roboguice.</p>
</div>
<div class="sect3">
<h4 id="_pre_serialized_rules"><a class="anchor" href="#_pre_serialized_rules"></a><a class="link" href="#_pre_serialized_rules">16.1.1. Pre-serialized Rules</a></h4>
<div class="paragraph">
<p>It is possible to use Drools without the drools-compiler dependency, which results in a smaller apk, by pre-serializing the compiled knowledge bases during build-time and then de-serializing them at runtime.</p>
</div>
<div class="sect4">
<h5 id="_maven_configuration"><a class="anchor" href="#_maven_configuration"></a><a class="link" href="#_maven_configuration">16.1.1.1. Maven Configuration</a></h5>
<div class="paragraph">
<p>The KieBase must be serialized during build time using <em>kie-maven-plugin</em>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 218. Pre-serialized KieBase Maven pom.xml</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">dependencyManagement</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-bom<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>7.7.0.Final<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-title">type</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependencyManagement</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-android<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">exclusions</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">exclusion</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">exclusions</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-core<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">build</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">plugin</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>7.7.0.Final<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">kiebases</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">kiebase</span>&gt;</span>HelloKB<span class="hljs-tag">&lt;/<span class="hljs-title">kiebase</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">kiebases</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">resDirectory</span>&gt;</span>${basedir}/src/main/res/raw<span class="hljs-tag">&lt;/<span class="hljs-title">resDirectory</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">executions</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">id</span>&gt;</span>touch<span class="hljs-tag">&lt;/<span class="hljs-title">id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">goals</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">goal</span>&gt;</span>touch<span class="hljs-tag">&lt;/<span class="hljs-title">goal</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">goals</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">phase</span>&gt;</span>initialize<span class="hljs-tag">&lt;/<span class="hljs-title">phase</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">execution</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">id</span>&gt;</span>compile-kbase<span class="hljs-tag">&lt;/<span class="hljs-title">id</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">goals</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">goal</span>&gt;</span>build<span class="hljs-tag">&lt;/<span class="hljs-title">goal</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">goals</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">phase</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-title">phase</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">execution</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">execution</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">id</span>&gt;</span>serialize<span class="hljs-tag">&lt;/<span class="hljs-title">id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">goals</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">goal</span>&gt;</span>serialize<span class="hljs-tag">&lt;/<span class="hljs-title">goal</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">goals</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">phase</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-title">phase</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">execution</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">executions</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-title">plugin</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">build</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_loading_the_kiebase"><a class="anchor" href="#_loading_the_kiebase"></a><a class="link" href="#_loading_the_kiebase">16.1.1.2. Loading the KieBase</a></h5>
<div class="paragraph">
<p>The KieBase must be de-serialized before creating the sessions.</p>
</div>
<div class="listingblock">
<div class="title">Loading serialized KieBase</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoadKieBaseTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncTask</span>&lt;<span class="hljs-title">InputStream</span>, <span class="hljs-title">Void</span>, <span class="hljs-title">KieBase</span>&gt; </span>{
   <span class="hljs-annotation">@Override</span>
   <span class="hljs-function"><span class="hljs-keyword">protected</span> KieBase <span class="hljs-title">doInBackground</span><span class="hljs-params">(InputStream... params)</span> </span>{
      <span class="hljs-keyword">try</span> {
         logger.debug(<span class="hljs-string">"Loading knowledge base"</span>);
         <span class="hljs-keyword">final</span> KnowledgeBase kbase = KnowledgeBaseFactory.newKnowledgeBase();
         kbase.addKnowledgePackages((List&lt;KnowledgePackage&gt;) DroolsStreamUtils.streamIn(params[<span class="hljs-number">0</span>]));
         <span class="hljs-keyword">return</span> kbase;
      }<span class="hljs-keyword">catch</span>(Exception e) {
         logger.error(<span class="hljs-string">"Drools exception"</span>, e);
         <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
      }
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiecontainer_api_with_drools_compiler_dependency"><a class="anchor" href="#_kiecontainer_api_with_drools_compiler_dependency"></a><a class="link" href="#_kiecontainer_api_with_drools_compiler_dependency">16.1.2. KieContainer API with drools-compiler dependency</a></h4>
<div class="paragraph">
<p>With the drools-compiler dependency standard KieContainer API can be used.
This comes at a cost of a larger apk.
To avoid the 65K limit, multidex (or proguard) can be used.</p>
</div>
<div class="sect4">
<h5 id="_maven_configuration_with_drools_compiler_and_multidex"><a class="anchor" href="#_maven_configuration_with_drools_compiler_and_multidex"></a><a class="link" href="#_maven_configuration_with_drools_compiler_and_multidex">16.1.2.1. Maven Configuration with drools-compiler and multidex</a></h5>
<div class="paragraph">
<p>The kie-maven-plugin must be configured to build the kiebase.
Multidex must be used to allow for the increased dependencies.
There are also some settings for merging various Drools XML files within the apk.</p>
</div>
<div class="exampleblock">
<div class="title">Example 219. pom.xml with drools-compiler and multidex</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">dependencyManagement</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-bom<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>7.7.0.Final<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-title">type</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependencyManagement</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependencies</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-android<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">exclusions</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">exclusion</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">exclusions</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-compiler<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">exclusions</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">exclusion</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">exclusion</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">exclusion</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>xmlpull<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>xmlpull<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">exclusion</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">exclusion</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>xpp3<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>xpp3_min<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">exclusion</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">exclusion</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">exclusion</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">exclusion</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.eclipse.jdt.core.compiler<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>ecj<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">exclusions</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">build</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">plugin</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>7.7.0.Final<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">execution</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">id</span>&gt;</span>compile-kbase<span class="hljs-tag">&lt;/<span class="hljs-title">id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">goals</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">goal</span>&gt;</span>build<span class="hljs-tag">&lt;/<span class="hljs-title">goal</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">goals</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">phase</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-title">phase</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">execution</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">executions</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">plugin</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>com.simpligility.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>android-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>4.2.1<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">extensions</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">extensions</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">sdk</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">platform</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-title">platform</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">sdk</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">dex</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">coreLibrary</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">coreLibrary</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">jvmArguments</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">jvmArgument</span>&gt;</span>-Xmx2048m<span class="hljs-tag">&lt;/<span class="hljs-title">jvmArgument</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">jvmArguments</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">multiDex</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">multiDex</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">mainDexList</span>&gt;</span>maindex.txt<span class="hljs-tag">&lt;/<span class="hljs-title">mainDexList</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">dex</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">extractDuplicates</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">extractDuplicates</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">apk</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">metaInf</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">includes</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">include</span>&gt;</span>services/**<span class="hljs-tag">&lt;/<span class="hljs-title">include</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">include</span>&gt;</span>kmodule.*<span class="hljs-tag">&lt;/<span class="hljs-title">include</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">include</span>&gt;</span>HelloKB/**<span class="hljs-tag">&lt;/<span class="hljs-title">include</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">include</span>&gt;</span>drools**<span class="hljs-tag">&lt;/<span class="hljs-title">include</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">include</span>&gt;</span>maven/${project.groupId}/${project.artifactId}/**<span class="hljs-tag">&lt;/<span class="hljs-title">include</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">includes</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">metaInf</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">apk</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">plugin</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">build</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integration_with_roboguice"><a class="anchor" href="#_integration_with_roboguice"></a><a class="link" href="#_integration_with_roboguice">16.2. Integration with Roboguice</a></h3>
<div class="sect3">
<h4 id="_pre_serialized_rules_with_roboguice"><a class="anchor" href="#_pre_serialized_rules_with_roboguice"></a><a class="link" href="#_pre_serialized_rules_with_roboguice">16.2.1. Pre-serialized Rules with Roboguice</a></h4>
<div class="paragraph">
<p>With Roboguice pre-serialized knowledge bases can be injected using the @KBase annotation.</p>
</div>
<div class="sect4">
<h5 id="_annotations_3"><a class="anchor" href="#_annotations_3"></a><a class="link" href="#_annotations_3">16.2.1.1. Annotations</a></h5>
<div class="paragraph">
<p>@KBase supports an optional 'name' attribute.
CDI typically does "getOrCreate" when it injects, all injections receive the same instance for the same set of annotations.
the 'name' annotation forces a unique instance for each name, although all instances for that name will be identity equals.</p>
</div>
</div>
<div class="sect4">
<h5 id="__kbase_3"><a class="anchor" href="#__kbase_3"></a><a class="link" href="#__kbase_3">16.2.1.2. @KBase</a></h5>
<div class="paragraph">
<p>The default argument maps to the value attribute and specifies the name of the KieBase from the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects KieBase by name from pre-serialized resource</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@KBase</span>(<span class="hljs-string">"kbase1"</span>)
<span class="hljs-keyword">private</span> KieBase kbase;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_androidmanifest_xml_configuration"><a class="anchor" href="#_androidmanifest_xml_configuration"></a><a class="link" href="#_androidmanifest_xml_configuration">16.2.1.3. AndroidManifest.xml configuration</a></h5>
<div class="paragraph">
<p>The Roboguice module needs to be specified in the manifest.</p>
</div>
<div class="exampleblock">
<div class="title">Example 220. Roboguice manifest with pre-serialized knowledge base</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">application</span>
   <span class="hljs-attribute">android:largeHeap</span>=<span class="hljs-value">"true"</span>
   <span class="hljs-attribute">android:allowBackup</span>=<span class="hljs-value">"true"</span>
   <span class="hljs-attribute">android:icon</span>=<span class="hljs-value">"@drawable/ic_launcher"</span>
   <span class="hljs-attribute">android:label</span>=<span class="hljs-value">"@string/app_name"</span>
   <span class="hljs-attribute">android:theme</span>=<span class="hljs-value">"@style/AppTheme"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">meta-data</span>
         <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"roboguice.modules"</span>
         <span class="hljs-attribute">android:value</span>=<span class="hljs-value">"org.drools.android.roboguice.DroolsModule"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">activity</span>
         <span class="hljs-attribute">android:label</span>=<span class="hljs-value">"@string/app_name"</span>
         <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"org.drools.examples.android.SplashActivity"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">intent-filter</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">action</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.intent.action.MAIN"</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">category</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.intent.category.LAUNCHER"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">intent-filter</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">activity</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">application</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kiecontainer_with_drools_compiler_dependency_and_roboguice"><a class="anchor" href="#_kiecontainer_with_drools_compiler_dependency_and_roboguice"></a><a class="link" href="#_kiecontainer_with_drools_compiler_dependency_and_roboguice">16.2.2. KieContainer with drools-compiler dependency and Roboguice</a></h4>
<div class="paragraph">
<p>With Roboguice and drools-compiler almost the full CDI syntax can be used to inject KieContainers, KieBases, and KieSessions.</p>
</div>
<div class="sect4">
<h5 id="_annotations_4"><a class="anchor" href="#_annotations_4"></a><a class="link" href="#_annotations_4">16.2.2.1. Annotations</a></h5>
<div class="paragraph">
<p>@KContainer, @KBase and @KSession all support an optional 'name' attribute.
CDI typically does "getOrCreate" when it injects, all injections receive the same instance for the same set of annotations.
the 'name' annotation forces a unique instance for each name, although all instance for that name will be identity equals.</p>
</div>
</div>
<div class="sect4">
<h5 id="__kcontainer_3"><a class="anchor" href="#__kcontainer_3"></a><a class="link" href="#__kcontainer_3">16.2.2.2. @KContainer</a></h5>
<div class="listingblock">
<div class="title">Injects Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-keyword">private</span> KieContainer kContainer;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__kbase_4"><a class="anchor" href="#__kbase_4"></a><a class="link" href="#__kbase_4">16.2.2.3. @KBase</a></h5>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieBase from the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieBase from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-keyword">private</span> KieBase kbase;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects KieBase by name from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KBase</span>(<span class="hljs-string">"kbase1"</span>)
<span class="hljs-keyword">private</span> KieBase kbase;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__ksession_for_kiesession_3"><a class="anchor" href="#__ksession_for_kiesession_3"></a><a class="link" href="#__ksession_for_kiesession_3">16.2.2.4. @KSession for KieSession</a></h5>
<div class="paragraph">
<p>@KSession is optional as it can be detected and added by the use of @Inject and variable type inference.</p>
</div>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml file</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default KieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-keyword">private</span> KieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects StatelessKieSession by name from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-keyword">private</span> KieSession ksession;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__ksession_for_statelesskiesession_3"><a class="anchor" href="#__ksession_for_statelesskiesession_3"></a><a class="link" href="#__ksession_for_statelesskiesession_3">16.2.2.5. @KSession for StatelessKieSession</a></h5>
<div class="paragraph">
<p>@KSession is optional as it can be detected and added by the use of @Inject and variable type inference.</p>
</div>
<div class="paragraph">
<p>The default argument, if given, maps to the value attribute and specifies the name of the KieSession from the kmodule.xml file.</p>
</div>
<div class="listingblock">
<div class="title">Injects the Default StatelessKieSession from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-keyword">private</span> StatelessKieSession ksession;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Injects StatelessKieSession by name from the Classpath KieContainer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@Inject</span>
<span class="hljs-annotation">@KSession</span>(<span class="hljs-string">"ksession1"</span>)
<span class="hljs-keyword">private</span> StatelessKieSession ksession;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_androidmanifest_xml_configuration_2"><a class="anchor" href="#_androidmanifest_xml_configuration_2"></a><a class="link" href="#_androidmanifest_xml_configuration_2">16.2.2.6. AndroidManifest.xml configuration</a></h5>
<div class="paragraph">
<p>The Roboguice module needs to be specified in the manifest.</p>
</div>
<div class="exampleblock">
<div class="title">Example 221. Roboguice manifest configuration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">application</span>
   <span class="hljs-attribute">android:largeHeap</span>=<span class="hljs-value">"true"</span>
   <span class="hljs-attribute">android:allowBackup</span>=<span class="hljs-value">"true"</span>
   <span class="hljs-attribute">android:icon</span>=<span class="hljs-value">"@drawable/ic_launcher"</span>
   <span class="hljs-attribute">android:label</span>=<span class="hljs-value">"@string/app_name"</span>
   <span class="hljs-attribute">android:theme</span>=<span class="hljs-value">"@style/AppTheme"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">meta-data</span>
      <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"roboguice.modules"</span>
      <span class="hljs-attribute">android:value</span>=<span class="hljs-value">"org.drools.android.roboguice.DroolsContainerModule"</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">activity</span>
      <span class="hljs-attribute">android:label</span>=<span class="hljs-value">"@string/app_name"</span>
      <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"org.drools.examples.android.SplashActivity"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">intent-filter</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">action</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.intent.action.MAIN"</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">category</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.intent.category.LAUNCHER"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">intent-filter</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">activity</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">application</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.camel"><a class="anchor" href="#_ch.camel"></a><a class="link" href="#_ch.camel">17. Apache Camel Integration</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_camel"><a class="anchor" href="#_camel"></a><a class="link" href="#_camel">17.1. Camel</a></h3>
<div class="paragraph">
<p>Camel provides a light weight bus framework for getting information into and out of Drools.</p>
</div>
<div class="paragraph">
<p>Drools introduces two elements to make easy integration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Drools Policy</p>
<div class="paragraph">
<p>Augments any JAXB or XStream data loaders.
For JAXB it adds drools related paths ot the contextpath, for XStream it adds custom converters and aliases for Drools classes.
It also handles setting the ClassLoader to the targeted ksession.</p>
</div>
</li>
<li>
<p>Drools Endpoint</p>
<div class="paragraph">
<p>Executes the payload against the specified drools session</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drools can be configured like any normal camel component, but notice the policy that wraps the drools related segments.
This will route all payloads to ksession1</p>
</div>
<div class="exampleblock">
<div class="title">Example 222. Drools EndPoint configured with the CXFRS producer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePolicy"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.camel.component.KiePolicy"</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">camelContext</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"camel"</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://camel.apache.org/schema/spring"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">route</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">from</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"cxfrs://bean://rsServer"</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">policy</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"kiePolicy"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">unmarshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">to</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"kie:ksession1"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">marshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-title">policy</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">route</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">camelContext</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It is possible to not specify the session in the drools endpoint uri, and instead "multiplex" based on an attribute or header.
In this example the policy will check either the header field "DroolsLookup" for the named session to execute and if that isn’t specified it’ll check the "lookup" attribute on the incoming payload.</p>
</div>
<div class="exampleblock">
<div class="title">Example 223. Drools EndPoint configured with the CXFRS producer</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePolicy"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.camel.component.KiePolicy"</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">camelContext</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"camel"</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://camel.apache.org/schema/spring"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">route</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">from</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"cxfrs://bean://rsServer"</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">policy</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"kiePolicy"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">unmarshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">to</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"kie:dynamic"</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">marshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-title">policy</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">route</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">camelContext</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 224. Java Code to execute against Route from a Spring and CamelContext</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CamelSpringTestSupport</span> </span>{

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> AbstractXmlApplicationContext <span class="hljs-title">createApplicationContext</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"org/drools/camel/component/CxfRsSpring.xml"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        String cmd = <span class="hljs-string">""</span>;
        cmd += <span class="hljs-string">"&lt;batch-execution lookup=\"ksession1\"&gt;\n"</span>;
        cmd += <span class="hljs-string">"  &lt;insert out-identifier=\"salaboy\"&gt;\n"</span>;
        cmd += <span class="hljs-string">"      &lt;org.drools.pipeline.camel.Person&gt;\n"</span>;
        cmd += <span class="hljs-string">"         &lt;name&gt;salaboy&lt;/name&gt;\n"</span>;
        cmd += <span class="hljs-string">"      &lt;/org.drools.pipeline.camel.Person&gt;\n"</span>;
        cmd += <span class="hljs-string">"   &lt;/insert&gt;\n"</span>;
        cmd += <span class="hljs-string">"   &lt;fire-all-rules/&gt;\n"</span>;
        cmd += <span class="hljs-string">"&lt;/batch-execution&gt;\n"</span>;

        Object object = <span class="hljs-keyword">this</span>.context.createProducerTemplate().requestBody(<span class="hljs-string">"direct://client"</span>, cmd);
        System.out.println( object );
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following urls show sample script examples for jaxb, xstream and json marshalling using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</a></p>
</li>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/jaxb.mvt?r=HEAD</a></p>
</li>
<li>
<p><a href="http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD" class="bare">http://fisheye.jboss.org/browse/JBossRules/trunk/drools-camel/src/test/resources/org/drools/camel/component/xstream.mvt?r=HEAD</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.server"><a class="anchor" href="#_ch.server"></a><a class="link" href="#_ch.server">18. Drools Camel Server</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_3"><a class="anchor" href="#_introduction_3"></a><a class="link" href="#_introduction_3">18.1. Introduction</a></h3>
<div class="paragraph">
<p>The drools camel server (drools-camel-server) module is a war which you can deploy to execute KnowledgeBases remotely for any sort of client application.
This is not limited to JVM application clients, but any technology that can use HTTP, through a REST interface.
This version of the execution server supports stateless and stateful sessions in a native way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deployment"><a class="anchor" href="#_deployment"></a><a class="link" href="#_deployment">18.2. Deployment</a></h3>
<div class="paragraph">
<p>Drools Camel Server is a war file, which can be deployed in a application server (such as JBoss AS). As the service is stateless, it is possible to have have as many of these services deployed as you need to serve the client load.
Deploy on JBoss AS 4.x / Tomcat 6.x works out-of-the-box, instead some external dependencies must be added and the configuration must be changed to be deployed in JBoss AS 5</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a><a class="link" href="#_configuration">18.3. Configuration</a></h3>
<div class="paragraph">
<p>Inside the war file you will find a few XML configuration files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>beans.xml</p>
<div class="ulist">
<ul>
<li>
<p>Skeleton XML that imports knowledge-services.xml and camel-server.xml</p>
</li>
</ul>
</div>
</li>
<li>
<p>camel-server.xml</p>
<div class="ulist">
<ul>
<li>
<p>Configures CXF endpoints with Camel Routes</p>
</li>
<li>
<p>Came Routes pipeline messages to various configured knowledge services</p>
</li>
</ul>
</div>
</li>
<li>
<p>knowledge-services.xml</p>
<div class="ulist">
<ul>
<li>
<p>Various Knowledge Bases and Sessions</p>
</li>
</ul>
</div>
</li>
<li>
<p>camel-client.xml</p>
<div class="ulist">
<ul>
<li>
<p>Sample camel client showing how to send and receive a message</p>
</li>
<li>
<p>Used by "out of the box" test.jsp</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_rest_camel_services_configuration"><a class="anchor" href="#_rest_camel_services_configuration"></a><a class="link" href="#_rest_camel_services_configuration">18.3.1. REST/Camel Services configuration</a></h4>
<div class="paragraph">
<p>The next step is configure the services that are going to be exposed through drools-server.
You can modify this configuration in camel-server.xml file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">beans</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans"</span>
  <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="hljs-attribute">xmlns:cxf</span>=<span class="hljs-value">"http://camel.apache.org/schema/cxf"</span>
  <span class="hljs-attribute">xmlns:jaxrs</span>=<span class="hljs-value">"http://cxf.apache.org/jaxrs"</span>
  <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"
  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
  http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
  http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd
  http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">import</span> <span class="hljs-attribute">resource</span>=<span class="hljs-value">"classpath:META-INF/cxf/cxf.xml"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">import</span> <span class="hljs-attribute">resource</span>=<span class="hljs-value">"classpath:META-INF/cxf/cxf-extension-jaxrs-binding.xml"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">import</span> <span class="hljs-attribute">resource</span>=<span class="hljs-value">"classpath:META-INF/cxf/cxf-servlet.xml"</span> /&gt;</span>

  <span class="hljs-comment">&lt;!--
   !   If you are running on JBoss you will need to copy a camel-jboss.jar into the lib and set this ClassLoader configuration
   !  http://camel.apache.org/camel-jboss.html
   !   &lt;bean id="jbossResolver" class="org.apache.camel.jboss.JBossPackageScanClassResolver"/&gt;
   --&gt;</span>

  <span class="hljs-comment">&lt;!--
   !   Define the server end point.
   !   Copy and paste this element, changing id and the address, to expose services on different urls.
   !   Different Camel routes can handle different end point paths.
   --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">cxf:rsServer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"rsServer"</span>
                <span class="hljs-attribute">address</span>=<span class="hljs-value">"/rest"</span>
                <span class="hljs-attribute">serviceClass</span>=<span class="hljs-value">"org.kie.jax.rs.CommandExecutorImpl"</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">cxf:providers</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.jax.rs.CommandMessageBodyReader"</span>/&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-title">cxf:providers</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">cxf:rsServer</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">cxf:cxfEndpoint</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"soapServer"</span>
            <span class="hljs-attribute">address</span>=<span class="hljs-value">"/soap"</span>
             <span class="hljs-attribute">serviceName</span>=<span class="hljs-value">"ns:CommandExecutor"</span>
             <span class="hljs-attribute">endpointName</span>=<span class="hljs-value">"ns:CommandExecutorPort"</span>
          <span class="hljs-attribute">wsdlURL</span>=<span class="hljs-value">"soap.wsdl"</span>
          <span class="hljs-attribute">xmlns:ns</span>=<span class="hljs-value">"http://soap.jax.drools.org/"</span> &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">cxf:properties</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">entry</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"dataFormat"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"MESSAGE"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">entry</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"defaultOperationName"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"execute"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">cxf:properties</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">cxf:cxfEndpoint</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- Leave this, as it's needed to make Camel "drools" aware --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePolicy"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.camel.component.KiePolicy"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">camelContext</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"camel"</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://camel.apache.org/schema/spring"</span>&gt;</span>
    <span class="hljs-comment">&lt;!--
     ! Routes incoming messages from end point id="rsServer".
     ! Example route unmarshals the messages with xstream and executes against ksession1.
     ! Copy and paste this element, changing marshallers and the 'to' uri, to target different sessions, as needed.
     !--&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">route</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">from</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"cxfrs://bean://rsServer"</span>/&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">policy</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"kiePolicy"</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">unmarshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">to</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"kie:ksession1"</span> /&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">marshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
       <span class="hljs-tag">&lt;/<span class="hljs-title">policy</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">route</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">route</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">from</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"cxf://bean://soapServer"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">policy</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"kiePolicy"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">unmarshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">to</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"kie:ksession1"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">marshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">policy</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">route</span>&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-title">camelContext</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_restful_service_endpoint_creation"><a class="anchor" href="#_restful_service_endpoint_creation"></a><a class="link" href="#_restful_service_endpoint_creation">18.3.1.1. RESTful service endpoint creation</a></h5>
<div class="paragraph">
<p>In the next XML snippet code we are creating a RESTful (JAX-RS) endpoint bound to /kservice/rest address and using org.drools.jax.rs.CommandExecutorImpl as the service implementer.
This class is only used to instantiate the service endpoint because all the internal implementation is managed by Camel, and you can see in the source file that the exposed execute service must be never called.</p>
</div>
<div class="paragraph">
<p>Also a JAX-RS Provider is provided to determine if the message transported can be processed in this service endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">cxf:rsServer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"rsServer"</span>
              <span class="hljs-attribute">address</span>=<span class="hljs-value">"/rest"</span>
              <span class="hljs-attribute">serviceClass</span>=<span class="hljs-value">"org.kie.jax.rs.CommandExecutorImpl"</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">cxf:providers</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.jax.rs.CommandMessageBodyReader"</span>/&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-title">cxf:providers</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">cxf:rsServer</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ideally this configuration doesn’t need to be modified, at least the Service Class and the JAX-RS Provider, but you can add more endpoints associated to different addresses to use them in other Camel Routes.</p>
</div>
<div class="paragraph">
<p>After all this initial configuration, you can start config your own Knowledge Services.</p>
</div>
</div>
<div class="sect4">
<h5 id="_camel_kie_policy_context_creation"><a class="anchor" href="#_camel_kie_policy_context_creation"></a><a class="link" href="#_camel_kie_policy_context_creation">18.3.1.2. Camel Kie Policy &amp; Context creation</a></h5>
<div class="paragraph">
<p>KiePolicy is used to add Drools support in Camel, basically what it does is to add interceptors into the camel route to create Camel Processors on the fly and modify the internal navigation route.
If you want to have SOAP support you need to create your custom Drools Policy, but it’s going to be added in the next release.</p>
</div>
<div class="paragraph">
<p>But you don’t need to know more internal details, only instantiate this bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePolicy"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.camel.component.KiePolicy"</span> /&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next is create the camel route that will have the responsibility to execute the commands sent through JAX-RS.
Basically we create a route definition associated with the JAX-RS definition as the data input, the camel policy to be used and inside the “execution route” or ProcessorDefinitions.
As you can see, we set XStream as the marshaller/unmarshaller and the drools execution route definition</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">camelContext</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"camel"</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://camel.apache.org/schema/spring"</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">route</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">from</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"cxfrs://bean://rsServer"</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">policy</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"kiePolicy"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">unmarshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">to</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"kie:ksession1"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">marshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">policy</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">route</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">route</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">from</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"cxf://bean://soapServer"</span>/&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">policy</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"kiePolicy"</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">unmarshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">to</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"kie:ksession1"</span> /&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">marshal</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"xstream"</span> /&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-title">policy</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">route</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">camelContext</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The drools endpoint creation has the next arguments</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">to</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"kie:{1}/{2}"</span> /&gt;</span></code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execution Node identifier that is registered in the CamelContext</p>
</li>
<li>
<p>Knowledge Session identifier that was registered in the Execution Node with identifier {1}</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both parameters are configured in knowledge-services.xml file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_knowledge_services_configuration"><a class="anchor" href="#_knowledge_services_configuration"></a><a class="link" href="#_knowledge_services_configuration">18.3.1.3. Knowledge Services configuration</a></h5>
<div class="paragraph">
<p>The next step is create the Knowledge Sessions that you are going to use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">beans</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hljs-attribute">xmlns:kie</span>=<span class="hljs-value">"http://drools.org/schema/kie-spring"</span>
       <span class="hljs-attribute">xsi:schemaLocation</span>=<span class="hljs-value">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                          http://drools.org/schema/kie-spring http://drools.org/schema/kie-spring.xsd"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">kie:kmodule</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"drools-camel-server"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie:kbase</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kbase1"</span> <span class="hljs-attribute">packages</span>=<span class="hljs-value">"org.drools.server"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">kie:ksession</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ksession1"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"stateless"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kbase</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie:kmodule</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePostProcessor"</span>
            <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.spring.KModuleBeanFactoryPostProcessor"</span>/&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">beans</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The execution-node is a context or registered kbases and ksessions, here kbase1 and ksession1 are planed in the node1 context.
The kbase itself consists of two knowledge definitions, a DRL and an XSD.
The Spring documentation contains a lot more information on configuring these knowledge services.</p>
</div>
</div>
<div class="sect4">
<h5 id="_test"><a class="anchor" href="#_test"></a><a class="link" href="#_test">18.3.1.4. Test</a></h5>
<div class="paragraph">
<p>With drools-server war unzipped you should be able to see a test.jsp and run it.
This example just executes a simple "echo" type application.
It sends a message to the rule server that pre-appends the word "echo" to the front and sends it back.
By default the message is "Hello World", different messages can be passed using the url parameter msg - test.jsp?msg="My Custom Message".</p>
</div>
<div class="paragraph">
<p>Under the hood the jsp invokes the Test.java class, this then calls out to Camel which is where the meet happens.
The camel-client.xml defines the client with just a few lines of XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-comment">&lt;!-- Leave this, as it's needed to make Camel "drools" aware --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kiePolicy"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.kie.camel.component.KiePolicy"</span> /&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">camelContext</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"camel"</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://camel.apache.org/schema/spring"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">route</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">from</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"direct://kservice/rest"</span>/&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-title">policy</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"kiePolicy"</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-title">to</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"cxfrs://http://localhost:8080/drools-server/kservice/rest"</span>/&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-title">policy</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">route</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">route</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">from</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"direct://kservice/soap"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">policy</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"kiePolicy"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">to</span> <span class="hljs-attribute">uri</span>=<span class="hljs-value">"cxfrs://http://localhost:8080/drools-server/kservice/soap"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">policy</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">route</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">camelContext</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>"direct://kservice" is just a named hook, allowing Java to grab a reference and push data into it.
In this example the data is already in XML, so we don’t need to add any <code>DataFormat</code>s to do the marshalling.
The KiePolicy adds some smarts to the route and you’ll see it used on the server side too.
If JAXB or XStream were used, it would inject custom paths and converters, it can also set the ClassLoader too on the server side, on the client side it automatically unwraps the Response object.</p>
</div>
<div class="paragraph">
<p>The rule itself can be found here: test.drl.
Notice the type Message is declared part of the DRL and is thus not present on the Classpath.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">declare <span class="hljs-constant">Message</span>
   text <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>
<span class="hljs-keyword">end</span>


rule <span class="hljs-string">"echo"</span> dialect <span class="hljs-string">"mvel"</span>
<span class="hljs-keyword">when</span>
   <span class="hljs-variable">$m</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Message</span>();
<span class="hljs-keyword">then</span>
   <span class="hljs-variable">$m</span>.text = <span class="hljs-string">"echo:"</span> + <span class="hljs-variable">$m</span>.text;
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rhqchapter"><a class="anchor" href="#_rhqchapter"></a><a class="link" href="#_rhqchapter">19. JMX monitoring with RHQ/JON</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_4"><a class="anchor" href="#_introduction_4"></a><a class="link" href="#_introduction_4">19.1. Introduction</a></h3>
<div class="paragraph">
<p>The Drools engine supports runtime monitoring through JMX standard MBeans.
These MBeans expose configuration and metrics data, from live knowledge bases and sessions, to internal details like rule execution times.
Any JMX compatible console can be used to access that data.
This chapter details how to use RHQ/JON to do it, but similar steps can be used for any other console.</p>
</div>
<div class="sect3">
<h4 id="_enabling_jmx_monitoring_in_a_drools_application"><a class="anchor" href="#_enabling_jmx_monitoring_in_a_drools_application"></a><a class="link" href="#_enabling_jmx_monitoring_in_a_drools_application">19.1.1. Enabling JMX monitoring in a Drools application</a></h4>
<div class="paragraph">
<p>To enable JMX monitoring in a Drools application, it is necessary to enable remote monitoring in the JVM.
There are several tutorials on how to do that in the internet, but we recommend that you check the documentation of your specific JVM.
Using the Oracle/Sun JVM, it can be as simple as running the engine with a few command line system properties.</p>
</div>
<div class="paragraph">
<p>For instance, to enable remote monitoring on port 19988 with disabled authentication (should be only used for tests/demos, as in production authentication should be enabled), just run the application with the following command line parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> -Dcom.sun.management.jmxremote.port=19988 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second step is to enable the Drools MBeans.
As any Drools configuration, that can be done by setting a system property, or adding the property to a configuration file, or using the API.</p>
</div>
<div class="paragraph">
<p>To enable it in the command line, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> -Dkie.mbeans=enabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable id using the API, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"> KieBaseConfiguration conf = ...
 conf.setOption( MBeansOption.ENABLED );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installing_and_running_the_rhq_jon_plugin"><a class="anchor" href="#_installing_and_running_the_rhq_jon_plugin"></a><a class="link" href="#_installing_and_running_the_rhq_jon_plugin">19.1.2. Installing and running the RHQ/JON plugin</a></h4>
<div class="paragraph">
<p>The following sequence of steps can be used to configure JON to monitor a Drools application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the JON server and agent.</p>
</li>
<li>
<p>Download Drools plugin included in the "Drools and jBPM tools" bundle (<a href="https://www.jboss.org/drools/downloads.html" class="bare">https://www.jboss.org/drools/downloads.html</a>).</p>
</li>
<li>
<p>Install server, agent, and the plugin.</p>
</li>
<li>
<p>Check that the server is running, agent is running and plugin is installed.</p>
</li>
<li>
<p>Execute the drools application [see details in the previous section].</p>
</li>
<li>
<p>On the agent console, type "discovery" command for the agent to find the drools application, which it will find on port 19988.</p>
</li>
<li>
<p>On JON console, click on auto-discovery queue.</p>
</li>
<li>
<p>Select the JMX Server process that is showing there, running on port 19988.</p>
</li>
<li>
<p>Click import.</p>
</li>
<li>
<p>Click on Resources→servers.</p>
</li>
<li>
<p>Click on the JMX Server.</p>
</li>
<li>
<p>Under JMXServer on the left hand side, you have Drools Service.</p>
</li>
</ol>
</div>
<h1 id="_drools_workbench" class="discrete">Drools Workbench</h1>
<div class="paragraph">
<p>The Drools workbench is built with the UberFire framework and uses the Guvnor plugin. Drools provides an
additional rich set of plugins for rule authoring metaphors.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wb.workbench"><a class="anchor" href="#_wb.workbench"></a><a class="link" href="#_wb.workbench">20. Workbench (General)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_wb.installation"><a class="anchor" href="#_wb.installation"></a><a class="link" href="#_wb.installation">20.1. Installation</a></h3>
<div class="sect3">
<h4 id="_wb.warinstallation"><a class="anchor" href="#_wb.warinstallation"></a><a class="link" href="#_wb.warinstallation">20.1.1. War installation</a></h4>
<div class="paragraph">
<p>Use the <code>war</code> from the workbench distribution zip that corresponds to your application server.
The differences between these <code>war</code> files are mainly superficial.
For example, some JARs might be excluded if the application server already supplies them.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>eap7</code>: tailored for Red Hat JBoss Enterprise Application Platform 7</p>
</li>
<li>
<p><code>tomcat8</code>: tailored for Apache Tomcat 8</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Apache Tomcat requires additional configuration to correctly install the Workbench.
Please consult the <code>README.md</code> in the <code>war</code> for the most up to date procedure.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><code>wildfly10</code>: tailored for Red Hat JBoss Wildfly 10</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_wb.workbenchdata"><a class="anchor" href="#_wb.workbenchdata"></a><a class="link" href="#_wb.workbenchdata">20.1.2. Workbench data</a></h4>
<div class="paragraph">
<p>The workbench stores its data, by default in the directory <code>$WORKING_DIRECTORY/.niogit</code>, for example <code>wildfly-10.0.0.Final/bin/.niogit</code>, but it can be overridden with the <a href="#_wb.systemproperties">system property</a><code>-Dorg.uberfire.nio.git.dir</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In production, make sure to back up the workbench data directory.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_wb.systemproperties"><a class="anchor" href="#_wb.systemproperties"></a><a class="link" href="#_wb.systemproperties">20.1.3. System properties</a></h4>
<div class="paragraph">
<p>Here’s a list of all system properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>org.uberfire.nio.git.dir</code></strong>: Location of the directory <code>.niogit</code>. Default: working directory</p>
</li>
<li>
<p><strong><code>org.uberfire.nio.git.dirname</code></strong>: Name of the git directory. Default: <code>.niogit</code></p>
</li>
<li>
<p><strong><code>org.uberfire.nio.git.daemon.enabled</code></strong>: Enables/disables git daemon. Default: <code>true</code></p>
</li>
<li>
<p><strong><code>org.uberfire.nio.git.daemon.host</code></strong>: If git daemon enabled, uses this property as local host identifier. Default: <code>localhost</code></p>
</li>
<li>
<p><strong><code>org.uberfire.nio.git.daemon.port</code></strong>: If git daemon enabled, uses this property as port number. Default: <code>9418</code></p>
</li>
<li>
<p><strong><code>org.uberfire.nio.git.ssh.enabled</code></strong>: Enables/disables ssh daemon. Default: <code>true</code></p>
</li>
<li>
<p><strong><code>org.uberfire.nio.git.ssh.host</code></strong>: If ssh daemon enabled, uses this property as local host identifier. Default: <code>localhost</code></p>
</li>
<li>
<p><strong><code>org.uberfire.nio.git.ssh.port</code></strong>: If ssh daemon enabled, uses this property as port number. Default: <code>8001</code></p>
</li>
<li>
<p><strong><code>org.uberfire.nio.git.ssh.cert.dir</code></strong>: Location of the directory <code>.security</code> where local certificates will be stored. Default: working directory</p>
</li>
<li>
<p><strong><code>org.uberfire.nio.git.ssh.passphrase</code></strong>: Passphrase to access your Operating Systems public keystore when cloning <code>git</code> repositories with <code>scp</code> style URLs; e.g. <code>git@github.com:user/repository.git</code>.</p>
</li>
<li>
<p><strong><code>org.uberfire.nio.git.ssh.algorithm</code></strong>: Algorithm used by SSH. Default: <code>DSA</code></p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you plan to use RSA or any algorithm other than DSA, make sure you setup properly your Application Server to use Bouncy Castle JCE library.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><strong><code>org.uberfire.metadata.index.dir</code></strong>: Place where Lucene <code>.index</code> folder will be stored. Default: working directory</p>
</li>
<li>
<p><strong><code>org.uberfire.ldap.regex.role_mapper</code></strong>: Regex pattern used to map LDAP principal names to application role name.  Note that the variable <code>role</code> must be part of the pattern as it is substited by the application role name when matching a principal value to role name. Default: Not used.</p>
</li>
<li>
<p><strong><code>org.uberfire.sys.repo.monitor.disabled</code></strong>: Disable configuration monitor (do not disable unless you know what you’re doing). Default: <code>false</code></p>
</li>
<li>
<p><strong><code>org.uberfire.secure.key</code></strong>: Secret password used by password encryption. Default: <code>org.uberfire.admin</code></p>
</li>
<li>
<p><strong><code>org.uberfire.secure.alg</code></strong>: Crypto algorithm used by password encryption. Default: <code>PBEWithMD5AndDES</code></p>
</li>
<li>
<p><strong><code>org.uberfire.domain</code></strong>: security-domain name used by uberfire. Default: <code>ApplicationRealm</code></p>
</li>
<li>
<p><strong><code>org.guvnor.m2repo.dir</code></strong>: Place where Maven repository folder will be stored. Default: working-directory/repositories/kie</p>
</li>
<li>
<p><strong><code>org.guvnor.project.gav.check.disabled</code></strong>: Disable GAV checks. Default: <code>false</code></p>
</li>
<li>
<p><strong><code>org.kie.demo</code></strong>: Enables external clone of a demo application from GitHub.</p>
</li>
<li>
<p><strong><code>org.kie.build.disable-project-explorer</code></strong>: Disable automatic build of selected Project in Project Explorer. Default: <code>false</code></p>
</li>
<li>
<p><strong><code>org.kie.verification.disable-dtable-realtime-verification</code></strong>: Disables the realtime validation and verification of decision tables. Default: <code>false</code></p>
</li>
<li>
<p><strong><code>org.kie.workbench.controller</code></strong>: URL for connecting with a Kie Server Controller, for example: <code>ws://localhost:8080/kie-server-controller/websocket/controller</code>.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Only Web Socket protocol is supported for connecting with a remote Kie Server Controller.
When specifying this proporty, the Workbench will automatically disable all the features related to running the embbeded controller.</p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>org.kie.workbench.controller.user</code></strong>: User name for connecting with a Kie Server Controller. Default: <code>kieserver</code></p>
</li>
<li>
<p><strong><code>org.kie.workbench.controller.pwd</code></strong>: Password for connecting with a Kie Server Controller. Default: <code>kieserver1!</code></p>
</li>
<li>
<p><strong><code>org.kie.workbench.controller.token</code></strong>: Token string for connecting with a Kie Server Controller.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Please refer to <a href="#usingTokenBasedAuthentication">Using token based authentication</a> for more details about how to use token based authentication.</p>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>kie.keystore.keyStoreURL</code></strong>: URL to a keystore which should be used for connecting with a remote Kie Server Controller.</p>
</li>
<li>
<p><strong><code>kie.keystore.keyStorePwd</code></strong>: Password to a keystore.</p>
</li>
<li>
<p><strong><code>kie.keystore.key.ctrl.alias</code></strong>: Alias of the key where password is stored.</p>
</li>
<li>
<p><strong><code>kie.keystore.key.ctrl.pwd</code></strong>: Password of an alias with stored password.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Please refer to <a href="#_securing_password_using_key_store">Securing password using key store</a> for more details about how to use a key store for securing your passwords.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>To change one of these system properties in a WildFly or JBoss EAP cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the file <code>$JBOSS_HOME/domain/configuration/host.xml</code>.</p>
</li>
<li>
<p>Locate the XML elements <code>server</code> that belong to the <code>main-server-group</code> and add a system property, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">system-properties</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.nio.git.dir"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"..."</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-title">system-properties</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_wb.troubleshooting"><a class="anchor" href="#_wb.troubleshooting"></a><a class="link" href="#_wb.troubleshooting">20.1.4. Trouble shooting</a></h4>
<div class="sect4">
<h5 id="_wb.troubleshootingloadingspinner"><a class="anchor" href="#_wb.troubleshootingloadingspinner"></a><a class="link" href="#_wb.troubleshootingloadingspinner">20.1.4.1. Loading.. does not disappear and Workbench fails to show</a></h5>
<div class="paragraph">
<p>There have been reports that Firewalls in between the server and the browser can interfere with Server Sent Events (SSE) used by the Workbench.</p>
</div>
<div class="paragraph">
<p>The issue results in the "Loading…​" spinner remaining visible and the Workbench failing to materialize.</p>
</div>
<div class="paragraph">
<p>The workaround is to disable the Workbench’s use of Server Sent Events by adding file <code>/WEB-INF/classes/ErraiService.properties</code> to the exploded WAR containing the value <code>errai.bus.enable_sse_support=false</code>.
Re-package the WAR and re-deploy.</p>
</div>
<div class="paragraph">
<p>Some Users have also reported disabling Server Sent Events does not resolve the issue. The solution found to work is to configure the JVM to use a different Entropy Gathering Device on Linux for <code>SecureRandom</code>. This can be configured by setting System Property <code>java.security.egd</code> to <code>file:/dev/./urandom</code>. See <a href="http://stackoverflow.com/questions/33166198/kie-workbench-not-loading-after-login/39110177#39110177">this</a>  Stack Overflow post for details.</p>
</div>
<div class="paragraph">
<p>Please note however this affects the JVM’s random  number generation and may present other challenges where strong cryptography is required. Configure with caution.</p>
</div>
</div>
<div class="sect4">
<h5 id="_not_able_to_clone_kie_workbench_git_repository_using_ssh_protocol"><a class="anchor" href="#_not_able_to_clone_kie_workbench_git_repository_using_ssh_protocol"></a><a class="link" href="#_not_able_to_clone_kie_workbench_git_repository_using_ssh_protocol">20.1.4.2. Not able to clone KIE Workbench Git repository using ssh protocol.</a></h5>
<div class="paragraph">
<p>Git clients using ssh to interact with the Git server that is bundled with Workbench are authenticated and authorized to perform git commands by the security API that is part of the Uberfire backend server.  When using an LDAP security realm, some git clients were not being authorized as expected.  This was due to the fact that for non-web clients such as Git via ssh, the principal (i.e., user or group) name assigned to a user by the application server’s user registry is the more complex DN associated to that principal by LDAP. The logic of the Uberfire backend server looked for on exact match of roles allowed with the principal name returned and therefore failed.</p>
</div>
<div class="paragraph">
<p>It is now possible to control the role-principal matching via the system property</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-property" data-lang="property">org.uberfire.ldap.regex.role_mapper</code></pre>
</div>
</div>
<div class="paragraph">
<p>which takes as its value a Regex pattern to be applied when matching LDAP principal to role names.  The pattern must contain the literal word variable 'role'.  During authorization the variable is replaced by each of the allow application roles.  If the pattern is matched the role is added to the user.</p>
</div>
<div class="paragraph">
<p>For instance, if the DN for the admin group in LDAP is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-property" data-lang="property">DN: cn=admin,ou=groups,dc=example,dc=com</code></pre>
</div>
</div>
<div class="paragraph">
<p>and its intended role is admin, then setting <code>org.uberfire.ldap.regex.role_mapper</code> with value</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-regex" data-lang="regex">cn[\\ ]*=[\\ ]*role</code></pre>
</div>
</div>
<div class="paragraph">
<p>will find a match on role 'admin'.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.quickstart"><a class="anchor" href="#_wb.quickstart"></a><a class="link" href="#_wb.quickstart">20.2. Quick Start</a></h3>
<div class="paragraph">
<p>These steps help you get started with minimum of effort.</p>
</div>
<div class="paragraph">
<p>They should not be a substitute for reading the documentation in full.</p>
</div>
<div class="sect3">
<h4 id="_wb.quickstartimportexamples"><a class="anchor" href="#_wb.quickstartimportexamples"></a><a class="link" href="#_wb.quickstartimportexamples">20.2.1. Importing examples</a></h4>
<div class="openblock">
<div class="title">Import Examples - Quick install examples</div>
<div class="content">
<div class="paragraph">
<p>If the Workbench is empty you are shown an empty Space page. Clicking "Try Samples" button below will show the examples that are available.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-example1.png" alt="QuickStart example1">
</div>
</div>
<div class="paragraph">
<p>Once "Try Samples" page opens, you can select one or more examples and click "Ok".</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-example2.png" alt="QuickStart example2">
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the Workbench already contains Projects the examples can be imported with the "Try Samples" button found from the menu.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-import-with-pre-existing-projects.png" alt="QuickStart import with pre existing projects">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartaddproject"><a class="anchor" href="#_wb.quickstartaddproject"></a><a class="link" href="#_wb.quickstartaddproject">20.2.2. Add Project</a></h4>
<div class="paragraph">
<p>Alternatively, to importing an example, a new empty project can be created from the Space page with "Add Project".</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-example1.png" alt="QuickStart example1">
</div>
<div class="title">Figure 202. New Project button</div>
</div>
<div class="paragraph">
<p>Give the Project a name and optional description.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-new-project-wizard.png" alt="QuickStart new project wizard">
</div>
<div class="title">Figure 203. Giving Project a name</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartdefinedatamodel"><a class="anchor" href="#_wb.quickstartdefinedatamodel"></a><a class="link" href="#_wb.quickstartdefinedatamodel">20.2.3. Define Data Model</a></h4>
<div class="paragraph">
<p>After a Project has been created you need to define Types to be used by your rules.</p>
</div>
<div class="paragraph">
<p>Select "Data Object" from the "Create New Asset" menu.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also use types contained in existing JARs.</p>
</div>
<div class="paragraph">
<p>Please consult the full documentation for details.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-create-a-data-model.png" alt="QuickStart create a data model">
</div>
<div class="title">Figure 204. Creating "Data Object"</div>
</div>
<div class="paragraph">
<p>Set the name and select a package for the new type.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-create-data-object-popup.png" alt="QuickStart create data object popup">
</div>
<div class="title">Figure 205. Creating a new type</div>
</div>
<div class="paragraph">
<p>Click "+ add field" button and set a field name and type and click on "Create" to create a field for the type.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-create-field.png" alt="QuickStart create field">
</div>
<div class="title">Figure 206. Click "Create" and add the field</div>
</div>
<div class="paragraph">
<p>Click "Save" to update the model.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-confirm-save.png" alt="QuickStart confirm save">
</div>
<div class="title">Figure 207. Clicking "Save"</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartdefinerule"><a class="anchor" href="#_wb.quickstartdefinerule"></a><a class="link" href="#_wb.quickstartdefinerule">20.2.4. Define Rule</a></h4>
<div class="paragraph">
<p>Select "DRL file" (for example) from the "Create New Asset" menu.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-create-drl-file.png" alt="QuickStart create drl file">
</div>
<div class="title">Figure 208. Selecting "DRL file" from the "Create New Asset" menu</div>
</div>
<div class="paragraph">
<p>Enter a file name for the new rule.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure you select the same package as the rule had. It is possible to have rules and data models in different packages, but let’s keep things simple for demo purposes.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-new-rule-popup.png" alt="QuickStart new rule popup">
</div>
<div class="title">Figure 209. Entering a file name for rule</div>
</div>
<div class="paragraph">
<p>Enter a definition for the rule.</p>
</div>
<div class="paragraph">
<p>The definition process differs from asset type to asset type.</p>
</div>
<div class="paragraph">
<p>The full documentation has details about the different editors.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-writing-a-rule.png" alt="QuickStart writing a rule">
</div>
<div class="title">Figure 210. Defining a rule</div>
</div>
<div class="paragraph">
<p>Once the rule has been defined it will need to be saved in the same way we saved the model.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.quickstartbuildanddeloy"><a class="anchor" href="#_wb.quickstartbuildanddeloy"></a><a class="link" href="#_wb.quickstartbuildanddeloy">20.2.5. Build and Deploy</a></h4>
<div class="paragraph">
<p>Once rules have been defined within a project; the project can be built and deployed to the Workbench’s Maven Artifact Repository.</p>
</div>
<div class="paragraph">
<p>To build a project select the "Build &amp; Deploy" from the Project Authoring.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/QuickStart-build-and-deploy.png" alt="QuickStart build and deploy">
</div>
<div class="title">Figure 211. Building a project</div>
</div>
<div class="paragraph">
<p>Click "Build &amp; Deploy" to build the project and deploy it to the Workbench’s Maven Artifact Repository.</p>
</div>
<div class="paragraph">
<p>When you select Build &amp; Deploy the workbench will deploy to any repositories defined in the Dependency Management section of the pom in your workbench project.
You can edit the pom.xml file associated with your workbench project under the Repository View of the project explorer.
Details on dependency management in maven can be found here : <a href="http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html" class="bare">http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html</a></p>
</div>
<div class="paragraph">
<p>If there are errors during the build process they will be reported in the "Messages" panel.</p>
</div>
<div class="paragraph">
<p>Now the project has been built and deployed; it can be referenced from your own projects as any other Maven Artifact.</p>
</div>
<div class="paragraph">
<p>The full documentation contains details about integrating projects with your own applications.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.configuration"><a class="anchor" href="#_wb.configuration"></a><a class="link" href="#_wb.configuration">20.3. Configuration</a></h3>
<div class="sect3">
<h4 id="_wb.usermanagement"><a class="anchor" href="#_wb.usermanagement"></a><a class="link" href="#_wb.usermanagement">20.3.1. Basic user management</a></h4>
<div class="paragraph">
<p>The workbench authenticates its users against the application server’s authentication and authorization (JAAS).</p>
</div>
<div class="paragraph">
<p>On JBoss EAP and WildFly, add a user with the script <code>$JBOSS_HOME/bin/add-user.sh</code> (or <code>.bat</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$ ./add-user.sh
<span class="hljs-comment">// Type: Application User</span>
<span class="hljs-comment">// Realm: empty (defaults to ApplicationRealm)</span>
<span class="hljs-comment">// Role: admin</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no need to restart the application server.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.roles"><a class="anchor" href="#_wb.roles"></a><a class="link" href="#_wb.roles">20.3.2. Roles</a></h4>
<div class="paragraph">
<p>The Workbench uses the following roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>admin</p>
</li>
<li>
<p>analyst</p>
</li>
<li>
<p>developer</p>
</li>
<li>
<p>manager</p>
</li>
<li>
<p>user</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_admin"><a class="anchor" href="#_admin"></a><a class="link" href="#_admin">20.3.2.1. Admin</a></h5>
<div class="paragraph">
<p>Administrates the BPMS system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manages users</p>
</li>
<li>
<p>Manages VFS Repositories</p>
</li>
<li>
<p>Has full access to make any changes necessary</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_developer"><a class="anchor" href="#_developer"></a><a class="link" href="#_developer">20.3.2.2. Developer</a></h5>
<div class="paragraph">
<p>Developer can do almost everything admin can do, except clone repositories.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manages rules, models, process flows, forms and dashboards</p>
</li>
<li>
<p>Manages the asset repository</p>
</li>
<li>
<p>Can create, build and deploy projects</p>
</li>
<li>
<p>Can use the JBDS connection to view processes</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_analyst"><a class="anchor" href="#_analyst"></a><a class="link" href="#_analyst">20.3.2.3. Analyst</a></h5>
<div class="paragraph">
<p>Analyst is a weaker version of developer and does not have access to the asset repository or the ability to deploy projects.</p>
</div>
</div>
<div class="sect4">
<h5 id="_business_user"><a class="anchor" href="#_business_user"></a><a class="link" href="#_business_user">20.3.2.4. Business user</a></h5>
<div class="paragraph">
<p>Daily user of the system to take actions on business tasks that are required for the processes to continue forward.
Works primarily with the task lists.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Does process management</p>
</li>
<li>
<p>Handles tasks and dashboards</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_manager_viewer_only_user"><a class="anchor" href="#_manager_viewer_only_user"></a><a class="link" href="#_manager_viewer_only_user">20.3.2.5. Manager/Viewer-only User</a></h5>
<div class="paragraph">
<p>Viewer of the system that is interested in statistics around the business processes and their performance, business indicators, and other reporting of the system and people who interact with the system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only has access to dashboards</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.introduction"><a class="anchor" href="#_wb.introduction"></a><a class="link" href="#_wb.introduction">20.4. Introduction</a></h3>
<div class="sect3">
<h4 id="_wb.loginandlogout"><a class="anchor" href="#_wb.loginandlogout"></a><a class="link" href="#_wb.loginandlogout">20.4.1. Log in and log out</a></h4>
<div class="paragraph">
<p>Create a user with the role <code>admin</code> and log in with those credentials.</p>
</div>
<div class="paragraph">
<p>After successfully logging in, the account username is displayed at the top right.
Click on it to review the roles of the current account.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wb.homescreen"><a class="anchor" href="#_wb.homescreen"></a><a class="link" href="#_wb.homescreen">20.4.2. Home screen</a></h4>
<div class="paragraph">
<p>After logging in, the home screen shows.
The actual content of the home screen depends on the workbench variant (Drools, jBPM, …​).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/home.png" alt="home">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.administrationoverview"><a class="anchor" href="#_wb.administrationoverview"></a><a class="link" href="#_wb.administrationoverview">20.4.3. Workbench overview</a></h4>
<div class="paragraph">
<p>A workbench is structured with Spaces and Projects:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/workbenchStructureOverview.png" alt="workbenchStructureOverview">
</div>
</div>
<div class="sect4">
<h5 id="_wb.space"><a class="anchor" href="#_wb.space"></a><a class="link" href="#_wb.space">20.4.3.1. Space</a></h5>
<div class="paragraph">
<p>Spaces are useful to model departments and divisions.</p>
</div>
<div class="paragraph">
<p>A Space can hold multiple Projects.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/Space.png" alt="Space">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.project"><a class="anchor" href="#_wb.project"></a><a class="link" href="#_wb.project">20.4.3.2. Project</a></h5>
<div class="paragraph">
<p>Projects are the place where assets are stored and each project belongs to a single Space.</p>
</div>
<div class="paragraph">
<p>Projects are in fact a Virtual File System based storage, that by default uses GIT as backend.
Such setup allows workbench to work with multiple backends and, in the same time, take full advantage of backend specifics features like in GIT case versioning, branching and even external access.</p>
</div>
<div class="paragraph">
<p>A new Project can be created from scratch or cloned from an existing repository.</p>
</div>
<div class="paragraph">
<p>One of the biggest advantage of using GIT as backend is the ability to clone a repository from external and use your preferred tools to edit and build your assets.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Never</strong> clone your repositories directly from <a href="#_wb.systemproperties">.niogit</a> directory.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.workbenchconcepts"><a class="anchor" href="#_wb.workbenchconcepts"></a><a class="link" href="#_wb.workbenchconcepts">20.4.4. Workbench user interface concepts</a></h4>
<div class="paragraph">
<p>The Workbench is comprised of different logical entities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Part</p>
<div class="paragraph">
<p>A Part is a screen or editor with which the user can interact to perform operations.</p>
</div>
<div class="paragraph">
<p>Example Parts are "Project Explorer", "Project Editor", "Guided Rule Editor" etc.</p>
</div>
</li>
<li>
<p>Page</p>
<div class="paragraph">
<p>A perspective is a logical grouping of related Panels and Parts. A perspective is usually named as <em>page</em>, since it is
a term far more familiar to end users whereas a perspective is more developer oriented. Notice however, the Workbench
supports both developer created pages and those created by end users from the page builder (aka Content Management)
tooling but, generally speaking, <em>page</em> is used to refer both.</p>
</div>
<div class="paragraph">
<p>The user can switch between pages by clicking on one of the top-level menu items; such as "Home", "Authoring", "Deploy" etc.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.changinglayout"><a class="anchor" href="#_wb.changinglayout"></a><a class="link" href="#_wb.changinglayout">20.5. Changing the layout</a></h3>
<div class="sect3">
<h4 id="_wb.resizing"><a class="anchor" href="#_wb.resizing"></a><a class="link" href="#_wb.resizing">20.5.1. Resizing</a></h4>
<div class="paragraph">
<p>Move the mouse pointer over the panel splitter (a grey horizontal or vertical line in between panels).</p>
</div>
<div class="paragraph">
<p>The cursor will by changing indicate it is positioned correctly over the splitter.
Press and hold the left mouse button and drag the splitter to the required position; then release the left mouse button.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.authoring"><a class="anchor" href="#_wb.authoring"></a><a class="link" href="#_wb.authoring">20.6. Authoring (General)</a></h3>
<div class="sect3">
<h4 id="_wb.artifactrepository"><a class="anchor" href="#_wb.artifactrepository"></a><a class="link" href="#_wb.artifactrepository">20.6.1. Artifact Repository</a></h4>
<div class="paragraph">
<p>Projects often need external artifacts in their classpath in order to build, for example a domain model JARs.
The artifact repository holds those artifacts.</p>
</div>
<div class="paragraph">
<p>The Artifact Repository is a full blown Maven repository.
It follows the semantics of a Maven remote repository: all snapshots are timestamped.
But it is often stored on the local hard drive.</p>
</div>
<div class="paragraph">
<p>By default the artifact repository is stored under <code>$WORKING_DIRECTORY/repositories/kie</code>, but it can be overridden with the <a href="#_wb.systemproperties">system property</a><code>-Dorg.guvnor.m2repo.dir</code>.
There is only 1 Maven repository per installation.</p>
</div>
<div class="paragraph">
<p>The Artifact Repository screen shows a list of the artifacts in the Maven repository:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/mavenRepositoryExplorer.png" alt="mavenRepositoryExplorer">
</div>
</div>
<div class="paragraph">
<p>To add a new artifact to that Maven repository, either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the upload button and select a JAR. If the JAR contains a POM file under <code>META-INF/maven</code> (which every JAR build by Maven has), no further information is needed. Otherwise, a groupId, artifactId and version need be given too.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/mavenRepositoryUpload.png" alt="mavenRepositoryUpload">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Using Maven, <code>mvn deploy</code> to that Maven repository. Refresh the list to make it show up.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This remote Maven repository is relatively simple.
It does not support proxying, mirroring, …​ like Nexus or Archiva.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_wb.asseteditor"><a class="anchor" href="#_wb.asseteditor"></a><a class="link" href="#_wb.asseteditor">20.6.2. Asset Editor</a></h4>
<div class="paragraph">
<p>The Asset Editor is the principle component of the workbench User-Interface.
It consists of two main views Editor and Overview.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The views</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AssetEditor-edit.png" alt="AssetEditor edit">
</div>
<div class="title">Figure 212. The Asset Editor - Editor tab</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A : The editing area - exactly what form the editor takes depends on the Asset type. An asset can only be edited by one user at a time to avoid conflicts. When a user begins to edit an asset, a lock will automatically be acquired. This is indicated by a lock symbol appearing on the asset title bar as well as in the project explorer view (see <a href="#_wb.projectexplorer">Project Explorer</a> for details). If a user starts editing an already locked asset a pop-up notification will appear to inform the user that the asset can’t currently be edited, as it is being worked on by another user. Changes will be prevented until the editing user saves or closes the asset, or logs out of the workbench. Session timeouts will also cause locks to be released. Every user further has the option to force a lock release, if required (see the Metadata section below).</p>
</li>
<li>
<p>B : This menu bar contains various actions for the Asset; such as Save, Rename, Copy etc. Note that saving, renaming and deleting are deactivated if the asset is locked by a different user.</p>
</li>
<li>
<p>C : Different views for asset content or asset information.</p>
<div class="ulist">
<ul>
<li>
<p>Editor shows the main editor for the asset</p>
</li>
<li>
<p>Overview contains the metadata and conversation views for this editor. Explained in more detail below.</p>
</li>
<li>
<p>Source shows the asset in plain DRL. Note: This tab is only visible if the asset content can be generated into DRL.</p>
</li>
<li>
<p>Data Objects contains the model available for authoring. By default only Data Objects that reside within the same package as the asset are available for authoring. Data Objects outside of this package can be imported to become available for authoring the asset.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AssetEditor-dataobjects.png" alt="AssetEditor dataobjects">
</div>
<div class="title">Figure 213. The Asset Editor - Data Objects tab</div>
</div>
</li>
<li>
<p>Overview</p>
<div class="ulist">
<ul>
<li>
<p>A : General information about the asset and the asset’s description.</p>
<div class="paragraph">
<p>"Type:" The format name of the type of Asset.</p>
</div>
<div class="paragraph">
<p>"Description:" Description for the asset.</p>
</div>
<div class="paragraph">
<p>"Used in projects:" Names the projects where this rule is used.</p>
</div>
<div class="paragraph">
<p>"Last Modified:" Who made the last change and when.</p>
</div>
<div class="paragraph">
<p>"Created on:" Who created the asset and when.</p>
</div>
</li>
<li>
<p>B : Version history for the asset. Selecting a version loads the selected version into this editor.</p>
</li>
<li>
<p>C : Meta data (from the "Dublin Core" standard)</p>
</li>
<li>
<p>D : Comments regarding the development of the Asset can be recorded here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>.The Asset Editor - Overview tab
image::Workbench/Authoring/AssetEditor/Overview.png[align="center"]</p>
</div>
</li>
<li>
<p>Metadata</p>
<div class="ulist">
<ul>
<li>
<p>A : Meta data:-</p>
<div class="paragraph">
<p>"Tags:" A tagging system for grouping the assets.</p>
</div>
<div class="paragraph">
<p>"Note:" A comment made when the Asset was last updated (i.e.
why a change was made)</p>
</div>
<div class="paragraph">
<p>"URI:" URI to the asset inside the Git repository.</p>
</div>
<div class="paragraph">
<p>"Subject/Type/External link/Source" : Other miscellaneous meta data for the Asset.</p>
</div>
<div class="paragraph">
<p>"Lock status" : Shows the lock status of the asset and, if locked, allows to force unlocking the asset.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>.The Metadata tab
image::Workbench/Authoring/AssetEditor/Metadata.png[align="center"]</p>
</div>
</li>
<li>
<p>Locking</p>
<div class="paragraph">
<p>The Workbench supports pessimistic locking of assets.
When one User starts editing an asset it is locked to change by other Users.
The lock is held until a period of inactivity lapses, the Editor is closed or the application stopped and restarted.
Locks can also be forcibly removed on the MetaData section of the Overview tab.</p>
</div>
<div class="paragraph">
<p>A "padlock" icon is shown in the Editor’s title bar and beside the asset in the Project Explorer when an asset is locked.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/AssetEditor-locked.png" alt="AssetEditor locked">
</div>
<div class="title">Figure 214. The Asset Editor - Locked assets cannot be edited by other users</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_wb.tagseditor"><a class="anchor" href="#_wb.tagseditor"></a><a class="link" href="#_wb.tagseditor">20.6.3. Tags Editor</a></h4>
<div class="paragraph">
<p>Tags allow assets to be labelled with any number of tags that you define.
These tags can be used to filter assets on the Project Explorer enabling "Tag filtering".</p>
</div>
<div class="sect4">
<h5 id="_wb.managingtags"><a class="anchor" href="#_wb.managingtags"></a><a class="link" href="#_wb.managingtags">20.6.3.1. Creating Tags</a></h5>
<div class="paragraph">
<p>To create tags you simply have to write them on the Tags input and press the "Add new Tag/s" button.
The Tag Editor allows creating tags one by one or writing more than one separated with a white space.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/CreatingTags.png" alt="CreatingTags">
</div>
<div class="title">Figure 215. Creating Tags</div>
</div>
<div class="paragraph">
<p>Once you created new Tags they will appear over the Editor allowing you to remove them by pressing on them if you want.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ExistingTags.png" alt="ExistingTags">
</div>
<div class="title">Figure 216. Existing Tags</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.projectexplorer"><a class="anchor" href="#_wb.projectexplorer"></a><a class="link" href="#_wb.projectexplorer">20.6.4. Project Explorer</a></h4>
<div class="paragraph">
<p>The Project Explorer provides the ability to browse files inside the current Project. The Project Explorer can be accessed from the left side when an Asset Editor is open.</p>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerempty"><a class="anchor" href="#_wb.projectexplorerempty"></a><a class="link" href="#_wb.projectexplorerempty">20.6.4.1. Initial view</a></h5>
<div class="paragraph">
<p>If a file is currently being edited by another user, a lock symbol will be displayed in front of the file name.
The symbol is blue in case the lock is owned by the currently authenticated user, otherwise black.
Moving the mouse pointer over the lock symbol will display a tooltip providing the name of the user who is currently editing the file (and therefore owning the lock). To learn more about locking see <a href="#_wb.asseteditor">Asset Editor</a>
 for details.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProjectExplorer-Project-Expanded.png" alt="ProjectExplorer Project Expanded">
</div>
<div class="title">Figure 217. Expanded asset group</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerswitchingview"><a class="anchor" href="#_wb.projectexplorerswitchingview"></a><a class="link" href="#_wb.projectexplorerswitchingview">20.6.4.2. Different views</a></h5>
<div class="paragraph">
<p>Project Explorer supports multiple views.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Project View</p>
<div class="paragraph">
<p>A simplified view of the underlying project structure.
Certain system files are hidden from view.</p>
</div>
</li>
<li>
<p>Repository View</p>
<div class="paragraph">
<p>A complete view of the underlying project structure including all files; either user-defined or system generated.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Views can be selected by clicking on the icon within the Project Explorer, as shown below.</p>
</div>
<div class="paragraph">
<p>Both Project and Repository Views can be further refined by selecting either "Show as Folders" or "Show as Links".</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProjectExplorer-Switching-View.png" alt="ProjectExplorer Switching View">
</div>
<div class="title">Figure 218. Switching view</div>
</div>
<div class="sect5">
<h6 id="_wb.projectexplorertechnicalview"><a class="anchor" href="#_wb.projectexplorertechnicalview"></a><a class="link" href="#_wb.projectexplorertechnicalview">Repository View examples</a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProjectExplorer-Repository-Folders.png" alt="ProjectExplorer Repository Folders">
</div>
<div class="title">Figure 219. Repository View - Folders</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProjectExplorer-Repository-Links.png" alt="ProjectExplorer Repository Links">
</div>
<div class="title">Figure 220. Repository View - Links</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerdownloads"><a class="anchor" href="#_wb.projectexplorerdownloads"></a><a class="link" href="#_wb.projectexplorerdownloads">20.6.4.3. Download Project or Repository</a></h5>
<div class="paragraph">
<p>Download Download and Download Repository make it possible to download the project or repository as a zip file.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProjectExplorer-Downloads.png" alt="ProjectExplorer Downloads">
</div>
<div class="title">Figure 221. Repository and Project Downloads</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorerfilteringbytag"><a class="anchor" href="#_wb.projectexplorerfilteringbytag"></a><a class="link" href="#_wb.projectexplorerfilteringbytag">20.6.4.4. Filtering by Tag</a></h5>
<div class="paragraph">
<p>To make easy view the elements on packages that contain a lot of assets, is possible to enabling the Tag filter, whichs allows you to filter the assets by their tags.</p>
</div>
<div class="paragraph">
<p>To see how to add tags to an asset look at: <a href="#_wb.tagseditor">Tags Editor</a></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProjectExplorer-Tag-Filter-Enable.png" alt="ProjectExplorer Tag Filter Enable">
</div>
<div class="title">Figure 222. Enabling Filter by Tag</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProjectExplorer-Tag-Filter-Show.png" alt="ProjectExplorer Tag Filter Show">
</div>
<div class="title">Figure 223. Filter by Tag</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProjectExplorer-Tag-Filter-Working.png" alt="ProjectExplorer Tag Filter Working">
</div>
<div class="title">Figure 224. Filtering by Tag</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.projectexplorercopyrenamedeleteactions"><a class="anchor" href="#_wb.projectexplorercopyrenamedeleteactions"></a><a class="link" href="#_wb.projectexplorercopyrenamedeleteactions">20.6.4.5. Copy, Rename, Delete and Download Actions</a></h5>
<div class="paragraph">
<p>Copy, rename and delete actions are available on Links mode, for packages in of Project View and for files and directories in Repository View. Download action is available for directories.
Download option downloads the selected the selected directory as a zip file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A : Copy</p>
</li>
<li>
<p>B : Rename</p>
</li>
<li>
<p>C : Delete</p>
</li>
<li>
<p>D : Download</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProjectExplorer-Project-Links-Copy-Rename-Delete.png" alt="ProjectExplorer Project Links Copy Rename Delete">
</div>
<div class="title">Figure 225. Project View - Package actions</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Workbench roadmap includes a refactoring and an impact analyses tools, but currenctly doesn’t have it.
Until both tools are provided make sure that your changes (copy/rename/delete) on packages, files or directories doesn’t have a major impact on your project.</p>
</div>
<div class="paragraph">
<p>In cases that your change had an unexcepcted impact, Workbench allows you to restore your repository using the <a href="#_wb.vfsrepositoryeditor">Repository
        editor</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Files locked by other users as well as directories that contain such files cannot be renamed or deleted until the corresponding locks are released.
If that is the case the rename and delete symbols will be deactivated.
To learn more about locking see <a href="#_wb.asseteditor">Asset Editor</a>
 for details.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProjectExplorer-Delete-NotAllowed.png" alt="ProjectExplorer Delete NotAllowed">
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.projecteditor"><a class="anchor" href="#_wb.projecteditor"></a><a class="link" href="#_wb.projecteditor">20.6.5. Project Editor</a></h4>
<div class="paragraph">
<p>The Project Editor screen can be accessed from Project Explorer.
Project Editor shows the settings for the currently active project.</p>
</div>
<div class="paragraph">
<p>Unlike most of the workbench editors, project  editor edits more than one file.
Showing everything that is needed for configuring the KIE project in one place.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/project_editor_menu.png" alt="project editor menu">
</div>
<div class="title">Figure 226. Project Screen and the different views</div>
</div>
<div class="sect4">
<h5 id="_build_deploy"><a class="anchor" href="#_build_deploy"></a><a class="link" href="#_build_deploy">20.6.5.1. Build &amp; Deploy</a></h5>
<div class="paragraph">
<p>Build &amp; Depoy builds the current project and deploys the KJAR into the workbench internal Maven repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="_project_settings"><a class="anchor" href="#_project_settings"></a><a class="link" href="#_project_settings">20.6.5.2. Project Settings</a></h5>
<div class="paragraph">
<p>Project Settings edits the pom.xml file used by Maven.</p>
</div>
<div class="sect5">
<h6 id="_project_general_settings"><a class="anchor" href="#_project_general_settings"></a><a class="link" href="#_project_general_settings">Project General Settings</a></h6>
<div class="paragraph">
<p>General settings provide tools for project name and GAV-data (Group, Artifact, Version). GAV values are used as identifiers to differentiate projects and versions of the same project.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/general_settings.png" alt="general settings">
</div>
<div class="title">Figure 227. Project Settings</div>
</div>
</div>
<div class="sect5">
<h6 id="_dependencies"><a class="anchor" href="#_dependencies"></a><a class="link" href="#_dependencies">Dependencies</a></h6>
<div class="paragraph">
<p>The project may have any number of either internal or external dependencies.
Dependency is a project that has been built and deployed to a Maven repository.
Internal dependencies are projects build and deployed in the same workbench as the project.
External dependencies are retrieved from repositories outside of the current workbench.
Each dependency uses the GAV-values to specify the project name and version that is used by the project.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dependencies.png" alt="dependencies">
</div>
<div class="title">Figure 228. Dependencies</div>
</div>
<div class="sect6">
<h7 id="_package_name_white_list"><a class="anchor" href="#_package_name_white_list"></a><a class="link" href="#_package_name_white_list">Package Name White List</a></h7>
<div class="paragraph">
<p>Classes and declared types in white listed packages show up as Data Objects that can be imported in assets.
The full list is stored in package-name-white-list file that is stored in each project root.</p>
</div>
<div class="paragraph">
<p>Package white list has three modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All packages included: Every package defined in this jar is white listed.</p>
</li>
<li>
<p>Packages not included: None of the packages listed in this jar are white listed.</p>
</li>
<li>
<p>Some packages included: Only part of the packages in the jar are white listed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_metadata"><a class="anchor" href="#_metadata"></a><a class="link" href="#_metadata">Metadata</a></h6>
<div class="paragraph">
<p>Metadata for the pom.xml file.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_knowledge_base_settings"><a class="anchor" href="#_knowledge_base_settings"></a><a class="link" href="#_knowledge_base_settings">20.6.5.3. Knowledge Base Settings</a></h5>
<div class="paragraph">
<p>Knowledge Base Settings edits the kmodule.xml file used by Drools.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/kmodule.png" alt="kmodule">
</div>
<div class="title">Figure 229. Knowledge Base Settings</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information about the Knowledge Base properties, check the Drools Expert documentation for kmodule.xml.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="_knowledge_bases_and_sessions"><a class="anchor" href="#_knowledge_bases_and_sessions"></a><a class="link" href="#_knowledge_bases_and_sessions">Knowledge bases and sessions</a></h6>
<div class="paragraph">
<p>Knowledge bases and sessions lists the knowledge bases and the knowledge sessions specified for the project.</p>
</div>
<div class="sect6">
<h7 id="_knowledge_base_list"><a class="anchor" href="#_knowledge_base_list"></a><a class="link" href="#_knowledge_base_list">Knowledge base list</a></h7>
<div class="paragraph">
<p>Lists all the knowledge bases by name.
Only one knowledge base can be set as default.</p>
</div>
</div>
<div class="sect6">
<h7 id="_knowledge_base_properties"><a class="anchor" href="#_knowledge_base_properties"></a><a class="link" href="#_knowledge_base_properties">Knowledge base properties</a></h7>
<div class="paragraph">
<p>Knowledge base can include other knowledge bases.
The models, rules and any other content in the included knowledge base will be visible and usable by the currently selected knowledge base.</p>
</div>
<div class="paragraph">
<p>Rules and models are stored in packages.
The packages property specifies what packages are included into this knowledge base.</p>
</div>
<div class="paragraph">
<p>Equals behavior is explained in the Drools Expert part of the documentation.</p>
</div>
<div class="paragraph">
<p>Event processing mode is explained in the Drools Fusion part of the documentation.</p>
</div>
</div>
<div class="sect6">
<h7 id="_knowledge_sessions"><a class="anchor" href="#_knowledge_sessions"></a><a class="link" href="#_knowledge_sessions">Knowledge sessions</a></h7>
<div class="paragraph">
<p>The table lists all the knowledge sessions in the selected knowledge base.
There can be only one default of each type.
The types are stateless and stateful.
Clicking the pen-icon opens a popup that shows more properties for the knowledge session.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_metadata_2"><a class="anchor" href="#_metadata_2"></a><a class="link" href="#_metadata_2">Metadata</a></h6>
<div class="paragraph">
<p>Metadata for the kmodule.xml</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_imports"><a class="anchor" href="#_imports"></a><a class="link" href="#_imports">20.6.5.4. Imports</a></h5>
<div class="paragraph">
<p>Settings edits the project.imports file used by the workbench editors.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ExternalDataObjects.png" alt="ExternalDataObjects">
</div>
<div class="title">Figure 230. Imports</div>
</div>
<div class="sect5">
<h6 id="_external_data_objects"><a class="anchor" href="#_external_data_objects"></a><a class="link" href="#_external_data_objects">External Data Objects</a></h6>
<div class="paragraph">
<p>Data Objects provided by the Java Runtime environment may need to be registered to be available to rule authoring where such  Data Objects are not implicitly available as part of an existing Data Object defined within the Workbench or a Project dependency.
For example an Author may want to define a rule that checks for <code>java.util.ArrayList</code> in Working Memory.
If a domain Data  Object has a field of type <code>java.util.ArrayList</code> there is no need create a registraton.</p>
</div>
</div>
<div class="sect5">
<h6 id="_metadata_3"><a class="anchor" href="#_metadata_3"></a><a class="link" href="#_metadata_3">Metadata</a></h6>
<div class="paragraph">
<p>Metadata for the project.imports file.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_duplicate_gav_detection"><a class="anchor" href="#_duplicate_gav_detection"></a><a class="link" href="#_duplicate_gav_detection">20.6.5.5. Duplicate GAV detection</a></h5>
<div class="paragraph">
<p>When performing any of the following operations a check is now made against all Maven Repositories, resolved for the Project,  for whether the Project’s GroupId, ArtifactId and Version pre-exist.
If a clash is found the operation is prevented; although this can be overridden by Users with the <code>admin</code> role.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The feature can be disabled by setting the System Property <code>org.guvnor.project.gav.check.disabled</code> to <code>true</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Resolved repositories are those discovered in:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Project’s <code>POM<code></code>&lt;repositories&gt;</code> section (or any parent <code>POM</code>).</p>
</li>
<li>
<p>The Project’s <code>POM<code></code>&lt;distributionManagement&gt;</code> section.</p>
</li>
<li>
<p>Maven’s global <code>settings.xml</code> configuration file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Affected operations:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation of new Managed Repositories.</p>
</li>
<li>
<p>Saving a Project defintion with the Project Editor.</p>
</li>
<li>
<p>Adding new Modules to a Managed Multi-Module Repository.</p>
</li>
<li>
<p>Saving the <code>pom.xml</code> file.</p>
</li>
<li>
<p>Build &amp; installing a Project with the Project Editor.</p>
</li>
<li>
<p>Build &amp; deploying a Project with the Project Editor.</p>
</li>
<li>
<p>Asset Management operations building, installing or deloying Projects.</p>
</li>
<li>
<p><code>REST</code> operations creating, installing or deploying Projects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users with the <code>Admin</code> role can override the list of Repositories checked using the "Repositories" settings in the Project Editor.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/validation-menu-item.png" alt="validation menu item">
</div>
<div class="title">Figure 231. Project Editor - Viewing resolved Repositories</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/MavenRepositories2.png" alt="MavenRepositories2">
</div>
<div class="title">Figure 232. Project Editor - The list of resolved Repositories</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/MavenRepositories3.png" alt="MavenRepositories3">
</div>
<div class="title">Figure 233. Duplicate GAV detected</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.validation"><a class="anchor" href="#_wb.validation"></a><a class="link" href="#_wb.validation">20.6.6. Validation</a></h4>
<div class="paragraph">
<p>The Workbench provides a common and consistent service for users to understand whether files authored within the environment are valid.</p>
</div>
<div class="sect4">
<h5 id="_wb.problemspanel"><a class="anchor" href="#_wb.problemspanel"></a><a class="link" href="#_wb.problemspanel">20.6.6.1. Problem Panel</a></h5>
<div class="paragraph">
<p>The Problems Panel shows real-time validation results of assets within a Project.</p>
</div>
<div class="paragraph">
<p>When a Project is selected from the Project Explorer the Problems Panel will refresh with validation results of the chosen Project.</p>
</div>
<div class="paragraph">
<p>When files are created, saved or deleted the Problems Panel content will update to show either new validation errors, or remove existing if a file was deleted.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/workbench-problems-panel.png" alt="workbench problems panel">
</div>
<div class="title">Figure 234. The Problems Panel</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.ondemandvalidation"><a class="anchor" href="#_wb.ondemandvalidation"></a><a class="link" href="#_wb.ondemandvalidation">20.6.6.2. On demand validation</a></h5>
<div class="paragraph">
<p>It is not always desirable to save a file in order to determine whether it is in a valid state.</p>
</div>
<div class="paragraph">
<p>All of the file editors provide the ability to validate the content before it is saved.</p>
</div>
<div class="paragraph">
<p>Clicking on the 'Validate' button shows validation errors, if any.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/workbench-validation.png" alt="workbench validation">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.datamodeller"><a class="anchor" href="#_wb.datamodeller"></a><a class="link" href="#_wb.datamodeller">20.6.7. Data Modeller</a></h4>
<div class="sect4">
<h5 id="_sect_datamodeler_firststeps"><a class="anchor" href="#_sect_datamodeler_firststeps"></a><a class="link" href="#_sect_datamodeler_firststeps">20.6.7.1. First steps to create a data model</a></h5>
<div class="paragraph">
<p>By default, a data model is always constrained to the context of a project.
For the purpose of this tutorial, we will assume that a correctly configured project already exists and the authoring page is open.</p>
</div>
<div class="paragraph">
<p>To start the creation of a data model inside a project, take the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the home panel, select the Desing page and select the given project.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/authoring.jpg" alt="authoring">
</div>
<div class="title">Figure 235. Go to authoring page and select a project</div>
</div>
</li>
<li>
<p>Open the Data Modeller tool by clicking on a Data Object file, or using the "Create New Asset → Data Object" menu option. Set Data Object name to "PurchaseOrder" and click Ok.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/open_data_model.jpg" alt="open data model">
</div>
<div class="title">Figure 236. Click on a Data Object</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This will start up the Data Modeller tool, which has the following general aspect:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/overview.png" alt="overview">
</div>
<div class="title">Figure 237. Data modeller overview</div>
</div>
<div class="paragraph">
<p>The "Editor" tab is divided into the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The new field section is dedicated to the creation of new fields, and is opened when the "add field" button is pressed.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/create-new-field.png" alt="create new field">
</div>
<div class="title">Figure 238. New field creation</div>
</div>
</li>
<li>
<p>The Data Object’s "field browser" section displays a list with the data object fields.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/data-object-field-browser.png" alt="data object field browser">
</div>
<div class="title">Figure 239. The Data Object’s field browser</div>
</div>
</li>
<li>
<p>The "Data Object / Field general properties" section. This is the rightmost section of the Data Modeller editor and visualizes the "Data Object" or "Field" general properties, depending on user selection.</p>
<div class="paragraph">
<p>Data Object general properties can be selected by clicking on the Data Object Selector.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/data-object-selector.png" alt="data object selector">
</div>
<div class="title">Figure 240. Data Object selector</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/data-object-general-properties.png" alt="data object general properties">
</div>
<div class="title">Figure 241. Data Object general properties</div>
</div>
<div class="paragraph">
<p>Field general properties can be selected by clicking on a field.</p>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/field-selector.png" alt="field selector">
</div>
<div class="title">Figure 242. Field selector</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/field-general-properties.png" alt="field general properties">
</div>
<div class="title">Figure 243. Field general properties</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On workbench’s right side a new "Tool Bar" is provided that enables the selection of different context sensitive tool windows that will let the user do domain specific configurations. Currently four tool windows are provided for the following domains "Drools &amp; jBPM", "OptaPlanner", "Persistence" and "Advanced" configurations.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/tool-window-selector.png" alt="tool window selector">
</div>
<div class="title">Figure 244. Data modeller Tool Bar</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/data-object-drools-tool-window.png" alt="data object drools tool window">
</div>
<div class="title">Figure 245. Drools &amp; jBPM tool window</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/data-object-optaplanner-tool-window.png" alt="data object optaplanner tool window">
</div>
<div class="title">Figure 246. OptaPlanner tool window</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To see and use the OptaPlanner tool window, the user needs to have the role <code>plannermgmt</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/data-object-persistence-tool-window.png" alt="data object persistence tool window">
</div>
<div class="title">Figure 247. Persistence tool window</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/data-object-or-field-advanced-tool-window.png" alt="data object or field advanced tool window">
</div>
<div class="title">Figure 248. Advanced tool window</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The "Source" tab shows an editor that allows the visualization and modification of the generated java code.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Round trip between the "Editor" and "Source" tabs is possible, and also source code preservation is provided. It means that not matter where the Java code was generated (e.g. Eclipse, Data modeller), the data modeller will only update the necessary code blocks to maintain the model updated.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/source-editor-tab.png" alt="source editor tab">
</div>
<div class="title">Figure 249. Source editor</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The "Overview" tab shows the standard metadata and version information as the other workbench editors.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_entities"><a class="anchor" href="#_sect_datamodeler_entities"></a><a class="link" href="#_sect_datamodeler_entities">20.6.7.2. Data Objects</a></h5>
<div class="paragraph">
<p>A data model consists of data objects which are a logical representation of some real-world data.
Such data objects have a fixed set of modeller (or application-owned) properties, such as its internal identifier, a label, description, package etc.
Besides those, a data object also has a variable set of user-defined fields, which are an abstraction of a real-world property of the type of data that this logical data object represents.</p>
</div>
<div class="paragraph">
<p>Creating a data object can be achieved using the workbench "New Item - Data Object" menu option.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/create-new-data-object.png" alt="create new data object">
</div>
<div class="title">Figure 250. New Data Object menu option</div>
</div>
<div class="paragraph">
<p>Both resource name and location are mandatory parameters.
When the "Ok" button is pressed a new Java file will be created and a new editor instance will be opened for the file edition.
The optional "Persistable" attribute will add by default configurations on the data object in order to make it a JPA entity.
Use this option if your jBPM project needs to store data object’s information in a data base.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_propertyrelationships"><a class="anchor" href="#_sect_datamodeler_propertyrelationships"></a><a class="link" href="#_sect_datamodeler_propertyrelationships">20.6.7.3. Properties &amp; relationships</a></h5>
<div class="paragraph">
<p>Once the data object has been created, it now has to be completed by adding user-defined properties to its definition.
This can be achieved by pressing the "add field" button.
The "New Field" dialog will be opened and the new field can be created by pressing the "Create" button.
The "Create and continue" button will also add the new field to the Data Object, but won’t close the dialog.
In this way multiple fields can be created avoiding the popup opening multiple times.
The following fields can (or must) be filled out:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The field’s internal identifier (mandatory). The value of this field must be unique per data object, i.e. if the proposed identifier already exists within current data object, an error message will be displayed.</p>
</li>
<li>
<p>A label (optional): as with the data object definition, the user can define a user-friendly label for the data object field which is about to be created. This has no further implications on how fields from objects of this data object will be treated. If a label is defined, then this is how the field will be displayed throughout the data modeller tool.</p>
</li>
<li>
<p>A field type (mandatory): each data object field needs to be assigned with a type.</p>
<div class="paragraph">
<p>This type can be either of the following:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A 'primitive java object' type: these include most of the object equivalents of the standard Java primitive types, such as Boolean, Short, Float, etc, as well as String, Date, BigDecimal and BigInteger.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/create-field-with-primitive-type.png" alt="create field with primitive type">
</div>
<div class="title">Figure 251. Primitive object field types</div>
</div>
</li>
<li>
<p>A 'data object' type: any user defined data object automatically becomes a candidate to be defined as a field type of another data object, thus enabling the creation of relationships between them. A data object field can be created either in 'single' or in 'multiple' form, the latter implying that the field will be defined as a collection of this type, which will be indicated by selecting "List" checkbox.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/types_entity.jpg" alt="types entity">
</div>
<div class="title">Figure 252. Data object field types</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A 'primitive java' type: these include java primitive types byte, short, int, long, float, double, char and boolean.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/types_primitive.jpg" alt="types primitive">
</div>
<div class="title">Figure 253. Primitive field types</div>
</div>
<div class="paragraph">
<p>When finished introducing the initial information for a new field, clicking the 'Create' button will add the newly created field to the end of the data object’s fields table below:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/new-field-was-created.png" alt="new field was created">
</div>
<div class="title">Figure 254. New field has been created</div>
</div>
<div class="paragraph">
<p>The new field will also automatically be selected in the data object’s field list, and its properties will be shown in the Field general properties editor.
Additionally the field properties will be loaded in the different tool windows, in this way the field will be ready for edition in whatever selected tool window.</p>
</div>
<div class="paragraph">
<p>At any time, any field (without restrictions) can be deleted from a data object definition by clicking on the corresponding 'x' icon in the data object’s fields table.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_additionaloptions"><a class="anchor" href="#_sect_datamodeler_additionaloptions"></a><a class="link" href="#_sect_datamodeler_additionaloptions">20.6.7.4. Additional options</a></h5>
<div class="paragraph">
<p>As stated before, both Data Objects as well as Fields require some of their initial properties to be set upon creation.
Additionally there are three domains of properties that can be configured for a given Data Object.
A domain is basically a set of properties related to a given business area.
Current available domains are, "Drools &amp; jJBPM", "Persistence" and the "Advanced" domain.
To work on a given domain the user should select the corresponding "Tool window" (see below) on the right side toolbar.
Every tool window usually provides two editors, the "Data Object" level editor and the "Field" level editor, that will be shown depending on the last selected item, the Data Object or the Field.</p>
</div>
<div class="sect5">
<h6 id="_drools_jbpm_domain"><a class="anchor" href="#_drools_jbpm_domain"></a><a class="link" href="#_drools_jbpm_domain">Drools &amp; jBPM domain</a></h6>
<div class="paragraph">
<p>The Drools &amp; jBPM domain editors manages the set of Data Object or Field properties related to drools applications.</p>
</div>
<div class="sect6">
<h7 id="_drools_jbpm_object_editor"><a class="anchor" href="#_drools_jbpm_object_editor"></a><a class="link" href="#_drools_jbpm_object_editor">Drools &amp; jBPM object editor</a></h7>
<div class="paragraph">
<p>The Drools &amp; jBPM object editor manages the object level drools properties</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/data-object-drools-tool-window.png" alt="data object drools tool window">
</div>
<div class="title">Figure 255. The data object’s properties</div>
</div>
<div class="ulist">
<ul>
<li>
<p>TypeSafe: this property allows to enable/disable the type safe behaviour for current type. By default all type declarations are compiled with type safety enabled. (See Drools for more information on this matter).</p>
</li>
<li>
<p>ClassReactive: this property allows to mark this type to be treated as "Class Reactive" by the Drools engine. (See Drools for more information on this matter).</p>
</li>
<li>
<p>PropertyReactive: this property allows to mark this type to be treated as "Property Reactive" by the Drools engine. (See Drools for more information on this matter).</p>
</li>
<li>
<p>Role: this property allows to configure how the Drools engine should handle instances of this type: either as regular facts or as events. By default all types are handled as a regular fact, so for the time being the only value that can be set is "Event" to declare that this type should be handled as an event. (See Drools Fusion for more information on this matter).</p>
</li>
<li>
<p>Timestamp: this property allows to configure the "timestamp" for an event, by selecting one of his attributes. If set the engine will use the timestamp from the given attribute instead of reading it from the Session Clock. If not, the engine will automatically assign a timestamp to the event. (See Drools Fusion for more information on this matter).</p>
</li>
<li>
<p>Duration: this property allows to configure the "duration" for an event, by selecting one of his attributes. If set the engine will use the duration from the given attribute instead of using the default event duration = 0. (See Drools Fusion for more information on this matter).</p>
</li>
<li>
<p>Expires: this property allows to configure the "time offset" for an event expiration. If set, this value must be a temporal interval in the form: [<mark>d][#h][#m][#s][</mark>[ms]] Where [ ] means an optional parameter and # means a numeric value. e.g.: 1d2h, means one day and two hours. (See Drools Fusion for more information on this matter).</p>
</li>
<li>
<p>Remotable: If checked this property makes the Data Object available to be used with jBPM remote services as REST, JMS and WS. (See jBPM for more information on this matter).</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_drools_jjbpm_field_editor"><a class="anchor" href="#_drools_jjbpm_field_editor"></a><a class="link" href="#_drools_jjbpm_field_editor">Drools &amp; jJBPM field editor</a></h7>
<div class="paragraph">
<p>The Drools &amp; jBPM object editor manages the field level drools properties</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/field-drools-tool-window.png" alt="field drools tool window">
</div>
<div class="title">Figure 256. The data object’s field properties</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Equals: checking this property for a Data Object field implies that it will be taken into account, at the code generation level, for the creation of both the equals() and hashCode() methods in the generated Java class. We will explain this in more detail in the following section.</p>
</li>
<li>
<p>Position: this field requires a zero or positive integer. When set, this field will be interpreted by the Drools engine as a positional argument (see the section below and also the Drools documentation for more information on this subject).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_persistence_domain"><a class="anchor" href="#_persistence_domain"></a><a class="link" href="#_persistence_domain">Persistence domain</a></h6>
<div class="paragraph">
<p>The Persistence domain editors manages the set of Data Object or Field properties related to persistence.</p>
</div>
<div class="sect6">
<h7 id="_persistence_domain_object_editor"><a class="anchor" href="#_persistence_domain_object_editor"></a><a class="link" href="#_persistence_domain_object_editor">Persistence domain object editor</a></h7>
<div class="paragraph">
<p>Persistence domain object editor manages the object level persistence properties</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/data-object-persistence-tool-window.png" alt="data object persistence tool window">
</div>
<div class="title">Figure 257. The data object’s properties</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistable: this property allows to configure current Data Object as persistable.</p>
</li>
<li>
<p>Table name: this property allows to set a user defined database table name for current Data Object.</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="_persistence_domain_field_editor"><a class="anchor" href="#_persistence_domain_field_editor"></a><a class="link" href="#_persistence_domain_field_editor">Persistence domain field editor</a></h7>
<div class="paragraph">
<p>The persistence domain field editor manages the field level persistence properties and is divided in three sections.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/field-persistence-tool-window-sections.png" alt="field persistence tool window sections">
</div>
<div class="title">Figure 258. Persistence domain field editor sections</div>
</div>
<div class="sect7">
<h8 id="_identifier"><a class="anchor" href="#_identifier"></a><a class="link" href="#_identifier">Identifier:</a></h8>
<div class="paragraph">
<p>A persistable Data Object should have one and only one field defined as the Data Object identifier.
The identifier is typically a unique number that distinguishes a given Data Object instance from all other instances of the same class.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Is Identifier: marks current field as the Data Object identifier. A persistable Data Object should have one and only one field marked as identifier, and it should be a base java type, like String, Integer, Long, etc. A field that references a Data Object, or is a multiple field can not be marked as identifier. And also composite identifiers are not supported in this version. When a persistable Data Object is created an identifier field is created by default with the properly initializations, it’s strongly recommended to use this identifier.</p>
</li>
<li>
<p>Generation Strategy: the generation strategy establishes how the identifier values will be automatically generated when the Data Object instances are created and stored in a database. (e.g. by the forms associated to jBPM processes human tasks.) When the by default Identifier field is created, the generation strategy will be also automatically set and it’s strongly recommended to use this configuration.</p>
</li>
<li>
<p>Sequence Generator: the generator represents the seed for the values that will be used by the Generation Strategy. When the by default Identifier field is created the Sequence Generator will be also automatically generated and properly configured to be used by the Generation Strategy.</p>
</li>
</ul>
</div>
</div>
<div class="sect7">
<h8 id="_column_properties"><a class="anchor" href="#_column_properties"></a><a class="link" href="#_column_properties">Column Properties:</a></h8>
<div class="paragraph">
<p>The column properties section enables the customization of some properties of the database column that will store the field value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Column name: optional value that sets the database column name for the given field.</p>
</li>
<li>
<p>Unique: When checked the unique property establishes that current field value should be a unique key when stored in the database. (if not set the default value is false)</p>
</li>
<li>
<p>Nullable: When checked establishes that current field value can be null when stored in a database. (if not set the default value is true)</p>
</li>
<li>
<p>Insertable: When checked establishes that column will be included in SQL INSERT statements generated by the persistence provider. (if not set the default value is true)</p>
</li>
<li>
<p>Updatable: When checked establishes that the column will be included SQL UPDATE statements generated by the persistence provider. (if not set the default value is true)</p>
</li>
</ul>
</div>
</div>
<div class="sect7">
<h8 id="_relationship_properties"><a class="anchor" href="#_relationship_properties"></a><a class="link" href="#_relationship_properties">Relationship Properties:</a></h8>
<div class="paragraph">
<p>When the field’s type is a Data Object type, or a list of a Data Object type a relationship type should be set in order to let the persistence provider to manage the relation.
Fortunately this relation type is automatically set when such kind of fields are added to an already marked as persistable Data Object.
The relationship type is set by the following popup.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/field-persistence-tool-window-sections-relationship-dialog.png" alt="field persistence tool window sections relationship dialog">
</div>
<div class="title">Figure 259. Relationship configuration popup</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Relationship type: sets the type of relation from one of the following options:</p>
<div class="paragraph">
<p>One to one: typically used for 1:1 relations where "A is related to one instance of B", and B exists only when A exists.
e.g.
PurchaseOrder → PurchaseOrderHeader (a PurchaseOrderHeader exists only if the PurchaseOrder exists)</p>
</div>
<div class="paragraph">
<p>One to many: typically used for 1:N relations where "A is related to N instances of B", and the related instances of B exists only when A exists.
e.g.
PurchaseOrder → PurchaseOrderLine (a PurchaseOrderLine exists only if the PurchaseOrder exists)</p>
</div>
<div class="paragraph">
<p>Many to one: typically used for 1:1 relations where "A is related to one instance of B", and B can exist even without A.
e.g.
PurchaseOrder → Client (a Client can exist in the database even without an associated PurchaseOrder)</p>
</div>
<div class="paragraph">
<p>Many to many: typically used for N:N relations where "A can be related to N instances of B, and B can be related to M instances of A at the same time", and both B an A instances can exits in the database independently of the related instances.
e.g.
Course → Student.
(Course can be related to N Students, and a given Student can attend to M courses)</p>
</div>
<div class="paragraph">
<p>When a field of type "Data Object" is added to a given persistable Data Object, the "Many to One" relationship type is generated by default.</p>
</div>
<div class="paragraph">
<p>And when a field of type "list of Data Object" is added to a given persistable Data Object , the "One to Many" relationship is generated by default.</p>
</div>
</li>
<li>
<p>Cascade mode: Defines the set of cascadable operations that are propagated to the associated entity. The value cascade=ALL is equivalent to cascade={PERSIST, MERGE, REMOVE, REFRESH}. e.g. when A → B, and cascade "PERSIST or ALL" is set, if A is saved, then B will be also saved.</p>
<div class="paragraph">
<p>The by default cascade mode created by the data modeller is "ALL" and it’s strongly recommended to use this mode when Data Objects are being used by jBPM processes and forms.</p>
</div>
</li>
<li>
<p>Fetch mode: Defines how related data will be fetched from database at reading time.</p>
<div class="paragraph">
<p>EAGER: related data will be read at the same time.
e.g.
If A → B, when A is read from database B will be read at the same time.</p>
</div>
<div class="paragraph">
<p>LAZY: reading of related data will be delayed usually to the moment they are required.
e.g.
If PurchaseOrder → PurchaseOrderLine the lines reading will be postponed until a method "getLines()" is invoked on a PurchaseOrder instance.</p>
</div>
<div class="paragraph">
<p>The default fetch mode created by the data modeller is "EAGER" and it’s strongly recommended to use this mode when Data Objects are being used by jBPM processes and forms.</p>
</div>
</li>
<li>
<p>Optional: establishes if the right side member of a relationship can be null.</p>
</li>
<li>
<p>Mapped by: used for reverse relations.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_advanced_domain"><a class="anchor" href="#_advanced_domain"></a><a class="link" href="#_advanced_domain">Advanced domain</a></h6>
<div class="paragraph">
<p>The advanced domain enables the configuration of whatever parameter set by the other domains as well as the adding of arbitrary parameters.
As it will be shown in the code generation section every "Data Object / Field" parameter is represented by a java annotation.
The advanced mode enables the configuration of this annotations.</p>
</div>
<div class="sect6">
<h7 id="_advanced_domain_data_object_field_editor"><a class="anchor" href="#_advanced_domain_data_object_field_editor"></a><a class="link" href="#_advanced_domain_data_object_field_editor">Advanced domain Data Object / Field editor.</a></h7>
<div class="paragraph">
<p>The advanced domain editor has the same shape for both Data Object and Field.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/data-object-or-field-advanced-tool-window.png" alt="data object or field advanced tool window">
</div>
<div class="title">Figure 260. Advanced domain editor.</div>
</div>
<div class="paragraph">
<p>The following operations are available</p>
</div>
<div class="ulist">
<ul>
<li>
<p>delete: enables the deletion of a given Data Object or Field annotation.</p>
</li>
<li>
<p>clear: clears a given annotation parameter value.</p>
</li>
<li>
<p>edit: enables the edition of a given annotation parameter value.</p>
</li>
<li>
<p>add annotation: The add annotation button will start a wizard that will let the addition of whatever java annotation available in the project dependencies.</p>
<div class="paragraph">
<p>Add annotation wizard step #1: the first step of the wizard requires the entering of a fully qualified class name of an annotation, and by pressing the "search" button the annotation definition will be loaded into the wizard.
Additionally when the annotation definition is loaded, different wizard steps will be created in order to enable the completion of the different annotation parameters.
Required parameters will be marked with "*".</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-annotation-wizard-step1-annotation-loaded.png" alt="add annotation wizard step1 annotation loaded">
</div>
<div class="title">Figure 261. Annotation definition loaded into the wizard.</div>
</div>
<div class="paragraph">
<p>Whenever it’s possible the wizard will provide a suitable editor for the given parameters.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-annotation-wizard-step2-enum-param-editor.png" alt="add annotation wizard step2 enum param editor">
</div>
<div class="title">Figure 262. Automatically generated enum values editor for an Enumeration annotation parameter.</div>
</div>
<div class="paragraph">
<p>A generic parameter editor will be provided when it’s not possible to calculate a customized editor</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-annotation-wizard-step2-generic-param-editor.png" alt="add annotation wizard step2 generic param editor">
</div>
<div class="title">Figure 263. Generic annotation parameter editor</div>
</div>
<div class="paragraph">
<p>When all required parameters has been entered and validated, the finish button will be enabled and the wizard can be completed by adding the annotation to the given Data Object or Field.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_generatecode"><a class="anchor" href="#_sect_datamodeler_generatecode"></a><a class="link" href="#_sect_datamodeler_generatecode">20.6.7.5. Generate data model code.</a></h5>
<div class="paragraph">
<p>The data model in itself is merely a visual tool that allows the user to define high-level data structures, for them to interact with the Drools Engine on the one hand, and the jBPM platform on the other.
In order for this to become possible, these high-level visual structures have to be transformed into low-level artifacts that can effectively be consumed by these platforms.
These artifacts are Java POJOs (Plain Old Java Objects), and they are generated every time the data model is saved, by pressing the "Save" button in the top Data Modeller Menu.
Additionally when the user round trip between the "Editor" and "Source" tab, the code is auto generated to maintain the consistency with the Editor view and vice versa.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/save_top.jpg" alt="save top">
</div>
<div class="title">Figure 264. Save the data model from the top menu</div>
</div>
<div class="paragraph">
<p>The resulting code is generated according to the following transformation rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The data object’s identifier property will become the Java class’s name. It therefore needs to be a valid Java identifier.</p>
</li>
<li>
<p>The data object’s package property becomes the Java class’s package declaration.</p>
</li>
<li>
<p>The data object’s superclass property (if present) becomes the Java class’s extension declaration.</p>
</li>
<li>
<p>The data object’s label and description properties will translate into the Java annotations "@org.kie.api.definition.type.Label" and "@org.kie.api.definition.type.Description", respectively. These annotations are merely a way of preserving the associated information, and as yet are not processed any further.</p>
</li>
<li>
<p>The data object’s role property (if present) will be translated into the "@org.kie.api.definition.type.Role" Java annotation, that <em>IS</em> interpreted by the application platform, in the sense that it marks this Java class as a Drools Event Fact-Type.</p>
</li>
<li>
<p>The data object’s type safe property (if present) will be translated into the "@org.kie.api.definition.type.TypeSafe Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object’s class reactive property (if present) will be translated into the "@org.kie.api.definition.type.ClassReactive Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object’s property reactive property (if present) will be translated into the "@org.kie.api.definition.type.PropertyReactive Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object’s timestamp property (if present) will be translated into the "@org.kie.api.definition.type.Timestamp Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object’s duration property (if present) will be translated into the "@org.kie.api.definition.type.Duration Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object’s expires property (if present) will be translated into the "@org.kie.api.definition.type.Expires Java annotation. (see Drools)</p>
</li>
<li>
<p>The data object’s remotable property (if present) will be translated into the "@org.kie.api.remote.Remotable Java annotation. (see jBPM)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A standard Java default (or no parameter) constructor is generated, as well as a full parameter constructor, i.e.
a constructor that accepts as parameters a value for each of the data object’s user-defined fields.</p>
</div>
<div class="paragraph">
<p>The data object’s user-defined fields are translated into Java class fields, each one of them with its own getter and setter method, according to the following transformation rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The data object field’s identifier will become the Java field identifier. It therefore needs to be a valid Java identifier.</p>
</li>
<li>
<p>The data object field’s type is directly translated into the Java class’s field type. In case the field was declared to be multiple (i.e. 'List'), then the generated field is of the "java.util.List" type.</p>
</li>
<li>
<p>The equals property: when it is set for a specific field, then this class property will be annotated with the "@org.kie.api.definition.type.Key" annotation, which is interpreted by the Drools Engine, and it will 'participate' in the generated equals() method, which overwrites the equals() method of the Object class. The latter implies that if the field is a 'primitive' type, the equals method will simply compares its value with the value of the corresponding field in another instance of the class. If the field is a sub-entity or a collection type, then the equals method will make a method-call to the equals method of the corresponding data object’s Java class, or of the java.util.List standard Java class, respectively.</p>
<div class="paragraph">
<p>If the equals property is checked for <em>ANY</em> of the data object’s user defined fields, then this also implies that in addition to the default generated constructors another constructor is generated, accepting as parameters all of the fields that were marked with Equals.
Furthermore, generation of the equals() method also implies that also the Object class’s hashCode() method is overwritten, in such a manner that it will call the hashCode() methods of the corresponding Java class types (be it 'primitive' or user-defined types) for all the fields that were marked with Equals in the Data Model.</p>
</div>
</li>
<li>
<p>The position property: this field property is automatically set for all user-defined fields, starting from 0, and incrementing by 1 for each subsequent new field. However the user can freely changes the position among the fields. At code generation time this property is translated into the "@org.kie.api.definition.type.Position" annotation, which can be interpreted by the Drools Engine. Also, the established property order determines the order of the constructor parameters in the generated Java class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, the generated Java class code for the Purchase Order data object, corresponding to its definition as shown in the following figure purchase_example.jpg is visualized in the figure at the bottom of this chapter.
Note that the two of the data object’s fields, namely 'header' and 'lines' were marked with Equals, and have been assigned with the positions 2 and 1, respectively).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/generate-purchase-example.png" alt="generate purchase example">
</div>
<div class="title">Figure 265. Purchase Order configuration</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    <span class="hljs-keyword">package</span> org.jbpm.examples.purchases;

    <span class="hljs-comment">/**
    * This class was automatically generated by the data modeler tool.
    */</span>
    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Label(<span class="hljs-string">"Purchase Order"</span>)
    <span class="hljs-annotation">@org</span>.kie.api.definition.type.TypeSafe(<span class="hljs-keyword">true</span>)
    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Role(org.kie.api.definition.type.Role.Type.EVENT)
    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Expires(<span class="hljs-string">"2d"</span>)
    <span class="hljs-annotation">@org</span>.kie.api.remote.Remotable
    <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PurchaseOrder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span>
    </span>{

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;

    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Label(<span class="hljs-string">"Total"</span>)
    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Position(<span class="hljs-number">3</span>)
    <span class="hljs-keyword">private</span> java.lang.Double total;

    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Label(<span class="hljs-string">"Description"</span>)
    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Position(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">private</span> java.lang.String description;

    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Label(<span class="hljs-string">"Lines"</span>)
    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Position(<span class="hljs-number">2</span>)
    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Key
    <span class="hljs-keyword">private</span> java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines;

    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Label(<span class="hljs-string">"Header"</span>)
    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Position(<span class="hljs-number">1</span>)
    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Key
    <span class="hljs-keyword">private</span> org.jbpm.examples.purchases.PurchaseOrderHeader header;

    <span class="hljs-annotation">@org</span>.kie.api.definition.type.Position(<span class="hljs-number">4</span>)
    <span class="hljs-keyword">private</span> java.lang.Boolean requiresCFOApproval;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PurchaseOrder</span><span class="hljs-params">()</span>
    </span>{
    }

    <span class="hljs-keyword">public</span> java.lang.<span class="hljs-function">Double <span class="hljs-title">getTotal</span><span class="hljs-params">()</span>
    </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.total;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTotal</span><span class="hljs-params">(java.lang.Double total)</span>
    </span>{
    <span class="hljs-keyword">this</span>.total = total;
    }

    <span class="hljs-keyword">public</span> java.lang.<span class="hljs-function">String <span class="hljs-title">getDescription</span><span class="hljs-params">()</span>
    </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.description;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDescription</span><span class="hljs-params">(java.lang.String description)</span>
    </span>{
    <span class="hljs-keyword">this</span>.description = description;
    }

    <span class="hljs-keyword">public</span> java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; getLines()
    {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.lines;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLines</span><span class="hljs-params">(java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines)</span>
    </span>{
    <span class="hljs-keyword">this</span>.lines = lines;
    }

    <span class="hljs-keyword">public</span> org.jbpm.examples.purchases.<span class="hljs-function">PurchaseOrderHeader <span class="hljs-title">getHeader</span><span class="hljs-params">()</span>
    </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.header;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHeader</span><span class="hljs-params">(org.jbpm.examples.purchases.PurchaseOrderHeader header)</span>
    </span>{
    <span class="hljs-keyword">this</span>.header = header;
    }

    <span class="hljs-keyword">public</span> java.lang.<span class="hljs-function">Boolean <span class="hljs-title">getRequiresCFOApproval</span><span class="hljs-params">()</span>
    </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.requiresCFOApproval;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRequiresCFOApproval</span><span class="hljs-params">(java.lang.Boolean requiresCFOApproval)</span>
    </span>{
    <span class="hljs-keyword">this</span>.requiresCFOApproval = requiresCFOApproval;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PurchaseOrder</span><span class="hljs-params">(java.lang.Double total, java.lang.String description,
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    org.jbpm.examples.purchases.PurchaseOrderHeader header,
    java.lang.Boolean requiresCFOApproval)</span>
    </span>{
    <span class="hljs-keyword">this</span>.total = total;
    <span class="hljs-keyword">this</span>.description = description;
    <span class="hljs-keyword">this</span>.lines = lines;
    <span class="hljs-keyword">this</span>.header = header;
    <span class="hljs-keyword">this</span>.requiresCFOApproval = requiresCFOApproval;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PurchaseOrder</span><span class="hljs-params">(java.lang.String description,
    org.jbpm.examples.purchases.PurchaseOrderHeader header,
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    java.lang.Double total, java.lang.Boolean requiresCFOApproval)</span>
    </span>{
    <span class="hljs-keyword">this</span>.description = description;
    <span class="hljs-keyword">this</span>.header = header;
    <span class="hljs-keyword">this</span>.lines = lines;
    <span class="hljs-keyword">this</span>.total = total;
    <span class="hljs-keyword">this</span>.requiresCFOApproval = requiresCFOApproval;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PurchaseOrder</span><span class="hljs-params">(
    java.util.List&lt;org.jbpm.examples.purchases.PurchaseOrderLine&gt; lines,
    org.jbpm.examples.purchases.PurchaseOrderHeader header)</span>
    </span>{
    <span class="hljs-keyword">this</span>.lines = lines;
    <span class="hljs-keyword">this</span>.header = header;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object o)</span>
    </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == o)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span> || getClass() != o.getClass())
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    org.jbpm.examples.purchases.PurchaseOrder that = (org.jbpm.examples.purchases.PurchaseOrder) o;
    <span class="hljs-keyword">if</span> (lines != <span class="hljs-keyword">null</span> ? !lines.equals(that.lines) : that.lines != <span class="hljs-keyword">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">if</span> (header != <span class="hljs-keyword">null</span> ? !header.equals(that.header) : that.header != <span class="hljs-keyword">null</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span>
    </span>{
    <span class="hljs-keyword">int</span> result = <span class="hljs-number">17</span>;
    result = <span class="hljs-number">31</span> * result + (lines != <span class="hljs-keyword">null</span> ? lines.hashCode() : <span class="hljs-number">0</span>);
    result = <span class="hljs-number">31</span> * result + (header != <span class="hljs-keyword">null</span> ? header.hashCode() : <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> result;
    }

    }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_sect_datamodeler_externalmodels"><a class="anchor" href="#_sect_datamodeler_externalmodels"></a><a class="link" href="#_sect_datamodeler_externalmodels">20.6.7.6. Using external models</a></h5>
<div class="paragraph">
<p>Using an external model means the ability to use a set for already defined POJOs in current project context.
In order to make those POJOs available a dependency to the given JAR should be added.
Once the dependency has been added the external POJOs can be referenced from current project data model.</p>
</div>
<div class="paragraph">
<p>There are two ways to add a dependency to an external JAR file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dependency to a JAR file already installed in current local M2 repository (typically associated the the user home).</p>
</li>
<li>
<p>Dependency to a JAR file installed in current KIE Workbench/Drools Workbench "Guvnor M2 repository". (internal to the application)</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_dependency_to_a_jar_file_in_local_m2_repository"><a class="anchor" href="#_dependency_to_a_jar_file_in_local_m2_repository"></a><a class="link" href="#_dependency_to_a_jar_file_in_local_m2_repository">Dependency to a JAR file in local M2 repository</a></h6>
<div class="paragraph">
<p>To add a dependency to a JAR file in local M2 repository follow this steps.</p>
</div>
<div class="sect6">
<h7 id="_open_the_project_editor_for_current_project_and_select_the_dependencies_view"><a class="anchor" href="#_open_the_project_editor_for_current_project_and_select_the_dependencies_view"></a><a class="link" href="#_open_the_project_editor_for_current_project_and_select_the_dependencies_view">Open the Project Editor for current project and select the Dependencies view.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-1.png" alt="add dependency 1">
</div>
<div class="title">Figure 266. Project editor.</div>
</div>
</div>
<div class="sect6">
<h7 id="_click_on_the_add_button_to_add_a_new_dependency_line"><a class="anchor" href="#_click_on_the_add_button_to_add_a_new_dependency_line"></a><a class="link" href="#_click_on_the_add_button_to_add_a_new_dependency_line">Click on the "Add" button to add a new dependency line.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-2.png" alt="add dependency 2">
</div>
<div class="title">Figure 267. New dependency line.</div>
</div>
</div>
<div class="sect6">
<h7 id="_complete_the_gav_for_the_jar_file_already_installed_in_local_m2_repository"><a class="anchor" href="#_complete_the_gav_for_the_jar_file_already_installed_in_local_m2_repository"></a><a class="link" href="#_complete_the_gav_for_the_jar_file_already_installed_in_local_m2_repository">Complete the GAV for the JAR file already installed in local M2 repository.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-3.png" alt="add dependency 3">
</div>
<div class="title">Figure 268. Dependency line edition.</div>
</div>
</div>
<div class="sect6">
<h7 id="_save_the_project_to_update_its_dependencies"><a class="anchor" href="#_save_the_project_to_update_its_dependencies"></a><a class="link" href="#_save_the_project_to_update_its_dependencies">Save the project to update its dependencies.</a></h7>
<div class="paragraph">
<p>When project is saved the POJOs defined in the external file will be available.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-4.png" alt="add dependency 4">
</div>
<div class="title">Figure 269. Save project.</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_dependency_to_a_jar_file_in_current_guvnor_m2_repository"><a class="anchor" href="#_dependency_to_a_jar_file_in_current_guvnor_m2_repository"></a><a class="link" href="#_dependency_to_a_jar_file_in_current_guvnor_m2_repository">Dependency to a JAR file in current "Guvnor M2 repository".</a></h6>
<div class="paragraph">
<p>To add a dependency to a JAR file in current "Guvnor M2 repository" follow this steps.</p>
</div>
<div class="sect6">
<h7 id="_open_the_maven_artifact_repository_editor"><a class="anchor" href="#_open_the_maven_artifact_repository_editor"></a><a class="link" href="#_open_the_maven_artifact_repository_editor">Open the Maven Artifact Repository editor.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-guvnor-m2-1.png" alt="add dependency guvnor m2 1">
</div>
<div class="title">Figure 270. Guvnor M2 Repository editor.</div>
</div>
</div>
<div class="sect6">
<h7 id="_browse_your_local_file_system_and_select_the_jar_file_to_be_uploaded_using_the_browse_button"><a class="anchor" href="#_browse_your_local_file_system_and_select_the_jar_file_to_be_uploaded_using_the_browse_button"></a><a class="link" href="#_browse_your_local_file_system_and_select_the_jar_file_to_be_uploaded_using_the_browse_button">Browse your local file system and select the JAR file to be uploaded using the Browse button.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-guvnor-m2-2-2.png" alt="add dependency guvnor m2 2 2">
</div>
<div class="title">Figure 271. File browser.</div>
</div>
</div>
<div class="sect6">
<h7 id="_upload_the_file_using_the_upload_button"><a class="anchor" href="#_upload_the_file_using_the_upload_button"></a><a class="link" href="#_upload_the_file_using_the_upload_button">Upload the file using the Upload button.</a></h7>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-guvnor-m2-3.png" alt="add dependency guvnor m2 3">
</div>
<div class="title">Figure 272. File upload success.</div>
</div>
</div>
<div class="sect6">
<h7 id="_guvnor_m2_repository_files"><a class="anchor" href="#_guvnor_m2_repository_files"></a><a class="link" href="#_guvnor_m2_repository_files">Guvnor M2 repository files.</a></h7>
<div class="paragraph">
<p>Once the file has been loaded it will be displayed in the repository files list.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-guvnor-m2-4.png" alt="add dependency guvnor m2 4">
</div>
<div class="title">Figure 273. Files list.</div>
</div>
</div>
<div class="sect6">
<h7 id="_provide_a_gav_for_the_uploaded_file_optional"><a class="anchor" href="#_provide_a_gav_for_the_uploaded_file_optional"></a><a class="link" href="#_provide_a_gav_for_the_uploaded_file_optional">Provide a GAV for the uploaded file (optional).</a></h7>
<div class="paragraph">
<p>If the uploaded file is not a valid Maven JAR (don’t have a pom.xml file) the system will prompt the user in order to provide a GAV for the file to be installed.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-guvnor-m2-not-gav-1.png" alt="add dependency guvnor m2 not gav 1">
</div>
<div class="title">Figure 274. Not valid POM.</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-guvnor-m2-not-gav-2.png" alt="add dependency guvnor m2 not gav 2">
</div>
<div class="title">Figure 275. Enter GAV manually.</div>
</div>
</div>
<div class="sect6">
<h7 id="_add_dependency_from_repository"><a class="anchor" href="#_add_dependency_from_repository"></a><a class="link" href="#_add_dependency_from_repository">Add dependency from repository.</a></h7>
<div class="paragraph">
<p>Open the project editor (see bellow) and click on the "Add from repository" button to open the JAR selector to see all the installed JAR files in current "Guvnor M2 repository". When the desired file is selected the project should be saved in order to make the new dependency available.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-guvnor-m2-5.png" alt="add dependency guvnor m2 5">
</div>
<div class="title">Figure 276. Select JAR from "Maven Artifact Repository".</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_using_the_external_objects"><a class="anchor" href="#_using_the_external_objects"></a><a class="link" href="#_using_the_external_objects">Using the external objects</a></h6>
<div class="paragraph">
<p>When a dependency to an external JAR has been set, the external POJOs can be used in the context of current project data model in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>External POJOs can be extended by current model data objects.</p>
</li>
<li>
<p>External POJOs can be used as field types for current model data objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following screenshot shows how external objects are prefixed with the string " -ext- " in order to be quickly identified.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/add-dependency-select-external-pojo.png" alt="add dependency select external pojo">
</div>
<div class="title">Figure 277. Identifying external objects.</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_roundtrip_and_concurrency"><a class="anchor" href="#_roundtrip_and_concurrency"></a><a class="link" href="#_roundtrip_and_concurrency">20.6.7.7. Roundtrip and concurrency</a></h5>
<div class="paragraph">
<p>Current version implements roundtrip and code preservation between Data modeller and Java source code.
No matter where the Java code was generated (e.g.
Eclipse, Data modeller), the data modeller will only create/delete/update the necessary code elements to maintain the model updated, i.e, fields, getter/setters, constructors, equals method and hashCode method.
Also whatever Type or Field annotation not managed by the Data Modeler will be preserved when the Java sources are updated by the Data modeller.</p>
</div>
<div class="paragraph">
<p>Aside from code preservation, like in the other workbench editors, concurrent modification scenarios are still possible.
Common scenarios are when two different users are updating the model for the same project, e.g.
using the data modeller or executing a 'git push command' that modifies project sources.</p>
</div>
<div class="paragraph">
<p>From an application context’s perspective, we can basically identify two different main scenarios:</p>
</div>
<div class="sect5">
<h6 id="_no_changes_have_been_undertaken_through_the_application"><a class="anchor" href="#_no_changes_have_been_undertaken_through_the_application"></a><a class="link" href="#_no_changes_have_been_undertaken_through_the_application">No changes have been undertaken through the application</a></h6>
<div class="paragraph">
<p>In this scenario the application user has basically just been navigating through the data model, without making any changes to it.
Meanwhile, another user modifies the data model externally.</p>
</div>
<div class="paragraph">
<p>In this case, no immediate warning is issued to the application user.
However, as soon as the user tries to make any kind of change, such as add or remove data objects or properties, or change any of the existing ones, the following pop-up will be shown:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/extchanges_reopen_ignore.jpg" alt="extchanges reopen ignore">
</div>
<div class="title">Figure 278. External changes warning</div>
</div>
<div class="paragraph">
<p>The user can choose to either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Re-open the data model, thus loading any external changes, and then perform the modification he was about to undertake, or</p>
</li>
<li>
<p>Ignore any external changes, and go ahead with the modification to the model. In this case, when trying to persist these changes, another pop-up warning will be shown:</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/extchanges_forcesave_reopen.jpg" alt="extchanges forcesave reopen">
</div>
<div class="title">Figure 279. Force save / re-open</div>
</div>
<div class="paragraph">
<p>The "Force Save" option will effectively overwrite any external changes, while "Re-open" will discard any local changes and reload the model.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>"Force Save" overwrites any external changes!</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_changes_have_been_undertaken_through_the_application"><a class="anchor" href="#_changes_have_been_undertaken_through_the_application"></a><a class="link" href="#_changes_have_been_undertaken_through_the_application">Changes have been undertaken through the application</a></h6>
<div class="paragraph">
<p>The application user has made changes to the data model.
Meanwhile, another user simultaneously modifies the data model from outside the application context.</p>
</div>
<div class="paragraph">
<p>In this alternative scenario, immediately after the external user commits his changes to the asset repository (or e.g.
saves the model with the data modeller in a different session), a warning is issued to the application user:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/extchanges_reopen_ignore.jpg" alt="extchanges reopen ignore">
</div>
<div class="title">Figure 280. External changes warning</div>
</div>
<div class="paragraph">
<p>As with the previous scenario, the user can choose to either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Re-open the data model, thus losing any modifications that where made through the application, or</p>
</li>
<li>
<p>Ignore any external changes, and continue working on the model.</p>
<div class="paragraph">
<p>One of the following possibilities can now occur:
** The user tries to persist the changes he made to the model by clicking the "Save" button in the data modeller top level menu. This leads to the following warning message:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/extchanges_forcesave_reopen.jpg" alt="extchanges forcesave reopen">
</div>
<div class="title">Figure 281. Force save / re-open</div>
</div>
<div class="paragraph">
<p>The "Force Save" option will effectively overwrite any external changes, while "Re-open" will discard any local changes and reload the model.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.datasets"><a class="anchor" href="#_wb.datasets"></a><a class="link" href="#_wb.datasets">20.6.8. Data Sets</a></h4>
<div class="paragraph">
<p>A <strong>data set</strong> is basically a set of columns populated with some rows, a matrix of data composed of timestamps, texts and numbers.
A data set can be stored in different systems: a database, an excel file, in memory or in a lot of other different systems.
On the other hand, a <strong>data set definition</strong> tells the workbench modules how such data can be accessed, read and parsed.</p>
</div>
<div class="paragraph">
<p>Notice, it’s very important to make crystal clear the difference between a data set and its definition since the workbench does not take care of storing any data, it just provides an standard way to define access to those data sets regardless where the data is stored.</p>
</div>
<div class="paragraph">
<p>Let’s take for instance the data stored in a remote database.
A valid data set could be, for example, an entire database table or the result of an SQL query.
In both cases, the database will return a bunch of columns and rows.
Now, imagine we want to get access to such data to feed some charts in a new workbench page.
First thing is to create and register a data set definition in order to indicate the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>where the data set is stored,</p>
</li>
<li>
<p>how can be accessed, read and parsed and</p>
</li>
<li>
<p>what columns contains and of which type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This chapter introduces the available workbench tools for registering and handling data set definitions and how this definitions can be consumed in other workbench modules like, for instance, the Page Editor.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For simplicity sake we will be using the term <em>data set</em> to refer to the actual data set definitions as <em>Data set</em> and <em>Data set definition</em> can be considered synonyms under the data set authoring context.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_wb.datasetauthoringperspective"><a class="anchor" href="#_wb.datasetauthoringperspective"></a><a class="link" href="#_wb.datasetauthoringperspective">20.6.8.1. Data Set Authoring Page</a></h5>
<div class="paragraph">
<p>Everything related to the authoring of data sets can be found under the <em>Data Set Authoring</em> page which is accessible from the following top level menu entry: <em>Extensions&gt;Data Sets</em>, as shown in the following screenshot.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetAuthoringPerspective(1).png" alt="DataSetAuthoringPerspective">
</div>
<div class="title">Figure 282. Data Set Authoring Page</div>
</div>
<div class="paragraph">
<p>The center panel, shows a welcome screen, whilst the left panel contains the <em>Data Set Explorer</em> listing all the data sets available</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This page is only intended to Administrator users, since defining data sets can be considered a low level task.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetexplorer"><a class="anchor" href="#_wb.datasetexplorer"></a><a class="link" href="#_wb.datasetexplorer">20.6.8.2. Data Set Explorer</a></h5>
<div class="paragraph">
<p>The <em>Data Set Explorer</em> list the data sets present in the system.
Every time the user clicks on the data set it shows a brief summary alongside the following information:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetExplorer.png" alt="DataSetExplorer">
</div>
<div class="title">Figure 283. Data Set Explorer</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) A button for creating a new Data set</p>
</li>
<li>
<p>(2) The list of currently available Data sets</p>
</li>
<li>
<p>(3) An icon that represents the Data set’s provider type (Bean, SQL, CSV, etc)</p>
</li>
<li>
<p>(4) Details of current cache and refresh policy status</p>
</li>
<li>
<p>(5) Details of current size on backend (unit as rows) and current size on client side (unit in bytes)</p>
</li>
<li>
<p>(6) The button for editing the Data set. Once clicked the Data set editor screen is opened on the center panel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next sections explains how to create, edit and fine tune data set definitions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetcreation"><a class="anchor" href="#_wb.datasetcreation"></a><a class="link" href="#_wb.datasetcreation">20.6.8.3. Data Set Creation</a></h5>
<div class="paragraph">
<p>Clicking on the <em>New Data Set</em> button opens a new screen from which the user is able to create a new data set definition in three steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Provider type selection</em></p>
<div class="paragraph">
<p>Specify the kind of the remote storage system (BEAN, SQL, CSV, ElasticSearch)</p>
</div>
</li>
<li>
<p><em>Provider configuration</em></p>
<div class="paragraph">
<p>Specify the attributes for being able to look up data from the remote system.
The configuration varies depending on the data provider type selected.</p>
</div>
</li>
<li>
<p><em>Data set columns &amp; filter</em></p>
<div class="paragraph">
<p>Live data preview, column types and initial filter configuration.</p>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_wb.datasetcreationtypeselection"><a class="anchor" href="#_wb.datasetcreationtypeselection"></a><a class="link" href="#_wb.datasetcreationtypeselection">Step 1: Provider type selection</a></h6>
<div class="paragraph">
<p>Allows the user’s specify the type of data provider of the data set being created.</p>
</div>
<div class="paragraph">
<p>This screen lists all the current available data provider types and helper popovers with descriptions.
Each data provider is represented with a descriptive image:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetDefTypeSelection.png" alt="DataSetDefTypeSelection">
</div>
<div class="title">Figure 284. Provider type selection</div>
</div>
<div class="paragraph">
<p>Four types are currently supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bean (Java class) - To generate a data set directly from Java</p>
</li>
<li>
<p>SQL - For getting data from any ANSI-SQL compliant database</p>
</li>
<li>
<p>CSV - To upload the contents of a remote or local CSV file</p>
</li>
<li>
<p>Elastic Search - To query and get documents stored on Elastic Search nodes as data sets</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once a type is selected, click on Next button to continue with the next workflow step.</p>
</div>
</div>
<div class="sect5">
<h6 id="_wb.datasetcreationconfiguration"><a class="anchor" href="#_wb.datasetcreationconfiguration"></a><a class="link" href="#_wb.datasetcreationconfiguration">Step 2: Configuration</a></h6>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetDefConfigScreen.png" alt="DataSetDefConfigScreen">
</div>
<div class="title">Figure 285. CSV Configuration</div>
</div>
<div class="paragraph">
<p>The provider type selected in the previous step will determine which configuration settings the system asks for.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetDefConfigTypes.png" alt="DataSetDefConfigTypes">
</div>
<div class="title">Figure 286. Configuration screen per data set type</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The UUID attribute is a read only field as it’s generated by the system.
It’s only intended for usage in API calls or specific operations.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_wb.datasetcreationpreview"><a class="anchor" href="#_wb.datasetcreationpreview"></a><a class="link" href="#_wb.datasetcreationpreview">Step 3: Data set columns and preview</a></h6>
<div class="paragraph">
<p>After clicking on the <em>Test</em> button (see previous step), the system executes a data set lookup test call in order to check if the remote system is up and the data is available.
If everything goes ok the user will see the following screen:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetDefLivePreview.png" alt="DataSetDefLivePreview">
</div>
<div class="title">Figure 287. Data set preview</div>
</div>
<div class="paragraph">
<p>This screen shows a live data preview along with the columns the user wants to be part of the resulting data set.
The user can also navigate through the data and apply some changes to the data set structure.
Once finished, we can click on the <em>Save</em> button in order to register the new data set definition.</p>
</div>
<div class="paragraph">
<p>We can also change the configuration settings at any time just by going back to the configuration tab.
We can repeat the <em>Configuration&gt;Test&gt;Preview</em> cycle as may times as needed until we consider it’s ready to be saved.</p>
</div>
<div class="paragraph">
<p><strong>Columns</strong></p>
</div>
<div class="paragraph">
<p>In the <em>Columns</em> tab area the user can select what columns are part of the resulting data set definition.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetDefColumns.png" alt="DataSetDefColumns">
</div>
<div class="title">Figure 288. Data set columns</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) To add or remove columns. Select only those columns you want to be part of the resulting data set</p>
</li>
<li>
<p>(2) Use the drop down image selector to change the column type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A data set may only contain columns of any of the following 4 types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Label - For text values supporting group operations (similar to the SQL "group by" operator) which means you can perform data lookup calls and get one row per distinct value.</p>
</li>
<li>
<p>Text - For text values NOT supporting group operations. Typically for modeling large text columns such as abstracts, descriptions and the like.</p>
</li>
<li>
<p>Number - For numeric values. It does support aggregation functions on data lookup calls: sum, min, max, average, count, disctinct.</p>
</li>
<li>
<p>Date - For date or timestamp values. It does support time based group operations by different time intervals: minute, hour, day, month, year, …​</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No matter which remote system you want to retrieve data from, the resulting data set will always return a set of columns of one of the four types above.
There exists, by default, a mapping between the remote system column types and the data set types.
The user is able to modify the type for some columns, depending on the data provider and the column type of the remote system.
The system supports the following changes to column types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Label &lt;&gt; Text - Useful when we want to enable/disable the categorization (grouping) for the target column. For instance, imagine a database table called "document" containing a large text column called "abstract". As we do not want the system to treat such column as a "label" we might change its column type to "text". Doing so, we are optimizing the way the system handles the data set and</p>
</li>
<li>
<p>Number &lt;&gt; Label - Useful when we want to treat numeric columns as labels. This can be used for instance to indicate that a given numeric column is not a numeric value that can be used in aggregation functions. Despite its values are stored as numbers we want to handle the column as a "label". One example of such columns are: an item’s code, an appraisal id., …​</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>BEAN data sets do not support changing column types as it’s up to the developer to decide which are the concrete types for each column.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><strong>Filter</strong></p>
</div>
<div class="paragraph">
<p>A data set definition may define a filter.
The goal of the filter is to leave out rows the user does not consider necessary.
The filter feature works on any data provider type and it lets the user to apply filter operations on any of the data set columns available.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetDefFilter.png" alt="DataSetDefFilter">
</div>
<div class="title">Figure 289. Data set filter</div>
</div>
<div class="paragraph">
<p>While adding or removing filter conditions and operations, the preview table on central area is updated with live data that reflects the current filter status.</p>
</div>
<div class="paragraph">
<p>There exists two strategies for filtering data sets and it’s also important to note that choosing between the two have important implications.
Imagine a dashboard with some charts feeding from a expense reports data set where such data set is built on top of an SQL table.
Imagine also we only want to retrieve the expense reports from the "London" office.
You may define a data set containing the filter "office=London" and then having several charts feeding from such data set.
This is the recommended approach.
Another option is to define a data set with no initial filter and then let the individual charts to specify their own filter.
It’s up to the user to decide on the best approach.</p>
</div>
<div class="paragraph">
<p>Depending on the case it might be better to define the filter at a data set level for reusing across other modules.
The decision may also have impact on the performance since a filtered cached data set will have far better performance than a lot of individual non-cached data set lookup requests.
(See the next section for more information about caching data sets).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Notice, for SQL data sets, the user can use both the filter feature introduced or, alternatively, just add custom filter criteria to the SQL sentence.
Although, the first approach is more appropriated for non technical users since they might not have the required SQL language skills.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetdefeditor"><a class="anchor" href="#_wb.datasetdefeditor"></a><a class="link" href="#_wb.datasetdefeditor">20.6.8.4. Data set editor</a></h5>
<div class="paragraph">
<p>To edit an existing data set definition go the data set explorer, expand the desired data set definition and click on the <em>Edit</em> button.
This will cause a new editor panel to be opened and placed on the center of the screen, as shown in the next screenshot:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetDefEditor.png" alt="DataSetDefEditor">
</div>
<div class="title">Figure 290. Data set definition editor</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetDefEditorSelector.png" alt="DataSetDefEditorSelector">
</div>
<div class="title">Figure 291. Editor selector</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Save - To validate the current changes and store the data set definition.</p>
</li>
<li>
<p>Delete - To remove permanently from storage the data set definition. Any client module referencing the data set may be affected.</p>
</li>
<li>
<p>Validate - To check that all the required parameters exists and are correct, as well as to validate the data set can be retrieved with no issues.</p>
</li>
<li>
<p>Copy - To create a brand new definition as a copy of the current one.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Data set definitions are stored in the underlying GIT repository as JSON files.
Any action performed is registered in the repository logs so it is possible to audit the change log later on.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetadvancedsettings"><a class="anchor" href="#_wb.datasetadvancedsettings"></a><a class="link" href="#_wb.datasetadvancedsettings">20.6.8.5. Advanced settings</a></h5>
<div class="paragraph">
<p>In the <em>Advanced settings</em> tab area the user can specify caching and refresh settings.
Those are very important for making the most of the system capabilities thus improving the performance and having better application responsive levels.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetDefAdvanced.png" alt="DataSetDefAdvanced">
</div>
<div class="title">Figure 292. Advanced settings</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) To enable or disable the client cache and specify the maximum size (bytes).</p>
</li>
<li>
<p>(2) To enable or disable the backend cache and specify the maximum cache size (number of rows).</p>
</li>
<li>
<p>(3) To enable or disable automatic refresh for the Data set and the refresh period.</p>
</li>
<li>
<p>(4) To enable or disable the refresh on stale data setting.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s dig into more details about the meaning of these settings.</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetcachesettings"><a class="anchor" href="#_wb.datasetcachesettings"></a><a class="link" href="#_wb.datasetcachesettings">20.6.8.6. Caching</a></h5>
<div class="paragraph">
<p>The system provides caching mechanisms out-of-the-box for holding data sets and performing data operations using in-memory strategies.
The use of these features brings a lot of advantages, like reducing the network traffic, remote system payload, processing times etc.
On the other hand, it’s up to the user to fine tune properly the caching settings to avoid hitting performance issues.</p>
</div>
<div class="paragraph">
<p>Two cache levels are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client level</p>
</li>
<li>
<p>Backend level</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following diagram shows how caching is involved in any data set operation:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetCacheArchitecture.png" alt="DataSetCacheArchitecture">
</div>
<div class="title">Figure 293. Data set caching</div>
</div>
<div class="paragraph">
<p>Any data look up call produces a resulting data set, so the use of the caching techniques determines where the data lookup calls are executed and where the resulting data set is located.</p>
</div>
<div class="paragraph">
<p><strong>Client cache</strong></p>
</div>
<div class="paragraph">
<p>If ON then the data set involved in a look up operation is pushed into the web browser so that all the components that feed from this data set <strong>do not need to perform any requests to the backend</strong> since data set operations are resolved at a client side:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The data set is stored in the web browser’s memory</p>
</li>
<li>
<p>The client components feed from the data set stored in the browser</p>
</li>
<li>
<p>Data set operations (grouping, aggregations, filters and sort) are processed within the web browser, by means of a Javascript data set operation engine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you know beforehand that your data set will remain small, you can enable the client cache.
It will reduce the number of backend requests, including the requests to the storage system.
On the other hand, if you consider that your data set will be quite big, disable the client cache so as to not hitting with browser issues such as slow performance or intermittent hangs.</p>
</div>
<div class="paragraph">
<p><strong>Backend cache</strong></p>
</div>
<div class="paragraph">
<p>Its goal is to provide a caching mechanism for data sets on backend side.</p>
</div>
<div class="paragraph">
<p>This feature allows to <strong>reduce the number of requests to the remote storage system</strong> , by holding the data set in memory and performing group, filter and sort operations using the in-memory engine.</p>
</div>
<div class="paragraph">
<p>It’s useful for data sets that do not change very often and their size can be considered acceptable to be held and processed in memory.
It can be also helpful on low latency connectivity issues with the remote storage.
On the other hand, if your data set is going to be updated frequently, it’s better to disable the backend cache and perform the requests to the remote storage on each look up request, so the storage system is in charge of resolving the data set lookup request.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>BEAN and CSV data providers relies by default on the backend cache, as in both cases the data set must be always loaded into memory in order to resolve any data lookup operation using the in-memory engine.
This is the reason why the backend settings are not visible in the Advanced settings tab.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasetrefreshsettings"><a class="anchor" href="#_wb.datasetrefreshsettings"></a><a class="link" href="#_wb.datasetrefreshsettings">20.6.8.7. Refresh</a></h5>
<div class="paragraph">
<p>The refresh feature allows for the invalidation of any cached data when certain conditions are meet.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSetDefRefreshSettings.png" alt="DataSetDefRefreshSettings">
</div>
<div class="title">Figure 294. Refresh settings</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) To enable or disable the refresh feature.</p>
</li>
<li>
<p>(2) To specify the refresh interval.</p>
</li>
<li>
<p>(3) To enable or disable data set invalidation when the data is outdated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The data set refresh policy is tightly related to data set caching, detailed in previous section.
This invalidation mechanism determines the cache life-cycle.</p>
</div>
<div class="paragraph">
<p>Depending on the nature of the data there exist three main use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Source data changes predictable</strong> - Imagine a database being updated every night. In that case, the suggested configuration is to use a "refresh interval = 1 day" and disable "refresh on stale data". That way, the system will always invalidate the cached data set every day. This is the right configuration when we know in advance that the data is going to change.</p>
</li>
<li>
<p><strong>Source data changes unpredictable</strong> - On the other hand, if we do not know whether the database is updated every day, the suggested configuration is to use a "refresh interval = 1 day" and enable "refresh on stale data". If so the system, before invalidating any data, will check for modifications. On data modifications, the system will invalidate the current stale data set so that the cache is populated with fresh data on the next data set lookup call.</p>
</li>
<li>
<p><strong>Real time scenarios</strong> - In real time scenarios caching makes no sense as data is going to be updated constantly. In this kind of scenarios the data sent to the client has to be constantly updated, so rather than enabling the refresh settings (remember this settings affect the caching, and caching is not enabled) it’s up to the clients consuming the data set to decide when to refresh. When the client is a dashboard then it’s just a matter of modifying the refresh settings in the Displayer Editor configuration screen and set a proper refresh period, "refresh interval = 1 second" for example.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.datasources"><a class="anchor" href="#_wb.datasources"></a><a class="link" href="#_wb.datasources">20.6.9. Data Source Management</a></h4>
<div class="paragraph">
<p>The data source management system provides the ability of defining data sources for accessing external databases.
This data sources can be later used by other workbench components like the Data Sets.</p>
</div>
<div class="sect4">
<h5 id="_wb.databasedrivers"><a class="anchor" href="#_wb.databasedrivers"></a><a class="link" href="#_wb.databasedrivers">20.6.9.1. Database Drivers</a></h5>
<div class="paragraph">
<p>To be able to communicate with the target database a data source will need a database driver to access it.
This is why the system additionally provides the ability of defining database drivers for the data sources operation.
A database driver is basically a JDBC compliant driver. We will see them in the next topics.</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourceauthoringperspective"><a class="anchor" href="#_wb.datasourceauthoringperspective"></a><a class="link" href="#_wb.datasourceauthoringperspective">20.6.9.2. Data Source Authoring Page</a></h5>
<div class="paragraph">
<p>Everything related to the authoring of data sources and drivers can be found under the <em>Data Source Authoring</em> page accessible from the following top level menu entry: <em>Extensions&gt;Data Sources</em>, as shown in the following screenshot.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSourceManagementPerspective.png" alt="DataSourceManagementPerspective">
</div>
<div class="title">Figure 295. Data Source Authoring Page</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This page is only intended for Administrator users, since defining data sources can be considered a low level task.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourceexplorer"><a class="anchor" href="#_wb.datasourceexplorer"></a><a class="link" href="#_wb.datasourceexplorer">20.6.9.3. Data Source Explorer</a></h5>
<div class="paragraph">
<p>The <em>Data Source Explorer</em> lists the data sources and drivers currently defined in the system, at the same time it provides the required actions for managing them.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSourceExplorer.png" alt="DataSourceExplorer">
</div>
<div class="title">Figure 296. Data Source Explorer</div>
</div>
<div class="ulist">
<ul>
<li>
<p>(1) Action link for creating a new data source</p>
</li>
<li>
<p>(2) List of currently available data sources</p>
</li>
<li>
<p>(3) Action link for creating a new driver</p>
</li>
<li>
<p>(4) List of currently available drivers</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourcecreation"><a class="anchor" href="#_wb.datasourcecreation"></a><a class="link" href="#_wb.datasourcecreation">20.6.9.4. New Data Source Wizard</a></h5>
<div class="paragraph">
<p>Clicking on the <em>New Data Source</em> action link opens the New Data Source Wizard:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewDataSourceWizard.png" alt="NewDataSourceWizard">
</div>
<div class="title">Figure 297. New Data Source Wizard</div>
</div>
<div class="paragraph">
<p>The following required parameters define a data source:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: A unique name for the data source definition.</p>
</li>
<li>
<p>Connection URL: A JDBC database connection url compliant with the selected driver type.
This is an example of a connection url for a PostgreSQL database: <em>jdbc:postgresql://localhost:5432/appformer</em>.</p>
</li>
<li>
<p>User: A user name in the target database.</p>
</li>
<li>
<p>Password: The corresponding user password.</p>
</li>
<li>
<p>Driver: Selects the JDBC driver to be used for connecting to the target database. <em>Note that the connection url format may vary depending on the driver, and different database vendors typically provides different drivers.</em></p>
</li>
<li>
<p>Test connection: Once clicked, the system will show a dialog similar to the one below showing the connection test status.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/TestConnectionSuccessful.png" alt="TestConnectionSuccessful">
</div>
<div class="title">Figure 298. Test Connection Status</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While not required, it’s recommended to use the test connection button to check the correctness of the data source parameters prior to finishing the data source creation.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourceeditor"><a class="anchor" href="#_wb.datasourceeditor"></a><a class="link" href="#_wb.datasourceeditor">20.6.9.5. Data Source Editor</a></h5>
<div class="paragraph">
<p>The <em>Data Source Editor</em> is opened by clicking on a data source item in the <em>Data Source Explorer</em>.</p>
</div>
<div class="paragraph">
<p>The following screenshot shows the <em>Data Source Editor</em> opened for the data source of the example above.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSourceEditor.png" alt="DataSourceEditor">
</div>
<div class="title">Figure 299. Data Source Editor</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Main Panel: The main panel basically lets you modify the data source configuration parameters.</p>
</li>
<li>
<p>Test connection: Tests the connection.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It’s a recommended practice to test the connection prior saving a modified data source.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.datasourcecontent"><a class="anchor" href="#_wb.datasourcecontent"></a><a class="link" href="#_wb.datasourcecontent">20.6.9.6. Data Source Content Browser</a></h5>
<div class="paragraph">
<p>The data source content browser is opened by clicking on the <em>Browse Content</em> button, and enables the navigation through the database structure pointed by the data source.
The navigation is performed in three levels, <em>Schemas level</em>, <em>Current schema level</em> and <em>Current table level</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Schemas level: lists all the database schemas accessible by current data source.
Which schemas are listed depends on the database access rights granted to the user which was used in the connection configuration.
Similarly for the following item.</p>
</li>
<li>
<p>Current schema level: shows all the database tables for the selected schema.</p>
</li>
<li>
<p>Current table level: shows the table content for the selected table.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following screenshots show the information shown at each level, for a user that realized the following navigation steps.
Selects the <em>"public"</em> schema → Selects the <em>"country"</em> table.</p>
</div>
<div class="paragraph">
<p><em>Schema Selection</em>:</p>
</div>
<div class="paragraph">
<p>Clicking on the <em>Open</em> button opens the <em>Current schema level</em> for the selected schema.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSourceContentBrowser1.png" alt="DataSourceContentBrowser1">
</div>
<div class="title">Figure 300. Database schemas</div>
</div>
<div class="paragraph">
<p><em>Table Selection</em>:</p>
</div>
<div class="paragraph">
<p>Clicking on the <em>Open</em> button opens the <em>Current table level</em> for the selected table.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSourceContentBrowser2.png" alt="DataSourceContentBrowser2">
</div>
<div class="title">Figure 301. Schema tables</div>
</div>
<div class="paragraph">
<p><em>Table information</em>:</p>
</div>
<div class="paragraph">
<p>The rows for the selected table are shown at this level.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DataSourceContentBrowser3.png" alt="DataSourceContentBrowser3">
</div>
<div class="title">Figure 302. Table rows</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.externaldatasources"><a class="anchor" href="#_wb.externaldatasources"></a><a class="link" href="#_wb.externaldatasources">20.6.9.7. External Data Sources</a></h5>
<div class="paragraph">
<p>External data sources are typically not defined in current workbench, instead they exist in current container and for some containers like Wildfly 10 or the JBoss EAP 7 servers they can still be listed in read only mode.
In this cases only the <em>Data Source Content Browser</em> is enabled.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ExternalDataSources.png" alt="ExternalDataSources">
</div>
<div class="title">Figure 303. External Data Sources navigation</div>
</div>
</div>
<div class="sect4">
<h5 id="_wb.drivercreation"><a class="anchor" href="#_wb.drivercreation"></a><a class="link" href="#_wb.drivercreation">20.6.9.8. New Driver Wizard</a></h5>
<div class="paragraph">
<p>Clicking on the <em>New Driver</em> action link opens the New Driver Wizard:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewDriverWizard.png" alt="NewDriverWizard">
</div>
<div class="title">Figure 304. New Driver Wizard</div>
</div>
<div class="paragraph">
<p>The following required parameters define a Driver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: A unique name for the driver definition.</p>
</li>
<li>
<p>Driver Class Name: The java fully qualified name for the class that implements the JDBC driver contract.</p>
</li>
<li>
<p>Group Id: The maven group id for the artifact that contains the JDBC driver implementation.</p>
</li>
<li>
<p>Artifact Id: The maven artifact id for the artifact that contains the JDBC driver implementation.</p>
</li>
<li>
<p>Version: The maven version for the artifact that contains the JDBC driver implementation.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some commercial database drivers (like Oracle) are not available in the maven central repository.
You can use those by first uploading them via <em>Artifact Repository</em> page and then continue with the driver configuration as for the drivers available in the maven central repository.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.drivereditor"><a class="anchor" href="#_wb.drivereditor"></a><a class="link" href="#_wb.drivereditor">20.6.9.9. Driver Editor</a></h5>
<div class="paragraph">
<p>The <em>Driver Editor</em> is opened by clicking on a driver item in the <em>Data Source Explorer</em>.</p>
</div>
<div class="paragraph">
<p>The following screenshot shows the <em>Driver Editor</em> opened for the driver of the example above.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DriverEditor.png" alt="DriverEditor">
</div>
<div class="title">Figure 305. Driver Editor</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Main Panel: The main panel basically lets you modify the driver configuration parameters.
See <em>New Driver Wizard</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_wb.bydefaultdrivers"><a class="anchor" href="#_wb.bydefaultdrivers"></a><a class="link" href="#_wb.bydefaultdrivers">20.6.9.10. By Default Drivers</a></h5>
<div class="paragraph">
<p>The system is shipped with a set of by default configured drivers for the most common used open source databases.
And they are aligned with the latest database versions supported by the Wildfly 10 and the JBoss EAP 7 servers.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DefaultDrivers.png" alt="DefaultDrivers">
</div>
<div class="title">Figure 306. By Default Drivers</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The by default drivers initialization can be disabled by setting the datasource.management.disableDefaultDrivers configuration property to true.
It can be set by configuring the proper value in the datasource-management.properties file, or by passing the system property  -Ddatasource.management.disableDefaultDrivers=true to the JVM.
For more information see Advanced Settings.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.advancedsettings"><a class="anchor" href="#_wb.advancedsettings"></a><a class="link" href="#_wb.advancedsettings">20.6.9.11. Advanced Settings</a></h5>
<div class="paragraph">
<p>The data source management system advanced settings can be found in the datasource-management.properties file in the WEB-INF/classes
directory of the given Workbench distribution file.</p>
</div>
<div class="paragraph">
<p>The data source management system has the ability of working with two different internal implementations for the data
sources and drivers. An implementation based on the Wildfly/EAP native data sources and drivers, and a container
independent implementation.
Wildfly/EAP Workbench distributions are configured by default for using the native Wildlfy/EAP
containers implementations, and Tomcat8 distributions are configured for using the container independent implementations.
This latter implementation can also be used for Wildfly/EAP containers.</p>
</div>
<div class="paragraph">
<p>The valid combinations are:</p>
</div>
<div class="paragraph">
<p>WildflyDataSourceProvider + WildflyDriverProvider<br>
or<br>
DBCPDataSourceProvider + DBCPDriverProvider</p>
</div>
<div class="paragraph">
<p>The datasource.management.wildfly.xxxxx  properties are only suited for the WildflyXXXProviders.</p>
</div>
</div>
<div class="sect4">
<h5 id="_wb.advancedsettings.wildlfy"><a class="anchor" href="#_wb.advancedsettings.wildlfy"></a><a class="link" href="#_wb.advancedsettings.wildlfy">20.6.9.12. Advanced Settings for Workbench Wildlfy/EAP distributions</a></h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">By default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.DataSourceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WildflyDataSourceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see Advanced Settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.DriverProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WildflyDriverProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see Advanced Settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.disableDefaultDrivers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to true for disabling the by default database drivers initialization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.wildfly.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">localhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name or ip address used for the Wildlfy server management interface binding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.wildfly.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9990</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port used for the Wildlfy server management interface binding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.wildfly.admin</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration user for connecting to the Wildfly server running current Workbench. In general it’s not necessary to set this value but might be needed in cases when the Wildlfy management interface is bound to an address different than localhost.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.wildfly.password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration user password for connecting to the Wildfly server running current Workbench. In general it’s not necessary to set this value but might be needed in cases when the Wildlfy management interface is bound to an address different than localhost.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.wildfly.realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ManagementRealm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Realm for the administration user authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.wildfly.profile</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The profile name used for starting the Wildfly domain, e.g. default, full, full-ha, etc. This value must only by set when the Workbench is running in clustering mode and the hosting Wildfly servers are configured by using domains. Do not set if the Wildlfy servers are running as standalone servers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.wildfly.serverGroup</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The server group to which current Wildfly server instance belongs, e.g. primary-server-group, etc. This value must only by set when the Workbench is running in clustering mode and the hosting Wildfly servers are configured by using domains. Do not set if the Wildlfy servers are running as standalone servers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.DefChangeHandler</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This value must only by set when the Workbench is running in clustering mode. If the hosting Wildfly servers are configured by using domains the following value must be used <em>DomainModeChangeHandler</em> and the the following value <em>StandaloneModeChangeHandler</em> must be used in cases when the hosting Wildlfy servers are running as standalone servers.
Clustering installations that uses the DBCPXXXProviders must be configured for using the the <em>StandaloneModeChangeHandler</em>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The properties above can also be set by passing system properties to the JVM using the Java standard mechanism. e.g. -Ddatasource.management.wildfly.port=1234.
Values configured by using this mechanism will override the values configured in the datasource-management.properties file.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wb.advancedsettings.tomcat"><a class="anchor" href="#_wb.advancedsettings.tomcat"></a><a class="link" href="#_wb.advancedsettings.tomcat">20.6.9.13. Advanced Settings for Tomcat distributions</a></h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">By default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.DataSourceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DBCPDataSourceProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the only option available for Tomcat 8 distributions, see Advanced Settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.DriverProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DBCPDriverProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the only option available for Tomcat 8 distributions, see Advanced Settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.disableDefaultDrivers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to true for disabling the by default database drivers initialization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">datasource.management.DefChangeHandler</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This value must only by set when the Workbench is running in clustering mode. Tomcat distributions only support the
<em>StandaloneModeChangeHandler</em> value.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The properties above can also be set by passing system properties to the JVM using the Java standard mechanism. e.g. -Ddatasource.management.wildfly.port=1234.
Values configured by using this mechanism will override the values configured in the datasource-management.properties file.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.userandgroupmgmt"><a class="anchor" href="#_wb.userandgroupmgmt"></a><a class="link" href="#_wb.userandgroupmgmt">20.7. Security management</a></h3>
<div class="paragraph">
<p>This section describes how administrator users can manage the application’s users, groups and permissions using an intuitive and friendly user interface in order to
configure who can access the different resources and features available.</p>
</div>
<div class="sect3">
<h4 id="_basic_concepts"><a class="anchor" href="#_basic_concepts"></a><a class="link" href="#_basic_concepts">20.7.1. Basic concepts</a></h4>
<div class="paragraph">
<p>In order to understand the security management features provided, a few core concepts need to be introduced first.</p>
</div>
<div class="sect4">
<h5 id="_roles_vs_groups"><a class="anchor" href="#_roles_vs_groups"></a><a class="link" href="#_roles_vs_groups">20.7.1.1. Roles vs Groups</a></h5>
<div class="paragraph">
<p>Users can be assigned with more than one role and/or group. It is always mandatory to assign at least one role to the user, otherwise he/she won’t be able to login. Roles are defined at application server level and they are part of the webapp’s web.xml descriptor. On the other hand, groups are a more flexible concept, since they can be defined at runtime.</p>
</div>
</div>
<div class="sect4">
<h5 id="_permissions"><a class="anchor" href="#_permissions"></a><a class="link" href="#_permissions">20.7.1.2. Permissions</a></h5>
<div class="paragraph">
<p>A permission is basically something the user can do within the application. Usually, an action related to a specific resource. For instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View a page</p>
</li>
<li>
<p>Save a project</p>
</li>
<li>
<p>View a repository</p>
</li>
<li>
<p>Delete a dashboard</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A permission can be granted or denied and it can be global or resource specific. For instance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Global: “Create new pages”</p>
</li>
<li>
<p>Specific: “View the home page”</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As you can see, a permission is a <code>resource + action</code> pair. In the concrete case of a page we have: <em>read</em>, <em>update</em>, <em>delete</em> and <em>create</em> as the available actions. That means that there are four possible permissions that could be granted for pages.</p>
</div>
<div class="paragraph">
<p>Permissions do not necessarily need to be tied to a resource. Sometimes it is also neccessary to protect access to specific features, like for instance "<em>generate a sales report</em>". That means, permissions can be used not only to protect access to resources but also to custom features within the application.</p>
</div>
</div>
<div class="sect4">
<h5 id="_authorization_policy"><a class="anchor" href="#_authorization_policy"></a><a class="link" href="#_authorization_policy">20.7.1.3. Authorization policy</a></h5>
<div class="paragraph">
<p>The set of permissions assigned to every role and/or group is called the authorization (or security) policy. Every application contains a single security policy which is used every time the system checks a permission.</p>
</div>
<div class="paragraph">
<p>The authorization policy file is stored in a file called <em>WEB-INF/classes/security-policy.properties</em> under the application’s WAR structure.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no policy is defined then the authorization management features are disabled
and the application behaves as if all the resources &amp; features were granted by default.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Here is an example of a security policy file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-preprocessor"># Role <span class="hljs-string">"admin"</span></span>
role.admin.permission.perspective.read=<span class="hljs-literal">true</span>
role.admin.permission.perspective.read.Dashboard=<span class="hljs-literal">false</span>

<span class="hljs-preprocessor"># Role <span class="hljs-string">"user"</span></span>
role.user.permission.perspective.read=<span class="hljs-literal">false</span>
role.user.permission.perspective.read.Home=<span class="hljs-literal">true</span>
role.user.permission.perspective.read.Dashboard=<span class="hljs-literal">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Every entry defines a single permission which is assigned to a role/group. On application start up, the policy file is loaded and stored into memory.</p>
</div>
</div>
<div class="sect4">
<h5 id="_security_provider"><a class="anchor" href="#_security_provider"></a><a class="link" href="#_security_provider">20.7.1.4. Security provider</a></h5>
<div class="paragraph">
<p>A security environment is usually provided by the use of a <em>realm</em>.
Realms are used to restrict access to the different application’s resources.
So realms contains the information about the users, groups, roles, permissions and any other related information.</p>
</div>
<div class="paragraph">
<p>In most typical scenarios the application’s security is delegated to the container’s security mechanism, which consumes a given realm at same time.
It’s important to consider that there exist several realm implementations, for example Wildfly provides a realm based on the <em>application-users.properties</em>/<em>application-roles.properties</em> files, Tomcat provides a realm based on the <em>tomcat-users.xml</em> file, etc.
So there is no single security realm to rely on, it can be different in each installation.</p>
</div>
<div class="paragraph">
<p>Due to the potential different security environments that have to be supported, the security module provides a well defined API with some default built-in security providers.
A <strong>security provider</strong> is the formal name given to a concrete user and group management service implementation for a given realm.</p>
</div>
<div class="paragraph">
<p>The user &amp; group management features available will depend on the security provider configured.
If the built-in providers do not fit with the application’s security realm, it is easy to build and register your own provider.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installation_and_setup"><a class="anchor" href="#_installation_and_setup"></a><a class="link" href="#_installation_and_setup">20.7.2. Installation and setup</a></h4>
<div class="paragraph">
<p>At the time of this writing, the application provides two pre-installed security providers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Wildfly 10 / EAP 7 distribution</strong> - Both distributions use the <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-wildfly">Wildfly security provider</a> configured for the use of the default realm files <em>application-users.properties</em> and <em>application-roles.properties</em></p>
</li>
<li>
<p><strong>Tomcat distribution</strong> - It uses the <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-tomcat">Tomcat security provider</a> configured for the use of the default realm file <em>tomcat-users.xml</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider’s documentation</a> in order to apply the concrete settings for the target deployment environment.</p>
</div>
<div class="paragraph">
<p>On the other hand, when either using a custom security provider or using one of the availables, consider the following installation options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable the security management feature on an existing WAR distribution</p>
</li>
<li>
<p>Setup and installation in an existing or new project</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>NOTE</em>: If no security provider is installed, there will be no available user interface for managing the security realm.
Once a security provider is installed and setup, the user and group management features are automatically enabled in the security management UI (see the <a href="#_usage">Usage</a> section below).</p>
</div>
<div class="sect4">
<h5 id="_enabling_user_group_management"><a class="anchor" href="#_enabling_user_group_management"></a><a class="link" href="#_enabling_user_group_management">20.7.2.1. Enabling user &amp; group management</a></h5>
<div class="paragraph">
<p>Given an existing WAR distribution, follow these steps in order to install and enable the user &amp; group management features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure the following libraries are present on <em>WEB-INF/lib</em>:</p>
<div class="ulist">
<ul>
<li>
<p>WEB-INF/lib/uberfire-security-management-api-?.jar</p>
</li>
<li>
<p>WEB-INF/lib/uberfire-security-management-backend-?.jar</p>
</li>
</ul>
</div>
</li>
<li>
<p>Copy the the security provider library to <em>WEB-INF/lib</em>:</p>
<div class="ulist">
<ul>
<li>
<p>Eg: WEB-INF/lib/uberfire-security-management-wildfly-?.jar</p>
</li>
<li>
<p>If the provider requires additional libraries, copy them as well (read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider’s documentation</a> for more information).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Replace the whole content of the <em>WEB-INF/classes/security-management.properties</em> file, or if not present, create it. The settings present on this file depend on the concrete implementation used. Please read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider’s documentation</a> for more information.</p>
</li>
<li>
<p>If deploying on Wildfly or EAP, check if the <em>WEB-INF/jboss-deployment-structure.xml </em>requires any update (read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider’s documentation</a> for more information).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_disabling_user_group_management"><a class="anchor" href="#_disabling_user_group_management"></a><a class="link" href="#_disabling_user_group_management">20.7.2.2. Disabling user &amp; group management</a></h5>
<div class="paragraph">
<p>The user &amp; groups management features can be disabled, and thus no services or user interface will be available, by means of either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uninstalling the security provider from the application</p>
<div class="paragraph">
<p>When no concrete security provider is installed, the user and group management features will be disabled and no services or user interface will be displayed to the user. This is the case for instance, in
<em>Weblogic</em> and <em>Websphere</em> installations as there is no a security provider implementation available at the time of this writing.</p>
</div>
</li>
<li>
<p>Removing or commenting the security management configuration file</p>
<div class="paragraph">
<p>Removing or commenting all the lines in the configuration file located at<em> WEB-INF/classes/security-management.properties</em> is another way to disable the user and group management features.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_upgrading_an_existing_installation"><a class="anchor" href="#_upgrading_an_existing_installation"></a><a class="link" href="#_upgrading_an_existing_installation">20.7.2.3. Upgrading an existing installation</a></h5>
<div class="paragraph">
<p>In versions prior to 7, the only way to grant access to resources like Organizational Units, Repositories or Projects was to indicate which roles were able to access a given instance. Those roles were stored in GIT as part of the instance persistent status. The CLI was the tool used to add/remove roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>remove-role-repo</strong>: remove role(s) from repository</p>
</li>
<li>
<p><strong>add-role-org-unit</strong>: add role(s) to organizational unit</p>
</li>
<li>
<p><strong>remove-role-org-unit</strong>: remove role(s) from organizational unit</p>
</li>
<li>
<p><strong>add-role-project</strong>: add role(s) to project</p>
</li>
<li>
<p><strong>remove-role-project</strong>: remove role(s) from project</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As of version 7, the authorization policy is based on permissions. That means is no longer required to keep a list of roles per resource instance. What is required is to define proper permission entries into the active authorization policy using the security management UI (see the <a href="#_usage">Usage</a> section below).</p>
</div>
<div class="paragraph">
<p>The commands above are no longer required so they have been removed. Basically, what those commands did is to set what roles were able to read a specific item.</p>
</div>
<div class="paragraph">
<p>In order to guarantee backward compatibility with versions prior to 7, an automatic migration tool is bundled within the application, which converts the list of roles assigned to any organizational unit, repository or project into read permission entries of the security policy.</p>
</div>
<div class="paragraph">
<p>This tool is executed when the application start ups for the first time, during the security policy deployment. So existing customers, do not have to worry about it, as they will keep their security settings.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage_2"><a class="anchor" href="#_usage_2"></a><a class="link" href="#_usage_2">20.7.3. Usage</a></h4>
<div class="paragraph">
<p>The Security Management page is available under the <em>Home</em> section in the top menu bar.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementMenuEntry.png" alt="SecurityManagementMenuEntry">
</div>
<div class="title">Figure 307. Link to the Security Management page</div>
</div>
<div class="paragraph">
<p>The next screenshot shows how this new page looks:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementHome.png" alt="SecurityManagementHome">
</div>
<div class="title">Figure 308. Security Management Home</div>
</div>
<div class="paragraph">
<p>This page supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List all the roles, groups and users available</p>
</li>
<li>
<p>Create &amp; delete users and groups</p>
</li>
<li>
<p>Edit users, assign roles or groups, and change user properties</p>
</li>
<li>
<p>Edit both roles &amp; groups security settings, which include:</p>
<div class="ulist">
<ul>
<li>
<p>The home page a user will be directed to after login</p>
</li>
<li>
<p>The permissions granted or denied to the different workbench resources and features available</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of the above together provides a complete users and groups management subsystem as well as a permission configuration UI for protecting access to specific resources or features.</p>
</div>
<div class="paragraph">
<p>The next sections provide a deep insight into all these features.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The user and group management related features can be entirely disabled. See the previous section
 <a href="#_disabling_user_group_management">Disabling user &amp; group management</a>. If that’s the case then both the <em>Groups and _Users</em> tabs will remain hidden from the user.
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_user_management"><a class="anchor" href="#_user_management"></a><a class="link" href="#_user_management">20.7.3.1. User management</a></h5>
<div class="paragraph">
<p>By selecting the <em>Users</em> tab in the left sidebar, the application shows all the users present by default on the application’s security realm:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementUsersExplorer.png" alt="SecurityManagementUsersExplorer">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Searching for users</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to listing all the users, search is also allowed:</p>
</div>
<div class="paragraph">
<p>+
When specifying the search pattern in the search box the users listed will be reduced to only those that matches the search pattern.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementUsersSearch.png" alt="SecurityManagementUsersSearch">
</div>
</div>
<div class="paragraph">
<p>+
Search patterns depend on the concrete security provider being used by the application.
Please read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider’s documentation</a> for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Creating new users</strong></p>
<div class="paragraph">
<p>By clicking on the "<em>New user +</em>" anchor, a form is displayed on the screen’s right.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementNewUserForm.png" alt="SecurityManagementNewUserForm">
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is a wizard like interface where the application asks for the new user name, a password as well as what roles/groups to assign.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Editing a user</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After clicking on a user in the left sidebar, the user editor is opened on the screen’s right.</p>
</div>
<div class="paragraph">
<p>For instance, the details screen for the <em>admin</em> user when using the Wildfly security provider looks like the following screenshot:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementViewUser.png" alt="SecurityManagementViewUser">
</div>
</div>
<div class="paragraph">
<p>Same screen but when using the Keycloak security provider looks as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementViewUserKC.png" alt="SecurityManagementViewUserKC">
</div>
</div>
<div class="paragraph">
<p>Note that when using the Keycloak provider, a new user attributes section is displayed, but it’s not present when using the Wildfly provider.
This is due to the fact that the information and actions available always depend on each provider’s capabilities as explained in the
<a href="#_security_provider_capabilities">Security provider capabilities</a> section below.</p>
</div>
<div class="paragraph">
<p>Next is the type of information handled in the user’s details screen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user name</p>
</li>
<li>
<p>The user’s attributes</p>
</li>
<li>
<p>The assigned groups</p>
</li>
<li>
<p>The assigned roles</p>
</li>
<li>
<p>The permissions granted or denied</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to <strong>update or delete an existing user</strong>, click on the <em>Edit</em> button present near to the username in the user editor screen:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementEditUser.png" alt="SecurityManagementEditUser">
</div>
</div>
<div class="paragraph">
<p>Once the editor is in edit mode, different operations can be done (provided the security provider supports them):</p>
</div>
<div class="paragraph">
<p>For instance, to modify the set of roles and groups assigned to the user or to change the user’s password as well.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Permissions summary</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>Permissions</em> tab shows a summary of all the permissions assigned to this particular user. This is a very helpful view as it allows
administrator users to verify if a target user has the right permission levels according to the security settings of its roles and
groups.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementUserPermissions.png" alt="SecurityManagementUserPermissions">
</div>
</div>
<div class="paragraph">
<p>Further details about how to assign permissions to roles and groups are in the <a href="#_security_settings_editor">Security Settings Editor</a> section below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Updating the user’s attributes</strong></p>
<div class="paragraph">
<p>User attributes can added or deleted using the actions available in the attributes table:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementUserAttributes.png" alt="SecurityManagementUserAttributes">
</div>
</div>
</li>
<li>
<p><strong>Updating assigned groups</strong></p>
<div class="paragraph">
<p>From the <em>Groups</em> tab, a group selection popup is presented when clicking on the <em>Add to groups</em> button:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementGroupsSelection.png" alt="SecurityManagementGroupsSelection">
</div>
</div>
<div class="paragraph">
<p>This popup screen allows the user to search and select or deselect the groups assigned to the user.</p>
</div>
</li>
<li>
<p><strong>Updating assigned roles</strong></p>
<div class="paragraph">
<p>From the <em>Roles</em> tab, a role selection popup is presented when clicking on <em>Add to roles</em> button:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementRolesSelection.png" alt="SecurityManagementRolesSelection">
</div>
</div>
<div class="paragraph">
<p>This popup screen allows the user to search and select or deselect the roles assigned to the user.</p>
</div>
</li>
<li>
<p><strong>Changing the user’s password</strong></p>
<div class="paragraph">
<p>A change password popup screen is presented when clicking on the <em>Change password</em> button:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementChangePassword.png" alt="SecurityManagementChangePassword">
</div>
</div>
</li>
<li>
<p><strong>Deleting users</strong></p>
<div class="paragraph">
<p>The user currently being edited can be deleted from the realm by clicking on the <em>Delete</em> button.</p>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementDeleteUser.png" alt="SecurityManagementDeleteUser">
</div>
</div>
<div class="sect5">
<h6 id="_security_provider_capabilities"><a class="anchor" href="#_security_provider_capabilities"></a><a class="link" href="#_security_provider_capabilities">Security provider capabilities</a></h6>
<div class="paragraph">
<p>Each security realm can provide support for different operations.
For example consider the use of a Wildfly’s realm based on properties files. The contents for the <em>applications-users.properties</em> is like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ini"><span class="hljs-setting">admin=<span class="hljs-value"><span class="hljs-number">207</span>b6e0cc556d7084b5e2db7d822555c</span></span>
<span class="hljs-setting">salaboy=<span class="hljs-value">d4af256e7007fea2e581d539e05edd1b</span></span>
<span class="hljs-setting">maciej=<span class="hljs-value"><span class="hljs-number">3</span>c8609f5e0c908a8c361ca633ed23844</span></span>
<span class="hljs-setting">kris=<span class="hljs-value"><span class="hljs-number">0</span>bfd0f47d4817f2557c91cbab38bb92d</span></span>
<span class="hljs-setting">katy=<span class="hljs-value">fd37b5d0b82ce027bfad677a54fbccee</span></span>
<span class="hljs-setting">john=<span class="hljs-value">afda4373c6021f3f5841cd6c0a027244</span></span>
<span class="hljs-setting">jack=<span class="hljs-value"><span class="hljs-number">984</span>ba30e11dda7b9ed86ba7b73d01481</span></span>
<span class="hljs-setting">director=<span class="hljs-value"><span class="hljs-number">6</span>b7f87a92b62bedd0a5a94c98bd83e21</span></span>
<span class="hljs-setting">user=<span class="hljs-value">c5568adea472163dfc00c19c6348a665</span></span>
<span class="hljs-setting">guest=<span class="hljs-value">b5d048a237bfd2874b6928e1f37ee15e</span></span>
<span class="hljs-setting">kiewb=<span class="hljs-value"><span class="hljs-number">78541</span>b7b451d8012223f29ba5141bcc2</span></span>
<span class="hljs-setting">kieserver=<span class="hljs-value"><span class="hljs-number">16</span>c6511893651c9b4b57e0c027a96075</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that it’s based on key-value pairs where the key is the <em>username</em>, and the value is the hashed value for the user’s <em>password</em>.
So a user is just represented by a key and its username, it does not have a name nor an address or any other meta information.</p>
</div>
<div class="paragraph">
<p>On the other hand, consider the use of a realm provided by a Keycloak server.
The user information is composed by more meta-data, such as the surname, address, etc, as in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementViewUserKC.png" alt="SecurityManagementViewUserKC">
</div>
</div>
<div class="paragraph">
<p>So the different services and client side components from the User and Group Management API are based on <em>capabilities</em>. <strong>Capabilities</strong> are used to expose or restrict the available functionality provided by the different services and client side components.
Examples of capabilities are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a user</p>
</li>
<li>
<p>Update a user</p>
</li>
<li>
<p>Delete a user</p>
</li>
<li>
<p>Update user’s attributes</p>
</li>
<li>
<p>Create a group</p>
</li>
<li>
<p>Update a group</p>
</li>
<li>
<p>Assign groups to a user</p>
</li>
<li>
<p>Assign roles to a user</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each security provider must specify a set of capabilities supported. From the previous examples, it is noted that the Wildfly security provider does not support the attributes management capability - the user is only composed by the user name. On the other hand the Keycloak provider does support this capability.</p>
</div>
<div class="paragraph">
<p>The different views and user interface components rely on the capabilities supported by each provider, so if a capability is not supported by the provider in use, the UI does not
provide the views for the management of that capability. As an example, consider that a concrete provider does not support deleting users - the delete user button on the user interface
will be not available.</p>
</div>
<div class="paragraph">
<p>Please take a look at the concrete service provider documentation to check all the supported capabilities for each one, the default ones can be found <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_group_management"><a class="anchor" href="#_group_management"></a><a class="link" href="#_group_management">20.7.3.2. Group management</a></h5>
<div class="paragraph">
<p>By selecting the <em>Groups</em> tab in the left sidebar, the application shows all the groups present by default on the application’s security realm:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementGroupsExplorer.png" alt="SecurityManagementGroupsExplorer">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Searching for groups</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to listing all the groups, search is also allowed:</p>
</div>
<div class="paragraph">
<p>+
When specifying the search pattern in the search box the groups listed will be reduced to only those that matches the search pattern.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementGroupsSearch.png" alt="SecurityManagementGroupsSearch">
</div>
</div>
<div class="paragraph">
<p>+
Search patterns depend on the concrete security provider being used by the application.
Please read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider’s documentation</a> for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Creating new groups</strong></p>
<div class="paragraph">
<p>By clicking on the "<em>New group +</em>" anchor, a new screen will be presented on the center panel to perform a new group creation.</p>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementNewGroup.png" alt="SecurityManagementNewGroup">
</div>
</div>
<div class="paragraph">
<p>After typing a name anc clicking <em>Save</em>, the next step is to assign users to it:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementNewGroupUserSelection.png" alt="SecurityManagementNewGroupUserSelection">
</div>
</div>
<div class="paragraph">
<p>+
Clicking on the "<em>Add selected users</em>" button finishes the group creation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Modifying a group</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After clicking on a group in the left sidebar, the security settings editor for the selected group instance is opened on the screen’s right. Further details at the
<a href="#_security_settings_editor">Security Settings Editor</a> section.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Deleting groups</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To delete an existing group just click on the <em>Delete</em> button.</p>
</div>
</div>
<div class="sect4">
<h5 id="_role_management"><a class="anchor" href="#_role_management"></a><a class="link" href="#_role_management">20.7.3.3. Role management</a></h5>
<div class="paragraph">
<p>By selecting the <em>Roles</em> tab in the left sidebar, the application shows all the application roles:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementRolesExplorer.png" alt="SecurityManagementRolesExplorer">
</div>
</div>
<div class="paragraph">
<p>Unlike users and groups, roles can not be created nor deleted as they come from the application’s web.xml descriptor. After clicking on a role in the left sidebar, the role editor is opened on the screen’s
right, which is exactly the same security settings editor used for groups. Further details at the <a href="#_security_settings_editor">Security Settings Editor</a> section.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementEditRole.png" alt="SecurityManagementEditRole">
</div>
</div>
<div class="paragraph">
<p>That means both role and group based permissions can be defined. The main diference between roles and group are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roles are an application defined resource. They are defined as &lt;security-role&gt; entries in the application’s web.xml descriptor.</p>
</li>
<li>
<p>Groups are dynamic and can be defined at runtime. The installed security provider determines where groups instances are stored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They can be used together without any trouble. Groups are recommended though as they are a more flexible than roles.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Searching for roles</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to listing all the roles, search is also allowed:</p>
</div>
<div class="paragraph">
<p>+
When specifying the search pattern in the search box the roles listed will be reduced to only those that matches the search pattern.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementRolesSearch.png" alt="SecurityManagementRolesSearch">
</div>
</div>
<div class="paragraph">
<p>+
Search patterns depend on the concrete security provider being used by the application.
Please read each <a href="https://github.com/kiegroup/appformer/tree/master/uberfire-extensions/uberfire-security/uberfire-security-management">provider’s documentation</a> for more information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_settings_editor"><a class="anchor" href="#_security_settings_editor"></a><a class="link" href="#_security_settings_editor">20.7.4. Security Settings Editor</a></h4>
<div class="paragraph">
<p>This editor is used to set several security settings for both roles and groups.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementSecuritySettsEditor.png" alt="SecurityManagementSecuritySettsEditor">
</div>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="sect4">
<h5 id="_home_page"><a class="anchor" href="#_home_page"></a><a class="link" href="#_home_page">20.7.4.1. Home page</a></h5>
<div class="paragraph">
<p>This is the page where the user is directed after login. This makes it possible to have different home pages for different users, since users can be assigned to
different roles or groups.</p>
</div>
</div>
<div class="sect4">
<h5 id="_priority"><a class="anchor" href="#_priority"></a><a class="link" href="#_priority">20.7.4.2. Priority</a></h5>
<div class="paragraph">
<p>It is used to determine what settings (home page, permissions, …​) have precedence for those users with more that one role or group assigned.</p>
</div>
<div class="paragraph">
<p>Without this setting, it won’t be possible to determine what role/group should take precedence. For instance, an administrative role has higher priority than a
non-administrative one. For users with both administrative and non-administrative roles granted, administrative privileges will always win, provided the administrative role’s
priority is greater than the other.</p>
</div>
</div>
<div class="sect4">
<h5 id="_permissions_2"><a class="anchor" href="#_permissions_2"></a><a class="link" href="#_permissions_2">20.7.4.3. Permissions</a></h5>
<div class="paragraph">
<p>Currently, the workbench support the following permission categories.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Workbench: General workbench permissions, not tied to any specific resource type.</p>
</li>
<li>
<p>Pages: If access to a page is denied then it will not be shown in any of application menus. Update, Delete and Create permissions change the behaviour of the page management plugin editor.</p>
</li>
<li>
<p>Organizational Units: Sets who can Create, Update or Delete organizational units from the Organizational Unit section at the Administration page. Sets also what organizational units are visible in the Project Explorer at the Project Authoring page.</p>
</li>
<li>
<p>Repositories: Sets who can Create, Update or Delete repositories from the Repositories section at the Administration page. Sets also what repositories are visible in the Project Explorer at the Project Authoring page.</p>
</li>
<li>
<p>Projects: In the Project Authoring page, sets who can Create, Update, Delete or Build projects from the Project Editor screen as well as what projects are visible in the Project Explorer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For pages, organizational units, repositories and projects it is possible to define global permissions and add single instance exceptions afterwards. For instance,
<em>Read</em> access can be granted to all the pages and deny access just to an individual page. This is called the <em>grant all deny a few</em> strategy.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementPerspectiveDenied.png" alt="SecurityManagementPerspectiveDenied">
</div>
</div>
<div class="paragraph">
<p>The opposite, <em>deny all grant a few</em> strategy is also supported:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/SecurityManagementPerspectiveGranted.png" alt="SecurityManagementPerspectiveGranted">
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the example above, the <em>Update</em> and <em>Delete</em> permissions are disabled as it does not makes sense to define such permissions if the user is not even able to read
pages.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_policy_storage"><a class="anchor" href="#_security_policy_storage"></a><a class="link" href="#_security_policy_storage">20.7.5. Security Policy Storage</a></h4>
<div class="paragraph">
<p>The security policy is stored under the workbench’s VFS. Most concrete, in a GIT repo called “security”.
The ACL table is stored in a file called “security-policy.properties” under the “authz” directory. Next is an example of the entries this file contains:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">role.admin.home=HomePage
role.admin.priority=<span class="hljs-number">0</span>
role.admin.permission.perspective.read=<span class="hljs-literal">true</span>
role.admin.permission.perspective.create=<span class="hljs-literal">true</span>
role.admin.permission.perspective.<span class="hljs-keyword">delete</span>=<span class="hljs-literal">true</span>
role.admin.permission.perspective.update=<span class="hljs-literal">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Every time the ACL is modified from the security settings UI the changes are stored into the GIT repo.</p>
</div>
<div class="paragraph">
<p>Initially, when the application is deployed for the first time there is no security policy stored in GIT. However, the application might need to set-up a default policy with the different access profiles for each of the application roles.</p>
</div>
<div class="paragraph">
<p>In order to support default policies the system allows for declaring a security policy as part of the webapp’s content. This can be done just by placing a security-policy.properties file under the webapp’s resource classpath (the WEB-INF/classes directory
inside the WAR archive is a valid one). On app start-up the following steps are executed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check if an active policy is already stored in GIT</p>
</li>
<li>
<p>If not, then check if a policy has been defined under the webapp’s classpath</p>
</li>
<li>
<p>If found, such policy is stored under GIT</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above is an auto-deploy mechanism which is used in the workbench to set-up its default security policy.</p>
</div>
<div class="paragraph">
<p>One slight variation of the deployment process is the ability to split the “security-policy.properties” file into small pieces so that it is possible, for example, to define one file
per role. The split files must start by the “security-module-” prefix, for instance: “security-module-admin.properties”. The deployment mechanism will read and deploy both the
"security-policy.properties" and all the optional “security-module-?.properties” found on the classpath.</p>
</div>
<div class="paragraph">
<p>Notice, despite using the split approach, the “security-policy.properties” must always be present as it is used as a marker file by the security subsystem in order to locate the other policy files.
This split mechanism allows for a better organization of the whole security policy.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wb.embedding"><a class="anchor" href="#_wb.embedding"></a><a class="link" href="#_wb.embedding">20.8. Embedding Workbench In Your Application</a></h3>
<div class="paragraph">
<p>As we already know, Workbench provides a set of editors to author assets in different formats.
According to asset’s format a specialized editor is used.</p>
</div>
<div class="paragraph">
<p>One additional feature provided by Workbench is the ability to embed it in your own (Web) Applications thru it’s <strong>standalone</strong> mode.
So, if you want to edit rules, processes, decision tables, etc…​ in your own applications without switch to Workbench, you can.</p>
</div>
<div class="paragraph">
<p>In order to embed Workbench in your application all you’ll need is the Workbench application deployed and running in a web/application server and, from within your own web applications, an iframe with proper HTTP query parameters as described in the following table.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 42. HTTP query parameters for standalone mode</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter Name</th>
<th class="tableblock halign-left valign-top">Explanation</th>
<th class="tableblock halign-left valign-top">Allow multiple values</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">standalone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With just the presence of this parameter workbench will switch to standalone mode.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the asset to be edited. Note that asset should already exists.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">git://master@uf-playground/todo.md</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perspective</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference to an existing perspective name.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LibraryPerspective</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the name of the header that should be displayed (useful for context menu headers).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppNavBar</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 43. Examples</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">URL</th>
<th class="tableblock halign-left valign-top">Explanation</th>
<th class="tableblock halign-left valign-top"><a href="http://localhost:8080/kie-wb/kie-wb.jsp?standalone&amp;perspective=LibraryPerspective" class="bare">http://localhost:8080/kie-wb/kie-wb.jsp?standalone&amp;perspective=LibraryPerspective</a></th>
<th class="tableblock halign-left valign-top">Opens the Library Perspective. You can select the project you want to edit and get all the authoring functions for the selected project.</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/kie-wb/kie-wb.jsp?standalone&amp;path=default://master@myteam/Mortgages/src/main/java/mortgages/mortgages/Applicant.java" class="bare">http://localhost:8080/kie-wb/kie-wb.jsp?standalone&amp;path=default://master@myteam/Mortgages/src/main/java/mortgages/mortgages/Applicant.java</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Opens just the editor for the given asset.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8080/kie-wb/kie-wb.jsp?standalone&amp;perspective=AuthoringPerspective&amp;path=default://master@myteam/Mortgages/src/main/java/mortgages/mortgages/Applicant.java" class="bare">http://localhost:8080/kie-wb/kie-wb.jsp?standalone&amp;perspective=AuthoringPerspective&amp;path=default://master@myteam/Mortgages/src/main/java/mortgages/mortgages/Applicant.java</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Opens the given file with the Project Explorer. Giving the user the possibility to browse the content of the project where the given file is and even open other files from the project.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_wb.execserverui"><a class="anchor" href="#_wb.execserverui"></a><a class="link" href="#_wb.execserverui">20.9. Execution Server Management UI</a></h3>
<div class="paragraph">
<p>The Execution Server Management UI allows users create and modify Server Templates and Containers, it also allows users manage Remote Servers.
This screen is available via Deploy → Rule Deployments menu.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewExecServerUI(1).png" alt="NewExecServerUI">
</div>
<div class="title">Figure 309. Execution Server Management</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The management UI is only available for KIE Managed Servers.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_wb.execserveruitemplate"><a class="anchor" href="#_wb.execserveruitemplate"></a><a class="link" href="#_wb.execserveruitemplate">20.9.1. Server Templates</a></h4>
<div class="paragraph">
<p>Server templates are used to define a common configuration that can be used for multiple server, thus the name: Template.</p>
</div>
<div class="paragraph">
<p>Server Templates can be created directly from the management UI or it’s automatically create when a server connects to controller and there isn’t a template definition for that remote server.
Server templates may have one or more capabilities, such capabilities can’t be modified, if you need modify the capabilities you’ll have to create a new template.
Here is the list of current capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rule (Drools)</p>
</li>
<li>
<p>Process (jBPM)</p>
</li>
<li>
<p>Planning (Optaplanner)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For Planner capability it’s mandatory to enable Rule’s capability too.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In order to create a new Server Template you have to click at New Server Template button and follow the wizard.
It’s also possible to create a container during Wizard, but for now let’s limit to just the template.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewServerTemplateWizard.png" alt="NewServerTemplateWizard">
</div>
<div class="title">Figure 310. New Server Template Wizard</div>
</div>
<div class="paragraph">
<p>Once created you’ll get the new Template listed on the left hand side, with the new Server Template highlighted.
On the right hand side you get the 2nd level navigation that lists Containers and Remote Servers that are related to selected Server Template.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ServerTemplates.png" alt="ServerTemplates">
</div>
<div class="title">Figure 311. Server Templates</div>
</div>
<div class="paragraph">
<p>On top of the navigation is also possible to delete the current Server Template or create a copy of it.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ServerTemplateActions.png" alt="ServerTemplateActions">
</div>
<div class="title">Figure 312. Server Template Actions</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.execserveruicontainer"><a class="anchor" href="#_wb.execserveruicontainer"></a><a class="link" href="#_wb.execserveruicontainer">20.9.2. Container</a></h4>
<div class="paragraph">
<p>A Container is a KIE Container configuration of the Server Template.
Click the Add Container button to create a new container for the current Server Template.</p>
</div>
<div class="paragraph">
<p>The search area can help users find an specific KJARs that they are looking for.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewContainerWizard.png" alt="NewContainerWizard">
</div>
<div class="title">Figure 313. New Container Wizard</div>
</div>
<div class="paragraph">
<p>For Server Templates that have Process capabilities enabled, the Wizard has a 2nd optional step where users can configure some process related behaviors.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ProcessConfigNewContainerWizard.png" alt="ProcessConfigNewContainerWizard">
</div>
<div class="title">Figure 314. Process Configuration</div>
</div>
<div class="paragraph">
<p><strong>Kie Base Name</strong> determines which Kie Base of the deployed artifact will be used.</p>
</div>
<div class="paragraph">
<p><strong>Kie Session Name</strong> determines which Kie Session of the selected Kie Base will be used.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please notice that configurations on this tab takes effect only if the deployed project contains some business processeses. It is not enough if the server template has the extension for processes enabled.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Once created the new Container will be displayed on the containers list just above the list of remote servers.
Just after created a container is by default Stopped which is the only state that allows users to remove it.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewContainer.png" alt="NewContainer">
</div>
<div class="title">Figure 315. Container</div>
</div>
<div class="paragraph">
<p>A Container has the following tabs available for management and/or configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Status</p>
</li>
<li>
<p>Version Configuration</p>
</li>
<li>
<p>Process Configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Status tab lists all the Remote Servers that are running the active Container.
Each Remote Server is rendered as a Card, which displays to users status and endpoint.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only started Containers are deployed to remote servers.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ContainerStatus.png" alt="ContainerStatus">
</div>
<div class="title">Figure 316. Status Container</div>
</div>
<div class="paragraph">
<p>For containers that do not have process capability the Version Configuration tab allows users to change the current version of the Container.
Users can upgrade manually to a specific version using the "Upgrade" button or enable/disable the Scanner.
It’s also possible to execute a Scan Now operation that will scan for new versions only once.</p>
</div>
<div class="paragraph">
<p>To redeploy SNAPSHOT kjars with your latest changes all existing containers with that version must first be removed.  Executing 'build and deploy' will then create a container with the latest SNAPSHOT kjar.
However, this is not possible for release versions.  Following maven release convensions if the GAV of a kjar is anthing but SNAPSHOT, the GAV will need to be updated to the newer release version and deployed to its own container.  The new release version can also be used to upgrade an existing container as describe previously provided the container does not have process capability.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ContainerVersionConfiguration.png" alt="ContainerVersionConfiguration">
</div>
<div class="title">Figure 317. Version Configuration</div>
</div>
<div class="paragraph">
<p>Process Configuration is the same form that is displayed during New Container Wizard for Template Servers that have Process Capability.
If Template Server doesn’t have such capability, the action buttons will be disabled.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ContainerProcessConfiguration.png" alt="ContainerProcessConfiguration">
</div>
<div class="title">Figure 318. Process Configuration</div>
</div>
</div>
<div class="sect3">
<h4 id="_wb.execserveruiremoteserver"><a class="anchor" href="#_wb.execserveruiremoteserver"></a><a class="link" href="#_wb.execserveruiremoteserver">20.9.3. Remote Server</a></h4>
<div class="paragraph">
<p>Remote Server is a Managed KIE Server instance running that has a controller configured.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default Workbench comes with a Controller embedded.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The list of Remote Servers are displayed just under the list of Containers.
Once selected the screens reveals the Remote Server details and a list of cards, each card represents a running Container.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/RemoteServers.png" alt="RemoteServers">
</div>
<div class="title">Figure 319. Remote Servers</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="drools.AuthoringAssets"><a class="anchor" href="#drools.AuthoringAssets"></a><a class="link" href="#drools.AuthoringAssets">21. Authoring Rule Assets</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_drools.newpackage"><a class="anchor" href="#_drools.newpackage"></a><a class="link" href="#_drools.newpackage">21.1. Creating a package</a></h3>
<div class="paragraph">
<p>Configuring packages is generally something that is done once, and by someone with some experience with rules/models.
Generally speaking, very few people will need to configure packages, and once they are setup, they can be copied over and over if needed.
Package configuration is most definitely a technical task that requires the appropriate expertise.</p>
</div>
<div class="paragraph">
<p>All assets live in "packages" in Drools Workbench - a package is like a folder (it also serves as a "namespace"). A home folder for rule assets to live in.
Rules in particular need to know what the fact model is, what the namespace is etc.</p>
</div>
<div class="paragraph">
<p>So while rules (and assets in general) can appear in any number of categories, they only live in one package.
If you think of Drools Workbench as a file system, then each package is a folder, and the assets live in that folder - as one big happy list of files.</p>
</div>
<div class="paragraph">
<p>To create an empty package select "Package" from the "Create New Asset" menu.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/newItemMenu.png" alt="newItemMenu">
</div>
<div class="title">Figure 320. New Package</div>
</div>
<div class="sect3">
<h4 id="_empty_package"><a class="anchor" href="#_empty_package"></a><a class="link" href="#_empty_package">21.1.1. Empty package</a></h4>
<div class="paragraph">
<p>An empty package can be created by simply specifying a name.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/newItem-package.png" alt="newItem package">
</div>
<div class="title">Figure 321. New empty Package</div>
</div>
<div class="paragraph">
<p>Once the Package has been created it will appear in the Project Explorer.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/newItem-package-project-explorer.png" alt="newItem package project explorer">
</div>
<div class="title">Figure 322. Project Explorer showing new Package</div>
</div>
</div>
<div class="sect3">
<h4 id="_copy_rename_and_delete_packages"><a class="anchor" href="#_copy_rename_and_delete_packages"></a><a class="link" href="#_copy_rename_and_delete_packages">21.1.2. Copy, Rename and Delete Packages</a></h4>
<div class="paragraph">
<p>As already mentioned on <a href="#_wb.projectexplorercopyrenamedeleteactions">Project Explorer</a> section, users can copy, rename or delete a package directly from Project Explorer.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guidedruleeditor"><a class="anchor" href="#_drools.guidedruleeditor"></a><a class="link" href="#_drools.guidedruleeditor">21.2. Business rules with the guided editor</a></h3>
<div class="paragraph">
<p>Guided Rules are authored with a UI to control and prompt user input based on knowledge of the object model.</p>
</div>
<div class="paragraph">
<p>This can also be augmented with DSL sentences.</p>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditorparts"><a class="anchor" href="#_drools.guidedruleeditorparts"></a><a class="link" href="#_drools.guidedruleeditorparts">21.2.1. Parts of the Guided Rule Editor</a></h4>
<div class="paragraph">
<p>The Guided Rule Editor is composed of three main sections.</p>
</div>
<div class="paragraph">
<p>The following diagram shows the editor in action.
The following descriptions apply to the lettered boxes in the diagram:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedEditor-overview.png" alt="GuidedEditor overview">
</div>
<div class="title">Figure 323. The guided BRL editor</div>
</div>
<div class="paragraph">
<p>A : The different parts of a rule:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The "WHEN" part, or conditions, of the rule.</p>
</li>
<li>
<p>The "THEN" action part of the rule.</p>
</li>
<li>
<p>Optional attributes that may effect the operation of the rule.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditorlhs"><a class="anchor" href="#_drools.guidedruleeditorlhs"></a><a class="link" href="#_drools.guidedruleeditorlhs">21.2.2. The "WHEN" (left-hand side) of a Rule</a></h4>
<div class="paragraph">
<p>B : This shows a pattern which is declaring that the rule is looking for a "LoanApplication" fact (the fields are listed below, in this case none). Another pattern, "Applicant", is listed below "LoanApplication". Fields "creditRating" and "applicationDate" are listed.
Clicking on the fact name ("LoanApplication") will pop-up a list of options to add to the fact declaration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add more fields (e.g. their "location").</p>
</li>
<li>
<p>Assign a variable name to the fact (which you can use later on if needs be)</p>
</li>
<li>
<p>Add "multiple field" constraints - i.e. constraints that span across fields (e.g. age &gt; 42 or risk &gt; 2).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>C : The "minus" icon ("[-]") indicates you can remove something.
In this case it would remove the whole "LoanApplication" fact declaration.
Depending upon the placement of the icon different components of the rule declaration can be removed, for example a Fact Pattern, Field Constraint, other Conditional Element ("exists", "not exists", "from" etc) or an Action.</p>
</div>
<div class="paragraph">
<p>D : The "plus" icon ("+") allows you to add more patterns to the condition or the action part of the rule, or more attributes.
In all cases, a popup option box is provided.
For the "WHEN" part of the rule, you can choose from a list of Conditional Elements to add:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Constraint on a Fact: it will give you a list of facts.</p>
</li>
<li>
<p>"The following does not exist": the fact plus constraints must not exist.</p>
</li>
<li>
<p>"The following exists": at least one match should exist (but there only needs to be one - it will not trigger for each match).</p>
</li>
<li>
<p>"Any of the following are true": any of the patterns can match (you then add patterns to these higher level patterns).</p>
</li>
<li>
<p>"From": this will insert a new From Conditional Element to the rule.</p>
</li>
<li>
<p>"From Accumulate": this will insert a new Accumulate Conditional Element to the rule.</p>
</li>
<li>
<p>"From Collect": this will insert a new Collect Conditional Element to the rule.</p>
</li>
<li>
<p>"From Entry-point": this allows you to define an Entry Point for the pattern.</p>
</li>
<li>
<p>"Free Form DRL": this will let you insert a free chunk of DRL.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you just put a fact (like is shown above) then all the patterns are combined together so they are all true ("and").</p>
</div>
<div class="paragraph">
<p>E : This shows the constraint for the "creditRating" field.
Looking from left to right you find:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The field name: "creditRating". Clicking on it you can assign a variable name to it, or access nested properties of it.</p>
</li>
<li>
<p>A list of constraint operations ("equal to" being selected): The content of this list changes depending on the field’s data type.</p>
</li>
<li>
<p>The value field: It could be one of the following:</p>
<div class="ulist">
<ul>
<li>
<p>A literal value: depending on the field’s data type different components will be displayed:</p>
<div class="ulist">
<ul>
<li>
<p>String → Textbox</p>
</li>
<li>
<p>Any numerical value → Textbox restricting entry to values valid for the numerical sub-type (e.g. a byte can hold values from -128 to 127). BigDecimal and BigInteger data-types are also supported. Please ensure the appropriate Class has been imported in the Package configuration. The import will be added automatically if a POJO model has been uploaded that exposes an accessor or mutator for a BigDecimal or BigInteger field. BigDecimal values are automatically suffixed with "B" indicating to the underlying Engine that the literal value should be interpreted as a BigDecimal. BigIntegers are suffixed with "I". The user does not need to enter the suffix.</p>
</li>
<li>
<p>Date → Calendar</p>
</li>
<li>
<p>Enumeration → Listbox</p>
</li>
<li>
<p>Boolean → Checkbox</p>
</li>
</ul>
</div>
</li>
<li>
<p>A "formula": this is an expression which is calculated (this is for advanced users only)</p>
</li>
<li>
<p>An Expression - this will let you use an Expression Builder to build up a full mvel expression. (At the moment only basic expressions are supported)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>F : This shows the constraint for the "applicationDate" field.
Looking from left to right you find:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The field name: "applicationDate".</p>
</li>
<li>
<p>A list of constraint operations: "after" being selected.</p>
</li>
<li>
<p>A "clock" icon. Since the "applicationDate" is a Date data-type the list of available operators includes those relating to Complex Event Processing (CEP). When a CEP operator is used this additional icon is displayed to allow you to enter additional CEP operator parameters. Clicking the "clock" will cycle the available combinations of CEP operator parameters.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Complex Event Processing operators are also available when the Fact has been declared as an event.
Refer to the "Fact Model" chapter of this user-guide for details on how to add annotations to your Fact model.
Events have access to the full range of CEP operators; Date field-types are restricted to "after", "before" and "coincides".</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Facts annotated as Events can also have CEP sliding windows defined.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_drools.guidedruleeditoraddingpatterns"><a class="anchor" href="#_drools.guidedruleeditoraddingpatterns"></a><a class="link" href="#_drools.guidedruleeditoraddingpatterns">21.2.2.1. Adding Patterns</a></h5>
<div class="paragraph">
<p>When clicking on the + button of the WHEN section, a new popup will appear letting you to add a new Pattern to the Rule.
The popup will looks similar to the image below.
In this popup you could select the type of Pattern to add by selecting one of the list items.
In the list you will have an entry for each defined Fact Type, in addition to the already mentioned Conditional Elements like "exists", "doesn’t exist", "from", "collect", "accumulate", "from entry-point" and "free form DRL". Once you have selected one of this elements, you can add a new Pattern by clicking on the "Ok" button.
The new pattern will be added at the bottom of the rule’s left hand side.
If you want to choose a different position, you can use the combobox placed at the top of the popup.</p>
</div>
<div class="paragraph">
<p>You can also open this popup by clicking in the [+] button from a Pattern’s action toolbar.
If that is the case, the pop-up that appears wouldn’t constraint the position combobox, because the new Pattern will be added just after the Pattern where you clicked.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedLHSPatterns.png" alt="GuidedLHSPatterns">
</div>
<div class="title">Figure 324. Adding Patterns</div>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guidedruleeditoraddingconstraints"><a class="anchor" href="#_drools.guidedruleeditoraddingconstraints"></a><a class="link" href="#_drools.guidedruleeditoraddingconstraints">21.2.2.2. Adding constraints</a></h5>
<div class="paragraph">
<p>The below dialog is what you will get when you want to add constraints to a fact.
In the top half are the simple options: you can either add a field constraint straight away (a list of fields of the applicable fact will be shown), or you can add a "Multiple field constraint" using AND or OR operands.
In the bottom half of the window you have the Advanced options: you can add a formula (which resolves to True or False - this is like in the example above: "…​ salary &gt; (2500 * 4.1)". You can also assign a Variable name to the fact (which means you can then access that variable on the action part of the rule, to set a value etc).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedLHSConstraints.png" alt="GuidedLHSConstraints">
</div>
<div class="title">Figure 325. Adding constraints</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditorrhs"><a class="anchor" href="#_drools.guidedruleeditorrhs"></a><a class="link" href="#_drools.guidedruleeditorrhs">21.2.3. The "THEN" (right-hand side) of a Rule</a></h4>
<div class="paragraph">
<p>H : This shows an "action" of the rule, the Right Hand Side of a rule consists in a list of actions.
In this case, we are updating the "explanation" field of the "LoanApplication" fact.
There are quite a few other types of actions you can use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Insert a completely new Fact and optionally set a field on the Fact.</p>
<div class="paragraph">
<p>The value field can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A literal value: depending on the field’s data type different components will be displayed:</p>
<div class="ulist">
<ul>
<li>
<p>String → Textbox</p>
</li>
<li>
<p>Any numerical value → Textbox restricting entry to values valid for the numerical sub-type (e.g. a byte can hold values from -128 to 127). BigDecimal and BigInteger data-types are also supported. Please ensure the appropriate Class has been imported in the Package configuration. The import will be added automatically if a POJO model has been uploaded that exposes an accessor or mutator for a BigDecimal or BigInteger field. BigDecimal values are automatically suffixed with "B" indicating to the underlying Engine that the literal value should be interpreted as a BigDecimal. BigIntegers are suffixed with "I". The user does not need to enter the suffix.</p>
</li>
<li>
<p>Date → Calendar</p>
</li>
<li>
<p>Enumeration → Listbox</p>
</li>
<li>
<p>Boolean → Checkbox</p>
</li>
</ul>
</div>
</li>
<li>
<p>A variable bound to a Fact or Field in the left-hand side. The data-type of the field being set must match the data-type of the variable.</p>
</li>
<li>
<p>A "formula": this is an expression which is calculated (this is for advanced users only)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logically insert a completely new Fact (see "Truth Maintenance" in the Expert documentation) and optionally set a field on the Fact.</p>
<div class="ulist">
<ul>
<li>
<p>A literal value: depending on the field’s data type different components will be displayed:</p>
<div class="paragraph">
<p>The value field can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A literal value: depending on the field’s data type different components will be displayed:</p>
<div class="ulist">
<ul>
<li>
<p>String → Textbox</p>
</li>
<li>
<p>Any numerical value → Textbox restricting entry to values valid for the numerical sub-type (e.g. a byte can hold values from -128 to 127). BigDecimal and BigInteger data-types are also supported. Please ensure the appropriate Class has been imported in the Package configuration. The import will be added automatically if a POJO model has been uploaded that exposes an accessor or mutator for a BigDecimal or BigInteger field. BigDecimal values are automatically suffixed with "B" indicating to the underlying Engine that the literal value should be interpreted as a BigDecimal. BigIntegers are suffixed with "I". The user does not need to enter the suffix.</p>
</li>
<li>
<p>Date → Calendar</p>
</li>
<li>
<p>Enumeration → Listbox</p>
</li>
<li>
<p>Boolean → Checkbox</p>
</li>
</ul>
</div>
</li>
<li>
<p>A variable bound to a Fact or Field in the left-hand side. The data-type of the field being set must match the data-type of the variable.</p>
</li>
<li>
<p>A "formula": this is an expression which is calculated (this is for advanced users only)</p>
</li>
</ul>
</div>
</li>
<li>
<p>A variable bound to a Fact or Field in the left-hand side. The data-type of the field being set must match the data-type of the variable.</p>
</li>
<li>
<p>A "formula": this is an expression which is calculated (this is for advanced users only)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Modify a field of an existing fact (which tells the engine the fact has changed).</p>
<div class="paragraph">
<p>The value field can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A literal value: depending on the field’s data type different components will be displayed:</p>
<div class="ulist">
<ul>
<li>
<p>String → Textbox</p>
</li>
<li>
<p>Any numerical value → Textbox restricting entry to values valid for the numerical sub-type (e.g. a byte can hold values from -128 to 127). BigDecimal and BigInteger data-types are also supported. Please ensure the appropriate Class has been imported in the Package configuration. The import will be added automatically if a POJO model has been uploaded that exposes an accessor or mutator for a BigDecimal or BigInteger field. BigDecimal values are automatically suffixed with "B" indicating to the underlying Engine that the literal value should be interpreted as a BigDecimal. BigIntegers are suffixed with "I". The user does not need to enter the suffix.</p>
</li>
<li>
<p>Date → Calendar</p>
</li>
<li>
<p>Enumeration → Listbox</p>
</li>
<li>
<p>Boolean → Checkbox</p>
</li>
</ul>
</div>
</li>
<li>
<p>A variable bound to a Fact or Field in the left-hand side. The data-type of the field being set must match the data-type of the variable.</p>
</li>
<li>
<p>A "formula": this is an expression which is calculated (this is for advanced users only)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Set a field on a fact (in which case the engine doesn’t know about the change - normally because you are setting a result).</p>
<div class="paragraph">
<p>The value field can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A literal value: depending on the field’s data type different components will be displayed:</p>
<div class="ulist">
<ul>
<li>
<p>String → Textbox</p>
</li>
<li>
<p>Any numerical value → Textbox restricting entry to values valid for the numerical sub-type (e.g. a byte can hold values from -128 to 127). BigDecimal and BigInteger data-types are also supported. Please ensure the appropriate Class has been imported in the Package configuration. The import will be added automatically if a POJO model has been uploaded that exposes an accessor or mutator for a BigDecimal or BigInteger field. BigDecimal values are automatically suffixed with "B" indicating to the underlying Engine that the literal value should be interpreted as a BigDecimal. BigIntegers are suffixed with "I". The user does not need to enter the suffix.</p>
</li>
<li>
<p>Date → Calendar</p>
</li>
<li>
<p>Enumeration → Listbox</p>
</li>
<li>
<p>Boolean → Checkbox</p>
</li>
</ul>
</div>
</li>
<li>
<p>A variable bound to a Fact or Field in the left-hand side. The data-type of the field being set must match the data-type of the variable.</p>
</li>
<li>
<p>A "formula": this is an expression which is calculated (this is for advanced users only)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Delete a fact from the Engine’s Working Memory.</p>
</li>
<li>
<p>Add Facts to existing global lists.</p>
</li>
<li>
<p>Call a method on a variable.</p>
</li>
<li>
<p>Write a chunk of free form code.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditoroptionalattributes"><a class="anchor" href="#_drools.guidedruleeditoroptionalattributes"></a><a class="link" href="#_drools.guidedruleeditoroptionalattributes">21.2.4. Optional attributes</a></h4>
<div class="paragraph">
<p>The attributes section of a rule provides the means to define metadata and attributes (such as "salience", "no-loop" etc).</p>
</div>
<div class="paragraph">
<p>Click on the "+" icon to add a new metadata or attribute definition.
Each defined will appear listed in this section.</p>
</div>
<div class="paragraph">
<p>Click on the "-" icon beside each metadata or attribute to remove it.</p>
</div>
<div class="sect4">
<h5 id="_drools.guidedruleeditoroptionalattributessalience"><a class="anchor" href="#_drools.guidedruleeditoroptionalattributessalience"></a><a class="link" href="#_drools.guidedruleeditoroptionalattributessalience">21.2.4.1. Salience</a></h5>
<div class="paragraph">
<p>Each rule has a salience value which is an integer value that defaults to zero.
The salience value  represents the priority of the rule with higher salience values representing higher priority.
Salience  values can be positive or negative.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditortoolbar"><a class="anchor" href="#_drools.guidedruleeditortoolbar"></a><a class="link" href="#_drools.guidedruleeditortoolbar">21.2.5. Pattern/Action toolbar</a></h4>
<div class="paragraph">
<p>G : Next to each Pattern or Action you will find a toolbar containing 3 buttons.</p>
</div>
<div class="paragraph">
<p>The first "+" icon lets you insert a new Pattern/Action at an arbitrary location.
The other "+" icons allow you to insert a new Pattern/Action below that you have selected.</p>
</div>
<div class="paragraph">
<p>The remaining arrow icons allow you to move the current Pattern/Action up or down.</p>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditorenumerations"><a class="anchor" href="#_drools.guidedruleeditorenumerations"></a><a class="link" href="#_drools.guidedruleeditorenumerations">21.2.6. User driven drop down lists</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/EnumDropDown.png" alt="EnumDropDown">
</div>
<div class="title">Figure 326. Data enumeration showing as a drop down list</div>
</div>
<div class="paragraph">
<p>Note that is it possible to limit field values to items in a pre-configured list.
This list is either defined by a Java enumeration or configured as part of the package (using a data enumeration to provide values for the drop down list). These values can be a fixed list, or (for example) loaded from a database.
This is useful for codes, and other fields where there are set values.
It is also possible to have what is displayed on screen, in a drop down, be different to the value (or code) used in a rule.
See the section on data enumerations for how these are configured.</p>
</div>
<div class="paragraph">
<p>It is possible to define a list of values for one field that are dependent upon the value of one or more other fields, on the same Fact (e.g.
a list of "Cities" depending on the selected "Country region"). Please refer to the section on "Enumerations" for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditordsl"><a class="anchor" href="#_drools.guidedruleeditordsl"></a><a class="link" href="#_drools.guidedruleeditordsl">21.2.7. Augmenting with DSL sentences</a></h4>
<div class="paragraph">
<p>If the package the rule is part of has a DSL configuration, when when you add conditions or actions, then it will provide a list of "DSL Sentences" which you can choose from - when you choose one, it will add a row to the rule - where the DSL specifies values come from a user, then a edit box (text) will be shown (so it ends up looking a bit like a form). This is optional, and there is another DSL editor.
Please note that the DSL capabilities in this editor are slightly less then the full set of DSL features (basically you can do [when] and [then] sections of the DSL only - which is no different to drools 3 in effect).</p>
</div>
<div class="paragraph">
<p>The following diagram shows the DSL sentences in action in the guided editor:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDSL.png" alt="GuidedDSL">
</div>
<div class="title">Figure 327. DSL in guided editor</div>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruleeditorcomplexexample"><a class="anchor" href="#_drools.guidedruleeditorcomplexexample"></a><a class="link" href="#_drools.guidedruleeditorcomplexexample">21.2.8. A more complex example:</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedComplex.png" alt="GuidedComplex">
</div>
<div class="title">Figure 328. A more complex BRL example</div>
</div>
<div class="paragraph">
<p>In the above example, you can see how to use a mixture of Conditional Elements, literal values, and formulas.
The rule has 4 "top level" Patterns and 1 Action.
The "top level" Patterns are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A Fact Pattern on Person. This Pattern contains two field constraints: one for birthDate field and the other one is a formula. Note that the value of the birthDate restriction is selected from a calendar. Another thing to note is that you can make calculations and use nested fields in the formula restriction (i.e. car.brand). Finally, we are setting a variable name ($p) to the Person Fact Type. You can then use this variable in other Patterns.</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The generated DRL from this Pattern will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$p</span> : Person( birthDate &lt; <span class="hljs-string">"19-Dec-1982"</span> , <span class="hljs-built_in">eval</span>( car.brand == <span class="hljs-string">"Ford"</span> &amp;&amp; salary &gt; (<span class="hljs-number">2500</span> * <span class="hljs-number">4.1</span>) ))</code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>A From Pattern. This condition will create a match for every Address whose street name is "Elm St." from the Person’s list of addresses. The left side of the from is a regular Fact Pattern and the right side is an Expression Builder that let us inspect variable’s fields.</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The generated DRL from this Pattern will be: <code>Address( street == "Elm St." ) from
          $p.addresses</code></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>A "Not Exist" Conditional Element. This condition will match when its content doesn’t create a match. In this case, its content is a regular Fact Pattern (on Person). In this Fact Pattern you can see how variables ($p) could be used inside a formula value.</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The generated DRL from this Pattern will be: <code>not Person( salary == ( $p.salary * 2 )
          )</code></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>A "From Accumulate" Conditional Element. This is maybe one of the most complex Patterns you can use. It consist in a Left Pattern (It must be a Fact Pattern. In this case is a Number Pattern. The Number is named $totalAddresses), a Source Pattern (Which could be a Fact Pattern, From, Collect or Accumulate conditional elements. In this case is an Address Pattern Restriction with a field restriction in its zip field) and a Formula Section where you can use any built-in or custom Accumulate Function (in this example a count() function is used). Basically, this Conditional Element will count the addresses having a zip code of 43240 from the Person’s list of addresses.</p>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The generated DRL from this Pattern will be: `$totalAddresses : Number() from accumulate ($a :
          Address( zipCode == " 43240") from $p.addresses, count($a)) `</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guidedruletemplateeditor"><a class="anchor" href="#_drools.guidedruletemplateeditor"></a><a class="link" href="#_drools.guidedruletemplateeditor">21.3. Templates of assets/rules</a></h3>
<div class="paragraph">
<p>The guided rule editor is great when you need to define a single rule, however if you need to define multiple rules following the same structure but with different values in field constraints or action sections a "Rule Template" is a valuable asset.
Rule templates allow the user to define a rule structure with place-holders for values that are to be interpolated from a table of data.
Literal values, formulae and expressions can also continue to be used.</p>
</div>
<div class="paragraph">
<p>Rule Templates can often be used as an alternative for Decision Tables in Drools Workbench.</p>
</div>
<div class="sect3">
<h4 id="_drools.guidedruletemplateeditorcreating"><a class="anchor" href="#_drools.guidedruletemplateeditorcreating"></a><a class="link" href="#_drools.guidedruletemplateeditorcreating">21.3.1. Creating a rule template</a></h4>
<div class="paragraph">
<p>To create a template for a rule simply select the "Guided Rule Template" from the "New Item" menu.</p>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruletemplateeditordefining"><a class="anchor" href="#_drools.guidedruletemplateeditordefining"></a><a class="link" href="#_drools.guidedruletemplateeditordefining">21.3.2. Define the template</a></h4>
<div class="paragraph">
<p>Once a rule template has been created the editor is displayed.
The editor takes the form of the standard guided editor explained in more detail under the "Rule Authoring" section.
As the rule is constructed you are given the ability to insert "Template Keys" as place-holders within your field constraints and action sections.
Literal values, formulae and expressions can continue to be used as in the standard guided editor.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guided-template1.png" alt="guided template1">
</div>
<div class="title">Figure 329. Template Key popup</div>
</div>
<div class="paragraph">
<p>The following screenshot illustrates a simple rule that has been defined with a "Template Key" for the applicants' maximum age, minimum age and credit rating.
The template keys have been defined as "$max_age", "$min_age" and "$cr" respectively.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guided-template2.png" alt="guided template2">
</div>
<div class="title">Figure 330. Rule template in the guided editor</div>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruletemplateeditordefiningdata"><a class="anchor" href="#_drools.guidedruletemplateeditordefiningdata"></a><a class="link" href="#_drools.guidedruletemplateeditordefiningdata">21.3.3. Defining the template data</a></h4>
<div class="paragraph">
<p>When you have completed the definition of your rule template you need to enter the data that will be used to interpolate the "Template Key" place-holders.
Drools Workbench provides the facility to enter data in a flexible grid within the guided editor screen.
The data entry section is located on the Data tab within the editor.</p>
</div>
<div class="paragraph">
<p>The rule template data grid is very flexible; with different pop-up editors for the underlying fields' data-types.
Columns can be resized and sorted; and cells can be merged and grouped to facilitate rapid data entry.</p>
</div>
<div class="paragraph">
<p>One row of data interpolates the "Template Key" place-holders for a single rule; thus one row becomes one rule.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If any cells for a row are left blank a rule for the applicable row is not generated.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guided-template3.png" alt="guided template3">
</div>
<div class="title">Figure 331. Template data grid</div>
</div>
<div class="sect4">
<h5 id="_drools.guidedruletemplateeditorcellmerging"><a class="anchor" href="#_drools.guidedruletemplateeditorcellmerging"></a><a class="link" href="#_drools.guidedruletemplateeditorcellmerging">21.3.3.1. Cell merging</a></h5>
<div class="paragraph">
<p>The icon in the top left of the grid toggles cell merging on and off.
When cells are merged those in the same column with identical values are merged into a single cell.
This simplifies changing the value of multiple cells that shared the same original value.
When cells are merged they also gain an icon in the top-left of the cell that allows rows spanning the merged cell to be grouped.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guided-template4.png" alt="guided template4">
</div>
<div class="title">Figure 332. Cell merging</div>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guidedruletemplateeditorcellgrouping"><a class="anchor" href="#_drools.guidedruletemplateeditorcellgrouping"></a><a class="link" href="#_drools.guidedruletemplateeditorcellgrouping">21.3.3.2. Cell grouping</a></h5>
<div class="paragraph">
<p>Cells that have been merged can be further collapsed into a single row.
Clicking the [+\-] icon in the top left of a merged cell collapses the corresponding rows into a single entry.
Cells in other columns spanning the collapsed rows that have identical values are shown unchanged.
Cells in other columns spanning the collapsed rows that have different values are highlighted and the first value displayed.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guided-template5.png" alt="guided template5">
</div>
<div class="title">Figure 333. Cell grouping</div>
</div>
<div class="paragraph">
<p>When the value of a grouped cell is altered all cells that have been collapsed also have their values updated.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedruletemplateeditorgenerateddrl"><a class="anchor" href="#_drools.guidedruletemplateeditorgenerateddrl"></a><a class="link" href="#_drools.guidedruletemplateeditorgenerateddrl">21.3.4. Generated DRL</a></h4>
<div class="paragraph">
<p>Whilst not necessary, rule authors can view the DRL that will be generated for a "Rule Template" and associated data.
This feature and its operation is no different to that for other assets.
Select the "Source" tab from the bottom of the editor screen.
The DRL for all rules will be displayed.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guided-template6.png" alt="guided template6">
</div>
<div class="title">Figure 334. Generated DRL</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guideddecisiontableeditor"><a class="anchor" href="#_drools.guideddecisiontableeditor"></a><a class="link" href="#_drools.guideddecisiontableeditor">21.4. Guided Decision Tables</a></h3>
<div class="paragraph">
<p>The Guided Decision Table editor supports authoring decision tables. Rule attributes, meta-data, conditions and actions can be defined in a tabular format thus facilitating rapid entry of large sets of related rules. Web-based decision table rules are compiled into DRL like all other rule assets.</p>
</div>
<div class="paragraph">
<p>Data Objects available in the project, either manually created with the Data Object Editor or present in dependencies added to the Project, can be used in column definitions.</p>
</div>
<div class="sect3">
<h4 id="_drools.guideddecisiontableeditortypesofdecisiontable"><a class="anchor" href="#_drools.guideddecisiontableeditortypesofdecisiontable"></a><a class="link" href="#_drools.guideddecisiontableeditortypesofdecisiontable">21.4.1. Types of decision table</a></h4>
<div class="paragraph">
<p>There are broadly two different types of decision table, both of which are supported in the Workbench:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Extended Entry</p>
</li>
<li>
<p>Limited Entry</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditorextendedentrydecisiontable"><a class="anchor" href="#_drools.guideddecisiontableeditorextendedentrydecisiontable"></a><a class="link" href="#_drools.guideddecisiontableeditorextendedentrydecisiontable">21.4.1.1. Extended Entry</a></h5>
<div class="paragraph">
<p>An Extended Entry decision table is one for which the column definitions, or stubs, specify Pattern, Field and operator but not value. The values, or states, are themselves held in the body of the decision table. It is normal, but not essential, for the range of possible values to be restricted by limiting entry to values from a list. The Workbench supports use of Java enumerations, Workbench enumerations or decision table "optional value lists" to restrict value entry.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-extended-entry.png" alt="dtable extended entry">
</div>
<div class="title">Figure 335. Extended Entry Decision table</div>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditorlimitedentrydecisiontable"><a class="anchor" href="#_drools.guideddecisiontableeditorlimitedentrydecisiontable"></a><a class="link" href="#_drools.guideddecisiontableeditorlimitedentrydecisiontable">21.4.1.2. Limited Entry</a></h5>
<div class="paragraph">
<p>A Limited Entry decision table is one for which the column definitions specify a value in addition to Pattern, Field and operator. The decision table states, held in the body of the table, are boolean where a positive value (a checked tick-box) has the effect of meaning the column should apply, or be matched. A negative value (a cleared tick-box) means the column does not apply.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-limited-entry.png" alt="dtable limited entry">
</div>
<div class="title">Figure 336. Limited Entry Decision table</div>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditornavigation"><a class="anchor" href="#_drools.guideddecisiontableeditornavigation"></a><a class="link" href="#_drools.guideddecisiontableeditornavigation">21.4.1.3. Navigation</a></h5>
<div class="paragraph">
<p>The editor can be "panned" by pressing the left-mouse button and dragging. Tables can also be repositioned by left-clicking on the table title and dragging. Double-clicking the table title locks the table in the editor preventing repositioning; however content overflowing the visible bounds of the editor can be scrolled into view by panning the editor.</p>
</div>
<div class="paragraph">
<p>Cells can be selected in a variety of ways:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Firstly individual cells can be double-clicked and an in-cell editor corresponding to the underlying data-type will appear. Groups of cells in the same column can be selected by clicking in the first cell and then clicking the extent of the required range with the shift key pressed.</p>
</li>
<li>
<p>Secondly the keyboard cursor keys can be used to navigate around the table. Pressing the enter key will pop-up the corresponding editor. Ranges can be selected by pressing the shift key whilst extending the range with the cursor keys.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Columns can be resized by hovering over the corresponding divider in the table body.
The mouse pointer will change and then the column width dragged either narrower or wider.</p>
</div>
<div class="paragraph">
<p>Columns can be moved by hovering over the corresponding header in the table header. The mouse pointer will change to indicate the operation is possible and then the column can be dragged to a new permissible position. Constraints on individual fields can be repositioned within their parent pattern. Blocks of columns for a single pattern can be repositioned by dragging the pattern header.</p>
</div>
<div class="sect5">
<h6 id="_menus"><a class="anchor" href="#_menus"></a><a class="link" href="#_menus">Menus</a></h6>
<div class="sect6">
<h7 id="_menu_bar_2"><a class="anchor" href="#_menu_bar_2"></a><a class="link" href="#_menu_bar_2">Menu bar</a></h7>
<div class="paragraph">
<p>The principle menu bar contains items to perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Save</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Saves changes made in the Editor.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Delete</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Delete the table entirely.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rename</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Rename the table.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Copy the file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Validate</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Validate the rules generated from the table.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Edit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cut, copy, paste, delete cells selected within the table.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Adjust the "zoom" level of the view and toggle between merged state. The Audit Log can also be viewed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Insert</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Insert rows or columns.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Radar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Radar shows a "mini-view" of the editor. Tables and the region visible in the Editor are simply represented by rectangles. The User can drag the visble region rectangle to reposition the Editor’s visible range.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-radar.png" alt="dtable radar">
</div>
<div class="title">Figure 337. Radar</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Version history</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Shows the different versions of the table.</p>
</div>
</div>
<div class="sect6">
<h7 id="_context_menu"><a class="anchor" href="#_context_menu"></a><a class="link" href="#_context_menu">Context menu</a></h7>
<div class="paragraph">
<p>Pressing the right mouse button whilst over the table shows a context menu. The context menu differs depending on whether the mouse pointer is hovering over a cell or the first, row number, column. The options available in each however is consistent offering the User the ability to cut, copy, insert or delete items.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-context-menu.png" alt="dtable context menu">
</div>
<div class="title">Figure 338. Context menu</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditorcellmerging"><a class="anchor" href="#_drools.guideddecisiontableeditorcellmerging"></a><a class="link" href="#_drools.guideddecisiontableeditorcellmerging">21.4.1.4. Cell merging</a></h5>
<div class="paragraph">
<p>The View→Merged menu entry toggles cell merging on and off. When cells are merged those in the same column with identical values are merged into a single cell. This simplifies changing the value of multiple cells that shared the same original value. When cells are merged they also gain an icon in the top-left of the cell that allows rows spanning the merged cell to be grouped.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-merged.png" alt="dtable merged">
</div>
<div class="title">Figure 339. Cell merging</div>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditorcellgrouping"><a class="anchor" href="#_drools.guideddecisiontableeditorcellgrouping"></a><a class="link" href="#_drools.guideddecisiontableeditorcellgrouping">21.4.1.5. Cell grouping</a></h5>
<div class="paragraph">
<p>Cells that have been merged can be further collapsed into a single row. Clicking the triangular icon in the top right of a merged cell collapses the corresponding rows into a single entry. Cells in other columns spanning the collapsed rows that have identical values are shown unchanged. Cells in other columns spanning the collapsed rows that have different values are highlighted and the first value displayed.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-grouped.png" alt="dtable grouped">
</div>
<div class="title">Figure 340. Cell grouping</div>
</div>
<div class="paragraph">
<p>When the value of a grouped cell is altered all cells that have been collapsed also have their values updated.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guideddecisiontableeditordefining"><a class="anchor" href="#_drools.guideddecisiontableeditordefining"></a><a class="link" href="#_drools.guideddecisiontableeditordefining">21.4.2. Defining a web based decision table</a></h4>
<div class="sect4">
<h5 id="_defining_the_table"><a class="anchor" href="#_defining_the_table"></a><a class="link" href="#_defining_the_table">21.4.2.1. Defining the table</a></h5>
<div class="paragraph">
<p>A table can either be defined using a Wizard  that walks the User through creation of columns or manually. The Wizard only supports simple column definitions; should the User need more sophisticated column definitions these need to be added manually after initial creation.</p>
</div>
<div class="paragraph">
<p>When a new empty decision table has been created the User needs to define columns for Facts, their constraints and corresponding actions. Tables always have two columns created automatically and cannot be deleted: a column for the row/rule number and a column in which a description of the rule can be provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditorwizard"><a class="anchor" href="#_drools.guideddecisiontableeditorwizard"></a><a class="link" href="#_drools.guideddecisiontableeditorwizard">21.4.2.2. Defining the table using the Wizard</a></h5>
<div class="paragraph">
<p>A Wizard can be used to assist with defining the decision table columns.</p>
</div>
<div class="paragraph">
<p>The wizard can be chosen when first electing to create a new rule.
The wizard provides a number of pages to define the table:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Summary</p>
</li>
<li>
<p>Add Fact Patterns</p>
</li>
<li>
<p>Add Constraints</p>
</li>
<li>
<p>Add Actions to update facts</p>
</li>
<li>
<p>Add Actions to insert facts</p>
</li>
<li>
<p>Columns to expand</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_drools.guideddecisiontableeditorselectingwizard"><a class="anchor" href="#_drools.guideddecisiontableeditorselectingwizard"></a><a class="link" href="#_drools.guideddecisiontableeditorselectingwizard">Selecting the wizard</a></h6>
<div class="paragraph">
<p>The "New Wizard" dialog shows a "Use wizard" checkbox.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-wizard1.png" alt="dtable wizard1">
</div>
<div class="title">Figure 341. Selecting the wizard</div>
</div>
</div>
<div class="sect5">
<h6 id="_drools.guideddecisiontableeditorwizardsummarypage"><a class="anchor" href="#_drools.guideddecisiontableeditorwizardsummarypage"></a><a class="link" href="#_drools.guideddecisiontableeditorwizardsummarypage">Summary page</a></h6>
<div class="paragraph">
<p>The summary page shows a few basic details about the decision table and allows the asset name to be changed.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-wizard2.png" alt="dtable wizard2">
</div>
<div class="title">Figure 342. Summary page</div>
</div>
</div>
<div class="sect5">
<h6 id="_drools.guideddecisiontableeditorwizardfactpatternspage"><a class="anchor" href="#_drools.guideddecisiontableeditorwizardfactpatternspage"></a><a class="link" href="#_drools.guideddecisiontableeditorwizardfactpatternspage">Add Fact Patterns page</a></h6>
<div class="paragraph">
<p>This page allows Fact types to be defined that will form the "When" columns of the rules.
Fact types that are available in the model will be shown in the left-hand listbox.
Select a Fact type and use the "&gt;&gt;" button to add it to the list of chosen facts on the right-hand listbox.</p>
</div>
<div class="paragraph">
<p>Removal is a similar process: the Fact that is no longer required can be selected in the right-hand listbox and the "&lt;&lt;" button used to remove it.
All Fact types need to be bound to a variable.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-wizard3.png" alt="dtable wizard3">
</div>
<div class="title">Figure 343. Add Fact Patterns page</div>
</div>
</div>
<div class="sect5">
<h6 id="_drools.guideddecisiontableeditorwizardaddconstraintpage"><a class="anchor" href="#_drools.guideddecisiontableeditorwizardaddconstraintpage"></a><a class="link" href="#_drools.guideddecisiontableeditorwizardaddconstraintpage">Add Constraints page</a></h6>
<div class="paragraph">
<p>This page allows field constraints on the Fact types the User has chosen to use in the decision table to be defined.</p>
</div>
<div class="paragraph">
<p>Fact types chosen on the previous Wizard page are listed in the right-hand listbox.
Selecting a Fact type by clicking on it will result in a list of available fields being shown in the middle listbox together with an option to create a predicate that do not require a specific field.</p>
</div>
<div class="paragraph">
<p>Fields can be added to the pattern’s constraints by clicking on the field and then the "&gt;&gt;" button. Fields can be removed from the pattern definition by clicking on the Condition in the right-hand listbox and then the "&lt;&lt;" button.</p>
</div>
<div class="paragraph">
<p>All fields need to have a column header and operator.</p>
</div>
<div class="paragraph">
<p>Incomplete fields will be highlighted and a warning message displayed.
The User will be unable to finish the definition until all warnings have been resolved.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-wizard4.png" alt="dtable wizard4">
</div>
<div class="title">Figure 344. Add Constraints page</div>
</div>
</div>
<div class="sect5">
<h6 id="_drools.guideddecisiontableeditorwizardupdatefactspage"><a class="anchor" href="#_drools.guideddecisiontableeditorwizardupdatefactspage"></a><a class="link" href="#_drools.guideddecisiontableeditorwizardupdatefactspage">Add Actions to update facts page</a></h6>
<div class="paragraph">
<p>Fact types that have been defined can be updated in the consequence, or action, part of a rule. This page allows such actions to be defined.</p>
</div>
<div class="paragraph">
<p>Fact types added to the decision table definition are listed in the left-hand listbox.
Selecting a Fact type by clicking on it will result in a list of available fields being shown in the middle listbox.</p>
</div>
<div class="paragraph">
<p>Fields that need to be updated by the rule can be added by selecting an available field and pressing the "&gt;&gt;" button. Fields can be removed similarly by clicking on a chosen field and then the "&lt;&lt;" button.</p>
</div>
<div class="paragraph">
<p>All actions require a column header.</p>
</div>
<div class="paragraph">
<p>Any incomplete actions will be highlighted and a warning message displayed.
The User will be unable to finish the definition until all warnings have been resolved.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-wizard5.png" alt="dtable wizard5">
</div>
<div class="title">Figure 345. Add Actions to update facts page</div>
</div>
</div>
<div class="sect5">
<h6 id="_drools.guideddecisiontableeditorwizardinsertfactspage"><a class="anchor" href="#_drools.guideddecisiontableeditorwizardinsertfactspage"></a><a class="link" href="#_drools.guideddecisiontableeditorwizardinsertfactspage">Add Actions to insert facts page</a></h6>
<div class="paragraph">
<p>Actions can also be defined to insert new Facts into the Rule Engine.</p>
</div>
<div class="paragraph">
<p>A list of Fact types available in the model are listed in the left-hand listbox.
Select those the User wishes to include in the decision table definition by clicking on them and pressing the “&gt;&gt;” button between the left most listbox and that titled "Chosen patterns".</p>
</div>
<div class="paragraph">
<p>Removal is a similar process whereby a chosen pattern can be selected and removed by pressing the “&lt;&lt;” button.</p>
</div>
<div class="paragraph">
<p>Selection of a chosen pattern presents the user with a list of available fields.
Fields that need to have values set by the action can be added by selecting them and pressing the “&gt;&gt;” button between the "Available fields" and "Chosen fields" listbox.</p>
</div>
<div class="paragraph">
<p>Removal is a similar process as already described.</p>
</div>
<div class="paragraph">
<p>New Facts need to be bound to a variable and have a column heading specified.</p>
</div>
<div class="paragraph">
<p>Incomplete Facts and\or fields will be highlighted and a warning message displayed.
The User will be unable to finish the definition until all warnings have been resolved.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-wizard6.png" alt="dtable wizard6">
</div>
<div class="title">Figure 346. Add Actions to insert facts page</div>
</div>
</div>
<div class="sect5">
<h6 id="_drools.guideddecisiontableeditorwizardexpandcolumnspage"><a class="anchor" href="#_drools.guideddecisiontableeditorwizardexpandcolumnspage"></a><a class="link" href="#_drools.guideddecisiontableeditorwizardexpandcolumnspage">Columns to expand page</a></h6>
<div class="paragraph">
<p>This page controls how the decision table, based upon Conditions defined on the prior pages, will be created.</p>
</div>
<div class="paragraph">
<p>Condition columns defined with an optional list of permitted values can be used to create rows in the decision table. Where a number of Condition columns have been defined with lists of permitted values the resulting table will contain a row for every combination of values; i.e.
the decision table will be in expanded form.</p>
</div>
<div class="paragraph">
<p>By default all Condition columns defined with value lists will be included in the expansion however the User is able to select a sub-set of columns if so required. This can be accomplished by unticking the "Fully expand" checkbox and adding columns to the right-hand listbox.</p>
</div>
<div class="paragraph">
<p>If no expansion is required untick the "Fully expand" checkbox and ensure zero columns are added to the right-hand listbox.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-wizard7.png" alt="dtable wizard7">
</div>
<div class="title">Figure 347. Columns to expand page</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditordefiningmanuallycolumns"><a class="anchor" href="#_drools.guideddecisiontableeditordefiningmanuallycolumns"></a><a class="link" href="#_drools.guideddecisiontableeditordefiningmanuallycolumns">21.4.2.3. Adding columns manually</a></h5>
<div class="paragraph">
<p>When choosing to create a table without the aid of the Wizard an empty table is first presented to the User. To add a column click on the "Add column" button to launch the "New column wizard".</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-add-column-wizard.png" alt="dtable add column wizard">
</div>
<div class="title">Figure 348. New column wizard</div>
</div>
<div class="sect5">
<h6 id="_drools.guideddecisiontableeditorsimplecolumns"><a class="anchor" href="#_drools.guideddecisiontableeditorsimplecolumns"></a><a class="link" href="#_drools.guideddecisiontableeditorsimplecolumns">Simple column types</a></h6>
<div class="paragraph">
<p>By default the "New column wizard" only shows the following simple types:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a simple Condition</p>
</li>
<li>
<p>Delete an existing fact</p>
</li>
<li>
<p>Set the value of a field</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_drools.guideddecisiontableeditorsimplecondition"><a class="anchor" href="#_drools.guideddecisiontableeditorsimplecondition"></a><a class="link" href="#_drools.guideddecisiontableeditorsimplecondition">Simple Condition</a></h7>
<div class="paragraph">
<p>Conditions represent constraints on Fact Patterns defined in the left-hand side, or "when" portion, of a rule. To define a condition column the User must first select or define a Fact Pattern bound to a model class.</p>
</div>
<div class="paragraph">
<p>The user can choose to negate the pattern.</p>
</div>
<div class="paragraph">
<p>Once this has been completed the User can define field constraints.</p>
</div>
<div class="paragraph">
<p>If two or more columns are defined using the same fact pattern binding the field constraints become composite field constraints on the same pattern.</p>
</div>
<div class="paragraph">
<p>If the User define multiple bindings for a single model class each binding becomes a separate model class in the left-hand side of the rule.</p>
</div>
<div class="paragraph">
<p>When the User edits or creates a new column, they will be given a choice of the type of constraint:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Literal : The value in the cell will be compared with the field using the operator.</p>
</li>
<li>
<p>Formula: The expression in the cell will be evaluated and then compared with the field.</p>
</li>
<li>
<p>Predicate : No field is needed, the expression will be evaluated to true or false.</p>
</li>
</ul>
</div>
<div class="sect7">
<h8 id="_drools.guideddecisiontableeditorotherwiseoperation"><a class="anchor" href="#_drools.guideddecisiontableeditorotherwiseoperation"></a><a class="link" href="#_drools.guideddecisiontableeditorotherwiseoperation">Operation of "otherwise"</a></h8>
<div class="paragraph">
<p>Condition columns defined with literal values that use either the equality (==) or inequality (!=) operators can take advantage of a special decision table cell value of "otherwise". This special value allows a rule to be defined that matches on all values not explicitly defined in all other rules defined in the table.
This is best illustrated with an example:-</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby"><span class="hljs-keyword">when</span>
  <span class="hljs-constant">Cheese</span>( name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">"Cheddar"</span>, <span class="hljs-string">"Edam"</span>, <span class="hljs-string">"Brie"</span>) )
  ...
<span class="hljs-keyword">then</span>
  ...
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby"><span class="hljs-keyword">when</span>
  <span class="hljs-constant">Cheese</span>( name <span class="hljs-keyword">in</span> (<span class="hljs-string">"Cheddar"</span>, <span class="hljs-string">"Edam"</span>, <span class="hljs-string">"Brie"</span>) )
  ...
<span class="hljs-keyword">then</span>
  ...
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_drools.guideddecisiontableeditordeletefact"><a class="anchor" href="#_drools.guideddecisiontableeditordeletefact"></a><a class="link" href="#_drools.guideddecisiontableeditordeletefact">Delete an existing fact</a></h7>
<div class="paragraph">
<p>An Action to delete a bound Fact.</p>
</div>
</div>
<div class="sect6">
<h7 id="_drools.decisiontablesetfield"><a class="anchor" href="#_drools.decisiontablesetfield"></a><a class="link" href="#_drools.decisiontablesetfield">Set the value of a field</a></h7>
<div class="paragraph">
<p>An Action to set the value of a field on previously bound fact or on a new instance of a fact.
The User has the option to notify the Rule Engine of the modified values which could lead to other rules being re-activated.</p>
</div>
<div class="paragraph">
<p>The User can choose to have the new Fact "logically inserted" meaning it will be automatically deleted should the conditions leading to the action being invoked cease to be true.</p>
</div>
<div class="paragraph">
<p>Please refer to the Drools Expert documentation for details on Truth Maintenance and Logical insertions.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_drools.guideddecisiontableeditoradvancedcolumns"><a class="anchor" href="#_drools.guideddecisiontableeditoradvancedcolumns"></a><a class="link" href="#_drools.guideddecisiontableeditoradvancedcolumns">Advanced column types</a></h6>
<div class="paragraph">
<p>Clicking on "Include advanced options" adds the following additional "advanced" column types for more advanced use cases:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a Condition BRL fragment</p>
</li>
<li>
<p>Add a new Attribute column</p>
</li>
<li>
<p>Add a new Metadata column</p>
</li>
<li>
<p>Add an Action BRL fragment</p>
</li>
<li>
<p>Execute a Work Item</p>
</li>
<li>
<p>Set the value of a field with a Work Item parameter</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="_drools.guideddecisiontableeditorconditionbrl"><a class="anchor" href="#_drools.guideddecisiontableeditorconditionbrl"></a><a class="link" href="#_drools.guideddecisiontableeditorconditionbrl">Condition BRL fragments</a></h7>
<div class="paragraph">
<p>A construct that allows a BRL fragment to be used in the left-hand side of a rule.
A BRL fragment is authored using the Guided Rule Editor and hence all features available in that editor can be used to define a decision table column; such as "from", "collect" and "accumulate" etc.</p>
</div>
<div class="paragraph">
<p>When using the embedded Guided Rule Editor field values defined as "Template Keys" will form columns in the decision table.</p>
</div>
<div class="paragraph">
<p>Facts and Fact’s fields bound in the BRL fragment can be referenced by the simpler column types and vice-versa.</p>
</div>
<div class="paragraph">
<p>In the following example two Template Keys have been defined and hence two columns appear in the decision table.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The User can use "Free Form DRL" to define Condition columns too.
If the User needs a place-holder for a variable in the DRL the User can use the Drools Templates syntax of <code>@{variable-name}</code> for example <code>Smurf( name = "@{name}" )</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-column-condition-brl1-popup.png" alt="dtable column condition brl1 popup">
</div>
<div class="title">Figure 349. Defining a Condition with BRL</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-column-condition-brl2-popup.png" alt="dtable column condition brl2 popup">
</div>
<div class="title">Figure 350. The resulting decision table</div>
</div>
</div>
<div class="sect6">
<h7 id="_drools.guideddecisiontableeditorattributecolumns"><a class="anchor" href="#_drools.guideddecisiontableeditorattributecolumns"></a><a class="link" href="#_drools.guideddecisiontableeditorattributecolumns">Attributes</a></h7>
<div class="paragraph">
<p>Zero or more attribute columns representing any of the DRL rule attributes (e.g.
salience, timer, enabled etc) can be added. An additional pseudo attribute is provide in the guided decision table editor to "negate" a rule. Use of this attribute allows complete rules to be negated. For example the following simple rule can be negated as also shown.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby"><span class="hljs-keyword">when</span>
  <span class="hljs-variable">$c</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Cheese</span>( name == <span class="hljs-string">"Cheddar"</span> )
<span class="hljs-keyword">then</span>
  ...
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby"><span class="hljs-keyword">when</span>
  <span class="hljs-keyword">not</span> <span class="hljs-constant">Cheese</span>( name == <span class="hljs-string">"Cheddar"</span> )
<span class="hljs-keyword">then</span>
  ...
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_drools.guideddecisiontableeditormetadatacolumns"><a class="anchor" href="#_drools.guideddecisiontableeditormetadatacolumns"></a><a class="link" href="#_drools.guideddecisiontableeditormetadatacolumns">Metadata</a></h7>
<div class="paragraph">
<p>Zero or more meta-data columns can be defined, each represents the normal meta-data annotation on DRL rules.</p>
</div>
</div>
<div class="sect6">
<h7 id="_drools.guideddecisiontableeditoractionbrl"><a class="anchor" href="#_drools.guideddecisiontableeditoractionbrl"></a><a class="link" href="#_drools.guideddecisiontableeditoractionbrl">Action BRL fragment</a></h7>
<div class="paragraph">
<p>A construct that allows a BRL fragment to be used in the right-hand side of a rule.
A BRL fragment is authored using the Guided Rule Editor and hence all features available in that editor can be used to define a decision table column.
When using the embedded Guided Rule Editor field values defined as "Template Keys" will form columns in the decision table.
Facts bound in the BRL fragment can be referenced by the simpler column types and vice-versa.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The user can use "Free Form DRL" to define Action columns too.
If the User needs a place-holder for a variable in the DRL they can use the Drools Templates syntax of <code>@{variable-name}</code> for example <code>$s.setName( "@{name}" )</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In the following example two Template Keys have been defined and hence two columns appear in the decision table.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-column-action-brl1-popup.png" alt="dtable column action brl1 popup">
</div>
<div class="title">Figure 351. Defining an Action with BRL</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-column-action-brl2-popup.png" alt="dtable column action brl2 popup">
</div>
<div class="title">Figure 352. The resulting decision table</div>
</div>
</div>
<div class="sect6">
<h7 id="_drools.guideddecisiontableeditorexecuteworkitem"><a class="anchor" href="#_drools.guideddecisiontableeditorexecuteworkitem"></a><a class="link" href="#_drools.guideddecisiontableeditorexecuteworkitem">Execute a Work Item</a></h7>
<div class="paragraph">
<p>An Action invoking a jBPM Work Item Handler setting its input parameters to bound Facts\Facts fields values.</p>
</div>
</div>
<div class="sect6">
<h7 id="_drools.guideddecisiontableeditorsetworkitemparameter"><a class="anchor" href="#_drools.guideddecisiontableeditorsetworkitemparameter"></a><a class="link" href="#_drools.guideddecisiontableeditorsetworkitemparameter">Set the value of a field with a Work Item parameter</a></h7>
<div class="paragraph">
<p>An Action setting the value of an existing Fact’s or new Fact’s field to that of a jBPM Work Item Handler’s result parameter.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Creation and editing of column definitions can be disabled for users by revoking permission "Edit Guided Decision Table columns". These users will still be able to modify the Decision Table data however they will be unable to change the Decision Table’s structure avoiding situations when they could accidentally break its functionality.</p>
</div>
<div class="paragraph">
<p>See <a href="#_wb.userandgroupmgmt">Security management</a> to check how to disable it in the general workbench permissions section.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditoreditcolumn"><a class="anchor" href="#_drools.guideddecisiontableeditoreditcolumn"></a><a class="link" href="#_drools.guideddecisiontableeditoreditcolumn">21.4.2.4. Editing columns</a></h5>
<div class="paragraph">
<p>To edit a column click on the "Edit columns" button to show existing column definitions. Clicking on "Edit" launches a window to edit the column definition. Clicking on "Delete" removes the column from the table.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-edit-column.png" alt="dtable edit column">
</div>
<div class="title">Figure 353. Edit column</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The definition of a column can also be found by hovering the mouse pointer over the column. A popup will appear showing a <em>hint</em> of the definition. It is considered a <em>hint</em> as all conditions have a dummy value interpolated.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-column-hint.png" alt="dtable column hint">
</div>
<div class="title">Figure 354. Column definition hint</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guideddecisiontableeditorhitpolicy"><a class="anchor" href="#_drools.guideddecisiontableeditorhitpolicy"></a><a class="link" href="#_drools.guideddecisiontableeditorhitpolicy">21.4.3. Hit Policy</a></h4>
<div class="paragraph">
<p>The hit policies decision table can use are similar to what the DMN specification has. Hit policies declare priorities between the rule rows and how many rules in the table can fire. All the hit policies can be replicated with setting the correct activation-group and salience values for each row, infact this is what the DRL underneath does.</p>
</div>
<div class="paragraph">
<p>The hit policy can only be set when the decision table is first created.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guided-dtable-selecting-hit-policy.png" alt="guided dtable selecting hit policy">
</div>
<div class="title">Figure 355. Selecting the Hit Policy</div>
</div>
<div class="paragraph">
<p>Once the table is viewed in the editor. The hit policy that is being used can be seen in the top left corner of the table.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guided-dtable-hit-policy.png" alt="guided dtable hit policy">
</div>
<div class="title">Figure 356. Hit Policy</div>
</div>
<div class="ulist">
<ul>
<li>
<p>U = Unique Hit
With unique hit policy each row has to be unique meaning there can be no overlap. There can never be a situation where two rows can fire, if there is the Verification feature warns about this on development time.</p>
</li>
<li>
<p>F = First Hit
First hit fires only one row, the one that is satisfied first from top to bottom.</p>
</li>
<li>
<p>RC = Resolved Hit
Similar to First Hit, but you can for example give row 10 priority over row 5. This means you can keep the order of the rows you want for visual readability, but specify priority exceptions.</p>
</li>
<li>
<p>R = Rule Order
Multiple rows can fire and Verification does not report about conflicts between the rows since they are expected to happen.</p>
</li>
<li>
<p># = None
This is the normal hit mode. Old decision tables will use this by default, but since 7.0 uses PHREAK the row order now matters. There is no migration tooling needed for the old tables. Multiple rows can fire. Verification warns about rows that conflict.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guideddecisiontableeditorauditlog"><a class="anchor" href="#_drools.guideddecisiontableeditorauditlog"></a><a class="link" href="#_drools.guideddecisiontableeditorauditlog">21.4.4. Audit Log</a></h4>
<div class="paragraph">
<p>An audit log has been added to the web-guided Decision Table editor to track additions, deletions and modifications.</p>
</div>
<div class="paragraph">
<p>By default the audit log is not configured to record any events, however, users can easily select the events in which they are interested.</p>
</div>
<div class="paragraph">
<p>The audit log is persisted whenever the asset is checked in.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guided-dtable-audit-log1.png" alt="guided dtable audit log1">
</div>
<div class="title">Figure 357. An empty audit log</div>
</div>
<div class="paragraph">
<p>Once the capture of events has been enabled all susbsequent operations are recorded.
Users are able to perform the following:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Record an explanatory note beside each event.</p>
</li>
<li>
<p>Delete an event from the log. Event details remain in the underlying repository.</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guided-dtable-audit-log2.png" alt="guided dtable audit log2">
</div>
<div class="title">Figure 358. Example of audit events</div>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guideddecisiontableeditorverification"><a class="anchor" href="#_drools.guideddecisiontableeditorverification"></a><a class="link" href="#_drools.guideddecisiontableeditorverification">21.4.5. Real Time Validation and Verification</a></h4>
<div class="paragraph">
<p>Decision tables are validated after each cell change.
If any issues are found the results will be shown in the column on the right side of the table.
Validation and verification covers the following issues:</p>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditorverificationredundancy"><a class="anchor" href="#_drools.guideddecisiontableeditorverificationredundancy"></a><a class="link" href="#_drools.guideddecisiontableeditorverificationredundancy">21.4.5.1. Redundancy</a></h5>
<div class="paragraph">
<p>Redundancy exists between two rows when both rows execute the same actions when given the same set of facts.</p>
</div>
<div class="paragraph">
<p>Redundancy might not be a problem if the redundant rules are setting a value on an existing fact, this just sets the value twice.
Problems occur when the two rules increase a counter or add more facts into the working memory, since this causes unwanted side effects.
In both cases the other row is not needed.</p>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditorverificationsubsumption"><a class="anchor" href="#_drools.guideddecisiontableeditorverificationsubsumption"></a><a class="link" href="#_drools.guideddecisiontableeditorverificationsubsumption">21.4.5.2. Subsumption</a></h5>
<div class="paragraph">
<p>Subsumption exists when one row executes the same action as another row when given the same set of facts.
The rows are not redundant since the another row is more complicated and it can fire with a set of facts that do not fire the subsumptant row.</p>
</div>
<div class="paragraph">
<p>The problems with subsumption are similar to the case with redundancy.</p>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditorverificationconflicts"><a class="anchor" href="#_drools.guideddecisiontableeditorverificationconflicts"></a><a class="link" href="#_drools.guideddecisiontableeditorverificationconflicts">21.4.5.3. Conflicts</a></h5>
<div class="paragraph">
<p>Conflicts can exist either on a single row or between rows.</p>
</div>
<div class="paragraph">
<p>A single row conflict prevents the row actions from ever being executed.</p>
</div>
<div class="paragraph">
<p>Conflict between two rows exists when the conditions of two rules are met with a same set of facts, but the actions set fact fields to different values.
The conditions can be redundant or just subsumptant.
Conflicts are a problem because it is impossible to know what action is made last.
Conditions might set a loan to both approbed and rejected.
The end result may be different on each time the rules are ran and with each rule engine software version.</p>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditorverificationmissingrhslhs"><a class="anchor" href="#_drools.guideddecisiontableeditorverificationmissingrhslhs"></a><a class="link" href="#_drools.guideddecisiontableeditorverificationmissingrhslhs">21.4.5.4. Missing Columns</a></h5>
<div class="paragraph">
<p>In some cases, usually by accident, the user can delete all the condition or action columns.
When the conditions are removed all the actions are executed and when the actions columns are missing the rows do nothing.</p>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guideddecisiontableeditorverificationmissinrange"><a class="anchor" href="#_drools.guideddecisiontableeditorverificationmissinrange"></a><a class="link" href="#_drools.guideddecisiontableeditorverificationmissinrange">21.4.5.5. Range Checks</a></h5>
<div class="paragraph">
<p>Range checks help you to make more complete Decision Tables. They check if the table contains constraints against all the possible values a field can have. Once the table is complete any given set of facts will have an action.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guideddecisiontablegrapheditor"><a class="anchor" href="#_drools.guideddecisiontablegrapheditor"></a><a class="link" href="#_drools.guideddecisiontablegrapheditor">21.5. Guided Decision Table Graphs</a></h3>
<div class="paragraph">
<p>Whilst it is possible to author single Guided Decision Tables it is also possible to author a graph of related tables where an action of one may provide a potential match for a condition of another. In this scenario the tables are said to be related.</p>
</div>
<div class="sect3">
<h4 id="_editor"><a class="anchor" href="#_editor"></a><a class="link" href="#_editor">21.5.1. Editor</a></h4>
<div class="paragraph">
<p>The editor itself preserves all the features of the Guided Decision Table Editor merely adding the ability to visualise multiple tables and their relationships in a single view. Selecting a single table leads to the column definitions panel, Source and Data Objects tabs being updated to reflect the selected table. Validation &amp; Verification reporting is also updated to reflect the selected table. The Overview tab maintains state of the graph as a whole.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-graph-radar.png" alt="dtable graph radar">
</div>
<div class="title">Figure 359. Graph editor and radar</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_new_graph"><a class="anchor" href="#_creating_a_new_graph"></a><a class="link" href="#_creating_a_new_graph">21.5.2. Creating a new graph</a></h4>
<div class="paragraph">
<p>When a new "Guided Decision Table Graph" is first created the target package is scanned for existing single Guided Decision Tables. Those found are checked for relationships and, if any exist, added automatically to the new graph.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_new_tables_to_the_graph"><a class="anchor" href="#_adding_new_tables_to_the_graph"></a><a class="link" href="#_adding_new_tables_to_the_graph">21.5.3. Adding new tables to the graph</a></h4>
<div class="paragraph">
<p>Tables can be added to the graph by clicking on the "Documents…​" menu entry. This reveals a tool panel that lists the tables already part of the graph. The same panel gives the User the ability to either add a new table or open an existing table.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-documents-selector.png" alt="dtable documents selector">
</div>
<div class="title">Figure 360. Documents popup</div>
</div>
<div class="sect4">
<h5 id="_adding_new_tables"><a class="anchor" href="#_adding_new_tables"></a><a class="link" href="#_adding_new_tables">21.5.3.1. Adding new tables</a></h5>
<div class="paragraph">
<p>Clicking on "New…​" launches the New Guided Decision Table Wizard. On completion of the Wizard the new table will be added to the graph and any relationships automatically added.</p>
</div>
</div>
<div class="sect4">
<h5 id="_adding_existing_tables"><a class="anchor" href="#_adding_existing_tables"></a><a class="link" href="#_adding_existing_tables">21.5.3.2. Adding existing tables</a></h5>
<div class="paragraph">
<p>Clicking on "Open…​" reveals a file selector wherefrom one or more existing Guided Decision Tables can be selected and added to the graph. If no additional Guided Decision Tables are found a message is shown to the User.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/dtable-documents-open.png" alt="dtable documents open">
</div>
<div class="title">Figure 361. Documents popup - Opening existing</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_removing_tables"><a class="anchor" href="#_removing_tables"></a><a class="link" href="#_removing_tables">21.5.4. Removing tables</a></h4>
<div class="paragraph">
<p>Tables can be removed from the graph by opening the "Documents…​" panel and clicking on the "X" icon beside the table. Tables removed from the graph are not deleted from the Project and can continue to be edited by the Gudied Decision Table Editor.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guideddecisiontreeeditor"><a class="anchor" href="#_drools.guideddecisiontreeeditor"></a><a class="link" href="#_drools.guideddecisiontreeeditor">21.6. Guided Decision Trees</a></h3>
<div class="paragraph">
<p>The Workbench supports authoring of simple Decision Trees.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The editor does not support nested Data Objects at present.
It is therefore advised to only use Guided Decision Trees with flat Data Object models.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_the_initial_editor_layout"><a class="anchor" href="#_the_initial_editor_layout"></a><a class="link" href="#_the_initial_editor_layout">21.6.1. The initial editor layout</a></h4>
<div class="paragraph">
<p>When a new Guided Decision Tree is created the editor is initially blank.</p>
</div>
<div class="paragraph">
<p>The left-hand side is a palette of available Data Objects, their fields and Actions.</p>
</div>
<div class="paragraph">
<p>The right-hand side is the area where you can drag and drop Data Objects, their fields or Actions to build a tree.</p>
</div>
<div class="paragraph">
<p>The editor will show a connector between the node being dragged and applicable children to which it can be attached.
When the drag is complete the new node will be attached to the applicable child.
Root nodes will not have a connector shown when being dragged to an empty tree.
Completing the drag positions the root node in the centre of the editor.</p>
</div>
<div class="paragraph">
<p>There are various restrictions when composing a tree:-</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A tree must have a Data Object at the root.</p>
</li>
<li>
<p>A tree can only have one root.</p>
</li>
<li>
<p>Data Objects can have either other Data Objects, field constraints or Actions as children.</p>
<div class="paragraph">
<p>The field constraints must be on fields of the same Data Object as the parent node.</p>
</div>
</li>
<li>
<p>Field constraints can have either other field constraints or Actions as children.</p>
<div class="paragraph">
<p>The field constraints must be on fields of the same Data Object as the parent node.</p>
</div>
</li>
<li>
<p>Actions can only have other Actions as children.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditor1.png" alt="GuidedDecisionTreeEditor1">
</div>
<div class="title">Figure 362. Guided Decision Trees - Empty editor</div>
</div>
<div class="paragraph">
<p>Expanding the palette reveals Tree Nodes for the Data Object and its fields.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditor2.png" alt="GuidedDecisionTreeEditor2">
</div>
<div class="title">Figure 363. Guided Decision Trees - Expanded palette</div>
</div>
</div>
<div class="sect3">
<h4 id="_first_steps"><a class="anchor" href="#_first_steps"></a><a class="link" href="#_first_steps">21.6.2. First steps</a></h4>
<div class="paragraph">
<p>Drag a Data Object on to the tree authoring area.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditor3.png" alt="GuidedDecisionTreeEditor3">
</div>
<div class="title">Figure 364. Guided Decision Trees - Data Object root node</div>
</div>
<div class="paragraph">
<p>Clicking on a node selects it.</p>
</div>
<div class="paragraph">
<p>Icons to manipulate the node appear when the node is selected.</p>
</div>
<div class="paragraph">
<p>The icons are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete</p>
<div class="paragraph">
<p>Deleting a node will also delete all children.</p>
</div>
</li>
<li>
<p>Edit</p>
<div class="paragraph">
<p>Collapsed nodes cannot be edited as they contain numerous children.</p>
</div>
</li>
<li>
<p>Collapse</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditor4.png" alt="GuidedDecisionTreeEditor4">
</div>
<div class="title">Figure 365. Guided Decision Trees - Selected node</div>
</div>
</div>
<div class="sect3">
<h4 id="_editing_data_object_nodes"><a class="anchor" href="#_editing_data_object_nodes"></a><a class="link" href="#_editing_data_object_nodes">21.6.3. Editing Data Object nodes</a></h4>
<div class="paragraph">
<p>Selecting a Data Object node and clicking the edit icon shows a popup to manage the node.</p>
</div>
<div class="paragraph">
<p>The popup shows the Data Object type and allows it to be bound to a variable.
Bound Data Objects can be modified or retracted by Actions.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditor5.png" alt="GuidedDecisionTreeEditor5">
</div>
<div class="title">Figure 366. Guided Decision Trees - Data Object Editor</div>
</div>
</div>
<div class="sect3">
<h4 id="_editing_field_constraint_nodes"><a class="anchor" href="#_editing_field_constraint_nodes"></a><a class="link" href="#_editing_field_constraint_nodes">21.6.4. Editing Field Constraint nodes</a></h4>
<div class="paragraph">
<p>Selecting a Field Constraint node and clicking the edit icon shows a popup to manage the node.</p>
</div>
<div class="paragraph">
<p>The popup shows the Data Object type and field and allows the field to be bound to a variable.
An operator, applicable to the Data Model field’s data-type, can be selected and a corresponding value entered.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditor6.png" alt="GuidedDecisionTreeEditor6">
</div>
<div class="title">Figure 367. Guided Decision Trees - Field Constraint Editor</div>
</div>
</div>
<div class="sect3">
<h4 id="_editing_action_nodes"><a class="anchor" href="#_editing_action_nodes"></a><a class="link" href="#_editing_action_nodes">21.6.5. Editing Action nodes</a></h4>
<div class="paragraph">
<p>Selecting an Insert Action node and clicking the edit icon shows a popup to manage the node.</p>
</div>
<div class="paragraph">
<p>The popup allows selection of the Data Object to be inserted and whether it’s insertion is "logical". Please refer to Drools documentation regarding Truth Maintenance for more information.
Fields for the new Data Object can have values set.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditorActionInsert.png" alt="GuidedDecisionTreeEditorActionInsert">
</div>
<div class="title">Figure 368. Guided Decision Trees - Action "Insert" Editor</div>
</div>
<div class="paragraph">
<p>Selecting an Insert Retract node and clicking the edit icon shows a popup to manage the node.</p>
</div>
<div class="paragraph">
<p>The popup allows any Data Object bound in the path from the selected node to the root node to be selected for retraction.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditorActionRetract.png" alt="GuidedDecisionTreeEditorActionRetract">
</div>
<div class="title">Figure 369. Guided Decision Trees - Action "Retract" Editor</div>
</div>
<div class="paragraph">
<p>Selecting an Insert Update node and clicking the edit icon shows a popup to manage the node.</p>
</div>
<div class="paragraph">
<p>The popup allows any Data Object bound in the path from the selected node to the root node to be modified.
Fields for the modified Data Object can have values set.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditorActionUpdate.png" alt="GuidedDecisionTreeEditorActionUpdate">
</div>
<div class="title">Figure 370. Guided Decision Trees - Action "Update" Editor</div>
</div>
</div>
<div class="sect3">
<h4 id="_managing_the_tree"><a class="anchor" href="#_managing_the_tree"></a><a class="link" href="#_managing_the_tree">21.6.6. Managing the tree</a></h4>
<div class="paragraph">
<p>Even simple trees can grow in size and become difficult to maintain.</p>
</div>
<div class="paragraph">
<p>It is therefore possible to collapse parts of the tree, giving more space in the user interface to maintain different parts of the tree.</p>
</div>
<div class="paragraph">
<p>If a node has children, when selected, it will have an icon to collapse the children.
Clicking this icon will collapse children.</p>
</div>
<div class="paragraph">
<p>A collapsed node can equally be expanded by selecting it and clicking on the exapnd icon.
A collapsed node cannot be edited as it contains numerous children.
Deleting a collapsed node deletes all children too.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditorCollapse1.png" alt="GuidedDecisionTreeEditorCollapse1">
</div>
<div class="title">Figure 371. Guided Decision Trees - Collapsing nodes</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GuidedDecisionTreeEditorCollapse2.png" alt="GuidedDecisionTreeEditorCollapse2">
</div>
<div class="title">Figure 372. Guided Decision Trees - Collapsed node</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.xlsdecisiontable"><a class="anchor" href="#_drools.xlsdecisiontable"></a><a class="link" href="#_drools.xlsdecisiontable">21.7. Spreadsheet decision tables</a></h3>
<div class="paragraph">
<p>Multiple rules can be stored in a spreadsheet. Each row in the spreadsheet is a rule, and each column is either a condition, an action, or an option. The Drools Expert section of this document discusses spreadsheet decision tables in more detail.</p>
</div>
<div class="paragraph">
<p>To use a spreadsheet, you upload an XLS or XLSX file. To create a new decision table: launch the new "Decision Table (Spreadsheet)" wizard, you will get an option to upload one.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DecisionTable.png" alt="DecisionTable">
</div>
<div class="title">Figure 373. Spreadsheet decision table</div>
</div>
<div class="sect3">
<h4 id="_convert_to_guided_decision_table"><a class="anchor" href="#_convert_to_guided_decision_table"></a><a class="link" href="#_convert_to_guided_decision_table">21.7.1. Convert to Guided Decision Table</a></h4>
<div class="paragraph">
<p>XLS Decision Tables can be converted to Guided Decision Tables by clicking on the "Convert" menu item in the XLS Decision Table Editor. One or more files will be created depending on the content of the XLS file. Results of the conversion are reported to the User.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DecisionTable-conversion-results.png" alt="DecisionTable conversion results">
</div>
<div class="title">Figure 374. Spreadsheet conversion results</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The format of <code>Date</code> fields in the XLS file must adhere to the format configured for Drools and set by the System Property <code>drools.dateformat</code>. The default setting is <code>dd-MMM-yyyy</code></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.guidedscorecardeditor"><a class="anchor" href="#_drools.guidedscorecardeditor"></a><a class="link" href="#_drools.guidedscorecardeditor">21.8. Scorecards</a></h3>
<div class="paragraph">
<p>A scorecard is a graphical representation of a formula used to calculate an overall score.
A scorecard can be used to predict the likelihood or probability of a certain outcome.
Drools now supports additive scorecards.
An additive scorecard calculates an overall score by adding all partial scores assigned to individual rule conditions.</p>
</div>
<div class="paragraph">
<p>Additionally, Drools Scorecards will allows for reason codes to be set, which help in identifying the specific rules (buckets) that have contributed to the overall score.
Drools Scorecards will be based on the PMML 4.1 Standard.</p>
</div>
<div class="paragraph">
<p>The New Item menu now allows for creation of scorecard assets.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/scorecard_asset_webeditor.png" alt="scorecard asset webeditor">
</div>
<div class="title">Figure 375. Scorecard Asset - Guided Editor</div>
</div>
<div class="paragraph">
<p>The above image shows a scorecard with one characteristic.
Each scorecard consists of two sections (a) Setup Parameters (b) Characteristic Section</p>
</div>
<div class="sect3">
<h4 id="_drools.guidedscorecardeditorsetupparameters"><a class="anchor" href="#_drools.guidedscorecardeditorsetupparameters"></a><a class="link" href="#_drools.guidedscorecardeditorsetupparameters">21.8.1. (a) Setup Parameters</a></h4>
<div class="paragraph">
<p>The setup section consits of parameters that define the overall behaviour of this scorecard.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Facts: This dropdown shows a list of facts that are visible for this asset.</p>
</li>
<li>
<p>Resultant Score Field: Shows a list of fields from the selected fact. Only fields of type 'double' are shown. If this dropdown is empty double check your fact model. The final calculated score will be stored in this field.</p>
</li>
<li>
<p>Initial Score: Numeric Text Field to capture the initial score. The generated rules will initialize the 'Resultant Score Field' with this score and then is added to the overall score whenever partial scores are summed up.</p>
</li>
<li>
<p>Use Reason Codes: Boolean indicator to compute reason codes along with the final score. Selecting Yes/No in this field will enable/disable the 'Resultant Reason Codes Field', 'Reason Code Algorithm' and the 'Baseline Score' field.</p>
</li>
<li>
<p>Resultant Reason Codes Field: Shows a list of fields from the selected fact. Only fields of type 'java.util.List' are shown. This collection will hold the reason codes selected by this scorecard.</p>
</li>
<li>
<p>Reason Code Algorithm: May be "none", "pointsAbove" or "pointsBelow", describing how reason codes shall be ranked, relative to the baseline score of each Characteristic, or as set at the top-level scorecard.</p>
</li>
<li>
<p>Baseline Score: A single value to use as the baseline comparison score for all characteristics, when determining reason code ranking. Alternatively, unique baseline scores may be set for each individual Characteristic as shown below. This value is required only when UseReasonCodes is "true" and baselineScore is not given for each Characteristic.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If UseReasonCodes is "true", then BaselineScore must be defined at the Scorecard level or for each Characteristic, and ReasonCode must be provided for each Characteristic or for each of its input Attributes.
If UseReasonCodes is "false", then baselineScore and reasonCode are not required.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_drools.guidedscorecardeditorcharacteristics"><a class="anchor" href="#_drools.guidedscorecardeditorcharacteristics"></a><a class="link" href="#_drools.guidedscorecardeditorcharacteristics">21.8.2. (b) Characteristics</a></h4>
<div class="paragraph">
<p>On Clicking the 'New Characteristic' button, a new empty characteristic editor is added to the scorecard.
Defines the point allocation strategy for each scorecard characteristic (numeric or categorical). Each scorecard characteristic is assigned a single partial score which is used to compute the overall score.
The overall score is simply the sum of all partial scores.
Partial scores are assumed to be continuous values of type "double".</p>
</div>
<div class="sect4">
<h5 id="_drools.guidedscorecardeditorcreatingcharacteristics"><a class="anchor" href="#_drools.guidedscorecardeditorcreatingcharacteristics"></a><a class="link" href="#_drools.guidedscorecardeditorcreatingcharacteristics">21.8.2.1. Creating Characterstics</a></h5>
<div class="paragraph">
<p>Every scorecard must have at least one characteristic</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/scorecards_new_characteristic.png" alt="scorecards new characteristic">
</div>
<div class="title">Figure 376. New Characteristic</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Name: Descriptive name for this characteristic. For informational reasons only.</p>
</li>
<li>
<p>Remove Charteristic: Will remove this characteristic from the scorecard after a confirmation dialog is shown.</p>
</li>
<li>
<p>Add Attribute: Will add a line entry for an attribute (bin).</p>
</li>
<li>
<p>Fact: Select the class which will be evaluated for calculating the partial score.</p>
</li>
<li>
<p>Characteristic: Shows the list of fields from the selected Fact. Only fields of type "String", "int", "double", "boolean" are shown.</p>
</li>
<li>
<p>Baseline Score: Sets the characteristic’s baseline score against which to compare the actual partial score when determining the ranking of reason codes. This value is required when useReasonCodes attribute is "true" and baselineScore is not defined in element Scorecard. Whenever baselineScore is defined for a Characteristic, it takes precedence over the baselineScore value defined in element Scorecard.</p>
</li>
<li>
<p>Reason Code: Contains the characteristic’s reason code, usually associated with an adverse decision.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_drools.guidedscorecardeditorcreatingattributes"><a class="anchor" href="#_drools.guidedscorecardeditorcreatingattributes"></a><a class="link" href="#_drools.guidedscorecardeditorcreatingattributes">21.8.2.2. Creating Attributes</a></h5>
<div class="paragraph">
<p>On Clicking the 'New Attribute' button, a new empty attribute editor.
In scorecard models, all the elements defining the Attributes for a particular Characteristic must all reference a single field.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/scorecards_new_attribute.png" alt="scorecards new attribute">
</div>
<div class="title">Figure 377. New Attribute</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Operator: The condition upon which the mapping between input attribute and partial score takes place. The operator dropdown will show different values depending on the datatype of the selected Field.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>DataType Strings: "=", "in".</p>
</li>
<li>
<p>DataType Integers: "=", "&gt;", "&lt;", "&gt;=", "⇐", "&gt;..&lt;", "&gt;=..&lt;", "&gt;=..⇐", "&gt;..⇐".</p>
</li>
<li>
<p>DataType Boolean: "true", "false".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Refer to the next sub-section (values) for more details.</p>
</div>
</li>
<li>
<p>Value: Basis the operator selected the value specified can either be a single value or a set of values separated by comma (","). The value field is disabled for operator type boolean.</p>
<div class="paragraph">
<p></p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 44. Operators / Values</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remarks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">will look for an exact match</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated Values (a,b,c,…​)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operator 'in' indicates an evaluation to TRUE if the field value is contained in the comma separated list of values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value Field is uneditable (readonly)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">is false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value Field is uneditable (readonly)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equals Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greator Than Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less Than Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal To</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than or equal To</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;..&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated Values (a,b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Greater than Value 'a') and (less than value 'b')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=..&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated Values (a,b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Greater than or equal to Value 'a') and (less than value 'b')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=..&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated Values (a,b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Greater than or equal to Value 'a') and (less than or equal to value 'b')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numeric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;..&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma Separated Values (a,b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Greater than Value 'a') and (less than or equal to value 'b')</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Partial Score: Defines the score points awarded to the Attribute.</p>
</li>
<li>
<p>Reason Code: Defines the attribute’s reason code. If the reasonCode attribute is used in this level, it takes precedence over the ReasonCode associated with the Characteristic element.</p>
</li>
<li>
<p>Actions: Delete this attribute. Prompts the user for confirmation.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If Use Reason Codes is "true", then Baseline Score must be defined at the Scorecard level or for each Characteristic, and Reason Code must be provided for each Characteristic or for each of its input Attributes.
If Use Reason Codes is "false", then BaselineScore and ReasonCode are not required.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.testscenarioeditor"><a class="anchor" href="#_drools.testscenarioeditor"></a><a class="link" href="#_drools.testscenarioeditor">21.9. Test Scenario</a></h3>
<div class="paragraph">
<p>Test Scenarios are used to validate that rules and knowledge base work as expected.
When the knowledge base evolves, Test Scenarios guard against regression.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/TestScenario.png" alt="TestScenario">
</div>
<div class="title">Figure 378. Example Test Scenario</div>
</div>
<div class="paragraph">
<p>Given section lists the facts needed for the behaviour.
Expect section lists the expected changes and actions done by the behaviour.
Given facts are passed for the Test Scenario before execution.
During the rule execution, changes in the knowledge base are recorded.
After the execution ends the recorded actions, existing facts in the knowledge base and knowledge base output is compared against the expectations.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/TestScenarioAfterRunningIt.png" alt="TestScenarioAfterRunningIt">
</div>
<div class="title">Figure 379. Example Test Scenario after execution</div>
</div>
<div class="sect3">
<h4 id="_drools.ksessionselector"><a class="anchor" href="#_drools.ksessionselector"></a><a class="link" href="#_drools.ksessionselector">21.9.1. Knowledge Session Selector</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KSessionSelector.png" alt="KSessionSelector">
</div>
<div class="title">Figure 380. Knowledge Session Selector</div>
</div>
<div class="paragraph">
<p>Knowledge session selector is used to select the session that the rules are ran against.
The knowledge session needs to be stateful and use the pseudo clock when simulated time is used.
Knowledge sessions are defined in the Project Editor, in the Knowledge bases and Sessions section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_drools.testscenarioeditorgivensection"><a class="anchor" href="#_drools.testscenarioeditorgivensection"></a><a class="link" href="#_drools.testscenarioeditorgivensection">21.9.2. Given Section</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/GivenSection.png" alt="GivenSection">
</div>
<div class="title">Figure 381. Given popup</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Insert a new fact - Adds a new fact that will be inserted into the knowledge base before execution.</p>
</li>
<li>
<p>Modify an existing fact - Allows editing a fact between knowledge base executions.</p>
</li>
<li>
<p>Delete an existing fact - Allows removing facts between executions.</p>
</li>
<li>
<p>Activate rule flow group - Allows rules from a rule flow group to be tested, by activating the group in advance.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_drools.testscenarioeditorexpectedsection"><a class="anchor" href="#_drools.testscenarioeditorexpectedsection"></a><a class="link" href="#_drools.testscenarioeditorexpectedsection">21.9.3. Expect Section</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ExpectSection.png" alt="ExpectSection">
</div>
<div class="title">Figure 382. Expect popup</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Rule - Validate that a certain rule fired.</p>
</li>
<li>
<p>Fact value - Validate fact values for a fact created in the Given section.</p>
</li>
<li>
<p>Any fact that matches - Validate that there is at least one fact in the knowledge base with the specified field values.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_drools.testscenarioeditorglobalsection"><a class="anchor" href="#_drools.testscenarioeditorglobalsection"></a><a class="link" href="#_drools.testscenarioeditorglobalsection">21.9.4. Global Section</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewGlobal.png" alt="NewGlobal">
</div>
<div class="title">Figure 383. Global popup</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Global - Validate that the global field values.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_drools.testscenarioeditorinpuotsection"><a class="anchor" href="#_drools.testscenarioeditorinpuotsection"></a><a class="link" href="#_drools.testscenarioeditorinpuotsection">21.9.5. New Input Section</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/NewInput.png" alt="NewInput">
</div>
<div class="title">Figure 384. New Input popup</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Call method on an existing fact - Call a method from a fact in the beginning of the rule execution.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.dsleditor"><a class="anchor" href="#_drools.dsleditor"></a><a class="link" href="#_drools.dsleditor">21.10. DSL editor</a></h3>
<div class="paragraph">
<p>The DSL editor allows DSL Sentences to be authored.
The reader should take time to explore DSL features in the Drools Expert documentation; as the syntax in Drools Workbench’s DSL Editor is identical.
The normal syntax is extended to provide "hints" to control how the DSL variable is rendered and validated within the user-interface.</p>
</div>
<div class="paragraph">
<p>The following "hints" are supported:-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{&lt;varName&gt;:&lt;regular expression&gt;}</p>
<div class="paragraph">
<p>This will render a text field in place of the DSL variable when the DSL Sentence is used in the guided editor.
The content of the text field will be validated against the regular expression.</p>
</div>
</li>
<li>
<p>{&lt;varName&gt;:ENUM:&lt;factType.fieldName&gt;}</p>
<div class="paragraph">
<p>This will render an enumeration in place of the DSL variable when the DSL Sentence is used in the guided editor.
&lt;factType.fieldName&gt; binds the enumeration to the model Fact and Field enumeration definition.
This could be either a "Drools Workbench enumeration" (i.e.
defined within the Workbench) or a Java enumeration (i.e.
defined in a model POJO JAR file).</p>
</div>
</li>
<li>
<p>{&lt;varName&gt;:DATE:&lt;dateFormat&gt;}</p>
<div class="paragraph">
<p>This will render a Date selector in place of the DSL variable when the DSL Sentence is used in the guided editor.</p>
</div>
</li>
<li>
<p>{&lt;varName&gt;:BOOLEAN:&lt;[checked | unchecked]&gt;}</p>
<div class="paragraph">
<p>This will render a dropdown selector in place of the DSL variable, providing boolean choices, when the DSL Sentence is used in the guided editor.</p>
</div>
</li>
<li>
<p>{&lt;varName&gt;:CF:&lt;factType.fieldName&gt;}</p>
<div class="paragraph">
<p>This will render a button that will allow you to set the value of this variable using a Custom Form.
In order to use this feature, a  Working-Set containing a Custom Form Configuration for factType.fieldName must be active.
If there is no such Working-Set, a simple text box is used (just like a regular variable).</p>
</div>
<div class="paragraph">
<p>For more information, please read more about Working-Sets and Custom Form Configurations.</p>
</div>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DSLEditor.png" alt="DSLEditor">
</div>
<div class="title">Figure 385. DSL rule</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.enumerationeditor"><a class="anchor" href="#_drools.enumerationeditor"></a><a class="link" href="#_drools.enumerationeditor">21.11. Data enumerations (drop down list configurations)</a></h3>
<div class="paragraph">
<p>Data enumerations are an optional asset type that technical folk can configure to provide drop down lists for the guided editor.
These are stored and edited just like any other asset, and apply to the package that they belong to.</p>
</div>
<div class="paragraph">
<p>The contents of an enum config are a mapping of <code>Fact.field</code> to a list of values to be used in a drop down.
The strings are either a value to be shown in a drop down, or a mapping from the code value (what ends up used in the rule) and a display value.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/EnumConfig.png" alt="EnumConfig">
</div>
<div class="title">Figure 386. Data enumeration</div>
</div>
<div class="paragraph">
<p>If you wish to use a mapping between value used in the rule and the value shown in the UI you need to separate the code value and display value with an equals sign.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-string">'Person.gender'</span> : [<span class="hljs-string">'M=Male'</span>,<span class="hljs-string">'F=Female'</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example <code>F</code> will be used in the rules but <code>Female</code> shown in the UI.</p>
</div>
<div class="paragraph">
<p>Drop down lists can also depend on other field values.</p>
</div>
<div class="paragraph">
<p>Lets imagine a simple fact model, we have a class called Vehicle, which has 2 fields: <code>engineType</code> and <code>fuelType</code>.
We want to have a choice for the <code>engineType</code> of "Petrol" or "Diesel". Now, obviously the choice type for fuel must be dependent on the engine type (so for Petrol we have ULP and PULP, and for Diesel we have BIO and NORMAL). We can express this dependency in an enumeration as:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/EnumVehicleEngine.png" alt="EnumVehicleEngine">
</div>
</div>
<div class="paragraph">
<p>This shows how it is possible to make the choices dependent on other field values.
Note that once you pick the engineType, the choice list for the fuelType will be determined.</p>
</div>
<div class="sect3">
<h4 id="_drools.advancedenumconcepts"><a class="anchor" href="#_drools.advancedenumconcepts"></a><a class="link" href="#_drools.advancedenumconcepts">21.11.1. Advanced enumeration concepts</a></h4>
<div class="paragraph">
<p>There are a few other advanced things you can do with data enumerations.</p>
</div>
<div class="sect4">
<h5 id="_drools.advanceenumconcepts.external"><a class="anchor" href="#_drools.advanceenumconcepts.external"></a><a class="link" href="#_drools.advanceenumconcepts.external">21.11.1.1. External data-sources</a></h5>
<div class="paragraph">
<p>Instead of defining a static list you can retrieve the list from an external data-source by using a helper class.</p>
</div>
<div class="paragraph">
<p>The helper class must be on the Project’s classpath; by adding a JAR containng the class as a project dependency.
The helper class must be instantiable and have a non-static method that returns a <code>java.util.List</code>.
Population of the list is implementation specific.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript"><span class="hljs-string">'Person.age'</span> : (<span class="hljs-keyword">new</span> org.yourco.DataHelper()).getListOfAges()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In some other cases you may want to load the enumeration data entirely from an external data source (such as a relational database). To do this, you can implement a class that returns a <code>Map&lt;String, List&lt;String&gt;&gt;</code>.
The key of the map is the <code>Fact.field</code>  and the value is a <code>java.util.List&lt;String&gt;</code> of values to be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SampleDataSource2</span> </span>{

  <span class="hljs-keyword">public</span> Map&lt;String&gt;, <span class="hljs-function">List&lt;String&gt; <span class="hljs-title">loadData</span><span class="hljs-params">()</span> </span>{
    Map data = <span class="hljs-keyword">new</span> HashMap();

    List d = <span class="hljs-keyword">new</span> ArrayList();
    d.add(<span class="hljs-string">"value1"</span>);
    d.add(<span class="hljs-string">"value2"</span>);
    data.put(<span class="hljs-string">"Fact.field"</span>, d);

    <span class="hljs-keyword">return</span> data;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The enumeration definition would simply be as follows (with no reference to fact or field names):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">=(<span class="hljs-keyword">new</span> SampleDataSource2()).loadData()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>=</code> operator informs the workbench to load all enumeration data from the helper class.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The helper methods will be statically evaluated when the enumeration definition is requested for use in an editor.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_drools.advanceenumconcepts.dynamic"><a class="anchor" href="#_drools.advanceenumconcepts.dynamic"></a><a class="link" href="#_drools.advanceenumconcepts.dynamic">21.11.1.2. Dynamic lookup</a></h5>
<div class="paragraph">
<p>All of the above cases retrieve the list of values by statically evaluating the enumeration definition when enumerations are required by an editor.</p>
</div>
<div class="paragraph">
<p>It is also possible to load dependent enumeration definitions dynamically from a helper class by enclosing the call to the helper class within quotation marks.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-string">'Country.region[countryCode]'</span> : <span class="hljs-string">'(new org.yourco.DataHelper()).getListOfRegions("@{countryCode}")'</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drools.drleditor"><a class="anchor" href="#_drools.drleditor"></a><a class="link" href="#_drools.drleditor">21.12. DRL file</a></h3>
<div class="paragraph">
<p>DRL files are stored as text - they can be managed in Drools Workbench.
A DRL file can contain one or several globals, rules, functions, enumerations, type declarations or anything that is supported by the DRL language.
Normally you would use the IDE to edit raw DRL files, since it has all the advanced tooling and content assistance and debugging.
However, there are times when a rule may have to deal with something fairly technical in a package in Drools Workbench.
In any typical package of rules, you generally have a need for some "technical rules" - you can mix and match all the rule types together of course.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DRLRule.png" alt="DRLRule">
</div>
<div class="title">Figure 387. DRL technical rule</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wb.workbenchintegration"><a class="anchor" href="#_wb.workbenchintegration"></a><a class="link" href="#_wb.workbenchintegration">22. Workbench Integration</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_drools.workbenchremoteapi"><a class="anchor" href="#_drools.workbenchremoteapi"></a><a class="link" href="#_drools.workbenchremoteapi">22.1. REST</a></h3>
<div class="paragraph">
<p>REST API calls to Knowledge Store allow you to manage the Knowledge Store content and manipulate the static data in the repositories of  the Knowledge Store.
The calls are asynchronous, that is, they continue their execution as a job after a call was performed.
The job ID  is returned by every call to allow (after the REST API call was performed) to request the job status and verify whether the job finished successfully.
Parameters of these calls are provided in the form of JSON entities.</p>
</div>
<div class="paragraph">
<p>When using Java code to interface with the REST API, the classes used in POST operations or otherwise returned by various operations can be found in the <a href="https://origin-repository.jboss.org/nexus/#nexus-search;quick~uberfire-rest-client"><code>(org.uberfire:)uberfire-rest-client</code></a> JAR.
All  of the classes mentioned below can be found in the <code>org.guvnor.rest.client</code> package in that JAR.</p>
</div>
<div class="sect3">
<h4 id="_job_calls"><a class="anchor" href="#_job_calls"></a><a class="link" href="#_job_calls">22.1.1. Job calls</a></h4>
<div class="paragraph">
<p>Every Knowledge Store REST call returns its job ID after it was sent.
This is necessary as the calls are asynchronous and you need  to be able to reference the job to check its status as it goes through its lifecycle.
During its lifecycle, a job can have the  following statuses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ACCEPTED</code>: the job was accepted and is being processed</p>
</li>
<li>
<p><code>BAD_REQUEST</code>: the request was not accepted as it contained incorrect content</p>
</li>
<li>
<p><code>RESOURCE_NOT_EXIST</code>: the requested resource (path) does not exist</p>
</li>
<li>
<p><code>DUPLICATE_RESOURCE</code>: the resource already exists</p>
</li>
<li>
<p><code>SERVER_ERROR</code>: an error on the server occurred</p>
</li>
<li>
<p><code>SUCCESS</code>: the job finished successfully</p>
</li>
<li>
<p><code>FAIL</code>: the job failed</p>
</li>
<li>
<p><code>DENIED</code>: the job was denied</p>
</li>
<li>
<p><code>GONE</code>: the job ID could not be found</p>
<div class="paragraph">
<p>A job can be GONE in the following cases:
<strong> The job was explicitly removed
</strong> The job finished and has been deleted from the status cache (the job is removed from status cache after the cache  has reached its maximum capacity)
** The job never existed</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following <code>job</code> calls are provided:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] <code>/jobs/<em>{jobID}</em></code></dt>
<dd>
<p>Returns the job status</p>
</dd>
<dt class="hdlist1">[DELETE] <code>/jobs/<em>{jobID}</em></code></dt>
<dd>
<p>Removes the job: If the job is not yet being processed, this will remove the job from the job queue.
However, this will not cancel or stop an ongoing job</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_project_calls"><a class="anchor" href="#_project_calls"></a><a class="link" href="#_project_calls">22.1.2. Project calls</a></h4>
<div class="paragraph">
<p>Project calls to the Knowledge Store allow you to manage Workspace projects.</p>
</div>
<div class="paragraph">
<p>The following <code>project</code> calls are provided:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] <code>/projects</code></dt>
<dd>
<p>Gets information about all the projects in the Knowledge Store.</p>
</dd>
<dt class="hdlist1">[GET] <code>/spaces/{spaceName}/projects/{projectName}</code></dt>
<dd>
<p>Gets information about the project.</p>
</dd>
<dt class="hdlist1">[POST] <code>/spaces/{spaceName}/projects/{projectName}</code></dt>
<dd>
<p>Creates a new project in given space.</p>
</dd>
<dt class="hdlist1">[DELETE] <code>/spaces/{spaceName}/projects/{projectName}</code></dt>
<dd>
<p>Removes the project from the Knowledge Store.</p>
</dd>
<dt class="hdlist1">[GET] <code>/spaces/{spaceName}/projects</code></dt>
<dd>
<p>Gets information about all projects in the space</p>
</dd>
<dt class="hdlist1">[POST] <code>/spaces/{spaceName}/git/clone</code></dt>
<dd>
<p>Clones a project into the space from provided git address.</p>
</dd>
<dt class="hdlist1">[DELETE] <code>/spaces/{spaceName}/projects/{projectName}</code></dt>
<dd>
<p>Deletes the project from the space.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_space_calls"><a class="anchor" href="#_space_calls"></a><a class="link" href="#_space_calls">22.1.3. Space calls</a></h4>
<div class="paragraph">
<p>Space calls to the Knowledge Store allow you to manage spaces.</p>
</div>
<div class="paragraph">
<p>The following <code>spaces</code> calls are provided:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] <code>/spaces</code></dt>
<dd>
<p>Gets all spaces.</p>
</dd>
<dt class="hdlist1">[GET] <code>/spaces/{spaceName}</code></dt>
<dd>
<p>Gets a single space.</p>
</dd>
<dt class="hdlist1">[POST] <code>/spaces</code></dt>
<dd>
<p>Creates a space described by <code>Space</code> JSON entity.</p>
</dd>
<dt class="hdlist1">[DELETE] <code>/spaces/{spaceName}</code></dt>
<dd>
<p>Deletes the space.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_maven_calls"><a class="anchor" href="#_maven_calls"></a><a class="link" href="#_maven_calls">22.1.4. Maven calls</a></h4>
<div class="paragraph">
<p>Maven calls to a project in the Knowledge Store allow you compile, test, install, and deploy projects.</p>
</div>
<div class="paragraph">
<p>The following <code>maven</code> calls are provided:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[POST] <code>/spaces/{spaceName}/projects/{projectName}/maven/compile</code></dt>
<dd>
<p>Compiles the project (equivalent to <code>mvn compile</code>)</p>
</dd>
<dt class="hdlist1">[POST] <code>/spaces/{spaceName}/projects/{projectName}/maven/test</code></dt>
<dd>
<p>Tests the project (equivalent to <code>mvn test</code>)</p>
</dd>
<dt class="hdlist1">[POST] <code>/spaces/{spaceName}/projects/{projectName}/maven/install</code></dt>
<dd>
<p>Installs the project (equivalent to <code>mvn install</code>)</p>
</dd>
<dt class="hdlist1">[POST] <code>/spaces/{spaceName}/projects/{projectName}/maven/deploy</code></dt>
<dd>
<p>Deploys the project (equivalent to  <code>mvn deploy</code>)</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_rest_summary"><a class="anchor" href="#_rest_summary"></a><a class="link" href="#_rest_summary">22.1.5. REST summary</a></h4>
<div class="paragraph">
<p>The URL templates in the table below are relative the following URL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>http://<em>{server}</em>:<em>{port}</em>/kie-wb/rest</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_embedded_kie_server_controller_calls"><a class="anchor" href="#_embedded_kie_server_controller_calls"></a><a class="link" href="#_embedded_kie_server_controller_calls">22.1.6. Embedded Kie Server Controller calls</a></h4>
<div class="paragraph">
<p>When running the Workbench with the embedded Kie Server Controller mode, a series of endpoints related to managing
all aspects of Kie Server Templates, Kie Server instances and Containers are also available.
See <a href="#_controller_rest_api">Controller REST API</a> for more details.
A <a href="#_kie_server_controller_client_api">Java client API</a> is also available for interacting with these endpoints.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie.keycloakssointegration"><a class="anchor" href="#_kie.keycloakssointegration"></a><a class="link" href="#_kie.keycloakssointegration">22.2. Keycloak SSO integration</a></h3>
<div class="paragraph">
<p>Single Sign On (SSO) and related token exchange mechanisms are becoming the most common scenario for the authentication and authorization in different environments on the web, specially when moving into the cloud.</p>
</div>
<div class="paragraph">
<p>This section talks about the integration of Keycloak with jBPM or Drools applications in order to use all the features provided on Keycloak.
Keycloak is an integrated SSO and IDM for browser applications and RESTful web services.
Lean more about it in the <a href="http://keycloak.jboss.org/">Keycloak’s home page</a>.</p>
</div>
<div class="paragraph">
<p>The result of the integration with Keycloak has lots of advantages such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide an integrated SSO and IDM environment for different clients, including jBPM and Drools workbenches</p>
</li>
<li>
<p>Social logins - use your Facebook, Google, LinkedIn, etc accounts</p>
</li>
<li>
<p>User session management</p>
</li>
<li>
<p>And much more…​</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next sections cover the following integration points with Keycloak:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Workbench authentication through a Keycloak server</strong></p>
<div class="paragraph">
<p>It basically consists of securing both web client and remote service clients through the Keycloak SSO.
So either web interface or remote service consumers (whether a user or a service) will authenticate into trough KC.</p>
</div>
</li>
<li>
<p><strong>Execution server authentication through a Keycloak server</strong></p>
<div class="paragraph">
<p>Consists of securing the remote services provided by the execution server (as it does not provide web interface). Any remote service consumer (whether a user or a service) will authenticate trough KC.</p>
</div>
</li>
<li>
<p><strong>Consuming remote services</strong></p>
<div class="paragraph">
<p>This section describes how a third party clients can consume the remote service endpoints provided by both Workbench and Execution Server, such as the REST API or remote file system services.</p>
</div>
</li>
<li>
<p><strong>Keycloakd and the Workbench’s security administration area</strong></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_scenario"><a class="anchor" href="#_scenario"></a><a class="link" href="#_scenario">22.2.1. Scenario</a></h4>
<div class="paragraph">
<p>Consider the following diagram as the environment for this document’s example:</p>
</div>
<div class="paragraph">
<p>Keycloak is a standalone process that provides remote authentication, authorization and administration services that can be potentially consumed by one or more jBPM applications over the network.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/KeyCloak_sso_scenario.png" alt="KeyCloak sso scenario">
</div>
</div>
<div class="paragraph">
<p>Consider these main steps for building this environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install and setup a Keycloak server</p>
</li>
<li>
<p>Create and setup a Realm for this example - Configure realm’s clients, users and roles</p>
</li>
<li>
<p>Install and setup the SSO client adapter &amp; jBPM application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note: The resulting environment and the different configurations for this document are based on the jBPM (KIE) Workbench, but same ones can also be applied for the KIE Drools Workbench as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_and_setup_a_keycloak_server"><a class="anchor" href="#_install_and_setup_a_keycloak_server"></a><a class="link" href="#_install_and_setup_a_keycloak_server">22.2.2. Install and setup a Keycloak server</a></h4>
<div class="paragraph">
<p>Keycloak provides an extensive documentation and several articles about the installation on different environments.
This section describes the minimal setup for being able to build the integrated environment for the example.
Please refer to the <a href="http://www.keycloak.org/documentation.html">Keycloak documentation</a> if you need more information.</p>
</div>
<div class="paragraph">
<p>Here are the steps for a minimal Keycloak installation and setup:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download latest version of Keycloak from the <a href="http://www.keycloak.org/downloads.html">Downloads</a> section. This example is based on Keycloak 1.9.0.Final</p>
</li>
<li>
<p>Unzip the downloaded distribution of Keycloak into a folder, let’s refer it as</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$KC_HOME</span></code></pre>
</div>
</div>
</li>
<li>
<p>Run the KC server - This example is based on running both Keycloak and jBPM on same host. In order to avoid port conflicts you can use a port offset for the Keycloak’s server as:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl"><span class="hljs-variable">$KC_HOME</span>/bin/standalone.sh -Djboss.<span class="hljs-keyword">socket</span>.binding.port-offset=<span class="hljs-number">100</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create a Keycloak’s administration 'admin' user by navigating to <a href="http://localhost:8180/auth/" class="bare">http://localhost:8180/auth/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Keycloak administration console will be available at <a href="http://localhost:8180/auth/admin/" class="bare">http://localhost:8180/auth/admin/</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_and_setup_the_demo_realm"><a class="anchor" href="#_create_and_setup_the_demo_realm"></a><a class="link" href="#_create_and_setup_the_demo_realm">22.2.3. Create and setup the demo realm</a></h4>
<div class="paragraph">
<p>Security realms are used to restrict the access for the different application’s resources.</p>
</div>
<div class="paragraph">
<p>Once the Keycloak server is running next step is about creating a realm.
This realm will provide the different users, roles, sessions, etc for the jBPM application/s.</p>
</div>
<div class="paragraph">
<p>Keycloak provides several examples for the realm creation and management, from the <a href="https://github.com/keycloak/keycloak/tree/master/examples">official
        examples</a> to different articles with more examples.</p>
</div>
<div class="paragraph">
<p>Follow these steps in order to create the <em>demo</em> realm used later in this document:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the Keycloak <a href="http://localhost:8180/auth/admin">administration console</a> and click on <em>Add realm</em> button. Give it the name <em>demo</em>.</p>
</li>
<li>
<p>Go to the Clients section (from the main admin console menu) and create a new client for the <em>demo</em> realm:</p>
<div class="ulist">
<ul>
<li>
<p>Client ID:  <em>kie</em></p>
</li>
<li>
<p>Client protocol: <em>openid-connect</em></p>
</li>
<li>
<p>Acces type: <em>confidential</em></p>
</li>
<li>
<p>Root URL: <em><a href="http://localhost:8080/" class="bare">http://localhost:8080</a></em></p>
</li>
<li>
<p>Base URL:  <em>/kie-wb-x.y.z.Final</em></p>
</li>
<li>
<p>Redirect URIs: <em>/kie-wb-x.y.z.Final/*</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The resulting <em>kie</em> client settings screen:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/kie_client_settings.png" alt="kie client settings">
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As you can see in the above settings it’s being considered the value <em>kie-wb-x.y.z.Final</em> for the application’s context path.
If your jBPM application will be deployed on a different context path, host or port, just use your concrete settings here.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Last step for being able to use the <em>demo</em> realm from the jBPM workbench is create the application’s user and roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the Roles section and create the roles <em>admin</em>, <em>kiemgmt</em> and <em>rest-all</em></p>
</li>
<li>
<p>Go to the Users section and create the <em>admin</em> user. Set the password with value <em>password</em> in the credentials tab, unset the temporary switch.</p>
</li>
<li>
<p>In  the Users section navigate to the <em>Role Mappings</em> tab and assign the <em>admin</em>, <em>kiemgmt</em> and <em>rest-all</em> roles to the <em>admin</em> user</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/admin_user_roles.png" alt="admin user roles">
</div>
</div>
<div class="paragraph">
<p>At this point a Keycloak server is running on the host, setup with a minimal configuration set.
Let’s move to the jBPM workbench setup.</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_and_setup_jbpm_workbench"><a class="anchor" href="#_install_and_setup_jbpm_workbench"></a><a class="link" href="#_install_and_setup_jbpm_workbench">22.2.4. Install and setup jBPM Workbench</a></h4>
<div class="paragraph">
<p>For this tutorial let’s use a Wildfly as the application server for the jBPM workbench, as the jBPM installer does by default.</p>
</div>
<div class="paragraph">
<p>Let’s assume, after running the jBPM installer, the <em>$JBPM_HOME</em> as the root path for the Wildfly server where the application has been deployed.</p>
</div>
<div class="sect4">
<h5 id="_install_the_kc_adapter"><a class="anchor" href="#_install_the_kc_adapter"></a><a class="link" href="#_install_the_kc_adapter">22.2.4.1. Install the KC adapter</a></h5>
<div class="paragraph">
<p>In order to use the Keycloak’s authentication and authorization modules from the jBPM application, the <a href="http://www.keycloak.org/docs/latest/securing_apps/topics/oidc/java/jboss-adapter.html">Keycloak adapter for Wildfly</a> must be installed on our server at <em>$JBPM_HOME</em>.
Keycloak provides multiple adapters for different containers out of the box, if you are using another container or need to use another adapter, please take a look at the <a href="http://www.keycloak.org/docs/latest/securing_apps/index.html">securing applications section</a> from the Keycloak docs.
Here are the steps to install and setup the adapter for Wildfly 8.2.x:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download the adapter from <a href="https://repository.jboss.org/nexus/service/local/repositories/central/content/org/keycloak/keycloak-wf8-adapter-dist/1.9.0.Final/keycloak-wf8-adapter-dist-1.9.0.Final.zip">here</a></p>
</li>
<li>
<p>Execute the following commands on your shell:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">cd $JBPM_HOME/unzip keycloak-wf8-adapter-dist.zip // <span class="hljs-operator"><span class="hljs-keyword">Install</span> the KC <span class="hljs-keyword">client</span> adapter

cd $JBPM_HOME/<span class="hljs-keyword">bin</span>
./<span class="hljs-keyword">standalone</span>.sh -<span class="hljs-keyword">c</span> <span class="hljs-keyword">standalone</span>-<span class="hljs-keyword">full</span>.<span class="hljs-keyword">xml</span> // Setup the KC <span class="hljs-keyword">client</span> adapter.

// ** Once <span class="hljs-keyword">server</span> <span class="hljs-keyword">is</span> up, <span class="hljs-keyword">open</span> a <span class="hljs-keyword">new</span> command line terminal <span class="hljs-keyword">and</span> run:
cd $JBPM_HOME/<span class="hljs-keyword">bin</span>
./jboss-cli.sh -<span class="hljs-keyword">c</span> <span class="hljs-comment">--file=adapter-install.cli</span></span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_configure_the_kc_adapter"><a class="anchor" href="#_configure_the_kc_adapter"></a><a class="link" href="#_configure_the_kc_adapter">22.2.4.2. Configure the KC adapter</a></h5>
<div class="paragraph">
<p>Once installed the KC adapter into Wildfly, next step is to configure the adapter in order to specify different settings such as the location for the authentication server, the realm to use and so on.</p>
</div>
<div class="paragraph">
<p>Keycloak provides two ways of configuring the adapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Per WAR configuration</p>
</li>
<li>
<p>Via Keycloak subsystem</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example let’s use the second option, use the Keycloak subsystem, so our WAR is free from this kind of settings.
If you want to use the per WAR approach, please take a look <a href="http://www.keycloak.org/docs/latest/securing_apps/topics/oidc/java/jboss-adapter.html">here</a>.</p>
</div>
<div class="paragraph">
<p>Edit the configuration file <em>$JBPM_HOME/standalone/configuration/standalone-full.xml</em> and locate the subsystem configuration section.
Add the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">subsystem</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"urn:jboss:domain:keycloak:1.1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">secure-deployment</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kie-wb-x.y.z.Final.war"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">realm</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">realm</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">realm-public-key</span>&gt;</span>MIIBIjANBgkqhkiG9w0BAQEFAAOCA...<span class="hljs-tag">&lt;/<span class="hljs-title">realm-public-key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">auth-server-url</span>&gt;</span>http://localhost:8180/auth<span class="hljs-tag">&lt;/<span class="hljs-title">auth-server-url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ssl-required</span>&gt;</span>external<span class="hljs-tag">&lt;/<span class="hljs-title">ssl-required</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">resource</span>&gt;</span>kie<span class="hljs-tag">&lt;/<span class="hljs-title">resource</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">enable-basic-auth</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">enable-basic-auth</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">credential</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"secret"</span>&gt;</span>925f9190-a7c1-4cfd-8a3c-004f9c73dae6<span class="hljs-tag">&lt;/<span class="hljs-title">credential</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">principal-attribute</span>&gt;</span>preferred_username<span class="hljs-tag">&lt;/<span class="hljs-title">principal-attribute</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">secure-deployment</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">subsystem</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have imported the example json files from this document in <em>step 2</em>, you can just use same configuration as above by using your concrete deployment name. Otherwise please use your values for these configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Name for the secure deployment</em> - Use your concrete application’s WAR file name</p>
</li>
<li>
<p><em>Realm</em> - Is the realm that the applications will use, in our example, the <em>demo</em> realm created the previous step.</p>
</li>
<li>
<p><em>Realm Public Key</em> - Provide here the public key for the <em>demo</em> realm. It’s not mandatory, if it’s not specified, it will be retrieved from the server. Otherwise, you can find it in the Keycloak admin console → Realm settings (for <em>demo</em> realm) → Keys</p>
</li>
<li>
<p><em>Authentication server URL</em> - The URL for the Keycloak’s authentication server</p>
</li>
<li>
<p><em>Resource</em> - The name for the client created on step 2. In our example, use the value <em>kie</em>.</p>
</li>
<li>
<p><em>Enable basic auth</em> - For this example let’s enable Basic authentication mechanism as well, so clients can use both Token (Bearer) and Basic approaches to perform the requests.</p>
</li>
<li>
<p><em>Credential</em> - Use the password value for the <em>kie</em> client. You can find it in the Keycloak admin console → Clients → kie → Credentials tab → Copy the value for the <em>secret</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For this example you have to take care about using your concrete values for <em>secure-deployment</em> name, <em>realm-public-key</em> and <em>credential</em> password.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure the following tag is NOT present in the Widfly/EAP profile’s configuration file (eg: standalone.xml):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs apache"><span class="hljs-tag">&lt;single-sign-on/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s enabled by default in some server versions. If present, it must be removed/disabled in order to allow Keycloak to properly handle the clients.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_run_the_environment"><a class="anchor" href="#_run_the_environment"></a><a class="link" href="#_run_the_environment">22.2.4.3. Run the environment</a></h5>
<div class="paragraph">
<p>At this point a Keycloak server is up and running on the host, and the KC adapter is installed and configured for the jBPM application server.
You can run the application using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash"><span class="hljs-variable">$JBPM_HOME</span>/bin/standalone.sh -c standalone-full.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can navigate into the application once the server is up at:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"> http:<span class="hljs-comment">//localhost:8080/kie-wb-x.y.z.Final</span></code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/jbpm_login_screen.png" alt="jbpm login screen">
</div>
</div>
<div class="paragraph">
<p>Use your Keycloak’s admin user credentials to login: <em>admin/password</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_securing_workbench_remote_services_via_keycloak"><a class="anchor" href="#_securing_workbench_remote_services_via_keycloak"></a><a class="link" href="#_securing_workbench_remote_services_via_keycloak">22.2.5. Securing workbench remote services via Keycloak</a></h4>
<div class="paragraph">
<p>Both jBPM and Drools workbenches provide different remote service endpoints that can be consumed by third party clients using the <a href="#_drools.workbenchremoteapi">remote API</a>.</p>
</div>
<div class="paragraph">
<p>In order to authenticate those services thorough Keycloak the <em>BasicAuthSecurityFilter</em> must be disabled, apply those modifications for the the <em>WEB-INF/web.xml</em> file (app deployment descriptor) from jBPM’s WAR file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove the following filter from the deployment descriptor:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">filter</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>HTTP Basic Auth Filter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter-class</span>&gt;</span>org.uberfire.ext.security.server.BasicAuthSecurityFilter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-class</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">init-param</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">param-name</span>&gt;</span>realmName<span class="hljs-tag">&lt;/<span class="hljs-title">param-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">param-value</span>&gt;</span>KIE Workbench Realm<span class="hljs-tag">&lt;/<span class="hljs-title">param-value</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">init-param</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">filter</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">filter-mapping</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">filter-name</span>&gt;</span>HTTP Basic Auth Filter<span class="hljs-tag">&lt;/<span class="hljs-title">filter-name</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/rest/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/maven2/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/ws/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">filter-mapping</span>&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Constraint the remote services URL patterns as:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">security-constraint</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">web-resource-collection</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">web-resource-name</span>&gt;</span>remote-services<span class="hljs-tag">&lt;/<span class="hljs-title">web-resource-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/rest/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/maven2/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">url-pattern</span>&gt;</span>/ws/*<span class="hljs-tag">&lt;/<span class="hljs-title">url-pattern</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">web-resource-collection</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">auth-constraint</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">role-name</span>&gt;</span>rest-all<span class="hljs-tag">&lt;/<span class="hljs-title">role-name</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">auth-constraint</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">security-constraint</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The user that consumes the remote services must be member of role <em>rest-all</em>.
As on described previous steps, the <em>admin</em> user in this example it’s already a member of the <em>rest-all </em>role.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_securing_workbench_s_file_system_services_via_keycloak"><a class="anchor" href="#_securing_workbench_s_file_system_services_via_keycloak"></a><a class="link" href="#_securing_workbench_s_file_system_services_via_keycloak">22.2.6. Securing workbench’s file system services via Keycloak</a></h4>
<div class="paragraph">
<p>In order to consume other remote services such as the file system ones (e.g. remote GIT),
a specific <strong>Keycloak login module must be used</strong> for the application’s security domain in the
<em>$JBPM_HOME/standalone/configuration/standalone-full.xml</em> file.
By default the workbench uses the <em>other</em> security domain, so the resulting  configuration on the
<em>$JBPM_HOME/standalone/configuration/standalone-full.xml</em> should be such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">security-domain</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"other"</span> <span class="hljs-attribute">cache-type</span>=<span class="hljs-value">"default"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">authentication</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">login-module</span> <span class="hljs-attribute">code</span>=<span class="hljs-value">"org.keycloak.adapters.jaas.DirectAccessGrantsLoginModule"</span> <span class="hljs-attribute">flag</span>=<span class="hljs-value">"required"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Parameter value can be a file system absolute path or a classpath (e.g. "classpath:/some-path/kie-git.json")--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">module-option</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"keycloak-config-file"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"$JBPM_HOME/kie-git.json"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">login-module</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">authentication</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">security-domain</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The login modules on the <em>other</em> security domain in the <em>$JBPM_HOME/standalone/configuration/standalone-full.xml</em> file must be REPLACED by the above given one.</p>
</li>
<li>
<p>Replace <em>$JBPM_HOME/kie-git.json</em> by the path (on file system) or the classpath (e.g. <em>classpath:/some-path/kie-git.json</em>) for the json configuration file used for the remote services client. Please continue reading in order to create this Keycloak client and how to obtain this json file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point, remote services that use JAAS for the authentication process, such as the file system ones (e.g. GIT), are secured by Keycloak using the client specified in the above json configuration file. So let’s create this client on Keycloak and generate the required JSON file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to the <a href="http://localhost:8180/auth/admin">KC administration console</a> and create a new client for the <em>demo</em> realm using <em>kie-git</em> as name.</p>
</li>
<li>
<p>Enable <em>Direct Access Grants Enabled</em> option</p>
</li>
<li>
<p>Disable <em>Standard Flow Enabled</em> option</p>
</li>
<li>
<p>Use a <em>confidential</em> access type for this client. See below image as example:</p>
</li>
</ul>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/kie_git_client_settings.png" alt="kie git client settings">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the <em>Installation</em> tab in same <em>kie-git</em> client configuration screen and export using the <em>Keycloak OIDC JSON</em> type.</p>
</li>
<li>
<p>Finally copy this generated JSON file into an accessible directory on the server’s file system or add it in the application’s classpath. Use this path value as the <em>keycloak-config-file</em> argument for the above configuration of the <em>org.keycloak.adapters.jaas.DirectAccessGrantsLoginModule</em> login module.</p>
</li>
<li>
<p>More information about Keycloak JAAS Login modules can be found <a href="https://keycloak.gitbooks.io/securing-client-applications-guide/content/v/2.2/topics/oidc/java/jaas.html">here</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point, the internal Git repositories can be cloned by all users authenticated via the Keycloak server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-comment"># Command example:</span>
<span class="hljs-title">git</span> clone <span class="hljs-url">ssh://admin<span class="hljs-variable">@localhost</span>:8001/system</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_execution_server"><a class="anchor" href="#_execution_server"></a><a class="link" href="#_execution_server">22.2.7. Execution server</a></h4>
<div class="paragraph">
<p>The KIE Execution Server provides a <a href="#_kie.ksrestapi">REST API</a> that can be consumed for any third party clients.
This this section is about how to integration the KIE Execution Server with the Keycloak SSO in order to delegate the third party clients identity management to the SSO server.</p>
</div>
<div class="paragraph">
<p>Consider the above environment running, so consider having:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Keycloak server running and listening on <a href="http://localhost:8180/auth" class="bare">http://localhost:8180/auth</a></p>
</li>
<li>
<p>A realm named <em>demo</em> with a client named <em>kie</em> for the jBPM Workbench</p>
</li>
<li>
<p>A jBPM Workbench running at <a href="http://localhost:8080/kie-wb-x.y.z.Final" class="bare">http://localhost:8080/kie-wb-x.y.z.Final</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Follow these steps in order to add an execution server into this environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the client for the execution server on Keycloak</p>
</li>
<li>
<p>Install setup and the Execution server (with the KC client adapter)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_create_the_execution_server_s_client_on_keycloak"><a class="anchor" href="#_create_the_execution_server_s_client_on_keycloak"></a><a class="link" href="#_create_the_execution_server_s_client_on_keycloak">22.2.7.1. Create the execution server’s client on Keycloak</a></h5>
<div class="paragraph">
<p>As per each execution server is going to be deployed, you have to create a new client on the <em>demo</em> realm in Keycloak:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the <a href="http://localhost:8180/auth/admin">KC admin console</a> → Clients → New client</p>
</li>
<li>
<p>Name: <em>kie-execution-server</em></p>
</li>
<li>
<p>Root URL: <em><a href="http://localhost:8280/" class="bare">http://localhost:8280/</a></em></p>
</li>
<li>
<p>Client protocol: <em>openid-connect</em></p>
</li>
<li>
<p>Access type: <em>confidential</em> (or <em>public</em> if you want so, but not recommended for production environments)</p>
</li>
<li>
<p>Valid redirect URIs: <em>/kie-server-x.y.z.Final/*</em></p>
</li>
<li>
<p>Base URL: <em>/kie-server-x.y.z.Final</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example the <em>admin</em> user already created on previous steps is the one used for the client requests.
So ensure that the <em>admin</em> user is member of the role <em>kie-server</em> in order to use the execution server’s remote services.
If the role does not exist, create it.</p>
</div>
<div class="paragraph">
<p>Note: This example considers that the execution server will be configured to run using a port offset of 200, so the HTTP port will be available at localhost:8280.</p>
</div>
</div>
<div class="sect4">
<h5 id="_install_and_setup_the_kc_adapter_on_the_execution_server"><a class="anchor" href="#_install_and_setup_the_kc_adapter_on_the_execution_server"></a><a class="link" href="#_install_and_setup_the_kc_adapter_on_the_execution_server">22.2.7.2. Install and setup the KC adapter on the execution server</a></h5>
<div class="paragraph">
<p>At this point, a client named <em>kie-execution-server</em> is ready on the KC server to use from the execution server.</p>
</div>
<div class="paragraph">
<p>Let’s install, setup and deploy the execution server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install another Wildfly server to use for the execution server and the KC client adapter as well. You can follow above instructions for the Workbench or follow the <a href="http://www.keycloak.org/docs/latest/securing_apps/index.html">securing applications guide</a></p>
</li>
<li>
<p>Edit the <em>standalone-full.xml</em> file from the Wildfly server’s configuration path and configure the KC subsystem adapter as:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">secure-deployment</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kie-server-x.y.z.Final.war"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">realm</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">realm</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">realm-public-key</span>&gt;</span>MIGfMA0GCSqGSIb...<span class="hljs-tag">&lt;/<span class="hljs-title">realm-public-key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">auth-server-url</span>&gt;</span>http://localhost:8180/auth<span class="hljs-tag">&lt;/<span class="hljs-title">auth-server-url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ssl-required</span>&gt;</span>external<span class="hljs-tag">&lt;/<span class="hljs-title">ssl-required</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">resource</span>&gt;</span>kie-execution-server<span class="hljs-tag">&lt;/<span class="hljs-title">resource</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">enable-basic-auth</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">enable-basic-auth</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">credential</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"secret"</span>&gt;</span>e92ec68d-6177-4239-be05-28ef2f3460ff<span class="hljs-tag">&lt;/<span class="hljs-title">credential</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">principal-attribute</span>&gt;</span>preferred_username<span class="hljs-tag">&lt;/<span class="hljs-title">principal-attribute</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">secure-deployment</span>&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consider your concrete environment settings if different from this example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Secure deployment name → use the name of the execution server war file being deployed</p>
</li>
<li>
<p>Public key → Use the demo realm public key or leave it blank, the server will provide one if so</p>
</li>
<li>
<p>Resource → This time, instead of the kie client used in the WB configuration, use the <em>kie-execution-server</em> client</p>
</li>
<li>
<p>Enable basic auth → Up to you. You can enable Basic auth for third party service consumers</p>
</li>
<li>
<p>Credential → Use the secret key for the <em>kie-execution-server</em> client. You can find it in the <em>Credentials</em>tab of the KC admin console</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_deploy_and_run_the_execution_server"><a class="anchor" href="#_deploy_and_run_the_execution_server"></a><a class="link" href="#_deploy_and_run_the_execution_server">22.2.7.3. Deploy and run the execution server</a></h5>
<div class="paragraph">
<p>Just deploy the execution server in Wildfly using any of the available mechanisms.
Run the execution server using this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml">$EXEC_SERVER_HOME/bin/standalone.sh -c standalone-full.xml -Djboss.socket.binding.port-offset=200 -Dorg.kie.server.id=<span class="hljs-tag">&lt;<span class="hljs-title">ID</span>&gt;</span> -Dorg.kie.server.user=<span class="hljs-tag">&lt;<span class="hljs-title">USER</span>&gt;</span> -Dorg.kie.server.pwd=<span class="hljs-tag">&lt;<span class="hljs-title">PWD</span>&gt;</span> -Dorg.kie.server.location=<span class="hljs-tag">&lt;<span class="hljs-title">LOCATION_URL</span>&gt;</span>  -Dorg.kie.server.controller=<span class="hljs-tag">&lt;<span class="hljs-title">CONTROLLER_URL</span>&gt;</span> -Dorg.kie.server.controller.user=<span class="hljs-tag">&lt;<span class="hljs-title">CONTROLLER_USER</span>&gt;</span> -Dorg.kie.server.controller.pwd=<span class="hljs-tag">&lt;<span class="hljs-title">CONTOLLER_PASSWORD</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby"><span class="hljs-variable">$EXEC_SERVER_HOME</span>/bin/standalone.sh -c standalone-full.xml -<span class="hljs-constant">Djboss</span>.socket.binding.port-offset=<span class="hljs-number">200</span> -<span class="hljs-constant">Dorg</span>.kie.server.id=kieserver1 -<span class="hljs-constant">Dorg</span>.kie.server.user=admin -<span class="hljs-constant">Dorg</span>.kie.server.pwd=password -<span class="hljs-constant">Dorg</span>.kie.server.location=<span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/localhost:8280/kie</span>-server-x.y.z.<span class="hljs-constant">Final</span>/services/rest/server -<span class="hljs-constant">Dorg</span>.kie.server.controller=<span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/localhost:8080/kie</span>-wb-x.y.z.<span class="hljs-constant">Final</span>/rest/controller -<span class="hljs-constant">Dorg</span>.kie.server.controller.user=admin -<span class="hljs-constant">Dorg</span>.kie.server.controller.pwd=password</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The users that will consume the execution server remote service endpoints must have the role <em>kie-server</em> assigned.
So create and assign this role in the KC admin console for the users that will consume the execution server remote services.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Once up, you can check the server status as (considered using Basic authentication for this request, see next <a href="#consumingRemoteServices">Consuming remote services</a> for more information):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">curl <span class="hljs-attribute">http</span>:<span class="hljs-regexp">//</span><span class="hljs-attribute">admin</span>:password<span class="hljs-property">@localhost</span>:<span class="hljs-number">8280</span>/kie-server-x.y.z.Final<span class="hljs-regexp">/services/rest/server/</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="consumingRemoteServices"><a class="anchor" href="#consumingRemoteServices"></a><a class="link" href="#consumingRemoteServices">22.2.8. Consuming remote services</a></h4>
<div class="paragraph">
<p>In order to use the different remote services provided by the Workbench or by an Execution Server, your client must be authenticated on the KC server and have a valid token to perform the requests.</p>
</div>
<div class="paragraph">
<p>Remember that in order to use the remote services, the authenticated user must have assigned:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The role <em>rest-all</em> for using the WB remote services</p>
</li>
<li>
<p>The role <em>kie-server</em> for using the Execution Server remote services</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please ensure necessary roles are created and assigned to the users that will consume the remote services on the Keycloak admin console.</p>
</div>
<div class="paragraph">
<p>You have two options to consume the different remove service endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using basic authentication, if the application’s client supports it</p>
</li>
<li>
<p>Using Bearer (token) based authentication</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_using_basic_authentication"><a class="anchor" href="#_using_basic_authentication"></a><a class="link" href="#_using_basic_authentication">22.2.8.1. Using basic authentication</a></h5>
<div class="paragraph">
<p>If the KC client adapter configuration has the Basic authentication enabled, as proposed in this guide for both WB (<em>step 3.2</em>) and Execution Server, you can avoid the token grant/refresh calls and just call the services as the following examples.</p>
</div>
<div class="paragraph">
<p>Example for a WB remote repositories endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">curl</span> <span class="hljs-url">http://admin:password<span class="hljs-variable">@localhost</span>:8080/kie-wb-x.y.z.Final/rest/repositories</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example to check the status for the Execution Server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">curl <span class="hljs-attribute">http</span>:<span class="hljs-regexp">//</span><span class="hljs-attribute">admin</span>:password<span class="hljs-property">@localhost</span>:<span class="hljs-number">8280</span>/kie-server-x.y.z.Final<span class="hljs-regexp">/services/rest/server/</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="usingTokenBasedAuthentication"><a class="anchor" href="#usingTokenBasedAuthentication"></a><a class="link" href="#usingTokenBasedAuthentication">22.2.8.2. Using token based authentication</a></h5>
<div class="paragraph">
<p>First step is to create a new client on Keycloak that allows the third party remote service clients to obtain a token.
It can be done as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the KC admin console and create a <em>new client</em> using this configuration:</p>
<div class="ulist">
<ul>
<li>
<p>Client id: <em>kie-remote</em></p>
</li>
<li>
<p>Client protocol: <em>openid-connect</em></p>
</li>
<li>
<p>Access type: <em>public</em></p>
</li>
<li>
<p>Valid redirect URIs: <em><a href="http://localhost/" class="bare">http://localhost/</a></em></p>
</li>
</ul>
</div>
</li>
<li>
<p>As we are going to manually obtain a token and invoke the service let’s increase the lifespan of tokens slightly. In production access tokens should have a relatively low timeout, ideally less than 5 minutes:</p>
<div class="ulist">
<ul>
<li>
<p>Go to the KC admin console</p>
</li>
<li>
<p>Click on your Realm Settings</p>
</li>
<li>
<p>Click on Tokens tab</p>
</li>
<li>
<p>Change the value for Access Token Lifespan to 15 minutes. That should give us plenty of time to obtain a token and invoke the service before it expires.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once a public client for our remote clients has been created, you can now obtain the token by performing an HTTP request to the KC server’s tokens endpoint.
Here is an example for command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">RESULT=`<span class="javascript">curl --data <span class="hljs-string">"grant_type=password&amp;client_id=kie-remote&amp;username=admin&amp;passwordpassword=&lt;the_client_secret&gt;"</span> http:<span class="hljs-comment">//localhost:8180/auth/realms/demo/protocol/openid-connect/token</span></span>`</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">TOKEN=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$RESULT</span> | sed <span class="hljs-string">'s/.*access_token":"//g'</span> | sed <span class="hljs-string">'s/".*//g'</span>`</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, if you echo the <em>$TOKEN</em> it will output the token string obtained from the KC server, that can be now used to authorize further calls to the remote endpoints.
For exmple, if you want to check the internal jBPM repositories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">curl</span> -H <span class="hljs-string">"Authorization: bearer <span class="hljs-variable">$TOKEN</span>"</span> <span class="hljs-url">http://localhost:8080/kie-wb-x.y.z.Final/rest/repositories</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_keycloak_and_the_workbench_s_security_administration_area"><a class="anchor" href="#_keycloak_and_the_workbench_s_security_administration_area"></a><a class="link" href="#_keycloak_and_the_workbench_s_security_administration_area">22.2.9. Keycloak and the workbench’s security administration area</a></h4>
<div class="paragraph">
<p>The jBPM workbench provides an administration area which provides user, group and role management features (see <a href="#_wb.userandgroupmgmt">Security management</a>).</p>
</div>
<div class="paragraph">
<p>By default the application’s security management system points to the application’s server realm. For instance, in case of using the packaged distribution for Wildfly, it points to the Wildfly’s ApplicationRealm (properties based). It means the entities from the realm presented in the administration area are not the ones from the Keycloak realm that the application is using. There exist the following options in order to change this default behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Disable the user system administration</p>
</li>
<li>
<p>Use the built-in Keycloak security management provider instead of the default one</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to customize an existing jBPM application (WAR file) for using the Keycloak security management provider please follow the next steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the artifact <em>keycloak-core-1.9.x.Final.jar</em> into <em>WEB-INF/lib</em></p>
</li>
<li>
<p>Add the artifact <em>keycloak-common-1.9.x.Final.jar</em> into <em>WEB-INF/lib</em></p>
</li>
<li>
<p>Remove the actual <em>jar</em> artifact for any security management provider in use from <em>WEB-INF/lib</em> (eg: remove <em>WEB-INF/lib/uberfire-security-management-wdilfly-x.y.Z.jar</em>)</p>
</li>
<li>
<p>Replace the content for <em>WEB-INF/classes/security-management.properties</em> by:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>org.uberfire.ext.security.management.api.userManagementServices=KCAdapterUserManagementService
org.uberfire.ext.security.management.keycloak.authServer=&lt;authz_server_url&gt;
# eg: org.uberfire.ext.security.management.keycloak.authServer=http://localhost:8180/auth</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the <em>/META-INF/jboss-deployment-structure.xml</em> in order to include/exclude the following modules:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;deployment&gt;
    &lt;dependencies&gt;
        ...
        &lt;module name="org.jboss.resteasy.resteasy-jackson-provider" services="import"/&gt;
        ...
    &lt;/dependencies&gt;
    &lt;exclusions&gt;
        ...
        &lt;module name="org.jboss.resteasy.resteasy-jackson2-provider"/&gt;
        ...
    &lt;/exclusions&gt;
&lt;/deployment&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>jar</em> artifacts required in the steps above can be either downloaded from <a href="https://repository.jboss.org/nexus/">JBoss Nexus</a> or either build from <a href="https://github.com/kiegroup/appformer">sources</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Once applying the above changes, the security administration area uses the access token present in the user’s session in order to authorize and manage the specific Keycloak realm data.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to be able to manage Keycloak realms remotely, please ensure the user has the <em>realm-management</em> client role assigned</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wb.workbenchhighavailability"><a class="anchor" href="#_wb.workbenchhighavailability"></a><a class="link" href="#_wb.workbenchhighavailability">23. Workbench High Availability</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_wb.vfsclustering"><a class="anchor" href="#_wb.vfsclustering"></a><a class="link" href="#_wb.vfsclustering">23.1. VFS clustering</a></h3>
<div class="paragraph">
<p>The <a href="#_wb.vfsrepository">VFS repositories</a> (usually git repositories) stores all the assets (such
as rules, decision tables, process definitions, forms, etc). If that VFS resides on each local
server, then it must be kept in sync between all servers of a cluster.</p>
</div>
<div class="paragraph">
<p>Use <a href="http://zookeeper.apache.org/">Apache Zookeeper</a> and <a href="http://helix.incubator.apache.org/">Apache Helix</a>
to accomplish this. Zookeeper glues all the parts together. Helix is the cluster management
component that registers all cluster details (nodes, resources and the cluster itself). Uberfire
(on top of which Workbench is build) uses those 2 components to provide VFS clustering.</p>
</div>
<div class="paragraph">
<p>To create a VFS cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download <a href="http://zookeeper.apache.org/">Apache Zookeeper</a> and <a href="http://helix.incubator.apache.org/">Apache Helix</a>.</p>
</li>
<li>
<p>Install both:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Unzip Zookeeper into a directory (<code>$ZOOKEEPER_HOME</code>).</p>
</li>
<li>
<p>In <code>$ZOOKEEPER_HOME</code>, copy <code>zoo_sample.conf</code> to <code>zoo.conf</code></p>
</li>
<li>
<p>Edit <code>zoo.conf</code>. Adjust the settings if needed. Usually only these 2 properties are relevant:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties" data-lang="properties"># the directory where the snapshot is stored.
dataDir=/tmp/zookeeper
# the port at which the clients will connect
clientPort=2181</code></pre>
</div>
</div>
</li>
<li>
<p>Unzip Helix into a directory (<code>$HELIX_HOME</code>).</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the cluster in Zookeeper:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to its <code>bin</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell" data-lang="shell">$ cd $ZOOKEEPER_HOME/bin</code></pre>
</div>
</div>
</li>
<li>
<p>Start the Zookeeper server:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell" data-lang="shell">$ sudo ./zkServer.sh start</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the server fails to start, verify that the <code>dataDir</code> (as specified in <code>zoo.conf</code>) is accessible.</p>
</div>
</li>
<li>
<p>To review Zookeeper’s activities, open <code>zookeeper.out</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby"><span class="hljs-variable">$ </span>cat <span class="hljs-variable">$ZOOKEEPER_HOME</span>/bin/zookeeper.out</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the cluster in Helix:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to its <code>bin</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$HELIX_HOME</span>/bin</code></pre>
</div>
</div>
</li>
<li>
<p>Create the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$ ./helix-admin.sh --zkSvr localhost:<span class="hljs-number">2181</span> --addCluster kie-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>zkSvr</code> value must match the used Zookeeper server.
The cluster name (<code>kie-cluster</code>) can be changed as needed.</p>
</div>
</li>
<li>
<p>Add nodes to the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp"><span class="hljs-preprocessor"># Node <span class="hljs-number">1</span></span>
$ ./helix-admin.sh --zkSvr localhost:<span class="hljs-number">2181</span> --addNode kie-cluster nodeOne:<span class="hljs-number">12345</span>
<span class="hljs-preprocessor"># Node <span class="hljs-number">2</span></span>
$ ./helix-admin.sh --zkSvr localhost:<span class="hljs-number">2181</span> --addNode kie-cluster nodeTwo:<span class="hljs-number">12346</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually the number of nodes a in cluster equal the number of application servers in the cluster.
The node names (<code>nodeOne:12345</code> , …​) can be changed as needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>nodeOne:12345</code> is the unique identifier of the node, which will be referenced later on when configuring application servers.
It is not a host and port number, but instead it is used to uniquely identify the logical node.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>Add resources to the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$ ./helix-admin.sh --zkSvr localhost:<span class="hljs-number">2181</span> --addResource kie-cluster vfs-repo <span class="hljs-number">1</span> LeaderStandby AUTO_REBALANCE</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resource name (<code>vfs-repo</code>) can be changed as needed.</p>
</div>
</li>
<li>
<p>Rebalance the cluster to initialize it:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$ ./helix-admin.sh --zkSvr localhost:<span class="hljs-number">2181</span> --rebalance kie-cluster vfs-repo <span class="hljs-number">2</span></code></pre>
</div>
</div>
</li>
<li>
<p>Start the Helix controller to manage the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">$  ./run-helix-controller.sh --zkSvr localhost:<span class="hljs-number">2181</span> --cluster kie-cluster <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &gt; /tmp/controller.<span class="hljs-built_in">log</span> &amp;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the security domain correctly on the application server. For example on WildFly and JBoss EAP:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the file <code>$JBOSS_HOME/domain/configuration/domain.xml</code>.</p>
<div class="paragraph">
<p>For simplicity sake, presume we use the default domain configuration which uses the profile <code>full</code> that defines two server nodes as part of <code>main-server-group</code>.</p>
</div>
</li>
<li>
<p>Locate the profile <code>full</code> and add a new security domain by copying the other security domain already defined there by default:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">security-domain</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kie-ide"</span> <span class="hljs-attribute">cache-type</span>=<span class="hljs-value">"default"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">authentication</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">login-module</span> <span class="hljs-attribute">code</span>=<span class="hljs-value">"Remoting"</span> <span class="hljs-attribute">flag</span>=<span class="hljs-value">"optional"</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-title">module-option</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"password-stacking"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"useFirstPass"</span>/&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-title">login-module</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-title">login-module</span> <span class="hljs-attribute">code</span>=<span class="hljs-value">"RealmDirect"</span> <span class="hljs-attribute">flag</span>=<span class="hljs-value">"required"</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-title">module-option</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"password-stacking"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"useFirstPass"</span>/&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-title">login-module</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">authentication</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">security-domain</span>&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The security-domain name is a magic value.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the <a href="#_wb.systemproperties">system properties</a> for the cluster on the application server. For example on WildFly and JBoss EAP:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the file <code>$JBOSS_HOME/domain/configuration/host.xml</code>.</p>
</li>
<li>
<p>Locate the XML elements <code>server</code> that belong to the <code>main-server-group</code> and add the necessary system property.</p>
<div class="paragraph">
<p>For example for nodeOne:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">system-properties</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"jboss.node.name"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"nodeOne"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.nio.git.dir"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"/tmp/kie/nodeone"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.metadata.index.dir"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"/tmp/kie/nodeone"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.cluster.id"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"kie-cluster"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.cluster.zk"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"localhost:2181"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.cluster.local.id"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"nodeOne_12345"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.cluster.vfs.lock"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"vfs-repo"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-comment">&lt;!-- If you're running both nodes on the same machine: --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.nio.git.daemon.port"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"9418"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">system-properties</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And for nodeTwo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">system-properties</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"jboss.node.name"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"nodeTwo"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.nio.git.dir"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"/tmp/kie/nodetwo"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.metadata.index.dir"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"/tmp/kie/nodetwo"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.cluster.id"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"kie-cluster"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.cluster.zk"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"localhost:2181"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.cluster.local.id"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"nodeTwo_12346"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.cluster.vfs.lock"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"vfs-repo"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
  <span class="hljs-comment">&lt;!-- If you're running both nodes on the same machine: --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"org.uberfire.nio.git.daemon.port"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"9419"</span> <span class="hljs-attribute">boot-time</span>=<span class="hljs-value">"false"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">system-properties</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure the cluster, node and resource names match those configured in Helix.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_jbpm_clustering"><a class="anchor" href="#_jbpm_clustering"></a><a class="link" href="#_jbpm_clustering">23.2. jBPM clustering</a></h3>
<div class="paragraph">
<p>In addition to the information above, jBPM clustering requires additional configuration.
See <a href="http://mswiderski.blogspot.com.br/2013/06/clustering-in-jbpm-v6.html">this blog post</a> to configure the database etc correctly.</p>
</div>
<h1 id="_kie_server" class="discrete">KIE Server</h1>
<div class="paragraph">
<p>The KIE Server is a standalone execution server for rules.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ch.kie.server"><a class="anchor" href="#_ch.kie.server"></a><a class="link" href="#_ch.kie.server">24. KIE Execution Server</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_4"><a class="anchor" href="#_overview_4"></a><a class="link" href="#_overview_4">24.1. Overview</a></h3>
<div class="paragraph">
<p>The <em>Kie Server</em> is a modular, standalone server component that can be used to instantiate and execute rules and processes.
It exposes this functionality via REST, JMS and Java interfaces to client application.
It also provides seamless integration with the <em>Kie Workbench</em>.</p>
</div>
<div class="paragraph">
<p>At its core, the <em>Kie Server</em> is a configurable web application packaged as a WAR file.
Distributions are availables for pure web containers (like Tomcat) and for JEE 6 and JEE 7 containers.</p>
</div>
<div class="paragraph">
<p>Most capabilities on the Kie Server are configurable, and based on the concepts of extensions.
Each extension can be enabled/disabled independently, allowing the user to configure the server to its need.</p>
</div>
<div class="paragraph">
<p>The current version of the Kie Server ships with two default extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BRM: provides support for the execution of Business Rules using the Drools rules engine.</p>
</li>
<li>
<p>BPM: provides support for the execution of Business Processes using the jBPM process engine. It supports:</p>
<div class="ulist">
<ul>
<li>
<p>process execution</p>
</li>
<li>
<p>task execution</p>
</li>
<li>
<p>assynchronous job execution</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both extensions enabled by default, but can be disabled by setting the corresponding property (see configuration chapter for details).</p>
</div>
<div class="paragraph">
<p>This server was designed to have a low footprint, with minimal memory consumption, and therefore, to be easily deployable on a cloud environment.
Each instance of this server can open and instantiate multiple <em>Kie Containers</em> which allows you to execute multiple services in parallel.</p>
</div>
<div class="sect3">
<h4 id="_glossary"><a class="anchor" href="#_glossary"></a><a class="link" href="#_glossary">24.1.1. Glossary</a></h4>
<div class="ulist">
<ul>
<li>
<p><strong>Kie Server</strong>: execution server purely focusing on providing runtime environment for both rules and processes. These capabilities are provided by <em>Kie Server Extensions</em>. More capabilities can be added by further extensions (e.g. customer could add his own extensions in case of missing functionality that will then use infrastructure of the KIE Server). A Kie Server instance is a standalone Kie Server executing on a given application server/web container. A Kie Server instantiates and provides support for multiple Kie Containers.</p>
</li>
<li>
<p><strong>Kie Server Extension</strong>: a "plugin" for the Kie Server that adds capabilities to the server. The Kie Server ships with two default kie server extensions: BRM and BPM.</p>
</li>
<li>
<p><strong>Kie Container</strong>: an in-memory instantiation of a kjar, allowing for the instantiation and usage of its assets (domain models, processes, rules, etc). A Kie Server exposes Kie Containers through a standard API over transport protocols like REST and JMS.</p>
</li>
<li>
<p><strong>Controller</strong>: a server-backed REST endpoint that will be responsible for managing KIE Server instances. Such end point must provide following capabilities:</p>
<div class="ulist">
<ul>
<li>
<p>respond to connect requests</p>
</li>
<li>
<p>sync all registered containers on the corresponding <em>Kie Server ID</em></p>
</li>
<li>
<p>respond to disconnect requests</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Kie Server state</strong>: currently known state of given Kie Server instance. This is a local storage (by default in file) that maintains the following information:</p>
<div class="ulist">
<ul>
<li>
<p>list of registered controllers</p>
</li>
<li>
<p>list of known containers</p>
</li>
<li>
<p>kie server configuration</p>
<div class="paragraph">
<p>The server state is persisted upon receival of events like: <em>Kie Container</em> created, <em>Kie Container</em> is disposed, controller accepts registration of <em>Kie Server</em> instance, etc.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Kie Server ID</strong>: an arbitrary assigned identifier to which configurations are assigned. At boot, each Kie Server Instance is assigned an ID, and that ID is matched to a configuration on the controller. The Kie Server Instance fetches and uses that configuration to setup itself.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_kie_server"><a class="anchor" href="#_installing_the_kie_server"></a><a class="link" href="#_installing_the_kie_server">24.2. Installing the KIE Server</a></h3>
<div class="paragraph">
<p>The KIE Server is distributed as a web application archive (WAR) file.
The WAR file comes in three different packagings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>webc</em> - WAR for ordinary Web (Servlet) containers like Tomcat</p>
</li>
<li>
<p><em>ee6</em> - WAR for JavaEE 6 containers like JBoss EAP 6.x</p>
</li>
<li>
<p><em>ee7</em> - WAR for JavaEE 7 containers like WildFly 8.x</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To install the KIE Execution Server and verify it is running, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy the WAR file into your web container.</p>
</li>
<li>
<p>Create a user with the role of <code>kie-server</code> on the container.</p>
</li>
<li>
<p>Test that you can access the execution engine by navigating to the endpoint in a browser window: <code><a href="http://server:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code>.</p>
</li>
<li>
<p>When prompted for username/password, type in the username and password that you created in step 2.</p>
</li>
<li>
<p>Once authenticated, you will see an XML response in the form of engine status, similar to this:</p>
<div class="exampleblock">
<div class="title">Example 225. Sample handshaking server response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"KIE Server info"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie-server-info</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>7.7.0.Final<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie-server-info</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">response</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_bootstrap_switches"><a class="anchor" href="#_bootstrap_switches"></a><a class="link" href="#_bootstrap_switches">24.2.1. Bootstrap switches</a></h4>
<div class="paragraph">
<p>The Kie Server accepts a number of bootstrap switches (system properties) to configure the behaviour of the server.
The following is a table of all the supported switches.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 45. Kie Server bootstrap switches</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.drools.server.ext.disabled</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean (default is "false")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, disables the BRM support (i.e. rules support).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.jbpm.server.ext.disabled</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean (default is "false")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, disables the BPM support (i.e. processes support)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.jbpm.ui.server.ext.disabled</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean (default is "false")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, disables the BPM UI support (i.e. processes image support)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.optaplanner.server.ext.disabled</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean (default is "false")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, disables the BRP support (i.e. planner support)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.executor.disabled</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean (default is "false")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, disables the BPM job executor support</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.id</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An arbitrary ID to be assigned to this server. If a remote controller is
                configured, this is the ID under which the server will connect to the controller to
                fetch the kie container configurations.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No. If not provided, an ID is automatically generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (default is "kieserver")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User name used to connect with the kieserver from the controller, required when
                running in managed mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.pwd</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (default is "kieserver1!")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password used to connect with the kieserver from the controller, required when
                running in managed mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.controller</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">comma separated list of urls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of urls to controller REST endpoint. E.g.:
                  <code><a href="http://localhost:8080/kie-wb/rest/controller" class="bare">http://localhost:8080/kie-wb/rest/controller</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes when using a controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.controller.user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (default is "kieserver")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username used to connect to the controller REST api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes when using a controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.controller.pwd</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (default is "kieserver1!")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password used to connect to the controller REST api</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes when using a controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.location</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL location of kie server instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL used by the controller to call back on this server. E.g.:
                  <code><a href="http://localhost:8230/kie-server/services/rest/server" class="bare">http://localhost:8230/kie-server/services/rest/server</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes when using a controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.domain</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JAAS LoginContext domain that shall be used to authenticate users when using
                JMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.bypass.auth.user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean (default is "false")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to bypass the authenticated user for task related operations e.g.
                queries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.repo</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid file system path (default is ".")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location on local file system where kie server state files will be
                stored</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.persistence.ds</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datasource JNDI name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes when BPM support enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.persistence.tm</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction manager platform for Hibernate properties set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes when BPM support enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.persistence.dialect</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hibernate dialect to be used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes when BPM support enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.jbpm.ht.callback</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of supported callbacks for Task Service (default jaas)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.jbpm.ht.custom.callback</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom implementation of UserGroupCallback in case org.jbpm.ht.callback was set
                to ‘custom’</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>kie.maven.settings.custom</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid file system path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of custom settings.xml for maven configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.executor.interval</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer (default is 3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of time units between polls by executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.executor.pool.size</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer (default is 1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads in the pool for async work</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.executor.retry.count</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer (default is 3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of retries to handle errors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.executor.timeunit</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeUnit (default is "SECONDS")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeUnit representing interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.executor.disabled</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean (default is "false")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables executor completely</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>kie.server.jms.queues.response</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (default is "queue/KIE.SERVER.RESPONSE")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JNDI name of response queue for JMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.kie.server.controller.connect</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long (default is 10000)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Waiting time in milliseconds between repeated attempts to connect kie server to
                controller when kie server starts up</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.drools.server.filter.classes</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean (default is "false")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, accept only classes which are annotated with @org.kie.api.remote.Remotable
                or @javax.xml.bind.annotation.XmlRootElement as extra JAXB classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are running both KIE Server and KIE Workbench you must configure KIE Server to use a different Data Source to KIE Workbench using the  <strong>org.kie.server.persistence.ds</strong> property.
KIE Workbench uses a jBPM Executor Service that can conflict with  KIE Server if they share the same Data Source.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_installation_details_for_different_containers"><a class="anchor" href="#_installation_details_for_different_containers"></a><a class="link" href="#_installation_details_for_different_containers">24.2.2. Installation details for different containers</a></h4>
<div class="sect4">
<h5 id="_tomcat_7_x_8_x"><a class="anchor" href="#_tomcat_7_x_8_x"></a><a class="link" href="#_tomcat_7_x_8_x">24.2.2.1. Tomcat 7.x/8.x</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and unzip the Tomcat distribution. Let’s call the root of the distribution <code>TOMCAT_HOME</code>. This directory is named after the Tomcat version, so for example <code>apache-tomcat-7.0.55</code>.</p>
</li>
<li>
<p>Download <em>kie-server- -webc.war</em> and place it into <code>TOMCAT_HOME/webapps</code>.</p>
</li>
<li>
<p>Configure user(s) and role(s). Make sure that file <code>TOMCAT_HOME/conf/tomcat-users.xml</code> contains the following username and role definition. You can of course choose different username and password, just make sure that the user has role <code>kie-server</code>:</p>
<div class="exampleblock">
<div class="title">Example 226. Username and role definition for Tomcat</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">role</span> <span class="hljs-attribute">rolename</span>=<span class="hljs-value">"kie-server"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">user</span> <span class="hljs-attribute">username</span>=<span class="hljs-value">"serveruser"</span> <span class="hljs-attribute">password</span>=<span class="hljs-value">"my.s3cr3t.pass"</span> <span class="hljs-attribute">roles</span>=<span class="hljs-value">"kie-server"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Start the server by running <code>TOMCAT_HOME/bin/startup.[sh|bat]</code>. You can check out the Tomcat logs in <code>TOMCAT_HOME/logs</code> to see if the application deployed successfully. Please read the table above for the bootstrap switches that can be used to properly configure the instance. For instance:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">./startup.sh -Dorg.kie.server.id=first-kie-server
             -Dorg.kie.server.location=http:<span class="hljs-comment">//localhost:8080/kie-server/services/rest/server</span></code></pre>
</div>
</div>
</li>
<li>
<p>Verify the server is running. Go to <code><a href="http://server:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code> and type the specified username and password. You should see simple XML message with basic information about the server.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can not leverage the JMS interface when running with Tomcat, or any other Web
container. The Web container version of the WAR contains only the REST interface.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_wildfly_8_x"><a class="anchor" href="#_wildfly_8_x"></a><a class="link" href="#_wildfly_8_x">24.2.2.2. WildFly 8.x</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and unzip the WildFly distribution. Let’s call the root of the distribution <code>WILDFLY_HOME</code>. This directory is named after the WildFly version, so for example <code>wildfly-8.2.0.Final</code>.</p>
</li>
<li>
<p>Download <em>kie-server- -ee7.war</em> and place it into <code>WILDFLY_HOME/standalone/deployments</code>.</p>
</li>
<li>
<p>Configure user(s) and role(s). Execute the following command <code> WILDFLY_HOME/bin/add-user.[sh|bat] -a -u 'kieserver' -p 'kieserver1!' -ro 'kie-server'</code>. You can of course choose different username and password, just make sure that the user has role <code>kie-server</code>.</p>
</li>
<li>
<p>Start the server by running <code>WILDFLY_HOME/bin/standalone.[sh|bat] -c standalone-full.xml &lt;bootstrap_switches&gt;</code>. You can check out the standard output or WildFly logs in <code>WILDFLY_HOME/standalone/logs</code> to see if the application deployed successfully. Please read the table above for the bootstrap switches that can be used to properly configure the instance. For instance:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">./standalone.sh  --server-config=standalone-full.xml
                 -Djboss.socket.binding.port-offset=<span class="hljs-number">150</span>
                 -Dorg.kie.server.id=first-kie-server
                 -Dorg.kie.server.location=http:<span class="hljs-comment">//localhost:8230/kie-server/services/rest/server</span></code></pre>
</div>
</div>
</li>
<li>
<p>Verify the server is running. Go to <code><a href="http://server:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code> and type the specified username and password. You should see simple XML message with basic information about the server.</p>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/kie-server-info.png" alt="kie server info">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie_server_setup"><a class="anchor" href="#_kie_server_setup"></a><a class="link" href="#_kie_server_setup">24.3. Kie Server setup</a></h3>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Server setup and registration changed significantly from versions 6.2 and before.
The following applies only to version 6.3 and forward.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_managed_kie_server"><a class="anchor" href="#_managed_kie_server"></a><a class="link" href="#_managed_kie_server">24.3.1. Managed Kie Server</a></h4>
<div class="paragraph">
<p>A managed instance is one that requires a controller to be available to properly startup the Kie Server instance.</p>
</div>
<div class="paragraph">
<p>A Controller is a component responsible for keeping and managing a Kie Server Configuration in centralized way.
Each controller can manager multiple configurations at once and there can be multiple controllers in the environment.
Managed KIE Servers can be configured with a list of controllers but will connect to only one at a time.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It’s important to mention that even though there can be multiple
controllers they should be kept in sync to make sure that regardless
which one of them is contacted by KIE Server instance it will provide
same set of configuration.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>At startup, if a Kie Server is configured with a list of controllers, it will try succesivelly to connect to each of them until a connection is successfully stablished with one of them.
If for any reason a connection can’t be stablished, the server will not start, even if there is local storage available with configuration.
This happens by design in order to ensure consistency.
For instance, if the Kie  Server was down and the configuration has changed, this restriction guarantees that it will run with up to date configuration or not at all.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to run the Kie Server in standalone mode, without connecting to
any controllers, please see "Unmanaged Kie Server".</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The configuration sets, among other things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kie containers to be deployed and started</p>
</li>
<li>
<p>configuration items - currently this is a place holder for further enhancements that will allow remotely configure KIE Execution Server components - timers, persistence, etc</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Controller, besides providing configuration management, is also responsible for overall management of Kie Servers.
It provides a REST api that is divided into two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the controller itself that is exposed to interact with KIE Execution Server instances</p>
</li>
<li>
<p>an administration API that allows to remotely manage Kie Server instances:</p>
<div class="ulist">
<ul>
<li>
<p>add/remove servers</p>
</li>
<li>
<p>add/remove containers to/from the servers</p>
</li>
<li>
<p>start/stop containers on servers</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The controller deals only with the Kie Server configuration or definition to put it differently.
It does not handle any runtime components of KIE Execution Server instances.
They are always considered remote to controller.
The controller is responsible for persisting the configuration to preserve restarts of the controller itself.
It should manage the synchronization as well in case multiple controllers are configured to keep all definitions up to date on all instances of the controller.</p>
</div>
<div class="paragraph">
<p>By default controller is shipped with Kie Workbench and provides a fully featured management interface (both REST api and UI). It uses underlying git repository as persistent store and thus when GIT repositories are clustered (using Apache Zookeeper and Apache Helix) it will cover the controllers synchronization as well.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/kie-server-simple-architecture.png" alt="kie server simple architecture">
</div>
</div>
<div class="paragraph">
<p>The diagram above illustrates the single controller (workbench) setup with multiple Kie Server instances managed by it.</p>
</div>
<div class="paragraph">
<p>The diagram bellow illustrates the clustered setup where there are multiple instances of controller synchronized over Zookeeper.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Drools Documentation_files/kie-server-architecture.png" alt="kie server architecture">
</div>
</div>
<div class="paragraph">
<p>In the above diagram we can see that the Kie Server instances are capable of connecting to any controllers, but they will connect to only one.
Each instance will attempt to connect to controller as long as it can reach one.
Once connection is established with one of the controllers it will skip the others.</p>
</div>
<div class="sect4">
<h5 id="_working_with_managed_servers"><a class="anchor" href="#_working_with_managed_servers"></a><a class="link" href="#_working_with_managed_servers">24.3.1.1. Working with managed servers</a></h5>
<div class="paragraph">
<p>There are two approaches that users can take when working with managed KIE Server instances:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Configuration first: </em>with this approach, a user will start working with the controller (either UI or REST api) and create and configure Kie Server definitions. That consists basically of an identification for the server definition (id and name + optionally version for improved readability) and the configuration for the Kie Containers to run on the server.</p>
</li>
<li>
<p><em>Registration first:</em> with this approach, the Kie Server instances are started first and auto register themselves on controller. The user then can configure the Kie Containers. This option simply skips the registration step done in the first approach and populates it with server id, name and version directly upon auto registration. There are no other differences between the two approaches.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unmanaged_kie_execution_server"><a class="anchor" href="#_unmanaged_kie_execution_server"></a><a class="link" href="#_unmanaged_kie_execution_server">24.3.2. Unmanaged KIE Execution Server</a></h4>
<div class="paragraph">
<p>An unmanaged Kie Server is in turn just a standalone instance, and thus must be configured individually using REST/JMS api from the Kie Server itself.
There is no controller involved.
The configuration is automatically persisted by the server into a file and that is used as the internal server state, in case of restarts.</p>
</div>
<div class="paragraph">
<p>The configuration is updated during the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deploy Kie Container</p>
</li>
<li>
<p>undeploy Kie Container</p>
</li>
<li>
<p>start Kie Container</p>
</li>
<li>
<p>stop Kie Container</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the Kie Server is restarted, it will try to restablish the same state
that was persisted before shutdown. That means that Kie Containers that were
running, will be started, but the ones that were stopped/disposed before, will not.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In most use cases, the Kie Server should be executed in managed mode as that provides some benefits, like a web user interface (if using the workbench as a controller) and some facilities for clustering.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_kie_container"><a class="anchor" href="#_creating_a_kie_container"></a><a class="link" href="#_creating_a_kie_container">24.4. Creating a Kie Container</a></h3>
<div class="paragraph">
<p>Once your Execution Server is registered, you can start adding <strong>Kie Containers</strong> to it.</p>
</div>
<div class="paragraph">
<p><strong>Kie Containers</strong> are self contained environments that have been provisioned to hold instances of your packaged and deployed rule instances.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start by clicking the <strong>\+</strong> icon next to the Execution Server where you want to deploy your Container. This will bring up the New Container screen.</p>
</li>
<li>
<p>If you know the <strong>Group Name</strong>, <strong>Artifact Id</strong> and <strong>Version</strong> (GAV) of your deployed package, then you can enter those details and click the Ok button to select that instance (and provide a name for the Container);</p>
</li>
<li>
<p>If you don’t know these values, you can search KIE Workbench for all packages that can be deployed. Click the <strong>Search</strong> button without entering any value in the search field (you can narrow your search by entering any term that you know exists in the package that you want to deploy).</p>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>INSERT SCREENSHOT HERE</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The figure above shows that there are three deployable packages available to be used as containers on the Execution Server.
Select the one that you want by clicking the Select button.
This will auto-populate the <strong>GAV</strong> and you can then click the <strong>Ok</strong> button to use this deployable as the new Container.</p>
</div>
</li>
<li>
<p>Enter a name for this Container at the top and then press the Ok button.</p>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Container name must be unique inside each execution server and must not contain any spaces.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Just below the <strong>GAV</strong> row, you will see an uneditable row that shows you the <strong>URL</strong> for your Container against which you will be able to execute REST commands.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_managing_containers"><a class="anchor" href="#_managing_containers"></a><a class="link" href="#_managing_containers">24.5. Managing Containers</a></h3>
<div class="paragraph">
<p>Containers within the Execution Server can be started, stopped and updated from within KIE Workbench.⁠</p>
</div>
<div class="sect3">
<h4 id="_starting_a_container"><a class="anchor" href="#_starting_a_container"></a><a class="link" href="#_starting_a_container">24.5.1. Starting a Container</a></h4>
<div class="paragraph">
<p>Once registered, a Container is in the 'Stopped' mode.
It can be started by first selecting it and then clicking the Start button.
You can also select multiple Containers and start them all at the same time.</p>
</div>
<div class="paragraph">
<p>Once the Container is in the 'Running' mode, a green arrow appears next to it.
If there are any errors starting the Container(s), red icons appear next to Containers and the Execution Server that they are deployed on.</p>
</div>
<div class="paragraph">
<p>You should check the logs of both the Execution Server and the current Business Central to see what the errors are before redeploying the Containers (and possibly the Execution Server).⁠</p>
</div>
</div>
<div class="sect3">
<h4 id="_stopping_and_deleting_a_container"><a class="anchor" href="#_stopping_and_deleting_a_container"></a><a class="link" href="#_stopping_and_deleting_a_container">24.5.2. Stopping and Deleting a Container</a></h4>
<div class="paragraph">
<p>Similar to starting a Container, select the Container(s) that you want to stop (or delete) and click the Stop button (which replaces the Start button for that Container once it has entered the 'Running' mode) or the Delete button.⁠</p>
</div>
</div>
<div class="sect3">
<h4 id="_updating_a_container"><a class="anchor" href="#_updating_a_container"></a><a class="link" href="#_updating_a_container">24.5.3. Updating a Container</a></h4>
<div class="paragraph">
<p>You can update deployed <code>KieContainers</code> without restarting the Execution Server.
This is useful in cases where the Business Rules change, creating new versions of packages to be provisioned.</p>
</div>
<div class="paragraph">
<p>You can have multiple versions of the same package provisioned and deployed, each to a different <code>KieContainer</code>.</p>
</div>
<div class="paragraph">
<p>To update deployments in a <code>KieContainer</code> dynamically, click on the icon next to the Container.
This will open up the Container Info screen.
An example of this screen is shown here:</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>INSERT SCREENSHOT HERE</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The Container Info screen is a useful tool because it not only allows you to see the endpoint for this <code>KieContainer</code>, but it also allows you to either manually or automatically refresh the provision if an update is available.
The update can be manual or automatic:</p>
</div>
<div class="paragraph">
<p><strong>Manual Update:</strong> To manually update a <code>KieContainer</code>, enter the new Version number in the Version box and click on the <strong>Update</strong> button.
You can of course, update the Group Id or the Artifact Id , if these have changed as well.
Once updated, the Execution server updates the container and shows you the resolved GAV attributes at the bottom of the screen in the <strong>Resolved Release Id</strong> section.</p>
</div>
<div class="paragraph">
<p><strong>Automatic Update:</strong> If you want a deployed Container to always have the latest version of your deployment without manually editing it, you will need to set the Version property to the value of <code>LATEST</code> and start a <code>Scanner</code>.
This will ensure that the deployed provision always contains the latest version.
The Scanner can be started just once on demand by clicking the Scan Now button or you can start it in the background with scans happening at a specified interval (in milliseconds).You can also set this value to <code>LATEST</code> when you are first creating this deployment.
The <strong>Resolved Release
                            Id</strong> in this case will show you the actual, latest version number.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie.ksrestapi"><a class="anchor" href="#_kie.ksrestapi"></a><a class="link" href="#_kie.ksrestapi">24.6. Kie Server REST API</a></h3>
<div class="paragraph">
<p>The Execution Server supports the following commands via the REST API.</p>
</div>
<div class="paragraph">
<p>Please note the following before using these commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The base URL for these will remain as the endpoint defined earlier (for example: <code><a href="http://server:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code> )</p>
</li>
<li>
<p>All requests require basic HTTP Authentication for the role kie-server as indicated earlier.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="__get"><a class="anchor" href="#__get"></a><a class="link" href="#__get">24.6.1. [GET] /</a></h4>
<div class="paragraph">
<p>Returns the Execution Server information</p>
</div>
<div class="exampleblock">
<div class="title">Example 227. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"KIE Server info"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie-server-info</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>6.2.0.redhat-1<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie-server-info</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">response</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__post_config"><a class="anchor" href="#__post_config"></a><a class="link" href="#__post_config">24.6.2. [POST] /config</a></h4>
<div class="paragraph">
<p>Using POST HTTP method, you can execute various commands on the Execution Server.
E.g: create-container, list-containers, dispose-container and call-container.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CreateContainerCommand</p>
</li>
<li>
<p>GetServerInfoCommand</p>
</li>
<li>
<p>ListContainersCommand</p>
</li>
<li>
<p>CallContainerCommand</p>
</li>
<li>
<p>DisposeContainerCommand</p>
</li>
<li>
<p>GetContainerInfoCommand</p>
</li>
<li>
<p>GetScannerInfoCommand</p>
</li>
<li>
<p>UpdateScannerCommand</p>
</li>
<li>
<p>UpdateReleaseIdCommand</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The commands itself can be found in the <code>org.kie.server.api.commands</code> package.</p>
</div>
</div>
<div class="sect3">
<h4 id="__get_containers"><a class="anchor" href="#__get_containers"></a><a class="link" href="#__get_containers">24.6.3. [GET] /containers</a></h4>
<div class="paragraph">
<p>Returns a list of containers that have been created on this Execution Server.</p>
</div>
<div class="exampleblock">
<div class="title">Example 228. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"List of created containers"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie-containers</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie-container</span> <span class="hljs-attribute">container-id</span>=<span class="hljs-value">"MyProjectContainer"</span> <span class="hljs-attribute">status</span>=<span class="hljs-value">"STARTED"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>Project1<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>com.redhat<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">resolved-release-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>Project1<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>com.redhat<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">resolved-release-id</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie-container</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie-containers</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">response</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The endpoint supports also filtering based on <code>ReleaseId</code> and <code>container status</code>. Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/containers?groupId=org.example</code> - returns only containers with the specified groupId</p>
</li>
<li>
<p><code>/containers?groupId=org.example&amp;artifactId=project1&amp;version=1.0.0.Final</code> - returns only containers with the specified <code>ReleaseId</code></p>
</li>
<li>
<p><code>/containers?status=started,failed</code> - returns containers which are either started or failed</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="__get_containers_id"><a class="anchor" href="#__get_containers_id"></a><a class="link" href="#__get_containers_id">24.6.4. ⁠[GET] /containers/{id}</a></h4>
<div class="paragraph">
<p>Returns the status and information about a particular container.
For example, executing <code><a href="http://server:PORT/CONTEXT/services/rest/server/containers/MyProjectContainer" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/containers/MyProjectContainer</a></code> could return the following example container info.</p>
</div>
<div class="exampleblock">
<div class="title">Example 229. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">⁠<span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"Info for container MyProjectContainer"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie-container</span> <span class="hljs-attribute">container-id</span>=<span class="hljs-value">"MyProjectContainer"</span> <span class="hljs-attribute">status</span>=<span class="hljs-value">"STARTED"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>Project1<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>com.redhat<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">resolved-release-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>Project1<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>com.redhat<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">resolved-release-id</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie-container</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">response</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__put_containers_id"><a class="anchor" href="#__put_containers_id"></a><a class="link" href="#__put_containers_id">24.6.5. [PUT] /containers/{id}</a></h4>
<div class="paragraph">
<p>Allows you to create a new Container in the Execution Server.
For example, to create a Container with the id of <strong>MyRESTContainer</strong> the complete endpoint will be: <code><a href="http://server:PORT/CONTEXT/services/rest/server/containers/MyRESTContainer" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/containers/MyRESTContainer</a></code>.
An example of request is:⁠</p>
</div>
<div class="exampleblock">
<div class="title">Example 230. Example Request to create a container</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie-container</span> <span class="hljs-attribute">container-id</span>=<span class="hljs-value">"MyRESTContainer"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>Project1<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>com.redhat<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie-container</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>And the response from the server, if successful, would be be:</p>
</div>
<div class="exampleblock">
<div class="title">Example 231. Example Server Response when creating a container</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"Container MyRESTContainer successfully deployed with module com.redhat:Project1:1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie-container</span> <span class="hljs-attribute">container-id</span>=<span class="hljs-value">"MyProjectContainer"</span> <span class="hljs-attribute">status</span>=<span class="hljs-value">"STARTED"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>Project1<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>com.redhat<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">resolved-release-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>Project1<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>com.redhat<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">resolved-release-id</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">kie-container</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">response</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__delete_containers_id"><a class="anchor" href="#__delete_containers_id"></a><a class="link" href="#__delete_containers_id">24.6.6. [DELETE] /containers/{id}</a></h4>
<div class="paragraph">
<p>⁠Disposes the Container specified by the id.
For example, executing <code><a href="http://server:PORT/CONTEXT/services/rest/server/containers/MyProjectContainer" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/containers/MyProjectContainer</a></code> using the DELETE HTTP method will return the following server response:⁠</p>
</div>
<div class="exampleblock">
<div class="title">Example 232. Example Server Response disposing a container</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"Container MyProjectContainer successfully disposed."</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__post_containers_instances_id"><a class="anchor" href="#__post_containers_instances_id"></a><a class="link" href="#__post_containers_instances_id">24.6.7. [POST] /containers/instances/{id}</a></h4>
<div class="paragraph">
<p>Executes operations and commands against the specified Container.
You can send commands to this Container in the body of the POST request.
For example, to fire all rules for Container with id MyRESTContainer (<code><a href="http://server:PORT/CONTEXT/services/rest/server/containers/instances/MyRESTContainer" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/containers/instances/MyRESTContainer</a></code>), you would send the fire-all-rules command to it as shown below (in the body of the POST request):</p>
</div>
<div class="exampleblock">
<div class="title">Example 233. Example Server Request to fire all rules</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">fire-all-rules</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Following is the list of supported commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AgendaGroupSetFocusCommand</p>
</li>
<li>
<p>ClearActivationGroupCommand</p>
</li>
<li>
<p>ClearAgendaCommand</p>
</li>
<li>
<p>ClearAgendaGroupCommand</p>
</li>
<li>
<p>ClearRuleFlowGroupCommand</p>
</li>
<li>
<p>DeleteCommand</p>
</li>
<li>
<p>InsertObjectCommand</p>
</li>
<li>
<p>ModifyCommand</p>
</li>
<li>
<p>GetObjectCommand</p>
</li>
<li>
<p>InsertElementsCommand</p>
</li>
<li>
<p>FireAllRulesCommand</p>
</li>
<li>
<p>QueryCommand</p>
</li>
<li>
<p>SetGlobalCommand</p>
</li>
<li>
<p>GetGlobalCommand</p>
</li>
<li>
<p>GetObjectsCommand</p>
</li>
<li>
<p>BatchExecutionCommand</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These commands can be found in the <code>org.drools.core.command.runtime</code> package.</p>
</div>
</div>
<div class="sect3">
<h4 id="__get_containers_id_release_id"><a class="anchor" href="#__get_containers_id_release_id"></a><a class="link" href="#__get_containers_id_release_id">24.6.8. [GET] /containers/{id}/release-id</a></h4>
<div class="paragraph">
<p>Returns the full release id for the Container specified by the id.</p>
</div>
<div class="exampleblock">
<div class="title">Example 234. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">⁠<span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"ReleaseId for container MyProjectContainer"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>Project1<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>com.redhat<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">response</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__post_containers_id_release_id"><a class="anchor" href="#__post_containers_id_release_id"></a><a class="link" href="#__post_containers_id_release_id">24.6.9. [POST] /containers/{id}/release-id</a></h4>
<div class="paragraph">
<p>Allows you to update the release id of the container deployment.
Send the new complete release id to the Server.</p>
</div>
<div class="exampleblock">
<div class="title">Example 235. Example Server Request</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>Project1<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>com.redhat<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.1<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Server will respond with a success or error message, similar to the one below:⁠</p>
</div>
<div class="exampleblock">
<div class="title">Example 236. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"Release id successfully updated."</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>Project1<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>com.redhat<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">response</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__get_containers_id_scanner"><a class="anchor" href="#__get_containers_id_scanner"></a><a class="link" href="#__get_containers_id_scanner">24.6.10. [GET] /containers/{id}/scanner</a></h4>
<div class="paragraph">
<p>Returns information about the scanner for this Container’s automatic updates.⁠</p>
</div>
<div class="exampleblock">
<div class="title">Example 237. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"Scanner info successfully retrieved"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie-scanner</span> <span class="hljs-attribute">status</span>=<span class="hljs-value">"DISPOSED"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">response</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__post_containers_id_scanner"><a class="anchor" href="#__post_containers_id_scanner"></a><a class="link" href="#__post_containers_id_scanner">24.6.11. [POST] /containers/{id}/scanner</a></h4>
<div class="paragraph">
<p>Allows you to start or stop a scanner that controls polling for updated Container deployments.
To start the scanner, send a request similar to: <code><a href="http://server:PORT/CONTEXT/services/rest/server/containers/%7Bcontainer-id%7D/scanner" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/containers/{container-id}/scanner</a></code> with the following POST data.⁠</p>
</div>
<div class="exampleblock">
<div class="title">Example 238. Example Server Request to start the scanner</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie-scanner</span> <span class="hljs-attribute">status</span>=<span class="hljs-value">"STARTED"</span> <span class="hljs-attribute">poll-interval</span>=<span class="hljs-value">"2000"</span>/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>⁠The poll-interval attribute is in milliseconds.
The response from the server will be similar to:⁠</p>
</div>
<div class="exampleblock">
<div class="title">Example 239. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"Kie scanner successfully created."</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">kie-scanner</span> <span class="hljs-attribute">status</span>=<span class="hljs-value">"STARTED"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">response</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To stop the Scanner, replace the status with <code>DISPOSED</code> and remove the poll-interval attribute.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_optaplanner_rest_api"><a class="anchor" href="#_optaplanner_rest_api"></a><a class="link" href="#_optaplanner_rest_api">24.7. OptaPlanner REST API</a></h3>
<div class="paragraph">
<p>The Kie Server supports the following Planner REST APIs.
All these APIs are also available through JMS and the Java client API.
Please also note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The base URL for these will remain as the endpoint defined earlier (for example <code><a href="http://server:PORT/CONTEXT/services/rest/server/" class="bare">http://SERVER:PORT/CONTEXT/services/rest/server/</a></code>).</p>
</li>
<li>
<p>All requests require basic HTTP Authentication for the role kie-server as indicated earlier.</p>
</li>
<li>
<p>To get a specific marshalling format, add the HTTP headers <code>Content-Type</code> and optional <code>X-KIE-ContentType</code> in the HTTP request. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs http"><span class="hljs-attribute">Content-Type</span>: <span class="hljs-string">application/xml</span>
<span class="hljs-attribute">X-KIE-ContentType</span>: <span class="hljs-string">xstream</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>X-KIE-ContentType</code> supports the following values: <code>xstream</code>, <code>xml</code>, <code>json</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The requests and responses in the example below assume that a Kie Container is built using the optacloud example of Planner Workbench, by calling a <code>PUT</code> on <code>/services/rest/server/containers/optacloud-kiecontainer-1</code> with this content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">kie-container</span> <span class="hljs-attribute">container-id</span>=<span class="hljs-value">"optacloud-kiecontainer-1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>opta<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>optacloud<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">kie-container</span>&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="__get_containers_2"><a class="anchor" href="#__get_containers_2"></a><a class="link" href="#__get_containers_2">24.7.1. [GET] /containers</a></h4>
<div class="paragraph">
<p>Returns the list of created containers.</p>
</div>
<div class="exampleblock">
<div class="title">Example 240. Example Server Response (XStream)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">response</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"SUCCESS"</span> <span class="hljs-attribute">msg</span>=<span class="hljs-value">"List of created containers"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">result</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"kie-containers"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">kie-container</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>optacloud-kiecontainer-1<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>optacloud<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>optacloud<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">resolved-release-id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>optacloud<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>optacloud<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">resolved-release-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>STARTED<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">scanner</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>DISPOSED<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">scanner</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">kie-container</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">result</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">response</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__put_containers_containerid_solvers_solverid"><a class="anchor" href="#__put_containers_containerid_solvers_solverid"></a><a class="link" href="#__put_containers_containerid_solvers_solverid">24.7.2. [PUT] /containers/{containerId}/solvers/{solverId}</a></h4>
<div class="paragraph">
<p>Creates a new solver with the given <code>{solverId}</code> in the container <code>{containerId}</code>.
The request’s body is a marshalled SolverInstance entity that must specify the solver configuration file.</p>
</div>
<div class="paragraph">
<p>The following is an example of the request and the corresponding response.</p>
</div>
<div class="exampleblock">
<div class="title">Example 241. Example Server Request (XStream)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">solver-instance</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">solver-config-file</span>&gt;</span>optacloud/optacloud/cloudSolverConfig.solver.xml<span class="hljs-tag">&lt;/<span class="hljs-title">solver-config-file</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">solver-instance</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 242. Example Server Response (XStream)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">solver-instance</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>optacloud-kiecontainer-1<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">solver-id</span>&gt;</span>solver1<span class="hljs-tag">&lt;/<span class="hljs-title">solver-id</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">solver-config-file</span>&gt;</span>optacloud/optacloud/cloudSolverConfig.solver.xml<span class="hljs-tag">&lt;/<span class="hljs-title">solver-config-file</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>NOT_SOLVING<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">score</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">solver-instance</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__get_containers_containerid_solvers"><a class="anchor" href="#__get_containers_containerid_solvers"></a><a class="link" href="#__get_containers_containerid_solvers">24.7.3. [GET] /containers/{containerId}/solvers</a></h4>
<div class="paragraph">
<p>Returns the list of solvers created in the container.</p>
</div>
<div class="exampleblock">
<div class="title">Example 243. Example Server Response (XStream)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">org.kie.server.api.model.instance.SolverInstanceList</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">solvers</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">solver-instance</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>optacloud-kiecontainer-1<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">solver-id</span>&gt;</span>solver2<span class="hljs-tag">&lt;/<span class="hljs-title">solver-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">solver-config-file</span>&gt;</span>optacloud/optacloud/cloudSolverConfig2.solver.xml<span class="hljs-tag">&lt;/<span class="hljs-title">solver-config-file</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>NOT_SOLVING<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">score</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">solver-instance</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">solver-instance</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>optacloud-kiecontainer-1<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">solver-id</span>&gt;</span>solver1<span class="hljs-tag">&lt;/<span class="hljs-title">solver-id</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">solver-config-file</span>&gt;</span>optacloud/optacloud/cloudSolverConfig.solver.xml<span class="hljs-tag">&lt;/<span class="hljs-title">solver-config-file</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>NOT_SOLVING<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">score</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">solver-instance</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">solvers</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">org.kie.server.api.model.instance.SolverInstanceList</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__get_containers_containerid_solvers_solverid"><a class="anchor" href="#__get_containers_containerid_solvers_solverid"></a><a class="link" href="#__get_containers_containerid_solvers_solverid">24.7.4. [GET] /containers/{containerId}/solvers/{solverId}</a></h4>
<div class="paragraph">
<p>Returns the current state of the solver <code>{solverId}</code> in container <code>{containerId}</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 244. Example Server Response (XStream)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">solver-instance</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>optacloud-kiecontainer-1<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">solver-id</span>&gt;</span>solver1<span class="hljs-tag">&lt;/<span class="hljs-title">solver-id</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">solver-config-file</span>&gt;</span>optacloud/optacloud/cloudSolverConfig.solver.xml<span class="hljs-tag">&lt;/<span class="hljs-title">solver-config-file</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>NOT_SOLVING<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">score</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">solver-instance</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__post_containers_containerid_solvers_solverid_state_solving"><a class="anchor" href="#__post_containers_containerid_solvers_solverid_state_solving"></a><a class="link" href="#__post_containers_containerid_solvers_solverid_state_solving">24.7.5. [POST] /containers/{containerId}/solvers/{solverId}/state/solving</a></h4>
<div class="paragraph">
<p>Starts the solver {solverId} in container {containerId} if it is not executing yet.
The request’s body is a marshalled <code>PlanningSolution</code> to be optimized.</p>
</div>
<div class="paragraph">
<p>The following is an example to solve the OptaCloud problem with 2 computers and 6 processes.
The solver runs asynchronously. Send a request to the bestsolution URL to get the best solution.</p>
</div>
<div class="exampleblock">
<div class="title">Example 245. Example Server Request (XStream)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.CloudSolution</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">computerList</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Computer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"3"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">cpuPower</span>&gt;</span>24<span class="hljs-tag">&lt;/<span class="hljs-title">cpuPower</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">memory</span>&gt;</span>96<span class="hljs-tag">&lt;/<span class="hljs-title">memory</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">networkBandwidth</span>&gt;</span>16<span class="hljs-tag">&lt;/<span class="hljs-title">networkBandwidth</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">cost</span>&gt;</span>4800<span class="hljs-tag">&lt;/<span class="hljs-title">cost</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Computer</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Computer</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"4"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">cpuPower</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">cpuPower</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">memory</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-title">memory</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">networkBandwidth</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">networkBandwidth</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">cost</span>&gt;</span>660<span class="hljs-tag">&lt;/<span class="hljs-title">cost</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Computer</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">computerList</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">processList</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"5"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"6"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"7"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"8"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"9"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"10"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"11"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">processList</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.CloudSolution</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 246. Example Server Request (JAXB)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes" ?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">cloudSolution</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">computerList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">cost</span>&gt;</span>4800<span class="hljs-tag">&lt;/<span class="hljs-title">cost</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">cpuPower</span>&gt;</span>24<span class="hljs-tag">&lt;/<span class="hljs-title">cpuPower</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">memory</span>&gt;</span>96<span class="hljs-tag">&lt;/<span class="hljs-title">memory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">networkBandwidth</span>&gt;</span>16<span class="hljs-tag">&lt;/<span class="hljs-title">networkBandwidth</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">computerList</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">computerList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">cost</span>&gt;</span>660<span class="hljs-tag">&lt;/<span class="hljs-title">cost</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">cpuPower</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">cpuPower</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">memory</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-title">memory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">networkBandwidth</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">networkBandwidth</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">computerList</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">processList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">processList</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">processList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">processList</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">processList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">processList</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">processList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">processList</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">processList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">processList</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">processList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">processList</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">cloudSolution</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 247. Example Server Request (JSON)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "<span class="hljs-attribute">optacloud.optacloud.CloudSolution</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">computerList</span>": <span class="hljs-value">[
      {
        "<span class="hljs-attribute">cpuPower</span>": <span class="hljs-value"><span class="hljs-number">24</span></span>,
        "<span class="hljs-attribute">memory</span>": <span class="hljs-value"><span class="hljs-number">96</span></span>,
        "<span class="hljs-attribute">networkBandwidth</span>": <span class="hljs-value"><span class="hljs-number">16</span></span>,
        "<span class="hljs-attribute">cost</span>": <span class="hljs-value"><span class="hljs-number">4800</span>
      </span>},
      {
        "<span class="hljs-attribute">cpuPower</span>": <span class="hljs-value"><span class="hljs-number">6</span></span>,
        "<span class="hljs-attribute">memory</span>": <span class="hljs-value"><span class="hljs-number">4</span></span>,
        "<span class="hljs-attribute">networkBandwidth</span>": <span class="hljs-value"><span class="hljs-number">6</span></span>,
        "<span class="hljs-attribute">cost</span>": <span class="hljs-value"><span class="hljs-number">660</span>
      </span>}
    ]</span>,
    "<span class="hljs-attribute">processList</span>": <span class="hljs-value">[
      {
        "<span class="hljs-attribute">requiredCpuPower</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
        "<span class="hljs-attribute">requiredMemory</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
        "<span class="hljs-attribute">requiredNetworkBandwidth</span>": <span class="hljs-value"><span class="hljs-number">1</span>
      </span>},
      {
        "<span class="hljs-attribute">requiredCpuPower</span>": <span class="hljs-value"><span class="hljs-number">3</span></span>,
        "<span class="hljs-attribute">requiredMemory</span>": <span class="hljs-value"><span class="hljs-number">6</span></span>,
        "<span class="hljs-attribute">requiredNetworkBandwidth</span>": <span class="hljs-value"><span class="hljs-number">1</span>
      </span>},
      {
        "<span class="hljs-attribute">requiredCpuPower</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
        "<span class="hljs-attribute">requiredMemory</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
        "<span class="hljs-attribute">requiredNetworkBandwidth</span>": <span class="hljs-value"><span class="hljs-number">3</span>
      </span>},
      {
        "<span class="hljs-attribute">requiredCpuPower</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
        "<span class="hljs-attribute">requiredMemory</span>": <span class="hljs-value"><span class="hljs-number">2</span></span>,
        "<span class="hljs-attribute">requiredNetworkBandwidth</span>": <span class="hljs-value"><span class="hljs-number">11</span>
      </span>},
      {
        "<span class="hljs-attribute">requiredCpuPower</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
        "<span class="hljs-attribute">requiredMemory</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
        "<span class="hljs-attribute">requiredNetworkBandwidth</span>": <span class="hljs-value"><span class="hljs-number">1</span>
      </span>},
      {
        "<span class="hljs-attribute">requiredCpuPower</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
        "<span class="hljs-attribute">requiredMemory</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
        "<span class="hljs-attribute">requiredNetworkBandwidth</span>": <span class="hljs-value"><span class="hljs-number">5</span>
      </span>}
    ]
  </span>}
</span>}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__post_containers_containerid_solvers_solverid_state_terminating_early"><a class="anchor" href="#__post_containers_containerid_solvers_solverid_state_terminating_early"></a><a class="link" href="#__post_containers_containerid_solvers_solverid_state_terminating_early">24.7.6. [POST] /containers/{containerId}/solvers/{solverId}/state/terminating-early</a></h4>
<div class="paragraph">
<p>Requests the solver to terminate early, if it is running.
This does not delete the solver, the best solution can still be retrieved.</p>
</div>
</div>
<div class="sect3">
<h4 id="__get_containers_containerid_solvers_solverid_bestsolution"><a class="anchor" href="#__get_containers_containerid_solvers_solverid_bestsolution"></a><a class="link" href="#__get_containers_containerid_solvers_solverid_bestsolution">24.7.7. [GET] /containers/{containerId}/solvers/{solverId}/bestsolution</a></h4>
<div class="paragraph">
<p>Returns the best solution found at the time the request is made.
If the solver has not terminated yet (so the <code>status</code> field is still <code>SOLVING</code>), it will return the best solution found up to then, but later calls can return a better solution.⁠</p>
</div>
<div class="exampleblock">
<div class="title">Example 248. Example Server Response (XStream)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-tag">&lt;<span class="hljs-title">solver-instance</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>optacloud-kiecontainer-1<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">solver-id</span>&gt;</span>solver1<span class="hljs-tag">&lt;/<span class="hljs-title">solver-id</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">solver-config-file</span>&gt;</span>optacloud/optacloud/cloudSolverConfig.solver.xml<span class="hljs-tag">&lt;/<span class="hljs-title">solver-config-file</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>NOT_SOLVING<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">score</span> <span class="hljs-attribute">scoreClass</span>=<span class="hljs-value">"org.optaplanner.core.api.score.buildin.hardsoft.HardSoftScore"</span>&gt;</span>0hard/-5460soft<span class="hljs-tag">&lt;/<span class="hljs-title">score</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">best-solution</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"optacloud.optacloud.CloudSolution"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">computerList</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Computer</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">cpuPower</span>&gt;</span>24<span class="hljs-tag">&lt;/<span class="hljs-title">cpuPower</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">memory</span>&gt;</span>96<span class="hljs-tag">&lt;/<span class="hljs-title">memory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">networkBandwidth</span>&gt;</span>16<span class="hljs-tag">&lt;/<span class="hljs-title">networkBandwidth</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">cost</span>&gt;</span>4800<span class="hljs-tag">&lt;/<span class="hljs-title">cost</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Computer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Computer</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">cpuPower</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">cpuPower</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">memory</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-title">memory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">networkBandwidth</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">networkBandwidth</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">cost</span>&gt;</span>660<span class="hljs-tag">&lt;/<span class="hljs-title">cost</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Computer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">computerList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">processList</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">computer</span> <span class="hljs-attribute">reference</span>=<span class="hljs-value">"../../../computerList/optacloud.optacloud.Computer[2]"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">computer</span> <span class="hljs-attribute">reference</span>=<span class="hljs-value">"../../../computerList/optacloud.optacloud.Computer"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">computer</span> <span class="hljs-attribute">reference</span>=<span class="hljs-value">"../../../computerList/optacloud.optacloud.Computer"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">computer</span> <span class="hljs-attribute">reference</span>=<span class="hljs-value">"../../../computerList/optacloud.optacloud.Computer"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">computer</span> <span class="hljs-attribute">reference</span>=<span class="hljs-value">"../../../computerList/optacloud.optacloud.Computer"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredCpuPower</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredCpuPower</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredMemory</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">requiredMemory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-title">requiredNetworkBandwidth</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">computer</span> <span class="hljs-attribute">reference</span>=<span class="hljs-value">"../../../computerList/optacloud.optacloud.Computer[2]"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">optacloud.optacloud.Process</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">processList</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">score</span>&gt;</span>0hard/-5460soft<span class="hljs-tag">&lt;/<span class="hljs-title">score</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">best-solution</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">solver-instance</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__post_containers_containerid_solvers_solverid_problemfactchanges"><a class="anchor" href="#__post_containers_containerid_solvers_solverid_problemfactchanges"></a><a class="link" href="#__post_containers_containerid_solvers_solverid_problemfactchanges">24.7.8. [POST] /containers/{containerId}/solvers/{solverId}/problemfactchanges</a></h4>
<div class="paragraph">
<p>Real-time planning feature.
Submits one or multiple ProblemFactChanges to update the dataset the solver currently optimizes.</p>
</div>
</div>
<div class="sect3">
<h4 id="__get_containers_containerid_solvers_solverid_problemfactchanges_processed"><a class="anchor" href="#__get_containers_containerid_solvers_solverid_problemfactchanges_processed"></a><a class="link" href="#__get_containers_containerid_solvers_solverid_problemfactchanges_processed">24.7.9. [GET] /containers/{containerId}/solvers/{solverId}/problemfactchanges/processed</a></h4>
<div class="paragraph">
<p>Real-time planning feature.
Returns true if the solver processed all ProblemFactChanges that had been submitted. Returns false otherwise.</p>
</div>
</div>
<div class="sect3">
<h4 id="__delete_containers_containerid_solvers_solverid"><a class="anchor" href="#__delete_containers_containerid_solvers_solverid"></a><a class="link" href="#__delete_containers_containerid_solvers_solverid">24.7.10. [DELETE] /containers/{containerId}/solvers/{solverId}</a></h4>
<div class="paragraph">
<p>⁠Disposes the solver <code>{solverId}</code> in container <code>{containerId}</code>.
If it has not terminated yet, it terminates it first.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_controller_rest_api"><a class="anchor" href="#_controller_rest_api"></a><a class="link" href="#_controller_rest_api">24.8. Controller REST API</a></h3>
<div class="paragraph">
<p>When you have Managed Kie Server setup, you need to manage Kie Servers and Containers via a Controller.
Generally, it’s done by workbench UI but you may also use Controller REST API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The controller base URL is provided by kie-wb war deployment, which would be the same as org.kie.server.controller property. (for example: <code><a href="http://localhost:8080/kie-wb/rest/controller" class="bare">http://localhost:8080/kie-wb/rest/controller</a></code> )</p>
</li>
<li>
<p>All requests require basic HTTP Authentication for the role kie-server as indicated earlier.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="__get_management_servers"><a class="anchor" href="#__get_management_servers"></a><a class="link" href="#__get_management_servers">24.8.1. [GET] /management/servers</a></h4>
<div class="paragraph">
<p>Returns a list of Kie Server templates</p>
</div>
<div class="exampleblock">
<div class="title">Example 249. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">server-template-list</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">server-template</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-id</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-name</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">container-specs</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>hr<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">container-name</span>&gt;</span>hr<span class="hljs-tag">&lt;/<span class="hljs-title">container-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">server-template-key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">server-id</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-id</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">server-template-key</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>HR<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>org.jbpm<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">configs</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">entry</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>RULE<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"ruleConfig"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">scanner-status</span>&gt;</span>STOPPED<span class="hljs-tag">&lt;/<span class="hljs-title">scanner-status</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">entry</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">entry</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>PROCESS<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"processConfig"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">strategy</span>&gt;</span>Singleton<span class="hljs-tag">&lt;/<span class="hljs-title">strategy</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">kie-base-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">kie-base-name</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">kie-session-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">kie-session-name</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">merge-mode</span>&gt;</span>Merge Collections<span class="hljs-tag">&lt;/<span class="hljs-title">merge-mode</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">entry</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">configs</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>STARTED<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">container-specs</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">configs</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-instances</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">server-instance-id</span>&gt;</span>demo@localhost:8230<span class="hljs-tag">&lt;/<span class="hljs-title">server-instance-id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">server-name</span>&gt;</span>demo@localhost:8230<span class="hljs-tag">&lt;/<span class="hljs-title">server-name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">server-template-id</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-template-id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">server-url</span>&gt;</span>http://localhost:8230/kie-server/services/rest/server<span class="hljs-tag">&lt;/<span class="hljs-title">server-url</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">server-instances</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">capabilities</span>&gt;</span>RULE<span class="hljs-tag">&lt;/<span class="hljs-title">capabilities</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">capabilities</span>&gt;</span>PROCESS<span class="hljs-tag">&lt;/<span class="hljs-title">capabilities</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">capabilities</span>&gt;</span>PLANNING<span class="hljs-tag">&lt;/<span class="hljs-title">capabilities</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">server-template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">server-template-list</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__get_management_server_id"><a class="anchor" href="#__get_management_server_id"></a><a class="link" href="#__get_management_server_id">24.8.2. [GET] /management/server/{id}</a></h4>
<div class="paragraph">
<p>Returns a Kie Server template</p>
</div>
<div class="exampleblock">
<div class="title">Example 250. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">server-template-details</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">server-id</span>&gt;</span>product-demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">server-name</span>&gt;</span>product-demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">container-specs</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>hr<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">container-name</span>&gt;</span>hr<span class="hljs-tag">&lt;/<span class="hljs-title">container-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-template-key</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">server-id</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-id</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">server-template-key</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>HR<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>org.jbpm<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">configs</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">entry</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>RULE<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"ruleConfig"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">scanner-status</span>&gt;</span>STOPPED<span class="hljs-tag">&lt;/<span class="hljs-title">scanner-status</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">entry</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">entry</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>PROCESS<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"processConfig"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">strategy</span>&gt;</span>Singleton<span class="hljs-tag">&lt;/<span class="hljs-title">strategy</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">kie-base-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">kie-base-name</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">kie-session-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">kie-session-name</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">merge-mode</span>&gt;</span>Merge Collections<span class="hljs-tag">&lt;/<span class="hljs-title">merge-mode</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">entry</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">configs</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>STARTED<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">container-specs</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">configs</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">server-instances</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-instance-id</span>&gt;</span>demo@localhost:8230<span class="hljs-tag">&lt;/<span class="hljs-title">server-instance-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-name</span>&gt;</span>demo@localhost:8230<span class="hljs-tag">&lt;/<span class="hljs-title">server-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-template-id</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-template-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-url</span>&gt;</span>http://localhost:8230/kie-server/services/rest/server<span class="hljs-tag">&lt;/<span class="hljs-title">server-url</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">server-instances</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">capabilities</span>&gt;</span>RULE<span class="hljs-tag">&lt;/<span class="hljs-title">capabilities</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">capabilities</span>&gt;</span>PROCESS<span class="hljs-tag">&lt;/<span class="hljs-title">capabilities</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">capabilities</span>&gt;</span>PLANNING<span class="hljs-tag">&lt;/<span class="hljs-title">capabilities</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">server-template-details</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__put_management_server_id"><a class="anchor" href="#__put_management_server_id"></a><a class="link" href="#__put_management_server_id">24.8.3. [PUT] /management/server/{id}</a></h4>
<div class="paragraph">
<p>Creates a new Kie Server template with the specified id</p>
</div>
<div class="exampleblock">
<div class="title">Example 251. Example Request to create a new Kie Server template</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">server-template-details</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">server-id</span>&gt;</span>test-demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">server-name</span>&gt;</span>test-demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">configs</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">capabilities</span>&gt;</span>RULE<span class="hljs-tag">&lt;/<span class="hljs-title">capabilities</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">capabilities</span>&gt;</span>PROCESS<span class="hljs-tag">&lt;/<span class="hljs-title">capabilities</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">capabilities</span>&gt;</span>PLANNING<span class="hljs-tag">&lt;/<span class="hljs-title">capabilities</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">server-template-details</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__delete_management_server_id"><a class="anchor" href="#__delete_management_server_id"></a><a class="link" href="#__delete_management_server_id">24.8.4. [DELETE] /management/server/{id}</a></h4>
<div class="paragraph">
<p>Deletes a Kie Server template with the specified id</p>
</div>
</div>
<div class="sect3">
<h4 id="__get_management_server_id_containers"><a class="anchor" href="#__get_management_server_id_containers"></a><a class="link" href="#__get_management_server_id_containers">24.8.5. [GET] /management/server/{id}/containers</a></h4>
<div class="paragraph">
<p>Returns all containers on given server</p>
</div>
<div class="exampleblock">
<div class="title">Example 252. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">container-spec-list</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">container-spec</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>hr<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">container-name</span>&gt;</span>hr<span class="hljs-tag">&lt;/<span class="hljs-title">container-name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-template-key</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">server-id</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-id</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">server-template-key</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>HR<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>org.jbpm<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">configs</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">entry</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>RULE<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"ruleConfig"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">scanner-status</span>&gt;</span>STOPPED<span class="hljs-tag">&lt;/<span class="hljs-title">scanner-status</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">entry</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">entry</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>PROCESS<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"processConfig"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">strategy</span>&gt;</span>Singleton<span class="hljs-tag">&lt;/<span class="hljs-title">strategy</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">kie-base-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">kie-base-name</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">kie-session-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">kie-session-name</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">merge-mode</span>&gt;</span>Merge Collections<span class="hljs-tag">&lt;/<span class="hljs-title">merge-mode</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">entry</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">configs</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>STARTED<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">container-spec</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">container-spec-list</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__get_management_server_id_containers_containerid"><a class="anchor" href="#__get_management_server_id_containers_containerid"></a><a class="link" href="#__get_management_server_id_containers_containerid">24.8.6. [GET] /management/server/{id}/containers/{containerId}</a></h4>
<div class="paragraph">
<p>Returns the Container information including its release id and configuration</p>
</div>
<div class="exampleblock">
<div class="title">Example 253. Example Server Response</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">container-spec-details</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>hr<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">container-name</span>&gt;</span>hr<span class="hljs-tag">&lt;/<span class="hljs-title">container-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">server-template-key</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-id</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-id</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">server-template-key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>HR<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>org.jbpm<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">configs</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">entry</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>PROCESS<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"processConfig"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">strategy</span>&gt;</span>Singleton<span class="hljs-tag">&lt;/<span class="hljs-title">strategy</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">kie-base-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">kie-base-name</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">kie-session-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">kie-session-name</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">merge-mode</span>&gt;</span>Merge Collections<span class="hljs-tag">&lt;/<span class="hljs-title">merge-mode</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">entry</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">entry</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>RULE<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"ruleConfig"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">scanner-status</span>&gt;</span>STOPPED<span class="hljs-tag">&lt;/<span class="hljs-title">scanner-status</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">entry</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">configs</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>STARTED<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">container-spec-details</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__put_management_server_id_containers_containerid"><a class="anchor" href="#__put_management_server_id_containers_containerid"></a><a class="link" href="#__put_management_server_id_containers_containerid">24.8.7. [PUT] /management/server/{id}/containers/{containerId}</a></h4>
<div class="paragraph">
<p>Creates a new Container with the specified containerId and the given release id and optionally configuration</p>
</div>
<div class="exampleblock">
<div class="title">Example 254. Example Server Request</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">container-spec-details</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">container-id</span>&gt;</span>hr<span class="hljs-tag">&lt;/<span class="hljs-title">container-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">container-name</span>&gt;</span>hr<span class="hljs-tag">&lt;/<span class="hljs-title">container-name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">server-template-key</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">server-id</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-title">server-id</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">server-template-key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">release-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifact-id</span>&gt;</span>HR<span class="hljs-tag">&lt;/<span class="hljs-title">artifact-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">group-id</span>&gt;</span>org.jbpm<span class="hljs-tag">&lt;/<span class="hljs-title">group-id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">release-id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">configs</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">entry</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>PROCESS<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"processConfig"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">strategy</span>&gt;</span>Singleton<span class="hljs-tag">&lt;/<span class="hljs-title">strategy</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">kie-base-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">kie-base-name</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">kie-session-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">kie-session-name</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">merge-mode</span>&gt;</span>Merge Collections<span class="hljs-tag">&lt;/<span class="hljs-title">merge-mode</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">entry</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">entry</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">key</span>&gt;</span>RULE<span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">value</span> <span class="hljs-attribute">xsi:type</span>=<span class="hljs-value">"ruleConfig"</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">scanner-status</span>&gt;</span>STOPPED<span class="hljs-tag">&lt;/<span class="hljs-title">scanner-status</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">entry</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">configs</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">status</span>&gt;</span>STARTED<span class="hljs-tag">&lt;/<span class="hljs-title">status</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">container-spec-details</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__delete_management_server_id_containers_containerid"><a class="anchor" href="#__delete_management_server_id_containers_containerid"></a><a class="link" href="#__delete_management_server_id_containers_containerid">24.8.8. [DELETE] /management/server/{id}/containers/{containerId}</a></h4>
<div class="paragraph">
<p>Disposes a Container with the specified containerId</p>
</div>
</div>
<div class="sect3">
<h4 id="__post_management_server_id_containers_containerid_status_started"><a class="anchor" href="#__post_management_server_id_containers_containerid_status_started"></a><a class="link" href="#__post_management_server_id_containers_containerid_status_started">24.8.9. [POST] /management/server/{id}/containers/{containerId}/status/started</a></h4>
<div class="paragraph">
<p>Starts the Container.
No request body required</p>
</div>
</div>
<div class="sect3">
<h4 id="__post_management_server_id_containers_containerid_status_stopped"><a class="anchor" href="#__post_management_server_id_containers_containerid_status_stopped"></a><a class="link" href="#__post_management_server_id_containers_containerid_status_stopped">24.8.10. [POST] /management/server/{id}/containers/{containerId}/status/stopped</a></h4>
<div class="paragraph">
<p>Stops the Container.
No request body required</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie_server_java_client_api"><a class="anchor" href="#_kie_server_java_client_api"></a><a class="link" href="#_kie_server_java_client_api">24.9. Kie Server Java Client API</a></h3>
<div class="paragraph">
<p>The Kie Server has a great Java API to wrap REST or JMS requests to be sent to the server.
In this section we will explore some of the possibilities of this API.</p>
</div>
<div class="sect3">
<h4 id="_maven_configuration_2"><a class="anchor" href="#_maven_configuration_2"></a><a class="link" href="#_maven_configuration_2">24.9.1. Maven Configuration</a></h4>
<div class="paragraph">
<p>if you are a Maven user, make sure you have at least the following dependencies in the project’s <em>pom.xml</em></p>
</div>
<div class="listingblock">
<div class="title">Maven Dependencies</div>
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie.server<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-server-client<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>${kie.api.version}<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- Logging --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.1.2<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- Drools Commands --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.drools<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>drools-compiler<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>${kie.api.version}<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The version <em>kie.api.version </em>depends on the Kie Server version you are using.
For jBPM 6.3, for example, you can use 6.3.1-SNAPSHOT.</p>
</div>
</div>
<div class="sect3">
<h4 id="_client_configuration"><a class="anchor" href="#_client_configuration"></a><a class="link" href="#_client_configuration">24.9.2. Client Configuration</a></h4>
<div class="paragraph">
<p>The client requires a configuration object where you set most of the server communication aspects, such as the protocol (REST and JMS) credentials and the payload format (XStream, JAXB and JSON are the supported formats at the moment). The first thing to do is create your configuration then create the <strong><code><strong>KieServicesClient</strong></code></strong> object, the entry point for starting the server communication.
See the source below where we use a REST client configuration:</p>
</div>
<div class="listingblock">
<div class="title">Client Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.kie.server.api.marshalling.MarshallingFormat;
<span class="hljs-keyword">import</span> org.kie.server.client.KieServicesClient;
<span class="hljs-keyword">import</span> org.kie.server.client.KieServicesConfiguration;
<span class="hljs-keyword">import</span> org.kie.server.client.KieServicesFactory;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DecisionServerTest</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String URL = <span class="hljs-string">"http://localhost:8080/kie-server/services/rest/server"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String USER = <span class="hljs-string">"kieserver"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PASSWORD = <span class="hljs-string">"kieserver1!"</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> MarshallingFormat FORMAT = MarshallingFormat.JSON;

    <span class="hljs-keyword">private</span> KieServicesConfiguration conf;
    <span class="hljs-keyword">private</span> KieServicesClient kieServicesClient;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">()</span> </span>{
        conf = KieServicesFactory.newRestConfiguration(URL, USER, PASSWORD);
        conf.setMarshallingFormat(FORMAT);
        kieServicesClient = KieServicesFactory.newKieServicesClient(conf);
    }</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_jms_interaction_patterns"><a class="anchor" href="#_jms_interaction_patterns"></a><a class="link" href="#_jms_interaction_patterns">24.9.2.1. JMS interaction patterns</a></h5>
<div class="paragraph">
<p>In version 6.5 KIE Server Client JMS integration has been enhanced with possibility to use various interaction patterns. Currently available are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>request reply (which is the default) - that makes the JMS integration synchronous - it blocks client until it gets the response back - not suited for JMS transactional use case</p>
</li>
<li>
<p>fire and forget - makes the integration one way only, suitable for notification like integration with kie server - makes perfect fit for transactional JMS delivery - deliver message to kie server only if transaction that ckie server client was invoked in was committed successfully</p>
</li>
<li>
<p>async with callback - allows to not block a client after sending message to kie server and receive response asynchronously - can be integrated with transactional JMS delivery</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Response handlers can be either set globally - when KieServicesConfiguration is created or it can be changed on runtime on individual client instances (like RuleServiceClient, ProcessServicesClient, etc)</p>
</div>
<div class="paragraph">
<p>While 'fire and forget' and 'request reply' patterns do not require any additional configuration 'async with callback' does. And the main thing is actually the callback. KIE Server CLient comes with one out of the box - <code>BlockingResponseCallback</code> that provides basic support backed by blocking queue internally. Size of the queue is confgurable and thus allow receiving multiple messages, though intention of this callback is that it will only receive one message at a time - so it’s like one message (request) and then one response per client interaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Kie Server Client when switching response handler is not thread safe, meaning change of the handler will affect all threads using same client instance. So in case of dynamic changes of the handler it’s recommended to use separate client instances. A good approach is to maintain set of clients that use dedicated response handler and then use these clients dependeing on which handler is required.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>client 1 will use fire and forget while client 2 will use request reply. So client 1 can be used to start processes and client 2 can be used to query for user tasks.</p>
</div>
<div class="paragraph">
<p>Users can provide their own callbacks by implementing <code>org.kie.server.client.jms.ResponseCallback</code> interface.</p>
</div>
<div class="paragraph">
<p><strong>Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Global JMS configuration
----
InitialContext context = ...;
Queue requestQueue = (Queue) context.lookup(<span class="hljs-string">"jms/queue/KIE.SERVER.REQUEST"</span>));
Queue responseQueue = (Queue) context.lookup(<span class="hljs-string">"jms/queue/KIE.SERVER.RESPONSE"</span>);
ConnectionFactory connectionFactory = (ConnectionFactory) context.lookup(<span class="hljs-string">"jms/RemoteConnectionFactory"</span>);
KieServicesConfiguration jmsConfiguration = KieServicesFactory.newJMSConfiguration( connectionFactory, requestQueue, responseQueue, <span class="hljs-string">"user"</span>, <span class="hljs-string">"password"</span>);
<span class="hljs-comment">// here you set response handler globally</span>
jmsConfiguration.setResponseHandler(<span class="hljs-keyword">new</span> FireAndForgetResponseHandler());
----</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, might be actually more common, is to set the handler on individual clients before they are used</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Per client configuration
----
ProcessServiceClient processClient = client.getServicesClient(ProcessServicesClient.class);
<span class="hljs-comment">// change response handler for processClient others are not affected</span>
processClient.setResponseHandler(<span class="hljs-keyword">new</span> FireAndForgetResponseHandler());
---</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_server_response"><a class="anchor" href="#_server_response"></a><a class="link" href="#_server_response">24.9.3. Server Response</a></h4>
<div class="paragraph">
<p>All the service responses are represented by the object <code>org.kie.server.api.model.ServiceResponse&lt;T&gt;</code> where T is the type of the payload.
It has the following attributes:</p>
</div>
<div class="paragraph">
<p><strong>String msg: </strong>The response message;</p>
</div>
<div class="paragraph">
<p><code>org.kie.server.api.model.ServiceResponse.ResponseType</code><strong> type:</strong> the response type enum, which can be SUCCESS or FAILURE;</p>
</div>
<div class="paragraph">
<p><strong>T result: </strong>The actual payload of the response, the requested object.</p>
</div>
<div class="paragraph">
<p>Notice that this is the same object returned if you are using REST or JMS, in another words it is agnostic to protocol.</p>
</div>
</div>
<div class="sect3">
<h4 id="_server_capabilities"><a class="anchor" href="#_server_capabilities"></a><a class="link" href="#_server_capabilities">24.9.4. Server Capabilities</a></h4>
<div class="paragraph">
<p>Decision Server initially only supported rules execution, starting in version 6.3 it started supporting business process execution.
To know what exactly your server support, you can list the server capabilities by accessing the object <code>org.kie.server.api.model.KieServerInfo</code><strong>*</strong>*using the client:</p>
</div>
<div class="listingblock">
<div class="title">Listing Server capabilities</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">listCapabilities</span><span class="hljs-params">()</span> </span>{
    KieServerInfo serverInfo = kieServicesClient.getServerInfo().getResult();
    System.out.print(<span class="hljs-string">"Server capabilities:"</span>);
    <span class="hljs-keyword">for</span>(String capability: serverInfo.getCapabilities()) {
        System.out.print(<span class="hljs-string">" "</span> + capability);
    }
    System.out.println();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the server supports rules and process, the following should be printed when you run the code above:</p>
</div>
<div class="paragraph">
<p><em>Server capabilities: BRM KieServer BPM</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_kie_containers"><a class="anchor" href="#_kie_containers"></a><a class="link" href="#_kie_containers">24.9.5. Kie Containers</a></h4>
<div class="paragraph">
<p>If you want to publish a kjar to receive requests, you must publish it in a container.
The container is represented in the client by the object <code>org.kie.server.api.model.KieContainerResource</code>, and a list of resources is <code>org.kie.server.api.model.KieContainerResourceList</code>.
Here’s an example of how to print a list of containers:</p>
</div>
<div class="listingblock">
<div class="title">Listing Kie Containers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">listContainers</span><span class="hljs-params">()</span> </span>{
    KieContainerResourceList containersList = kieServicesClient.listContainers().getResult();
    List&lt;KieContainerResource&gt; kieContainers = containersList.getContainers();
    System.out.println(<span class="hljs-string">"Available containers: "</span>);
    <span class="hljs-keyword">for</span> (KieContainerResource container : kieContainers) {
        System.out.println(<span class="hljs-string">"\t"</span> + container.getContainerId() + <span class="hljs-string">" ("</span> + container.getReleaseId() + <span class="hljs-string">")"</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to list the containers based on specific ReleaseId (and its individual parts) or status:</p>
</div>
<div class="listingblock">
<div class="title">Listing Kie Containers with custom filter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">listContainersWithFilter</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// the following filter will match only containers with ReleaseId "org.example:contatner:1.0.0.Final" and status FAILED</span>
    KieContainerResourceFilter filter = <span class="hljs-keyword">new</span> KieContainerResourceFilter.Builder()
            .releaseId(<span class="hljs-string">"org.example"</span>, <span class="hljs-string">"container"</span>, <span class="hljs-string">"1.0.0.Final"</span>)
            .status(KieContainerStatus.FAILED)
            .build();
    KieContainerResourceList containersList = kieServicesClient.listContainers(filter).getResult();
    List&lt;KieContainerResource&gt; kieContainers = containersList.getContainers();
    System.out.println(<span class="hljs-string">"Available containers: "</span>);
    <span class="hljs-keyword">for</span> (KieContainerResource container : kieContainers) {
        System.out.println(<span class="hljs-string">"\t"</span> + container.getContainerId() + <span class="hljs-string">" ("</span> + container.getReleaseId() + <span class="hljs-string">")"</span>);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_managing_containers_2"><a class="anchor" href="#_managing_containers_2"></a><a class="link" href="#_managing_containers_2">24.9.6. Managing Containers</a></h4>
<div class="paragraph">
<p>You can use the client to dispose and create containers.
If you dispose a containers, a ServiceResponse will be returned with Void payload(no payload) and if you create it, the KieContainerResource object itself will be returned in the response.
Sample code:</p>
</div>
<div class="listingblock">
<div class="title">Disposing and creating containers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">disposeAndCreateContainer</span><span class="hljs-params">()</span> </span>{
    System.out.println(<span class="hljs-string">"== Disposing and creating containers =="</span>);
    List&lt;KieContainerResource&gt; kieContainers = kieServicesClient.listContainers().getResult().getContainers();
    <span class="hljs-keyword">if</span> (kieContainers.size() == <span class="hljs-number">0</span>) {
        System.out.println(<span class="hljs-string">"No containers available..."</span>);
        <span class="hljs-keyword">return</span>;
    }
    KieContainerResource container = kieContainers.get(<span class="hljs-number">0</span>);
    String containerId = container.getContainerId();
    ServiceResponse&lt;Void&gt; responseDispose = kieServicesClient.disposeContainer(containerId);
    <span class="hljs-keyword">if</span> (responseDispose.getType() == ResponseType.FAILURE) {
        System.out.println(<span class="hljs-string">"Error disposing "</span> + containerId + <span class="hljs-string">". Message: "</span>);
        System.out.println(responseDispose.getMsg());
        <span class="hljs-keyword">return</span>;
    }
    System.out.println(<span class="hljs-string">"Success Disposing container "</span> + containerId);
    System.out.println(<span class="hljs-string">"Trying to recreate the container..."</span>);
    ServiceResponse&lt;KieContainerResource&gt; createResponse = kieServicesClient.createContainer(containerId, container);
    <span class="hljs-keyword">if</span>(createResponse.getType() == ResponseType.FAILURE) {
        System.out.println(<span class="hljs-string">"Error creating "</span> + containerId + <span class="hljs-string">". Message: "</span>);
        System.out.println(responseDispose.getMsg());
        <span class="hljs-keyword">return</span>;
    }
     System.out.println(<span class="hljs-string">"Container recreated with success!"</span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_available_clients_for_the_decision_server"><a class="anchor" href="#_available_clients_for_the_decision_server"></a><a class="link" href="#_available_clients_for_the_decision_server">24.9.7. Available Clients for the Decision Server</a></h4>
<div class="paragraph">
<p>The KieServicesClient is also the entry point for others clients to perform specific operations, such as send BRMS commands and manage processes.
Currently from the KieServicesClient you can have access to the following services available in <code>org.kie.server.client</code> package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JobServicesClient: This client allows you to schedule, cancel, requeue and get job requests;</p>
</li>
<li>
<p>ProcessServicesClient: Allows you to start, signal abort process; complete and abort work items among other capabilities;</p>
</li>
<li>
<p>QueryServicesClient: The powerful query client allows you to query process, process nodes and process variables;</p>
</li>
<li>
<p>RuleServicesClient: The simple, but powerful rules client can be used to send commands to the server to perform rules related operations(insert objects in the working memory, fire rules, get globals…​);</p>
</li>
<li>
<p>UserTaskServicesClient: Finally, the user tasks clients allows you to perform all operations with an user tasks(start, claim, cancel, etc) and query tasks by certain fields(process instances id, user, etc).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For further information about these interfaces check github: <a href="https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-remote/kie-server-client/src/main/java/org/kie/server/client" class="bare">https://github.com/kiegroup/droolsjbpm-integration/tree/master/kie-server-parent/kie-server-remote/kie-server-client/src/main/java/org/kie/server/client</a></p>
</div>
<div class="paragraph">
<p>You can have access to any of these clients using the method <code>getServicesClient</code> in the KieServicesClient class.
For example: <code>RuleServicesClient rulesClient = kieServicesClient.getServicesClient(RuleServicesClient.class);</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_sending_commands_to_the_server"><a class="anchor" href="#_sending_commands_to_the_server"></a><a class="link" href="#_sending_commands_to_the_server">24.9.8. Sending commands to the server</a></h4>
<div class="paragraph">
<p>To build commands to the server you must use the class org.kie.api.command.KieCommands, that can be created using <code>org.kie.api.KieServices.get().getCommands()</code>.
The command to be send must be a <strong>BatchExecutionCommand</strong> or a single command(if a single command is sent, the server wraps it into a BatchExecutionCommand):</p>
</div>
<div class="exampleblock">
<div class="title">Example 255. Sending commands to a container</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">executeCommands</span><span class="hljs-params">()</span> </span>{
    System.out.println(<span class="hljs-string">"== Sending commands to the server =="</span>);
    RuleServicesClient rulesClient = kieServicesClient.getServicesClient(RuleServicesClient.class);
    KieCommands commandsFactory = KieServices.Factory.get().getCommands();
    Command&lt;?&gt; insert = commandsFactory.newInsert(<span class="hljs-string">"Some String OBJ"</span>);
    Command&lt;?&gt; fireAllRules = commandsFactory.newFireAllRules();
    Command&lt;?&gt; batchCommand = commandsFactory.newBatchExecution(Arrays.asList(insert, fireAllRules));
    ServiceResponse&lt;String&gt; executeResponse = rulesClient.executeCommands(<span class="hljs-string">"hello"</span>, batchCommand);
    <span class="hljs-keyword">if</span>(executeResponse.getType() == ResponseType.SUCCESS) {
        System.out.println(<span class="hljs-string">"Commands executed with success! Response: "</span>);
        System.out.println(executeResponse.getResult());
    }
    <span class="hljs-keyword">else</span> {
        System.out.println(<span class="hljs-string">"Error executing rules. Message: "</span>);
        System.out.println(executeResponse.getMsg());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result in this case is a String with the command execution result.
In our case it will print the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs javascript">    == Sending commands to the server ==
    Commands executed <span class="hljs-keyword">with</span> success! Response:
    {
      <span class="hljs-string">"results"</span> : [ ],
      <span class="hljs-string">"facts"</span> : [ ]
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>\* You must add <strong>org.drools:drools-compiler</strong> dependency to have this part working</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>During creation of BatchExecutionCommand, an optional <strong>lookup</strong> argument can be specified, that determines where the comand will run.
Lookup argument can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kie Session Name defined in deployment descriptor</p>
</li>
<li>
<p>Kie Container Id</p>
</li>
<li>
<p>Kie Container Id followed by Process Instance Id (Process Instance runtime strategy have to be used on the container)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The last two options need active jBPM extension on the Kie Container.</p>
</div>
<div class="paragraph">
<p>In the third case, the usage of lookup argument looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Command&lt;?&gt; batchCommand = commandsFactory.newBatchExecution(Arrays.asList(insert, fireAllRules), <span class="hljs-string">"demo-container#1"</span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_listing_available_business_processes"><a class="anchor" href="#_listing_available_business_processes"></a><a class="link" href="#_listing_available_business_processes">24.9.9. Listing available business processes</a></h4>
<div class="paragraph">
<p>To list process definitions we use the QueryClient.
The methods of the QueryClient usually uses pagination, which means that besides the query you are making, you must also provide the current page and the number of results per page.
In the code below the query for process definitions from the given container starts on page 0 and list 1000 results, in another words, the 1000 first results.</p>
</div>
<div class="listingblock">
<div class="title">Listing Business Processes Definitions Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">listProcesses</span><span class="hljs-params">()</span> </span>{
    System.out.println(<span class="hljs-string">"== Listing Business Processes =="</span>);
    QueryServicesClient queryClient = kieServicesClient.getServicesClient(QueryServicesClient.class);
    List&lt;ProcessDefinition&gt; findProcessesByContainerId = queryClient.findProcessesByContainerId(<span class="hljs-string">"rewards"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>);
    <span class="hljs-keyword">for</span> (ProcessDefinition def : findProcessesByContainerId) {
        System.out.println(def.getName() + <span class="hljs-string">" - "</span> + def.getId() + <span class="hljs-string">" v"</span> + def.getVersion());
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_securing_password_using_key_store"><a class="anchor" href="#_securing_password_using_key_store"></a><a class="link" href="#_securing_password_using_key_store">24.10. Securing password using key store</a></h3>
<div class="paragraph">
<p>KIE server is using for some communication (e.g. REST api) basic authentication with passwords. From the security perspective it is not safe to store such passwords in clear text form on the disc. For this purpose a mechanism was developed to store passwords in a key store and then use it in the application.</p>
</div>
<div class="sect3">
<h4 id="_simple_usecase"><a class="anchor" href="#_simple_usecase"></a><a class="link" href="#_simple_usecase">24.10.1. Simple usecase</a></h4>
<div class="paragraph">
<p>User wants to secure his password for communicating via REST client. He creates new keystore where he will put his password, he will setup sytem variables with the info to the keystore and KIE will automatically load the keystore and will use the password for securing the communication.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementation_and_business_logic"><a class="anchor" href="#_implementation_and_business_logic"></a><a class="link" href="#_implementation_and_business_logic">24.10.2. Implementation and business logic</a></h4>
<div class="paragraph">
<p>Current implementation is using key store if it is defined. If not, the funcionality is falling back to old behavior using config parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_system_requirements"><a class="anchor" href="#_system_requirements"></a><a class="link" href="#_system_requirements">24.10.3. System requirements</a></h4>
<div class="paragraph">
<p>To use a key store we need to create it first. As JKS is not supporting symetric keys we have to create JCEKS key store. Moreover, password can be stored in a key store only for Java 8 and above. For generating a key store you can use standard tool KeyTool which is part of JDK instalation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_initialization_of_a_key_store"><a class="anchor" href="#_initialization_of_a_key_store"></a><a class="link" href="#_initialization_of_a_key_store">24.10.4. Initialization of a key store</a></h4>
<div class="paragraph">
<p>For keystore initialization we recommend to use keytool. Syntax is the following:<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ keytool -importpassword -keystore _keystore_url_ -keypass _<span class="hljs-built_in">alias</span>_key_password_ -alias _password_<span class="hljs-built_in">alias</span>_ -storepass _keystore_password_ -storetype JCEKS</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>alias</strong> - alias name of the entry to process</p>
</li>
<li>
<p><strong>keypass</strong> - key password</p>
</li>
<li>
<p><strong>keystore</strong> - keystore name</p>
</li>
<li>
<p><strong>storepass</strong> - keystore password</p>
</li>
<li>
<p><strong>storetype</strong> - keystore type</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After running this command user will be asked for entering the password which he wants to store.</p>
</div>
</div>
<div class="sect3">
<h4 id="_system_parameters_for_loading_key_store"><a class="anchor" href="#_system_parameters_for_loading_key_store"></a><a class="link" href="#_system_parameters_for_loading_key_store">24.10.5. System parameters for loading key store</a></h4>
<div class="ulist">
<ul>
<li>
<p><strong>kie.keystore.keyStoreURL</strong> - URL to a keystore which should be used</p>
</li>
<li>
<p><strong>kie.keystore.keyStorePwd</strong> - password to a keystore</p>
</li>
<li>
<p><strong>kie.keystore.key.server.alias</strong> - alias of the key for REST services where password is stored</p>
</li>
<li>
<p><strong>kie.keystore.key.server.pwd</strong> - password of an alias for REST services with stored password</p>
</li>
<li>
<p><strong>kie.keystore.key.ctrl.alias</strong> - alias of the key for default REST controller where password is stored</p>
</li>
<li>
<p><strong>kie.keystore.key.ctrl.pwd</strong> - password of an alias for default REST controller with stored password</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_example_3"><a class="anchor" href="#_example_3"></a><a class="link" href="#_example_3">24.10.6. Example</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create user and password in application server (it has to have kie-server role)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>${EAP_HOME}/add-user.sh -a -e -u kieserver -p "kiePassword1!" -g kie-server</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>use key tool to create keystore with password in it<br></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ keytool -importpassword -keystore /home/kie/keystores/droolsServer.jceks -keypass keypwd -alias droolsKey -storepass serverpwd -storetype JCEKS

Enter the password to be stored:
Re-enter password:

$ keytool -importpassword -keystore /home/kie/keystores/droolsServer.jceks -keypass keypwd -alias restKey -storepass serverpwd -storetype JCEKS

Enter the password to be stored:
Re-enter password:</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>set following system properties on application server that will let the kie server/controller to read password from keystore</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;system-properties&gt;
        &lt;property name="kie.keystore.keyStoreURL" value="droolsServer.jceks"/&gt;
        &lt;property name="kie.keystore.keyStorePwd" value="serverpwd"/&gt;
        &lt;property name="kie.keystore.key.server.alias" value="restKey"/&gt;
        &lt;property name="kie.keystore.key.server.pwd" value="keypwd"/&gt;
        &lt;property name="kie.keystore.key.ctrl.alias" value="droolsKey"/&gt;
        &lt;property name="kie.keystore.key.ctrl.pwd" value="keypwd"/&gt;
    &lt;/system-properties&gt;</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>start server to verify configuration</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kie_server_controller_client_api"><a class="anchor" href="#_kie_server_controller_client_api"></a><a class="link" href="#_kie_server_controller_client_api">24.11. Kie Server Controller Client API</a></h3>
<div class="paragraph">
<p>The Kie Server Controller offers a Java API to wrap <a href="#ControllerRestAPI-section">REST</a> or Web Socket requests to be sent to the server.
In this section we will explore some of the capabilities of this API.</p>
</div>
<div class="sect3">
<h4 id="_maven_configuration_3"><a class="anchor" href="#_maven_configuration_3"></a><a class="link" href="#_maven_configuration_3">24.11.1. Maven Configuration</a></h4>
<div class="paragraph">
<p>if you are a Maven user, you must have the following dependencies in the project’s <em>pom.xml</em></p>
</div>
<div class="listingblock">
<div class="title">Maven Dependencies</div>
<div class="content">
<pre class="highlightjs highlight"><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.kie.server<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>kie-server-controller-client<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>${kie.api.version}<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!-- REST Client --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.jboss.resteasy<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>resteasy-client<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>3.0.19.Final<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!-- Web Socket Client --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>io.undertow<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>undertow-websockets-jsr<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.4.21.Final<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!-- Logging --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.1.2<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The version <em>kie.api.version</em> depends on the Kie Server Controller version you are using.
For jBPM 7.6, for example, you can use 7.6.0.Final.</p>
</div>
</div>
<div class="sect3">
<h4 id="_client_configuration_2"><a class="anchor" href="#_client_configuration_2"></a><a class="link" href="#_client_configuration_2">24.11.2. Client Configuration</a></h4>
<div class="paragraph">
<p>The first thing to do is to create your <strong><code><strong>KieServerControllerClient</strong></code></strong> object, the entry point for starting the server communication,
using the provided factory methods available in <code>KieServerControllerClientFactory</code> where you set most of the server communication
aspects, such as the protocol (REST or Web Socket), credentials, and the payload format (currently, JAXB and JSON are the only supported
formats for the REST protocol).
See the examples below to get started:</p>
</div>
<div class="sect4">
<h5 id="_kie_server_controller_endpoints"><a class="anchor" href="#_kie_server_controller_endpoints"></a><a class="link" href="#_kie_server_controller_endpoints">24.11.2.1. Kie Server Controller Endpoints</a></h5>
<div class="ulist">
<ul>
<li>
<p>REST: /rest/controller</p>
</li>
<li>
<p>Web Socket: /websocket/controller</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Client Configuration Example using REST</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.kie.server.controller.api.model.spec.ServerTemplateList;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.KieServerControllerClient;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.KieServerControllerClientFactory;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListServerTemplatesExample</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String URL = <span class="hljs-string">"http://localhost:8080/kie-server-controller/rest/controller"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String USER = <span class="hljs-string">"kieserver"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PASSWORD = <span class="hljs-string">"kieserver1!"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        KieServerControllerClient client = KieServerControllerClientFactory.newRestClient(URL,
                                                                                          USER,
                                                                                          PASSWORD);

        <span class="hljs-keyword">final</span> ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format(<span class="hljs-string">"Found %s server template(s) at controller url: %s"</span>,
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Client Configuration Example using Web Socket</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.kie.server.controller.api.model.spec.ServerTemplateList;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.KieServerControllerClient;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.KieServerControllerClientFactory;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListServerTemplatesExample</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String URL = <span class="hljs-string">"ws://localhost:8080/kie-server-controller/websocket/controller"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String USER = <span class="hljs-string">"kieserver"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PASSWORD = <span class="hljs-string">"kieserver1!"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        KieServerControllerClient client = KieServerControllerClientFactory.newWebSocketClient(URL,
                                                                                               USER,
                                                                                               PASSWORD);

        <span class="hljs-keyword">final</span> ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format(<span class="hljs-string">"Found %s server template(s) at controller url: %s"</span>,
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_protocol_specific_settings"><a class="anchor" href="#_protocol_specific_settings"></a><a class="link" href="#_protocol_specific_settings">24.11.2.2. Protocol specific settings</a></h5>
<div class="sect5">
<h6 id="_rest"><a class="anchor" href="#_rest"></a><a class="link" href="#_rest">REST</a></h6>
<div class="paragraph">
<p>When using the REST protocol, the Kie Server Controller Client allows that you specify your own <code>javax.ws.rs.core.Configuration</code>.
This can be useful for fine tuning the underlying REST client API. As an example, you can tweak the connection time out according to your needs.</p>
</div>
<div class="listingblock">
<div class="title">REST Client Timeout Configuration Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;
<span class="hljs-keyword">import</span> javax.ws.rs.core.Configuration;
<span class="hljs-keyword">import</span> org.jboss.resteasy.client.jaxrs.ResteasyClientBuilder;

<span class="hljs-keyword">import</span> org.kie.server.api.marshalling.MarshallingFormat;
<span class="hljs-keyword">import</span> org.kie.server.controller.api.model.spec.ServerTemplateList;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.KieServerControllerClient;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.KieServerControllerClientFactory;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RESTTimeoutExample</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String URL = <span class="hljs-string">"http://localhost:8080/kie-server-controller/rest/controller"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String USER = <span class="hljs-string">"kieserver"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PASSWORD = <span class="hljs-string">"kieserver1!"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        <span class="hljs-keyword">final</span> Configuration configuration =
                <span class="hljs-keyword">new</span> ResteasyClientBuilder()
                        .establishConnectionTimeout(<span class="hljs-number">10</span>,
                                                    TimeUnit.SECONDS)
                        .socketTimeout(<span class="hljs-number">60</span>,
                                       TimeUnit.SECONDS)
                        .getConfiguration();
        KieServerControllerClient client = KieServerControllerClientFactory.newRestClient(URL,
                                                                                          USER,
                                                                                          PASSWORD,
                                                                                          MarshallingFormat.JSON,
                                                                                          configuration);

        <span class="hljs-keyword">final</span> ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format(<span class="hljs-string">"Found %s server template(s) at controller url: %s"</span>,
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_web_socket"><a class="anchor" href="#_web_socket"></a><a class="link" href="#_web_socket">Web Socket</a></h6>
<div class="paragraph">
<p>When connecting via Web Socket protocol, the Kie Server Controller Client allows you to receive events notification based
on changes that happen in the particular Kie Server Controller that the client API is connected to. For instance, you can
receive a notification about a Kie Sever instance that got connected to the controller.</p>
</div>
<div class="listingblock">
<div class="title">Kie Server Controller Events Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> org.kie.server.controller.api.model.events.*;
<span class="hljs-keyword">import</span> org.kie.server.controller.api.model.spec.ServerTemplateList;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.KieServerControllerClient;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.KieServerControllerClientFactory;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.event.EventHandler;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketEventsExample</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String URL = <span class="hljs-string">"ws://localhost:8080/kie-server-controller/websocket/controller"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String USER = <span class="hljs-string">"kieserver"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PASSWORD = <span class="hljs-string">"kieserver1!"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        KieServerControllerClient client = KieServerControllerClientFactory.newWebSocketClient(URL,
                                                                                               USER,
                                                                                               PASSWORD,
                                                                                               <span class="hljs-keyword">new</span> TestEventHandler());

        <span class="hljs-keyword">final</span> ServerTemplateList serverTemplateList = client.listServerTemplates();
        System.out.println(String.format(<span class="hljs-string">"Found %s server template(s) at controller url: %s"</span>,
                                         serverTemplateList.getServerTemplates().length,
                                         URL));
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestEventHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">EventHandler</span> </span>{

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onServerInstanceConnected</span><span class="hljs-params">(ServerInstanceConnected serverInstanceConnected)</span> </span>{
            System.out.println(<span class="hljs-string">"serverInstanceConnected = "</span> + serverInstanceConnected);
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onServerInstanceDeleted</span><span class="hljs-params">(ServerInstanceDeleted serverInstanceDeleted)</span> </span>{
            System.out.println(<span class="hljs-string">"serverInstanceDeleted = "</span> + serverInstanceDeleted);
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onServerInstanceDisconnected</span><span class="hljs-params">(ServerInstanceDisconnected serverInstanceDisconnected)</span> </span>{
            System.out.println(<span class="hljs-string">"serverInstanceDisconnected = "</span> + serverInstanceDisconnected);
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onServerTemplateDeleted</span><span class="hljs-params">(ServerTemplateDeleted serverTemplateDeleted)</span> </span>{
            System.out.println(<span class="hljs-string">"serverTemplateDeleted = "</span> + serverTemplateDeleted);
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onServerTemplateUpdated</span><span class="hljs-params">(ServerTemplateUpdated serverTemplateUpdated)</span> </span>{
            System.out.println(<span class="hljs-string">"serverTemplateUpdated = "</span> + serverTemplateUpdated);
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onServerInstanceUpdated</span><span class="hljs-params">(ServerInstanceUpdated serverInstanceUpdated)</span> </span>{
            System.out.println(<span class="hljs-string">"serverInstanceUpdated = "</span> + serverInstanceUpdated);
        }

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onContainerSpecUpdated</span><span class="hljs-params">(ContainerSpecUpdated containerSpecUpdated)</span> </span>{
            System.out.println(<span class="hljs-string">"onContainerSpecUpdated = "</span> + containerSpecUpdated);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_a_kie_server_controller"><a class="anchor" href="#_setting_up_a_kie_server_controller"></a><a class="link" href="#_setting_up_a_kie_server_controller">24.11.3. Setting up a Kie Server Controller</a></h4>
<div class="paragraph">
<p>Below is a demonstration of additional capabilities of this API. You can follow this guide to get started with an empty Kie Server Controller instance.
This example illustrates how to create a Server Template using some basic configuration as well as setting up a single container.
It also shows how to start and stop the specific container and remove the newly created Server Template.</p>
</div>
<div class="listingblock">
<div class="title">Setup Kie Server Controller Example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">import</span> org.kie.server.api.model.KieContainerStatus;
<span class="hljs-keyword">import</span> org.kie.server.api.model.KieScannerStatus;
<span class="hljs-keyword">import</span> org.kie.server.api.model.ReleaseId;
<span class="hljs-keyword">import</span> org.kie.server.controller.api.model.spec.*;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.KieServerControllerClient;
<span class="hljs-keyword">import</span> org.kie.server.controller.client.KieServerControllerClientFactory;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketSetupControllerExample</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String URL = <span class="hljs-string">"ws://localhost:8080/kie-server-controller/websocket/controller"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String USER = <span class="hljs-string">"kieserver"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PASSWORD = <span class="hljs-string">"kieserver1!"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> KieServerControllerClient client;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        KieServerControllerClient client = KieServerControllerClientFactory.newWebSocketClient(URL,
                                                                                               USER,
                                                                                               PASSWORD);
        ServerTemplate serverTemplate = createServerTemplate();
        ContainerSpec container = createContainer(serverTemplate);
        client.startContainer(container);
        client.stopContainer(container);
        client.deleteServerTemplate(serverTemplate.getId());
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> ServerTemplate <span class="hljs-title">createServerTemplate</span><span class="hljs-params">()</span> </span>{
        ServerTemplate serverTemplate = <span class="hljs-keyword">new</span> ServerTemplate();
        serverTemplate.setId(<span class="hljs-string">"example-client-id"</span>);
        serverTemplate.setName(<span class="hljs-string">"example-client-name"</span>);
        serverTemplate.setCapabilities(Arrays.asList(Capability.PROCESS.name(),
                                                     Capability.RULE.name(),
                                                     Capability.PLANNING.name()));

        client.saveServerTemplate(serverTemplate);

        <span class="hljs-keyword">return</span> serverTemplate;
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> ContainerSpec <span class="hljs-title">createContainer</span><span class="hljs-params">(ServerTemplate serverTemplate)</span></span>{
        Map&lt;Capability, ContainerConfig&gt; containerConfigMap = <span class="hljs-keyword">new</span> HashMap();

        ProcessConfig processConfig = <span class="hljs-keyword">new</span> ProcessConfig(<span class="hljs-string">"PER_PROCESS_INSTANCE"</span>, <span class="hljs-string">"kieBase"</span>, <span class="hljs-string">"kieSession"</span>, <span class="hljs-string">"MERGE_COLLECTION"</span>);
        containerConfigMap.put(Capability.PROCESS, processConfig);

        RuleConfig ruleConfig = <span class="hljs-keyword">new</span> RuleConfig(<span class="hljs-number">500l</span>, KieScannerStatus.SCANNING);
        containerConfigMap.put(Capability.RULE, ruleConfig);

        ReleaseId releaseId = <span class="hljs-keyword">new</span> ReleaseId(<span class="hljs-string">"org.kie.server.testing"</span>, <span class="hljs-string">"stateless-session-kjar"</span>, <span class="hljs-string">"1.0.0-SNAPSHOT"</span>);

        ContainerSpec containerSpec = <span class="hljs-keyword">new</span> ContainerSpec(<span class="hljs-string">"example-container-id"</span>, <span class="hljs-string">"example-client-name"</span>, serverTemplate, releaseId, KieContainerStatus.STOPPED, containerConfigMap);
        client.saveContainerSpec(serverTemplate.getId(), containerSpec);

        <span class="hljs-keyword">return</span> containerSpec;
    }
}</code></pre>
</div>
</div>
<h1 id="_drools_examples" class="discrete">Drools Examples</h1>
<div class="paragraph">
<p>Examples to help you learn Drools</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples_2"><a class="anchor" href="#_examples_2"></a><a class="link" href="#_examples_2">25. Examples</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_getting_the_examples"><a class="anchor" href="#_getting_the_examples"></a><a class="link" href="#_getting_the_examples">25.1. Getting the Examples</a></h3>
<div class="paragraph">
<p>Make sure the Drools Eclipse plugin is installed, which needs the Graphical Editing Framework (GEF) dependency installed first.
Then download and extract the drools-examples zip file, which includes an already created Eclipse project.
Import that project into a new Eclipse workspace.
The rules all have example classes that execute the rules.
If you want to try the examples in another project (or another IDE) then you will need to set up the dependencies by hand, of course.
Many, but not all of the examples are documented below, enjoy!</p>
</div>
<div class="paragraph">
<p>Some examples require Java 1.6 to run.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hello_world"><a class="anchor" href="#_hello_world"></a><a class="link" href="#_hello_world">25.2. Hello World</a></h3>
<div class="listingblock">
<div class="content">
<pre>Name: Hello World
Main class: org.drools.examples.helloworld.HelloWorldExample
Module: drools-examples
Type: Java application
Rules file: HelloWorld.drl
Objective: demonstrate basic rules in use</pre>
</div>
</div>
<div class="paragraph">
<p>The "Hello World" example shows a simple application using rules, written both using the MVEL and the Java dialects.</p>
</div>
<div class="paragraph">
<p>This example demonstrates how to create and use a <code>KieSession</code>.
Also, audit logging and debug outputs are shown, which is omitted from other examples as it’s all very similar.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows how the session is created with only 3 lines of code.</p>
</div>
<div class="exampleblock">
<div class="title">Example 256. HelloWorld: Creating the KieSession</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        KieServices ks = KieServices.Factory.get(); <i class="conum" data-value="1"></i><b>(<span class="hljs-number">1</span>)</b>
        KieContainer kc = ks.getKieClasspathContainer(); <i class="conum" data-value="2"></i><b>(<span class="hljs-number">2</span>)</b>
        KieSession ksession = kc.newKieSession(<span class="hljs-string">"HelloWorldKS"</span>); <i class="conum" data-value="3"></i><b>(<span class="hljs-number">3</span>)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Obtains the KieServices factory. This is the main interface applications use to interact with
the engine.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creates a KieContainer from the project classpath. This will look for a <strong>/META-INF/kmodule.xml</strong>
file to configure and instantiate the KieModule into the KieContainer.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creates a session based on the named "HelloWorldKS" session configuration.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="paragraph">
<p>Drools has an event model that exposes much of what’s happening internally.
Two default debug listeners are supplied, <code>DebugAgendaEventListener</code> and <code>DebugWorkingMemoryEventListener</code> which print out debug event information to the <code>System.err</code> stream displayed in the Console window.
Adding listeners to a Session is trivial, as shown in the next snippet.
The <code>KieRuntimeLogger</code> provides execution auditing, the result of which can be viewed in a graphical viewer.
The logger is actually a specialised implementation built on the <code>Agenda</code> and <code>RuleRuntime</code> listeners.
When the engine has finished executing, <code>logger.close()</code> must be called.</p>
</div>
<div class="paragraph">
<p>Most of the examples use the Audit logging features of Drools to record execution flow for later inspection.</p>
</div>
<div class="exampleblock">
<div class="title">Example 257. HelloWorld: Event logging and Auditing</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        <span class="hljs-comment">// The application can also setup listeners</span>
        ksession.addEventListener( <span class="hljs-keyword">new</span> DebugAgendaEventListener() );
        ksession.addEventListener( <span class="hljs-keyword">new</span> DebugRuleRuntimeEventListener() );

        <span class="hljs-comment">// To setup a file based audit logger, uncomment the next line</span>
        <span class="hljs-comment">// KieRuntimeLogger logger = ks.getLoggers().newFileLogger( ksession, "./helloworld" );</span>

        <span class="hljs-comment">// To setup a ThreadedFileLogger, so that the audit view reflects events whilst debugging,</span>
        <span class="hljs-comment">// uncomment the next line</span>
        <span class="hljs-comment">// KieRuntimeLogger logger = ks.getLoggers().newThreadedFileLogger( ksession, "./helloworld", 1000 );</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The single class used in this example is very simple.
It has two fields: the message, which is a <code>String</code> and the status which can be one of the two integers <code>HELLO</code> or <code>GOODBYE</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 258. HelloWorld example: Message Class</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> HELLO   = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> GOODBYE = <span class="hljs-number">1</span>;

    <span class="hljs-keyword">private</span> String          message;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span>             status;
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A single <code>Message</code> object is created with the message text "Hello World" and the status <code>HELLO</code> and then inserted into the engine, at which point <code>fireAllRules()</code> is executed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 259. HelloWorld: Execution</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        <span class="hljs-comment">// The application can insert facts into the session</span>
        <span class="hljs-keyword">final</span> Message message = <span class="hljs-keyword">new</span> Message();
        message.setMessage( <span class="hljs-string">"Hello World"</span> );
        message.setStatus( Message.HELLO );
        ksession.insert( message );

        <span class="hljs-comment">// and fire the rules</span>
        ksession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To execute the example as a Java application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the class <code>org.drools.examples.helloworld.HelloWorldExample</code> in your Eclipse IDE</p>
</li>
<li>
<p>Right-click the class and select "Run as…​" and then "Java application"</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If we put a breakpoint on the <code>fireAllRules()</code> method and select the <code>ksession</code> variable, we can see that the "Hello World" rule is already activate on the Agenda.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/helloworld_agenda1.png" alt="helloworld agenda1">
</div>
<div class="title">Figure 388. Hello World: fireAllRules Agenda View</div>
</div>
<div class="paragraph">
<p>The application print outs go to to <code>System.out</code> while the debug listener print outs go to <code>System.err</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 260. HelloWorld: System.out in the Console window</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">Hello</span> World
Goodbye cruel world</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 261. HelloWorld: System.err in the Console window</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">==&gt;[ActivationCreated(<span class="hljs-number">0</span>): rule=Hello World;
                   tuple=[fid:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>:org.drools.examples.helloworld.HelloWorldExample$Message@<span class="hljs-number">17</span>cec96]]
[ObjectInserted: handle=[fid:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>:org.drools.examples.helloworld.HelloWorldExample$Message@<span class="hljs-number">17</span>cec96];
                 object=org.drools.examples.helloworld.HelloWorldExample$Message@<span class="hljs-number">17</span>cec96]
[BeforeActivationFired: rule=Hello World;
                   tuple=[fid:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>:org.drools.examples.helloworld.HelloWorldExample$Message@<span class="hljs-number">17</span>cec96]]
==&gt;[ActivationCreated(<span class="hljs-number">4</span>): rule=Good Bye;
                   tuple=[fid:<span class="hljs-number">1</span>:<span class="hljs-number">2</span>:org.drools.examples.helloworld.HelloWorldExample$Message@<span class="hljs-number">17</span>cec96]]
[ObjectUpdated: handle=[fid:<span class="hljs-number">1</span>:<span class="hljs-number">2</span>:org.drools.examples.helloworld.HelloWorldExample$Message@<span class="hljs-number">17</span>cec96];
                old_object=org.drools.examples.helloworld.HelloWorldExample$Message@<span class="hljs-number">17</span>cec96;
                new_object=org.drools.examples.helloworld.HelloWorldExample$Message@<span class="hljs-number">17</span>cec96]
[AfterActivationFired(<span class="hljs-number">0</span>): rule=Hello World]
[BeforeActivationFired: rule=Good Bye;
                   tuple=[fid:<span class="hljs-number">1</span>:<span class="hljs-number">2</span>:org.drools.examples.helloworld.HelloWorldExample$Message@<span class="hljs-number">17</span>cec96]]
[AfterActivationFired(<span class="hljs-number">4</span>): rule=Good Bye]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The actual rules are inside the file <em class="path">src/main/resources/org/drools/examples/helloworld/HelloWorld.drl</em>
:</p>
</div>
<div class="exampleblock">
<div class="title">Example 262. HelloWorld: rule "Hello World"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Hello World"</span>
      dialect <span class="hljs-string">"mvel"</span>
  <span class="hljs-keyword">when</span>
      m <span class="hljs-symbol">:</span> <span class="hljs-constant">Message</span>( status == <span class="hljs-constant">Message</span>.<span class="hljs-constant">HELLO</span>, message <span class="hljs-symbol">:</span> message )
  <span class="hljs-keyword">then</span>
      <span class="hljs-constant">System</span>.out.println( message );
      modify ( m ) { message = <span class="hljs-string">"Goodbye cruel world"</span>,
                     status = <span class="hljs-constant">Message</span>.<span class="hljs-constant">GOODBYE</span> };
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The LHS (after <code>when</code>) section of the rule states that it will be activated for each <code>Message</code> object inserted into the Rule Runtime whose status is <code>Message.HELLO</code>.
Besides that, two variable bindings are created: the variable <code>message</code> is bound to the <code>message</code> attribute and the variable <code>m</code> is bound to the matched <code>Message</code> object itself.</p>
</div>
<div class="paragraph">
<p>The RHS (after <code>then</code>) or consequence part of the rule is written using the MVEL expression language, as declared by the rule’s attribute <code>dialect</code>.
After printing the content of the bound variable <code>message</code> to <code>System.out</code>, the rule changes the values of the <code>message</code> and <code>status</code> attributes of the <code>Message</code> object bound to <code>m</code>.
This is done using MVEL’s <code>modify</code> statement, which allows you to apply a block of assignments in one statement, with the engine being automatically notified of the changes at the end of the block.</p>
</div>
<div class="paragraph">
<p>It is possible to set a breakpoint into the DRL, on the <code>modify</code> call, and inspect the Agenda view again during the execution of the rule’s consequence.
This time we start the execution via "Debug As" and "Drools application" and not by running a "Java application":</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the class <code>org.drools.examples.HelloWorld</code> in your Eclipse IDE.</p>
</li>
<li>
<p>Right-click the class and select "Debug as…​" and then "Drools application".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now we can see that the other rule <code>"Good Bye"</code>, which uses the Java dialect, is activated and placed on the Agenda.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/helloworld_agenda2.png" alt="helloworld agenda2">
</div>
<div class="title">Figure 389. Hello World: rule "Hello World" Agenda View</div>
</div>
<div class="paragraph">
<p>The "Good Bye" rule, which specifies the "java" dialect, is similar to the "Hello World" rule except that it matches <code>Message</code> objects whose  status is <code>Message.GOODBYE</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 263. HelloWorld: rule "Good Bye"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"Good Bye"</span>
      dialect <span class="hljs-string">"java"</span>
  <span class="hljs-function"><span class="hljs-keyword">when</span>
      <span class="hljs-title">Message</span>(<span class="hljs-params"> status == Message.GOODBYE, message : message </span>)
  then
      System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params"> message </span>)</span>;
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Java code that instantiates the <code>KieRuntimeLogger</code> creates an audit log file that can be loaded into the Audit view.
The Audit view is used in many of the examples to demonstrate the example execution flow.
In the view screen shot below we can see that the object is inserted, which creates an activation for the "Hello World" rule; the activation is then executed which updates the <code>Message</code> object causing the "Good Bye" rule to activate; finally the "Good Bye" rule also executes.
Selecting an event in the Audit view highlights the origin event in green; therefore the "Activation created" event is highlighted in green as the origin of the "Activation executed" event.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/helloworld_auditview1.png" alt="helloworld auditview1">
</div>
<div class="title">Figure 390. Hello World: Audit View</div>
</div>
</div>
<div class="sect2">
<h3 id="_state_example"><a class="anchor" href="#_state_example"></a><a class="link" href="#_state_example">25.3. State Example</a></h3>
<div class="paragraph">
<p>This example is implemented in two different versions to demonstrate different ways of implementing the same basic behavior: forward chaining, i.e., the ability the engine has to evaluate, activate and fire rules in sequence, based on changes on the facts in the Working Memory.</p>
</div>
<div class="sect3">
<h4 id="_understanding_the_state_example"><a class="anchor" href="#_understanding_the_state_example"></a><a class="link" href="#_understanding_the_state_example">25.3.1. Understanding the State Example</a></h4>
<div class="listingblock">
<div class="content">
<pre>Name: State Example
Main class: org.drools.examples.state.StateExampleUsingSalience
Module: drools-examples
Type: Java application
Rules file: StateExampleUsingSalience.drl
Objective: Demonstrates basic rule use and Conflict Resolution for rule firing priority.</pre>
</div>
</div>
<div class="paragraph">
<p>Each <code>State</code> class has fields for its name and its current state (see the class <code>org.drools.examples.state.State</code>). The two possible states for each objects are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NOTRUN</code></p>
</li>
<li>
<p><code>FINISHED</code></p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 264. State Class</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">State</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> NOTRUN   = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FINISHED = <span class="hljs-number">1</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PropertyChangeSupport changes =
        <span class="hljs-keyword">new</span> PropertyChangeSupport( <span class="hljs-keyword">this</span> );

    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span>    state;

    ... setters and getters go here...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Ignoring the <code>PropertyChangeSupport</code>, which will be explained later, we see the creation of four <code>State</code> objects named A, B, C and D.
Initially their states are set to <code>NOTRUN</code>, which is default for the used constructor.
Each instance is asserted in turn into the Session and then <code>fireAllRules()</code> is called.</p>
</div>
<div class="exampleblock">
<div class="title">Example 265. Salience State: Execution</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        <span class="hljs-keyword">final</span> State a = <span class="hljs-keyword">new</span> State( <span class="hljs-string">"A"</span> );
        <span class="hljs-keyword">final</span> State b = <span class="hljs-keyword">new</span> State( <span class="hljs-string">"B"</span> );
        <span class="hljs-keyword">final</span> State c = <span class="hljs-keyword">new</span> State( <span class="hljs-string">"C"</span> );
        <span class="hljs-keyword">final</span> State d = <span class="hljs-keyword">new</span> State( <span class="hljs-string">"D"</span> );

        ksession.insert( a );
        ksession.insert( b );
        ksession.insert( c );
        ksession.insert( d );

        ksession.fireAllRules();

        ksession.dispose(); <span class="hljs-comment">// Stateful rule session must always be disposed when finished</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To execute the application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the class <code>org.drools.examples.state.StateExampleUsingSalience</code> in your Eclipse IDE.</p>
</li>
<li>
<p>Right-click the class and select "Run as…​" and then "Java application"</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You will see the following output in the Eclipse console window:</p>
</div>
<div class="exampleblock">
<div class="title">Example 266. Salience State: Console Output</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs nginx"><span class="hljs-title">A</span> finished
B finished
C finished
D finished</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are four rules in total.
First, the <code>Bootstrap</code> rule fires, setting A to state <code>FINISHED</code>, which then causes B to change its state to <code>FINISHED</code>.
C and D are both dependent on B, causing a conflict which is resolved by the salience values.
Let’s look at the way this was executed.</p>
</div>
<div class="paragraph">
<p>The best way to understand what is happening is to use the Audit Logging feature to graphically see the results of each operation.
To view the Audit log generated by a run of this example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the Audit View is not visible, click on "Window" and then select "Show View", then "Other…​" and "Drools" and finally "Audit View".</p>
</li>
<li>
<p>In the "Audit View" click the "Open Log" button and select the file "&lt;drools-examples-dir&gt;/log/state.log".</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After that, the "Audit view" will look like the following screenshot:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/state_example_audit1.png" alt="state example audit1">
</div>
<div class="title">Figure 391. Salience State Example Audit View</div>
</div>
<div class="paragraph">
<p>Reading the log in the "Audit View", top to bottom, we see every action and the corresponding changes in the Working Memory.
This way we observe that the assertion of the State object A in the state <code>NOTRUN</code> activates the <code>Bootstrap</code> rule, while the assertions of the other <code>State</code> objects have no immediate effect.</p>
</div>
<div class="exampleblock">
<div class="title">Example 267. Salience State: Rule "Bootstrap"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-constant">Bootstrap</span>
    <span class="hljs-keyword">when</span>
        a <span class="hljs-symbol">:</span> <span class="hljs-constant">State</span>(name == <span class="hljs-string">"A"</span>, state == <span class="hljs-constant">State</span>.<span class="hljs-constant">NOTRUN</span> )
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">System</span>.out.println(a.getName() + <span class="hljs-string">" finished"</span> );
        a.setState( <span class="hljs-constant">State</span>.<span class="hljs-constant">FINISHED</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The execution of rule Bootstrap changes the state of A to <code>FINISHED</code>, which, in turn, activates rule "A to B".</p>
</div>
<div class="exampleblock">
<div class="title">Example 268. Salience State: Rule "A to B"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"A to B"</span>
    <span class="hljs-keyword">when</span>
        State(name == <span class="hljs-string">"A"</span>, <span class="hljs-keyword">state</span> == State.FINISHED )
        b : State(name == <span class="hljs-string">"B"</span>, <span class="hljs-keyword">state</span> == State.NOTRUN )
    then
        System.out.println(b.getName() + <span class="hljs-string">" finished"</span> );
        b.setState( State.FINISHED );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The execution of rule "A to B" changes the state of B to <code>FINISHED</code>, which activates both, rules "B to C" and "B to D", placing their Activations onto the Agenda.
From this moment on, both rules may fire and, therefore, they are said to be "in conflict". The conflict resolution strategy allows the engine’s Agenda to decide which rule to fire.
As rule "B to C" has the <strong>higher salience value</strong> (10 versus the default salience value of 0), it fires first, modifying object C to state <code>FINISHED</code>.
The Audit view shown above reflects the modification of the <code>State</code> object in the rule "A to B", which results in two activations being in conflict.
The Agenda view can also be used to investigate the state of the Agenda, with debug points being placed in the rules themselves and the Agenda view opened.
The screen shot below shows the breakpoint in the rule "A to B" and the state of the Agenda with the two conflicting rules.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/state_example_agenda1.png" alt="state example agenda1">
</div>
<div class="title">Figure 392. State Example Agenda View</div>
</div>
<div class="exampleblock">
<div class="title">Example 269. Salience State: Rule "B to C"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"B to C"</span>
        salience <span class="hljs-number">10</span>
    <span class="hljs-keyword">when</span>
        State(name == <span class="hljs-string">"B"</span>, <span class="hljs-keyword">state</span> == State.FINISHED )
        c : State(name == <span class="hljs-string">"C"</span>, <span class="hljs-keyword">state</span> == State.NOTRUN )
    then
        System.out.println(c.getName() + <span class="hljs-string">" finished"</span> );
        c.setState( State.FINISHED );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Rule "B to D" fires last, modifying object D to state <code>FINISHED</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 270. Salience State: Rule "B to D"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule <span class="hljs-string">"B to D"</span>
    <span class="hljs-keyword">when</span>
        State(name == <span class="hljs-string">"B"</span>, <span class="hljs-keyword">state</span> == State.FINISHED )
        d : State(name == <span class="hljs-string">"D"</span>, <span class="hljs-keyword">state</span> == State.NOTRUN )
    then
        System.out.println(d.getName() + <span class="hljs-string">" finished"</span> );
        d.setState( State.FINISHED );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are no more rules to execute and so the engine stops.</p>
</div>
<div class="paragraph">
<p>Another notable concept in this example is the use of <em>dynamic facts</em>, based on <code>PropertyChangeListener</code> objects.
As described in the documentation, in order for the engine to see and react to changes of fact properties, the application must tell the engine that changes occurred.
This can be done explicitly in the rules by using the <code>modify</code> statement, or implicitly by letting the engine know that the facts implement <code>PropertyChangeSupport</code> as defined by the <em>JavaBeans
        specification</em>.
This example demonstrates how to use <code>PropertyChangeSupport</code> to avoid the need for explicit <code>modify</code> statements in the rules.
To make use of this feature, ensure that your facts implement <code>PropertyChangeSupport</code>, the same way the class <code>org.drools.example.State</code> does, and use the following code in the rules file to configure the engine to listen for property changes on those facts:</p>
</div>
<div class="exampleblock">
<div class="title">Example 271. Declaring a Dynamic Fact</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">declare type State
    <span class="hljs-annotation">@propertyChangeSupport</span>
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When using <code>PropertyChangeListener</code> objects, each setter must implement a little extra code for the notification.
Here is the setter for <code>state</code> in the class <code>org.drools.examples</code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 272. Setter Example with PropertyChangeSupport</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setState</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> newState)</span> </span>{
    <span class="hljs-keyword">int</span> oldState = <span class="hljs-keyword">this</span>.state;
    <span class="hljs-keyword">this</span>.state = newState;
    <span class="hljs-keyword">this</span>.changes.firePropertyChange( <span class="hljs-string">"state"</span>,
                                     oldState,
                                     newState );
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are another class in this example: <code>StateExampleUsingAgendaGroup</code>.
It executes from A to B to C to D, as just shown, but <code>StateExampleUsingAgendaGroup</code> uses agenda-groups to control the rule conflict and which one fires first.</p>
</div>
<div class="paragraph">
<p>Agenda groups are a way to partition the Agenda into groups and to control which groups can execute.
By default, all rules are in the agenda group "MAIN". The "agenda-group" attribute lets you specify a different agenda group for the rule.
Initially, a Working Memory has its focus on the Agenda group "MAIN". A group’s rules will only fire when the group receives the focus.
This can be achieved either ny using the method by <code>setFocus()</code> or the rule attribute <code>auto-focus</code>.
"auto-focus" means that the rule automatically sets the focus to its agenda group when the rule is matched and activated.
It is this "auto-focus" that enables rule "B to C" to fire before "B to D".</p>
</div>
<div class="exampleblock">
<div class="title">Example 273. Agenda Group State Example: Rule "B to C"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"B to C"</span>
      agenda-<span class="hljs-keyword">group</span> <span class="hljs-string">"B to C"</span>
      auto-<span class="hljs-function">focus <span class="hljs-keyword">true</span>
  <span class="hljs-keyword">when</span>
      <span class="hljs-title">State</span>(<span class="hljs-params">name == <span class="hljs-string">"B"</span>, state == State.FINISHED </span>)
      c : <span class="hljs-title">State</span>(<span class="hljs-params">name == <span class="hljs-string">"C"</span>, state == State.NOTRUN </span>)
  then
      System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params">c.getName(</span>) + " finished" )</span>;
      c.setState( State.FINISHED );
      kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( <span class="hljs-string">"B to D"</span> ).setFocus();
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The rule "B to C" calls <code>setFocus()</code> on the agenda group "B to D", allowing its active rules to fire, which allows the rule "B to D" to fire.</p>
</div>
<div class="exampleblock">
<div class="title">Example 274. Agenda Group State Example: Rule "B to D"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"B to D"</span>
      agenda-<span class="hljs-keyword">group</span> <span class="hljs-string">"B to D"</span>
  <span class="hljs-function"><span class="hljs-keyword">when</span>
      <span class="hljs-title">State</span>(<span class="hljs-params">name == <span class="hljs-string">"B"</span>, state == State.FINISHED </span>)
      d : <span class="hljs-title">State</span>(<span class="hljs-params">name == <span class="hljs-string">"D"</span>, state == State.NOTRUN </span>)
  then
      System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params">d.getName(</span>) + " finished" )</span>;
      d.setState( State.FINISHED );
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fibonacci_example"><a class="anchor" href="#_fibonacci_example"></a><a class="link" href="#_fibonacci_example">25.4. Fibonacci Example</a></h3>
<div class="listingblock">
<div class="content">
<pre>Name: Fibonacci
Main class: org.drools.examples.fibonacci.FibonacciExample
Module: drools-examples
Type: Java application
Rules file: Fibonacci.drl
Objective: Demonstrates Recursion,
  the CE not and cross product matching</pre>
</div>
</div>
<div class="paragraph">
<p>The Fibonacci Numbers (see <a href="http://en.wikipedia.org/wiki/Fibonacci_number" class="bare">http://en.wikipedia.org/wiki/Fibonacci_number</a>) discovered by Leonardo of Pisa (see <a href="http://en.wikipedia.org/wiki/Fibonacci" class="bare">http://en.wikipedia.org/wiki/Fibonacci</a>) is a sequence  that starts with 0 and 1.
The next Fibonacci number is obtained by adding the two preceding Fibonacci numbers.
The Fibonacci sequence begins with 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765, 10946,…​ The Fibonacci Example demonstrates recursion and conflict resolution with salience values.</p>
</div>
<div class="paragraph">
<p>The single fact class <code>Fibonacci</code> is used in this example.
It has two fields, sequence and value.
The sequence field is used to indicate the position of the object in the Fibonacci number sequence.
The value field shows the value of that Fibonacci object for that sequence position, using -1 to indicate a value that still needs to be computed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 275. Fibonacci Class</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fibonacci</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span>  sequence;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> value;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Fibonacci</span><span class="hljs-params">( <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> sequence )</span> </span>{
        <span class="hljs-keyword">this</span>.sequence = sequence;
        <span class="hljs-keyword">this</span>.value = -<span class="hljs-number">1</span>;
    }

    ... setters and getters go here...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Execute the example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the class <code class="class">org.drools.examples.fibonacci.FibonacciExample</code> in your Eclipse IDE.</p>
</li>
<li>
<p>Right-click the class and select "Run as…​" and then "Java application"</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Eclipse shows the following output in its console window (with "…​snip…​" indicating lines that were removed to save space):</p>
</div>
<div class="exampleblock">
<div class="title">Example 276. Fibonacci Example: Console Output</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">recurse <span class="hljs-keyword">for</span> <span class="hljs-number">50</span>
recurse <span class="hljs-keyword">for</span> <span class="hljs-number">49</span>
recurse <span class="hljs-keyword">for</span> <span class="hljs-number">48</span>
recurse <span class="hljs-keyword">for</span> <span class="hljs-number">47</span>
...snip...
recurse <span class="hljs-keyword">for</span> <span class="hljs-number">5</span>
recurse <span class="hljs-keyword">for</span> <span class="hljs-number">4</span>
recurse <span class="hljs-keyword">for</span> <span class="hljs-number">3</span>
recurse <span class="hljs-keyword">for</span> <span class="hljs-number">2</span>
<span class="hljs-number">1</span> == <span class="hljs-number">1</span>
<span class="hljs-number">2</span> == <span class="hljs-number">1</span>
<span class="hljs-number">3</span> == <span class="hljs-number">2</span>
<span class="hljs-number">4</span> == <span class="hljs-number">3</span>
<span class="hljs-number">5</span> == <span class="hljs-number">5</span>
<span class="hljs-number">6</span> == <span class="hljs-number">8</span>
...snip...
<span class="hljs-number">47</span> == <span class="hljs-number">2971215073</span>
<span class="hljs-number">48</span> == <span class="hljs-number">4807526976</span>
<span class="hljs-number">49</span> == <span class="hljs-number">7778742049</span>
<span class="hljs-number">50</span> == <span class="hljs-number">12586269025</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To kick this off from Java we only insert a single Fibonacci object, with a sequence field of 50.
A recursive rule is then used to insert the other 49 <code>Fibonacci</code> objects.
This example doesn’t use <code>PropertyChangeSupport</code>.
It uses the MVEL dialect, which means we can use the <code>modify</code> keyword, which allows a block setter action which also notifies the engine of changes.</p>
</div>
<div class="exampleblock">
<div class="title">Example 277. Fibonacci Example: Execution</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.insert( <span class="hljs-keyword">new</span> Fibonacci( <span class="hljs-number">50</span> ) );
ksession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The rule Recurse is very simple.
It matches each asserted <code>Fibonacci</code> object with a value of -1, creating and  asserting a new <code>Fibonacci</code> object with a sequence of one less than the currently matched object.
Each time a Fibonacci object is added while the one with a sequence field equal to 1 does not exist, the rule re-matches and fires again.
The <code>not</code> conditional element is used to stop the rule’s matching once we have all 50 Fibonacci objects in memory.
The rule also has a salience value, because we need to have all 50 <code>Fibonacci</code> objects asserted before we execute the Bootstrap rule.</p>
</div>
<div class="exampleblock">
<div class="title">Example 278. Fibonacci Example: Rule "Recurse"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">rule Recurse
    salience 10
    when
        f : Fibonacci ( value == -1 )
        not ( Fibonacci ( sequence == 1 ) )
    then
        <span class="hljs-operator"><span class="hljs-keyword">insert</span>( <span class="hljs-keyword">new</span> Fibonacci( <span class="hljs-keyword">f</span>.<span class="hljs-keyword">sequence</span> - <span class="hljs-number">1</span> ) );</span>
        System.out.println( "recurse for " + f.sequence );
<span class="hljs-operator"><span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Audit view shows the original assertion of the <code>Fibonacci</code> object with a sequence field of 50, done from Java code.
From there on, the Audit view shows the continual recursion of the rule, where each asserted <code>Fibonacci</code> object causes the Recurse rule to become activated and to fire again.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/fibonacci1.png" alt="fibonacci1">
</div>
<div class="title">Figure 393. Fibonacci Example: "Recurse" Audit View 1</div>
</div>
<div class="paragraph">
<p>When a <code>Fibonacci</code> object with a sequence field of 2 is asserted the "Bootstrap" rule is matched and activated along with the "Recurse" rule.
Note the multi-restriction on field <code>sequence</code>, testing for equality with 1 or 2.</p>
</div>
<div class="exampleblock">
<div class="title">Example 279. Fibonacci Example: Rule "Bootstrap"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule Bootstrap
    <span class="hljs-keyword">when</span>
        f : Fibonacci( sequence == <span class="hljs-number">1</span> || == <span class="hljs-number">2</span>, <span class="hljs-keyword">value</span> == -<span class="hljs-number">1</span> ) <span class="hljs-comment">// multi-restriction</span>
    <span class="hljs-function">then
        <span class="hljs-title">modify</span> (<span class="hljs-params"> f </span>)</span>{ <span class="hljs-keyword">value</span> = <span class="hljs-number">1</span> };
        System.<span class="hljs-keyword">out</span>.println( f.sequence + <span class="hljs-string">" == "</span> + f.<span class="hljs-keyword">value</span> );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this point the Agenda looks as shown below.
However, the "Bootstrap" rule does not fire because the "Recurse" rule has a higher salience.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/fibonacci_agenda1.png" alt="fibonacci agenda1">
</div>
<div class="title">Figure 394. Fibonacci Example: "Recurse" Agenda View 1</div>
</div>
<div class="paragraph">
<p>When a <code>Fibonacci</code> object with a sequence of 1 is asserted the Bootstrap rule is matched again, causing two activations for this rule.
Note that the "Recurse" rule does not match and activate because the <code>not</code> conditional element stops the rule’s matching as soon as a <code>Fibonacci</code> object with a sequence of 1 exists.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/fibonacci_agenda2.png" alt="fibonacci agenda2">
</div>
<div class="title">Figure 395. Fibonacci Example: "Recurse" Agenda View 2</div>
</div>
<div class="paragraph">
<p>Once we have two <code>Fibonacci</code> objects with values not equal to -1 the "Calculate" rule is able to match.
It was the "Bootstrap" rule that set the objects with sequence 1 and 2 to values of 1.
At this point we have 50 Fibonacci objects in the Working Memory.
Now we need to select a suitable triple to calculate each of their values in turn.
Using three Fibonacci patterns in a rule without field constraints to confine the possible cross products would result in 50x49x48 possible combinations, leading to about 125,000 possible rule firings, most of them incorrect.
The "Calculate" rule uses field constraints to correctly constraint the thee Fibonacci patterns in the correct order; this technique is called <em>cross product matching</em>.
The first pattern finds any Fibonacci with a value != -1 and binds both the pattern and the field.
The second Fibonacci does this, too, but it adds an additional field constraint to ensure that its sequence is greater by one than the Fibonacci bound to <code>f1</code>.
When this rule fires for the first time, we know that only sequences 1 and 2 have values of 1, and the two constraints ensure that <code>f1</code> references sequence 1 and <code>f2</code> references sequence 2.
The final pattern finds the Fibonacci with a value equal to -1 and with a sequence one greater than <code>f2</code>.
At this point, we have three <code>Fibonacci</code> objects correctly selected from the available cross products, and we can calculate the value for the third <code>Fibonacci</code> object that’s bound to <code>f3</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 280. Fibonacci Example: Rule "Calculate"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule Calculate
    <span class="hljs-keyword">when</span>
        <span class="hljs-comment">// Bind f1 and s1</span>
        f1 : Fibonacci( s1 : sequence, <span class="hljs-keyword">value</span> != -<span class="hljs-number">1</span> )
        <span class="hljs-comment">// Bind f2 and v2; refer to bound variable s1</span>
        f2 : Fibonacci( sequence == (s1 + <span class="hljs-number">1</span>), v2 : <span class="hljs-keyword">value</span> != -<span class="hljs-number">1</span> )
        <span class="hljs-comment">// Bind f3 and s3; alternative reference of f2.sequence</span>
        f3 : Fibonacci( s3 : sequence == (f2.sequence + <span class="hljs-number">1</span> ), <span class="hljs-keyword">value</span> == -<span class="hljs-number">1</span> )
    then
        <span class="hljs-comment">// Note the various referencing techniques.</span>
        modify ( f3 ) { <span class="hljs-keyword">value</span> = f1.<span class="hljs-keyword">value</span> + v2 };
        System.<span class="hljs-keyword">out</span>.println( s3 + <span class="hljs-string">" == "</span> + f3.<span class="hljs-keyword">value</span> );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>modify</code> statement updated the value of the <code>Fibonacci</code> object bound to <code>f3</code>.
This means we now have another new Fibonacci object with a value not equal to -1, which allows the "Calculate" rule to rematch and calculate the next Fibonacci number.
The Audit view below shows how the firing of the last "Bootstrap" modifies the <code>Fibonacci</code> object, enabling the "Calculate" rule to match, which then modifies another Fibonacci object allowing the "Calculate" rule to match again.
This continues till the value is set for all <code>Fibonacci</code> objects.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/fibonacci4.png" alt="fibonacci4">
</div>
<div class="title">Figure 396. Fibonacci Example: "Bootstrap" Audit View</div>
</div>
</div>
<div class="sect2">
<h3 id="_banking_tutorial"><a class="anchor" href="#_banking_tutorial"></a><a class="link" href="#_banking_tutorial">25.5. Banking Tutorial</a></h3>
<div class="listingblock">
<div class="content">
<pre>Name: BankingTutorial
Main class: org.drools.examples.banking.BankingExamplesApp.java
Module: drools-examples
Type: Java application
Rules file: org.drools.examples.banking.*.drl
Objective: Demonstrate pattern matching, basic sorting and calculation rules.</pre>
</div>
</div>
<div class="paragraph">
<p>This tutorial demonstrates the process of developing a complete personal banking application to handle credits and debits on multiple accounts.
It uses a set of design patterns that have been created for the process.</p>
</div>
<div class="paragraph">
<p>The class <code>RuleRunner</code> is a simple harness to execute one or more DRL files against a set of data.
It compiles the Packages  and creates the Knowledge Base for each execution, allowing us to easily execute each scenario and inspect the outputs.
In reality this is not a good solution for a production system, where the Knowledge Base should be built just once and cached, but for the purposes of this tutorial it shall suffice.</p>
</div>
<div class="exampleblock">
<div class="title">Example 281. Banking Tutorial: RuleRunner</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RuleRunner</span> </span>{

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RuleRunner</span><span class="hljs-params">()</span> </span>{
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">runRules</span><span class="hljs-params">(String[] rules,
                         Object[] facts)</span> <span class="hljs-keyword">throws</span> Exception </span>{

        KnowledgeBase kbase = KnowledgeBaseFactory.newKnowledgeBase();
        KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder();

        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; rules.length; i++ ) {
            String ruleFile = rules[i];
            System.out.println( <span class="hljs-string">"Loading file: "</span> + ruleFile );
            kbuilder.add( ResourceFactory.newClassPathResource( ruleFile,
                                                                RuleRunner.class ),
                          ResourceType.DRL );
        }

        Collection&lt;KnowledgePackage&gt; pkgs = kbuilder.getKnowledgePackages();
        kbase.addKnowledgePackages( pkgs );
        StatefulKnowledgeSession ksession = kbase.newStatefulKnowledgeSession();

        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; facts.length; i++ ) {
            Object fact = facts[i];
            System.out.println( <span class="hljs-string">"Inserting fact: "</span> + fact );
            ksession.insert( fact );
        }

        ksession.fireAllRules();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The first of our sample Java classes loads and executes a single DRL file, <em class="path">Example.drl</em>
, but without inserting any data.</p>
</div>
<div class="exampleblock">
<div class="title">Example 282. Banking Tutorial : Java Example1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example1</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">new</span> RuleRunner().runRules( <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"Example1.drl"</span> },
                                   <span class="hljs-keyword">new</span> Object[<span class="hljs-number">0</span>] );
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The first simple rule to execute has a single <code>eval</code> condition that will always be true, so that this rule will match and fire, once, after the start.</p>
</div>
<div class="exampleblock">
<div class="title">Example 283. Banking Tutorial: Rule in Example1.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"Rule 01"</span>
    <span class="hljs-function"><span class="hljs-keyword">when</span>
        <span class="hljs-title">eval</span>(<span class="hljs-params"> <span class="hljs-number">1</span>==<span class="hljs-number">1</span> </span>)
    then
        System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params"> <span class="hljs-string">"Rule 01 Works"</span> </span>)</span>;
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The output for the rule is below, showing that the rule matches and executes the single print statement.</p>
</div>
<div class="exampleblock">
<div class="title">Example 284. Banking Tutorial: Output of Example1.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Loading file: Example1.drl
Rule <span class="hljs-number">01</span> Works</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The next step is to assert some simple facts and print them out.</p>
</div>
<div class="exampleblock">
<div class="title">Example 285. Banking Tutorial: Java Example2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example2</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        Number[] numbers = <span class="hljs-keyword">new</span> Number[] {wrap(<span class="hljs-number">3</span>), wrap(<span class="hljs-number">1</span>), wrap(<span class="hljs-number">4</span>), wrap(<span class="hljs-number">1</span>), wrap(<span class="hljs-number">5</span>)};
        <span class="hljs-keyword">new</span> RuleRunner().runRules( <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"Example2.drl"</span> },
                                   numbers );
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title">wrap</span><span class="hljs-params">( <span class="hljs-keyword">int</span> i )</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Integer(i);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This doesn’t use any specific facts but instead asserts a set of <code>java.lang.Integer</code> objects.
This is not considered "best practice" as a number is not a useful fact, but we use it here to demonstrate basic techniques before more complexity is added.</p>
</div>
<div class="paragraph">
<p>Now we will create a simple rule to print out these numbers.</p>
</div>
<div class="exampleblock">
<div class="title">Example 286. Banking Tutorial: Rule in Example2.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Rule 02"</span>
    <span class="hljs-keyword">when</span>
        <span class="hljs-constant">Number</span>( <span class="hljs-variable">$intValue</span> <span class="hljs-symbol">:</span> intValue )
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">System</span>.out.println( <span class="hljs-string">"Number found with value: "</span> + <span class="hljs-variable">$intValue</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once again, this rule does nothing special.
It identifies any facts that are <code>Number</code> objects and prints out the values.
Notice the use of the abstract class <code>Number</code>: we inserted <code>Integer</code> objects but we now look for any kind of number.
The pattern matching engine is able to match interfaces and superclasses of asserted objects.</p>
</div>
<div class="paragraph">
<p>The output shows the DRL being loaded, the facts inserted and then the matched and fired rules.
We can see that each inserted number is matched and fired and thus printed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 287. Banking Tutorial: Output of Example2.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Loading file: Example2.drl
Inserting fact: <span class="hljs-number">3</span>
Inserting fact: <span class="hljs-number">1</span>
Inserting fact: <span class="hljs-number">4</span>
Inserting fact: <span class="hljs-number">1</span>
Inserting fact: <span class="hljs-number">5</span>
Number found with value: <span class="hljs-number">5</span>
Number found with value: <span class="hljs-number">1</span>
Number found with value: <span class="hljs-number">4</span>
Number found with value: <span class="hljs-number">1</span>
Number found with value: <span class="hljs-number">3</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are certainly many better ways to sort numbers than using rules, but since we will need to apply some cashflows in date order when we start looking at banking rules we’ll develop simple rule based sorting technique.</p>
</div>
<div class="exampleblock">
<div class="title">Example 288. Banking Tutorial: Example3.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example3</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        Number[] numbers = <span class="hljs-keyword">new</span> Number[] {wrap(<span class="hljs-number">3</span>), wrap(<span class="hljs-number">1</span>), wrap(<span class="hljs-number">4</span>), wrap(<span class="hljs-number">1</span>), wrap(<span class="hljs-number">5</span>)};
        <span class="hljs-keyword">new</span> RuleRunner().runRules( <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"Example3.drl"</span> },
                                   numbers );
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title">wrap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Integer(i);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Again we insert our <code>Integer</code> objects, but this time the rule is slightly different:</p>
</div>
<div class="exampleblock">
<div class="title">Example 289. Banking Tutorial: Rule in Example3.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Rule 03"</span>
    <span class="hljs-keyword">when</span>
        <span class="hljs-variable">$number</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Number</span>( )
        <span class="hljs-keyword">not</span> <span class="hljs-constant">Number</span>( intValue &lt; <span class="hljs-variable">$number</span>.intValue )
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">System</span>.out.println(<span class="hljs-string">"Number found with value: "</span> + <span class="hljs-variable">$number</span>.intValue() );
        retract( <span class="hljs-variable">$number</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The first line of the rule identifies a <code>Number</code> and extracts the value.
The second line ensures that there does not exist a smaller number than the one found by the first pattern.
We might expect to match only one number - the smallest in the set.
However, the retraction of the number after it has been printed means that the smallest number has been removed, revealing the next smallest number, and so on.</p>
</div>
<div class="paragraph">
<p>The resulting output shows that the numbers are now sorted numerically.</p>
</div>
<div class="exampleblock">
<div class="title">Example 290. Banking Tutorial: Output of Example3.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Loading file: Example3.drl
Inserting fact: <span class="hljs-number">3</span>
Inserting fact: <span class="hljs-number">1</span>
Inserting fact: <span class="hljs-number">4</span>
Inserting fact: <span class="hljs-number">1</span>
Inserting fact: <span class="hljs-number">5</span>
Number found with value: <span class="hljs-number">1</span>
Number found with value: <span class="hljs-number">1</span>
Number found with value: <span class="hljs-number">3</span>
Number found with value: <span class="hljs-number">4</span>
Number found with value: <span class="hljs-number">5</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We are ready to start moving towards our personal accounting rules.
The first step is to create a <code>Cashflow</code> object.</p>
</div>
<div class="exampleblock">
<div class="title">Example 291. Banking Tutorial: Class Cashflow</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cashflow</span> </span>{
    <span class="hljs-keyword">private</span> Date   date;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> amount;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Cashflow</span><span class="hljs-params">()</span> </span>{
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Cashflow</span><span class="hljs-params">(Date date, <span class="hljs-keyword">double</span> amount)</span> </span>{
        <span class="hljs-keyword">this</span>.date = date;
        <span class="hljs-keyword">this</span>.amount = amount;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">getDate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> date;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDate</span><span class="hljs-params">(Date date)</span> </span>{
        <span class="hljs-keyword">this</span>.date = date;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getAmount</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> amount;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAmount</span><span class="hljs-params">(<span class="hljs-keyword">double</span> amount)</span> </span>{
        <span class="hljs-keyword">this</span>.amount = amount;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Cashflow[date="</span> + date + <span class="hljs-string">",amount="</span> + amount + <span class="hljs-string">"]"</span>;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Class <code>Cashflow</code> has two simple attributes, a date and an amount.
(Note that using the type <code>double</code> for monetary units is generally <em>not</em> a good idea because floating point numbers cannot represent most numbers accurately.) There is also an overloaded constructor to set the values, and a method <code>toString</code> to print a cashflow.
The Java code of <em class="path">Example4.java</em>
 inserts five Cashflow objects, with varying dates and amounts.</p>
</div>
<div class="exampleblock">
<div class="title">Example 292. Banking Tutorial: Example4.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example4</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        Object[] cashflows = {
            <span class="hljs-keyword">new</span> Cashflow(<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"01/01/2007"</span>), <span class="hljs-number">300.00</span>),
            <span class="hljs-keyword">new</span> Cashflow(<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"05/01/2007"</span>), <span class="hljs-number">100.00</span>),
            <span class="hljs-keyword">new</span> Cashflow(<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"11/01/2007"</span>), <span class="hljs-number">500.00</span>),
            <span class="hljs-keyword">new</span> Cashflow(<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"07/01/2007"</span>), <span class="hljs-number">800.00</span>),
            <span class="hljs-keyword">new</span> Cashflow(<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"02/01/2007"</span>), <span class="hljs-number">400.00</span>),
        };

        <span class="hljs-keyword">new</span> RuleRunner().runRules( <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"Example4.drl"</span> },
                                   cashflows );
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The convenience class <code>SimpleDate</code> extends <code>java.util.Date</code>, providing a constructor taking a String as input and defining a date format.
The code is listed below</p>
</div>
<div class="exampleblock">
<div class="title">Example 293. Banking Tutorial: Class SimpleDate</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleDate</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Date</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SimpleDateFormat format = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"dd/MM/yyyy"</span>);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SimpleDate</span><span class="hljs-params">(String datestr)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        setTime(format.parse(datestr).getTime());
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, let’s look at <em class="path">Example4.drl</em>
 to see how we print the sorted <code>Cashflow</code> objects:</p>
</div>
<div class="exampleblock">
<div class="title">Example 294. Banking Tutorial: Rule in Example4.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Rule 04"</span>
    <span class="hljs-keyword">when</span>
        <span class="hljs-variable">$cashflow</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Cashflow</span>( <span class="hljs-variable">$date</span> <span class="hljs-symbol">:</span> date, <span class="hljs-variable">$amount</span> <span class="hljs-symbol">:</span> amount )
        <span class="hljs-keyword">not</span> <span class="hljs-constant">Cashflow</span>( date &lt; <span class="hljs-variable">$date</span>)
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">System</span>.out.println(<span class="hljs-string">"Cashflow: "</span>+<span class="hljs-variable">$date</span>+<span class="hljs-string">" :: "</span>+<span class="hljs-variable">$amount</span>);
        retract(<span class="hljs-variable">$cashflow</span>);
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, we identify a <code>Cashflow</code> and extract the date and the amount.
In the second line of the rule we ensure that there is no Cashflow with an earlier date than the one found.
In the consequence, we print the <code>Cashflow</code> that satisfies the rule and then retract it, making way for the next earliest <code>Cashflow</code>.
So, the output we generate is:</p>
</div>
<div class="exampleblock">
<div class="title">Example 295. Banking Tutorial: Output of Example4.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Loading file: Example4.drl
Inserting fact: Cashflow[date=Mon Jan <span class="hljs-number">01</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span>,amount=<span class="hljs-number">300.0</span>]
Inserting fact: Cashflow[date=Fri Jan <span class="hljs-number">05</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span>,amount=<span class="hljs-number">100.0</span>]
Inserting fact: Cashflow[date=Thu Jan <span class="hljs-number">11</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span>,amount=<span class="hljs-number">500.0</span>]
Inserting fact: Cashflow[date=Sun Jan <span class="hljs-number">07</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span>,amount=<span class="hljs-number">800.0</span>]
Inserting fact: Cashflow[date=Tue Jan <span class="hljs-number">02</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span>,amount=<span class="hljs-number">400.0</span>]
Cashflow: Mon Jan <span class="hljs-number">01</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span> :: <span class="hljs-number">300.0</span>
Cashflow: Tue Jan <span class="hljs-number">02</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span> :: <span class="hljs-number">400.0</span>
Cashflow: Fri Jan <span class="hljs-number">05</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span> :: <span class="hljs-number">100.0</span>
Cashflow: Sun Jan <span class="hljs-number">07</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span> :: <span class="hljs-number">800.0</span>
Cashflow: Thu Jan <span class="hljs-number">11</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span> :: <span class="hljs-number">500.0</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Next, we extend our <code>Cashflow</code>, resulting in a <code>TypedCashflow</code> which can be a credit or a debit operation.
(Normally, we would just add this to the <code>Cashflow</code> type, but we use extension to keep the previous version of the class intact.)</p>
</div>
<div class="exampleblock">
<div class="title">Example 296. Banking Tutorial: Class TypedCashflow</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TypedCashflow</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Cashflow</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CREDIT = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DEBIT  = <span class="hljs-number">1</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span>             type;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TypedCashflow</span><span class="hljs-params">()</span> </span>{
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TypedCashflow</span><span class="hljs-params">(Date date, <span class="hljs-keyword">int</span> type, <span class="hljs-keyword">double</span> amount)</span> </span>{
        <span class="hljs-keyword">super</span>( date, amount );
        <span class="hljs-keyword">this</span>.type = type;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getType</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> type;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setType</span><span class="hljs-params">(<span class="hljs-keyword">int</span> type)</span> </span>{
        <span class="hljs-keyword">this</span>.type = type;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"TypedCashflow[date="</span> + getDate() +
               <span class="hljs-string">",type="</span> + (type == CREDIT ? <span class="hljs-string">"Credit"</span> : <span class="hljs-string">"Debit"</span>) +
               <span class="hljs-string">",amount="</span> + getAmount() + <span class="hljs-string">"]"</span>;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are lots of ways to improve this code, but for the sake of the example this will do.</p>
</div>
<div class="paragraph">
<p>Now let’s create Example5, a class for running our code.</p>
</div>
<div class="exampleblock">
<div class="title">Example 297. Banking Tutorial: Example5.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example5</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        Object[] cashflows = {
            <span class="hljs-keyword">new</span> TypedCashflow(<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"01/01/2007"</span>),
                              TypedCashflow.CREDIT, <span class="hljs-number">300.00</span>),
            <span class="hljs-keyword">new</span> TypedCashflow(<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"05/01/2007"</span>),
                              TypedCashflow.CREDIT, <span class="hljs-number">100.00</span>),
            <span class="hljs-keyword">new</span> TypedCashflow(<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"11/01/2007"</span>),
                              TypedCashflow.CREDIT, <span class="hljs-number">500.00</span>),
            <span class="hljs-keyword">new</span> TypedCashflow(<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"07/01/2007"</span>),
                              TypedCashflow.DEBIT, <span class="hljs-number">800.00</span>),
            <span class="hljs-keyword">new</span> TypedCashflow(<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"02/01/2007"</span>),
                              TypedCashflow.DEBIT, <span class="hljs-number">400.00</span>),
        };

        <span class="hljs-keyword">new</span> RuleRunner().runRules( <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"Example5.drl"</span> },
                                   cashflows );
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, we simply create a set of <code>Cashflow</code> objects which are either credit or debit operations.
We supply them and <em class="path">Example5.drl</em>
 to the RuleEngine.</p>
</div>
<div class="paragraph">
<p>Now, let’s look at a rule printing the sorted <code>Cashflow</code> objects.</p>
</div>
<div class="exampleblock">
<div class="title">Example 298. Banking Tutorial: Rule in Example5.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Rule 05"</span>
    <span class="hljs-keyword">when</span>
        <span class="hljs-variable">$cashflow</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">TypedCashflow</span>( <span class="hljs-variable">$date</span> <span class="hljs-symbol">:</span> date,
                                   <span class="hljs-variable">$amount</span> <span class="hljs-symbol">:</span> amount,
                                   type == <span class="hljs-constant">TypedCashflow</span>.<span class="hljs-constant">CREDIT</span> )
        <span class="hljs-keyword">not</span> <span class="hljs-constant">TypedCashflow</span>( date &lt; <span class="hljs-variable">$date</span>,
                           type == <span class="hljs-constant">TypedCashflow</span>.<span class="hljs-constant">CREDIT</span> )
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">System</span>.out.println(<span class="hljs-string">"Credit: "</span>+<span class="hljs-variable">$date</span>+<span class="hljs-string">" :: "</span>+<span class="hljs-variable">$amount</span>);
        retract(<span class="hljs-variable">$cashflow</span>);
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, we identify a <code>Cashflow</code> fact with a type of <code>CREDIT</code> and extract the date and the amount.
In the second line of the rule we ensure that there is no <code>Cashflow</code> of the same type with an earlier date than the one found.
In the consequence, we print the cashflow satisfying the patterns and then retract it, making way for the next earliest cashflow of type <code>CREDIT</code>.</p>
</div>
<div class="paragraph">
<p>So, the output we generate is</p>
</div>
<div class="exampleblock">
<div class="title">Example 299. Banking Tutorial: Output of Example5.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>Loading file: Example5.drl
Inserting fact: TypedCashflow[date=Mon Jan 01 00:00:00 GMT 2007,type=Credit,amount=300.0]
Inserting fact: TypedCashflow[date=Fri Jan 05 00:00:00 GMT 2007,type=Credit,amount=100.0]
Inserting fact: TypedCashflow[date=Thu Jan 11 00:00:00 GMT 2007,type=Credit,amount=500.0]
Inserting fact: TypedCashflow[date=Sun Jan 07 00:00:00 GMT 2007,type=Debit,amount=800.0]
Inserting fact: TypedCashflow[date=Tue Jan 02 00:00:00 GMT 2007,type=Debit,amount=400.0]
Credit: Mon Jan 01 00:00:00 GMT 2007 :: 300.0
Credit: Fri Jan 05 00:00:00 GMT 2007 :: 100.0
Credit: Thu Jan 11 00:00:00 GMT 2007 :: 500.0</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Continuing our banking exercise, we are now going to process both credits and debits on two bank accounts, calculating the account balance.
In order to do this, we create two separate <code>Account</code> objects and inject them into the <code>Cashflows</code> objects before passing them to the Rule Engine.
The reason for this is to provide easy access to the correct account without having to resort to helper classes.
Let’s take a look at the <code>Account</code> class first.
This is a simple Java object with an account number and balance:</p>
</div>
<div class="exampleblock">
<div class="title">Example 300. Banking Tutorial: Class Account</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span>   accountNo;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> balance = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Account</span><span class="hljs-params">()</span> </span>{
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Account</span><span class="hljs-params">(<span class="hljs-keyword">long</span> accountNo)</span> </span>{
        <span class="hljs-keyword">this</span>.accountNo = accountNo;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getAccountNo</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> accountNo;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAccountNo</span><span class="hljs-params">(<span class="hljs-keyword">long</span> accountNo)</span> </span>{
        <span class="hljs-keyword">this</span>.accountNo = accountNo;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getBalance</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> balance;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBalance</span><span class="hljs-params">(<span class="hljs-keyword">double</span> balance)</span> </span>{
        <span class="hljs-keyword">this</span>.balance = balance;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Account["</span> + <span class="hljs-string">"accountNo="</span> + accountNo + <span class="hljs-string">",balance="</span> + balance + <span class="hljs-string">"]"</span>;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now let’s extend our <code>TypedCashflow</code>, resulting in <code>AllocatedCashflow</code>, to include an <code>Account</code> reference.</p>
</div>
<div class="exampleblock">
<div class="title">Example 301. Banking Tutorial: Class AllocatedCashflow</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AllocatedCashflow</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">TypedCashflow</span> </span>{
    <span class="hljs-keyword">private</span> Account account;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AllocatedCashflow</span><span class="hljs-params">()</span> </span>{
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AllocatedCashflow</span><span class="hljs-params">(Account account, Date date, <span class="hljs-keyword">int</span> type, <span class="hljs-keyword">double</span> amount)</span> </span>{
        <span class="hljs-keyword">super</span>( date, type, amount );
        <span class="hljs-keyword">this</span>.account = account;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Account <span class="hljs-title">getAccount</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> account;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAccount</span><span class="hljs-params">(Account account)</span> </span>{
        <span class="hljs-keyword">this</span>.account = account;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"AllocatedCashflow["</span> +
               <span class="hljs-string">"account="</span> + account +
               <span class="hljs-string">",date="</span> + getDate() +
               <span class="hljs-string">",type="</span> + (getType() == CREDIT ? <span class="hljs-string">"Credit"</span> : <span class="hljs-string">"Debit"</span>) +
               <span class="hljs-string">",amount="</span> + getAmount() + <span class="hljs-string">"]"</span>;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Java code of <em class="path">Example5.java</em>
 creates  two <code>Account</code> objects and passes one of them into each cashflow, in the constructor call.</p>
</div>
<div class="exampleblock">
<div class="title">Example 302. Banking Tutorial: Example5.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example6</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        Account acc1 = <span class="hljs-keyword">new</span> Account(<span class="hljs-number">1</span>);
        Account acc2 = <span class="hljs-keyword">new</span> Account(<span class="hljs-number">2</span>);

        Object[] cashflows = {
            <span class="hljs-keyword">new</span> AllocatedCashflow(acc1,<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"01/01/2007"</span>),
                                  TypedCashflow.CREDIT, <span class="hljs-number">300.00</span>),
            <span class="hljs-keyword">new</span> AllocatedCashflow(acc1,<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"05/02/2007"</span>),
                                  TypedCashflow.CREDIT, <span class="hljs-number">100.00</span>),
            <span class="hljs-keyword">new</span> AllocatedCashflow(acc2,<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"11/03/2007"</span>),
                                  TypedCashflow.CREDIT, <span class="hljs-number">500.00</span>),
            <span class="hljs-keyword">new</span> AllocatedCashflow(acc1,<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"07/02/2007"</span>),
                                  TypedCashflow.DEBIT,  <span class="hljs-number">800.00</span>),
            <span class="hljs-keyword">new</span> AllocatedCashflow(acc2,<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"02/03/2007"</span>),
                                  TypedCashflow.DEBIT,  <span class="hljs-number">400.00</span>),
            <span class="hljs-keyword">new</span> AllocatedCashflow(acc1,<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"01/04/2007"</span>),
                                  TypedCashflow.CREDIT, <span class="hljs-number">200.00</span>),
            <span class="hljs-keyword">new</span> AllocatedCashflow(acc1,<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"05/04/2007"</span>),
                                  TypedCashflow.CREDIT, <span class="hljs-number">300.00</span>),
            <span class="hljs-keyword">new</span> AllocatedCashflow(acc2,<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"11/05/2007"</span>),
                                  TypedCashflow.CREDIT, <span class="hljs-number">700.00</span>),
            <span class="hljs-keyword">new</span> AllocatedCashflow(acc1,<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"07/05/2007"</span>),
                                  TypedCashflow.DEBIT,  <span class="hljs-number">900.00</span>),
            <span class="hljs-keyword">new</span> AllocatedCashflow(acc2,<span class="hljs-keyword">new</span> SimpleDate(<span class="hljs-string">"02/05/2007"</span>),
                                  TypedCashflow.DEBIT,  <span class="hljs-number">100.00</span>)
        };

        <span class="hljs-keyword">new</span> RuleRunner().runRules( <span class="hljs-keyword">new</span> String[] { <span class="hljs-string">"Example6.drl"</span> },
                                   cashflows );
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now, let’s look at the rule in <em class="path">Example6.drl</em>
 to see how we apply each cashflow in date order and calculate and print the balance.</p>
</div>
<div class="exampleblock">
<div class="title">Example 303. Banking Tutorial: Rule in Example6.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Rule 06 - Credit"</span>
    <span class="hljs-keyword">when</span>
        <span class="hljs-variable">$cashflow</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">AllocatedCashflow</span>( <span class="hljs-variable">$account</span> <span class="hljs-symbol">:</span> account,
                                       <span class="hljs-variable">$date</span> <span class="hljs-symbol">:</span> date,
                                       <span class="hljs-variable">$amount</span> <span class="hljs-symbol">:</span> amount,
                                       type == <span class="hljs-constant">TypedCashflow</span>.<span class="hljs-constant">CREDIT</span> )
        <span class="hljs-keyword">not</span> <span class="hljs-constant">AllocatedCashflow</span>( account == <span class="hljs-variable">$account</span>, date &lt; <span class="hljs-variable">$date</span>)
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">System</span>.out.println(<span class="hljs-string">"Credit: "</span> + <span class="hljs-variable">$date</span> + <span class="hljs-string">" :: "</span> + <span class="hljs-variable">$amount</span>);
        <span class="hljs-variable">$account</span>.setBalance(<span class="hljs-variable">$account</span>.getBalance()+<span class="hljs-variable">$amount</span>);
        <span class="hljs-constant">System</span>.out.println(<span class="hljs-string">"Account: "</span> + <span class="hljs-variable">$account</span>.getAccountNo() +
                           <span class="hljs-string">" - new balance: "</span> + <span class="hljs-variable">$account</span>.getBalance());
        retract(<span class="hljs-variable">$cashflow</span>);
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Rule 06 - Debit"</span>
    <span class="hljs-keyword">when</span>
        <span class="hljs-variable">$cashflow</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">AllocatedCashflow</span>( <span class="hljs-variable">$account</span> <span class="hljs-symbol">:</span> account,
                            <span class="hljs-variable">$date</span> <span class="hljs-symbol">:</span> date,
                            <span class="hljs-variable">$amount</span> <span class="hljs-symbol">:</span> amount,
                            type == <span class="hljs-constant">TypedCashflow</span>.<span class="hljs-constant">DEBIT</span> )
        <span class="hljs-keyword">not</span> <span class="hljs-constant">AllocatedCashflow</span>( account == <span class="hljs-variable">$account</span>, date &lt; <span class="hljs-variable">$date</span>)
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">System</span>.out.println(<span class="hljs-string">"Debit: "</span> + <span class="hljs-variable">$date</span> + <span class="hljs-string">" :: "</span> + <span class="hljs-variable">$amount</span>);
        <span class="hljs-variable">$account</span>.setBalance(<span class="hljs-variable">$account</span>.getBalance() - <span class="hljs-variable">$amount</span>);
        <span class="hljs-constant">System</span>.out.println(<span class="hljs-string">"Account: "</span> + <span class="hljs-variable">$account</span>.getAccountNo() +
                           <span class="hljs-string">" - new balance: "</span> + <span class="hljs-variable">$account</span>.getBalance());
        retract(<span class="hljs-variable">$cashflow</span>);
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Although we have separate rules for credits and debits, but we do not specify a type when checking for earlier cashflows.
This is so that all cashflows are applied in date order, regardless of the cashflow type.
In the conditions we identify the account to work with, and in the consequences we update it with the cashflow amount.</p>
</div>
<div class="exampleblock">
<div class="title">Example 304. Banking Tutorial: Output of Example6.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Loading file: Example6.drl
Inserting fact: AllocatedCashflow[account=Account[accountNo=<span class="hljs-number">1</span>,balance=<span class="hljs-number">0.0</span>],date=Mon Jan <span class="hljs-number">01</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span>,type=Credit,amount=<span class="hljs-number">300.0</span>]
Inserting fact: AllocatedCashflow[account=Account[accountNo=<span class="hljs-number">1</span>,balance=<span class="hljs-number">0.0</span>],date=Mon Feb <span class="hljs-number">05</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span>,type=Credit,amount=<span class="hljs-number">100.0</span>]
Inserting fact: AllocatedCashflow[account=Account[accountNo=<span class="hljs-number">2</span>,balance=<span class="hljs-number">0.0</span>],date=Sun Mar <span class="hljs-number">11</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span>,type=Credit,amount=<span class="hljs-number">500.0</span>]
Inserting fact: AllocatedCashflow[account=Account[accountNo=<span class="hljs-number">1</span>,balance=<span class="hljs-number">0.0</span>],date=Wed Feb <span class="hljs-number">07</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span>,type=Debit,amount=<span class="hljs-number">800.0</span>]
Inserting fact: AllocatedCashflow[account=Account[accountNo=<span class="hljs-number">2</span>,balance=<span class="hljs-number">0.0</span>],date=Fri Mar <span class="hljs-number">02</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span>,type=Debit,amount=<span class="hljs-number">400.0</span>]
Inserting fact: AllocatedCashflow[account=Account[accountNo=<span class="hljs-number">1</span>,balance=<span class="hljs-number">0.0</span>],date=Sun Apr <span class="hljs-number">01</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> BST <span class="hljs-number">2007</span>,type=Credit,amount=<span class="hljs-number">200.0</span>]
Inserting fact: AllocatedCashflow[account=Account[accountNo=<span class="hljs-number">1</span>,balance=<span class="hljs-number">0.0</span>],date=Thu Apr <span class="hljs-number">05</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> BST <span class="hljs-number">2007</span>,type=Credit,amount=<span class="hljs-number">300.0</span>]
Inserting fact: AllocatedCashflow[account=Account[accountNo=<span class="hljs-number">2</span>,balance=<span class="hljs-number">0.0</span>],date=Fri May <span class="hljs-number">11</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> BST <span class="hljs-number">2007</span>,type=Credit,amount=<span class="hljs-number">700.0</span>]
Inserting fact: AllocatedCashflow[account=Account[accountNo=<span class="hljs-number">1</span>,balance=<span class="hljs-number">0.0</span>],date=Mon May <span class="hljs-number">07</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> BST <span class="hljs-number">2007</span>,type=Debit,amount=<span class="hljs-number">900.0</span>]
Inserting fact: AllocatedCashflow[account=Account[accountNo=<span class="hljs-number">2</span>,balance=<span class="hljs-number">0.0</span>],date=Wed May <span class="hljs-number">02</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> BST <span class="hljs-number">2007</span>,type=Debit,amount=<span class="hljs-number">100.0</span>]
Debit: Fri Mar <span class="hljs-number">02</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span> :: <span class="hljs-number">400.0</span>
Account: <span class="hljs-number">2</span> - <span class="hljs-keyword">new</span> balance: -<span class="hljs-number">400.0</span>
Credit: Sun Mar <span class="hljs-number">11</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span> :: <span class="hljs-number">500.0</span>
Account: <span class="hljs-number">2</span> - <span class="hljs-keyword">new</span> balance: <span class="hljs-number">100.0</span>
Debit: Wed May <span class="hljs-number">02</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> BST <span class="hljs-number">2007</span> :: <span class="hljs-number">100.0</span>
Account: <span class="hljs-number">2</span> - <span class="hljs-keyword">new</span> balance: <span class="hljs-number">0.0</span>
Credit: Fri May <span class="hljs-number">11</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> BST <span class="hljs-number">2007</span> :: <span class="hljs-number">700.0</span>
Account: <span class="hljs-number">2</span> - <span class="hljs-keyword">new</span> balance: <span class="hljs-number">700.0</span>
Credit: Mon Jan <span class="hljs-number">01</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span> :: <span class="hljs-number">300.0</span>
Account: <span class="hljs-number">1</span> - <span class="hljs-keyword">new</span> balance: <span class="hljs-number">300.0</span>
Credit: Mon Feb <span class="hljs-number">05</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span> :: <span class="hljs-number">100.0</span>
Account: <span class="hljs-number">1</span> - <span class="hljs-keyword">new</span> balance: <span class="hljs-number">400.0</span>
Debit: Wed Feb <span class="hljs-number">07</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> GMT <span class="hljs-number">2007</span> :: <span class="hljs-number">800.0</span>
Account: <span class="hljs-number">1</span> - <span class="hljs-keyword">new</span> balance: -<span class="hljs-number">400.0</span>
Credit: Sun Apr <span class="hljs-number">01</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> BST <span class="hljs-number">2007</span> :: <span class="hljs-number">200.0</span>
Account: <span class="hljs-number">1</span> - <span class="hljs-keyword">new</span> balance: -<span class="hljs-number">200.0</span>
Credit: Thu Apr <span class="hljs-number">05</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> BST <span class="hljs-number">2007</span> :: <span class="hljs-number">300.0</span>
Account: <span class="hljs-number">1</span> - <span class="hljs-keyword">new</span> balance: <span class="hljs-number">100.0</span>
Debit: Mon May <span class="hljs-number">07</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> BST <span class="hljs-number">2007</span> :: <span class="hljs-number">900.0</span>
Account: <span class="hljs-number">1</span> - <span class="hljs-keyword">new</span> balance: -<span class="hljs-number">800.0</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pricing_rule_decision_table_example"><a class="anchor" href="#_pricing_rule_decision_table_example"></a><a class="link" href="#_pricing_rule_decision_table_example">25.6. Pricing Rule Decision Table Example</a></h3>
<div class="paragraph">
<p>The Pricing Rule decision table demonstrates the use of a  decision table in a spreadsheet, in Excel’s XLS format, in calculating the retail cost of an insurance policy.
The purpose of the provide set of rules is to calculate a base price and a discount for a car driver applying for a specific policy.
The driver’s age, history and the policy type all contribute to what the basic premium is, and an additional chunk of rules deals with refining this with a discount percentage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">Name</span>: <span class="hljs-tag">Example</span> <span class="hljs-tag">Policy</span> <span class="hljs-tag">Pricing</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.examples</span><span class="hljs-class">.decisiontable</span><span class="hljs-class">.PricingRuleDTExample</span>
<span class="hljs-tag">Module</span>: <span class="hljs-tag">drools-examples</span>
<span class="hljs-tag">Type</span>: <span class="hljs-tag">Java</span> <span class="hljs-tag">application</span>
<span class="hljs-tag">Rules</span> <span class="hljs-tag">file</span>: <span class="hljs-tag">ExamplePolicyPricing</span><span class="hljs-class">.xls</span>
<span class="hljs-tag">Objective</span>: <span class="hljs-tag">demonstrate</span> <span class="hljs-tag">spreadsheet-based</span> <span class="hljs-tag">decision</span> <span class="hljs-tag">tables</span>.</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_executing_the_example"><a class="anchor" href="#_executing_the_example"></a><a class="link" href="#_executing_the_example">25.6.1. Executing the example</a></h4>
<div class="paragraph">
<p>Open the file <em class="path">PricingRuleDTExample.java</em>
 and  execute it as a Java application.
It should produce the following output in the Console window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Cheapest possible
BASE PRICE IS: <span class="hljs-number">120</span>
DISCOUNT IS: <span class="hljs-number">20</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code to execute the example follows the usual pattern.
The rules are loaded, the facts inserted and a Stateless Session is created.
What is different is how the rules are added.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">DecisionTableConfiguration dtableconfiguration =
    KnowledgeBuilderFactory.newDecisionTableConfiguration();
        dtableconfiguration.setInputType( DecisionTableInputType.XLS );

        KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder();

        Resource xlsRes = ResourceFactory.newClassPathResource( <span class="hljs-string">"ExamplePolicyPricing.xls"</span>,
                                                                getClass() );
        kbuilder.add( xlsRes,
                      ResourceType.DTABLE,
                      dtableconfiguration );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of the <code>DecisionTableConfiguration</code> object.
Its input type is set to <code>DecisionTableInputType.XLS</code>.
If you use the BRMS, all this is of course taken care of for you.</p>
</div>
<div class="paragraph">
<p>There are two fact types used in this example, <code>Driver</code> and <code>Policy</code>.
Both are used with their default values.
The <code>Driver</code> is 30 years old, has had no prior claims and currently has a risk profile of <code>LOW</code>.
The <code>Policy</code> being applied for is <code>COMPREHENSIVE</code>, and it has not yet been approved.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_decision_table"><a class="anchor" href="#_the_decision_table"></a><a class="link" href="#_the_decision_table">25.6.2. The decision table</a></h4>
<div class="paragraph">
<p>In this decision table, each row is a rule, and each column is a condition or an action.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DT_Config.png" alt="DT Config">
</div>
<div class="title">Figure 397. Decision table configuration</div>
</div>
<div class="paragraph">
<p>Referring to the spreadsheet show above, we have the <code>RuleSet</code> declaration, which provides the package name.
There are also other optional items you can have here, such as <code>Variables</code> for global variables, and <code>Imports</code> for importing classes.
In this case, the namespace of the rules is the same as the fact classes we are using, so we can omit it.</p>
</div>
<div class="paragraph">
<p>Moving further down, we can see the <code>RuleTable</code> declaration.
The name after this (Pricing bracket) is used as the prefix for all the generated rules.
Below that, we have "CONDITION or ACTION", indicating the purpose of the column, i.e., whether it forms part of the condition or the consequence of the rule that will be generated.</p>
</div>
<div class="paragraph">
<p>You can see that there is a driver, his data spanned across three cells, which means that the template expressions below it apply to that fact.
We observe the driver’s age range (which uses <code>$1</code> and <code>$2</code> with comma-separated values),  <code>locationRiskProfile</code>, and <code>priorClaims</code> in the respective columns.
In the action columns, we are set the policy base price and log a message.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DT_Table1.png" alt="DT Table1">
</div>
<div class="title">Figure 398. Base price calculation</div>
</div>
<div class="paragraph">
<p>In the preceding spreadsheet section, there are broad category brackets, indicated by the comment in the leftmost column.
As we know the details of our drivers and their policies, we can tell (with a bit of thought) that they should match row number 18, as they have no prior accidents, and are 30 years old.
This gives us a base price of 120.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/DT_Table2.png" alt="DT Table2">
</div>
<div class="title">Figure 399. Discount calculation</div>
</div>
<div class="paragraph">
<p>The above section contains the conditions for the discount we might grant our driver.
The discount results from the <code>Age</code> bracket, the number of prior claims, and the policy type.
In our case, the driver is 30, with no prior claims, and is applying for a <code>COMPREHENSIVE</code> policy, which means we can give a discount of 20%. Note that this is actually a separate table, but in the same worksheet, so that different templates apply.</p>
</div>
<div class="paragraph">
<p>It is important to note that decision tables generate rules.
This means they aren’t simply top-down logic, but more a means to capture data resulting in rules.
This is a subtle difference that confuses some people.
The evaluation of the rules is not necessarily in the given order, since all the normal mechanics of the rule engine still apply.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pet_store_example"><a class="anchor" href="#_pet_store_example"></a><a class="link" href="#_pet_store_example">25.7. Pet Store Example</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">Name: Pet Store
Main class: org.drools.examples.petstore.PetStoreExample
Module: drools-examples
Type: Java application
Rules file: PetStore.drl
Objective: Demonstrate <span class="hljs-operator"><span class="hljs-keyword">use</span> <span class="hljs-keyword">of</span> Agenda <span class="hljs-keyword">Groups</span>, <span class="hljs-keyword">Global</span> <span class="hljs-keyword">Variables</span> <span class="hljs-keyword">and</span> integration <span class="hljs-keyword">with</span> a GUI,
<span class="hljs-keyword">including</span> callbacks <span class="hljs-keyword">from</span> <span class="hljs-keyword">within</span> the <span class="hljs-keyword">rules</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Pet Store example shows how to integrate Rules with a GUI, in this case a Swing based desktop application.
Within the rules file, it demonstrates how to use Agenda groups and auto-focus to control which of a set of rules is allowed to fire at any given time.
It also illustrates the mixing of the Java and MVEL dialects within the rules, the use of accumulate functions and the way of calling Java functions from within the ruleset.</p>
</div>
<div class="paragraph">
<p>All of the Java code is contained in one file, <em class="path">PetStore.java</em>
, defining the following principal classes (in addition to several classes to handle Swing Events):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Petstore</code> contains the <code>main()</code> method that we will look at shortly.</p>
</li>
<li>
<p><code>PetStoreUI</code> is responsible for creating and displaying the Swing based GUI. It contains several smaller classes, mainly for responding to various GUI events such as mouse button clicks.</p>
</li>
<li>
<p><code>TableModel</code> holds the table data. Think of it as a JavaBean that extends the Swing class <code>AbstractTableModel</code>.</p>
</li>
<li>
<p><code>CheckoutCallback</code> allows the GUI to interact with the Rules.</p>
</li>
<li>
<p><code>Ordershow</code> keeps the items that we wish to buy.</p>
</li>
<li>
<p><code>Purchase</code> stores details of the order and the products we are buying.</p>
</li>
<li>
<p><code>Product</code> is a JavaBean holding details of the product available for purchase, and its price.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Much of the Java code is either plain JavaBeans or Swing-based.
Only a few Swing-related points will be discussed in this section, but a good tutorial about Swing components can be found at Sun’s Swing website, in <a href="http://java.sun.com/docs/books/tutorial/uiswing/" class="bare">http://java.sun.com/docs/books/tutorial/uiswing/</a>.</p>
</div>
<div class="paragraph">
<p>The pieces of Java code in <em class="path">Petstore.java</em>
 that relate to rules and facts are shown below.</p>
</div>
<div class="exampleblock">
<div class="title">Example 305. Creating the PetStore KieContainer in PetStore.main</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-comment">// KieServices is the factory for all KIE services</span>
KieServices ks = KieServices.Factory.get();

<span class="hljs-comment">// From the kie services, a container is created from the classpath</span>
KieContainer kc = ks.getKieClasspathContainer();

<span class="hljs-comment">// Create the stock.</span>
Vector&lt;Product&gt; stock = <span class="hljs-keyword">new</span> Vector&lt;Product&gt;();
stock.add( <span class="hljs-keyword">new</span> Product( <span class="hljs-string">"Gold Fish"</span>, <span class="hljs-number">5</span> ) );
stock.add( <span class="hljs-keyword">new</span> Product( <span class="hljs-string">"Fish Tank"</span>, <span class="hljs-number">25</span> ) );
stock.add( <span class="hljs-keyword">new</span> Product( <span class="hljs-string">"Fish Food"</span>, <span class="hljs-number">2</span> ) );

<span class="hljs-comment">// A callback is responsible for populating the</span>
<span class="hljs-comment">// Working Memory and for firing all rules.</span>
PetStoreUI ui = <span class="hljs-keyword">new</span> PetStoreUI( stock,
                                <span class="hljs-keyword">new</span> CheckoutCallback( kc ) );
ui.createAndShowGUI();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The code shown above create a <code>KieContainer</code> from the classpath and based on the definitions in the <em class="path">kmodule.xml</em>
 file.
Unlike other examples where the facts are asserted and fired straight away, this example defers this step to later.
The way it does this is via the second last line where a <code>PetStoreUI</code> object is created using a constructor accepting the <code>Vector</code> object <code>stock</code> collecting our products, and an instance of the <code>CheckoutCallback</code> class containing the Rule Base that we have just loaded.</p>
</div>
<div class="paragraph">
<p>The Java code that fires the rules is within the  <code>CheckoutCallBack.checkout()</code> method.
This is triggered (eventually) when the Checkout button is pressed by the user.</p>
</div>
<div class="exampleblock">
<div class="title">Example 306. Firing the Rules - extract from CheckoutCallBack.checkout()</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">checkout</span><span class="hljs-params">(JFrame frame, List&lt;Product&gt; items)</span> </span>{
    Order order = <span class="hljs-keyword">new</span> Order();

    <span class="hljs-comment">// Iterate through list and add to cart</span>
    <span class="hljs-keyword">for</span> ( Product p: items ) {
        order.addItem( <span class="hljs-keyword">new</span> Purchase( order, p ) );
    }

    <span class="hljs-comment">// Add the JFrame to the ApplicationData to allow for user interaction</span>

    <span class="hljs-comment">// From the container, a session is created based on</span>
    <span class="hljs-comment">// its definition and configuration in the META-INF/kmodule.xml file</span>
    KieSession ksession = kcontainer.newKieSession(<span class="hljs-string">"PetStoreKS"</span>);

    ksession.setGlobal( <span class="hljs-string">"frame"</span>, frame );
    ksession.setGlobal( <span class="hljs-string">"textArea"</span>, <span class="hljs-keyword">this</span>.output );

    ksession.insert( <span class="hljs-keyword">new</span> Product( <span class="hljs-string">"Gold Fish"</span>, <span class="hljs-number">5</span> ) );
    ksession.insert( <span class="hljs-keyword">new</span> Product( <span class="hljs-string">"Fish Tank"</span>, <span class="hljs-number">25</span> ) );
    ksession.insert( <span class="hljs-keyword">new</span> Product( <span class="hljs-string">"Fish Food"</span>, <span class="hljs-number">2</span> ) );

    ksession.insert( <span class="hljs-keyword">new</span> Product( <span class="hljs-string">"Fish Food Sample"</span>, <span class="hljs-number">0</span> ) );

    ksession.insert( order );
    ksession.fireAllRules();

    <span class="hljs-comment">// Return the state of the cart</span>
    <span class="hljs-keyword">return</span> order.toString();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Two items get passed into this method.
One is the handle to the <code>JFrame</code> Swing component surrounding the output text frame, at the bottom of the GUI.
The second is a list of order items; this comes from the <code>TableModel</code> storing the information from the "Table" area at the top right section of the GUI.</p>
</div>
<div class="paragraph">
<p>The for loop transforms the list of order items coming from the GUI into the <code>Order</code> JavaBean, also contained in the file <em class="path">PetStore.java</em>
.
Note that it would be  possible to refer to the Swing dataset directly within the rules, but it is better coding practice to do it this way, using simple Java objects.
It means that we are not tied to Swing if we wanted to transform the sample into a Web application.</p>
</div>
<div class="paragraph">
<p>It is important to note that <em>all state in this
      example is stored in the Swing components, and that the rules are
      effectively stateless.</em> Each time the "Checkout" button is pressed, this code copies the contents of the Swing <code>TableModel</code> into the Session’s Working Memory.</p>
</div>
<div class="paragraph">
<p>Within this code, there are nine calls to the <code>KieSession</code>.
The first of these creates a new <code>KieSession</code> from the <code>KieContainer</code>.
Remember that we passed in this <code>KieContainer</code> when we created the <code>CheckoutCallBack</code> class in the <code>main()</code> method.
The next two calls pass in two objects that we will hold as global variables in the rules: the Swing text area and the Swing frame used for writing messages.</p>
</div>
<div class="paragraph">
<p>More inserts put information on products into the <code>KieSession</code>, as well as the order list.
The final call is the standard <code>fireAllRules()</code>.
Next, we look at what this method causes to happen within the rules file.</p>
</div>
<div class="exampleblock">
<div class="title">Example 307. Package, Imports, Globals and Dialect: extract from PetStore.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">package</span> org.drools.examples

<span class="hljs-keyword">import</span> org.kie.api.runtime.KieRuntime
<span class="hljs-keyword">import</span> org.drools.examples.petstore.PetStoreExample.Order
<span class="hljs-keyword">import</span> org.drools.examples.petstore.PetStoreExample.Purchase
<span class="hljs-keyword">import</span> org.drools.examples.petstore.PetStoreExample.Product
<span class="hljs-keyword">import</span> java.util.ArrayList
<span class="hljs-keyword">import</span> javax.swing.JOptionPane;

<span class="hljs-keyword">import</span> javax.swing.JFrame

global JFrame frame
global javax.swing.JTextArea textArea</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The first part of file <em class="path">PetStore.drl</em>
 contains the standard package and import statements to make various Java classes available to the rules.
New to us are the two globals <code>frame</code> and <code>textArea</code>.
They hold references to the Swing components <code>JFrame</code> and <code>JTextArea</code> components that were previously passed on by the Java code calling the <code>setGlobal()</code> method.
Unlike  variables in rules, which expire as soon as the rule has fired, global variables retain their value for the lifetime of the Session.</p>
</div>
<div class="paragraph">
<p>The next extract from the file <em class="path">PetStore.drl</em>
 contains two functions that are referenced by the rules that we will look at shortly.</p>
</div>
<div class="exampleblock">
<div class="title">Example 308. Java Functions in the Rules: extract from PetStore.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-function">function <span class="hljs-keyword">void</span> <span class="hljs-title">doCheckout</span><span class="hljs-params">(JFrame frame, KieRuntime krt)</span> </span>{
        Object[] options = {<span class="hljs-string">"Yes"</span>,
                            <span class="hljs-string">"No"</span>};

        <span class="hljs-keyword">int</span> n = JOptionPane.showOptionDialog(frame,
                                             <span class="hljs-string">"Would you like to checkout?"</span>,
                                             <span class="hljs-string">""</span>,
                                             JOptionPane.YES_NO_OPTION,
                                             JOptionPane.QUESTION_MESSAGE,
                                             <span class="hljs-keyword">null</span>,
                                             options,
                                             options[<span class="hljs-number">0</span>]);

       <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) {
            krt.getAgenda().getAgendaGroup( <span class="hljs-string">"checkout"</span> ).setFocus();
       }
}

<span class="hljs-function">function <span class="hljs-keyword">boolean</span> <span class="hljs-title">requireTank</span><span class="hljs-params">(JFrame frame, KieRuntime krt, Order order, Product fishTank, <span class="hljs-keyword">int</span> total)</span> </span>{
        Object[] options = {<span class="hljs-string">"Yes"</span>,
                            <span class="hljs-string">"No"</span>};

        <span class="hljs-keyword">int</span> n = JOptionPane.showOptionDialog(frame,
                                             <span class="hljs-string">"Would you like to buy a tank for your "</span> + total + <span class="hljs-string">" fish?"</span>,
                                             <span class="hljs-string">"Purchase Suggestion"</span>,
                                             JOptionPane.YES_NO_OPTION,
                                             JOptionPane.QUESTION_MESSAGE,
                                             <span class="hljs-keyword">null</span>,
                                             options,
                                             options[<span class="hljs-number">0</span>]);

       System.out.print( <span class="hljs-string">"SUGGESTION: Would you like to buy a tank for your "</span>
                           + total + <span class="hljs-string">" fish? - "</span> );

       <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) {
             Purchase purchase = <span class="hljs-keyword">new</span> Purchase( order, fishTank );
             krt.insert( purchase );
             order.addItem( purchase );
             System.out.println( <span class="hljs-string">"Yes"</span> );
       } <span class="hljs-keyword">else</span> {
            System.out.println( <span class="hljs-string">"No"</span> );
       }
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Having these functions in the rules file just makes the Pet Store example more compact.
In real life you probably have the functions in a file of their own, within the same rules package, or as a static method on a standard Java class, and import them, using <code>import function my.package.Foo.hello</code>.</p>
</div>
<div class="paragraph">
<p>The purpose of these two functions is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>doCheckout()</code> displays a dialog asking users whether they wish to checkout. If they do, focus is set to the <code>checkout</code> agenda-group, allowing rules in that group to (potentially) fire.</p>
</li>
<li>
<p><code>requireTank()</code> displays a dialog asking users whether they wish to buy a tank. If so, a new fish tank <code>Product</code> is added to the order list in Working Memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We’ll see the rules that call these functions later on.
The next set of examples are from the Pet Store rules themselves.
The first extract is the one that happens to fire first, partly because it has the <code>auto-focus</code> attribute set to true.</p>
</div>
<div class="exampleblock">
<div class="title">Example 309. Putting items into working memory: extract from PetStore.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">// <span class="hljs-operator"><span class="hljs-keyword">Insert</span> <span class="hljs-keyword">each</span> item <span class="hljs-keyword">in</span> the shopping cart <span class="hljs-keyword">into</span> the Working <span class="hljs-keyword">Memory</span>
// <span class="hljs-keyword">Insert</span> <span class="hljs-keyword">each</span> item <span class="hljs-keyword">in</span> the shopping cart <span class="hljs-keyword">into</span> the Working <span class="hljs-keyword">Memory</span>
rule <span class="hljs-string">"Explode Cart"</span>
    agenda-<span class="hljs-keyword">group</span> <span class="hljs-string">"init"</span>
    <span class="hljs-keyword">auto</span>-focus <span class="hljs-literal">true</span>
    salience <span class="hljs-number">10</span>
    dialect <span class="hljs-string">"java"</span>
<span class="hljs-keyword">when</span>
    $<span class="hljs-keyword">order</span> : <span class="hljs-keyword">Order</span>( grossTotal == -<span class="hljs-number">1</span> )
    $item : Purchase() <span class="hljs-keyword">from</span> $<span class="hljs-keyword">order</span>.items
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">insert</span>( $item );</span>
    kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "<span class="hljs-operator"><span class="hljs-keyword">show</span> items<span class="hljs-string">" ).setFocus();
    kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup( "</span><span class="hljs-keyword">evaluate</span><span class="hljs-string">" ).setFocus();
end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This rule matches against all orders that do not yet have their <code>grossTotal</code> calculated . It loops for each purchase item in that order.
Some parts of the "Explode Cart" rule should be familiar: the rule name, the salience (suggesting the order for the rules being fired) and the dialect set to <code>"java"</code>.
There are three new features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>`agenda-group<code>`"init"</code> defines the name of the agenda group. In this case, there is only one rule in the group. However, neither the Java code nor a rule consequence sets the focus to this group, and therefore it relies on the next attribute for its chance to fire.</p>
</li>
<li>
<p><code>auto-focus<code>`true</code> ensures that this rule, while being the only rule in the agenda group, gets a chance to fire when `fireAllRules()</code> is called from the Java code.</p>
</li>
<li>
<p><code>kcontext…​.setFocus()</code> sets the focus to the <code>"show items"</code> and <code>"evaluate"</code> agenda groups in turn, permitting their rules to fire. In practice, we loop through all items on the order, inserting them into memory, then firing the other rules after each insert.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next two listings show the rules within the <code>"show items"</code> and <code>evaluate</code> agenda groups.
We look at them in the order that they are called.</p>
</div>
<div class="exampleblock">
<div class="title">Example 310. Show Items in the GUI - extract from PetStore.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Show Items"</span>
    agenda-group <span class="hljs-string">"show items"</span>
    dialect <span class="hljs-string">"mvel"</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-variable">$order</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Order</span>( )
    <span class="hljs-variable">$p</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Purchase</span>( order == <span class="hljs-variable">$order</span> )
<span class="hljs-keyword">then</span>
   textArea.append( <span class="hljs-variable">$p</span>.product + <span class="hljs-string">"\n"</span>);
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>"show items"</code> agenda-group has only one rule, called "Show Items" (note the difference in case). For each purchase on the order currently in the Working Memory (or Session), it logs details to the text area at the bottom of the GUI.
The <code>textArea</code> variable used to do this is one of the global variables we looked at earlier.</p>
</div>
<div class="paragraph">
<p>The <code>evaluate</code> Agenda group also gains focus from the <code>"Explode Cart"</code> rule listed previously.
This Agenda group has two rules, <code>"Free Fish Food Sample"</code> and <code>"Suggest Tank"</code>, shown below.</p>
</div>
<div class="exampleblock">
<div class="title">Example 311. Evaluate Agenda Group: extract from PetStore.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs php"><span class="hljs-comment">// Free Fish Food sample when we buy a Gold Fish if we haven't already bought</span>
<span class="hljs-comment">// Fish Food and don't already have a Fish Food Sample</span>
rule <span class="hljs-string">"Free Fish Food Sample"</span>
    agenda-group <span class="hljs-string">"evaluate"</span>
    dialect <span class="hljs-string">"mvel"</span>
when
    <span class="hljs-variable">$order</span> : Order()
    not ( <span class="hljs-variable">$p</span> : Product( name == <span class="hljs-string">"Fish Food"</span>) &amp;amp;&amp;amp; Purchase( product == <span class="hljs-variable">$p</span> ) )
    not ( <span class="hljs-variable">$p</span> : Product( name == <span class="hljs-string">"Fish Food Sample"</span>) &amp;amp;&amp;amp; Purchase( product == <span class="hljs-variable">$p</span> ) )
    exists ( <span class="hljs-variable">$p</span> : Product( name == <span class="hljs-string">"Gold Fish"</span>) &amp;amp;&amp;amp; Purchase( product == <span class="hljs-variable">$p</span> ) )
    <span class="hljs-variable">$fishFoodSample</span> : Product( name == <span class="hljs-string">"Fish Food Sample"</span> );
then
    System.out.println( <span class="hljs-string">"Adding free Fish Food Sample to cart"</span> );
    purchase = <span class="hljs-keyword">new</span> Purchase(<span class="hljs-variable">$order</span>, <span class="hljs-variable">$fishFoodSample</span>);
    insert( purchase );
    <span class="hljs-variable">$order</span>.addItem( purchase );
end

<span class="hljs-comment">// Suggest a tank if we have bought more than 5 gold fish and don't already have one</span>
rule <span class="hljs-string">"Suggest Tank"</span>
    agenda-group <span class="hljs-string">"evaluate"</span>
    dialect <span class="hljs-string">"java"</span>
when
    <span class="hljs-variable">$order</span> : Order()
    not ( <span class="hljs-variable">$p</span> : Product( name == <span class="hljs-string">"Fish Tank"</span>) &amp;amp;&amp;amp; Purchase( product == <span class="hljs-variable">$p</span> ) )
    ArrayList( <span class="hljs-variable">$total</span> : size &amp;gt; <span class="hljs-number">5</span> ) from collect( Purchase( product.name == <span class="hljs-string">"Gold Fish"</span> ) )
    <span class="hljs-variable">$fishTank</span> : Product( name == <span class="hljs-string">"Fish Tank"</span> )
then
    requireTank(frame, kcontext.getKieRuntime(), <span class="hljs-variable">$order</span>, <span class="hljs-variable">$fishTank</span>, <span class="hljs-variable">$total</span>);
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The rule <code>"Free Fish Food Sample"</code> will only fire if</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we <em>don’t </em>already have any fish food, <em>and</em></p>
</li>
<li>
<p>we <em>don’t</em> already have a free fish food sample, <em>and</em></p>
</li>
<li>
<p>we <em>do</em> have a Gold Fish in our order.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the rule does fire, it creates a new product (Fish Food Sample), and adds it to the order in Working Memory.</p>
</div>
<div class="paragraph">
<p>The rule <code>"Suggest Tank"</code> will only fire if</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we <em>don’t </em>already have a Fish Tank in our order, <em>and</em></p>
</li>
<li>
<p>we <em>do</em> have more than 5 Gold Fish Products in our order.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the rule does fire, it calls the <code>requireTank()</code> function that we looked at earlier (showing a Dialog to the user, and adding a Tank to the order / working memory if confirmed). When calling the <em>requireTank</em>() function the rule passes the global <em>frame</em> variable so that the function has a handle to the Swing GUI.</p>
</div>
<div class="paragraph">
<p>The next rule we look at is <code>"do checkout"</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 312. Doing the Checkout - extract (6) from PetStore.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"do checkout"</span>
    dialect <span class="hljs-string">"java"</span>
    <span class="hljs-keyword">when</span>
    <span class="hljs-keyword">then</span>
        doCheckout(frame, kcontext.getKieRuntime());
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The rule <code>"do checkout"</code> has <strong>no
      agenda group set and no auto-focus attribute</strong>.
As such, is is deemed part of the default (MAIN) agenda group.
This group gets focus by default when all the rules in agenda-groups that explicitly had focus set to them have run their course.</p>
</div>
<div class="paragraph">
<p>There is no LHS to the rule, so the RHS will always call the <code>doCheckout()</code> function.
When calling the <code>doCheckout()</code> function, the rule passes the global <code>frame</code> variable to give the function a handle to the Swing GUI.
As we saw earlier, the <code>doCheckout()</code> function shows a confirmation dialog to the user.
If confirmed, the function sets the focus to the <em>checkout</em> agenda-group, allowing the next lot of rules to fire.</p>
</div>
<div class="exampleblock">
<div class="title">Example 313. Checkout Rules: extract from PetStore.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Gross Total"</span>
    agenda-group <span class="hljs-string">"checkout"</span>
    dialect <span class="hljs-string">"mvel"</span>
<span class="hljs-keyword">when</span>
   <span class="hljs-variable">$order</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Order</span>( grossTotal == -<span class="hljs-number">1</span>)
   <span class="hljs-constant">Number</span>( total <span class="hljs-symbol">:</span> doubleValue )
       from accumulate( <span class="hljs-constant">Purchase</span>( <span class="hljs-variable">$price</span> <span class="hljs-symbol">:</span> product.price ), sum( <span class="hljs-variable">$price</span> ) )
<span class="hljs-keyword">then</span>
    modify( <span class="hljs-variable">$order</span> ) { grossTotal = total };
    textArea.append( <span class="hljs-string">"\ngross total="</span> + total + <span class="hljs-string">"\n"</span> );
<span class="hljs-keyword">end</span>

rule <span class="hljs-string">"Apply 5% Discount"</span>
    agenda-group <span class="hljs-string">"checkout"</span>
dialect <span class="hljs-string">"mvel"</span>
<span class="hljs-keyword">when</span>
   <span class="hljs-variable">$order</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Order</span>( grossTotal &amp;gt;= <span class="hljs-number">10</span> &amp;amp;&amp;amp; &amp;lt; <span class="hljs-number">20</span> )
<span class="hljs-keyword">then</span>
   <span class="hljs-variable">$order</span>.discountedTotal = <span class="hljs-variable">$order</span>.grossTotal * <span class="hljs-number">0</span>.<span class="hljs-number">95</span>;
   textArea.append( <span class="hljs-string">"discountedTotal total="</span> + <span class="hljs-variable">$order</span>.discountedTotal + <span class="hljs-string">"\n"</span> );
<span class="hljs-keyword">end</span>


rule <span class="hljs-string">"Apply 10% Discount"</span>
    agenda-group <span class="hljs-string">"checkout"</span>
    dialect <span class="hljs-string">"mvel"</span>
<span class="hljs-keyword">when</span>
   <span class="hljs-variable">$order</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">Order</span>( grossTotal &amp;gt;= <span class="hljs-number">20</span> )
<span class="hljs-keyword">then</span>
   <span class="hljs-variable">$order</span>.discountedTotal = <span class="hljs-variable">$order</span>.grossTotal * <span class="hljs-number">0</span>.<span class="hljs-number">90</span>;
   textArea.append( <span class="hljs-string">"discountedTotal total="</span> + <span class="hljs-variable">$order</span>.discountedTotal + <span class="hljs-string">"\n"</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There are three rules in the <em>checkout</em> agenda-group:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If we haven’t already calculated the gross total, <code>Gross Total</code> accumulates the product prices into a total, puts this total into the session, and displays it via the Swing <code>JTextArea</code>, using the <code>textArea</code> global variable yet again.</p>
</li>
<li>
<p>If our gross total is between 10 and 20, <code>"Apply 5% Discount"</code> calculates the discounted total and adds it to the session and displays it in the text area.</p>
</li>
<li>
<p>If our gross total is not less than 20, <code>"Apply 10% Discount"</code> calculates the discounted total and adds it to the session and displays it in the text area.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now that we’ve run through what happens in the code, let’s have a look at what happens when we actually run the code.
The file <em class="path">PetStore.java</em>
 contains a <code>main()</code> method, so that it can be run as a standard Java application, either from the command line or via the IDE.
This assumes you have your classpath set correctly.
(See the start of the examples section for more information.)</p>
</div>
<div class="paragraph">
<p>The first screen that we see is the Pet Store Demo.
It has a list of available products (top left), an empty list of selected products (top right), checkout and reset buttons (middle) and an empty system messages area (bottom).</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/1-PetStore-Start-Screen.png" alt="1 PetStore Start Screen">
</div>
<div class="title">Figure 400. PetStore Demo just after Launch</div>
</div>
<div class="paragraph">
<p>To get to this point, the following things have happened:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>main()</code> method has run and loaded the Rule Base <em>but not yet fired the rules</em>. So far, this is the only code in connection with rules that has been run.</p>
</li>
<li>
<p>A new <code>PetStoreUI</code> object has been created and given a handle to the Rule Base, for later use.</p>
</li>
<li>
<p>Various Swing components do their stuff, and the above screen is shown and <em>waits for user input</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Clicking on various products from the list might give you a screen similar to the one below.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/2-stock-added-to-order-list.png" alt="2 stock added to order list">
</div>
<div class="title">Figure 401. PetStore Demo with Products Selected</div>
</div>
<div class="paragraph">
<p>Note that <em>no rules code has been fired here</em>.
This is only Swing code, listening for mouse click events, and adding some selected product to the <code>TableModel</code> object for display in the top right hand section.
(As an aside, note that this is a classic use of the Model View Controller design pattern).</p>
</div>
<div class="paragraph">
<p>It is only when we press the "Checkout" button that we fire our business rules, in roughly the same order that we walked through the code earlier.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Method <code>CheckOutCallBack.checkout()</code> is called (eventually) by the Swing class waiting for the click on the "Checkout" button. This inserts the data from the <code>TableModel</code> object (top right hand side of the GUI), and inserts it into the Session’s Working Memory. It then fires the rules.</p>
</li>
<li>
<p>The <code>"Explode Cart"</code> rule is the first to fire, given that it has <code>auto-focus</code> set to true. It loops through all the products in the cart, ensures that the products are in the Working Memory, and then gives the <code>"Show Items"</code> and <code>Evaluation</code> agenda groups a chance to fire. The rules in these groups add the contents of the cart to the text area (at the bottom of the window), decide whether or not to give us free fish food, and to ask us whether we want to buy a fish tank. This is shown in the figure below.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/3-purchase-suggestion.png" alt="3 purchase suggestion">
</div>
<div class="title">Figure 402. Do we want to buy a fish tank?</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <em>Do Checkout</em> rule is the next to fire as it (a) No other agenda group currently has focus and (b) it is part of the default (MAIN) agenda group. It always calls the<em> doCheckout() function </em>which displays a 'Would you like to Checkout?' Dialog Box.</p>
</li>
<li>
<p>The <code>doCheckout()</code> function sets the focus to the <code>checkout</code> agenda-group, giving the rules in that group the option to fire.</p>
</li>
<li>
<p>The rules in the the <code>checkout</code> agenda-group display the contents of the cart and apply the appropriate discount.</p>
</li>
<li>
<p><em>Swing then waits for user input</em> to either checkout more products (and to cause the rules to fire again), or to close the GUI - see the figure below.</p>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/4-Petstore-final-screen.png" alt="4 Petstore final screen">
</div>
<div class="title">Figure 403. Petstore Demo after all rules have fired.</div>
</div>
<div class="paragraph">
<p>We could add more System.out calls to demonstrate this flow of events.
The output, as it currently appears in the Console window, is given in the listing below.</p>
</div>
<div class="exampleblock">
<div class="title">Example 314. Console (System.out) from running the PetStore GUI</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">Adding <span class="hljs-built_in">free</span> Fish Food Sample to cart
SUGGESTION: Would you like to buy a tank <span class="hljs-keyword">for</span> your <span class="hljs-number">6</span> fish? - Yes</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_honest_politician_example"><a class="anchor" href="#_honest_politician_example"></a><a class="link" href="#_honest_politician_example">25.8. Honest Politician Example</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">Name</span>: <span class="hljs-tag">Honest</span> <span class="hljs-tag">Politician</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.examples</span><span class="hljs-class">.honestpolitician</span><span class="hljs-class">.HonestPoliticianExample</span>
<span class="hljs-tag">Module</span>: <span class="hljs-tag">drools-examples</span>
<span class="hljs-tag">Type</span>: <span class="hljs-tag">Java</span> <span class="hljs-tag">application</span>
<span class="hljs-tag">Rules</span> <span class="hljs-tag">file</span>: <span class="hljs-tag">HonestPoliticianExample</span><span class="hljs-class">.drl</span>
<span class="hljs-tag">Objective</span>: <span class="hljs-tag">Illustrate</span> <span class="hljs-tag">the</span> <span class="hljs-tag">concept</span> <span class="hljs-tag">of</span> "<span class="hljs-tag">truth</span> <span class="hljs-tag">maintenance</span>" <span class="hljs-tag">based</span> <span class="hljs-tag">on</span> <span class="hljs-tag">the</span> <span class="hljs-tag">logical</span> <span class="hljs-tag">insertion</span> <span class="hljs-tag">of</span> <span class="hljs-tag">facts</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Honest Politician example demonstrates truth maintenance with logical assertions.
The basic premise is that an object can only exist while a statement is true.
A rule’s consequence can logically insert an  object with the <code>insertLogical()</code> method.
This means the object will only remain in the Working Memory as long as the rule that logically inserted  it remains true.
When the rule is no longer true the object is automatically retracted.</p>
</div>
<div class="paragraph">
<p>In this example there is the class <code>Politician</code>, with a name and a boolean value for being honest.
Four politicians with honest state set to true are inserted.</p>
</div>
<div class="exampleblock">
<div class="title">Example 315. Class Politician</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Politician</span> </span>{
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> honest;
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 316. Honest Politician: Execution</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Politician blair = <span class="hljs-keyword">new</span> Politician(<span class="hljs-string">"blair"</span>, <span class="hljs-keyword">true</span>);
Politician bush = <span class="hljs-keyword">new</span> Politician(<span class="hljs-string">"bush"</span>, <span class="hljs-keyword">true</span>);
Politician chirac = <span class="hljs-keyword">new</span> Politician(<span class="hljs-string">"chirac"</span>, <span class="hljs-keyword">true</span>);
Politician schroder = <span class="hljs-keyword">new</span> Politician(<span class="hljs-string">"schroder"</span>, <span class="hljs-keyword">true</span>);

ksession.insert( blair );
ksession.insert( bush );
ksession.insert( chirac );
ksession.insert( schroder );

ksession.fireAllRules();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Console window output shows that, while there is at least one honest politician, democracy lives.
However, as each politician is in turn corrupted by an evil corporation, so that all politicians become dishonest, democracy is dead.</p>
</div>
<div class="exampleblock">
<div class="title">Example 317. Honest Politician: Console Output</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">Hurrah!!! Democracy Lives
I<span class="hljs-string">'m an evil corporation and I have corrupted schroder
I'</span>m an evil corporation <span class="hljs-keyword">and</span> I have corrupted chirac
I<span class="hljs-string">'m an evil corporation and I have corrupted bush
I'</span>m an evil corporation <span class="hljs-keyword">and</span> I have corrupted blair
We are all Doomed!!! Democracy <span class="hljs-keyword">is</span> Dead</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As soon as there is at least one honest politician in the Working Memory a new <code>Hope</code> object is logically asserted.
This object will only exist while there is at least one honest politician.
As soon as all politicians are dishonest, the <code>Hope</code> object will be automatically retracted.
This rule is given a salience of 10 to ensure that it fires before any other rule, as at this stage the "Hope is Dead" rule is actually true.</p>
</div>
<div class="exampleblock">
<div class="title">Example 318. Honest Politician: Rule "We have an honest politician"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">rule <span class="hljs-string">"We have an honest Politician"</span>
    salience <span class="hljs-number">10</span>
    <span class="hljs-keyword">when</span>
        exists( Politician( honest == <span class="hljs-literal">true</span> ) )
    <span class="hljs-keyword">then</span>
        insertLogical( <span class="hljs-keyword">new</span> Hope() );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>As soon as a <code>Hope</code> object exists the "Hope Lives" rule matches and fires.
It has a salience of 10 so that it takes priority over "Corrupt the Honest".</p>
</div>
<div class="exampleblock">
<div class="title">Example 319. Honest Politician: Rule "Hope Lives"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"Hope Lives"</span>
    salience <span class="hljs-number">10</span>
        <span class="hljs-function"><span class="hljs-keyword">when</span>
            <span class="hljs-title">exists</span>(<span class="hljs-params"> Hope(</span>) )
        then
            System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params"><span class="hljs-string">"Hurrah!!! Democracy Lives"</span></span>)</span>;
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now that there is hope and we have, at the start, four honest politicians, we have four activations for this rule, all in conflict.
They will fire in turn, corrupting each politician so that they are no longer honest.
When all four politicians have been corrupted we have no politicians with the property <code>honest == true</code>.
Thus, the rule "We have an honest Politician" is no longer true and the object it logical inserted (due to the last execution of <code>new Hope()</code>) is automatically retracted.</p>
</div>
<div class="exampleblock">
<div class="title">Example 320. Honest Politician: Rule "Corrupt the Honest"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Corrupt the Honest"</span>
    <span class="hljs-keyword">when</span>
        politician <span class="hljs-symbol">:</span> <span class="hljs-constant">Politician</span>( honest == <span class="hljs-keyword">true</span> )
        exists( <span class="hljs-constant">Hope</span>() )
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">System</span>.out.println( <span class="hljs-string">"I'm an evil corporation and I have corrupted "</span> + politician.getName() );
        modify ( politician ) { honest = <span class="hljs-keyword">false</span> };
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>With the <code>Hope</code> object being automatically retracted, via the truth maintenance system, the conditional element <code>not</code> applied to <code>Hope</code> is no longer true so that the following rule will match and fire.</p>
</div>
<div class="exampleblock">
<div class="title">Example 321. Honest Politician: Rule "Hope is Dead"</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"Hope is Dead"</span>
    <span class="hljs-keyword">when</span>
        <span class="hljs-keyword">not</span>( <span class="hljs-constant">Hope</span>() )
    <span class="hljs-keyword">then</span>
        <span class="hljs-constant">System</span>.out.println( <span class="hljs-string">"We are all Doomed!!! Democracy is Dead"</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Let’s take a look at the Audit trail for this application:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/honest_politician_audit.png" alt="honest politician audit">
</div>
<div class="title">Figure 404. Honest Politician Example Audit View</div>
</div>
<div class="paragraph">
<p>The moment we insert the first politician we have two activations.
The rule "We have an honest Politician" is activated only once for the first inserted politician because it uses an <code>exists</code> conditional element, which matches once for any number.
The rule "Hope is Dead" is also activated at this stage, because we have not yet inserted the <code>Hope</code> object.
Rule "We have an honest Politician" fires first, as it has a higher salience than "Hope is Dead", which inserts the <code>Hope</code> object.
(That action is highlighted green.) The insertion of the <code>Hope</code> object activates "Hope Lives" and de-activates "Hope is Dead"; it also activates "Corrupt the Honest" for each inserted honest politician.
Rule "Hope Lives" executes, printing  "Hurrah!!! Democracy Lives". Then, for each politician, rule "Corrupt the Honest" fires, printing "I’m an evil corporation and I have corrupted X", where X is the name of the politician, and modifies the politician’s honest value to false.
When the last honest politician is corrupted, <code>Hope</code> is automatically retracted, by the truth maintenance system, as shown by the blue highlighted area.
The green highlighted area shows the origin of the currently selected blue highlighted area.
Once the <code>Hope</code> fact is retracted, "Hope is dead" activates and fires printing "We are all Doomed!!! Democracy is Dead".</p>
</div>
</div>
<div class="sect2">
<h3 id="_sudoku_example"><a class="anchor" href="#_sudoku_example"></a><a class="link" href="#_sudoku_example">25.9. Sudoku Example</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">Name</span>: <span class="hljs-tag">Sudoku</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.examples</span><span class="hljs-class">.sudoku</span><span class="hljs-class">.SudokuExample</span>
<span class="hljs-tag">Type</span>: <span class="hljs-tag">Java</span> <span class="hljs-tag">application</span>
<span class="hljs-tag">Rules</span> <span class="hljs-tag">file</span>: <span class="hljs-tag">sudoku</span><span class="hljs-class">.drl</span>, <span class="hljs-tag">validate</span><span class="hljs-class">.drl</span>
<span class="hljs-tag">Objective</span>: <span class="hljs-tag">Demonstrates</span> <span class="hljs-tag">the</span> <span class="hljs-tag">solving</span> <span class="hljs-tag">of</span> <span class="hljs-tag">logic</span> <span class="hljs-tag">problems</span>, <span class="hljs-tag">and</span> <span class="hljs-tag">complex</span> <span class="hljs-tag">pattern</span> <span class="hljs-tag">matching</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example demonstrates how Drools can be used to find a solution in a large potential solution space based on a number of constraints.
We use the popular puzzle of Sudoku.
This example also shows how Drools can be integrated into a graphical interface and how callbacks can be used to interact with a running Drools rules engine in order to update the graphical interface based on changes in the Working Memory at runtime.</p>
</div>
<div class="sect3">
<h4 id="_sudoku_overview"><a class="anchor" href="#_sudoku_overview"></a><a class="link" href="#_sudoku_overview">25.9.1. Sudoku Overview</a></h4>
<div class="paragraph">
<p>Sudoku is a logic-based number placement puzzle.
The objective is to fill a 9x9 grid so that each column, each row, and each of the nine 3x3 zones contains the digits from 1 to 9, once, and only once.</p>
</div>
<div class="paragraph">
<p>The puzzle setter provides a partially completed grid and the puzzle solver’s task is to complete the grid with these constraints.</p>
</div>
<div class="paragraph">
<p>The general strategy to solve the problem is to ensure that when you insert a new number it should be unique in its particular 3x3 zone, row and column.</p>
</div>
<div class="paragraph">
<p>See <a href="http://en.wikipedia.org/wiki/Sudoku">Wikipedia</a> for a more detailed description.</p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_example"><a class="anchor" href="#_running_the_example"></a><a class="link" href="#_running_the_example">25.9.2. Running the Example</a></h4>
<div class="paragraph">
<p>Download and install drools-examples as described above and then execute <em class="path">java org.drools.examples.DroolsExamplesApp</em>
 and click on "SudokuExample".</p>
</div>
<div class="paragraph">
<p>The window contains an empty grid, but the program comes with a number of grids stored internally which can be loaded and solved.
Click on "File", then "Samples" and select "Simple" to load one of the examples.
Note that all buttons are disabled until a grid is loaded.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/sudoku1.png" alt="sudoku1">
</div>
<div class="title">Figure 405. Initial screen</div>
</div>
<div class="paragraph">
<p>Loading the "Simple" example fills the grid according to the puzzle’s initial state.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/sudoku2.png" alt="sudoku2">
</div>
<div class="title">Figure 406. After loading "Simple"</div>
</div>
<div class="paragraph">
<p>Click on the "Solve" button and the Drools-based engine will fill out the remaining values, and the buttons are inactive once more.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/sudoku3.png" alt="sudoku3">
</div>
<div class="title">Figure 407. "Simple" Solved</div>
</div>
<div class="paragraph">
<p>Alternatively, you may click on the "Step" button to see the next digit found by the rule set.
The Console window will display detailed information about the rules which are executing to solve the step in a human readable form.
Some examples of these messages are presented below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>single 8 at [0,1]
column elimination due to [1,2]: remove 9 from [4,2]
hidden single 9 at [1,2]
row elimination due to [2,8]: remove 7 from [2,4]
remove 6 from [3,8] due to naked pair at [3,2] and [3,7]
hidden pair in row at [4,6] and [4,4]</pre>
</div>
</div>
<div class="paragraph">
<p>Click on the "Dump" button to see the state of the grid, with cells showing either the established value or the remaining  possibilitiescandidates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>       Col: 0     Col: 1     Col: 2     Col: 3     Col: 4     Col: 5     Col: 6     Col: 7     Col: 8
Row 0:   2 4  7 9   2 456        4567 9   23 56  9  --- 5 ---  --- 1 ---    3  67 9  --- 8 ---     4 67
Row 1:  12    7 9  --- 8 ---  1    67 9   23  6  9  --- 4 ---   23  67    1 3  67 9    3  67 9  --- 5 ---
Row 2:  1  4  7 9  1  456     --- 3 ---      56 89      5 78       5678   --- 2 ---     4 67 9  1  4 67
Row 3:  1234       12345      1  45      12  5  8   --- 6 ---   2  5 78       5 78      45 7    --- 9 ---
Row 4:  --- 6 ---  --- 7 ---      5      --- 4 ---   2  5  8   --- 9 ---      5  8   --- 1 ---  --- 3 ---
Row 5:  --- 8 ---  12 45      1  45   9  12  5      --- 3 ---   2  5 7        567       4567     2 4 67
Row 6:  1 3   7    1 3  6     --- 2 ---    3 56 8       5  8     3 56 8   --- 4 ---    3 567 9  1    678
Row 7:  --- 5 ---  1 34 6     1  4 678     3  6 8   --- 9 ---    34 6 8   1 3  678   --- 2 ---  1    678
Row 8:    34       --- 9 ---     4 6 8   --- 7 ---  --- 1 ---   23456 8     3 56 8     3 56          6 8</pre>
</div>
</div>
<div class="paragraph">
<p>Now, let us load a Sudoku grid that is deliberately invalid.
Click on "File", "Samples" and "!DELIBERATELY BROKEN!". Note that this grid starts with some issues, for example the value 5 appears twice in the first row.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/sudoku4.png" alt="sudoku4">
</div>
<div class="title">Figure 408. Broken initial state</div>
</div>
<div class="paragraph">
<p>A few simple rules perform a sanity check, right after loading a grid.
In this case, the following messages are printed on standard output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cell [0,8]: 5 has a duplicate in row 0
cell [0,0]: 5 has a duplicate in row 0
cell [6,0]: 8 has a duplicate in col 0
cell [4,0]: 8 has a duplicate in col 0
Validation complete.</pre>
</div>
</div>
<div class="paragraph">
<p>Nevertheless, click on the "Solve" button to apply the solving rules to this invalid grid.
This will not complete; some cells remain empty.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/sudoku5.png" alt="sudoku5">
</div>
<div class="title">Figure 409. Broken "solved" state</div>
</div>
<div class="paragraph">
<p>The solving functionality has been achieved by the use of rules that implement standard solving techniques.
They are based on the sets of values that are still candidates for a cell.
If, for instance, such a set contains a single value, then this is the value for the cell.
A little less obvious is the single occurrence of a value in one of the groups of nine cells.
The rules detecting these situations insert a fact of type Setting with the solution value for some specific cell.
This fact causes the elimination of this value from all other cells in any of the groups the cell belongs to.
Finally, it is retracted.</p>
</div>
<div class="paragraph">
<p>Other rules merely reduce the permissible values for some cells.
Rules "naked pair", "hidden pair in row", "hidden pair in column" and "hidden pair in square" merely eliminate possibilities but do not establish solutions.
More sophisticated eliminations are done by "X-wings in rows", "X-wings in columns", "intersection removal row" and "intersection removal column".</p>
</div>
</div>
<div class="sect3">
<h4 id="_java_source_and_rules_overview"><a class="anchor" href="#_java_source_and_rules_overview"></a><a class="link" href="#_java_source_and_rules_overview">25.9.3. Java Source and Rules Overview</a></h4>
<div class="paragraph">
<p>The Java source code can be found in the /src/main/java/org/drools/examples/sudoku directory, with the two DRL files defining the rules located in the /src/main/rules/org/drools/examples/sudoku directory.</p>
</div>
<div class="paragraph">
<p>The package <code>org.drools.examples.sudoku.swing</code> contains a set of classes which implement a framework for Sudoku puzzles.
Note that this package does not have any dependencies on the Drools libraries. <code>SudokuGridModel</code> defines an interface which can be implemented to store a Sudoku puzzle as a 9x9 grid of <code>Cell</code> objects. <code>SudokuGridView</code> is a Swing component which can visualize any implementation of <code>SudokuGridModel</code>. <code>SudokuGridEvent</code> and <code>SudokuGridListener</code> are used to communicate state changes between the model and the view: events are fired when a cell’s value is resolved or changed.
If you are familiar with the model-view-controller patterns in other Swing components such as <code>JTable</code> then this pattern should be familiar. <code>SudokuGridSamples</code> provides a number of partially filled Sudoku puzzles for demonstration purposes.</p>
</div>
<div class="paragraph">
<p>Package <code>org.drools.examples.sudoku.rules</code> contains a utility class with a method for compiling DRL files.</p>
</div>
<div class="paragraph">
<p>The package <code>org.drools.examples.sudoku</code> contains a set of classes implementing the elementary <code>Cell</code> object and its various aggregations: the <code>CellFile</code> subtypes <code>CellRow</code> and <code>CellCol</code> as well as <code>CellSqr</code>, all of which are subtypes of <code>CellGroup</code>.
It’s interesting to note that <code>Cell</code> and <code>CellGroup</code> are subclasses of <code>SetOfNine</code>, which provides a property <code>free</code> with the type <code>Set&lt;Integer&gt;</code>.
For a <code>Cell</code> it represents the individual candidate set; for a <code>CellGroup</code> the set is the union of all candidate sets of its cells, or, simply, the set of digits that still need to be allocated.</p>
</div>
<div class="paragraph">
<p>With 81 <code>Cell</code> and 27 <code>CellGroup</code> objects and the linkage provided by the <code>Cell</code> properties  <code>cellRow</code>, <code>cellCol</code> and <code>cellSqr</code> and the <code>CellGroup</code> property <code>cells</code>, a list of <code>Cell</code> objects, it is possible to write rules that detect the specific situations that permit the allocation of a value to a cell or the elimination of a value from some candidate  set.</p>
</div>
<div class="paragraph">
<p>An object of class <code>Setting</code> is used for triggering the operations that accompany the allocation of a value: its removal from the candidate sets of sibling cells and associated cell groups.
Moreover, the presence of a <code>Setting</code> fact is used in all rules that should detect a new situation; this is to avoid reactions to inconsistent intermediary states.</p>
</div>
<div class="paragraph">
<p>An object of class <code>Stepping</code> is used in a low priority rule to execute an emergency halt when a "Step" does not terminate regularly.
This indicates that the puzzle cannot be solved by the program.</p>
</div>
<div class="paragraph">
<p>The class <code>org.drools.examples.sudoku.SudokuExample</code> implements a Java application combining the components described.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sudoku_validator_rules_validate_drl"><a class="anchor" href="#_sudoku_validator_rules_validate_drl"></a><a class="link" href="#_sudoku_validator_rules_validate_drl">25.9.4. Sudoku Validator Rules (validate.drl)</a></h4>
<div class="paragraph">
<p>Validation rules detect duplicate numbers in cell groups.
They are combined in an agenda group which enables us to activate them, explicitly, after loading a puzzle.</p>
</div>
<div class="paragraph">
<p>The three rules "duplicate in cell…​" are very similar.
The first pattern locates a cell with an allocated value.
The second pattern pulls in any of the three cell groups the cell belongs to.
The final pattern would find a cell (other than the first one) with the same value as the first cell and in the same row, column or square, respectively.</p>
</div>
<div class="paragraph">
<p>Rule "terminate group" fires last.
It prints a message and calls halt.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sudoku_solving_rules_sudoku_drl"><a class="anchor" href="#_sudoku_solving_rules_sudoku_drl"></a><a class="link" href="#_sudoku_solving_rules_sudoku_drl">25.9.5. Sudoku Solving Rules (sudoku.drl)</a></h4>
<div class="paragraph">
<p>There are three types of rules in this file: one group handles the allocation of a number to a cell, another group detects feasible allocations, and the third group eliminates values from candidate sets.</p>
</div>
<div class="paragraph">
<p>Rules  "set a value", "eliminate a value from Cell" and "retract setting" depend on the presence of a <code>Setting</code> object.
The first rule handles the assignment to the cell and the operations for removing the value from the "free" sets of the  cell’s three groups.
Also, it decrements a counter that, when zero, returns control to the Java application that has called <code>fireUntilHalt()</code>.
The purpose of rule "eliminate a value from Cell" is to reduce the candidate lists of all cells that are related to the newly assigned cell.
Finally, when all eliminations have been made, rule "retract setting" retracts the triggering <code>Setting</code> fact.</p>
</div>
<div class="paragraph">
<p>There are just two rules that detect a situation where an allocation of a number to a cell is possible.
Rule "single" fires for a <code>Cell</code> with a candidate set containing a single number.
Rule "hidden single" fires when there is no cell with a single candidate but when there is a cell containing a candidate but   this candidate is absent from all other cells in one of the three groups the cell belongs to.
Both rules create and insert a <code>Setting</code> fact.</p>
</div>
<div class="paragraph">
<p>Rules from the largest group of rules implement, singly or in groups of two or three, various solving techniques, as they are employed when solving Sudoku puzzles manually.</p>
</div>
<div class="paragraph">
<p>Rule "naked pair" detects identical candidate sets of size 2 in two cells of a group; these two values may be removed from all other candidate sets of that group.</p>
</div>
<div class="paragraph">
<p>A similar idea motivates the three rules "hidden pair in…​"; here, the rules look for a subset of two numbers in exactly two cells of a group, with neither value occurring in any of the other cells of this group.
This, then, means that all other candidates can be eliminated from the two cells harbouring the hidden pair.</p>
</div>
<div class="paragraph">
<p>A pair of rules deals with "X-wings" in rows and columns.
When there are only two possible cells for a value in each of two different rows (or columns) and these candidates lie also in the same columns (or rows), then all other candidates for  this value in the columns (or rows) can be eliminated.
If you follow the pattern sequence in one of these rules, you will see how the conditions that are conveniently expressed by words such as "same" or "only" result in patterns with suitable constraints or prefixed with "not".</p>
</div>
<div class="paragraph">
<p>The rule pair "intersection removal…​" is based on the restricted occurrence of some number within one square, either in a single row or in a single column.
This means that this number must be in one of those two or three cells of the row or column; hence it can be removed from the candidate sets of all other cells of the group.
The pattern establishes the restricted occurrence and then fires for each cell outside the square and within the same cell file.</p>
</div>
<div class="paragraph">
<p>These rules are sufficient for many but certainly not for all Sudoku puzzles.
To solve very difficult grids, the rule set would need to be extended with more complex rules.
(Ultimately, there are puzzles that cannot be solved except by trial and error.)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_number_guess"><a class="anchor" href="#_number_guess"></a><a class="link" href="#_number_guess">25.10. Number Guess</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">Name</span>: <span class="hljs-tag">Number</span> <span class="hljs-tag">Guess</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.examples</span><span class="hljs-class">.numberguess</span><span class="hljs-class">.NumberGuessExample</span>
<span class="hljs-tag">Module</span>: <span class="hljs-tag">droolsjbpm-integration-examples</span> (<span class="hljs-tag">Note</span>: <span class="hljs-tag">this</span> <span class="hljs-tag">is</span> <span class="hljs-tag">in</span> <span class="hljs-tag">a</span> <span class="hljs-tag">different</span> <span class="hljs-tag">download</span>, <span class="hljs-tag">the</span> <span class="hljs-tag">droolsjbpm-integration</span> <span class="hljs-tag">download</span>.)
<span class="hljs-tag">Type</span>: <span class="hljs-tag">Java</span> <span class="hljs-tag">application</span>
<span class="hljs-tag">Rules</span> <span class="hljs-tag">file</span>: <span class="hljs-tag">NumberGuess</span><span class="hljs-class">.drl</span>
<span class="hljs-tag">Objective</span>: <span class="hljs-tag">Demonstrate</span> <span class="hljs-tag">use</span> <span class="hljs-tag">of</span> <span class="hljs-tag">Rule</span> <span class="hljs-tag">Flow</span> <span class="hljs-tag">to</span> <span class="hljs-tag">organise</span> <span class="hljs-tag">Rules</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The "Number Guess" example shows the use of Rule Flow, a way of controlling the order in which rules are fired.
It uses widely understood workflow diagrams for defining the order in which groups of rules will be executed.</p>
</div>
<div class="exampleblock">
<div class="title">Example 322. Creating the Number Guess RuleBase: NumberGuessExample.main() - part 1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">final</span> KnowledgeBuilder kbuilder = KnowledgeBuilderFactory.newKnowledgeBuilder();
kbuilder.add( ResourceFactory.newClassPathResource( <span class="hljs-string">"NumberGuess.drl"</span>,
                                                    ShoppingExample.class ),
              ResourceType.DRL );
kbuilder.add( ResourceFactory.newClassPathResource( <span class="hljs-string">"NumberGuess.rf"</span>,
                                                    ShoppingExample.class ),
              ResourceType.DRF );

<span class="hljs-keyword">final</span> KnowledgeBase kbase = KnowledgeBaseFactory.newKnowledgeBase();
kbase.addKnowledgePackages( kbuilder.getKnowledgePackages() );</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The creation of the package and the loading of the rules (using the <code>add()</code> method) is the same as the previous examples.
There is an additional line to add the Rule Flow (<em class="path">NumberGuess.rf</em>
), which provides the option of specifying different rule flows for the same Knowledge Base.
Otherwise, the Knowledge Base is created in the same manner as before.</p>
</div>
<div class="exampleblock">
<div class="title">Example 323. Starting the RuleFlow: NumberGuessExample.main() - part 2</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-keyword">final</span> StatefulKnowledgeSession ksession = kbase.newStatefulKnowledgeSession();

KnowledgeRuntimeLogger logger =
  KnowledgeRuntimeLoggerFactory.newFileLogger(ksession, <span class="hljs-string">"log/numberguess"</span>);

ksession.insert( <span class="hljs-keyword">new</span> GameRules( <span class="hljs-number">100</span>, <span class="hljs-number">5</span> ) );
ksession.insert( <span class="hljs-keyword">new</span> RandomNumber() );
ksession.insert( <span class="hljs-keyword">new</span> Game() );

ksession.startProcess( <span class="hljs-string">"Number Guess"</span> );
ksession.fireAllRules();

logger.close();

ksession.dispose();</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once we have a Knowledge Base, we can use it to obtain a Stateful Session.
Into our session we insert our facts, i.e., standard Java objects.
(For simplicity, in this sample, these classes are all contained within our <em class="path">NumberGuessExample.java</em>
 file.
Class <code>GameRules</code> provides the maximum range and the number of guesses allowed.
Class <code>RandomNumber</code> automatically generates a number between 0 and 100 and makes it available to our rules, by insertion via the <code>getValue()</code> method.
Class <code>Game</code> keeps track of the guesses we have made before, and their number.</p>
</div>
<div class="paragraph">
<p>Note that before we call the standard <code>fireAllRules()</code> method, we also start the process that we loaded earlier, via the <code>startProcess()</code> method.
We’ll learn where to obtain the parameter we pass ("Number Guess", i.e., the identifier of the rule flow) when we talk about the rule flow file and the graphical Rule Flow Editor below.</p>
</div>
<div class="paragraph">
<p>Before we finish the discussion of our Java code, we note that in some real-life application we would examine the final state of the objects.
(Here, we could retrieve the number of guesses, to add it to a high score table.) For this example we are content to ensure that the Working Memory session is cleared by calling the <code>dispose()</code> method.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/numberguess-ruleflow.png" alt="numberguess ruleflow">
</div>
<div class="title">Figure 410. RuleFlow for the NumberGuess Example</div>
</div>
<div class="paragraph">
<p>If you open the <em class="path">NumberGuess.rf</em>
 file in the Drools IDE (provided you have the JBoss Rules extensions installed correctly in Eclipse) you should see the above diagram, similar to a standard flowchart.
Its icons are similar (but not exactly the same) as in the JBoss jBPM workflow product.
Should you wish to edit the diagram, a menu of available components should be available to the left of the diagram in the IDE, which is called the <em>palette</em>.
This diagram is saved in XML, an (almost) human readable format, using XStream.</p>
</div>
<div class="paragraph">
<p>If it is not already open, ensure that the Properties View is visible in the IDE.
It can be opened by clicking "Window", then "Show View" and "Other", where you can select the "Properties" view.
If you do this <em>before</em> you select any item on the rule flow (or click on the blank space in the rule flow) you should be presented with the following set of properties.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/numberguess-ruleflow-properties.png" alt="numberguess ruleflow properties">
</div>
<div class="title">Figure 411. Properties for the Number Guess Rule Flow</div>
</div>
<div class="paragraph">
<p>Keep an eye on the Properties View as we progress through the example’s rule flow, as it presents valuable information.
In this case, it provides us with the identification of the Rule Flow Process that we used in our earlier code snippet, when we called <code>session.startProcess()</code>.</p>
</div>
<div class="paragraph">
<p>In the "Number Guess" Rule Flow we encounter several node types, many of them identified by an icon.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Start node (white arrow in a green circle) and the End node (red box) mark beginning and end of the rule flow.</p>
</li>
<li>
<p>A Rule Flow Group box (yellow, without an icon) represents a Rule Flow Groups defined in our rules (DRL) file that we will look at later. For example, when the flow reaches the Rule Flow Group "Too High", only those rules marked with an attribute of `ruleflow-group<code>`"Too High"</code> can potentially fire.</p>
</li>
<li>
<p>Action nodes (yellow, cog-shaped icon) perform standard Java method calls. Most action nodes in this example call <code>System.out.println()</code>, indicating the program’s progress to the user.</p>
</li>
<li>
<p>Split and Join Nodes (blue ovals, no icon) such as "Guess Correct?" and "More guesses Join" mark places where the flow of control can split, according to various conditions, and rejoin, respectively</p>
</li>
<li>
<p>Arrows indicate the flow between the various nodes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The various nodes in combination with the rules make the Number Guess game work.
For example, the "Guess" Rule Flow Group allows only the rule "Get user Guess" to fire, because only that rule has a matching attribute of `ruleflow-group<code>`"Guess"</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 324. A Rule firing only at a specific point in the Rule Flow: NumberGuess.drl</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">rule <span class="hljs-string">"Get user Guess"</span>
    ruleflow-group <span class="hljs-string">"Guess"</span>
    <span class="hljs-literal">no</span>-<span class="hljs-keyword">loop</span>
    <span class="hljs-keyword">when</span>
        $r : RandomNumber()
        rules : GameRules( allowed : allowedGuesses )
        game : Game( guessCount &lt; allowed )
        <span class="hljs-keyword">not</span> ( Guess() )
    <span class="hljs-keyword">then</span>
        System.out.println( <span class="hljs-string">"You have "</span> + ( rules.allowedGuesses - game.guessCount )
                            + <span class="hljs-string">" out of "</span> + rules.allowedGuesses
                            + <span class="hljs-string">" guesses left.\nPlease enter your guess from 0 to "</span>
                            + rules.maxRange );
        br = <span class="hljs-keyword">new</span> BufferedReader( <span class="hljs-keyword">new</span> InputStreamReader( System.<span class="hljs-keyword">in</span> ) );
        i = br.readLine();
        modify ( game ) { guessCount = game.guessCount + <span class="hljs-number">1</span> }
        insert( <span class="hljs-keyword">new</span> Guess( i ) );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The rest of this rule is fairly standard.
The LHS section (after <code>when</code>) of the rule states that it will be activated for each <code>RandomNumber</code> object inserted into the Working Memory where <code>guessCount</code> is less than <code>allowedGuesses</code> from the <code>GameRules</code> object and where the user has not guessed the correct number.</p>
</div>
<div class="paragraph">
<p>The RHS section (or consequence, after <code>then</code>) prints a message to the user and then awaits user input from <code>System.in</code>.
After obtaining this input (the <code>readLine()</code> method call blocks until the return key is pressed) it modifies the guess count and inserts the new guess, making both available to the Working Memory.</p>
</div>
<div class="paragraph">
<p>The rest of the rules file is fairly standard: the package declares the dialect as MVEL, and various Java classes are imported.
In total, there are five rules in this file:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get User Guess, the Rule we examined above.</p>
</li>
<li>
<p>A Rule to record the highest guess.</p>
</li>
<li>
<p>A Rule to record the lowest guess.</p>
</li>
<li>
<p>A Rule to inspect the guess and retract it from memory if incorrect.</p>
</li>
<li>
<p>A Rule that notifies the user that all guesses have been used up.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>One point of integration between the standard Rules and the RuleFlow is via the <code>ruleflow-group</code> attribute on the rules, as discussed above.
A <em>second point of integration
  between the rules (.drl) file and the Rules Flow .rf files</em> is that the Split Nodes (the blue ovals) can use values in the Working Memory (as updated by the rules) to decide which flow of action to take.
To see how this works, click on the "Guess Correct Node"; then within the Properties View, open the Constraints Editor by clicking the button at the right that appears once you click on the "Constraints" property line.
You should see something similar to the diagram below.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/numberguess-editconstraints.png" alt="numberguess editconstraints">
</div>
<div class="title">Figure 412. Edit Constraints for the "Guess Correct" Node</div>
</div>
<div class="paragraph">
<p>Click on the "Edit" button beside "To node Too High" and you’ll see a dialog like the one below.
The values in the "Textual Editor" window follow the standard rule format for the LHS and can refer to objects in Working Memory.
The consequence (RHS) is that the flow of control follows this node (i.e., "To node Too High") if the LHS expression evaluates to true.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/numberguess-constraint-toohigh.png" alt="numberguess constraint toohigh">
</div>
<div class="title">Figure 413. Constraint Editor for the "Guess Correct" Node: value too high</div>
</div>
<div class="paragraph">
<p>Since the file <em class="path">NumberGuess.java</em>
 contains a <code>main()</code> method, it can be run as a standard Java application, either from the command line or via the IDE.
A typical game might result in the interaction below.
The numbers in bold are typed in by the user.</p>
</div>
<div class="exampleblock">
<div class="title">Example 325. Example Console output where the Number Guess Example beat the human!</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">You have <span class="hljs-number">5</span> out of <span class="hljs-number">5</span> guesses left.
Please enter your guess from <span class="hljs-number">0</span> to <span class="hljs-number">100</span>
<span class="hljs-number">50</span>
Your guess was too high
You have <span class="hljs-number">4</span> out of <span class="hljs-number">5</span> guesses left.
Please enter your guess from <span class="hljs-number">0</span> to <span class="hljs-number">100</span>
<span class="hljs-number">25</span>
Your guess was too low
You have <span class="hljs-number">3</span> out of <span class="hljs-number">5</span> guesses left.
Please enter your guess from <span class="hljs-number">0</span> to <span class="hljs-number">100</span>
<span class="hljs-number">37</span>
Your guess was too low
You have <span class="hljs-number">2</span> out of <span class="hljs-number">5</span> guesses left.
Please enter your guess from <span class="hljs-number">0</span> to <span class="hljs-number">100</span>
<span class="hljs-number">44</span>
Your guess was too low
You have <span class="hljs-number">1</span> out of <span class="hljs-number">5</span> guesses left.
Please enter your guess from <span class="hljs-number">0</span> to <span class="hljs-number">100</span>
<span class="hljs-number">47</span>
Your guess was too low
You have no more guesses
The correct guess was <span class="hljs-number">48</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A summary of what is happening in this sample is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>main()</code> method of <em class="path">NumberGuessExample.java</em> loads a Rule Base, creates a Stateful Session and inserts <code>Game</code>, <code>GameRules</code> and <code>RandomNumber</code> (containing the target number) objects into it. The method also sets the process flow we are going to use, and fires all rules. Control passes to the Rule Flow.</p>
</li>
<li>
<p>File <em class="path">NumberGuess.rf</em> , the Rule Flow, begins at the "Start" node.</p>
</li>
<li>
<p>Control passes (via the "More guesses" join node) to the Guess node.</p>
</li>
<li>
<p>At the Guess node, the appropriate Rule Flow Group ("Get user Guess") is enabled. In this case the Rule "Guess" (in the <em class="path">NumberGuess.drl</em> file) is triggered. This rule displays a message to the user, takes the response, and puts it into Working Memory. Flow passes to the next Rule Flow Node.</p>
</li>
<li>
<p>At the next node, "Guess Correct", constraints inspect the current session and decide which path to take.</p>
<div class="paragraph">
<p>If the guess in step 4 was too high or too low, flow proceeds along a path which has an action node with normal Java code printing a suitable message and a Rule Flow Group causing a highest guess or lowest guess rule to be triggered.
Flow passes from these nodes to step 6.</p>
</div>
<div class="paragraph">
<p>If the guess in step 4 was right, we proceed along the path towards the end of the Rule Flow.
Before we get there, an action node with normal Java code prints a statement "you guessed correctly". There is a join node here (just before the Rule Flow end) so that our no-more-guesses path (step 7) can also terminate the Rule Flow.</p>
</div>
</li>
<li>
<p>Control passes as per the Rule Flow via a join node, a guess incorrect Rule Flow Group (triggering a rule to retract a guess from Working Memory) onto the "More guesses" decision node.</p>
</li>
<li>
<p>The "More guesses" decision node (on the right hand side of the rule flow) uses constraints, again looking at values that the rules have put into the working memory, to decide if we have more guesses and if so, goto step 3. If not, we proceed to the end of the rule flow, via a Rule Flow Group that triggers a rule stating "you have no more guesses".</p>
</li>
<li>
<p>The loop over steps 3 to 7 continues until the number is guessed correctly, or we run out of guesses.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_conway_s_game_of_life"><a class="anchor" href="#_conway_s_game_of_life"></a><a class="link" href="#_conway_s_game_of_life">25.11. Conway’s Game Of Life</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">Name: Conway<span class="hljs-string">'s Game Of Life
Main class: org.drools.examples.conway.ConwayAgendaGroupRun
            org.drools.examples.conway.ConwayRuleFlowGroupRun
Module: droolsjbpm-integration-examples (Note: this is in a different download, the droolsjbpm-integration download.)
Type: Java application
Rules file: conway-ruleflow.drl conway-agendagroup.drl
Objective: Demonstrates '</span>accumulate<span class="hljs-string">', '</span>collect<span class="hljs-string">' and '</span>from<span class="hljs-string">'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Conway’s Game Of Life, described in <a href="http://en.wikipedia.org/wiki/Conway%E2%80%99s_Game_of_Life" class="bare">http://en.wikipedia.org/wiki/Conway’s_Game_of_Life</a> and in <a href="http://www.math.com/students/wonders/life/life.html" class="bare">http://www.math.com/students/wonders/life/life.html</a>, is a famous cellular automaton conceived in the early 1970’s by the mathematician John Conway.
While the system is well known as "Conway’s Game Of Life", it really isn’t a game at all.
Conway’s system is more like a simulation of a form of life.
Don’t be intimidated.
The system is terribly simple and terribly interesting.
Math and Computer Science students alike have marvelled over Conway’s system for more than 30 years now.
The application presented here is a Swing-based implementation of Conway’s Game of Life.
The rules that govern the system are implemented as business rules using Drools.
This document will explain the rules that drive the simulation and discuss the Drools parts of the implementation.</p>
</div>
<div class="paragraph">
<p>We’ll first introduce the grid view, shown below, designed for the visualisation of the game, showing the "arena" where the life simulation takes place.
Initially the grid is empty, meaning that there are no live cells in the system.
Each cell is either alive or dead, with live cells showing a green ball.
Preselected patterns of live cells can be chosen from the "Pattern" drop-down list.
Alternatively, individual cells can be doubled-clicked to toggle them between live and dead.
It’s important to understand that each cell is related to its neighboring cells, which is fundamental for the game’s rules.
Neighbors include not only cells to the left, right, top and bottom but also cells that are connected diagonally, so that each cell has a total of 8 neighbors.
Exceptions are the four corner cells which have only three neighbors, and the cells along the four border, with five neighbors each.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/conway1.png" alt="conway1">
</div>
<div class="title">Figure 414. Conway’s Game of Life: Starting a new game</div>
</div>
<div class="paragraph">
<p>So what are the basic rules that govern this game? Its goal is to show the development of a population, generation by generation.
Each generation results from the preceding one, based on the simultaneous evaluation of all cells.
This is the simple set of rules that govern what the next generation will look like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a live cell has fewer than 2 live neighbors, it dies of loneliness.</p>
</li>
<li>
<p>If a live cell has more than 3 live neighbors, it dies from overcrowding.</p>
</li>
<li>
<p>If a dead cell has exactly 3 live neighbors, it comes to life.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>That is all there is to it.
Any cell that doesn’t meet any of those criteria is left as is for the next generation.
With those simple rules in mind, go back and play with the system a little bit more and step through some generations, one at a time, and notice these rules taking their effect.</p>
</div>
<div class="paragraph">
<p>The screenshot below shows an example generation, with a number of live cells.
Don’t worry about matching the exact patterns represented in the screen shot.
Just get some groups of cells added to the grid.
Once you have groups of live cells in the grid, or select a pre-designed pattern, click the "Next Generation" button and notice what happens.
Some of the live cells are killed (the green ball disappears) and some dead cells come to life (a green ball appears). Step through several generations and see if you notice any patterns.
If you click on the "Start" button, the system will evolve itself so you don’t need to click the "Next Generation" button over and over.
Play with the system a little and then come back here for more details of how the application works.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/conway2.png" alt="conway2">
</div>
<div class="title">Figure 415. Conway’s Game of Life: A running game</div>
</div>
<div class="paragraph">
<p>Now lets delve into the code.
As this is an advanced example we’ll assume that by now you know your way around the Drools framework and are able to connect the presented highlight, so that we’ll just focus at a high level overview.
The example has two ways to execute, one way  uses Agenda Groups to manage execution flow, and the other one uses Rule Flow Groups to manage execution flow.
These two versions are implemented in <code>ConwayAgendaGroupRun</code> and <code>ConwayRuleFlowGroupRun</code>, respectively.
Here, we’ll discuss the Rule Flow version, as it’s what most people will use.</p>
</div>
<div class="paragraph">
<p>All the <code>Cell</code> objects are inserted into the Session and the rules in the <code>ruleflow-group</code> "register neighbor" are allowed to execute by the Rule Flow process.
This group of four rules creates <code>Neighbor</code> relations between some cell and its northeastern, northern, northwestern and western neighbors.
This relation is bidirectional, which takes care of the other four directions.
Border cells don’t need any special treatment - they simply won’t be paired with neighboring cells where there isn’t any.
By the time all activations have fired for these rules, all cells are related to all their neighboring cells.</p>
</div>
<div class="exampleblock">
<div class="title">Example 326. Conway’s Game of Life: Register Cell Neighbour relations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs sql">rule "register north east"
    ruleflow-group "register neighbor"
when
    $cell: Cell( $row : row, $col : col )
    $northEast : Cell( row  == ($row - 1), col == ( $col + 1 ) )
then
    <span class="hljs-operator"><span class="hljs-keyword">insert</span>( <span class="hljs-keyword">new</span> Neighbor( $cell, $northEast ) );</span>
    <span class="hljs-operator"><span class="hljs-keyword">insert</span>( <span class="hljs-keyword">new</span> Neighbor( $northEast, $cell ) );</span>
<span class="hljs-operator"><span class="hljs-keyword">end</span>

rule <span class="hljs-string">"register north"</span>
    ruleflow-<span class="hljs-keyword">group</span> <span class="hljs-string">"register neighbor"</span>
<span class="hljs-keyword">when</span>
    $cell: Cell( $<span class="hljs-keyword">row</span> : <span class="hljs-keyword">row</span>, $<span class="hljs-keyword">col</span> : <span class="hljs-keyword">col</span> )
    $north : Cell( <span class="hljs-keyword">row</span>  == ($<span class="hljs-keyword">row</span> - <span class="hljs-number">1</span>), <span class="hljs-keyword">col</span> == $<span class="hljs-keyword">col</span> )
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">insert</span>( <span class="hljs-keyword">new</span> Neighbor( $cell, $north ) );</span>
    <span class="hljs-operator"><span class="hljs-keyword">insert</span>( <span class="hljs-keyword">new</span> Neighbor( $north, $cell ) );</span>
<span class="hljs-operator"><span class="hljs-keyword">end</span>

rule <span class="hljs-string">"register north west"</span>
    ruleflow-<span class="hljs-keyword">group</span> <span class="hljs-string">"register neighbor"</span>
<span class="hljs-keyword">when</span>
    $cell: Cell( $<span class="hljs-keyword">row</span> : <span class="hljs-keyword">row</span>, $<span class="hljs-keyword">col</span> : <span class="hljs-keyword">col</span> )
    $northWest : Cell( <span class="hljs-keyword">row</span>  == ($<span class="hljs-keyword">row</span> - <span class="hljs-number">1</span>), <span class="hljs-keyword">col</span> == ( $<span class="hljs-keyword">col</span> - <span class="hljs-number">1</span> ) )
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">insert</span>( <span class="hljs-keyword">new</span> Neighbor( $cell, $northWest ) );</span>
    <span class="hljs-operator"><span class="hljs-keyword">insert</span>( <span class="hljs-keyword">new</span> Neighbor( $northWest, $cell ) );</span>
<span class="hljs-operator"><span class="hljs-keyword">end</span>

rule <span class="hljs-string">"register west"</span>
    ruleflow-<span class="hljs-keyword">group</span> <span class="hljs-string">"register neighbor"</span>
<span class="hljs-keyword">when</span>
    $cell: Cell( $<span class="hljs-keyword">row</span> : <span class="hljs-keyword">row</span>, $<span class="hljs-keyword">col</span> : <span class="hljs-keyword">col</span> )
    $west : Cell( <span class="hljs-keyword">row</span>  == $<span class="hljs-keyword">row</span>, <span class="hljs-keyword">col</span> == ( $<span class="hljs-keyword">col</span> - <span class="hljs-number">1</span> ) )
<span class="hljs-keyword">then</span>
    <span class="hljs-keyword">insert</span>( <span class="hljs-keyword">new</span> Neighbor( $cell, $west ) );</span>
    <span class="hljs-operator"><span class="hljs-keyword">insert</span>( <span class="hljs-keyword">new</span> Neighbor( $west, $cell ) );</span>
<span class="hljs-operator"><span class="hljs-keyword">end</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once all the cells are inserted, some Java code applies the pattern to the grid, setting certain cells to Live.
Then, when the user clicks "Start" or "Next Generation", it executes the "Generation" ruleflow.
This ruleflow is responsible for the management of all changes of cells in each generation cycle.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/conway_ruleflow_generation.png" alt="conway ruleflow generation">
</div>
<div class="title">Figure 416. Conway’s Game of Life: rule flow "Generation"</div>
</div>
<div class="paragraph">
<p>The rule flow process first enters the "evaluate" group, which means that any active rule in the group can fire.
The rules in this group apply the Game-of-Life rules discussed in the beginning of the example, determining the cells to be killed and the ones to be given life.
We use the "phase" attribute to drive the reasoning of the Cell by specific groups of rules; typically the phase is tied to a Rule Flow Group in the Rule Flow process definition.
Notice that it doesn’t actually change the state of any <code>Cell</code> objectss at this point; this is because  it’s evaluating the grid in turn and it must complete the full evaluation until those changes can be applied.
To achieve this, it sets the cell to a "phase" which is either <code>Phase.KILL</code> or <code>Phase.BIRTH</code>, used later to control actions applied to the <code>Cell</code> object.</p>
</div>
<div class="exampleblock">
<div class="title">Example 327. Conway’s Game of Life: Evaluate Cells with state changes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">rule <span class="hljs-string">"Kill The Lonely"</span>
    ruleflow-group <span class="hljs-string">"evaluate"</span>
    <span class="hljs-literal">no</span>-<span class="hljs-keyword">loop</span>
<span class="hljs-keyword">when</span>
<span class="hljs-regexp">//</span>  A live cell has fewer than <span class="hljs-number">2</span> live neighbors
    <span class="hljs-attribute">theCell</span>: Cell( liveNeighbors &lt; <span class="hljs-number">2</span>, cellState == CellState.LIVE,
                   phase == Phase.EVALUATE )
<span class="hljs-keyword">then</span>
    modify( theCell ){
        setPhase( Phase.KILL );
    }
end

rule <span class="hljs-string">"Kill The Overcrowded"</span>
    ruleflow-group <span class="hljs-string">"evaluate"</span>
    <span class="hljs-literal">no</span>-<span class="hljs-keyword">loop</span>
<span class="hljs-keyword">when</span>
<span class="hljs-regexp">//</span>  A live cell has more than <span class="hljs-number">3</span> live neighbors
    <span class="hljs-attribute">theCell</span>: Cell( liveNeighbors &gt; <span class="hljs-number">3</span>, cellState == CellState.LIVE,
                   phase == Phase.EVALUATE )
<span class="hljs-keyword">then</span>
    modify( theCell ){
        setPhase( Phase.KILL );
    }
end

rule <span class="hljs-string">"Give Birth"</span>
    ruleflow-group <span class="hljs-string">"evaluate"</span>
    <span class="hljs-literal">no</span>-<span class="hljs-keyword">loop</span>
<span class="hljs-keyword">when</span>
<span class="hljs-regexp">//</span>  A dead cell has <span class="hljs-number">3</span> live neighbors
    <span class="hljs-attribute">theCell</span>: Cell( liveNeighbors == <span class="hljs-number">3</span>, cellState == CellState.DEAD,
                   phase == Phase.EVALUATE )
<span class="hljs-keyword">then</span>
    modify( theCell ){
        theCell.setPhase( Phase.BIRTH );
    }
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once all <code>Cell</code> objects in the grid have been evaluated, we first clear any calculation activations that occurred from any previous data changes.
This is done via the "reset calculate" rule, which clears any activations in the "calculate" group.
We then enter a split in the rule flow which allows any activations in both the "kill" and the "birth" group to fire.
These rules are responsible for applying the state change.</p>
</div>
<div class="exampleblock">
<div class="title">Example 328. Conway’s Game of Life: Apply the state changes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">rule <span class="hljs-string">"reset calculate"</span>
    ruleflow-group <span class="hljs-string">"reset calculate"</span>
<span class="hljs-keyword">when</span>
<span class="hljs-keyword">then</span>
    WorkingMemory wm = drools.getWorkingMemory();
    wm.clearRuleFlowGroup( <span class="hljs-string">"calculate"</span> );
end

rule <span class="hljs-string">"kill"</span>
    ruleflow-group <span class="hljs-string">"kill"</span>
    <span class="hljs-literal">no</span>-<span class="hljs-keyword">loop</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-attribute">theCell</span>: Cell( phase == Phase.KILL )
<span class="hljs-keyword">then</span>
    modify( theCell ){
        setCellState( CellState.DEAD ),
        setPhase( Phase.DONE );
    }
end

rule <span class="hljs-string">"birth"</span>
    ruleflow-group <span class="hljs-string">"birth"</span>
    <span class="hljs-literal">no</span>-<span class="hljs-keyword">loop</span>
<span class="hljs-keyword">when</span>
    <span class="hljs-attribute">theCell</span>: Cell( phase == Phase.BIRTH )
<span class="hljs-keyword">then</span>
    modify( theCell ){
        setCellState( CellState.LIVE ),
        setPhase( Phase.DONE );
    }
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>At this stage, a number of <code>Cell</code> objects have been modified with the state changed to either <code>LIVE</code> or <code>DEAD</code>.
Now we get to see the power of the <code>Neighbor</code> facts defining the cell relations.
When a cell becomes live or dead, we use the <code>Neighbor</code> relation to iterate over all surrounding cells, increasing or decreasing the <code>liveNeighbor</code> count.
Any cell that has its count changed is also set to to the <code>EVALUATE</code> phase, to make sure it is included in the reasoning during the evaluation stage of the Rule Flow Process.
Notice that we don’t have to do any iteration ourselves; simply by applying the relations in the rules we make the rule engine do all the hard work for us, with a minimal amount of code.
Once the live count has been determined and set for all cells, the Rule Flow Process comes to and end.
If the user has initially clicked the "Start" button, the engine will restart the rule flow; otherwise the user may request another generation.</p>
</div>
<div class="exampleblock">
<div class="title">Example 329. Conway’s Game of Life: Evaluate cells with state changes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-string">"Calculate Live"</span>
    ruleflow-group <span class="hljs-string">"calculate"</span>
    lock-on-active
when
    theCell: Cell( cellState == CellState.LIVE )
    Neighbor( cell == theCell, <span class="hljs-variable">$neighbor</span> : neighbor )
<span class="hljs-keyword">then</span>
    modify( <span class="hljs-variable">$neighbor</span> ){
        <span class="hljs-built_in">set</span>LiveNeighbors( <span class="hljs-variable">$neighbor</span>.getLiveNeighbors() + <span class="hljs-number">1</span> ),
        <span class="hljs-built_in">set</span>Phase( Phase.EVALUATE );
    }
end

rule <span class="hljs-string">"Calculate Dead"</span>
    ruleflow-group <span class="hljs-string">"calculate"</span>
    lock-on-active
when
    theCell: Cell( cellState == CellState.DEAD )
    Neighbor( cell == theCell, <span class="hljs-variable">$neighbor</span> : neighbor )
<span class="hljs-keyword">then</span>
    modify( <span class="hljs-variable">$neighbor</span> ){
        <span class="hljs-built_in">set</span>LiveNeighbors( <span class="hljs-variable">$neighbor</span>.getLiveNeighbors() - <span class="hljs-number">1</span> ),
        <span class="hljs-built_in">set</span>Phase( Phase.EVALUATE );
    }
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_invaders"><a class="anchor" href="#_invaders"></a><a class="link" href="#_invaders">25.12. Invaders</a></h3>
<div class="paragraph">
<p>A simplifed version of the Space Invaders game.
Use the keys Z and K, to move left and right and M to fire a misile.
The example is built up over 6 projects, each adding slightly more complexity to the last.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">Name</span>: <span class="hljs-tag">Example</span> <span class="hljs-tag">Invaders</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.games</span><span class="hljs-class">.invaders</span><span class="hljs-class">.Invaders1Main</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.games</span><span class="hljs-class">.invaders</span><span class="hljs-class">.Invaders2Main</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.games</span><span class="hljs-class">.invaders</span><span class="hljs-class">.Invaders3Main</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.games</span><span class="hljs-class">.invaders</span><span class="hljs-class">.Invaders4Main</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.games</span><span class="hljs-class">.invaders</span><span class="hljs-class">.Invaders5Main</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.games</span><span class="hljs-class">.invaders</span><span class="hljs-class">.Invaders6Main</span></code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/invaders.png" alt="invaders">
</div>
<div class="title">Figure 417. Pong Screenshot</div>
</div>
<div class="sect3">
<h4 id="_invaders1main"><a class="anchor" href="#_invaders1main"></a><a class="link" href="#_invaders1main">25.12.1. Invaders1Main</a></h4>
<div class="paragraph">
<p>Invaders1Main creates the frame and attaches the KeyListener, feeding key events into the engine.
It also sets up the main game loop which can be found in "Main.drl".  The typical convention used through out the example is to have one agenda group per file, and all rules in that file in the same agenda group.</p>
</div>
<div class="paragraph">
<p>The Run fact is used to drive the repeat of the Game loop.
Initially there are only one groups that is evaluated, Keys.
The "keys.drl" file is shared by several examples, and illustrates rule re-use across multipel projects.</p>
</div>
<div class="exampleblock">
<div class="title">Example 330. Game Loop</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-drl" data-lang="drl">rule "init" when
then
    insert( new Run() );
    setFocus( "Init" );
end

rule GameLoop when
    r : Run()
then
    setFocus( "Keys" );
end


rule Draw when
    r : Run()
then
    ui.show();
    modify( r ) {} // force loop
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_invaders2main"><a class="anchor" href="#_invaders2main"></a><a class="link" href="#_invaders2main">25.12.2. Invaders2Main</a></h4>
<div class="paragraph">
<p>Invaders2Main adds the "Draw" stage to the game loop and draws the SpaceShip</p>
</div>
<div class="exampleblock">
<div class="title">Example 331. Game Loop</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-drl" data-lang="drl">rule GameLoop when
    r : Run()
then
    setFocus( "Draw" );
    setFocus( "Keys" );
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_invaders3main"><a class="anchor" href="#_invaders3main"></a><a class="link" href="#_invaders3main">25.12.3. Invaders3Main</a></h4>
<div class="paragraph">
<p>Invaders3Main adds move controls to the spaceship, notice the ship moves out of the boundaries of the screen.
KeyPressed is detected and that sets a delta of dx on the ship direction.
That delta is then repeated applied to the x position of the ship</p>
</div>
<div class="exampleblock">
<div class="title">Example 332. Move Ship</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-drl" data-lang="drl">rule ShipDeltaMoveLeft agenda-group "Move" when
    s : Ship()
        KeyPressed( keyText == "Z" )
then
    modify( s ) { dx = 0 - s.speed }
end

rule ShipDeltaStopLeft agenda-group "Move" when
    s : Ship()
        not KeyPressed( keyText == "Z" )
then
    modify( s ) { dx = 0 }
end

rule ShipMove agenda-group "Move" when
    s : Ship( dx != 0 )
    Run()
then
    modify( s ) { x = s.x + s.dx }
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_invaders4main"><a class="anchor" href="#_invaders4main"></a><a class="link" href="#_invaders4main">25.12.4. Invaders4Main</a></h4>
<div class="paragraph">
<p>Invaders4Main adds boundari control to the ShipMove rule, so it doesn’t move off the screen.
Notice the use of "@watch( !x )", this ensures that while the rule wil modify the x property, it will not react to changes to x, which avoids recursion issues.</p>
</div>
<div class="exampleblock">
<div class="title">Example 333. Move Ship with Boundaries</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-drl" data-lang="drl">rule ShipMove agenda-group "Move" when
    s : Ship( dx != 0, x + dx &gt; 0,  x + dx + width &lt; conf.windowWidth ) @watch( !x )
    Run()
then
    modify( s ) { x = s.x + s.dx }
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_invaders5main"><a class="anchor" href="#_invaders5main"></a><a class="link" href="#_invaders5main">25.12.5. Invaders5Main</a></h4>
<div class="paragraph">
<p>Invaders5Main updates the "Draw" group to draw 5 Invaders.</p>
</div>
</div>
<div class="sect3">
<h4 id="_invaders6main"><a class="anchor" href="#_invaders6main"></a><a class="link" href="#_invaders6main">25.12.6. Invaders6Main</a></h4>
<div class="paragraph">
<p>Invaders6Main adds a lot more meat.
Pressing the "M" key fires a missile that travels up the screen, while moving collision between the missile and the invader is checked.</p>
</div>
</div>
<div class="sect3">
<h4 id="_invaders4main_2"><a class="anchor" href="#_invaders4main_2"></a><a class="link" href="#_invaders4main_2">25.12.7. Invaders4Main</a></h4>
<div class="paragraph">
<p>Invaders4Main adds boundari control to the ShipMove rule, so it doesn’t move off the screen.
Notice the use of "@watch( !x )", this ensures that while the rule wil modify the x property, it will not react to changes to x, which avoids recursion issues.</p>
</div>
<div class="exampleblock">
<div class="title">Example 334. Fire Missile</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-drl" data-lang="drl">rule InsertBullet agenda-group "Bullet" when
        KeyPressed( keyText == "M" )
    s : Ship()
    not Bullet()
then
    b = new Bullet();
    b.x = s.x + (s.width/2) - (b.width/2);
    b.y = s.y - s.height - b.height;
    b.width = conf.bulletWidth;
    b.height = conf.bulletHeight;
    b.dy = 0 - conf.bulletSpeed;
    insert( b );
end


rule BulletMove agenda-group "Bullet" when
    b : Bullet( y &gt; 0 ) @watch( !y )
    Run()
then
    modify( b ) { y = b.y + b.dy }
end

rule Collision agenda-group "Bullet" when
    b : Bullet( ) @watch( y )
    i : Invader( x &lt; b.x, x + width &gt; b.x, y &gt; b.y)
    Run()
then
    modify( i ) { alive = false }
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adventures_with_drools"><a class="anchor" href="#_adventures_with_drools"></a><a class="link" href="#_adventures_with_drools">25.13. Adventures with Drools</a></h3>
<div class="paragraph">
<p>Based on the Adventure in Prolog, over at the Amzi website, <a href="http://www.amzi.com/AdventureInProlog/" class="bare">http://www.amzi.com/AdventureInProlog/</a>, we started to work on a text adventure game for Drools.
They are ideal as they can start off simple and build in complexity and size over time, they also demonstrate key aspects of declarative relational programming.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">Name</span>: <span class="hljs-tag">Example</span> <span class="hljs-tag">Text</span> <span class="hljs-tag">Adventure</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.games</span><span class="hljs-class">.adventure</span><span class="hljs-class">.TextAdventure</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The game allows you to play as the hero or the monster.
If you click "New Window" you can open one window as the hero and another as the monster, and play them both at the same time.
The game allows either character to move around rooms, pick up, drop or use things.
Doors can be locked and unlocked, by using the key on teh exit room, and the hero can kill the monster by using the umbrella on the monster.</p>
</div>
<div class="paragraph">
<p>You can view the 8 minute demonstration and introduction for the example at <a href="http://downloads.jboss.org/drools/videos/text-adventures.swf" class="bare">http://downloads.jboss.org/drools/videos/text-adventures.swf</a>.
Be aware the video is now much  older than the current improved example.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/textadventure.png" alt="textadventure">
</div>
<div class="title">Figure 418. Text Adventure Screenshot</div>
</div>
<div class="sect3">
<h4 id="_using_the_game"><a class="anchor" href="#_using_the_game"></a><a class="link" href="#_using_the_game">25.13.1. Using the game.</a></h4>
<div class="paragraph">
<p>Each action follows the constructor arguments of the associated Command java class.</p>
</div>
<div class="exampleblock">
<div class="title">Example 335. MoveCommand</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">  <span class="hljs-annotation">@PropertyReactive</span>
  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MoveCommand</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Command</span> </span>{

      <span class="hljs-annotation">@Position</span>(<span class="hljs-number">1</span>)
      <span class="hljs-keyword">private</span> Character character;

      <span class="hljs-annotation">@Position</span>(<span class="hljs-number">2</span>)
      <span class="hljs-keyword">private</span> Room      room;

      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MoveCommand</span><span class="hljs-params">(Character character, Room room)</span> </span>{
          <span class="hljs-keyword">this</span>.character = character;
          <span class="hljs-keyword">this</span>.room = room;
      }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To issue a move action, select the "Move" button, then select the exit room.
Notice when you press "Move" it adds the text to the white bar at the bottom.
When the exit room is selected, it also is added to the white bar.
Then press send and the game engine will execute the command.
Internally it uses reflection to instantiate the Command and insert it into the engine.
If you select incorrect arguments, such as pressing exits multiple times, the reflection will fail and you can attempt it again.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/MoveCommand.png" alt="MoveCommand">
</div>
<div class="title">Figure 419. Move Action</div>
</div>
<div class="paragraph">
<p>The Things list displays anything you can see in the room, not all things can be picked up.
For instance you can pick up the key and the torch, but not the monster.
When something is picked up it moves from the Things list to the Inventory List.
The reverse is true when something is dropped.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/PickUpCommand.png" alt="PickUpCommand">
</div>
<div class="title">Figure 420. Pickup Action</div>
</div>
<div class="paragraph">
<p>The key is in the office, move upstairs and into the office.
Then pick up the key.
Move back downstairs and into the kitchen.
Try and walk into the basement, notice it’s locked.</p>
</div>
<div class="paragraph">
<p>Select the "Use" action, the select the key and then the basement exit.
This will unlock the door and you can now walk through.</p>
</div>
<div class="paragraph">
<p>To kill the monster pick up the umbrella from the lounge and then select "Use", then select the imbrella and finally select the monster.</p>
</div>
<div class="paragraph">
<p>Don’t forget to open a "New Window" to play as the monster, although you will not be able to exit the basement until the hero has opened it with the key.
The monster and the hero can also give items to each other, moving items between each playsers inventory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_code"><a class="anchor" href="#_the_code"></a><a class="link" href="#_the_code">25.13.2. The code</a></h4>
<div class="paragraph">
<p>The model is written in Java classes.
Each classes uses @PropertyReactive and @Position.
@PropertyReactive allows control of which fields patterns react to, and @Position maps a field to a argument position allowing positional as well as named arguments for patterns.</p>
</div>
<div class="exampleblock">
<div class="title">Example 336. Game World Data Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java"><span class="hljs-annotation">@PropertyReactive</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Thing</span> </span>{
    <span class="hljs-annotation">@Position</span>(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> id;

    <span class="hljs-annotation">@Position</span>(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Thing</span><span class="hljs-params">(<span class="hljs-keyword">long</span> id, String name)</span> </span>{
        <span class="hljs-keyword">this</span>.id = id;
        <span class="hljs-keyword">this</span>.name = name;
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An MVEL data file is used to populate our world, see "data.mvel". You can edit this file to add new rooms, items and characters, as well as locks for doors.</p>
</div>
<div class="exampleblock">
<div class="title">Example 337. Game World Data Example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">rooms = [
    "basement" : new Room("basement"),
    "lounge" : new Room("lounge"),
    "kitchen" : new Room("kitchen"),
    "ground floor hallway" : new Room("ground floor hallway"),
    "bedroom" : new Room("bedroom"),
    "office" : new Room("office"),
    "first floor hallway" : new Room("first floor hallway")
];

doors = [
    "d1" : new Door( rooms["kitchen"], rooms["basement"] ),
    "d2" : new Door( rooms["ground floor hallway"], rooms["lounge"]),
    "d4" : new Door( rooms["ground floor hallway"], rooms["kitchen"]),
    "d5" : new Door( rooms["ground floor hallway"], rooms[ "first floor hallway"] ),
    "d8" : new Door( rooms["first floor hallway"], rooms[ "bedroom"] ),
    "d9" : new Door( rooms["first floor hallway"], rooms[ "office"] )
];

locations = [
    "monster" :  new Location( characters["monster"], rooms["basement"] ),
    "hero" :  new Location( characters["hero"], rooms["ground floor hallway"] ),
    "umbrella" :  new Location( items["umbrella"], rooms["lounge"] ),
    "key1" :  new Location( items["key1"], rooms["office"] )
];</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The game creates commands, which it inserts into the engine.
These commands are then used to change the state of the world and that state is reflected back in the UI.
The commands can be found in the "commands.drl" file.
The following rule matches the MoveCommand and if it’s valid it will make the move happen.</p>
</div>
<div class="exampleblock">
<div class="title">Example 338. Move a Characters</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-drl" data-lang="drl">rule validMove agenda-group "commands" when
    mc : MoveCommand( c : character, r : room )
    l  : Location( thing == c, ltarget : target ) @watch( !target )
    ?connect( d, r, ltarget; )
then
    exit = new ExitEvent( c, (Room) l.target );
    enter = new EnterEvent( c, r );

    modify( l ) { target = r };

    insert( exit );
    insert( enter );

    mc.session.channels["output"].send( "You have entered the " + l.target.name + "\n" );
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the above rules notice the "connect" pattern, this is actually a query.
In the MVEL data file doors are only described one way, we can use a query to check connections bi-directionally.
The queries can be found in the "queries.drl" file.</p>
</div>
<div class="exampleblock">
<div class="title">Example 339. connect</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-drl" data-lang="drl">query connect( Door $d, Room $x, Room $y )
    $d := Door($id, $name, $x, $y;)
    or
    $d :=Door($id, $name, $y, $x;)
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The UI has its list boxes populated by rules found in "UiView.drl", those rules in turn use queries.
Here is how the "Things" list box is populated, when ever the world changes.</p>
</div>
<div class="exampleblock">
<div class="title">Example 340. Update the UI</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-drl" data-lang="drl">rule updateThings salience 5  when
    session : UserSession( $char : character )
    things( $char, $things; )
then
    session.channels["things"].send( $things );
end

query things(Character $char, List $things)
    $char := Character()
    Location( $char, $room; )
    $things := List() from accumulate( Location($thing, $room; thing != $char),
                                       collectList( $thing ) )
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pong"><a class="anchor" href="#_pong"></a><a class="link" href="#_pong">25.14. Pong</a></h3>
<div class="paragraph">
<p>A Conversion for the classic game Pong.
Use the keys A, Z and K, M.
The ball should get faster after each bounce.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">Name</span>: <span class="hljs-tag">Example</span> <span class="hljs-tag">Pong</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.games</span><span class="hljs-class">.pong</span><span class="hljs-class">.PongMain</span></code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/pong.png" alt="pong">
</div>
<div class="title">Figure 421. Pong Screenshot</div>
</div>
</div>
<div class="sect2">
<h3 id="_wumpus_world"><a class="anchor" href="#_wumpus_world"></a><a class="link" href="#_wumpus_world">25.15. Wumpus World</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">Name</span>: <span class="hljs-tag">Example</span> <span class="hljs-tag">Wumpus</span> <span class="hljs-tag">World</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.games</span><span class="hljs-class">.wumpus</span><span class="hljs-class">.WumpusWorldMain</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Wumpus World is an AI example covered in the book "Artificial Intelligence : A Modern Approach". When the game first starts all the cells are greyed out.
As you walk around they become visible.
The cave has pits, a wumpus and gold.
When you are next to a pit you will feel a breeze, when you are next to the wumpus you will smell a stench and see glitter when next to gold.
The sensor icons are shown above the move buttons.
If you walk into a pit or the wumpus, you die.
A more detailed overview of Wumpus World can be found at <a href="http://www.cis.temple.edu/~giorgio/cis587/readings/wumpus.shtml" class="bare">http://www.cis.temple.edu/~giorgio/cis587/readings/wumpus.shtml</a>.
A 20 minute video showing how the game is created and works is at <a href="http://www.youtube.com/watch?v=4CvjKqUOEzM">http://www.youtube.com/watch?v=4CvjKqUOEzM.</a></p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/wumpus1.png" alt="wumpus1">
</div>
<div class="title">Figure 422. Wumpus World</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/wumpus2.png" alt="wumpus2">
</div>
<div class="title">Figure 423. Cave Screenshot</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/wumpus3.png" alt="wumpus3">
</div>
<div class="title">Figure 424. Signals Screenshot</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/wumpus4.png" alt="wumpus4">
</div>
<div class="title">Figure 425. Smell Stench</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/wumpus5.png" alt="wumpus5">
</div>
<div class="title">Figure 426. Move Up, Wumpus Collision</div>
</div>
</div>
<div class="sect2">
<h3 id="_miss_manners_and_benchmarking"><a class="anchor" href="#_miss_manners_and_benchmarking"></a><a class="link" href="#_miss_manners_and_benchmarking">25.16. Miss Manners and Benchmarking</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">Name</span>: <span class="hljs-tag">Miss</span> <span class="hljs-tag">Manners</span>
<span class="hljs-tag">Main</span> <span class="hljs-tag">class</span>: <span class="hljs-tag">org</span><span class="hljs-class">.drools</span><span class="hljs-class">.benchmark</span><span class="hljs-class">.manners</span><span class="hljs-class">.MannersBenchmark</span>
<span class="hljs-tag">Module</span>: <span class="hljs-tag">drools-examples</span>
<span class="hljs-tag">Type</span>: <span class="hljs-tag">Java</span> <span class="hljs-tag">application</span>
<span class="hljs-tag">Rules</span> <span class="hljs-tag">file</span>: <span class="hljs-tag">manners</span><span class="hljs-class">.drl</span>
<span class="hljs-tag">Objective</span>: <span class="hljs-tag">Advanced</span> <span class="hljs-tag">walkthrough</span> <span class="hljs-tag">on</span> <span class="hljs-tag">the</span> <span class="hljs-tag">Manners</span> <span class="hljs-tag">benchmark</span>, <span class="hljs-tag">covers</span> <span class="hljs-tag">Depth</span> <span class="hljs-tag">conflict</span> <span class="hljs-tag">resolution</span> <span class="hljs-tag">in</span> <span class="hljs-tag">depth</span>.</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_introduction_5"><a class="anchor" href="#_introduction_5"></a><a class="link" href="#_introduction_5">25.16.1. Introduction</a></h4>
<div class="paragraph">
<p>Miss Manners is throwing a party and, being a good host, she wants to arrange good seating.
Her initial design arranges everyone in  male-female pairs, but then she worries about people have things to talk about.
What is a good host to do? She decides to note the hobby of each guest so she can then arrange guests not only pairing them according to alternating sex but also ensuring that a guest has someone with a common hobby, at least on one side.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/guests_at_table.png" alt="guests at table">
</div>
<div class="title">Figure 427. Miss Manners' Guests</div>
</div>
<div class="sect4">
<h5 id="_benchmarking"><a class="anchor" href="#_benchmarking"></a><a class="link" href="#_benchmarking">25.16.1.1. BenchMarking</a></h5>
<div class="paragraph">
<p>Five benchmarks were established in the 1991 paper "Effects of Database Size on Rule System Performance: Five Case Studies" by  David Brant, Timothy Grose, Bernie Lofaso and Daniel P.
Miranker:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Manners</strong> uses a  depth-first search approach to determine the seating arrangements alternating women and men and ensuring one common hobby for neighbors.</p>
</li>
<li>
<p><strong>Waltz</strong> establishes a three-dimensional interpretation of a line drawing by line labeling by constraint propagation.</p>
</li>
<li>
<p><strong>WaltzDB</strong> is a more general version of Waltz, supporting junctions of more than three lines and using a database.</p>
</li>
<li>
<p><strong>ARP</strong> is a  route planner for a robotic air vehicle using the A* search algorithm to achieve minimal cost.</p>
</li>
<li>
<p><strong>Weaver</strong>  VLSI router for channels and boxes using a black-board technique.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Manners has become the de facto rule engine benchmark.
Its behavior, however, is now well known and many engines optimize for this, thus negating its usefulness as a benchmark  which is why Waltz is becoming more favorable.
These five benchmarks are also published at the University of Texas <a href="http://www.cs.utexas.edu/ftp/pub/ops5-benchmark-suite/" class="bare">http://www.cs.utexas.edu/ftp/pub/ops5-benchmark-suite/</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_miss_manners_execution_flow"><a class="anchor" href="#_miss_manners_execution_flow"></a><a class="link" href="#_miss_manners_execution_flow">25.16.1.2. Miss Manners Execution Flow</a></h5>
<div class="paragraph">
<p>After the first seating arrangement has been assigned, a depth-first recursion occurs which repeatedly assigns correct seating arrangements until the last seat is assigned.
Manners uses a <code>Context</code> instance to control execution flow.
The activity diagram is partitioned to show the relation of the rule execution to the current <code>Context</code> state.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/manners_activity_diagram.png" alt="manners activity diagram">
</div>
<div class="title">Figure 428. Manners Activity Diagram</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_data_and_results"><a class="anchor" href="#_the_data_and_results"></a><a class="link" href="#_the_data_and_results">25.16.1.3. The Data and Results</a></h5>
<div class="paragraph">
<p>Before going deeper into the rules, let’s first take a look at the asserted data and the resulting seating arrangement.
The data is a simple set of five guests who should be arranged so that sexes alternate and neighbors have a common hobby.</p>
</div>
<div class="paragraph">
<p><strong>The Data</strong></p>
</div>
<div class="paragraph">
<p>The data is given in OPS5 syntax, with a parenthesized list of name and value pairs for each attribute.
Each person has only one hobby.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>(guest (name n1) (sex m) (hobby  h1)  )
(guest (name n2) (sex f) (hobby  h1)  )
(guest (name n2) (sex f) (hobby  h3)  )
(guest (name n3) (sex m) (hobby  h3)  )
(guest (name n4) (sex m) (hobby  h1)  )
(guest (name n4) (sex f) (hobby  h2)  )
(guest (name n4) (sex f) (hobby  h3)  )
(guest (name n5) (sex f) (hobby  h2)  )
(guest (name n5) (sex f) (hobby  h1)  )
(last_seat (seat 5)  )</pre>
</div>
</div>
<div class="paragraph">
<p>*
The Results*</p>
</div>
<div class="paragraph">
<p>Each line of the results list is printed per execution of the "Assign Seat" rule.
They key bit to notice is that each line has a "pid" value one greater than the last.
(The significance of this will be explained in the discussion of the rule "Assign Seating".) The "ls", "rs", "ln" and "rn" refer to the left and right seat and neighbor’s name, respectively.
The actual implementation uses longer attribute names (e.g., <code>leftGuestName</code>, but here we’ll stick to the notation from the original implementation.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]
[Seating id=2, pid=1, done=false, ls=1, ln=n5, rs=2, rn=n4]
[Seating id=3, pid=2, done=false, ls=2, ln=n4, rs=3, rn=n3]
[Seating id=4, pid=3, done=false, ls=3, rn=n3, rs=4, rn=n2]
[Seating id=5, pid=4, done=false, ls=4, ln=n2, rs=5, rn=n1]</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_in_depth_discussion"><a class="anchor" href="#_in_depth_discussion"></a><a class="link" href="#_in_depth_discussion">25.16.2. In depth Discussion</a></h4>
<div class="sect4">
<h5 id="_cheating"><a class="anchor" href="#_cheating"></a><a class="link" href="#_cheating">25.16.2.1. Cheating</a></h5>
<div class="paragraph">
<p>Manners has been designed to exercise cross product joins and Agenda activities.
Many people not understanding this tweak the example to achieve better performance, making their port of the Manners benchmark pointless.
Known cheats or porting errors for Miss Manners are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using arrays for a guests hobbies, instead of asserting each one as a single fact massively reduces the cross products.</p>
</li>
<li>
<p>Altering the sequence of data can also reduce the amount of matching, increasing execution speed.</p>
</li>
<li>
<p>It’s possible to change the <code>not</code> Conditional Element so that the test algorithm only uses the "first-best-match", which is, basically, transforming the test algorithm to backward chaining. The results are only comparable to other backward chaining rule engines or ports of Manners.</p>
</li>
<li>
<p>Removing the context so the rule engine matches the guests and seats prematurely. A proper port will prevent facts from matching using the context start.</p>
</li>
<li>
<p>It’s possible to prevent the rule engine from performing combinatorial pattern matching.</p>
</li>
<li>
<p>If no facts are retracted in the reasoning cycle, as a result of the <code>not</code> CE, the port is incorrect.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_conflict_resolution_3"><a class="anchor" href="#_conflict_resolution_3"></a><a class="link" href="#_conflict_resolution_3">25.16.2.2. Conflict Resolution</a></h5>
<div class="paragraph">
<p>The Manners benchmark was written for OPS5 which has two conflict resolution strategies, LEX and MEA.
LEX is a chain of several strategies including salience, recency and complexity.
The recency part of the strategy drives the depth first (LIFO) firing order.
The CLIPS  manual documents the Recency strategy as follows:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Every fact and instance is marked internally with a "time tag" to indicate its relative recency with respect to every other fact and instance in the system.
The pattern entities associated with each rule activation are sorted in descending order for determining placement.
An activation with a more recent pattern entity is placed before activations with less recent pattern entities.
To determine the placement order of two activations, compare the sorted time tags of the two activations one by one starting with the largest time tags.
The comparison should continue until one activation’s time tag is greater than the other activation’s corresponding time tag.
The activation with the greater time tag is placed before the other activation on the agenda.
If one activation has more pattern entities than the other activation and the compared time tags are all identical, then the activation with more time tags is placed before the other activation on the agenda.</p>
</div>
</blockquote>
<div class="attribution">
— CLIPS Reference Manual
</div>
</div>
<div class="paragraph">
<p>However Jess and CLIPS both use the Depth strategy, which is simpler and lighter, which Drools also adopted.
The CLIPS manual documents the Depth strategy as:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Newly activated rules are placed above all rules of the same salience.
For example, given that fact-a activates rule-1 and rule-2 and fact-b activates rule-3 and rule-4, then if fact-a is asserted before fact-b, rule-3 and rule-4 will be above rule-1 and rule-2 on the agenda.
However, the position of rule-1 relative to rule-2 and rule-3 relative to rule-4 will be arbitrary.</p>
</div>
</blockquote>
<div class="attribution">
— CLIPS Reference Manual
</div>
</div>
<div class="paragraph">
<p>The initial Drools implementation for the Depth strategy would not work for Manners without the use of salience on the "make_path" rule.
The CLIPS support team had this to say:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The default conflict resolution strategy for CLIPS, Depth, is different than the default conflict resolution strategy used by OPS5.
Therefore if you directly translate an OPS5 program to CLIPS, but use the default depth conflict resolution strategy, you’re only likely to get the correct behavior by coincidence.
The LEX and MEA conflict resolution strategies are provided in CLIPS to allow you to quickly convert and correctly run an OPS5 program in CLIPS.</p>
</div>
</blockquote>
<div class="attribution">
— CLIPS Support Forum
</div>
</div>
<div class="paragraph">
<p>Investigation into the CLIPS code reveals there is undocumented functionality in the Depth strategy.
There is an accumulated time tag used in this strategy; it’s not an extensively fact by fact comparison as in the recency strategy, it simply adds the total of all the time tags for each activation and compares.</p>
</div>
</div>
<div class="sect4">
<h5 id="_rule_assignfirstseat"><a class="anchor" href="#_rule_assignfirstseat"></a><a class="link" href="#_rule_assignfirstseat">25.16.2.3. Rule "assignFirstSeat"</a></h5>
<div class="paragraph">
<p>Once the context is changed to <code>START_UP</code>, activations are created for all asserted guest.
Because all activations are created as the result of a single Working Memory action, they all have the same Activation time tag.
The last asserted <code>Guest</code> object would have a higher fact time tag, and its Activation would fire because it has the highest accumulated fact time tag.
The execution order in this rule has little importance, but has a big impact in the rule "Assign Seat". The activation fires and asserts the first <code>Seating</code> arrangement and a <code>Path</code>, and then sets the <code>Context</code> attribute <code>state</code> to create  an activation for rule <code>findSeating</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cpp">rule assignFirstSeat
    when
        context : Context( state == Context.START_UP )
        guest : Guest()
        count : Count()
    then
        String guestName = guest.getName();

        Seating seating =
          <span class="hljs-keyword">new</span> Seating( count.getValue(), <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">1</span>, guestName, <span class="hljs-number">1</span>, guestName);
        insert( seating );

        Path path = <span class="hljs-keyword">new</span> Path( count.getValue(), <span class="hljs-number">1</span>, guestName );
        insert( path );

        modify( count ) { setValue ( count.getValue() + <span class="hljs-number">1</span> )  }

    System.out.println( <span class="hljs-string">"assign first seat :  "</span> + seating + <span class="hljs-string">" : "</span> + path );

        modify( context ) {
            setState( Context.ASSIGN_SEATS )
        }
end</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rule_findseating"><a class="anchor" href="#_rule_findseating"></a><a class="link" href="#_rule_findseating">25.16.2.4. Rule "findSeating"</a></h5>
<div class="paragraph">
<p>This rule determines each of the <code>Seating</code> arrangements.
The rule creates cross product solutions for <em>all</em> asserted <code>Seating</code> arrangements against <em>all</em> the asserted guests except  against itself or any already assigned chosen solutions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs perl">rule findSeating
   <span class="hljs-keyword">when</span>
       context : Context( <span class="hljs-keyword">state</span> == Context.ASSIGN_SEATS )
       <span class="hljs-variable">$s</span>      : Seating( pathDone == true )
       <span class="hljs-variable">$g1</span>     : Guest( name == <span class="hljs-variable">$s</span>.rightGuestName )
       <span class="hljs-variable">$g2</span>     : Guest( sex != <span class="hljs-variable">$g1</span>.sex, hobby == <span class="hljs-variable">$g1</span>.hobby )

       count   : Count()

       <span class="hljs-keyword">not</span> ( Path( id == <span class="hljs-variable">$s</span>.id, guestName == <span class="hljs-variable">$g2</span>.name) )
       <span class="hljs-keyword">not</span> ( Chosen( id == <span class="hljs-variable">$s</span>.id, guestName == <span class="hljs-variable">$g2</span>.name, hobby == <span class="hljs-variable">$g1</span>.hobby) )
   then
       <span class="hljs-keyword">int</span> rightSeat = <span class="hljs-variable">$s</span>.getRightSeat();
       <span class="hljs-keyword">int</span> seatId = <span class="hljs-variable">$s</span>.getId();
       <span class="hljs-keyword">int</span> countValue = count.getValue();

       Seating seating =
         new Seating( countValue, seatId, false, rightSeat,
                      <span class="hljs-variable">$s</span>.getRightGuestName(), rightSeat + <span class="hljs-number">1</span>, <span class="hljs-variable">$g2</span>.getName() );
       insert( seating );

       Path path = new Path( countValue, rightSeat + <span class="hljs-number">1</span>, <span class="hljs-variable">$g2</span>.getName()  );
       insert( path );

       Chosen chosen = new Chosen( seatId, <span class="hljs-variable">$g2</span>.getName(), <span class="hljs-variable">$g1</span>.getHobby() );
       insert( chosen  );

       System.err.println( <span class="hljs-string">"find seating : "</span> + seating + <span class="hljs-string">" : "</span> + path +
                           <span class="hljs-string">" : "</span> + chosen);

       modify( count ) {setValue(  countValue + <span class="hljs-number">1</span> )}
       modify( context ) {setState( Context.MAKE_PATH )}
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, as can be seen from the printed results shown earlier, it is essential that only the <code>Seating</code> with the highest <code>pid</code> cross product be chosen.
How can this be possible if we have activations, of the same time tag, for nearly all existing <code>Seating</code> and <code>Guest</code> objects? For example, on the third iteration of <code>findSeating</code> the produced activations will be as shown below.
Remember, this is from a very small data set, and with larger data sets there would be many more possible activated <code>Seating</code> solutions, with multiple solutions per <code>pid</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>=&gt;[ActivationCreated(35): rule=findSeating
[fid:19:33]:[Seating id=3, pid=2, done=true, ls=2, ln=n4, rs=3, rn=n3]
[fid:4:4]:[Guest name=n3, sex=m, hobbies=h3]
[fid:3:3]:[Guest name=n2, sex=f, hobbies=h3]

=&gt;[ActivationCreated(35): rule=findSeating
[fid:15:23]:[Seating id=2, pid=1, done=true, ls=1, ln=n5, rs=2, rn=n4]
[fid:5:5]:[Guest name=n4, sex=m, hobbies=h1]
[fid:2:2]:[Guest name=n2, sex=f, hobbies=h1]

=&gt;[ActivationCreated(35): rule=findSeating
[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1]
[fid:1:1]:[Guest name=n1, sex=m, hobbies=h1]</pre>
</div>
</div>
<div class="paragraph">
<p>The creation of all these redundant activations might seem pointless, but it must be remembered that Manners is not about good rule design; it’s purposefully designed as a bad ruleset to fully stress-test the cross product matching process and the Agenda, which this clearly does.
Notice that each activation has the same time tag of 35, as they were all activated by the change in the <code>Context</code> object to <code>ASSIGN_SEATS</code>.
With OPS5 and LEX it would correctly fire the activation with the <code>Seating</code> asserted last.
With Depth, the accumulated fact time tag ensures that the activation with the last asserted <code>Seating</code> fires.</p>
</div>
</div>
<div class="sect4">
<h5 id="_rules_makepath_and_pathdone"><a class="anchor" href="#_rules_makepath_and_pathdone"></a><a class="link" href="#_rules_makepath_and_pathdone">25.16.2.5. Rules "makePath" and "pathDone"</a></h5>
<div class="paragraph">
<p>Rule <code>makePath</code> must always fire before <code>pathDone</code>.
A <code>Path</code> object is asserted for each <code>Seating</code> arrangement, up to the last asserted  <code>Seating</code>.
Notice that the conditions in <code>pathDone</code> are a subset of those in <code>makePath</code> - so how do we ensure that <code>makePath</code> fires first?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">rule makePath
    <span class="hljs-keyword">when</span>
        Context( state == Context.MAKE_PATH )
        Seating( <span class="hljs-attribute">seatingId</span>:id, <span class="hljs-attribute">seatingPid</span>:pid, pathDone == <span class="hljs-literal">false</span> )
        Path( id == seatingPid, <span class="hljs-attribute">pathGuestName</span>:guestName, <span class="hljs-attribute">pathSeat</span>:seat )
        <span class="hljs-keyword">not</span> Path( id == seatingId, guestName == pathGuestName )
    <span class="hljs-keyword">then</span>
        insert( <span class="hljs-keyword">new</span> Path( seatingId, pathSeat, pathGuestName ) );
end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule pathDone
    when
        context : Context( state == Context.MAKE_PATH )
        seating : Seating( pathDone == <span class="hljs-literal">false</span> )
    <span class="hljs-keyword">then</span>
        modify( seating ) {<span class="hljs-built_in">set</span>PathDone( <span class="hljs-literal">true</span> )}

    modify( context ) {<span class="hljs-built_in">set</span>State( Context.CHECK_DONE)}
end</code></pre>
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/make_path.png" alt="make path">
</div>
<div class="title">Figure 429. Rete Diagram</div>
</div>
<div class="paragraph">
<p>Both rules end up on the Agenda in conflict and with identical activation time tags.
However, the accumulate fact time tag is greater for "Make Path" so it gets priority.</p>
</div>
</div>
<div class="sect4">
<h5 id="_rules_continue_and_arewedone"><a class="anchor" href="#_rules_continue_and_arewedone"></a><a class="link" href="#_rules_continue_and_arewedone">25.16.2.6. Rules "continue" and "areWeDone"</a></h5>
<div class="paragraph">
<p>Rule <code>areWeDone</code> only activates when the last seat is assigned, at which point both rules will be activated.
For the same reason that <code>makePath</code> always wins over <code>path Done</code>, <code>areWeDone</code> will take priority over rule <code>continue</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule areWeDone
    <span class="hljs-keyword">when</span>
        context <span class="hljs-symbol">:</span> <span class="hljs-constant">Context</span>( state == <span class="hljs-constant">Context</span>.<span class="hljs-constant">CHECK_DONE</span> )
        <span class="hljs-constant">LastSeat</span>( <span class="hljs-symbol">lastSeat:</span> seat )
        <span class="hljs-constant">Seating</span>( rightSeat == lastSeat )
    <span class="hljs-keyword">then</span>
        modify( context ) {setState(<span class="hljs-constant">Context</span>.<span class="hljs-constant">PRINT_RESULTS</span> )}
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">rule <span class="hljs-built_in">continue</span>
    when
        context : Context( state == Context.CHECK_DONE )
    <span class="hljs-keyword">then</span>
        modify( context ) {<span class="hljs-built_in">set</span>State( Context.ASSIGN_SEATS )}
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_output_summary"><a class="anchor" href="#_output_summary"></a><a class="link" href="#_output_summary">25.16.3. Output Summary</a></h4>
<div class="literalblock">
<div class="content">
<pre>Assign First seat
=&gt;[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]
=&gt;[fid:14:14]:[Path id=1, seat=1, guest=n5]

==&gt;[ActivationCreated(16): rule=findSeating
[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1]
[fid:1:1]:[Guest name=n1, sex=m, hobbies=h1]

==&gt;[ActivationCreated(16): rule=findSeating
[fid:13:13]:[Seating id=1 , pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1]
[fid:5:5]:[Guest name=n4, sex=m, hobbies=h1]*

Assign Seating
=&gt;[fid:15:17] :[Seating id=2 , pid=1 , done=false, ls=1, lg=n5, rs=2, rn=n4]
=&gt;[fid:16:18]:[Path id=2, seat=2, guest=n4]
=&gt;[fid:17:19]:[Chosen id=1, name=n4, hobbies=h1]

=&gt;[ActivationCreated(21): rule=makePath
[fid:15:17] : [Seating id=2, pid=1, done=false, ls=1, ln=n5, rs=2, rn=n4]
[fid:14:14] : [Path id=1, seat=1, guest=n5]*

==&gt;[ActivationCreated(21): rule=pathDone
[Seating id=2, pid=1, done=false, ls=1, ln=n5, rs=2, rn=n4]*

Make Path
=&gt;[fid:18:22:[Path id=2, seat=1, guest=n5]]

Path Done

Continue Process
=&gt;[ActivationCreated(25): rule=findSeating
[fid:15:23]:[Seating id=2, pid=1, done=true, ls=1, ln=n5, rs=2, rn=n4]
[fid:7:7]:[Guest name=n4, sex=f, hobbies=h3]
[fid:4:4] : [Guest name=n3, sex=m, hobbies=h3]*

=&gt;[ActivationCreated(25): rule=findSeating
[fid:15:23]:[Seating id=2, pid=1, done=true, ls=1, ln=n5, rs=2, rn=n4]
[fid:5:5]:[Guest name=n4, sex=m, hobbies=h1]
[fid:2:2]:[Guest name=n2, sex=f, hobbies=h1], [fid:12:20] : [Count value=3]

=&gt;[ActivationCreated(25): rule=findSeating
[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1]
[fid:1:1]:[Guest name=n1, sex=m, hobbies=h1]

Assign Seating
=&gt;[fid:19:26]:[Seating id=3, pid=2, done=false, ls=2, lnn4, rs=3, rn=n3]]
=&gt;[fid:20:27]:[Path id=3, seat=3, guest=n3]]
=&gt;[fid:21:28]:[Chosen id=2, name=n3, hobbies=h3}]

=&gt;[ActivationCreated(30): rule=makePath
[fid:19:26]:[Seating id=3, pid=2, done=false, ls=2, ln=n4, rs=3, rn=n3]
[fid:18:22]:[Path id=2, seat=1, guest=n5]*

=&gt;[ActivationCreated(30): rule=makePath
[fid:19:26]:[Seating id=3, pid=2, done=false, ls=2, ln=n4, rs=3, rn=n3]
[fid:16:18]:[Path id=2, seat=2, guest=n4]*

=&gt;[ActivationCreated(30): rule=done
[fid:19:26]:[Seating id=3, pid=2, done=false, ls=2, ln=n4, rs=3, rn=n3]*

Make Path
=&gt;[fid:22:31]:[Path id=3, seat=1, guest=n5]

Make Path
=&gt;[fid:23:32] [Path id=3, seat=2, guest=n4]

Path Done

Continue Processing
=&gt;[ActivationCreated(35): rule=findSeating
[fid:19:33]:[Seating id=3, pid=2, done=true, ls=2, ln=n4, rs=3, rn=n3]
[fid:4:4]:[Guest name=n3, sex=m, hobbies=h3]
[fid:3:3]:[Guest name=n2, sex=f, hobbies=h3], [fid:12:29]*

=&gt;[ActivationCreated(35): rule=findSeating
[fid:15:23]:[Seating id=2, pid=1, done=true, ls=1, ln=n5, rs=2, rn=n4]
[fid:5:5]:[Guest name=n4, sex=m, hobbies=h1]
[fid:2:2]:[Guest name=n2, sex=f, hobbies=h1]

=&gt;[ActivationCreated(35): rule=findSeating
[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1], [fid:1:1] : [Guest name=n1, sex=m, hobbies=h1]

Assign Seating
=&gt;[fid:24:36]:[Seating id=4, pid=3, done=false, ls=3, ln=n3, rs=4, rn=n2]]
=&gt;[fid:25:37]:[Path id=4, seat=4, guest=n2]]
=&gt;[fid:26:38]:[Chosen id=3, name=n2, hobbies=h3]

==&gt;[ActivationCreated(40): rule=makePath
[fid:24:36]:[Seating id=4, pid=3, done=false, ls=3, ln=n3, rs=4, rn=n2]
[fid:23:32]:[Path id=3, seat=2, guest=n4]*

==&gt;[ActivationCreated(40): rule=makePath
[fid:24:36]:[Seating id=4, pid=3, done=false, ls=3, ln=n3, rs=4, rn=n2]
[fid:20:27]:[Path id=3, seat=3, guest=n3]*

=&gt;[ActivationCreated(40): rule=makePath
[fid:24:36]:[Seating id=4, pid=3, done=false, ls=3, ln=n3, rs=4, rn=n2]
[fid:22:31]:[Path id=3, seat=1, guest=n5]*

=&gt;[ActivationCreated(40): rule=done
[fid:24:36]:[Seating id=4, pid=3, done=false, ls=3, ln=n3, rs=4, rn=n2]*

Make Path
=&gt;fid:27:41:[Path id=4, seat=2, guest=n4]

Make Path
=&gt;fid:28:42]:[Path id=4, seat=1, guest=n5]]

Make Path
=&gt;fid:29:43]:[Path id=4, seat=3, guest=n3]]

Path Done

Continue  Processing
=&gt;[ActivationCreated(46): rule=findSeating
[fid:15:23]:[Seating id=2, pid=1, done=true, ls=1, ln=n5, rs=2, rn=n4]
[fid:5:5]:[Guest name=n4, sex=m, hobbies=h1], [fid:2:2]
[Guest name=n2, sex=f, hobbies=h1]

=&gt;[ActivationCreated(46): rule=findSeating
[fid:24:44]:[Seating id=4, pid=3, done=true, ls=3, ln=n3, rs=4, rn=n2]
[fid:2:2]:[Guest name=n2, sex=f, hobbies=h1]
[fid:1:1]:[Guest name=n1, sex=m, hobbies=h1]*

=&gt;[ActivationCreated(46): rule=findSeating
[fid:13:13]:[Seating id=1, pid=0, done=true, ls=1, ln=n5, rs=1, rn=n5]
[fid:9:9]:[Guest name=n5, sex=f, hobbies=h1]
[fid:1:1]:[Guest name=n1, sex=m, hobbies=h1]

Assign Seating
=&gt;[fid:30:47]:[Seating id=5, pid=4, done=false, ls=4, ln=n2, rs=5, rn=n1]
=&gt;[fid:31:48]:[Path id=5, seat=5, guest=n1]
=&gt;[fid:32:49]:[Chosen id=4, name=n1, hobbies=h1]</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_backward_chaining"><a class="anchor" href="#_backward_chaining"></a><a class="link" href="#_backward_chaining">25.17. Backward-Chaining</a></h3>
<div class="paragraph">
<p>A backward-chaining rule system is goal-driven.
This means the system starts with a conclusion which the engine tries to satisfy.
If it cannot do so it searches for sub-goals, that is, conclusions that will complete part of the current goal.
It continues this process until either the initial conclusion is satisfied or there are no more unsatisfied sub-goals. <strong>Prolog</strong> is an example of a backward-chaining engine.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/BackwardChainingChart.png" alt="BackwardChainingChart">
</div>
<div class="title">Figure 430. Backward Chaining Chart</div>
</div>
<div class="sect3">
<h4 id="_backward_chaining_systems"><a class="anchor" href="#_backward_chaining_systems"></a><a class="link" href="#_backward_chaining_systems">25.17.1. Backward-Chaining Systems</a></h4>
<div class="paragraph">
<p>Backward-Chaining is a feature recently added to the JBoss Rules Engine.
This process is often referred to as derivation queries, and it is not as common compared to reactive systems since JBoss Rules is primarily reactive forward chaining.
That is, it responds to changes in your data.
The backward-chaining added to the engine is for product-like derivations.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cloning_transitive_closures"><a class="anchor" href="#_cloning_transitive_closures"></a><a class="link" href="#_cloning_transitive_closures">25.17.2. Cloning Transitive Closures</a></h4>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/ReasoningGraph.png" alt="ReasoningGraph">
</div>
<div class="title">Figure 431. Reasoning Graph</div>
</div>
<div class="paragraph">
<p>The previous chart demonstrates a House example of transitive items.
A similar reasoning chart can be created by implementing the following rules:</p>
</div>
<div class="paragraph">
<p>1.
First, create some java rules to develop reasoning for transitive items.
It inserts each of the locations.</p>
</div>
<div class="paragraph">
<p>2.
Next, create the <strong>Location</strong> class; it has the item and where it is located.</p>
</div>
<div class="paragraph">
<p>3.
Type the rules for the House example as depicted below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">ksession.insert( <span class="hljs-keyword">new</span> Location(<span class="hljs-string">"office"</span>, <span class="hljs-string">"house"</span>) );
ksession.insert( <span class="hljs-keyword">new</span> Location(<span class="hljs-string">"kitchen"</span>, <span class="hljs-string">"house"</span>) );
ksession.insert( <span class="hljs-keyword">new</span> Location(<span class="hljs-string">"knife"</span>, <span class="hljs-string">"kitchen"</span>) );
ksession.insert( <span class="hljs-keyword">new</span> Location(<span class="hljs-string">"cheese"</span>, <span class="hljs-string">"kitchen"</span>) );
ksession.insert( <span class="hljs-keyword">new</span> Location(<span class="hljs-string">"desk"</span>, <span class="hljs-string">"office"</span>) );
ksession.insert( <span class="hljs-keyword">new</span> Location(<span class="hljs-string">"chair"</span>, <span class="hljs-string">"office"</span>) );
ksession.insert( <span class="hljs-keyword">new</span> Location(<span class="hljs-string">"computer"</span>, <span class="hljs-string">"desk"</span>) );
ksession.insert( <span class="hljs-keyword">new</span> Location(<span class="hljs-string">"drawer"</span>, <span class="hljs-string">"desk"</span>) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.
A transitive design is created in which the item is in its designated location such as a "desk" located in an "office."</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/TransitiveReasoningGraph.png" alt="TransitiveReasoningGraph">
</div>
<div class="title">Figure 432. Transitive Reasoning Graph of a House</div>
</div>
</div>
<div class="sect3">
<h4 id="_defining_a_query"><a class="anchor" href="#_defining_a_query"></a><a class="link" href="#_defining_a_query">25.17.3. Defining a Query</a></h4>
<div class="paragraph">
<p>1.
Create a query to look at the data inserted into the rules engine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">query isContainedIn( <span class="hljs-constant">String</span> x, <span class="hljs-constant">String</span> y )
  <span class="hljs-constant">Location</span>( x, y; )
  <span class="hljs-keyword">or</span>
  ( <span class="hljs-constant">Location</span>( z, y; ) <span class="hljs-keyword">and</span> isContainedIn( x, z; ) )
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how the query is recursive and is calling "isContainedIn."</p>
</div>
<div class="paragraph">
<p>2.
Create a rule to print out every string inserted into the system to see how things are implemented.
The rule should resemble the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">rule <span class="hljs-string">"go"</span> salience <span class="hljs-number">10</span>
<span class="hljs-keyword">when</span>
  <span class="hljs-variable">$s</span> <span class="hljs-symbol">:</span> <span class="hljs-constant">String</span>( )
<span class="hljs-keyword">then</span>
  <span class="hljs-constant">System</span>.out.println( <span class="hljs-variable">$s</span> );
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>3.
Using Step 2 as a model, create a rule that calls upon the Step 1 query "isContainedIn."</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"go1"</span>
<span class="hljs-function"><span class="hljs-keyword">when</span>
  <span class="hljs-title">String</span>(<span class="hljs-params"> <span class="hljs-keyword">this</span> == <span class="hljs-string">"go1"</span> </span>)
  <span class="hljs-title">isContainedIn</span>(<span class="hljs-params"><span class="hljs-string">"office"</span>, <span class="hljs-string">"house"</span>; </span>)
then
  System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params"> <span class="hljs-string">"office is in the house"</span> </span>)</span>;
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "go1" rule will fire when the first string is inserted into the engine.
That is, it asks if the item "office" is in the location "house." Therefore, the Step 1 query is evoked by the previous rule when the "go1" String is inserted.</p>
</div>
<div class="paragraph">
<p>4.
Create the "go1," insert it into the engine, and call the fireAllRules.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">         ksession.insert( <span class="hljs-string">"go1"</span> );
ksession.fireAllRules();
---
go1
office <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> the house</code></pre>
</div>
</div>
<div class="paragraph">
<p>The --- line indicates the separation of the output of the engine from the firing of the "go" rule and the "go1" rule.</p>
</div>
</div>
<div class="sect3">
<h4 id="_transitive_closure_example"><a class="anchor" href="#_transitive_closure_example"></a><a class="link" href="#_transitive_closure_example">25.17.4. Transitive Closure Example</a></h4>
<div class="paragraph">
<p>1.
Create a Transitive Closure by implementing the following rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"go2"</span>
<span class="hljs-function"><span class="hljs-keyword">when</span>
  <span class="hljs-title">String</span>(<span class="hljs-params"> <span class="hljs-keyword">this</span> == <span class="hljs-string">"go2"</span> </span>)
  <span class="hljs-title">isContainedIn</span>(<span class="hljs-params"><span class="hljs-string">"drawer"</span>, <span class="hljs-string">"house"</span>; </span>)
then
  System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params"> <span class="hljs-string">"Drawer in the House"</span> </span>)</span>;
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.
Recall from the Cloning Transitive Closure’s topic, there was no instance of "drawer" in "house." "drawer" was located in "desk."</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./Drools Documentation_files/TransitiveReasoningGraph2.png" alt="TransitiveReasoningGraph2">
</div>
<div class="title">Figure 433. Transitive Reasoning Graph of a Drawer</div>
</div>
<div class="paragraph">
<p>3.
Use the previous query for this recursive information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">query isContainedIn( <span class="hljs-constant">String</span> x, <span class="hljs-constant">String</span> y )
  <span class="hljs-constant">Location</span>( x, y; )
  <span class="hljs-keyword">or</span>
  ( <span class="hljs-constant">Location</span>( z, y; ) <span class="hljs-keyword">and</span> isContainedIn( x, z; ) )
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>4.
Create the "go2," insert it into the engine, and call the fireAllRules.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs bash">ksession.insert( <span class="hljs-string">"go2"</span> );
ksession.fireAllRules();
---
go2
Drawer <span class="hljs-keyword">in</span> the House</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the rule is fired, it correctly tells you "go2" has been inserted and that the "drawer" is in the "house."</p>
</div>
<div class="paragraph">
<p>5.
Check how the engine determined this outcome</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The query has to recurse down several levels to determine this.</p>
</li>
<li>
<p>Instead of using <strong>Location( x, y; )</strong>, The query uses the value of <strong>(z, y; )</strong> since "drawer" is not in "house."</p>
</li>
<li>
<p>The <strong>z</strong> is currently unbound which means it has no value and will return everything that is in the argument.</p>
</li>
<li>
<p><strong>y</strong> is currently bound to "house," so <strong>z</strong> will return "office" and "kitchen."</p>
</li>
<li>
<p>Information is gathered from "office" and checks recursively if the "drawer" is in the "office." The following query line is being called for these parameters: <strong>isContainedIn (x ,z; )</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is no instance of "drawer" in "office;" therefore, it does not match.
With z being unbound, it will return data that is within the "office," and it will gather that <strong>z == desk</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs">isContainedIn(x==drawer, z==desk)</code></pre>
</div>
</div>
<div class="paragraph">
<p>isContainedIn recurses three times.
On the final recurse, an instance triggers of "drawer" in the "desk."</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs"> Location(x==drawer, y==desk)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This matches on the first location and recurses back up, so we know that "drawer" is in the "desk," the "desk" is in the "office," and the "office" is in the "house;" therefore, the "drawer" is in the "house" and returns true.</p>
</div>
</div>
<div class="sect3">
<h4 id="_reactive_transitive_queries"><a class="anchor" href="#_reactive_transitive_queries"></a><a class="link" href="#_reactive_transitive_queries">25.17.5. Reactive Transitive Queries</a></h4>
<div class="paragraph">
<p>1.
Create a Reactive Transitive Query by implementing the following rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"go3"</span>
<span class="hljs-function"><span class="hljs-keyword">when</span>
  <span class="hljs-title">String</span>(<span class="hljs-params"> <span class="hljs-keyword">this</span> == <span class="hljs-string">"go3"</span> </span>)
  <span class="hljs-title">isContainedIn</span>(<span class="hljs-params"><span class="hljs-string">"key"</span>, <span class="hljs-string">"office"</span>; </span>)
then
  System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params"> <span class="hljs-string">"Key in the Office"</span> </span>)</span>;
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reactive Transitive Queries can ask a question even if the answer can not be satisfied.
Later, if it is satisfied, it will return an answer.</p>
</div>
<div class="paragraph">
<p>2.
Use the same query for this reactive information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">query isContainedIn( <span class="hljs-constant">String</span> x, <span class="hljs-constant">String</span> y )
  <span class="hljs-constant">Location</span>( x, y; )
  <span class="hljs-keyword">or</span>
  ( <span class="hljs-constant">Location</span>( z, y; ) <span class="hljs-keyword">and</span> isContainedIn( x, z; ) )
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>3.
Create the "go3," insert it into the engine, and call the fireAllRules.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs css"><span class="hljs-tag">ksession</span><span class="hljs-class">.insert</span>( "<span class="hljs-tag">go3</span>" );
<span class="hljs-tag">ksession</span><span class="hljs-class">.fireAllRules</span>();
<span class="hljs-tag">---</span>
<span class="hljs-tag">go3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first rule that matches any String returns "go3" but nothing else is returned because there is no answer; however, while "go3" is inserted in the system, it will continuously wait until it is satisfied.</p>
</div>
<div class="paragraph">
<p>4.
Insert a new location of "key" in the "drawer":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">ksession.insert( <span class="hljs-keyword">new</span> Location(<span class="hljs-string">"key"</span>, <span class="hljs-string">"drawer"</span>) );
ksession.fireAllRules();
---
Key <span class="hljs-keyword">in</span> the Office</code></pre>
</div>
</div>
<div class="paragraph">
<p>This new location satisfies the transitive closure because it is monitoring the entire graph.
In addition, this process now has four recursive levels in which it goes through to match and fire the rule.</p>
</div>
</div>
<div class="sect3">
<h4 id="_queries_with_unbound_arguments"><a class="anchor" href="#_queries_with_unbound_arguments"></a><a class="link" href="#_queries_with_unbound_arguments">25.17.6. Queries with Unbound Arguments</a></h4>
<div class="paragraph">
<p>1.
Create a Query with Unbound Arguments by implementing the following rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"go4"</span>
<span class="hljs-function"><span class="hljs-keyword">when</span>
  <span class="hljs-title">String</span>(<span class="hljs-params"> <span class="hljs-keyword">this</span> == <span class="hljs-string">"go4"</span> </span>)
  <span class="hljs-title">isContainedIn</span>(<span class="hljs-params">thing, <span class="hljs-string">"office"</span>; </span>)
then
  System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params"> <span class="hljs-string">"thing"</span> + thing + <span class="hljs-string">"is in the Office"</span> </span>)</span>;
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This rule is asking for everything in the "office," and it will tell everything in all the rows below.
The unbound argument (out variable thing) in this example will return every possible value; accordingly, it is very similar to the z value used in the Reactive Transitive Query example.</p>
</div>
<div class="paragraph">
<p>2.
Use the query for the unbound arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">query isContainedIn( <span class="hljs-constant">String</span> x, <span class="hljs-constant">String</span> y )
  <span class="hljs-constant">Location</span>( x, y; )
  <span class="hljs-keyword">or</span>
  ( <span class="hljs-constant">Location</span>( z, y; ) <span class="hljs-keyword">and</span> isContainedIn( x, z; ) )
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>3.
Create the "go4," insert it into the engine, and call the fireAllRules.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">ksession.insert( <span class="hljs-string">"go4"</span> );
ksession.fireAllRules();
---
go4
thing Key <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> the Office
thing Computer <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> the Office
thing Drawer <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> the Office
thing Desk <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> the Office
thing Chair <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> the Office</code></pre>
</div>
</div>
<div class="paragraph">
<p>When "go4" is inserted, it returns all the previous information that is transitively below "Office."</p>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_unbound_arguments"><a class="anchor" href="#_multiple_unbound_arguments"></a><a class="link" href="#_multiple_unbound_arguments">25.17.7. Multiple Unbound Arguments</a></h4>
<div class="paragraph">
<p>1.
Create a query with Mulitple Unbound Arguments by implementing the following rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs cs">rule <span class="hljs-string">"go5"</span>
<span class="hljs-function"><span class="hljs-keyword">when</span>
  <span class="hljs-title">String</span>(<span class="hljs-params"> <span class="hljs-keyword">this</span> == <span class="hljs-string">"go5"</span> </span>)
  <span class="hljs-title">isContainedIn</span>(<span class="hljs-params">thing, location; </span>)
then
  System.<span class="hljs-keyword">out</span>.<span class="hljs-title">println</span>(<span class="hljs-params"> <span class="hljs-string">"thing"</span> + thing + <span class="hljs-string">"is in"</span> + location </span>)</span>;
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This rule is asking for everything in the "office," and it will tell everything in all the rows below.
The unbound argument (out variable thing) in this example will return every possible value; accordingly, it is very similar to the z value used in the Reactive Transitive Query example.</p>
</div>
<div class="paragraph">
<p>Both <strong>thing</strong> and <strong>location</strong> are unbound out variables, and without bound arguments, everything is called upon.</p>
</div>
<div class="paragraph">
<p>2.
Use the query for multiple unbound arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs ruby">query isContainedIn( <span class="hljs-constant">String</span> x, <span class="hljs-constant">String</span> y )
  <span class="hljs-constant">Location</span>( x, y; )
  <span class="hljs-keyword">or</span>
  ( <span class="hljs-constant">Location</span>( z, y; ) <span class="hljs-keyword">and</span> isContainedIn( x, z; ) )
<span class="hljs-keyword">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>3.
Create the "go5," insert it into the engine, and call the fireAllRules.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="hljs coffeescript">ksession.insert( <span class="hljs-string">"go5"</span> );
ksession.fireAllRules();
---
go5
thing Knife <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> House
thing Cheese <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> House
thing Key <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> House
thing Computer <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> House
thing Drawer <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> House
thing Desk <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> House
thing Chair <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> House
thing Key <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Office
thing Computer <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Office
thing Drawer <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Office
thing Key <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Desk
thing Office <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> House
thing Computer <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Desk
thing Knife <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Kitchen
thing Cheese <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Kitchen
thing Kitchen <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> House
thing Key <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Drawer
thing Drawer <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Desk
thing Desk <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Office
thing Chair <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> Office</code></pre>
</div>
</div>
<div class="paragraph">
<p>When "go5" is called, it returns everything within everything.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 7.7.0.Final<br>
Last updated 2018-03-26 11:11:06 CEST
</div>
</div>
<script type="text/javascript" async="" src="./Drools Documentation_files/insight.min.js.下载"></script><script type="text/javascript" async="" src="./Drools Documentation_files/f.txt"></script><script type="text/javascript" async="" src="./Drools Documentation_files/analytics.js.下载"></script><script async="" src="./Drools Documentation_files/gtm.js.下载"></script><script type="text/javascript">
dataLayer = [{'channel' : 'Drools', 'additional_tracking_code' : 'UA-62250098-1'}];
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NJWS5L');</script>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NJWS5L" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<link rel="stylesheet" href="./Drools Documentation_files/github.min.css">
<script src="./Drools Documentation_files/highlight.min.js.下载"></script>
<script>hljs.initHighlighting()</script>

<script type="text/javascript" id="" src="./Drools Documentation_files/s_code.js.下载"></script>
<script type="text/javascript" id="">window.eloqua=window.eloqua||{queue:[]};window.eloqua.siteId="1795";window.eloqua.formName="jboss-org-integration";eloqua.queue.unshift("eloqua.load");eloqua.queue.push("eloqua.loadGUID");</script>

<script type="text/javascript" id="" src="./Drools Documentation_files/elqCfg.js.下载"></script>

<script type="text/javascript" id="">var eloqua=eloqua||{guid:null};
(function(){function f(b){var a="; "+document.cookie;b=a.split("; "+b+"\x3d");if(2==b.length)return b.pop().split(";").shift()}function c(b){var a=window.location.hostname;var e=a.indexOf(".jboss.org");e=-1!=e?a.substring(e,a.length):null;a=g;var c=k,d=new Date;d.setTime(d.getTime()+c);c="expires\x3d"+d.toUTCString();a=a+"\x3d"+b+"; "+c;a+=";path\x3d/";e&&(a+=";domain\x3d"+e);document.cookie=a}function d(){if(h){if("function"===typeof window.GetElqCustomerGUID){eloqua.guid=GetElqCustomerGUID();c(eloqua.guid);
return}if(eloqua.guid){c(eloqua.guid);return}}h=setTimeout(d,100)}function l(){if(!f(g)){var b=f("rh_elqCustomerGUID");b?(eloqua.guid=b,c(eloqua.guid)):jQuery?jQuery(document).ready(d):d()}}var k=2592E6,g="elqGUID",h=null;l()})();</script>        <script type="text/javascript" id="">_bizo_data_partner_id="6570";</script>
<script type="text/javascript" id="">(function(){var b=document.getElementsByTagName("script")[0],a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===window.location.protocol?"https://sjs":"http://js")+".bizographics.com/insight.min.js";b.parentNode.insertBefore(a,b)})();</script>
<noscript>
  <img height="1" width="1" alt="" style="display:none;" src="//www.bizographics.com/collect/?pid=6570&amp;fmt=gif">
</noscript><div style="position: static; width: 0px; height: 0px; border: none; padding: 0px; margin: 0px;"><div id="trans-tooltip"><div id="tip-left-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-left-top.png&quot;);"></div><div id="tip-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-top.png&quot;) repeat-x;"></div><div id="tip-right-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-right-top.png&quot;);"></div><div id="tip-right" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-right.png&quot;) repeat-y;"></div><div id="tip-right-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-right-bottom.png&quot;);"></div><div id="tip-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-bottom.png&quot;) repeat-x;"></div><div id="tip-left-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-left-bottom.png&quot;);"></div><div id="tip-left" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-left.png&quot;);"></div><div id="trans-content"></div></div><div id="tip-arrow-bottom" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-arrow-bottom.png&quot;);"></div><div id="tip-arrow-top" style="background: url(&quot;chrome-extension://ccfjcepmiaackkccabgeeegeklgifffd/imgs/map/tip-arrow-top.png&quot;);"></div></div><script src="./Drools Documentation_files/f(1).txt"></script>
<script type="text/javascript" id="">function getCookieValue(a,b){return(b=document.cookie.match("(^|;)\\s*"+a+"\\s*\x3d\\s*([^;]+)"))?b.pop():""}
(function(){var a=location.pathname.substr(1,location.pathname.length).toLowerCase().split("/");"index.html"!=a[a.length-1]&&""!=a[a.length-1]||a.pop();s.prop2=s.eVar22="en";s.prop4=s.eVar23=encodeURI(location.search);for(var b=a.length;3>b;b++)a[b]="";s.prop14=s.eVar27=a.shift();s.prop15=s.eVar28=a.shift();s.prop16=s.eVar29=a.shift();s.prop21=s.eVar18=encodeURI(location.hostname+location.pathname).toLowerCase();a="rhd_registered";b=(b=document.cookie.match("(^|;)\\s*"+a+"\\s*\x3d\\s*([^;]+)"))?b.pop():
"false";"true"==b&&(s.events="event91",document.cookie=a+"\x3d; Path\x3d/; Expires\x3dThu, 01 Jan 1970 00:00:01 GMT;")})();</script>
<script type="text/javascript" id="" src="./Drools Documentation_files/rh_omni_footer.js.下载"></script>
<script type="text/javascript" id="" src="./Drools Documentation_files/eloqua-1.0.13.min.js.下载"></script><script src="./Drools Documentation_files/saved_resource" type="text/javascript"></script></body></html>