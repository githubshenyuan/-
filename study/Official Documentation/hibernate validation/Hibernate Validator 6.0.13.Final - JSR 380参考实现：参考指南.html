<!DOCTYPE html>
<!-- saved from url=(0106)#non-el-message-interpolator -->
<html lang="zh-CN" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Hardy Ferentschik, Gunnar Morling, Guillaume Smet">
<title>Hibernate Validator 6.0.13.Final  -  JSR 380参考实现：参考指南</title>
<link rel="stylesheet" href="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/css">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/font-awesome.min.css">
<!-- HibernateDoc.Meta -->
<meta name="description" content="Hibernate Validator, Annotation based constraints for your domain model - Reference Documentation">
<meta name="keywords" content="hibernate, validator, hibernate validator, validation, bean validation">
<link rel="canonical" href="">
<!-- /HibernateDoc.Meta -->

<link rel="stylesheet" href="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/hibernate.css" type="text/css">
<script type="text/javascript" src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/svrGP"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/translateelement.css"></head>
<body class="book toc2 toc-left">
<div id="header">
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator 6.0.13.Final  -  JSR 380参考实现：参考指南</font></font></h1>
<div class="details">
<span id="author" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardy Ferentschik </font></font></span><br>
<span id="author2" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gunnar Morling </font></font></span><br>
<span id="author3" class="author"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guillaume Smet </font></font></span><br>
<span id="revdate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018-08-22</font></font></span>
</div>
<div id="toc" class="toc2">
<div id="toctitle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></div>
<ul class="sectlevel1">
<li><a href="#preface"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前言</font></font></a></li>
<li><a href="#validator-gettingstarted"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.入门</font></font></a>
<ul class="sectlevel2">
<li><a href="#validator-gettingstarted-createproject"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1。</font><font style="vertical-align: inherit;">项目设置</font></font></a>
<ul class="sectlevel3">
<li><a href="#validator-gettingstarted-uel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.1。</font><font style="vertical-align: inherit;">统一EL</font></font></a></li>
<li><a href="#section-getting-started-cdi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.2。</font><font style="vertical-align: inherit;">CDI</font></font></a></li>
<li><a href="#section-getting-started-security-manager"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.3。</font><font style="vertical-align: inherit;">与安全管理器一起运行</font></font></a></li>
<li><a href="#_updating_hibernate_validator_in_wildfly"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.4。</font><font style="vertical-align: inherit;">在WildFly中更新Hibernate Validator</font></font></a></li>
<li><a href="#validator-gettingstarted-java9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.5。</font><font style="vertical-align: inherit;">在Java 9上运行</font></font></a></li>
</ul>
</li>
<li><a href="#validator-gettingstarted-createmodel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2。</font><font style="vertical-align: inherit;">应用约束</font></font></a></li>
<li><a href="#_validating_constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3。</font><font style="vertical-align: inherit;">验证约束</font></font></a></li>
<li><a href="#validator-gettingstarted-whatsnext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4。</font><font style="vertical-align: inherit;">下一步去哪儿？</font></font></a></li>
</ul>
</li>
<li><a href="#chapter-bean-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.声明和验证bean约束</font></font></a>
<ul class="sectlevel2">
<li><a href="#section-declaring-bean-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1。</font><font style="vertical-align: inherit;">声明bean约束</font></font></a>
<ul class="sectlevel3">
<li><a href="#_field_level_constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.1。</font><font style="vertical-align: inherit;">字段级约束</font></font></a></li>
<li><a href="#_property_level_constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.2。</font><font style="vertical-align: inherit;">属性级约束</font></font></a></li>
<li><a href="#container-element-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.3。</font><font style="vertical-align: inherit;">容器元素约束</font></font></a></li>
<li><a href="#validator-usingvalidator-classlevel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.4。</font><font style="vertical-align: inherit;">类级约束</font></font></a></li>
<li><a href="#section-constraint-inheritance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.5。</font><font style="vertical-align: inherit;">约束继承</font></font></a></li>
<li><a href="#section-object-graph-validation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.6。</font><font style="vertical-align: inherit;">对象图</font></font></a></li>
</ul>
</li>
<li><a href="#section-validating-bean-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2。</font><font style="vertical-align: inherit;">验证bean约束</font></font></a>
<ul class="sectlevel3">
<li><a href="#section-obtaining-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.1。</font><font style="vertical-align: inherit;">获取</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font></font></a></li>
<li><a href="#_validator_methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.2。</font><font style="vertical-align: inherit;">验证方法</font></font></a></li>
<li><a href="#section-constraint-violation-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.3。 </font></font><code>ConstraintViolation</code></a></li>
</ul>
</li>
<li><a href="#section-builtin-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3。</font><font style="vertical-align: inherit;">内置约束</font></font></a>
<ul class="sectlevel3">
<li><a href="#validator-defineconstraints-spec"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3.1。</font><font style="vertical-align: inherit;">Bean验证约束</font></font></a></li>
<li><a href="#validator-defineconstraints-hv-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3.2。</font><font style="vertical-align: inherit;">附加限制</font></font></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chapter-method-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.声明和验证方法约束</font></font></a>
<ul class="sectlevel2">
<li><a href="#section-declaring-method-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1。</font><font style="vertical-align: inherit;">声明方法约束</font></font></a>
<ul class="sectlevel3">
<li><a href="#_parameter_constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1.1。</font><font style="vertical-align: inherit;">参数约束</font></font></a></li>
<li><a href="#_return_value_constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1.2。</font><font style="vertical-align: inherit;">返回值约束</font></font></a></li>
<li><a href="#_cascaded_validation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1.3。</font><font style="vertical-align: inherit;">级联验证</font></font></a></li>
<li><a href="#section-method-constraints-inheritance-hierarchies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1.4。</font><font style="vertical-align: inherit;">继承层次结构中的方法约束</font></font></a></li>
</ul>
</li>
<li><a href="#section-validating-executable-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2。</font><font style="vertical-align: inherit;">验证方法约束</font></font></a>
<ul class="sectlevel3">
<li><a href="#section-obtaining-executable-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.1。</font><font style="vertical-align: inherit;">获取</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font></font></a></li>
<li><a href="#section-executable-validator-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.2。</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></a></li>
<li><a href="#_code_constraintviolation_code_methods_for_method_validation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.3。</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法验证的方法</font></font></a></li>
</ul>
</li>
<li><a href="#section-builtin-method-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3。</font><font style="vertical-align: inherit;">内置方法约束</font></font></a></li>
</ul>
</li>
<li><a href="#chapter-message-interpolation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.插值约束错误消息</font></font></a>
<ul class="sectlevel2">
<li><a href="#section-message-interpolation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1。</font><font style="vertical-align: inherit;">默认消息插值</font></font></a>
<ul class="sectlevel3">
<li><a href="#section-special-characters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1.1。</font><font style="vertical-align: inherit;">特殊字符</font></font></a></li>
<li><a href="#section-interpolation-with-message-expressions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1.2。</font><font style="vertical-align: inherit;">使用消息表达式进行插值</font></font></a></li>
<li><a href="#_examples"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1.3。</font><font style="vertical-align: inherit;">例子</font></font></a></li>
</ul>
</li>
<li><a href="#section-custom-message-interpolation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2。</font><font style="vertical-align: inherit;">自定义消息插值</font></font></a>
<ul class="sectlevel3">
<li><a href="#section-resource-bundle-locator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2.1。 </font></font><code>ResourceBundleLocator</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chapter-groups"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.分组约束</font></font></a>
<ul class="sectlevel2">
<li><a href="#_requesting_groups"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1。</font><font style="vertical-align: inherit;">请求小组</font></font></a></li>
<li><a href="#section-group-inheritance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2。</font><font style="vertical-align: inherit;">组继承</font></font></a></li>
<li><a href="#section-defining-group-sequences"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3。</font><font style="vertical-align: inherit;">定义组序列</font></font></a></li>
<li><a href="#section-default-group-class"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4。</font><font style="vertical-align: inherit;">重新定义默认组序列</font></font></a>
<ul class="sectlevel3">
<li><a href="#_code_groupsequence_code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.1。 </font></font><code>@GroupSequence</code></a></li>
<li><a href="#_code_groupsequenceprovider_code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.2。 </font></font><code>@GroupSequenceProvider</code></a></li>
</ul>
</li>
<li><a href="#section-group-conversion"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.5。</font><font style="vertical-align: inherit;">集团转换</font></font></a></li>
</ul>
</li>
<li><a href="#validator-customconstraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.创建自定义约束</font></font></a>
<ul class="sectlevel2">
<li><a href="#validator-customconstraints-simple"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1。</font><font style="vertical-align: inherit;">创建一个简单的约束</font></font></a>
<ul class="sectlevel3">
<li><a href="#validator-customconstraints-constraintannotation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1。</font><font style="vertical-align: inherit;">约束注释</font></font></a></li>
<li><a href="#section-constraint-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2。</font><font style="vertical-align: inherit;">约束验证器</font></font></a></li>
<li><a href="#validator-customconstraints-errormessage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.3。</font><font style="vertical-align: inherit;">错误消息</font></font></a></li>
<li><a href="#validator-customconstraints-using"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.4。</font><font style="vertical-align: inherit;">使用约束</font></font></a></li>
</ul>
</li>
<li><a href="#section-class-level-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2。</font><font style="vertical-align: inherit;">类级约束</font></font></a>
<ul class="sectlevel3">
<li><a href="#section-custom-property-paths"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.1。</font><font style="vertical-align: inherit;">自定义属性路径</font></font></a></li>
</ul>
</li>
<li><a href="#section-cross-parameter-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3。</font><font style="vertical-align: inherit;">交叉参数约束</font></font></a></li>
<li><a href="#section-constraint-composition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4。</font><font style="vertical-align: inherit;">约束组成</font></font></a></li>
</ul>
</li>
<li><a href="#chapter-valueextraction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.价值提取</font></font></a>
<ul class="sectlevel2">
<li><a href="#section-valueextraction-builtinvalueextractors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1。</font><font style="vertical-align: inherit;">内置值提取器</font></font></a></li>
<li><a href="#_implementing_a_code_valueextractor_code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2。</font><font style="vertical-align: inherit;">实施一个</font></font><code>ValueExtractor</code></a></li>
<li><a href="#_non_generic_containers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3。</font><font style="vertical-align: inherit;">非通用容器</font></font></a></li>
<li><a href="#section-valueextraction-javafx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4。</font><font style="vertical-align: inherit;">JavaFX值提取器</font></font></a></li>
<li><a href="#section-valueextraction-registeringvalueextractor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5。</font><font style="vertical-align: inherit;">注册一个</font></font><code>ValueExtractor</code></a></li>
<li><a href="#_resolution_algorithms"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6。</font><font style="vertical-align: inherit;">分辨率算法</font></font></a></li>
</ul>
</li>
<li><a href="#chapter-xml-configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.通过XML配置</font></font></a>
<ul class="sectlevel2">
<li><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1。</font><font style="vertical-align: inherit;">在</font><em><font style="vertical-align: inherit;">validation.xml中</font></em><font style="vertical-align: inherit;">配置验证器工厂</font></font><em><font style="vertical-align: inherit;"></font></em></a></li>
<li><a href="#section-mapping-xml-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2。</font><font style="vertical-align: inherit;">通过映射约束</font></font><code>constraint-mappings</code></a></li>
</ul>
</li>
<li><a href="#chapter-bootstrapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.引导</font></font></a>
<ul class="sectlevel2">
<li><a href="#section-retrieving-validator-factory-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1。</font><font style="vertical-align: inherit;">检索</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Validator</code></a>
<ul class="sectlevel3">
<li><a href="#section-validation-provider-resolver"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.1。 </font></font><code>ValidationProviderResolver</code></a></li>
</ul>
</li>
<li><a href="#section-configuring-validator-factory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2。</font><font style="vertical-align: inherit;">配置一个</font></font><code>ValidatorFactory</code></a>
<ul class="sectlevel3">
<li><a href="#section-validator-factory-message-interpolator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.1。 </font></font><code>MessageInterpolator</code></a></li>
<li><a href="#section-validator-factory-traversable-resolver"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.2。 </font></font><code>TraversableResolver</code></a></li>
<li><a href="#_code_constraintvalidatorfactory_code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.3。 </font></font><code>ConstraintValidatorFactory</code></a></li>
<li><a href="#section-parameter-name-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.4。 </font></font><code>ParameterNameProvider</code></a></li>
<li><a href="#section-clock-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.5。</font></font><code>ClockProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和时间验证容差</font></font></a></li>
<li><a href="#section-bootstrapping-valueextractors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.6。</font><font style="vertical-align: inherit;">注册</font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小号</font></font></a></li>
<li><a href="#_adding_mapping_streams"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.7。</font><font style="vertical-align: inherit;">添加映射流</font></font></a></li>
<li><a href="#section-provider-specific-settings"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.8。</font><font style="vertical-align: inherit;">特定于提供者的设置</font></font></a></li>
<li><a href="#section-script-evaluator-factory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.9。</font><font style="vertical-align: inherit;">配置</font></font><code>ScriptEvaluatorFactory</code></a></li>
</ul>
</li>
<li><a href="#section-configuring-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.3。</font><font style="vertical-align: inherit;">配置验证器</font></font></a></li>
</ul>
</li>
<li><a href="#validator-metadata-api"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.使用约束元数据</font></font></a>
<ul class="sectlevel2">
<li><a href="#_code_beandescriptor_code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1。 </font></font><code>BeanDescriptor</code></a></li>
<li><a href="#section-property-descriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2。 </font></font><code>PropertyDescriptor</code></a></li>
<li><a href="#_code_methoddescriptor_code_and_code_constructordescriptor_code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.3。</font></font><code>MethodDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ConstructorDescriptor</code></a></li>
<li><a href="#validator-metadata-api-elementdescriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.4。 </font></font><code>ElementDescriptor</code></a></li>
<li><a href="#_code_containerdescriptor_code_and_code_containerelementtypedescriptor_code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.5。</font></font><code>ContainerDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ContainerElementTypeDescriptor</code></a></li>
<li><a href="#section-group-conversion-descriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.6。 </font></font><code>GroupConversionDescriptor</code></a></li>
<li><a href="#section-constraint-descriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.7。 </font></font><code>ConstraintDescriptor</code></a></li>
</ul>
</li>
<li><a href="#validator-integration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.与其他框架集成</font></font></a>
<ul class="sectlevel2">
<li><a href="#validator-checkconstraints-orm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1。</font><font style="vertical-align: inherit;">ORM集成</font></font></a>
<ul class="sectlevel3">
<li><a href="#validator-checkconstraints-db"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1.1。</font><font style="vertical-align: inherit;">数据库模式级验证</font></font></a></li>
<li><a href="#validator-checkconstraints-orm-hibernateevent"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1.2。</font><font style="vertical-align: inherit;">Hibernate基于ORM事件的验证</font></font></a></li>
<li><a href="#_jpa"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1.3。</font><font style="vertical-align: inherit;">JPA</font></font></a></li>
</ul>
</li>
<li><a href="#section-presentation-layer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2。</font><font style="vertical-align: inherit;">JSF＆Seam</font></font></a></li>
<li><a href="#section-integration-with-cdi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3。</font><font style="vertical-align: inherit;">CDI</font></font></a>
<ul class="sectlevel3">
<li><a href="#_dependency_injection"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3.1。</font><font style="vertical-align: inherit;">依赖注入</font></font></a></li>
<li><a href="#_method_validation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3.2。</font><font style="vertical-align: inherit;">方法验证</font></font></a></li>
</ul>
</li>
<li><a href="#_java_ee"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.4。</font><font style="vertical-align: inherit;">Java EE</font></font></a></li>
<li><a href="#_javafx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.5。</font><font style="vertical-align: inherit;">JavaFX的</font></font></a></li>
</ul>
</li>
<li><a href="#validator-specifics"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12. Hibernate Validator细节</font></font></a>
<ul class="sectlevel2">
<li><a href="#_public_api"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.1。</font><font style="vertical-align: inherit;">公共API</font></font></a></li>
<li><a href="#section-fail-fast"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.2。</font><font style="vertical-align: inherit;">失败快速模式</font></font></a></li>
<li><a href="#section-method-validation-prerequisite-relaxation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.3。</font><font style="vertical-align: inherit;">放宽类层次结构中方法验证的要求</font></font></a></li>
<li><a href="#section-programmatic-api"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.4。</font><font style="vertical-align: inherit;">程序化约束定义和声明</font></font></a></li>
<li><a href="#section-programmatic-api-contributor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.5。</font><font style="vertical-align: inherit;">将编程约束声明应用于默认验证器工厂</font></font></a></li>
<li><a href="#section-advanced-constraint-composition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.6。</font><font style="vertical-align: inherit;">高级约束组合功能</font></font></a>
<ul class="sectlevel3">
<li><a href="#_validation_target_specification_for_purely_composed_constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.6.1。</font><font style="vertical-align: inherit;">纯组合约束的验证目标规范</font></font></a></li>
<li><a href="#section-boolean-constraint-composition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.6.2。</font><font style="vertical-align: inherit;">布尔组合的约束</font></font></a></li>
</ul>
</li>
<li><a href="#section-extensions-path-api"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.7。</font><font style="vertical-align: inherit;">Path API的扩展</font></font></a></li>
<li><a href="#section-dynamic-payload"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.8。</font><font style="vertical-align: inherit;">动态有效载荷作为一部分</font></font><code>ConstraintViolation</code></a></li>
<li><a href="#non-el-message-interpolator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.9。 </font></font><code>ParameterMessageInterpolator</code></a></li>
<li><a href="#_code_resourcebundlelocator_code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.10。 </font></font><code>ResourceBundleLocator</code></a></li>
<li><a href="#_custom_contexts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.11。</font><font style="vertical-align: inherit;">自定义上下文</font></font></a>
<ul class="sectlevel3">
<li><a href="#section-hibernateconstraintvalidatorcontext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.11.1。 </font></font><code>HibernateConstraintValidatorContext</code></a></li>
<li><a href="#_code_hibernatemessageinterpolatorcontext_code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.11.2。 </font></font><code>HibernateMessageInterpolatorContext</code></a></li>
</ul>
</li>
<li><a href="#section-paranamer-parameternameprovider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.12。</font><font style="vertical-align: inherit;">Paranamer基础</font></font><code>ParameterNameProvider</code></a></li>
<li><a href="#section-constraint-definition-contribution"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.13。</font><font style="vertical-align: inherit;">提供约束定义</font></font></a>
<ul class="sectlevel3">
<li><a href="#_constraint_definitions_via_code_serviceloader_code"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.13.1。</font><font style="vertical-align: inherit;">约束定义通过</font></font><code>ServiceLoader</code></a></li>
<li><a href="#section-programmatic-constraint-definition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.13.2。</font><font style="vertical-align: inherit;">以编程方式添加约束定义</font></font></a></li>
</ul>
</li>
<li><a href="#section-constraint-customizing-class-loading"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.14。</font><font style="vertical-align: inherit;">自定义类加载</font></font></a></li>
</ul>
</li>
<li><a href="#validator-annotation-processor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.注释处理器</font></font></a>
<ul class="sectlevel2">
<li><a href="#validator-annotationprocessor-prerequisites"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1。</font><font style="vertical-align: inherit;">先决条件</font></font></a></li>
<li><a href="#validator-annotationprocessor-features"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.2。</font><font style="vertical-align: inherit;">特征</font></font></a></li>
<li><a href="#validator-annotationprocessor-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3。</font><font style="vertical-align: inherit;">选项</font></font></a></li>
<li><a href="#validator-annotationprocessor-usage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4。</font><font style="vertical-align: inherit;">使用注释处理器</font></font></a>
<ul class="sectlevel3">
<li><a href="#validator-annotationprocessor-commandline"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.1。</font><font style="vertical-align: inherit;">命令行构建</font></font></a></li>
<li><a href="#validator-annotationprocessor-ide"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.2。</font><font style="vertical-align: inherit;">IDE构建</font></font></a></li>
</ul>
</li>
<li><a href="#validator-annotationprocessor-known-issues"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.5。</font><font style="vertical-align: inherit;">已知的问题</font></font></a></li>
</ul>
</li>
<li><a href="#validator-further-reading"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.进一步阅读</font></font></a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前言</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证数据是从表示到持久层的所有应用程序层中发生的常见任务。</font><font style="vertical-align: inherit;">通常在每个层中实现相同的验证逻辑，这是耗时且容易出错的。</font><font style="vertical-align: inherit;">为了避免重复这些验证，开发人员经常将验证逻辑直接捆绑到域模型中，使用验证代码来混淆域类，验证代码实际上是关于类本身的元数据。</font></font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/application-layers.png" alt="应用层">
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 380  -  Bean Validation 2.0  - 为实体和方法验证定义元数据模型和API。</font><font style="vertical-align: inherit;">默认元数据源是注释，能够通过使用XML覆盖和扩展元数据。</font><font style="vertical-align: inherit;">API不依赖于特定的应用程序层或编程模型。</font><font style="vertical-align: inherit;">它特别不依赖于Web或持久层，可用于服务器端应用程序编程，以及富客户端Swing应用程序开发人员。</font></font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/application-layers2.png" alt="应用层2">
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator是此JSR 380的参考实现。实现本身以及Bean Validation API和TCK都在</font></font><a href="http://www.apache.org/licenses/LICENSE-2.0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache Software License 2.0</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下提供和分发
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator 6和Bean Validation 2.0需要Java 8或更高版本。</font></font></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validator-gettingstarted"><a class="anchor" href="#validator-gettingstarted"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.入门</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章将向您展示如何开始使用Hibernate Validator，即Bean Validation的参考实现（RI）。</font><font style="vertical-align: inherit;">对于以下快速入门，您需要：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个JDK 8</font></font></p>
</li>
<li>
<p><a href="http://maven.apache.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache Maven</font></font></a></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet连接（Maven必须下载所有必需的库）</font></font></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="validator-gettingstarted-createproject"><a class="anchor" href="#validator-gettingstarted-createproject"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1。</font><font style="vertical-align: inherit;">项目设置</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要在Maven项目中使用Hibernate Validator，只需将以下依赖项添加到</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pom.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1.1：Hibernate Validator Maven依赖</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;dependency&gt;</span><span class="pln">
    </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.hibernate.validator</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
    </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">hibernate-validator</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
    </span><span class="tag">&lt;version&gt;</span><span class="pln">6.0.13.Final</span><span class="tag">&lt;/version&gt;</span><span class="pln">
</span><span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这可传递性地将依赖性引入Bean Validation API（</font></font><code>javax.validation:validation-api:2.0.1.Final</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="sect3">
<h4 id="validator-gettingstarted-uel"><a class="anchor" href="#validator-gettingstarted-uel"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.1。</font><font style="vertical-align: inherit;">统一EL</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator需要实现统一表达式语言（</font></font><a href="http://jcp.org/en/jsr/detail?id=341"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 341</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）来评估约束违规消息中的动态表达式（请参见</font></font><a href="#section-message-interpolation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.1节“默认消息插值”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">当您的应用程序在诸如JBoss AS的Java EE容器中运行时，容器已经提供了EL实现。</font><font style="vertical-align: inherit;">但是，在Java SE环境中，您必须将实现作为依赖项添加到POM文件中。</font><font style="vertical-align: inherit;">例如，您可以添加以下依赖项以使用JSR 341 </font></font><a href="https://javaee.github.io/uel-ri/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考实现</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1.2：统一EL参考实现的Maven依赖关系</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;dependency&gt;</span><span class="pln">
    </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.glassfish</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
    </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">javax.el</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
    </span><span class="tag">&lt;version&gt;</span><span class="pln">3.0.1-b09</span><span class="tag">&lt;/version&gt;</span><span class="pln">
</span><span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于无法提供EL实现的环境，Hibernate Validator提供了
 </font></font><a href="#non-el-message-interpolator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.9节“ </font></font><code>ParameterMessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，此插值器的使用不符合Bean Validation规范。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="section-getting-started-cdi"><a class="anchor" href="#section-getting-started-cdi"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.2。</font><font style="vertical-align: inherit;">CDI</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation使用CDI（Java </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TM</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
EE的</font><font style="vertical-align: inherit;">上下文和依赖注入</font><font style="vertical-align: inherit;">，</font></font><a href="http://jcp.org/en/jsr/detail?id=346"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 346</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">定义集成点</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您的应用程序在不提供开箱即用的集成的环境中运行，您可以通过向POM添加以下Maven依赖项来使用Hibernate Validator CDI可移植扩展：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1.3：Hibernate Validator CDI可移植扩展Maven依赖</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;dependency&gt;</span><span class="pln">
    </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.hibernate.validator</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
    </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">hibernate-validator-cdi</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
    </span><span class="tag">&lt;version&gt;</span><span class="pln">6.0.13.Final</span><span class="tag">&lt;/version&gt;</span><span class="pln">
</span><span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，在Java EE应用程序服务器上运行的应用程序通常不需要添加此依赖项。</font><font style="vertical-align: inherit;">您可以在</font></font><a href="#section-integration-with-cdi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第11.3节“CDI”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解有关Bean验证和CDI集成的更多信息
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="section-getting-started-security-manager"><a class="anchor" href="#section-getting-started-security-manager"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.3。</font><font style="vertical-align: inherit;">与安全管理器一起运行</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator支持</font><font style="vertical-align: inherit;">在启用</font></font><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全管理器的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情况下</font><font style="vertical-align: inherit;">运行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为此，您必须为Hibernate Validator，Bean Validation API，Classmate和JBoss Logging的代码库以及调用Bean Validation的代码库分配多个权限。</font><font style="vertical-align: inherit;">以下显示了如何通过</font><font style="vertical-align: inherit;">Java默认策略实现处理</font><font style="vertical-align: inherit;">的</font></font><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行此操作：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1.4：使用Hibernate Validator和安全管理器的策略文件</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="pln">grant codeBase </span><span class="str">"file:path/to/hibernate-validator-6.0.13.Final.jar"</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    permission java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">reflect</span><span class="pun">.</span><span class="typ">ReflectPermission</span><span class="pln"> </span><span class="str">"suppressAccessChecks"</span><span class="pun">;</span><span class="pln">
    permission java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">RuntimePermission</span><span class="pln"> </span><span class="str">"accessDeclaredMembers"</span><span class="pun">;</span><span class="pln">
    permission java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">RuntimePermission</span><span class="pln"> </span><span class="str">"setContextClassLoader"</span><span class="pun">;</span><span class="pln">

    permission org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="typ">HibernateValidatorPermission</span><span class="pln"> </span><span class="str">"accessPrivateMembers"</span><span class="pun">;</span><span class="pln">

    </span><span class="com">// Only needed when working with XML descriptors (validation.xml or XML constraint mappings)</span><span class="pln">
    permission java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">PropertyPermission</span><span class="pln"> </span><span class="str">"mapAnyUriToUri"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"read"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

grant codeBase </span><span class="str">"file:path/to/validation-api-2.0.1.Final.jar"</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    permission java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">FilePermission</span><span class="pln"> </span><span class="str">"path/to/hibernate-validator-6.0.13.Final.jar"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"read"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

grant codeBase </span><span class="str">"file:path/to/jboss-logging-3.3.2.Final.jar"</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    permission java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">PropertyPermission</span><span class="pln"> </span><span class="str">"org.jboss.logging.provider"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"read"</span><span class="pun">;</span><span class="pln">
    permission java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">PropertyPermission</span><span class="pln"> </span><span class="str">"org.jboss.logging.locale"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"read"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

grant codeBase </span><span class="str">"file:path/to/classmate-1.3.4.jar"</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    permission java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">RuntimePermission</span><span class="pln"> </span><span class="str">"accessDeclaredMembers"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

grant codeBase </span><span class="str">"file:path/to/validation-caller-x.y.z.jar"</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    permission org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="typ">HibernateValidatorPermission</span><span class="pln"> </span><span class="str">"accessPrivateMembers"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">};</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_updating_hibernate_validator_in_wildfly"><a class="anchor" href="#_updating_hibernate_validator_in_wildfly"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.4。</font><font style="vertical-align: inherit;">在WildFly中更新Hibernate Validator</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><a href="http://wildfly.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WildFly应用服务器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含Hibernate验证开箱。</font><font style="vertical-align: inherit;">为了将Bean Validation API和Hibernate Validator的服务器模块更新到最新和最好，可以使用WildFly的补丁机制。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以</font><font style="vertical-align: inherit;">使用以下依赖项</font><font style="vertical-align: inherit;">从</font></font><a href="http://sourceforge.net/projects/hibernate/files/hibernate-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SourceForge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或Maven Central </font><font style="vertical-align: inherit;">下载修补程序文件</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1.5：WildFly 14.0.0.Beta1补丁文件的Maven依赖</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;dependency&gt;</span><span class="pln">
    </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.hibernate.validator</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
    </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">hibernate-validator-modules</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
    </span><span class="tag">&lt;version&gt;</span><span class="pln">6.0.13.Final</span><span class="tag">&lt;/version&gt;</span><span class="pln">
    </span><span class="tag">&lt;classifier&gt;</span><span class="pln">wildfly-14.0.0.Beta1-patch</span><span class="tag">&lt;/classifier&gt;</span><span class="pln">
    </span><span class="tag">&lt;type&gt;</span><span class="pln">zip</span><span class="tag">&lt;/type&gt;</span><span class="pln">
</span><span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还为WildFly 13.0.0提供了一个补丁。最后：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1.6：WildFly 13.0.0.Final补丁文件的Maven依赖</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;dependency&gt;</span><span class="pln">
    </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.hibernate.validator</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
    </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">hibernate-validator-modules</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
    </span><span class="tag">&lt;version&gt;</span><span class="pln">6.0.13.Final</span><span class="tag">&lt;/version&gt;</span><span class="pln">
    </span><span class="tag">&lt;classifier&gt;</span><span class="pln">wildfly-13.0.0.Final-patch</span><span class="tag">&lt;/classifier&gt;</span><span class="pln">
    </span><span class="tag">&lt;type&gt;</span><span class="pln">zip</span><span class="tag">&lt;/type&gt;</span><span class="pln">
</span><span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载了补丁文件后，您可以通过运行以下命令将其应用于WildFly：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1.7：应用WildFly补丁</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="pln">$JBOSS_HOME</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">jboss</span><span class="pun">-</span><span class="pln">cli</span><span class="pun">.</span><span class="pln">sh patch apply hibernate</span><span class="pun">-</span><span class="pln">validator</span><span class="pun">-</span><span class="pln">modules</span><span class="pun">-</span><span class="lit">6.0</span><span class="pun">.</span><span class="lit">13.Final</span><span class="pun">-</span><span class="pln">wildfly</span><span class="pun">-</span><span class="lit">14.0</span><span class="pun">.</span><span class="lit">0.Beta1</span><span class="pun">-</span><span class="pln">patch</span><span class="pun">.</span><span class="pln">zip</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要撤消修补程序并返回最初随服务器一起提供的Hibernate Validator版本，请运行以下命令：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1.8：回滚WildFly补丁</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="pln">$JBOSS_HOME</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">jboss</span><span class="pun">-</span><span class="pln">cli</span><span class="pun">.</span><span class="pln">sh patch rollback </span><span class="pun">--</span><span class="pln">reset</span><span class="pun">-</span><span class="pln">configuration</span><span class="pun">=</span><span class="kwd">true</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以在</font></font><a href="https://developer.jboss.org/wiki/SingleInstallationPatching/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="http://www.mastertheboss.com/jboss-server/jboss-configuration/managing-wildfly-and-eap-patches"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解有关WildFly修补基础结构的更多信息</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="validator-gettingstarted-java9"><a class="anchor" href="#validator-gettingstarted-java9"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.5。</font><font style="vertical-align: inherit;">在Java 9上运行</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从Hibernate Validator 6.0.13.Final开始，对Java 9和Java平台模块系统（JPMS）的支持是实验性的。</font><font style="vertical-align: inherit;">目前还没有提供JPMS模块描述符，但Hibernate Validator可用作自动模块。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些是使用</font></font><code>Automatic-Module-Name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标头</font><font style="vertical-align: inherit;">声明的模块名称</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean验证API： </font></font><code>java.validation</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator核心： </font></font><code>org.hibernate.validator</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator CDI扩展： </font></font><code>org.hibernate.validator.cdi</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator测试实用程序： </font></font><code>org.hibernate.validator.testutils</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator注释处理器： </font></font><code>org.hibernate.validator.annotationprocessor</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些模块名称是初步的，在将来的版本中提供真实的模块描述符时可能会更改。</font></font></p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将Hibernate Validator与CDI一起使用时，请注意不要启用</font></font><code>java.xml.ws.annotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JDK </font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">模块。</font><font style="vertical-align: inherit;">此模块包含JSR 250 API的一个子集（“Commons Annotations”），但</font></font><code>javax.annotation.Priority</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缺少</font><font style="vertical-align: inherit;">某些注释</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这会导致Hibernate Validator的方法验证拦截器无法注册，即方法验证不起作用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相反，将完整的JSR 250 API添加到未命名的模块（即类路径），例如通过引入</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javax.annotation：javax.annotation-api</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依赖项（当依赖于</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，已经存在对JSR 250 API的传递依赖性</font><em><font style="vertical-align: inherit;">。 hibernate.validator：hibernate-validator-cdi</font></em><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>java.xml.ws.annotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于某种原因</font><font style="vertical-align: inherit;">需要启用</font><font style="vertical-align: inherit;">模块，则应通过附加</font></font><code>--patch-module java.xml.ws.annotation=/path/to/complete-jsr250-api.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">java</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">来</font><font style="vertical-align: inherit;">使用完整API的内容对其进行修补</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validator-gettingstarted-createmodel"><a class="anchor" href="#validator-gettingstarted-createmodel"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2。</font><font style="vertical-align: inherit;">应用约束</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们直接进入一个示例，了解如何应用约束。</font></font></p>
</div>
<div id="example-class-car" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1.9：使用约束注释的Class Car</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter01</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constraints</span><span class="pun">.</span><span class="typ">Min</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constraints</span><span class="pun">.</span><span class="typ">NotNull</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constraints</span><span class="pun">.</span><span class="typ">Size</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> max </span><span class="pun">=</span><span class="pln"> </span><span class="lit">14</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licensePlate</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Min</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licencePlate</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">licensePlate </span><span class="pun">=</span><span class="pln"> licencePlate</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">seatCount </span><span class="pun">=</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>@Size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>@Min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注解用于声明应施加到汽车实例的字段中的限制：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>manufacturer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 绝对不能 </font></font><code>null</code></p>
</li>
<li>
<p><code>licensePlate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝不能是，</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">且必须长度在2到14个字符之间</font></font></p>
</li>
<li>
<p><code>seatCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 必须至少2</font></font></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以</font><font style="vertical-align: inherit;">
在GitHub上</font><font style="vertical-align: inherit;">的Hibernate Validator </font></font><a href="https://github.com/hibernate/hibernate-validator/tree/master/documentation/src/test"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源存储库</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中找到</font><font style="vertical-align: inherit;">本参考指南中使用的所有示例的完整源代码
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_validating_constraints"><a class="anchor" href="#_validating_constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3。</font><font style="vertical-align: inherit;">验证约束</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要执行这些约束的验证，请使用</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font><font style="vertical-align: inherit;">让我们来看一下单元测试</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例1.10：CarTest类显示验证示例</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter01</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Set</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">ConstraintViolation</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">Validation</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">Validator</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">ValidatorFactory</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">junit</span><span class="pun">.</span><span class="typ">BeforeClass</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">junit</span><span class="pun">.</span><span class="typ">Test</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">junit</span><span class="pun">.</span><span class="typ">Assert</span><span class="pun">.</span><span class="pln">assertEquals</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CarTest</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Validator</span><span class="pln"> validator</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@BeforeClass</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setUpValidator</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">ValidatorFactory</span><span class="pln"> factory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">buildDefaultValidatorFactory</span><span class="pun">();</span><span class="pln">
        validator </span><span class="pun">=</span><span class="pln"> factory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Test</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> manufacturerIsNull</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="str">"DD-AB-123"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln">
                validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

        assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"must not be null"</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Test</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> licensePlateTooShort</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"D"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln">
                validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

        assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        assertEquals</span><span class="pun">(</span><span class="pln">
                </span><span class="str">"size must be between 2 and 14"</span><span class="pun">,</span><span class="pln">
                constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Test</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> seatCountTooLow</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"DD-AB-123"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln">
                validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

        assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        assertEquals</span><span class="pun">(</span><span class="pln">
                </span><span class="str">"must be greater than or equal to 2"</span><span class="pun">,</span><span class="pln">
                constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Test</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> carIsValid</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"DD-AB-123"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln">
                validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

        assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在该</font></font><code>setUp()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法中，</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从中检索对象</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">一个</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实例是线程安全的，可重复使用多次。</font><font style="vertical-align: inherit;">因此，它可以安全地存储在静态字段中，并在测试方法中用于验证不同的</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法返回一组</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例，您可以迭代这些实例以查看发生了哪些验证错误。</font><font style="vertical-align: inherit;">前三种测试方法显示了一些预期的约束违规：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对约束</font></font><code>manufacturer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的违反</font></font><code>manufacturerIsNull()</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>@Size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对约束</font></font><code>licensePlate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的违反</font></font><code>licensePlateTooShort()</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>@Min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对约束</font></font><code>seatCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的违反</font></font><code>seatCountTooLow()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果对象成功验证，则</font></font><code>validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回一个空集，如您所见</font></font><code>carIsValid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，仅</font></font><code>javax.validation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">包</font><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些是从Bean Validation API提供的。</font><font style="vertical-align: inherit;">不直接引用Hibernate Validator中的类，从而产生可移植代码。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="validator-gettingstarted-whatsnext"><a class="anchor" href="#validator-gettingstarted-whatsnext"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.4。</font><font style="vertical-align: inherit;">下一步去哪儿？</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束了通过Hibernate Validator和Bean验证世界的5分钟之旅。</font><font style="vertical-align: inherit;">继续探索代码示例或查看</font></font><a href="#validator-further-reading"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第14章“ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进一步阅读”中</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用的更多示例
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要了解有关bean和属性验证的更多信息，请继续阅读
 </font></font><a href="#chapter-bean-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明和验证bean约束</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您有兴趣使用Bean Validation来验证方法前后条件，请参阅</font></font><a href="#chapter-method-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明和验证方法约束</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您的应用程序具有特定的验证要求</font></font><a href="#validator-customconstraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参阅</font></font></em></a><font style="vertical-align: inherit;"><a href="#validator-customconstraints"><font style="vertical-align: inherit;">第6章，</font></a><a href="#validator-customconstraints"><em><font style="vertical-align: inherit;">创建自定义约束</font></em></a><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapter-bean-constraints"><a class="anchor" href="#chapter-bean-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.声明和验证bean约束</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本章中，您将学习如何声明（参见</font></font><a href="#section-declaring-bean-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.1节“声明bean约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和验证（参见</font></font><a href="#section-validating-bean-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.2节“验证bean约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）bean约束。
</font></font><a href="#section-builtin-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.3节“内置约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概述了Hibernate Validator随附的所有内置约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您对将约束应用于方法参数和返回值感兴趣，请参阅
 </font></font><a href="#chapter-method-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明和验证方法约束</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect2">
<h3 id="section-declaring-bean-constraints"><a class="anchor" href="#section-declaring-bean-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1。</font><font style="vertical-align: inherit;">声明bean约束</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean验证中的约束通过Java注释表示。</font><font style="vertical-align: inherit;">在本节中，您将学习如何使用这些注释增强对象模型。</font><font style="vertical-align: inherit;">bean约束有四种类型：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">场限制</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">财产限制</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">容器元素约束</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类约束</font></font></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并非所有约束都可以放在所有这些级别上。</font><font style="vertical-align: inherit;">实际上，Bean Validation定义的默认约束都不能放在类级别。</font><font style="vertical-align: inherit;">的</font></font><code>java.lang.annotation.Target</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在约束注释本身注释确定在其上的元件的约束可以被放置。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息</font></font><a href="#validator-customconstraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em><font style="vertical-align: inherit;"></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见
 </font><a href="#validator-customconstraints"><font style="vertical-align: inherit;">第6章，</font></a><a href="#validator-customconstraints"><em><font style="vertical-align: inherit;">创建自定义约束</font></em></a><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_field_level_constraints"><a class="anchor" href="#_field_level_constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.1。</font><font style="vertical-align: inherit;">字段级约束</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束可以通过注释类的字段来表达。</font></font><a href="#example-field-level"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.1，“字段级约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了字段级配置示例：</font></font></p>
</div>
<div id="example-field-level" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.1：字段级约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">fieldlevel</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@AssertTrue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isRegistered</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isRegistered</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isRegistered </span><span class="pun">=</span><span class="pln"> isRegistered</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//getters and setters...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用字段级约束时，字段访问策略用于访问要验证的值。</font><font style="vertical-align: inherit;">这意味着验证引擎直接访问实例变量，即使存在这样的访问器，也不会调用属性访问器方法。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束可以应用于任何访问类型的字段（公共，私有等）。</font><font style="vertical-align: inherit;">但是，不支持对静态字段的约束。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在验证字节码增强对象时，应使用属性级别约束，因为字节码增强库将无法通过反射确定字段访问。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_property_level_constraints"><a class="anchor" href="#_property_level_constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.2。</font><font style="vertical-align: inherit;">属性级约束</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果模型类遵循
 </font></font><a href="http://www.oracle.com/technetwork/articles/javaee/spec-136004.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaBeans</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准，则还可以注释bean类的属性而不是其字段。
</font></font><a href="#example-property-level"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.2，“属性级约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用与</font></font><a href="#example-field-level"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.1“字段级约束”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同的实体</font><font style="vertical-align: inherit;">，但是，使用属性级约束。</font></font></p>
</div>
<div id="example-property-level" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.2：属性级约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">propertylevel</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isRegistered</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isRegistered</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isRegistered </span><span class="pun">=</span><span class="pln"> isRegistered</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getManufacturer</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setManufacturer</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@AssertTrue</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isRegistered</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> isRegistered</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setRegistered</span><span class="pun">(</span><span class="kwd">boolean</span><span class="pln"> isRegistered</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isRegistered </span><span class="pun">=</span><span class="pln"> isRegistered</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性的getter方法必须注释，而不是它的setter。</font><font style="vertical-align: inherit;">这样也可以约束只读属性，它们没有setter方法。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用属性级别约束时，属性访问策略用于访问要验证的值，即验证引擎通过属性访问器方法访问状态。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议</font><font style="vertical-align: inherit;">在一个类中</font><font style="vertical-align: inherit;">坚持字段</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性注释。</font><font style="vertical-align: inherit;">建议不要注释字段</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附带的getter方法，因为这会导致字段被验证两次。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="container-element-constraints"><a class="anchor" href="#container-element-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.3。</font><font style="vertical-align: inherit;">容器元素约束</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以直接在参数化类型的类型参数上指定约束：这些约束称为容器元素约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这需要</font><font style="vertical-align: inherit;">
在约束定义中</font></font><code>ElementType.TYPE_USE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定</font></font><code>@Target</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从Bean Validation 2.0开始，内置Bean验证以及Hibernate Validator特定约束指定</font></font><code>ElementType.TYPE_USE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并可直接在此上下文中使用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator验证在以下标准Java容器上指定的容器元素约束：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的实现方式</font></font><code>java.util.Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（例如</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S，</font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S），</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font></font><code>java.util.Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，支持键和值，</font></font></p>
</li>
<li>
<p><code>java.util.Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.util.OptionalInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.util.OptionalDouble</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.util.OptionalLong</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaFX的各种实现</font></font><code>javafx.beans.observable.ObservableValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它还支持自定义容器类型的容器元素约束（请参阅</font></font><a href="#chapter-valueextraction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值提取</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在6之前的版本中，支持容器元素约束的子集。</font><font style="vertical-align: inherit;">一个</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释是需要在容器级别启用它们。</font><font style="vertical-align: inherit;">从Hibernate Validator 6开始，这不再是必需的。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在下面给出几个示例，说明各种Java类型的容器元素约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这些示例中，</font></font><code>@ValidPart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是允许在</font></font><code>TYPE_USE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文中</font><font style="vertical-align: inherit;">使用的自定义约束</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect4">
<h5 id="_with_code_iterable_code"><a class="anchor" href="#_with_code_iterable_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.3.1。</font><font style="vertical-align: inherit;">同</font></font><code>Iterable</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型参数</font><font style="vertical-align: inherit;">上应用约束时</font><font style="vertical-align: inherit;">，Hibernate Validator将验证每个元素。</font></font><a href="#example-container-element-constraints-iterable"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2.3，“容器元素约束</font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示</font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有容器元素约束</font><font style="vertical-align: inherit;">的a的示例
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-container-element-constraints-iterable" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.3：容器元素约束 </font></font><code>Set</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">HashSet</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Set</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Set</span><span class="pun">&lt;</span><span class="lit">@ValidPart</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> parts </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashSet</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addPart</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> part</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        parts</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> part </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">();</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">addPart</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Wheel"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">addPart</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> constraintViolation </span><span class="pun">=</span><span class="pln">
        constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"'null' is not a valid car part."</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"parts[].&lt;iterable element&gt;"</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getPropertyPath</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意属性路径如何清楚地指出违规来自iterable的元素。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="_with_code_list_code"><a class="anchor" href="#_with_code_list_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.3.2。</font><font style="vertical-align: inherit;">同</font></font><code>List</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型参数</font><font style="vertical-align: inherit;">上应用约束时</font><font style="vertical-align: inherit;">，Hibernate Validator将验证每个元素。</font></font><a href="#example-container-element-constraints-list"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.4，“容器元素约束</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有容器元素约束</font><font style="vertical-align: inherit;">的a的示例
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-container-element-constraints-list" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.4：容器元素约束 </font></font><code>List</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">.</span><span class="pln">list</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="lit">@ValidPart</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> parts </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addPart</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> part</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        parts</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> part </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">();</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">addPart</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Wheel"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">addPart</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> constraintViolation </span><span class="pun">=</span><span class="pln">
        constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"'null' is not a valid car part."</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"parts[1].&lt;list element&gt;"</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getPropertyPath</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里，属性路径还包含无效元素的索引。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="_with_code_map_code"><a class="anchor" href="#_with_code_map_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.3.3。</font><font style="vertical-align: inherit;">同</font></font><code>Map</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">容器元素约束也在地图键和值上得到验证。
</font></font><a href="#example-container-element-constraints-map"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2.5，“映射键和值上的容器元素约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对键具有约束和对值的约束</font><font style="vertical-align: inherit;">的示例</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-container-element-constraints-map" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2.5：映射键和值的容器元素约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">.</span><span class="pln">map</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">HashMap</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Map</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constraints</span><span class="pun">.</span><span class="typ">NotNull</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">FuelConsumption</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        CITY</span><span class="pun">,</span><span class="pln">
        HIGHWAY
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">FuelConsumption</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@MaxAllowedFuelConsumption</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> fuelConsumption </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setFuelConsumption</span><span class="pun">(</span><span class="typ">FuelConsumption</span><span class="pln"> consumption</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        fuelConsumption</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> consumption</span><span class="pun">,</span><span class="pln"> value </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">();</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">setFuelConsumption</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="typ">FuelConsumption</span><span class="pun">.</span><span class="pln">HIGHWAY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> constraintViolation </span><span class="pun">=</span><span class="pln">
        constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"20 is outside the max fuel consumption."</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"fuelConsumption[HIGHWAY].&lt;map value&gt;"</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getPropertyPath</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">();</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">setFuelConsumption</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> constraintViolation </span><span class="pun">=</span><span class="pln">
        constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"must not be null"</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"fuelConsumption&lt;K&gt;[].&lt;map key&gt;"</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getPropertyPath</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">违规的财产路径特别有趣：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效元素的键包含在属性路径中（在第二个示例中，键是</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个例子中，违规涉及</font></font><code>&lt;map value&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到第二个</font><font style="vertical-align: inherit;">例子</font></font><code>&lt;map key&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第二个示例中，您可能已经注意到类型参数的存在，</font></font><code>&lt;K&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稍后将对此进行更多介绍。</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_with_code_java_util_optional_code"><a class="anchor" href="#_with_code_java_util_optional_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.3.4。</font><font style="vertical-align: inherit;">同</font></font><code>java.util.Optional</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在类型参数上应用约束时</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，Hibernate Validator将自动解包该类型并验证内部值。</font></font><a href="#example-container-element-constraints-optional"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2.6，“可选的容器元素约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有容器元素约束</font><font style="vertical-align: inherit;">的示例</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-container-element-constraints-optional" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.6：可选的容器元素约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">.</span><span class="pln">optional</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Optional</span><span class="pun">&lt;</span><span class="lit">@MinTowingCapacity</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> towingCapacity </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Optional</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setTowingCapacity</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> </span><span class="kwd">alias</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        towingCapacity </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Optional</span><span class="pun">.</span><span class="pln">of</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">alias</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">();</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">setTowingCapacity</span><span class="pun">(</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> constraintViolation </span><span class="pun">=</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"Not enough towing capacity."</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"towingCapacity"</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getPropertyPath</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里，属性路径只包含属性的名称，因为我们正在考虑将其</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为“透明”容器。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="_with_custom_container_types"><a class="anchor" href="#_with_custom_container_types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.3.5。</font><font style="vertical-align: inherit;">使用自定义容器类型</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">容器元素约束也可以与自定义容器一起使用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须为自定义类型注册</font><font style="vertical-align: inherit;">A </font><font style="vertical-align: inherit;">，以便检索要验证的值（</font><font style="vertical-align: inherit;">有关如何实现自己</font><font style="vertical-align: inherit;">以及如何注册的</font><font style="vertical-align: inherit;">更多信息</font></font><a href="#chapter-valueextraction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em><font style="vertical-align: inherit;"></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅</font><a href="#chapter-valueextraction"><font style="vertical-align: inherit;">第7章，</font></a><a href="#chapter-valueextraction"><em><font style="vertical-align: inherit;">值提取</font></em></a></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#example-container-element-constraints-custom-container-type"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2.7，“自定义容器类型上的容器元素约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了带有类型参数约束的自定义参数化类型的示例。</font></font></p>
</div>
<div id="example-container-element-constraints-custom-container-type" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.7：自定义容器类型的容器元素约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">.</span><span class="pln">custom</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">GearBox</span><span class="pun">&lt;</span><span class="lit">@MinTorque</span><span class="pun">(</span><span class="lit">100</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Gear</span><span class="pun">&gt;</span><span class="pln"> gearBox</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setGearBox</span><span class="pun">(</span><span class="typ">GearBox</span><span class="pun">&lt;</span><span class="typ">Gear</span><span class="pun">&gt;</span><span class="pln"> gearBox</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">gearBox </span><span class="pun">=</span><span class="pln"> gearBox</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">.</span><span class="pln">custom</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GearBox</span><span class="pun">&lt;</span><span class="pln">T </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Gear</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> T gear</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">GearBox</span><span class="pun">(</span><span class="pln">T gear</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">gear </span><span class="pun">=</span><span class="pln"> gear</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Gear</span><span class="pln"> getGear</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">gear</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">.</span><span class="pln">custom</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Gear</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> torque</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Gear</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> torque</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">torque </span><span class="pun">=</span><span class="pln"> torque</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> getTorque</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> torque</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">AcmeGear</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Gear</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">AcmeGear</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> </span><span class="lit">60</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">.</span><span class="pln">custom</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GearBoxValueExtractor</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ValueExtractor</span><span class="pun">&lt;</span><span class="typ">GearBox</span><span class="pun">&lt;</span><span class="lit">@ExtractedValue</span><span class="pln"> </span><span class="pun">?&gt;&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> extractValues</span><span class="pun">(</span><span class="typ">GearBox</span><span class="pun">&lt;</span><span class="lit">@ExtractedValue</span><span class="pln"> </span><span class="pun">?&gt;</span><span class="pln"> originalValue</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ValueExtractor</span><span class="pun">.</span><span class="typ">ValueReceiver</span><span class="pln"> receiver</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        receiver</span><span class="pun">.</span><span class="pln">value</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> originalValue</span><span class="pun">.</span><span class="pln">getGear</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">();</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">setGearBox</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GearBox</span><span class="pun">&lt;&gt;(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Gear</span><span class="pun">.</span><span class="typ">AcmeGear</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> constraintViolation </span><span class="pun">=</span><span class="pln">
        constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"Gear is not providing enough torque."</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"gearBox"</span><span class="pun">,</span><span class="pln">
        constraintViolation</span><span class="pun">.</span><span class="pln">getPropertyPath</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_nested_container_elements"><a class="anchor" href="#_nested_container_elements"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.3.6。</font><font style="vertical-align: inherit;">嵌套的容器元素</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套容器元素也支持约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在验证</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象时，如</font></font><a href="#example-container-element-nested"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2.8，“嵌套容器元素上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
约束</font><a href="#example-container-element-nested"><font style="vertical-align: inherit;">”中所示</font></a><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">对</font></font><code>Part</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Manufacturer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将强制执行</font><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-container-element-nested" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2.8：嵌套容器元素的约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">.</span><span class="pln">nested</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">HashMap</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">List</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Map</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constraints</span><span class="pun">.</span><span class="typ">NotNull</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">Part</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">Manufacturer</span><span class="pun">&gt;&gt;</span><span class="pln"> partManufacturers </span><span class="pun">=</span><span class="pln">
            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="validator-usingvalidator-classlevel"><a class="anchor" href="#validator-usingvalidator-classlevel"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.4。</font><font style="vertical-align: inherit;">类级约束</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后但并非最不重要的是，约束也可以放在类级别上。</font><font style="vertical-align: inherit;">在这种情况下，不是单个属性是验证的主题，而是完整的对象。</font><font style="vertical-align: inherit;">如果验证取决于对象的多个属性之间的相关性，则类级约束很有用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><a href="#example-class-level"><font style="vertical-align: inherit;">例2.9中</font></a><font style="vertical-align: inherit;">的</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font><a href="#example-class-level"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“类级别约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有两个属性</font></font><code>seatCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>passengers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且应该确保乘客列表没有比可用座位更多的条目。</font><font style="vertical-align: inherit;">为此，</font></font><code>@ValidPassengerCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在类级别添加约束。</font><font style="vertical-align: inherit;">该约束的验证器可以访问完整的</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象，允许比较座位和乘客的数量。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅</font></font><a href="#section-class-level-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2节“类级别约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以详细了解如何实现此自定义约束。</font></font></p>
</div>
<div id="example-class-level" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.9：类级约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">classlevel</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@ValidPassengerCount</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> passengers</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="section-constraint-inheritance"><a class="anchor" href="#section-constraint-inheritance"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.5。</font><font style="vertical-align: inherit;">约束继承</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当类实现接口或扩展另一个类时，在超类型上声明的所有约束注释都以与类本身上指定的约束相同的方式应用。</font><font style="vertical-align: inherit;">为了使事情更清楚，让我们看看下面的例子：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.10：约束继承</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">inheritance</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getManufacturer</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">inheritance</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> rentalStation</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getRentalStation</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> rentalStation</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里的类</font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个子类，</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并添加了属性</font></font><code>rentalStation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证</font><font style="vertical-align: inherit;">了实例，
 </font><font style="vertical-align: inherit;">则不仅</font><font style="vertical-align: inherit;">会评估</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font></font><code>rentalStation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，还会评估</font></font><code>manufacturer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">父类</font><font style="vertical-align: inherit;">的约束</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是超类，而是由实现的接口，情况也是如此</font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果重写方法，则会聚合约束注释。</font><font style="vertical-align: inherit;">因此，如果</font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖
 </font></font><code>getManufacturer()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，除了</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自超类</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">之外，还将评估在重写方法上注释的任何约束</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="section-object-graph-validation"><a class="anchor" href="#section-object-graph-validation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.1.6。</font><font style="vertical-align: inherit;">对象图</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation API不仅允许验证单个类实例，还允许完成对象图（级联验证）。</font><font style="vertical-align: inherit;">为此，只需注释表示对另一个对象的引用的字段或属性，</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font></font><a href="#example-cascaded-validation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.11“级联验证”中所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-cascaded-validation" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.11：级联验证</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">objectgraph</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Valid</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> driver</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">objectgraph</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证</font><font style="vertical-align: inherit;">了实例，</font><font style="vertical-align: inherit;">则</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也会验证</font><font style="vertical-align: inherit;">引用的</font><font style="vertical-align: inherit;">对象，因为该
 </font></font><code>driver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段是使用注释的</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">字段是，</font><font style="vertical-align: inherit;">则验证</font><font style="vertical-align: inherit;">将失败</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象图的验证是递归的，即如果标记为级联验证的引用指向其自身具有注释属性的对象</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则这些引用也将由验证引擎跟进。</font><font style="vertical-align: inherit;">验证引擎将确保在级联验证期间不会发生无限循环，例如，如果两个对象彼此保持引用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在级联验证期间会忽略值。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为约束，对象图验证也适用于容器元素。</font><font style="vertical-align: inherit;">这意味着容器的任何类型参数都可以使用注释</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这将导致在验证父对象时验证每个包含的元素。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套容器元素也支持级联验证。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="example-cascaded-validation-list" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.12：容器的级联验证</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">objectgraph</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="lit">@NotNull</span><span class="pln"> </span><span class="lit">@Valid</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> passengers </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;();</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="lit">@Valid</span><span class="pln"> </span><span class="typ">Part</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="lit">@Valid</span><span class="pln"> </span><span class="typ">Manufacturer</span><span class="pun">&gt;&gt;</span><span class="pln"> partManufacturers </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">objectgraph</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Part</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter02</span><span class="pun">.</span><span class="pln">objectgraph</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Manufacturer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证</font><a href="#example-cascaded-validation-list"><font style="vertical-align: inherit;">例2.12“容器的级联验证”中</font></a></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">的实例时</font><font style="vertical-align: inherit;">，
 </font><font style="vertical-align: inherit;">将创建一个：</font></font><a href="#example-cascaded-validation-list"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">乘客名单中包含的</font><font style="vertical-align: inherit;">任何</font><font style="vertical-align: inherit;">物品有</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称;</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>Part</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地图键中包含的</font><font style="vertical-align: inherit;">任何</font><font style="vertical-align: inherit;">对象具有</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称;</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>Manufacturer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌套在地图值中的列表中包含的</font><font style="vertical-align: inherit;">任何</font><font style="vertical-align: inherit;">对象具有</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称。</font></font></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在6之前的版本中，Hibernate Validator支持容器元素子集的级联验证，并且它是在容器级别实现的（例如，您将用于</font></font><code>@Valid private List&lt;Person&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用级联验证</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这仍然受支持，但不建议这样做。</font><font style="vertical-align: inherit;">请使用容器元素级别</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释，因为它更具表现力。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-validating-bean-constraints"><a class="anchor" href="#section-validating-bean-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2。</font><font style="vertical-align: inherit;">验证bean约束</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口在Bean验证中最重要的对象。</font><font style="vertical-align: inherit;">下一节将介绍如何获取</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font><font style="vertical-align: inherit;">之后，您将学习如何使用</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">界面</font><font style="vertical-align: inherit;">的不同方法
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect3">
<h4 id="section-obtaining-validator"><a class="anchor" href="#section-obtaining-validator"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.1。</font><font style="vertical-align: inherit;">获取</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证实体实例的第一步是获取</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font><font style="vertical-align: inherit;">这个实例的道路通过</font></font><code>Validation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">班级和a </font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最简单的方法是使用静态方法</font></font><code>Validation#buildDefaultValidatorFactory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.13： </font></font><code>Validation#buildDefaultValidatorFactory()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> factory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">buildDefaultValidatorFactory</span><span class="pun">();</span><span class="pln">
validator </span><span class="pun">=</span><span class="pln"> factory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将在默认配置中引导验证器。</font><font style="vertical-align: inherit;">请参阅</font></font><a href="#chapter-bootstrapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bootstrapping</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以了解有关不同引导方法以及如何获取特定配置
 </font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例的更多信息。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="_validator_methods"><a class="anchor" href="#_validator_methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.2。</font><font style="vertical-align: inherit;">验证方法</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口包含三种方法，可用于验证整个实体或仅实体的单个属性。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这三种方法都返回了一个</font></font><code>Set&lt;ConstraintViolation&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果验证成功，则该集为空。</font><font style="vertical-align: inherit;">否则，</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个违反的约束添加</font><font style="vertical-align: inherit;">一个</font><font style="vertical-align: inherit;">实例。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有验证方法都有一个var-args参数，可用于指定执行验证时应考虑哪些验证组。</font><font style="vertical-align: inherit;">如果未指定参数，则使用默认验证组（</font></font><code>javax.validation.groups.Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><a href="#chapter-groups"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章“ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组约束”</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中详细讨论了验证组的主题</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect4">
<h5 id="_code_validator_validate_code"><a class="anchor" href="#_code_validator_validate_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.2.1。 </font></font><code>Validator#validate()</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该</font></font><code>validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法执行给定bean的所有约束的验证。
</font></font><a href="#example-validator-validate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.14，“使用</font></font><code>Validator#validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了</font><a href="#example-property-level"><font style="vertical-align: inherit;">例2.2中“类属性约束”</font></a><font style="vertical-align: inherit;">的</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类
 </font><font style="vertical-align: inherit;">实例的验证，</font><font style="vertical-align: inherit;">它不能满足</font><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">
属性</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此验证调用返回一个</font><font style="vertical-align: inherit;">对象。</font></font><a href="#example-property-level"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code>@NotNull</code><font style="vertical-align: inherit;"></font><code>manufacturer</code><font style="vertical-align: inherit;"></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"></font></p>
</div>
<div id="example-validator-validate" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.14：使用 </font></font><code>Validator#validate()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"must not be null"</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_validator_validateproperty_code"><a class="anchor" href="#_code_validator_validateproperty_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.2.2。 </font></font><code>Validator#validateProperty()</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">借助于</font></font><code>validateProperty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以验证给定对象的单个命名属性。</font><font style="vertical-align: inherit;">属性名称是JavaBeans属性名称。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.15：使用 </font></font><code>Validator#validateProperty()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validateProperty</span><span class="pun">(</span><span class="pln">
        car</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"manufacturer"</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"must not be null"</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_validator_validatevalue_code"><a class="anchor" href="#_code_validator_validatevalue_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.2.3。 </font></font><code>Validator#validateValue()</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用该</font></font><code>validateValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，您可以检查给定类的单个属性是否可以成功验证，如果该属性具有指定的值：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.16：使用 </font></font><code>Validator#validateValue()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validateValue</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"manufacturer"</span><span class="pun">,</span><span class="pln">
        </span><span class="kwd">null</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"must not be null"</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不被</font></font><code>validateProperty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font><font style="vertical-align: inherit;">尊重</font></font><code>validateValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>Validator#validateProperty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，用于将Bean Validation集成到JSF 2中（请参见</font></font><a href="#section-presentation-layer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第11.2节“JSF和Seam”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），以便在将表单中的值传播到模型之前对其进行验证。</font></font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="section-constraint-violation-methods"><a class="anchor" href="#section-constraint-violation-methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.3。 </font></font><code>ConstraintViolation</code></h4>
<div class="sect4">
<h5 id="_code_constraintviolation_code_methods"><a class="anchor" href="#_code_constraintviolation_code_methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.3.1。</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在是时候仔细看看是什么了</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以确定使用关于验证失败原因的许多有用信息</font><font style="vertical-align: inherit;">的不同方法</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下概述了这些方法。</font><font style="vertical-align: inherit;">“示例”列下的值参见</font></font><a href="#example-validator-validate"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例2.14“使用</font></font><code>Validator#validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>getMessage()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插值的错误消息</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“一定不能为空”</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>getMessageTemplate()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非插值错误消息</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“{... NotNull.message}”</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>getRootBean()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在验证的根bean</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汽车</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>getRootBeanClass()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在验证的根bean的类</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></dt>
<dd>
<p><code>Car.class</code></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>getLeafBean()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果是bean约束，则应用约束的bean实例; </font><font style="vertical-align: inherit;">如果是属性约束，则托管应用约束的属性的bean实例</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></dt>
<dd>
<p><code>car</code></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>getPropertyPath()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从root bean获取验证值的属性路径</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含一个类型</font></font><code>PROPERTY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和名称“制造商”的</font><font style="vertical-align: inherit;">节点</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>getInvalidValue()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值无法通过约束</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></dt>
<dd>
<p><code>null</code></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>getConstraintDescriptor()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告的约束元数据失败</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述符 </font></font><code>@NotNull</code></p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_exploiting_the_property_path"><a class="anchor" href="#_exploiting_the_property_path"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.3.2。</font><font style="vertical-align: inherit;">利用属性路径</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要确定触发违规的元素，您需要利用该</font></font><code>getPropertyPath()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法</font><font style="vertical-align: inherit;">的结果</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回的</font></font><code>Path</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是由</font></font><code>Node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述元素路径</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">s </font><font style="vertical-align: inherit;">组成</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关其结构</font></font><code>Path</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和各种类型的</font><font style="vertical-align: inherit;">更多信息</font></font><code>Node</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以</font><font style="vertical-align: inherit;">在Bean Validation规范</font></font><a href="http://beanvalidation.org/2.0/spec/#validationapi-constraintviolation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">找到
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-builtin-constraints"><a class="anchor" href="#section-builtin-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3。</font><font style="vertical-align: inherit;">内置约束</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator包含一组基本的常用约束。</font><font style="vertical-align: inherit;">这些最重要的是Bean Validation规范定义的约束（参见</font></font><a href="#validator-defineconstraints-spec"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.3.1节“Bean验证约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">此外，Hibernate Validator提供了有用的自定义约束（请参见
 </font></font><a href="#validator-defineconstraints-hv-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.3.2节“其他约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="sect3">
<h4 id="validator-defineconstraints-spec"><a class="anchor" href="#validator-defineconstraints-spec"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3.1。</font><font style="vertical-align: inherit;">Bean验证约束</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以在下面找到Bean Validation API中指定的所有约束的列表。</font><font style="vertical-align: inherit;">所有这些约束都适用于字段/属性级别，Bean验证规范中没有定义类级别约束。</font><font style="vertical-align: inherit;">如果您正在使用Hibernate对象关系映射器，则在为模型创建DDL时会考虑一些约束（请参阅“Hibernate元数据影响”）。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator允许将一些约束应用于Bean Validation规范所要求的更多数据类型（例如，</font></font><code>@Max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以应用于字符串）。</font><font style="vertical-align: inherit;">依赖此功能可能会影响Bean验证提供程序之间的应用程序的可移植性。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>@AssertFalse</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的元素是否为false</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>Boolean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">， </font></font><code>boolean</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@AssertTrue</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的元素是否为true</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>Boolean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">， </font></font><code>boolean</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@DecimalMax(value=, inclusive=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的值是否小于指定的最大值，当</font></font><code>inclusive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= false时。</font><font style="vertical-align: inherit;">否则该值是否小于或等于指定的最大值。</font><font style="vertical-align: inherit;">参数值是根据字符串表示的最大值的</font></font><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串表示。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>BigInteger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>byte</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和原始类型的相应的包装; </font><font style="vertical-align: inherit;">另外由HV支持：任何子类型</font></font><code>Number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>javax.money.MonetaryAmount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（如果</font></font><a href="https://jcp.org/en/jsr/detail?id=354"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 354 API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和实现在类路径上）</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@DecimalMin(value=, inclusive=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的值是否大于指定的最小值，当</font></font><code>inclusive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= false时。</font><font style="vertical-align: inherit;">否则该值是否大于或等于指定的最小值。</font><font style="vertical-align: inherit;">参数值是根据字符串表示的最小值的</font></font><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串表示。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>BigInteger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>byte</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和原始类型的相应的包装; </font><font style="vertical-align: inherit;">另外由HV支持：任何子类型</font></font><code>Number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>javax.money.MonetaryAmount</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Digits(integer=, fraction=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的值是否是具有最多</font></font><code>integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字和</font></font><code>fraction</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小数位的数字</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BigDecimal的，</font></font><code>BigInteger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>byte</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和原始类型的相应的包装; </font><font style="vertical-align: inherit;">另外由HV支持：任何子类型</font></font><code>Number</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列定义精度和比例</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Email</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查指定的字符序列是否是有效的电子邮件地址。</font><font style="vertical-align: inherit;">可选参数</font></font><code>regexp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许指定电子邮件必须匹配的附加正则表达式（包括正则表达式标志）。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Future</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查注释日期是否在将来</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>java.util.Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.util.Calendar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.Instant</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.MonthDay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.OffsetDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.OffsetTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.Year</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.YearMonth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.ZonedDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.HijrahDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.JapaneseDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.MinguoDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.ThaiBuddhistDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">另外由HV支持，如果</font></font><a href="http://www.joda.org/joda-time/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joda Time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期/时间API在类路径上：任何</font></font><code>ReadablePartial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和的</font><font style="vertical-align: inherit;">实现</font></font><code>ReadableInstant</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@FutureOrPresent</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查注释日期是在当前还是将来</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>java.util.Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.util.Calendar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.Instant</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.MonthDay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.OffsetDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.OffsetTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.Year</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.YearMonth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.ZonedDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.HijrahDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.JapaneseDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.MinguoDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.ThaiBuddhistDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">另外由HV支持，如果</font></font><a href="http://www.joda.org/joda-time/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joda Time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期/时间API在类路径上：任何</font></font><code>ReadablePartial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和的</font><font style="vertical-align: inherit;">实现</font></font><code>ReadableInstant</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Max(value=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的值是否小于或等于指定的最大值</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>BigInteger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>byte</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和原始类型的相应的包装; </font><font style="vertical-align: inherit;">另外由HV支持：任何子类型</font></font><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（由字符序列表示的数值被评估），</font></font><code>Number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和的</font><font style="vertical-align: inherit;">任何子类型</font></font><code>javax.money.MonetaryAmount</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在列上添加检查约束</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Min(value=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查注释值是否高于或等于指定的最小值</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>BigInteger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>byte</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和原始类型的相应的包装; </font><font style="vertical-align: inherit;">另外由HV支持：任何子类型</font></font><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（由字符序列表示的数值被评估），</font></font><code>Number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和的</font><font style="vertical-align: inherit;">任何子类型</font></font><code>javax.money.MonetaryAmount</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在列上添加检查约束</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@NotBlank</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列是否为空并且修剪长度大于0.不同之</font></font><code>@NotEmpty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处在于此约束只能应用于字符序列，并且忽略尾随空格。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@NotEmpty</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的元素是否为空或空</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Collection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和数组</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@NotNull</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的值是不是 </font></font><code>null</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随便哪种</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列不可为空</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Negative</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查元素是否严格为负数。</font><font style="vertical-align: inherit;">零值被视为无效。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>BigInteger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>byte</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和原始类型的相应的包装; </font><font style="vertical-align: inherit;">另外由HV支持：任何子类型</font></font><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（由字符序列表示的数值被评估），</font></font><code>Number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和的</font><font style="vertical-align: inherit;">任何子类型</font></font><code>javax.money.MonetaryAmount</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@NegativeOrZero</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查元素是负数还是零。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>BigInteger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>byte</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和原始类型的相应的包装; </font><font style="vertical-align: inherit;">另外由HV支持：任何子类型</font></font><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（由字符序列表示的数值被评估），</font></font><code>Number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和的</font><font style="vertical-align: inherit;">任何子类型</font></font><code>javax.money.MonetaryAmount</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Null</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的值是否为 </font></font><code>null</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随便哪种</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Past</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查注释日期是否过去</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>java.util.Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.util.Calendar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.Instant</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.MonthDay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.OffsetDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.OffsetTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.Year</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.YearMonth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.ZonedDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.HijrahDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.JapaneseDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.MinguoDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.ThaiBuddhistDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">另外由HV支持，如果</font></font><a href="http://www.joda.org/joda-time/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joda Time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期/时间API在类路径上：任何</font></font><code>ReadablePartial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和和的</font><font style="vertical-align: inherit;">实现</font></font><code>ReadableInstant</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@PastOrPresent</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查注释日期是过去还是现在</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>java.util.Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.util.Calendar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.Instant</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.LocalTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.MonthDay</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.OffsetDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.OffsetTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.Year</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.YearMonth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.ZonedDateTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.HijrahDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.JapaneseDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.MinguoDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.time.chrono.ThaiBuddhistDate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">另外由HV支持，如果</font></font><a href="http://www.joda.org/joda-time/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joda Time</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期/时间API在类路径上：任何</font></font><code>ReadablePartial</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和和的</font><font style="vertical-align: inherit;">实现</font></font><code>ReadableInstant</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Pattern(regex=, flags=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"></font><code>regex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑给定标志，</font><font style="vertical-align: inherit;">检查带注释的字符串是否与正则表达式匹配</font></font><code>match</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Positive</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查元素是否严格为正。</font><font style="vertical-align: inherit;">零值被视为无效。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>BigInteger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>byte</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和原始类型的相应的包装; </font><font style="vertical-align: inherit;">另外由HV支持：任何子类型</font></font><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（由字符序列表示的数值被评估），</font></font><code>Number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和的</font><font style="vertical-align: inherit;">任何子类型</font></font><code>javax.money.MonetaryAmount</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@PositiveOrZero</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查元素是正数还是零。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>BigInteger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>byte</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和原始类型的相应的包装; </font><font style="vertical-align: inherit;">另外由HV支持：任何子类型</font></font><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（由字符序列表示的数值被评估），</font></font><code>Number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和的</font><font style="vertical-align: inherit;">任何子类型</font></font><code>javax.money.MonetaryAmount</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Size(min=, max=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查是否已注释元素的大小之间</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（含）</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Collection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和数组</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列长度​​将设置为 </font></font><code>max</code></p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了上面列出的参数之外，每个约束都有参数message，groups和payload。</font><font style="vertical-align: inherit;">这是Bean Validation规范的要求。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="validator-defineconstraints-hv-constraints"><a class="anchor" href="#validator-defineconstraints-hv-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3.2。</font><font style="vertical-align: inherit;">附加限制</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了Bean Validation API定义的约束之外，Hibernate Validator还提供了几个有用的自定义约束，如下所示。</font><font style="vertical-align: inherit;">除了一个例外，这些约束也适用于字段/属性级别，只有</font></font><code>@ScriptAssert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类级别约束。</font></font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>@CreditCardNumber(ignoreNonDigitCharacters=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列是否通过了Luhn校验和测试。</font><font style="vertical-align: inherit;">注意，此验证旨在检查用户错误，而不是信用卡有效性！</font><font style="vertical-align: inherit;">另请参阅</font></font><a href="http://www.dirigodev.com/blog/ecommerce/anatomy-of-a-credit-card-number/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信用卡号码剖析</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>ignoreNonDigitCharacters</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许忽略非数字字符。</font><font style="vertical-align: inherit;">默认是</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Currency(value=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的货币单位</font></font><code>javax.money.MonetaryAmount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否为指定货币单位的一部分。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何子类型</font></font><code>javax.money.MonetaryAmount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（如果</font></font><a href="https://jcp.org/en/jsr/detail?id=354"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 354 API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和实现在类路径上）</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@DurationMax(days=, hours=, minutes=, seconds=, millis=, nanos=, inclusive=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的</font></font><code>java.time.Duration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素是否不大于从注释参数构造的元素。</font><font style="vertical-align: inherit;">如果</font></font><code>inclusive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flag设置为，</font><font style="vertical-align: inherit;">则允许相等</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>java.time.Duration</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@DurationMin(days=, hours=, minutes=, seconds=, millis=, nanos=, inclusive=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的</font></font><code>java.time.Duration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素是否不小于从注释参数构造的元素。</font><font style="vertical-align: inherit;">如果</font></font><code>inclusive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flag设置为，</font><font style="vertical-align: inherit;">则允许相等</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>java.time.Duration</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@EAN</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列是否为有效的</font></font><a href="http://en.wikipedia.org/wiki/International_Article_Number_%28EAN%29"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EAN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条形码。</font><font style="vertical-align: inherit;">type确定条形码的类型。</font><font style="vertical-align: inherit;">默认值为EAN-13。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@ISBN</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列是否为有效的</font></font><a href="https://en.wikipedia.org/wiki/International_Standard_Book_Number"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ISBN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定ISBN的类型。</font><font style="vertical-align: inherit;">默认值为ISBN-13。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Length(min=, max=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证该注释字符序列是间</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列长度​​将设置为最大值</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@CodePointLength(min=, max=, normalizationStrategy=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证注释字符序列的代码点长度之间</font></font><code>min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括在内。</font><font style="vertical-align: inherit;">如果</font></font><code>normalizationStrategy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已设置，</font><font style="vertical-align: inherit;">则验证标准化值</font><font style="vertical-align: inherit;">。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@LuhnCheck(startIndex= , endIndex=, checkDigitIndex=, ignoreNonDigitCharacters=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列中的数字是否通过Luhn校验和算法（另请参阅</font></font><a href="http://en.wikipedia.org/wiki/Luhn_algorithm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luhn算法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><code>startIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>endIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许仅在指定的子字符串上运行算法。</font></font><code>checkDigitIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许使用字符序列中的任意数字作为校验位。</font><font style="vertical-align: inherit;">如果未指定，则假定校验位是指定范围的一部分。</font><font style="vertical-align: inherit;">最后但并非最不重要的是，</font></font><code>ignoreNonDigitCharacters</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许忽略非数字字符。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Mod10Check(multiplier=, weight=, startIndex=, endIndex=, checkDigitIndex=, ignoreNonDigitCharacters=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列中的数字是否通过通用mod 10校验和算法。</font></font><code>multiplier</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定奇数的乘数（默认为3），</font></font><code>weight</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偶数的权重（默认为1）。</font></font><code>startIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>endIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许仅在指定的子字符串上运行算法。</font></font><code>checkDigitIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许使用字符序列中的任意数字作为校验位。</font><font style="vertical-align: inherit;">如果未指定，则假定校验位是指定范围的一部分。</font><font style="vertical-align: inherit;">最后但并非最不重要的是，</font></font><code>ignoreNonDigitCharacters</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许忽略非数字字符。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Mod11Check(threshold=, startIndex=, endIndex=, checkDigitIndex=, ignoreNonDigitCharacters=, treatCheck10As=, treatCheck11As=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列中的数字是否通过了mod 11校验和算法。</font></font><code>threshold</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定mod11乘数增长的阈值; </font><font style="vertical-align: inherit;">如果未指定任何值，则乘数将无限增长。</font></font><code>treatCheck10As</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>treatCheck11As</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定当mod 11校验和分别等于10或11时要使用的校验位。</font><font style="vertical-align: inherit;">默认分别为X和0。</font></font><code>startIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>endIndex</code> <code>checkDigitIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>ignoreNonDigitCharacters</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有与中相同的语义</font></font><code>@Mod10Check</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@Range(min=, max=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的值是否在（包括）指定的最小值和最大值之间</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>BigDecimal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>BigInteger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>CharSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>byte</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>short</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和原始类型的相应的包装</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@SafeHtml(whitelistType= , additionalTags=, additionalTagsWithAttributes=, baseURI=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的值是否包含潜在的恶意片段，例如</font></font><code>&lt;script/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了使用此约束，</font></font><a href="http://jsoup.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jsoup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库必须是类路径的一部分。</font><font style="vertical-align: inherit;">使用该</font></font><code>whitelistType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性，可以选择可以通过</font></font><code>additionalTags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">改进的预定义白名单类型</font></font><code>additionalTagsWithAttributes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">前者允许添加没有任何属性的标签，而后者允许使用注释指定标签和可选的允许属性以及属性的接受协议</font></font><code>@SafeHtml.Tag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此外，还</font></font><code>baseURI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许指定用于解析相对URI的基URI。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@ScriptAssert(lang=, script=, alias=, reportOn=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查是否可以针对带注释的元素成功评估给定脚本。</font><font style="vertical-align: inherit;">为了使用此约束，JSR 223（“Java </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TM</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平台的</font><font style="vertical-align: inherit;">脚本</font><font style="vertical-align: inherit;">”）</font><font style="vertical-align: inherit;">定义的Java Scripting API实现</font><font style="vertical-align: inherit;">必须是类路径的一部分。</font><font style="vertical-align: inherit;">要评估的表达式可以用任何脚本或表达式语言编写，可以在类路径中找到兼容JSR 223的引擎。</font><font style="vertical-align: inherit;">即使这是类级别约束，也可以使用该</font></font><code>reportOn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性来报告特定属性而不是整个对象的约束违规。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随便哪种</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@UniqueElements</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的集合是否仅包含唯一元素。</font><font style="vertical-align: inherit;">使用该</font></font><code>equals()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">确定相等性</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认消息不包含重复元素列表，但您可以通过覆盖消息并使用</font></font><code>{duplicates}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">message参数</font><font style="vertical-align: inherit;">来包含它</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">重复元素列表也包含在约束违规的动态有效负载中。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>Collection</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@URL(protocol=, host=, port=, regexp=, flags=)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据RFC2396检查带注释的字符序列是否为有效URL。</font><font style="vertical-align: inherit;">如果任何可选参数</font></font><code>protocol</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>host</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定时，对应的URL片段必须在指定的值相匹配。</font><font style="vertical-align: inherit;">可选参数</font></font><code>regexp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许指定URL必须匹配的附加正则表达式（包括正则表达式标志）。</font><font style="vertical-align: inherit;">默认情况下，此约束使用</font></font><code>java.net.URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数来验证给定字符串是否表示有效的URL。</font><font style="vertical-align: inherit;">还可以使用基于正则表达式的版本</font></font><code>RegexpURLValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 可以通过XML配置（参见</font></font><a href="#section-mapping-xml-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2节“通过映射约束</font></font><code>constraint-mappings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或编程API（参见</font></font><a href="#section-programmatic-constraint-definition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.13.2节“以编程方式添加约束定义”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="_country_specific_constraints"><a class="anchor" href="#_country_specific_constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3.2.1。</font><font style="vertical-align: inherit;">国家特定约束</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator还提供一些国家特定的约束，例如用于社会安全号码的验证。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果必须实现特定于国家/地区的约束，请考虑将其作为Hibernate Validator的贡献！</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>@CNPJ</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列是否代表巴西公司纳税人登记号码（Cadastro dePessoaJuríeddica）</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">巴西</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@CPF</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列是否代表巴西个人纳税人注册号（Cadastro dePessoaFídsica）</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">巴西</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@TituloEleitoral</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列是否代表巴西选民身份证号码（</font></font><a href="http://www.exceldoseujeito.com.br/2008/12/19/validar-cpf-cnpj-e-titulo-de-eleitor-parte-ii/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TítuloEleitoral</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">巴西</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@NIP</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列是否代表波兰增值税识别号（</font></font><a href="https://pl.wikipedia.org/wiki/NIP"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NIP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">波兰</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@PESEL</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列是否代表波兰国家标识号（</font></font><a href="https://pl.wikipedia.org/wiki/PESEL"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PESEL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">波兰</font></font></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>@REGON</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查带注释的字符序列是否代表波兰纳税人标识号（</font></font><a href="https://pl.wikipedia.org/wiki/REGON"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REGON</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">可以应用于REGON的9位和14位版本</font></font></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的数据类型</font></font></dt>
<dd>
<p><code>CharSequence</code></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate元数据影响</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">波兰</font></font></p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，Bean Validation约束和Hibernate Validator提供的自定义约束都不能满足您的要求。</font><font style="vertical-align: inherit;">在这种情况下，您可以轻松编写自己的约束。</font><font style="vertical-align: inherit;">您可以在</font></font><a href="#validator-customconstraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建自定义约束中</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到更多信息</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapter-method-constraints"><a class="anchor" href="#chapter-method-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.声明和验证方法约束</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从Bean Validation 1.1开始，约束不仅可以应用于JavaBeans及其属性，还可以应用于任何Java类型的方法和构造函数的参数和返回值。</font><font style="vertical-align: inherit;">这样可以使用Bean Validation约束来指定</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用方法或构造函数之前调用者必须满足的前提条件（通过对可执行文件的参数应用约束）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法或构造函数调用返回后保证调用者的后置条件（通过对可执行文件的返回值应用约束）</font></font></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于本参考指南的目的，术语</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法约束</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指的是方法和构造函数约束，如果没有另外说明的话。</font><font style="vertical-align: inherit;">有时，</font><font style="vertical-align: inherit;">在引用方法和构造函数时使用</font><font style="vertical-align: inherit;">术语</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行文件</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与传统的检查参数和返回值的正确性的方法相比，这种方法有几个优点：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查不必手动执行（例如通过抛掷</font></font><code>IllegalArgumentException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或类似），导致编写和维护的代码更少</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行文件的前置条件和后置条件不必在其文档中再次表达，因为约束注释将自动包含在生成的JavaDoc中。</font><font style="vertical-align: inherit;">这可以避免冗余，并减少实现和文档之间不一致的可能性</font></font></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使注释元素的JavaDoc中显示注释，注释类型本身必须使用元注释@Documented进行注释。</font><font style="vertical-align: inherit;">所有内置约束都是这种情况，并且被认为是任何自定义约束的最佳实践。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本章的其余部分，您将学习如何声明参数和返回值约束以及如何使用</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API </font><font style="vertical-align: inherit;">验证它们</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect2">
<h3 id="section-declaring-method-constraints"><a class="anchor" href="#section-declaring-method-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1。</font><font style="vertical-align: inherit;">声明方法约束</font></font></h3>
<div class="sect3">
<h4 id="_parameter_constraints"><a class="anchor" href="#_parameter_constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1.1。</font><font style="vertical-align: inherit;">参数约束</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过向参数添加约束注释来指定方法或构造函数的前提条件，如</font></font><a href="#example-declaring-parameter-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例3.1“声明方法和构造函数参数约束”中所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-declaring-parameter-constraints" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.1：声明方法和构造函数参数约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">parameter</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pun">(</span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> rentCar</span><span class="pun">(</span><span class="pln">
            </span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">Customer</span><span class="pln"> customer</span><span class="pun">,</span><span class="pln">
            </span><span class="lit">@NotNull</span><span class="pln"> </span><span class="lit">@Future</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> startDate</span><span class="pun">,</span><span class="pln">
            </span><span class="lit">@Min</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> durationInDays</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里声明了以下先决条件：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给</font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数必须不</font></font><code>null</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在调用</font></font><code>rentCar()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法时，给定</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">方法</font></font><code>customer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不得为</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，租金的开始日期不得</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与将来一样好，最后租期必须至少为一天</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，声明方法或构造函数约束本身不会在调用可执行文件时自动导致其验证。</font><font style="vertical-align: inherit;">相反，</font><font style="vertical-align: inherit;">必须使用</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API（参见
 </font></font><a href="#section-validating-executable-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3.2节“验证方法约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）来执行验证，这通常使用方法拦截工具（如AOP，代理对象等）来完成。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束只能应用于实例方法，即不支持对静态方法声明约束。</font><font style="vertical-align: inherit;">根据您用于触发方法验证的拦截工具，可能会有其他限制，例如关于作为拦截目标支持的方法的可见性。</font><font style="vertical-align: inherit;">请参阅拦截技术的文档，以确定是否存在任何此类限制。</font></font></p>
</div>
<div class="sect4">
<h5 id="_cross_parameter_constraints"><a class="anchor" href="#_cross_parameter_constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1.1.1。</font><font style="vertical-align: inherit;">交叉参数约束</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有时，验证不仅取决于单个参数，还取决于方法或构造函数的几个甚至所有参数。</font><font style="vertical-align: inherit;">可以借助交叉参数约束来满足这种要求。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以将交叉参数约束视为等同于类级约束的方法验证。</font><font style="vertical-align: inherit;">两者都可用于实现基于若干元素的验证要求。</font><font style="vertical-align: inherit;">虽然类级约束适用于bean的多个属性，但交叉参数约束适用于可执行文件的多个参数。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与单参数约束相反，在方法或构造函数中</font></font><a href="#example-using-cross-parameter-constraint"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明了交叉参数约束，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font><a href="#example-using-cross-parameter-constraint"><font style="vertical-align: inherit;">示例3.2“声明交叉参数约束”中所示</font></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这里</font></font><code>@LuggageCountMatchesPassengerCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在</font></font><code>load()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">上声明</font><font style="vertical-align: inherit;">的交叉参数约束</font><font style="vertical-align: inherit;">用于确保没有乘客有两件以上的行李。</font></font></p>
</div>
<div id="example-using-cross-parameter-constraint" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.2：声明一个交叉参数约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">crossparameter</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@LuggageCountMatchesPassengerCount</span><span class="pun">(</span><span class="pln">piecesOfLuggagePerPassenger </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> load</span><span class="pun">(</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> passengers</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">PieceOfLuggage</span><span class="pun">&gt;</span><span class="pln"> luggage</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如您将在下一节中学习的那样，返回值约束也在方法级别上声明。</font><font style="vertical-align: inherit;">为了区分交叉参数约束和返回值约束，</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>@SupportedValidationTarget</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">实现中
 </font><font style="vertical-align: inherit;">配置约束目标</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以在</font></font><a href="#section-cross-parameter-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3节“交叉参数约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">找到有关详细信息的详细信息，
 </font><font style="vertical-align: inherit;">其中显示了如何实现自己的交叉参数约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，约束可以应用于可执行文件的参数（即，它是交叉参数约束），但也可以应用于返回值。</font><font style="vertical-align: inherit;">这方面的一个示例是自定义约束，它允许使用表达式或脚本语言指定验证规则。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此类约束必须定义一个成员</font></font><code>validationAppliesTo()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">该成员</font><font style="vertical-align: inherit;">可在声明时使用以指定约束目标。</font><font style="vertical-align: inherit;">如</font></font><a href="#example-specifying-constraint-target"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.3“指定约束的目标”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示</font><a href="#example-specifying-constraint-target"><font style="vertical-align: inherit;">，通过指定将约束</font></a><font style="vertical-align: inherit;">应用于可执行文件的参数
 </font></font><code>validationAppliesTo = ConstraintTarget.PARAMETERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，同时</font></font><code>ConstraintTarget.RETURN_VALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于将约束应用于可执行返回值。</font></font></p>
</div>
<div id="example-specifying-constraint-target" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.3：指定约束的目标</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">crossparameter</span><span class="pun">.</span><span class="pln">constrainttarget</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Garage</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@ELAssert</span><span class="pun">(</span><span class="pln">expression </span><span class="pun">=</span><span class="pln"> </span><span class="str">"..."</span><span class="pun">,</span><span class="pln"> validationAppliesTo </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ConstraintTarget</span><span class="pun">.</span><span class="pln">PARAMETERS</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> buildCar</span><span class="pun">(</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Part</span><span class="pun">&gt;</span><span class="pln"> parts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@ELAssert</span><span class="pun">(</span><span class="pln">expression </span><span class="pun">=</span><span class="pln"> </span><span class="str">"..."</span><span class="pun">,</span><span class="pln"> validationAppliesTo </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ConstraintTarget</span><span class="pun">.</span><span class="pln">RETURN_VALUE</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> paintCar</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> color</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这种约束适用于可执行文件的参数和返回值，但通常可以自动推断目标。</font><font style="vertical-align: inherit;">如果声明约束，则就是这种情况</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带参数的void方法（约束适用于参数）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有返回值但没有参数的可执行文件（约束适用于返回值）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既不是方法也不是构造函数，而是字段，参数等（约束适用于带注释的元素）</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这些情况下，您不必指定约束目标。</font><font style="vertical-align: inherit;">如果它提高了源代码的可读性，仍然建议这样做。</font><font style="vertical-align: inherit;">如果在无法自动确定约束目标的情况下未指定约束目标，</font></font><code>ConstraintDeclarationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则引发a。</font></font></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_return_value_constraints"><a class="anchor" href="#_return_value_constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1.2。</font><font style="vertical-align: inherit;">返回值约束</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过向可执行文件添加约束注释来声明方法或构造函数的后置条件，如</font></font><a href="#example-declaring-return-value-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.4“声明方法和构造函数返回值约束”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-declaring-return-value-constraints" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.4：声明方法和构造函数返回值约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">returnvalue</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@ValidRentalStation</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">Customer</span><span class="pun">&gt;</span><span class="pln"> getCustomers</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下约束适用于以下可执行文件</font></font><code>RentalStation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何新创建的</font></font><code>RentalStation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象都必须满足</font></font><code>@ValidRentalStation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回的客户列表</font></font><code>getCustomers()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不得</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">且必须至少包含on元素</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回的客户列表</font></font><code>getCustomers()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须不包含</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如您在上面的示例中所看到的，方法返回值支持容器元素约束。</font><font style="vertical-align: inherit;">方法参数也支持它们。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_cascaded_validation"><a class="anchor" href="#_cascaded_validation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1.3。</font><font style="vertical-align: inherit;">级联验证</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与JavaBeans属性的级联验证类似（请参见
 </font></font><a href="#section-object-graph-validation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.1.6节“对象图”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释可用于标记可执行参数并返回级联验证的值。</font><font style="vertical-align: inherit;">验证带有注释</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的参数或返回值时，也会验证在参数或返回值对象上声明的约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="#example-cascaded-executable-validation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.5“标记可执行参数和级联验证的返回值”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">参数</font></font><code>Garage#checkCar()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code>Garage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数</font><font style="vertical-align: inherit;">的返回值</font><font style="vertical-align: inherit;">被标记为级联验证。</font></font></p>
</div>
<div id="example-cascaded-executable-validation" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.5：标记可执行参数并返回级联验证的值</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">cascaded</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Garage</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Valid</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Garage</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> checkCar</span><span class="pun">(</span><span class="lit">@Valid</span><span class="pln"> </span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> car</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">cascaded</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> max </span><span class="pun">=</span><span class="pln"> </span><span class="lit">14</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licensePlate</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licencePlate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">licensePlate </span><span class="pun">=</span><span class="pln"> licencePlate</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证</font></font><code>checkCar()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">的参数时，</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也会评估</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">的属性约束</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">类似地，</font><font style="vertical-align: inherit;">在验证</font><font style="vertical-align: inherit;">构造函数</font><font style="vertical-align: inherit;">的返回值时</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Garage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将检查</font><font style="vertical-align: inherit;">名称字段</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束
 </font></font><code>Garage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，级联验证对可执行文件的工作方式与JavaBeans属性完全相同。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特别是，</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在级联验证期间忽略值（当然这在构造函数返回值验证期间不会发生）并且递归执行级联验证，即，如果标记为级联验证的参数或返回值对象本身具有标记的属性</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则在引用元素上声明的约束也将被验证。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与字段和属性相同，也可以在返回值和参数的容器元素（例如集合，映射或自定义容器的元素）上声明级联验证。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，容器包含的每个元素都会得到验证。</font><font style="vertical-align: inherit;">所以验证的参数时</font></font><code>checkCars()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在方法
 </font></font><a href="#example-cascaded-executable-validation-container-elements"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施例3.6，“方法参数的容器元素标记为级联验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所传递的列表的每个元素实例将被验证和</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当任何所含的创建</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例是无效的。</font></font></p>
</div>
<div id="example-cascaded-executable-validation-container-elements" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.6：标记为级联验证的方法参数的容器元素</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">cascaded</span><span class="pun">.</span><span class="pln">containerelement</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Garage</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> checkCars</span><span class="pun">(</span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="lit">@Valid</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> cars</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="section-method-constraints-inheritance-hierarchies"><a class="anchor" href="#section-method-constraints-inheritance-hierarchies"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.1.4。</font><font style="vertical-align: inherit;">继承层次结构中的方法约束</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在继承层次结构中声明方法约束时，请务必注意以下规则：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法的调用者要满足的前提条件可能不会在子类型中得到加强</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保证方法调用者的后置条件可能不会在子类型中被削弱</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些规则由概念动机</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行为子类型</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这需要一个地方型</font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，也亚型</font></font><code>S</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以在不改变程序的行为中。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，考虑一个类在具有静态类型的对象上调用方法</font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果该对象的运行时类型是</font></font><code>S</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code>S</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强加了额外的前提条件，则客户端类可能无法满足这些前提条件，因为它们不知道它们。</font><font style="vertical-align: inherit;">行为子类型的规则也称为</font></font><a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liskov替换原则</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation规范通过禁止覆盖或实现在超类型（超类或接口）中声明的方法的方法的参数约束来实现第一个规则。
</font></font><a href="#example-illegal-parameter-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例3.7，“子类型中的非法方法参数约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示违反此规则。</font></font></p>
</div>
<div id="example-illegal-parameter-constraints" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.7：子类型中的非法方法参数约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">inheritance</span><span class="pun">.</span><span class="pln">parameter</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Vehicle</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> drive</span><span class="pun">(</span><span class="lit">@Max</span><span class="pun">(</span><span class="lit">75</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> speedInMph</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">inheritance</span><span class="pun">.</span><span class="pln">parameter</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Vehicle</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> drive</span><span class="pun">(</span><span class="lit">@Max</span><span class="pun">(</span><span class="lit">55</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> speedInMph</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于此方法实现了接口方法，</font><font style="vertical-align: inherit;">因此</font></font><code>@Max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font></font><code>Car#drive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是非法的
 </font></font><code>Vehicle#drive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，如果超类型方法本身未声明任何参数约束，则也不允许对覆盖方法的参数约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，如果方法覆盖或实现在多个并行超类型中声明的方法（例如，两个接口不相互扩展，或者类和接口未由该类实现），则不能为任何涉及的方法指定参数约束。类型。</font><font style="vertical-align: inherit;">在类型</font></font><a href="#example-illegal-parameter-constraints-parallel-types"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施例3.8，“并联类型的层级的非法方法参数的约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表明违反该规则的。</font><font style="vertical-align: inherit;">该方法</font></font><code>RacingCar#drive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖</font></font><code>Vehicle#drive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code>Car#drive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，限制</font></font><code>Vehicle#drive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是非法的。</font></font></p>
</div>
<div id="example-illegal-parameter-constraints-parallel-types" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.8：层次结构的并行类型中的非法方法参数约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">inheritance</span><span class="pun">.</span><span class="pln">parallel</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Vehicle</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> drive</span><span class="pun">(</span><span class="lit">@Max</span><span class="pun">(</span><span class="lit">75</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> speedInMph</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">inheritance</span><span class="pun">.</span><span class="pln">parallel</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> drive</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> speedInMph</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">inheritance</span><span class="pun">.</span><span class="pln">parallel</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RacingCar</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Vehicle</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> drive</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> speedInMph</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">先前描述的限制仅适用于参数约束。</font><font style="vertical-align: inherit;">相反，可以在覆盖或实现任何超类型方法的方法中添加返回值约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，所有方法的返回值约束都适用于子类型方法，即在子类型方法本身上声明的约束以及对重写/实现的超类型方法的任何返回值约束。</font><font style="vertical-align: inherit;">这是合法的，因为放置额外的返回值约束可能永远不会表示对方法调用者保证的后置条件的弱化。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，在验证</font><a href="#example-return-value-constraints-in-hierarchy"><font style="vertical-align: inherit;">示例3.9“超类型和子类型方法的返回值约束”中</font></a></font><code>Car#getPassengers()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示
 </font><font style="vertical-align: inherit;">方法的</font></font><a href="#example-return-value-constraints-in-hierarchy"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回值时</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将应用</font></font><code>@Size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对方法本身的</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">以及</font><font style="vertical-align: inherit;">对已实现接口方法</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束</font></font><code>Vehicle#getPassengers()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-return-value-constraints-in-hierarchy" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.9：对超类型和子类型方法的返回值约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">inheritance</span><span class="pun">.</span><span class="pln">returnvalue</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Vehicle</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> getPassengers</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">inheritance</span><span class="pun">.</span><span class="pln">returnvalue</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Vehicle</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> getPassengers</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果验证引擎检测到违反任何上述规则，
 </font></font><code>ConstraintDeclarationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将引发a。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节中描述的规则仅适用于方法，但不适用于构造函数。</font><font style="vertical-align: inherit;">根据定义，构造函数永远不会覆盖超类型构造函数。</font><font style="vertical-align: inherit;">因此，在验证构造函数调用的参数或返回值时，仅应用构造函数本身上声明的约束，但绝不会在超类型构造函数上声明任何约束。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font><font style="vertical-align: inherit;">在创建</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">设置包含在</font></font><code>MethodValidationConfiguration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性中的</font><font style="vertical-align: inherit;">配置参数，可以放宽对这些规则的强制执行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另请参见</font><a href="#section-method-validation-prerequisite-relaxation"><font style="vertical-align: inherit;">第12.3节“放宽类层次结构中方法验证的要求”</font></a><font style="vertical-align: inherit;">。</font></font><code>HibernateValidatorConfiguration</code><font style="vertical-align: inherit;"></font><code>Validator</code><font style="vertical-align: inherit;"></font><a href="#section-method-validation-prerequisite-relaxation"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-validating-executable-constraints"><a class="anchor" href="#section-validating-executable-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2。</font><font style="vertical-align: inherit;">验证方法约束</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法约束的验证是使用</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">完成的</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="#section-obtaining-executable-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3.2.1节“获取</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例”中，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您将学习如何获取</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实例，而</font></font><a href="#section-executable-validator-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3.2.2节“ </font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何使用此接口提供的不同方法。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们不是</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接从应用程序代码</font><font style="vertical-align: inherit;">中调用</font><font style="vertical-align: inherit;">方法，</font><font style="vertical-align: inherit;">而是</font><font style="vertical-align: inherit;">通过方法拦截技术（如AOP，代理对象等）调用它们。这会导致可执行约束在方法或构造函数调用时自动且透明地进行验证。</font><font style="vertical-align: inherit;">通常</font></font><code>ConstraintViolationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在违反任何约束的情况下，由集成层引发</font><font style="vertical-align: inherit;">a </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect3">
<h4 id="section-obtaining-executable-validator"><a class="anchor" href="#section-obtaining-executable-validator"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.1。</font><font style="vertical-align: inherit;">获取</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font><a href="#example-obtaining-executable-validator"><font style="vertical-align: inherit;">例3.10“获取</font></a><a href="#example-obtaining-executable-validator"><font style="vertical-align: inherit;">实例”中</font></a></font><code>Validator#forExecutables()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示
 </font><font style="vertical-align: inherit;">检索</font><a href="#example-obtaining-executable-validator"><font style="vertical-align: inherit;">实例</font></a><font style="vertical-align: inherit;">。</font></font><a href="#example-obtaining-executable-validator"><font style="vertical-align: inherit;"></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
<div id="example-obtaining-executable-validator" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.10：获取</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> factory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">buildDefaultValidatorFactory</span><span class="pun">();</span><span class="pln">
executableValidator </span><span class="pun">=</span><span class="pln"> factory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">().</span><span class="pln">forExecutables</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在示例中，可执行验证器从默认验证器工厂中检索，但如果需要，您还可以引导特定配置的工厂，如
 </font></font><a href="#chapter-bootstrapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9章</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引导中所述</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，例如，以便使用特定的参数名称提供程序（参见</font></font><a href="#section-parameter-name-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2.4节） ，“ </font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="section-executable-validator-methods"><a class="anchor" href="#section-executable-validator-methods"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.2。</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口提供了共四种方法：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>validateParameters()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>validateReturnValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于方法验证</font></font></p>
</li>
<li>
<p><code>validateConstructorParameters()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>validateConstructorReturnValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于构造函数验证</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如方法一样</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所有这些方法返回一个</font></font><code>Set&lt;ConstraintViolation&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个违反约束</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">实例，如果验证成功则为空。</font><font style="vertical-align: inherit;">此外，所有方法都有一个var-args groups参数，您可以通过该参数传递验证组以供验证。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下部分中的示例基于</font><a href="#example-executable-validator-class-car"><font style="vertical-align: inherit;">示例3.11“ </font></a><a href="#example-executable-validator-class-car"><font style="vertical-align: inherit;">带有约束方法和构造</font></a><font style="vertical-align: inherit;">函数的</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类”中所示</font></font><a href="#example-executable-validator-class-car"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数的方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-executable-validator-class-car" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.11：</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有约束方法和构造函数的类</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@ValidRacingCar</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> team</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> drive</span><span class="pun">(</span><span class="lit">@Max</span><span class="pun">(</span><span class="lit">75</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> speedInMph</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Passenger</span><span class="pun">&gt;</span><span class="pln"> getPassengers</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">emptyList</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_executablevalidator_validateparameters_code"><a class="anchor" href="#_code_executablevalidator_validateparameters_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.2.1。 </font></font><code>ExecutableValidator#validateParameters()</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法</font></font><code>validateParameters()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于验证方法调用的参数。
</font></font><a href="#example-executable-validator-validate-parameters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.12，“使用</font></font><code>ExecutableValidator#validateParameters()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了一个例子。</font><font style="vertical-align: inherit;">验证导致违反</font><font style="vertical-align: inherit;">方法</font></font><code>@Max</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束</font></font><code>drive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-executable-validator-validate-parameters" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.12：使用 </font></font><code>ExecutableValidator#validateParameters()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Method</span><span class="pln"> method </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getMethod</span><span class="pun">(</span><span class="pln"> </span><span class="str">"drive"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> parameterValues </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">80</span><span class="pln"> </span><span class="pun">};</span><span class="pln">
</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> violations </span><span class="pun">=</span><span class="pln"> executableValidator</span><span class="pun">.</span><span class="pln">validateParameters</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">object</span><span class="pun">,</span><span class="pln">
        method</span><span class="pun">,</span><span class="pln">
        parameterValues
</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> violations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Annotation</span><span class="pun">&gt;</span><span class="pln"> constraintType </span><span class="pun">=</span><span class="pln"> violations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getConstraintDescriptor</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">annotationType</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Max</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> constraintType </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，</font></font><code>validateParameters()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证方法的所有参数约束，即对各个参数的约束以及交叉参数约束。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="_code_executablevalidator_validatereturnvalue_code"><a class="anchor" href="#_code_executablevalidator_validatereturnvalue_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.2.2。 </font></font><code>ExecutableValidator#validateReturnValue()</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>validateReturnValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以验证</font><font style="vertical-align: inherit;">使用方法</font><font style="vertical-align: inherit;">的返回值。</font></font><a href="#example-executable-validator-validate-return-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.13中</font></font><code>ExecutableValidator#validateReturnValue()</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的验证
 </font><a href="#example-executable-validator-validate-return-value"><font style="vertical-align: inherit;">“使用</font></a><a href="#example-executable-validator-validate-return-value"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">产生一个约束违规，因为该
 </font></font><code>getPassengers()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法预计会返回至少一个</font></font><code>Passenger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font></font></p>
</div>
<div id="example-executable-validator-validate-return-value" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.13：使用 </font></font><code>ExecutableValidator#validateReturnValue()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Method</span><span class="pln"> method </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getMethod</span><span class="pun">(</span><span class="pln"> </span><span class="str">"getPassengers"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Object</span><span class="pln"> returnValue </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Collections</span><span class="pun">.&lt;</span><span class="typ">Passenger</span><span class="pun">&gt;</span><span class="pln">emptyList</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> violations </span><span class="pun">=</span><span class="pln"> executableValidator</span><span class="pun">.</span><span class="pln">validateReturnValue</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">object</span><span class="pun">,</span><span class="pln">
        method</span><span class="pun">,</span><span class="pln">
        returnValue
</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> violations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Annotation</span><span class="pun">&gt;</span><span class="pln"> constraintType </span><span class="pun">=</span><span class="pln"> violations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getConstraintDescriptor</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">annotationType</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Size</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> constraintType </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_executablevalidator_validateconstructorparameters_code"><a class="anchor" href="#_code_executablevalidator_validateconstructorparameters_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.2.3。 </font></font><code>ExecutableValidator#validateConstructorParameters()</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用</font></font><code>validateConstructorParameters()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><a href="#example-executable-validator-validate-constructor-parameters"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example 3.14“Using </font></font><code>ExecutableValidator#validateConstructorParameters()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示</font><font style="vertical-align: inherit;">验证构造函数调用的参数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于</font><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">的
 </font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font></font><code>manufacturer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，验证调用返回一个约束违规。</font></font></p>
</div>
<div id="example-executable-validator-validate-constructor-parameters" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.14：使用 </font></font><code>ExecutableValidator#validateConstructorParameters()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Constructor</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> constructor </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getConstructor</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> parameterValues </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">};</span><span class="pln">
</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> violations </span><span class="pun">=</span><span class="pln"> executableValidator</span><span class="pun">.</span><span class="pln">validateConstructorParameters</span><span class="pun">(</span><span class="pln">
        constructor</span><span class="pun">,</span><span class="pln">
        parameterValues
</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> violations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Annotation</span><span class="pun">&gt;</span><span class="pln"> constraintType </span><span class="pun">=</span><span class="pln"> violations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getConstraintDescriptor</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">annotationType</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">NotNull</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> constraintType </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_code_executablevalidator_validateconstructorreturnvalue_code"><a class="anchor" href="#_code_executablevalidator_validateconstructorreturnvalue_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.2.4。 </font></font><code>ExecutableValidator#validateConstructorReturnValue()</code></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，通过使用，</font></font><code>validateConstructorReturnValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以验证构造函数的返回值。</font><font style="vertical-align: inherit;">在
 </font></font><a href="#example-executable-validator-validate-constructor-return-value"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施例3.15，“使用</font></font><code>ExecutableValidator#validateConstructorReturnValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>validateConstructorReturnValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
将返回一个约束违反，由于</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由构造不满足返回的实例</font></font><code>@ValidRacingCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束（未示出）。</font></font></p>
</div>
<div id="example-executable-validator-validate-constructor-return-value" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.15：使用 </font></font><code>ExecutableValidator#validateConstructorReturnValue()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">//constructor for creating racing cars</span><span class="pln">
</span><span class="typ">Constructor</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> constructor </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getConstructor</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Car</span><span class="pln"> createdObject </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> violations </span><span class="pun">=</span><span class="pln"> executableValidator</span><span class="pun">.</span><span class="pln">validateConstructorReturnValue</span><span class="pun">(</span><span class="pln">
        constructor</span><span class="pun">,</span><span class="pln">
        createdObject
</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> violations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Annotation</span><span class="pun">&gt;</span><span class="pln"> constraintType </span><span class="pun">=</span><span class="pln"> violations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getConstraintDescriptor</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">annotationType</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ValidRacingCar</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> constraintType </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_constraintviolation_code_methods_for_method_validation"><a class="anchor" href="#_code_constraintviolation_code_methods_for_method_validation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.2.3。</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法验证的方法</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了引入的方法</font></font><a href="#section-constraint-violation-methods"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.2.3节</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ ”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供了两个更具体的执行参数的验证方法和返回值。</font></font></p>
</div>
<div class="paragraph">
<p><code>ConstraintViolation#getExecutableParameters()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在方法或构造函数参数验证的情况下返回经过验证的参数数组，同时</font></font><code>ConstraintViolation#getExecutableReturnValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在返回值验证的情况下提供对经过验证的对象的访问。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有其他</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法通常用于方法验证，其方式与bean的验证相同。</font><font style="vertical-align: inherit;">请参阅
 </font></font><a href="http://docs.jboss.org/hibernate/beanvalidation/spec/2.0/api/?javax/validation/metadata/BeanDescriptor.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaDoc</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
以了解有关各个方法的行为及其在bean和方法验证期间返回值的更多信息。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，</font></font><code>getPropertyPath()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了获取有关验证参数或返回值的详细信息（例如，用于记录目的），</font><font style="vertical-align: inherit;">这</font><font style="vertical-align: inherit;">可能非常有用。</font><font style="vertical-align: inherit;">特别是，您可以从路径节点检索相关方法的名称和参数类型以及相关参数的索引。</font><font style="vertical-align: inherit;">如何做到这一点如</font></font><a href="#example-executable-validation-property-path"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.16“检索方法和参数信息”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-executable-validation-property-path" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.16：检索方法和参数信息</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Method</span><span class="pln"> method </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getMethod</span><span class="pun">(</span><span class="pln"> </span><span class="str">"drive"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> parameterValues </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">80</span><span class="pln"> </span><span class="pun">};</span><span class="pln">
</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> violations </span><span class="pun">=</span><span class="pln"> executableValidator</span><span class="pun">.</span><span class="pln">validateParameters</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">object</span><span class="pun">,</span><span class="pln">
        method</span><span class="pun">,</span><span class="pln">
        parameterValues
</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> violations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Iterator</span><span class="pun">&lt;</span><span class="typ">Node</span><span class="pun">&gt;</span><span class="pln"> propertyPath </span><span class="pun">=</span><span class="pln"> violations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getPropertyPath</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">();</span><span class="pln">

</span><span class="typ">MethodNode</span><span class="pln"> methodNode </span><span class="pun">=</span><span class="pln"> propertyPath</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">().</span><span class="kwd">as</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MethodNode</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"drive"</span><span class="pun">,</span><span class="pln"> methodNode</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Arrays</span><span class="pun">.&lt;</span><span class="typ">Class</span><span class="pun">&lt;?&gt;&gt;</span><span class="pln">asList</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">),</span><span class="pln"> methodNode</span><span class="pun">.</span><span class="pln">getParameterTypes</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ParameterNode</span><span class="pln"> parameterNode </span><span class="pun">=</span><span class="pln"> propertyPath</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">().</span><span class="kwd">as</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ParameterNode</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"speedInMph"</span><span class="pun">,</span><span class="pln"> parameterNode</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> parameterNode</span><span class="pun">.</span><span class="pln">getParameterIndex</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数名称使用当前值确定</font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参见
 </font></font><a href="#section-parameter-name-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2.4节“ </font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-builtin-method-constraints"><a class="anchor" href="#section-builtin-method-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.3。</font><font style="vertical-align: inherit;">内置方法约束</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了</font></font><a href="#section-builtin-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.3节“内置约束”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">讨论的内置bean和属性级约束之外
 </font><font style="vertical-align: inherit;">，Hibernate Validator目前还提供了一个方法级约束
 </font></font><code>@ParameterScriptAssert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一个通用的跨参数限制，允许实现使用任何JSR 223兼容（“为Java脚本验证程序</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TM</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本语言平台”），提供了一种发动机的这种语言可以在classpath。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要从表达式中引用可执行文件的参数，请使用从活动参数名称提供程序获取的名称（请参见</font></font><a href="#section-parameter-name-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2.4节“ </font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。
</font></font><a href="#example-parameterscriptassert"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.17，“使用</font></font><code>@ParameterScriptAssert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何</font><font style="vertical-align: inherit;">借助于表达
 </font></font><code>@LuggageCountMatchesPassengerCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自</font></font><a href="#example-using-cross-parameter-constraint"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.2“声明交叉参数约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">的验证逻辑</font></font><code>@ParameterScriptAssert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-parameterscriptassert" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例3.17：使用 </font></font><code>@ParameterScriptAssert</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter03</span><span class="pun">.</span><span class="pln">parameterscriptassert</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@ParameterScriptAssert</span><span class="pun">(</span><span class="pln">lang </span><span class="pun">=</span><span class="pln"> </span><span class="str">"javascript"</span><span class="pun">,</span><span class="pln"> script </span><span class="pun">=</span><span class="pln"> </span><span class="str">"luggage.size() &lt;= passengers.size() * 2"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> load</span><span class="pun">(</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> passengers</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">PieceOfLuggage</span><span class="pun">&gt;</span><span class="pln"> luggage</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapter-message-interpolation"><a class="anchor" href="#chapter-message-interpolation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.插值约束错误消息</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息插值是为违反的Bean Validation约束创建错误消息的过程。</font><font style="vertical-align: inherit;">在本章中，您将了解如何定义和解决此类消息，以及如何在默认算法不足以满足您的要求时插入自定义消息插补器。</font></font></p>
</div>
<div class="sect2">
<h3 id="section-message-interpolation"><a class="anchor" href="#section-message-interpolation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1。</font><font style="vertical-align: inherit;">默认消息插值</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从所谓的消息描述符中检索约束违规消息。</font><font style="vertical-align: inherit;">每个约束使用message属性定义其默认消息描述符。</font><font style="vertical-align: inherit;">在声明时，可以使用特定值覆盖默认描述符，如</font></font><a href="#example-overriding-message"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例4.1“使用消息属性指定消息描述符”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-overriding-message" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例4.1：使用message属性指定消息描述符</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter04</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pun">(</span><span class="pln">message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"The manufacturer name must not be null"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//constructor, getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果违反约束，则验证引擎将使用当前配置的插值对其描述符进行插值</font></font><code>MessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后可以通过调用从结果约束违反中检索插值的错误消息</font></font><code>ConstraintViolation#getMessage()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息描述符可以包含</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息参数</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font><font style="vertical-align: inherit;">将在插值期间解析的</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息表达式</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">消息参数是包含在其中的字符串文字</font></font><code>{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而消息表达式是包含在其中的字符串文字</font></font><code>${}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在方法插值期间应用以下算法：</font></font></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用它们作为资源包</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidationMessages的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键来解析任何消息参数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果此捆绑包包含给定消息参数的条目，则该参数将在消息中替换为捆绑包中的相应值。</font><font style="vertical-align: inherit;">如果替换值再次包含消息参数，则将以递归方式执行此步骤。</font><font style="vertical-align: inherit;">资源包应该由应用程序开发人员提供，例如通过向</font><font style="vertical-align: inherit;">类路径</font><font style="vertical-align: inherit;">添加名为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidationMessages.properties</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的文件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您还可以通过提供此捆绑包的特定于语言环境的变体来创建本地化的错误消息，例如</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidationMessages_en_US.properties</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，</font></font><code>Locale#getDefault()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查找包中的邮件时将使用</font><font style="vertical-align: inherit;">JVM的默认语言环境（</font><font style="vertical-align: inherit;">）。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用它们作为资源包的密钥来解析任何消息参数，该资源包包含Bean验证规范的附录B中定义的内置约束的标准错误消息。</font><font style="vertical-align: inherit;">在Hibernate Validator的情况下，此包被命名
 </font></font><code>org.hibernate.validator.ValidationMessages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果该步骤触发替换，则再次执行步骤1，否则应用步骤3。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过将其替换为具有相同名称的约束注释成员的值来解析任何消息参数。</font><font style="vertical-align: inherit;">这允许</font></font><code>Size#min()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在错误消息中</font><font style="vertical-align: inherit;">引用约束的属性值（例如</font><font style="vertical-align: inherit;">）（例如，“必须至少为$ {min}”）。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过将它们评估为统一表达式语言的表达式来解析任何消息表达式。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">在错误消息中使用Unified EL的详细</font></font><a href="#section-interpolation-with-message-expressions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a href="#section-interpolation-with-message-expressions"><font style="vertical-align: inherit;">第4.1.2节“使用消息表达式</font></a><font style="vertical-align: inherit;">进行</font><a href="#section-interpolation-with-message-expressions"><font style="vertical-align: inherit;">插值”</font></a><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以</font><font style="vertical-align: inherit;">
在Bean Validation规范的</font></font><a href="http://beanvalidation.org/2.0/spec/#validationapi-message-defaultmessageinterpolation-resolutionalgorithm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3.1.1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节中找到插值算法的正式定义
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="section-special-characters"><a class="anchor" href="#section-special-characters"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1.1。</font><font style="vertical-align: inherit;">特殊字符</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于字符</font></font><code>{</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在消息描述符有特殊的意义，他们需要进行转义，如果你想从字面上使用它们。</font><font style="vertical-align: inherit;">以下规则适用：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>\{</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 被视为文字 </font></font><code>{</code></p>
</li>
<li>
<p><code>\}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 被视为文字 </font></font><code>}</code></p>
</li>
<li>
<p><code>\$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 被视为文字 </font></font><code>$</code></p>
</li>
<li>
<p><code>\\</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 被视为文字 </font></font><code>\</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="section-interpolation-with-message-expressions"><a class="anchor" href="#section-interpolation-with-message-expressions"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1.2。</font><font style="vertical-align: inherit;">使用消息表达式进行插值</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从Hibernate Validator 5（Bean Validation 1.1）开始，可以</font><font style="vertical-align: inherit;">在约束违规消息中</font><font style="vertical-align: inherit;">使用统一表达式语言（由</font></font><a href="http://jcp.org/en/jsr/detail?id=341"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 341</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义</font><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这允许基于条件逻辑定义错误消息，并且还启用高级格式化选项。</font><font style="vertical-align: inherit;">验证引擎在EL上下文中提供以下对象：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射到属性名称的约束的属性值</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名为</font><em><font style="vertical-align: inherit;">validatedValue</font></em><font style="vertical-align: inherit;">的当前验证值（属性，bean，方法参数等）</font></font><em><font style="vertical-align: inherit;"></font></em></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射到名称格式化程序的bean，公开</font></font><code>format(String format, Object…​ args)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行为类似
 </font><font style="vertical-align: inherit;">的var-arg方法
 </font></font><code>java.util.Formatter.format(String format, Object…​ args)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下部分提供了在错误消息中使用EL表达式的几个示例。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="_examples"><a class="anchor" href="#_examples"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.1.3。</font><font style="vertical-align: inherit;">例子</font></font></h4>
<div class="paragraph">
<p><a href="#example-message-descriptors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例4.2“指定消息描述符”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何使用不同的选项来指定消息描述符。</font></font></p>
</div>
<div id="example-message-descriptors" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例4.2：指定消息描述符</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter04</span><span class="pun">.</span><span class="pln">complete</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">
            min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln">
            max </span><span class="pun">=</span><span class="pln"> </span><span class="lit">14</span><span class="pun">,</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"The license plate '${validatedValue}' must be between {min} and {max} characters long"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licensePlate</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Min</span><span class="pun">(</span><span class="pln">
            value </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"There must be at least {value} seat${value &gt; 1 ? 's' : ''}"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@DecimalMax</span><span class="pun">(</span><span class="pln">
            value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"350"</span><span class="pun">,</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"The top speed ${formatter.format('%1$.2f', validatedValue)} is higher "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                    </span><span class="str">"than {value}"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> topSpeed</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@DecimalMax</span><span class="pun">(</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"100000"</span><span class="pun">,</span><span class="pln"> message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Price must not be higher than ${value}"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> price</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">String</span><span class="pln"> licensePlate</span><span class="pun">,</span><span class="pln">
            </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">,</span><span class="pln">
            </span><span class="kwd">double</span><span class="pln"> topSpeed</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">BigDecimal</span><span class="pln"> price</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">licensePlate </span><span class="pun">=</span><span class="pln"> licensePlate</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">seatCount </span><span class="pun">=</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">topSpeed </span><span class="pun">=</span><span class="pln"> topSpeed</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">price </span><span class="pun">=</span><span class="pln"> price</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证无效</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例会产生约束违规，并使用</font></font><a href="#example-expected-error-messages"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例4.3“预期错误消息”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的断言</font><a href="#example-expected-error-messages"><font style="vertical-align: inherit;">显示消息</font></a><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对</font></font><code>manufacturer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">导致错误消息“不能为空”，因为这是Bean Validation规范定义的缺省消息，并且消息属性中没有给出特定的描述符</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段</font></font><code>@Size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束</font></font><code>licensePlate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示消息参数（</font></font><code>{min}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>{max}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的插值</font><font style="vertical-align: inherit;">以及如何使用EL表达式将验证值添加到错误消息中</font></font><code>${validatedValue}</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>@Min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上约束</font></font><code>seatCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示了如何使用一个EL表达式与三元表达式来动态地选择单数或复数形式，这取决于约束的属性（“必须有至少1座”与“必须有至少2个座位” ）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"></font><code>@DecimalMax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">的消息</font></font><code>topSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示如何使用格式化程序实例格式化经过验证的值</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，</font></font><code>@DecimalMax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font></font><code>price</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表明参数插值优先于表达式评估，导致</font></font><code>$</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符号出现在最高价格之前</font></font></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只能使用表单中的消息参数来插入实际约束属性
 </font></font><code>{attributeName}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当引用添加到插值上下文的验证值或自定义表达式变量时（参见</font></font><a href="#section-hibernateconstraintvalidatorcontext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.11.1节“ </font></font><code>HibernateConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font></font><code>${attributeName}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用</font><font style="vertical-align: inherit;">表单中的EL表达式</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="example-expected-error-messages" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例4.3：预期的错误消息</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="str">"A"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">400.123456</span><span class="pun">,</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln"> </span><span class="lit">200000</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">String</span><span class="pln"> message </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validateProperty</span><span class="pun">(</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="str">"manufacturer"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"must not be null"</span><span class="pun">,</span><span class="pln"> message </span><span class="pun">);</span><span class="pln">

message </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validateProperty</span><span class="pun">(</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="str">"licensePlate"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"The license plate 'A' must be between 2 and 14 characters long"</span><span class="pun">,</span><span class="pln">
        message
</span><span class="pun">);</span><span class="pln">

message </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validateProperty</span><span class="pun">(</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="str">"seatCount"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"There must be at least 2 seats"</span><span class="pun">,</span><span class="pln"> message </span><span class="pun">);</span><span class="pln">

message </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validateProperty</span><span class="pun">(</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="str">"topSpeed"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"The top speed 400.12 is higher than 350"</span><span class="pun">,</span><span class="pln"> message </span><span class="pun">);</span><span class="pln">

message </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validateProperty</span><span class="pun">(</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="str">"price"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Price must not be higher than $100000"</span><span class="pun">,</span><span class="pln"> message </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-custom-message-interpolation"><a class="anchor" href="#section-custom-message-interpolation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2。</font><font style="vertical-align: inherit;">自定义消息插值</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果默认消息插值算法不符合您的要求，则还可以插入自定义</font></font><code>MessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义插补器必须实现该接口</font></font><code>javax.validation.MessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，实现必须是线程安全的。</font><font style="vertical-align: inherit;">建议自定义消息插值器将最终实现委托给默认插值器，可以通过它来获取
 </font></font><code>Configuration#getDefaultMessageInterpolator()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使用自定义消息插补器，必须通过在Bean Validation XML描述符</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置它来注册它</font><font style="vertical-align: inherit;">（参见
 </font></font><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.1节“在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">validation.xml中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置验证器工厂</font><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或者在引导a </font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
 </font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（分别参见</font></font><a href="#section-validator-factory-message-interpolator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2.1节“ </font></font><code>MessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
 </font></font><a href="#section-configuring-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.3节“配置验证器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="sect3">
<h4 id="section-resource-bundle-locator"><a class="anchor" href="#section-resource-bundle-locator"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.2.1。 </font></font><code>ResourceBundleLocator</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些用例中，您希望使用Bean Validation规范定义的消息插值算法，但要从</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidationMessages</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之外的其他资源包中检索错误消息
 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，Hibernate Validator的</font></font><code>ResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI可以提供帮助。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator中的默认消息插值器</font></font><code>ResourceBundleMessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将资源包的检索委托给该SPI。</font><font style="vertical-align: inherit;">使用备用bundle只需要</font></font><code>PlatformResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在引导时</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">带有bundle名称
 </font><font style="vertical-align: inherit;">的实例，</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font></font><a href="#example-using-specific-resource-bundle-locator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例4.4“使用特定资源包”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-specific-resource-bundle-locator" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例4.4：使用特定的资源包</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">messageInterpolator</span><span class="pun">(</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ResourceBundleMessageInterpolator</span><span class="pun">(</span><span class="pln">
                        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PlatformResourceBundleLocator</span><span class="pun">(</span><span class="pln"> </span><span class="str">"MyMessages"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当然，您也可以实现完全不同的</font></font><code>ResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，例如，它返回数据库中记录支持的包。</font><font style="vertical-align: inherit;">在这种情况下，您可以获取默认定位器
 </font></font><code>HibernateValidatorConfiguration#getDefaultResourceBundleLocator()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以将其用作自定义定位器的后备。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外</font></font><code>PlatformResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，Hibernate Validator提供了另一种开箱即用的资源包定位器实现，即</font></font><code>AggregateResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许从多个资源包中检索错误消息。</font><font style="vertical-align: inherit;">例如，您可以在多模块应用程序中使用此实现，您希望每个模块都有一个消息包。
</font></font><a href="#example-using-aggregate-resource-bundle-locator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例4.5，“使用</font></font><code>AggregateResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何使用</font></font><code>AggregateResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-aggregate-resource-bundle-locator" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例4.5：使用 </font></font><code>AggregateResourceBundleLocator</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">messageInterpolator</span><span class="pun">(</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ResourceBundleMessageInterpolator</span><span class="pun">(</span><span class="pln">
                        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AggregateResourceBundleLocator</span><span class="pun">(</span><span class="pln">
                                </span><span class="typ">Arrays</span><span class="pun">.</span><span class="pln">asList</span><span class="pun">(</span><span class="pln">
                                        </span><span class="str">"MyMessages"</span><span class="pun">,</span><span class="pln">
                                        </span><span class="str">"MyOtherMessages"</span><span class="pln">
                                </span><span class="pun">)</span><span class="pln">
                        </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，bundle按照传递给构造函数的顺序进行处理。</font><font style="vertical-align: inherit;">这意味着如果多个包包含给定消息键的条目，则该值将从包含该键的列表中的第一个包中获取。</font></font></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapter-groups"><a class="anchor" href="#chapter-groups"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.分组约束</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面章节中讨论</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ExecutableValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">讨论的</font><font style="vertical-align: inherit;">所有验证方法</font><font style="vertical-align: inherit;">也采用var-arg参数</font></font><code>groups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">到目前为止，我们一直忽略这个参数，但现在是时候仔细看看了。</font></font></p>
</div>
<div class="sect2">
<h3 id="_requesting_groups"><a class="anchor" href="#_requesting_groups"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1。</font><font style="vertical-align: inherit;">请求小组</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组允许您限制验证期间应用的约束集。</font><font style="vertical-align: inherit;">验证组的一个用例是UI向导，其中在每个步骤中仅应验证指定的约束子集。</font><font style="vertical-align: inherit;">目标组作为var-arg参数传递给相应的validate方法。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们来看一个例子吧。</font><font style="vertical-align: inherit;">类</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="#example-person"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施例5.1中，“实施例类</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上约束</font></font><code>name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于没有为此批注指定组，</font></font><code>javax.validation.groups.Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此假定</font><font style="vertical-align: inherit;">使用默认组
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当请求多个组时，评估组的顺序不确定。</font><font style="vertical-align: inherit;">如果未指定组，</font></font><code>javax.validation.groups.Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则假定</font><font style="vertical-align: inherit;">使用默认组</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="example-person" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.1：示例类 </font></font><code>Person</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">// getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font><code>Driver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="#example-driver"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施例5.2，“驱动程序”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">延伸</font></font><code>Person</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并增加了特性</font></font><code>age</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
 </font></font><code>hasDrivingLicense</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">司机必须年满18岁（</font></font><code>@Min(18)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）并持有驾驶执照（</font></font><code>@AssertTrue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">在这些属性上定义的两个约束都属于</font></font><code>DriverChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只是一个简单标记接口的组。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用接口使组的使用类型安全，并允许轻松重构。</font><font style="vertical-align: inherit;">它还意味着组可以通过类继承相互继承。</font><font style="vertical-align: inherit;">请参见</font></font><a href="#section-group-inheritance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.2节“组继承”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="example-driver" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.2：驱动程序</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Driver</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Min</span><span class="pun">(</span><span class="pln">
            value </span><span class="pun">=</span><span class="pln"> </span><span class="lit">18</span><span class="pun">,</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"You have to be 18 to drive a car"</span><span class="pun">,</span><span class="pln">
            groups </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DriverChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> age</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@AssertTrue</span><span class="pun">(</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"You first have to pass the driving test"</span><span class="pun">,</span><span class="pln">
            groups </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DriverChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> hasDrivingLicense</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Driver</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> name </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> passedDrivingTest</span><span class="pun">(</span><span class="kwd">boolean</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        hasDrivingLicense </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> getAge</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> age</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setAge</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> age</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">age </span><span class="pun">=</span><span class="pln"> age</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">DriverChecks</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，类</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href="#example-car"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.3，“Car”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）有一些约束，它们是默认组的一部分，</font><font style="vertical-align: inherit;">也是属性</font></font><code>@AssertTrue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的组</font><font style="vertical-align: inherit;">，表示汽车是否通过了有价值的测试。</font></font><code>CarChecks</code><font style="vertical-align: inherit;"></font><code>passedVehicleInspection</code><font style="vertical-align: inherit;"></font></p>
</div>
<div id="example-car" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.3：汽车</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> max </span><span class="pun">=</span><span class="pln"> </span><span class="lit">14</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licensePlate</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Min</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@AssertTrue</span><span class="pun">(</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"The car has to pass the vehicle inspection first"</span><span class="pun">,</span><span class="pln">
            groups </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> passedVehicleInspection</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Valid</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Driver</span><span class="pln"> driver</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licencePlate</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">licensePlate </span><span class="pun">=</span><span class="pln"> licencePlate</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">seatCount </span><span class="pun">=</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isPassedVehicleInspection</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> passedVehicleInspection</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setPassedVehicleInspection</span><span class="pun">(</span><span class="kwd">boolean</span><span class="pln"> passedVehicleInspection</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">passedVehicleInspection </span><span class="pun">=</span><span class="pln"> passedVehicleInspection</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Driver</span><span class="pln"> getDriver</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> driver</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setDriver</span><span class="pun">(</span><span class="typ">Driver</span><span class="pln"> driver</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">driver </span><span class="pun">=</span><span class="pln"> driver</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">// getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">CarChecks</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在示例中总共使用了三个不同的组：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的约束</font></font><code>Person.name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Car.manufacturer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>Car.licensePlate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Car.seatCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
都属于</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font></font><code>Driver.age</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Driver.hasDrivingLicense</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属于</font></font><code>DriverChecks</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font></font><code>Car.passedVehicleInspection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属于该组</font></font><code>CarChecks</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#example-drive-away"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.4“使用验证组”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何将不同的组合组合传递给</font></font><code>Validator#validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法会产生不同的验证结果。</font></font></p>
</div>
<div id="example-drive-away" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.4：使用验证组</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// create a car and check that everything is ok with it.</span><span class="pln">
</span><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"DD-AB-123"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// but has it passed the vehicle inspection?</span><span class="pln">
constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"The car has to pass the vehicle inspection first"</span><span class="pun">,</span><span class="pln">
        constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">// let's go to the vehicle inspection</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">setPassedVehicleInspection</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// now let's add a driver. He is 18, but has not passed the driving test yet</span><span class="pln">
</span><span class="typ">Driver</span><span class="pln"> john </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Driver</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
john</span><span class="pun">.</span><span class="pln">setAge</span><span class="pun">(</span><span class="pln"> </span><span class="lit">18</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">setDriver</span><span class="pun">(</span><span class="pln"> john </span><span class="pun">);</span><span class="pln">
constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DriverChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"You first have to pass the driving test"</span><span class="pun">,</span><span class="pln">
        constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">// ok, John passes the test</span><span class="pln">
john</span><span class="pun">.</span><span class="pln">passedDrivingTest</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DriverChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// just checking that everything is in order now</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln">
        car</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">Default</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">CarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">DriverChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">).</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><a href="#example-drive-away"><font style="vertical-align: inherit;">示例5.4中</font></a><font style="vertical-align: inherit;">的第一个</font></font><code>validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font></font><a href="#example-drive-away"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“使用验证组”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在没有显式组的情况下完成的。</font><font style="vertical-align: inherit;">没有验证错误，即使该属性</font></font><code>passedVehicleInspection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是默认值，</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为在此属性上定义的约束不属于默认组。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该</font></font><code>CarChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font><font style="vertical-align: inherit;">的下一次验证</font><font style="vertical-align: inherit;">失败，直到汽车通过车辆检查。</font></font><code>DriverChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于驾驶员尚未通过驾驶考试，因此将驾驶员</font><font style="vertical-align: inherit;">添加到汽车并</font><font style="vertical-align: inherit;">再次进行</font><font style="vertical-align: inherit;">验证会</font><font style="vertical-align: inherit;">产生一个约束违规。</font><font style="vertical-align: inherit;">仅在设置</font></font><code>passedDrivingTest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对</font></font><code>DriverChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">的验证</font><font style="vertical-align: inherit;">之后
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一次</font></font><code>validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用最终显示所有约束都通过验证所有已定义的组来传递。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="section-group-inheritance"><a class="anchor" href="#section-group-inheritance"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2。</font><font style="vertical-align: inherit;">组继承</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="#example-drive-away"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.4“使用验证组”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们需要调用</font></font><code>validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个验证组，或者逐个指定所有验证组。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，您可能希望定义一组包含另一个组的约束。</font><font style="vertical-align: inherit;">您可以使用组继承来实现。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="#example-supercar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.5“SuperCar”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们定义了</font></font><code>SuperCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><code>RaceCarChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展该</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组的组</font><font style="vertical-align: inherit;">和一个</font><font style="vertical-align: inherit;">组。</font><font style="vertical-align: inherit;">一个</font></font><code>SuperCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须被允许安全带在比赛运行。</font></font></p>
</div>
<div id="example-supercar" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.5：SuperCar</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">.</span><span class="pln">groupinheritance</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SuperCar</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@AssertTrue</span><span class="pun">(</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Race car must have a safety belt"</span><span class="pun">,</span><span class="pln">
            groups </span><span class="pun">=</span><span class="pln"> </span><span class="typ">RaceCarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> safetyBelt</span><span class="pun">;</span><span class="pln">

    </span><span class="com">// getters and setters ...</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">.</span><span class="pln">groupinheritance</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">groups</span><span class="pun">.</span><span class="typ">Default</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">RaceCarChecks</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Default</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的示例中，我们将检查</font></font><code>SuperCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有一个座位且没有安全带的车辆是否是有效车辆以及是否是有效的赛车。</font></font></p>
</div>
<div id="example-group-inheritance" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.6：使用组继承</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// create a supercar and check that it's valid as a generic Car</span><span class="pln">
</span><span class="typ">SuperCar</span><span class="pln"> superCar </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SuperCar</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"DD-AB-123"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pln">  </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"must be greater than or equal to 2"</span><span class="pun">,</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> superCar </span><span class="pun">).</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// check that this supercar is valid as generic car and also as race car</span><span class="pln">
</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">SuperCar</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> superCar</span><span class="pun">,</span><span class="pln"> </span><span class="typ">RaceCarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertThat</span><span class="pun">(</span><span class="pln"> constraintViolations </span><span class="pun">).</span><span class="pln">extracting</span><span class="pun">(</span><span class="pln"> </span><span class="str">"message"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">containsOnly</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"Race car must have a safety belt"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"must be greater than or equal to 2"</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一次调用时</font></font><code>validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们不指定组。</font><font style="vertical-align: inherit;">有一个验证错误，因为汽车必须至少有一个座位。</font><font style="vertical-align: inherit;">这是集团的约束</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第二次调用时，我们仅指定组</font></font><code>RaceCarChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有两个验证错误：一个是关于</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组中</font><font style="vertical-align: inherit;">缺少的座位</font><font style="vertical-align: inherit;">，另一个是关于组中没有安全带的事实</font></font><code>RaceCarChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="section-defining-group-sequences"><a class="anchor" href="#section-defining-group-sequences"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.3。</font><font style="vertical-align: inherit;">定义组序列</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，无论其属于哪个组，都不会按特定顺序评估约束。</font><font style="vertical-align: inherit;">但是，在某些情况下，控制约束的评估顺序很有用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="#example-drive-away"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.4“使用验证组”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的例子中，例如可以要求在检查汽车的道路价值之前首先通过所有默认汽车约束。</font><font style="vertical-align: inherit;">最后，在开走之前，应检查实际的驾驶员约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了实现这样的验证顺序，您只需要定义一个接口并对其进行注释</font></font><code>@GroupSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，定义必须验证</font></font><a href="#example-defining-group-sequence"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组的顺序</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参见
 </font><a href="#example-defining-group-sequence"><font style="vertical-align: inherit;">Example 5.7，“定义一个组序列”</font></a><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果序列组中至少有一个约束失败，则序列中以下组的约束都不会得到验证。</font></font></p>
</div>
<div id="example-defining-group-sequence" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.7：定义一个组序列</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">GroupSequence</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">groups</span><span class="pun">.</span><span class="typ">Default</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@GroupSequence</span><span class="pun">({</span><span class="pln"> </span><span class="typ">Default</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">DriverChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">OrderedChecks</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义序列的组和组成序列的组不得直接或间接地通过级联序列定义或组继承参与循环依赖。</font><font style="vertical-align: inherit;">如果评估包含这种圆形度的组，</font></font><code>GroupDefinitionException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则引发a。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，您可以使用</font></font><a href="#example-group-sequence"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例5.8“使用组序列”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示的新序列</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-group-sequence" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.8：使用组序列</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"DD-AB-123"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">setPassedVehicleInspection</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Driver</span><span class="pln"> john </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Driver</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
john</span><span class="pun">.</span><span class="pln">setAge</span><span class="pun">(</span><span class="pln"> </span><span class="lit">18</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
john</span><span class="pun">.</span><span class="pln">passedDrivingTest</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">setDriver</span><span class="pun">(</span><span class="pln"> john </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="typ">OrderedChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-default-group-class"><a class="anchor" href="#section-default-group-class"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4。</font><font style="vertical-align: inherit;">重新定义默认组序列</font></font></h3>
<div class="sect3">
<h4 id="_code_groupsequence_code"><a class="anchor" href="#_code_groupsequence_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.1。 </font></font><code>@GroupSequence</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了定义组序列之外，</font></font><code>@GroupSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释还允许重新定义给定类的默认组。</font><font style="vertical-align: inherit;">为此，只需将</font></font><code>@GroupSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到类中，并指定</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">注释中替换</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此类</font><font style="vertical-align: inherit;">的组序列</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#example-rental-car"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.9，“ </font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有重新定义的默认组的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><a href="#example-rental-car"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">引入了一个</font><a href="#example-rental-car"><font style="vertical-align: inherit;">带有重新定义的默认组</font></a><font style="vertical-align: inherit;">的新类</font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-rental-car" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.9：</font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有重新定义的默认组的类</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@GroupSequence</span><span class="pun">({</span><span class="pln"> </span><span class="typ">RentalChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@AssertFalse</span><span class="pun">(</span><span class="pln">message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"The car is currently rented out"</span><span class="pun">,</span><span class="pln"> groups </span><span class="pun">=</span><span class="pln"> </span><span class="typ">RentalChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> rented</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licencePlate</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> licencePlate</span><span class="pun">,</span><span class="pln"> seatCount </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isRented</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> rented</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setRented</span><span class="pun">(</span><span class="kwd">boolean</span><span class="pln"> rented</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">rented </span><span class="pun">=</span><span class="pln"> rented</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">RentalChecks</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此定义，您可以评估属于的约束</font></font><code>RentalChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>CarChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并
 </font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过仅请求</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组，如</font></font><a href="#example-testCarIsRented"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例5.10“验证具有重新定义的默认组的对象”中所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-testCarIsRented" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.10：使用重新定义的默认组验证对象</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">RentalCar</span><span class="pln"> rentalCar </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"DD-AB-123"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
rentalCar</span><span class="pun">.</span><span class="pln">setPassedVehicleInspection</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
rentalCar</span><span class="pun">.</span><span class="pln">setRented</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">RentalCar</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> rentalCar </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"Wrong message"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"The car is currently rented out"</span><span class="pun">,</span><span class="pln">
        constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

rentalCar</span><span class="pun">.</span><span class="pln">setRented</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> rentalCar </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于组和组序列定义中必须没有循环依赖关系，因此不能只添加</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新定义</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">的序列</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">相反，必须添加类本身。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组序列压倒一切的是本地的则上定义并不会传播到相关联的对象的类。</font><font style="vertical-align: inherit;">例如，这意味着添加</font></font><code>DriverChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到默认组序列</font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会产生任何影响。</font><font style="vertical-align: inherit;">只有该组</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">才会传播到驱动程序关联。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，您可以通过声明组转换规则来控制传播的组（请参见
 </font></font><a href="#section-group-conversion"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5节“组转换”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="_code_groupsequenceprovider_code"><a class="anchor" href="#_code_groupsequenceprovider_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.4.2。 </font></font><code>@GroupSequenceProvider</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了通过静态重新定义默认组序列之外</font></font><code>@GroupSequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，Hibernate Validator还提供了一个SPI，用于根据对象状态动态重新定义默认组序列。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，您需要实现接口</font></font><code>DefaultGroupSequenceProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并通过</font></font><code>@GroupSequenceProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">向目标类注册此实现</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在租车方案中，您可以动态添加，</font></font><code>CarChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如
 </font></font><a href="#example-implementing-using-default-group-sequence-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.11“实现和使用默认组序列提供程序”中所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-implementing-using-default-group-sequence-provider" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.11：实现和使用默认的组序列提供程序</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">.</span><span class="pln">groupsequenceprovider</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalCarGroupSequenceProvider</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DefaultGroupSequenceProvider</span><span class="pun">&lt;</span><span class="typ">RentalCar</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Class</span><span class="pun">&lt;?&gt;&gt;</span><span class="pln"> getValidationGroups</span><span class="pun">(</span><span class="typ">RentalCar</span><span class="pln"> car</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Class</span><span class="pun">&lt;?&gt;&gt;</span><span class="pln"> defaultGroupSequence </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;</span><span class="typ">Class</span><span class="pun">&lt;?&gt;&gt;();</span><span class="pln">
        defaultGroupSequence</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> car </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">car</span><span class="pun">.</span><span class="pln">isRented</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            defaultGroupSequence</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> </span><span class="typ">CarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> defaultGroupSequence</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">.</span><span class="pln">groupsequenceprovider</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@GroupSequenceProvider</span><span class="pun">(</span><span class="typ">RentalCarGroupSequenceProvider</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@AssertFalse</span><span class="pun">(</span><span class="pln">message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"The car is currently rented out"</span><span class="pun">,</span><span class="pln"> groups </span><span class="pun">=</span><span class="pln"> </span><span class="typ">RentalChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> rented</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licencePlate</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> licencePlate</span><span class="pun">,</span><span class="pln"> seatCount </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isRented</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> rented</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setRented</span><span class="pun">(</span><span class="kwd">boolean</span><span class="pln"> rented</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">rented </span><span class="pun">=</span><span class="pln"> rented</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-group-conversion"><a class="anchor" href="#section-group-conversion"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.5。</font><font style="vertical-align: inherit;">集团转换</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您想要与驾驶员检查一起验证与汽车相关的检查怎么办？</font><font style="vertical-align: inherit;">当然，您可以明确地将所需的组传递给validate调用，但是如果您希望将这些验证作为</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组验证的</font><font style="vertical-align: inherit;">一部分进行，该</font><font style="vertical-align: inherit;">怎么办？</font><font style="vertical-align: inherit;">这里</font></font><code>@ConvertGroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发挥作用，允许您在级联验证期间使用与最初请求的组不同的组。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们看一下</font></font><a href="#example-group-conversion-dedault-to-driver-checks"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.12“ </font></font><code>@ConvertGroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此处</font></font><code>@GroupSequence({
CarChecks.class, Car.class })</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于组合</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font><font style="vertical-align: inherit;">下的汽车相关约束</font><font style="vertical-align: inherit;">（请参见</font></font><a href="#section-default-group-class"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4节“重新定义默认组序列”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">还有一个</font></font><code>@ConvertGroup(from = Default.class, to =
DriverChecks.class)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保</font><font style="vertical-align: inherit;">在驱动程序关联的级联验证期间</font><font style="vertical-align: inherit;">将</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组转换为</font></font><code>DriverChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组。</font></font></p>
</div>
<div id="example-group-conversion-dedault-to-driver-checks" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.12：</font></font><code>@ConvertGroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">.</span><span class="pln">groupconversion</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Driver</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Min</span><span class="pun">(</span><span class="pln">
            value </span><span class="pun">=</span><span class="pln"> </span><span class="lit">18</span><span class="pun">,</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"You have to be 18 to drive a car"</span><span class="pun">,</span><span class="pln">
            groups </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DriverChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> age</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@AssertTrue</span><span class="pun">(</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"You first have to pass the driving test"</span><span class="pun">,</span><span class="pln">
            groups </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DriverChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> hasDrivingLicense</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Driver</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> passedDrivingTest</span><span class="pun">(</span><span class="kwd">boolean</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        hasDrivingLicense </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> getAge</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> age</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setAge</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> age</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">age </span><span class="pun">=</span><span class="pln"> age</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">// getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter05</span><span class="pun">.</span><span class="pln">groupconversion</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@GroupSequence</span><span class="pun">({</span><span class="pln"> </span><span class="typ">CarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> max </span><span class="pun">=</span><span class="pln"> </span><span class="lit">14</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licensePlate</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Min</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@AssertTrue</span><span class="pun">(</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"The car has to pass the vehicle inspection first"</span><span class="pun">,</span><span class="pln">
            groups </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> passedVehicleInspection</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Valid</span><span class="pln">
    </span><span class="lit">@ConvertGroup</span><span class="pun">(</span><span class="kwd">from</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Default</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> to </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DriverChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Driver</span><span class="pln"> driver</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licencePlate</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">licensePlate </span><span class="pun">=</span><span class="pln"> licencePlate</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">seatCount </span><span class="pun">=</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isPassedVehicleInspection</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> passedVehicleInspection</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setPassedVehicleInspection</span><span class="pun">(</span><span class="kwd">boolean</span><span class="pln"> passedVehicleInspection</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">passedVehicleInspection </span><span class="pun">=</span><span class="pln"> passedVehicleInspection</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Driver</span><span class="pln"> getDriver</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> driver</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setDriver</span><span class="pun">(</span><span class="typ">Driver</span><span class="pln"> driver</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">driver </span><span class="pun">=</span><span class="pln"> driver</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">// getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，</font></font><a href="#example-group-conversion-test"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例5.13中</font></font><code>@ConvertGroup</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的验证</font><a href="#example-group-conversion-test"><font style="vertical-align: inherit;">“测试用例</font></a><a href="#example-group-conversion-test"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">成功，即使约束</font></font><code>hasDrivingLicense</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属于该</font></font><code>DriverChecks</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组，并且</font></font><code>Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>validate()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用中</font><font style="vertical-align: inherit;">仅</font><font style="vertical-align: inherit;">请求</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">组</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-group-conversion-test" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.13：测试用例 </font></font><code>@ConvertGroup</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">// create a car and validate. The Driver is still null and does not get validated</span><span class="pln">
</span><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"VW"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"USD-123"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">setPassedVehicleInspection</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// create a driver who has not passed the driving test</span><span class="pln">
</span><span class="typ">Driver</span><span class="pln"> john </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Driver</span><span class="pun">(</span><span class="pln"> </span><span class="str">"John Doe"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
john</span><span class="pun">.</span><span class="pln">setAge</span><span class="pun">(</span><span class="pln"> </span><span class="lit">18</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">// now let's add a driver to the car</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">setDriver</span><span class="pun">(</span><span class="pln"> john </span><span class="pun">);</span><span class="pln">
constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"The driver constraint should also be validated as part of the default group"</span><span class="pun">,</span><span class="pln">
        constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">(),</span><span class="pln">
        </span><span class="str">"You first have to pass the driving test"</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以在任何</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用的</font><font style="vertical-align: inherit;">地方定义组转换</font><font style="vertical-align: inherit;">，即关联以及方法和构造函数参数以及返回值。</font><font style="vertical-align: inherit;">可以使用指定多次转换
 </font></font><code>@ConvertGroup.List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，以下限制适用：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@ConvertGroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须只与...结合使用</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果没有使用，
 </font></font><code>ConstraintDeclarationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则抛出a。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在具有相同值的相同元素上具有多个转换规则是不合法的。</font><font style="vertical-align: inherit;">在这种情况下，a </font></font><code>ConstraintDeclarationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被提出。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>from</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性不得引用组序列。</font></font><code>ConstraintDeclarationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下提出了</font><font style="vertical-align: inherit;">A.</font></font></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规则不会递归执行。</font><font style="vertical-align: inherit;">使用第一个匹配转换规则，忽略后续规则。</font><font style="vertical-align: inherit;">例如，如果一组</font></font><code>@ConvertGroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明链组</font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
 </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><code>C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，基团</font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将转化为</font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font><code>C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validator-customconstraints"><a class="anchor" href="#validator-customconstraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.创建自定义约束</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation API定义了一整套标准约束注释，例如</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>@Size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等等。如果这些内置约束不够，您可以轻松创建根据您的特定验证要求定制的自定义约束。</font></font></p>
</div>
<div class="sect2">
<h3 id="validator-customconstraints-simple"><a class="anchor" href="#validator-customconstraints-simple"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1。</font><font style="vertical-align: inherit;">创建一个简单的约束</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要创建自定义约束，需要执行以下三个步骤：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建约束注释</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现验证器</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义默认错误消息</font></font></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="validator-customconstraints-constraintannotation"><a class="anchor" href="#validator-customconstraints-constraintannotation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1。</font><font style="vertical-align: inherit;">约束注释</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节介绍如何编写约束注释，该注释可用于确保给定字符串完全是大写或小写。</font><font style="vertical-align: inherit;">稍后，此约束将应用于</font><a href="#validator-gettingstarted"><font style="vertical-align: inherit;">第1章“ </font></a><a href="#validator-gettingstarted"><em><font style="vertical-align: inherit;">开始”</font></em></a><font style="vertical-align: inherit;">以确保该字段始终为大写字符串</font></font><code>licensePlate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">的字段。</font></font><a href="#validator-gettingstarted"><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em></a><font style="vertical-align: inherit;"></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先需要的是表达两种案例模式的方法。</font><font style="vertical-align: inherit;">虽然您可以使用</font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常量，但更好的方法是使用枚举来实现此目的：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.1：Enum </font></font><code>CaseMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示大写与小写</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">CaseMode</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    UPPER</span><span class="pun">,</span><span class="pln">
    LOWER</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步是定义实际约束注释。</font><font style="vertical-align: inherit;">如果您之前从未设计过注释，这可能看起来有些可怕，但实际上并不是那么难：</font></font></p>
</div>
<div id="example-defining-custom-constraint" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.2：定义</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束注释</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">ANNOTATION_TYPE</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">FIELD</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">METHOD</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">PARAMETER</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">TYPE_USE</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">RUNTIME</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@Target</span><span class="pun">({</span><span class="pln"> FIELD</span><span class="pun">,</span><span class="pln"> METHOD</span><span class="pun">,</span><span class="pln"> PARAMETER</span><span class="pun">,</span><span class="pln"> ANNOTATION_TYPE</span><span class="pun">,</span><span class="pln"> TYPE_USE </span><span class="pun">})</span><span class="pln">
</span><span class="lit">@Retention</span><span class="pun">(</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Constraint</span><span class="pun">(</span><span class="pln">validatedBy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">CheckCaseValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Documented</span><span class="pln">
</span><span class="lit">@Repeatable</span><span class="pun">(</span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">CheckCase</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="str">"{org.hibernate.validator.referenceguide.chapter06.CheckCase."</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"message}"</span><span class="pun">;</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?&gt;[]</span><span class="pln"> groups</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pun">&gt;[]</span><span class="pln"> payload</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">

    </span><span class="typ">CaseMode</span><span class="pln"> value</span><span class="pun">();</span><span class="pln">

    </span><span class="lit">@Target</span><span class="pun">({</span><span class="pln"> FIELD</span><span class="pun">,</span><span class="pln"> METHOD</span><span class="pun">,</span><span class="pln"> PARAMETER</span><span class="pun">,</span><span class="pln"> ANNOTATION_TYPE </span><span class="pun">})</span><span class="pln">
    </span><span class="lit">@Retention</span><span class="pun">(</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@Documented</span><span class="pln">
    </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">List</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">CheckCase</span><span class="pun">[]</span><span class="pln"> value</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>@interface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字</font><font style="vertical-align: inherit;">定义注释类型</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">注释类型的所有属性都以类似方法的方式声明。</font><font style="vertical-align: inherit;">Bean Validation API的规范要求，任何约束注释都定义：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"></font><code>message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在违反约束的情况下返回用于创建错误消息的默认键</font><font style="vertical-align: inherit;">的属性</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"></font><code>groups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许指定此约束所属的验证组</font><font style="vertical-align: inherit;">的属性</font><font style="vertical-align: inherit;">（请参阅</font></font><a href="#chapter-groups"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组约束</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这必须默认为Class &lt;？&gt;类型的空数组。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"></font><code>payload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation API的客户端可以使用</font><font style="vertical-align: inherit;">的属性</font><font style="vertical-align: inherit;">将自定义有效内容对象分配给约束。</font><font style="vertical-align: inherit;">API本身不使用此属性。</font><font style="vertical-align: inherit;">自定义有效负载的示例可以是严重性的定义：</font></font></p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Severity</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Info</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Error</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ContactDetails</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@NotNull</span><span class="pun">(</span><span class="pln">message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Name is mandatory"</span><span class="pun">,</span><span class="pln"> payload </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Severity</span><span class="pun">.</span><span class="typ">Error</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pun">(</span><span class="pln">message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Phone number not specified, but not mandatory"</span><span class="pun">,</span><span class="pln">
            payload </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Severity</span><span class="pun">.</span><span class="typ">Info</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> phoneNumber</span><span class="pun">;</span><span class="pln">

    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，客户端可以在验证</font></font><code>ContactDetails</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例后访问约束的严重性，</font></font><code>ConstraintViolation.getConstraintDescriptor().getPayload()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并根据严重性调整其行为。</font></font></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了这三个强制属性之外，还有另一个属性</font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，允许指定所需的案例模式。</font><font style="vertical-align: inherit;">该名称</font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个特殊</font><font style="vertical-align: inherit;">的名称</font><font style="vertical-align: inherit;">，在使用注释时可以省略，如果它是指定的唯一属性，例如在</font></font><code>@CheckCase(CaseMode.UPPER)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，约束注释使用几个元注释进行修饰：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Target({ FIELD, METHOD, PARAMETER, ANNOTATION_TYPE, TYPE_USE})</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：定义约束的受支持目标元素类型。</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于字段（元素类型</font></font><code>FIELD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），JavaBeans属性以及方法返回值（</font></font><code>METHOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），方法/构造函数参数（</font></font><code>PARAMETER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和参数化类型的类型参数（</font></font><code>TYPE_USE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">元素类型</font></font><code>ANNOTATION_TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许基于创建组合约束（参见</font></font><a href="#section-constraint-composition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4节“约束组合”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在创建类级约束时（请参见</font></font><a href="#validator-usingvalidator-classlevel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.1.4节“类级约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font></font><code>TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用</font><font style="vertical-align: inherit;">元素类型</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">针对构造函数返回值的约束需要支持元素类型</font></font><code>CONSTRUCTOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">用于一起验证方法或构造函数的所有参数的</font><font style="vertical-align: inherit;">交叉参数约束（参见
 </font></font><a href="#section-cross-parameter-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.3节“交叉参数约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）必须</font><font style="vertical-align: inherit;">分别</font><font style="vertical-align: inherit;">支持</font></font><code>METHOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>CONSTRUCTOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</li>
<li>
<p><code>@Retention(RUNTIME)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：指定此类型的注释在运行时可通过反射方式获得</font></font></p>
</li>
<li>
<p><code>@Constraint(validatedBy = CheckCaseValidator.class)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：将注释类型标记为约束注释，并指定用于验证带注释的元素的验证器</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果可以对多种数据类型使用约束，则可以指定多个验证器，每种数据类型一个。</font></font></p>
</li>
<li>
<p><code>@Documented</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：说，使用</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它将包含在用它注释的元素的JavaDoc中</font></font></p>
</li>
<li>
<p><code>@Repeatable(List.class)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：表示注释可以在同一位置重复多次，通常使用不同的配置。</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是包含注释类型。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个包含注释类型的名称</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也显示在示例中。</font><font style="vertical-align: inherit;">它允许</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在同一元素上</font><font style="vertical-align: inherit;">指定多个
 </font><font style="vertical-align: inherit;">注释，例如使用不同的验证组和消息。</font><font style="vertical-align: inherit;">虽然可以使用其他名称，但Bean Validation规范建议使用该名称
 </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使注释成为相应约束类型的内部注释。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="section-constraint-validator"><a class="anchor" href="#section-constraint-validator"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2。</font><font style="vertical-align: inherit;">约束验证器</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义了注释后，您需要创建一个约束验证器，它能够使用</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">验证元素</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为此，请实现Bean Validation接口</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，如下所示：</font></font></p>
</div>
<div id="example-constraint-validator" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.3：为约束实现约束验证器 </font></font><code>@CheckCase</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CheckCaseValidator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;</span><span class="typ">CheckCase</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">CaseMode</span><span class="pln"> caseMode</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">CheckCase</span><span class="pln"> constraintAnnotation</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">caseMode </span><span class="pun">=</span><span class="pln"> constraintAnnotation</span><span class="pun">.</span><span class="pln">value</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> constraintContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> caseMode </span><span class="pun">==</span><span class="pln"> </span><span class="typ">CaseMode</span><span class="pun">.</span><span class="pln">UPPER </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口定义了其在执行设置两个类型参数。</font><font style="vertical-align: inherit;">第一个指定要验证的注释类型（</font></font><code>CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），第二个指定验证器可以处理的元素类型（</font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果约束支持多种数据类型，</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则必须在约束注释中实现并注册每个允许类型，如上所示。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证器的实现很简单。</font><font style="vertical-align: inherit;">该</font></font><code>initialize()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法使您可以访问已验证约束的属性值，并允许您将它们存储在验证器的字段中，如示例中所示。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>isValid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法包含实际的验证逻辑。</font><font style="vertical-align: inherit;">为此</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，检查给定字符串是完全小写还是大写，具体取决于检索到的案例模式</font></font><code>initialize()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，Bean Validation规范建议将空值视为有效。</font><font style="vertical-align: inherit;">如果</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是元素的有效值，则应</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
明确</font><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect4">
<h5 id="_the_code_constraintvalidatorcontext_code"><a class="anchor" href="#_the_code_constraintvalidatorcontext_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.1。</font><font style="vertical-align: inherit;">该</font></font><code>ConstraintValidatorContext</code></h5>
<div class="paragraph">
<p><a href="#example-constraint-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.3“为约束实现约束验证器</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
依赖于仅返回</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><code>isValid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
方法</font><font style="vertical-align: inherit;">生成的默认错误消息</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用传递的</font></font><code>ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象，可以添加其他错误消息或完全禁用默认错误消息生成，并仅单独定义自定义错误消息。</font><font style="vertical-align: inherit;">该</font></font><code>ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API被建模为连贯接口和用一个例子是最好的证明：</font></font></p>
</div>
<div id="example-constraint-validator-context" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.4：</font></font><code>ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于定义自定义错误消息</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">constraintvalidatorcontext</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CheckCaseValidator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;</span><span class="typ">CheckCase</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">CaseMode</span><span class="pln"> caseMode</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">CheckCase</span><span class="pln"> constraintAnnotation</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">caseMode </span><span class="pun">=</span><span class="pln"> constraintAnnotation</span><span class="pun">.</span><span class="pln">value</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> constraintContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> caseMode </span><span class="pun">==</span><span class="pln"> </span><span class="typ">CaseMode</span><span class="pun">.</span><span class="pln">UPPER </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            isValid </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            isValid </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln">isValid </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            constraintContext</span><span class="pun">.</span><span class="pln">disableDefaultConstraintViolation</span><span class="pun">();</span><span class="pln">
            constraintContext</span><span class="pun">.</span><span class="pln">buildConstraintViolationWithTemplate</span><span class="pun">(</span><span class="pln">
                    </span><span class="str">"{org.hibernate.validator.referenceguide.chapter06."</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                    </span><span class="str">"constraintvalidatorcontext.CheckCase.message}"</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">addConstraintViolation</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> isValid</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#example-constraint-validator-context"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例6.4，“ </font></font><code>ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于定义自定义错误消息”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
显示如何禁用默认错误消息生成并使用指定的消息模板添加自定义错误消息。</font><font style="vertical-align: inherit;">在此示例中，</font></font><code>ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">与默认错误消息生成相同的错误消息。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过调用添加每个配置的约束违规非常重要</font></font><code>addConstraintViolation()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">只有在那之后才会创建新的约束违规。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，自定义消息模板将直接传递给表达式语言引擎。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，在将用户输入集成到自定义消息模板中时应该非常小心，因为它将由表达式语言引擎解释，这通常不是您期望的行为，并且可能允许恶意用户泄露敏感数据。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您需要集成用户输入，您应该：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要么通过使用</font></font><a href="http://beanvalidation.org/2.0/spec/#validationapi-message-defaultmessageinterpolation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation消息插值转义规则</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来逃避它</font><font style="vertical-align: inherit;">;</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，更好的是，</font></font><a href="#section-hibernateconstraintvalidatorcontext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展开上下文</font><a href="#section-hibernateconstraintvalidatorcontext"><font style="vertical-align: inherit;">将其作为消息参数或表达式变量传递</font></a><font style="vertical-align: inherit;">给</font></font><code>HibernateConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅</font></font><a href="#section-custom-property-paths"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.2.1节“自定义属性路径”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以了解如何使用</font></font><code>ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API来控制类级别约束的约束违规的属性路径。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="constraint-validator-hibernateconstraintvalidator"><a class="anchor" href="#constraint-validator-hibernateconstraintvalidator"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.2。</font><font style="vertical-align: inherit;">该</font></font><code>HibernateConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator提供了</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合同</font><font style="vertical-align: inherit;">的扩展</font><font style="vertical-align: inherit;">：</font></font><code>HibernateConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此扩展的目的是为方法提供更多上下文信息，</font></font><code>initialize()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为在当前</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合同中，只有注释作为参数传递。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>initialize()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><code>HibernateConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有两个参数：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code>ConstraintDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手头的约束。</font><font style="vertical-align: inherit;">您可以使用访问权限</font></font><code>ConstraintDescriptor#getAnnotation()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>HibernateConstraintValidatorInitializationContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其提供有用的工具和上下文信息，如时钟提供者或时间验证的耐受性。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此扩展标记为孵化，因此可能会发生变化。</font><font style="vertical-align: inherit;">计划是将其标准化并在将来将其包含在Bean Validation中。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了如何基于验证器</font></font><code>HibernateConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div id="example-constraint-validator-hibernateconstraintvalidator" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.5：使用</font></font><code>HibernateConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合同</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyFutureValidator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">HibernateConstraintValidator</span><span class="pun">&lt;</span><span class="typ">MyFuture</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Instant</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Clock</span><span class="pln"> clock</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> orPresent</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">ConstraintDescriptor</span><span class="pun">&lt;</span><span class="typ">MyFuture</span><span class="pun">&gt;</span><span class="pln"> constraintDescriptor</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">HibernateConstraintValidatorInitializationContext</span><span class="pln"> initializationContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">orPresent </span><span class="pun">=</span><span class="pln"> constraintDescriptor</span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">().</span><span class="pln">orPresent</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">clock </span><span class="pun">=</span><span class="pln"> initializationContext</span><span class="pun">.</span><span class="pln">getClockProvider</span><span class="pun">().</span><span class="pln">getClock</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">Instant</span><span class="pln"> instant</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> constraintContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您应该只实现其中一种</font></font><code>initialize()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。</font><font style="vertical-align: inherit;">请注意，在初始化验证程序时会调用它们。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="constraint-validator-payload"><a class="anchor" href="#constraint-validator-payload"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.2.3。</font><font style="vertical-align: inherit;">将有效负载传递给约束验证器</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有时，您可能希望在某些外部参数上调节约束验证器行为。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，如果每个国家/地区有一个实例，则您的邮政编码验证程序可能会因应用程序实例的区域设置而异。</font><font style="vertical-align: inherit;">另一个要求可能是在特定环境中具有不同的行为：登台环境可能无法访问验证器正确运行所必需的某些外部生产资源。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为所有这些用例引入了约束验证器有效载荷的概念。</font><font style="vertical-align: inherit;">它是一个通过</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">从</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">到每个约束验证器的对象</font></font><code>HibernateConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的示例显示了如何在</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化</font><font style="vertical-align: inherit;">期间设置约束验证器有效负载</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">除非您覆盖此默认值，否则由此</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建的</font><font style="vertical-align: inherit;">所有</font><font style="vertical-align: inherit;">s </font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都将设置此约束验证器有效内容值。</font></font></p>
</div>
<div id="example-constraint-validator-payload-definition-validatorfactory" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.6：在</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化</font><font style="vertical-align: inherit;">期间定义约束验证器有效负载</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">constraintValidatorPayload</span><span class="pun">(</span><span class="pln"> </span><span class="str">"US"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一种选择是</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用上下文</font><font style="vertical-align: inherit;">设置约束验证器有效负载</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div id="example-constraint-validator-payload-definition-validatorcontext" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.7：使用</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文</font><font style="vertical-align: inherit;">定义约束验证器有效负载</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">HibernateValidatorFactory</span><span class="pln"> hibernateValidatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidatorFactory</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> hibernateValidatorFactory</span><span class="pun">.</span><span class="pln">usingContext</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">constraintValidatorPayload</span><span class="pun">(</span><span class="pln"> </span><span class="str">"US"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span><span class="pln">

</span><span class="com">// [...] US specific validation checks</span><span class="pln">

validator </span><span class="pun">=</span><span class="pln"> hibernateValidatorFactory</span><span class="pun">.</span><span class="pln">usingContext</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">constraintValidatorPayload</span><span class="pun">(</span><span class="pln"> </span><span class="str">"FR"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span><span class="pln">

</span><span class="com">// [...] France specific validation checks</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置约束验证器有效负载后，可以在约束验证器中使用它，如下例所示：</font></font></p>
</div>
<div id="example-constraint-validator-payload-usage" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.8：在约束验证器中使用约束验证器有效载荷</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">constraintvalidatorpayload</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ZipCodeValidator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;</span><span class="typ">ZipCode</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> countryCode</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> constraintContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">boolean</span><span class="pln"> isValid </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">

        </span><span class="typ">String</span><span class="pln"> countryCode </span><span class="pun">=</span><span class="pln"> constraintContext
                </span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateConstraintValidatorContext</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">getConstraintValidatorPayload</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="str">"US"</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> countryCode </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// checks specific to the United States</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="str">"FR"</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> countryCode </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// checks specific to France</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="com">// ...</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> isValid</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>HibernateConstraintValidatorContext#getConstraintValidatorPayload()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 有一个类型参数，只有在有效载荷属于给定类型时才返回有效载荷。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请务必注意，约束验证器有效负载与您可以包含在引发的约束违规中的动态有效负载不同。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此约束验证器有效内容的整个目的是用于调节约束验证器的行为。</font><font style="vertical-align: inherit;">它不包含在约束违规中，除非特定</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现通过使用</font></font><a href="#section-dynamic-payload"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束违规动态有效负载机制</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将有效负载传递给发出的约束违例</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="validator-customconstraints-errormessage"><a class="anchor" href="#validator-customconstraints-errormessage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.3。</font><font style="vertical-align: inherit;">错误消息</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一个缺失的构建块是一条错误消息，应该在</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
违反约束的</font><font style="vertical-align: inherit;">情况下使用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要定义它，请</font><font style="vertical-align: inherit;">使用以下内容</font><font style="vertical-align: inherit;">创建文件</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidationMessages.properties</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（另请参见</font></font><a href="#section-message-interpolation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.1节“默认消息插值”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.9：为</font></font><code>CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">定义自定义错误消息</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">org.hibernate.validator.referenceguide.chapter06.CheckCase.message =案例模式必须是{value}。</font></font></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果发生验证错误，验证运行时将使用您为</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">的message属性指定的默认值</font><font style="vertical-align: inherit;">来查找此资源束中的错误消息。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="validator-customconstraints-using"><a class="anchor" href="#validator-customconstraints-using"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.4。</font><font style="vertical-align: inherit;">使用约束</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您现在可以使用</font><a href="#validator-gettingstarted"><font style="vertical-align: inherit;">第1章“ </font></a><a href="#validator-gettingstarted"><em><font style="vertical-align: inherit;">入门”</font></em></a><font style="vertical-align: inherit;">一</font><a href="#validator-gettingstarted"><font style="vertical-align: inherit;">章</font></a><font style="vertical-align: inherit;">中的</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">来指定该</font><font style="vertical-align: inherit;">字段应仅包含大写字符串：</font></font><a href="#validator-gettingstarted"><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em></a><font style="vertical-align: inherit;"></font><code>licensePlate</code><font style="vertical-align: inherit;"></font></p>
</div>
<div id="example-car-with-checkcase" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.10：应用</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> max </span><span class="pun">=</span><span class="pln"> </span><span class="lit">14</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@CheckCase</span><span class="pun">(</span><span class="typ">CaseMode</span><span class="pun">.</span><span class="pln">UPPER</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licensePlate</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Min</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licencePlate</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">licensePlate </span><span class="pun">=</span><span class="pln"> licencePlate</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">seatCount </span><span class="pun">=</span><span class="pln"> seatCount</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，</font></font><a href="#example-using-checkcase"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.11“使用</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">验证对象</font><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示了如何</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用无效牌照</font><font style="vertical-align: inherit;">验证</font><font style="vertical-align: inherit;">实例会导致</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">违反约束。</font></font></p>
</div>
<div id="example-using-checkcase" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.11：使用</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">验证对象</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">//invalid license plate</span><span class="pln">
</span><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"dd-ab-123"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln">
        validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"Case mode must be UPPER."</span><span class="pun">,</span><span class="pln">
        constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//valid license plate</span><span class="pln">
car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Morris"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"DD-AB-123"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-class-level-constraints"><a class="anchor" href="#section-class-level-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2。</font><font style="vertical-align: inherit;">类级约束</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前所述，约束也可以应用于类级别以验证整个对象的状态。</font><font style="vertical-align: inherit;">类级别约束的定义方式与属性约束相同。
</font></font><a href="#example-implementing-classlevel-constraint"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example 6.12，“实现类级别约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了</font></font><code>@ValidPassengerCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您在</font></font><a href="#example-class-level"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例2.9“类级别约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中使用</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束的</font><font style="vertical-align: inherit;">约束注释和验证器
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-implementing-classlevel-constraint" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.12：实现类级约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">classlevel</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@Target</span><span class="pun">({</span><span class="pln"> TYPE</span><span class="pun">,</span><span class="pln"> ANNOTATION_TYPE </span><span class="pun">})</span><span class="pln">
</span><span class="lit">@Retention</span><span class="pun">(</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Constraint</span><span class="pun">(</span><span class="pln">validatedBy </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">ValidPassengerCountValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
</span><span class="lit">@Documented</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">ValidPassengerCount</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="str">"{org.hibernate.validator.referenceguide.chapter06.classlevel."</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"ValidPassengerCount.message}"</span><span class="pun">;</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?&gt;[]</span><span class="pln"> groups</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pun">&gt;[]</span><span class="pln"> payload</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">classlevel</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ValidPassengerCountValidator</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;</span><span class="typ">ValidPassengerCount</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">ValidPassengerCount</span><span class="pln"> constraintAnnotation</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">Car</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> car </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> car</span><span class="pun">.</span><span class="pln">getPassengers</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> car</span><span class="pun">.</span><span class="pln">getSeatCount</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如示例所示，您需要</font></font><code>TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>@Target</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释中</font><font style="vertical-align: inherit;">使用元素类型</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这允许将约束放在类型定义上。</font><font style="vertical-align: inherit;">示例中约束的验证器</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>isValid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法中</font><font style="vertical-align: inherit;">接收a </font><font style="vertical-align: inherit;">并且可以访问完整对象状态以确定给定实例是否有效。</font></font></p>
</div>
<div class="sect3">
<h4 id="section-custom-property-paths"><a class="anchor" href="#section-custom-property-paths"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.1。</font><font style="vertical-align: inherit;">自定义属性路径</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，在注释类型的级别上报告类级别约束的约束违例，例如</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，最好是违规的属性路径是指其中一个涉及的属性。</font><font style="vertical-align: inherit;">例如，您可能想要</font></font><code>@ValidPassengerCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对passenger属性而不是</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bean </font><font style="vertical-align: inherit;">报告</font><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#example-custom-error"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.13“ </font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用自定义属性路径</font><font style="vertical-align: inherit;">添加新内容</font><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
显示了如何通过使用传递给的约束验证器上下文来</font></font><code>isValid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为属性乘客构建自定义约束违例和属性节点来完成此操作。</font><font style="vertical-align: inherit;">请注意，您还可以添加多个属性节点，指向已验证bean的子实体。</font></font></p>
</div>
<div id="example-custom-error" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.13：</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用自定义属性路径</font><font style="vertical-align: inherit;">添加新内容</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">custompath</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ValidPassengerCountValidator</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;</span><span class="typ">ValidPassengerCount</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">ValidPassengerCount</span><span class="pln"> constraintAnnotation</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">Car</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> constraintValidatorContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> car </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">boolean</span><span class="pln"> isValid </span><span class="pun">=</span><span class="pln"> car</span><span class="pun">.</span><span class="pln">getPassengers</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> car</span><span class="pun">.</span><span class="pln">getSeatCount</span><span class="pun">();</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln">isValid </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            constraintValidatorContext</span><span class="pun">.</span><span class="pln">disableDefaultConstraintViolation</span><span class="pun">();</span><span class="pln">
            constraintValidatorContext
                    </span><span class="pun">.</span><span class="pln">buildConstraintViolationWithTemplate</span><span class="pun">(</span><span class="pln"> </span><span class="str">"{my.custom.template}"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">addPropertyNode</span><span class="pun">(</span><span class="pln"> </span><span class="str">"passengers"</span><span class="pln"> </span><span class="pun">).</span><span class="pln">addConstraintViolation</span><span class="pun">();</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> isValid</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-cross-parameter-constraints"><a class="anchor" href="#section-cross-parameter-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3。</font><font style="vertical-align: inherit;">交叉参数约束</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation区分两种不同的约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用约束（到目前为止已讨论过）适用于带注释的元素，例如类型，字段，容器元素，方法参数或返回值等。相反，交叉参数约束适用于方法的参数数组或构造函数，可用于表示依赖于几个参数值的验证逻辑。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了定义交叉参数约束，必须使用注释来验证其验证器类
 </font></font><code>@SupportedValidationTarget(ValidationTarget.PARAMETERS)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">类型参数</font></font><code>T</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从
 </font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口必须解决要么</font></font><code>Object</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>Object[]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以接收的方法/构造器参数阵列中的</font></font><code>isValid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例显示了交叉参数约束的定义，该约束可用于检查</font></font><code>Date</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法的</font><font style="vertical-align: inherit;">两个</font><font style="vertical-align: inherit;">参数的顺序是否正确：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.14：交叉参数约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">crossparameter</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@Constraint</span><span class="pun">(</span><span class="pln">validatedBy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ConsistentDateParametersValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Target</span><span class="pun">({</span><span class="pln"> METHOD</span><span class="pun">,</span><span class="pln"> CONSTRUCTOR</span><span class="pun">,</span><span class="pln"> ANNOTATION_TYPE </span><span class="pun">})</span><span class="pln">
</span><span class="lit">@Retention</span><span class="pun">(</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Documented</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">ConsistentDateParameters</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="str">"{org.hibernate.validator.referenceguide.chapter04."</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"crossparameter.ConsistentDateParameters.message}"</span><span class="pun">;</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?&gt;[]</span><span class="pln"> groups</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pun">&gt;[]</span><span class="pln"> payload</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的横参数约束的定义不是从限定通用约束的任何不同的，即它必须指定部件</font></font><code>message()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>groups()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code>payload()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和与进行注释
 </font></font><code>@Constraint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此元注释还指定了相应的验证器，如
 </font></font><a href="#example-cross-parameter-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.15“通用和交叉参数约束”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，除了元素类型之外</font></font><code>METHOD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>CONSTRUCTOR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
还</font></font><code>ANNOTATION_TYPE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定为注释的目标，以便能够基于创建组合约束</font></font><code>@ConsistentDateParameters</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参见
 </font></font><a href="#section-constraint-composition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4节“约束组合”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交叉参数约束直接在方法或构造函数的声明中指定，这也是返回值约束的情况。</font><font style="vertical-align: inherit;">因此，为了提高代码可读性，建议选择约束名称 - 例如</font></font><code>@ConsistentDateParameters</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 使约束目标明显。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="example-cross-parameter-validator" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.15：通用和交叉参数约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">crossparameter</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@SupportedValidationTarget</span><span class="pun">(</span><span class="typ">ValidationTarget</span><span class="pun">.</span><span class="pln">PARAMETERS</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ConsistentDateParametersValidator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln">
        </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;</span><span class="typ">ConsistentDateParameters</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">ConsistentDateParameters</span><span class="pln"> constraintAnnotation</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">length </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalArgumentException</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Illegal method signature"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="com">//leave null-checking to @NotNull on individual parameters</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> value</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> value</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!(</span><span class="pln"> value</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="pun">!(</span><span class="pln"> value</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalArgumentException</span><span class="pun">(</span><span class="pln">
                    </span><span class="str">"Illegal method signature, expected two "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                            </span><span class="str">"parameters of type Date."</span><span class="pln">
            </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Date</span><span class="pun">)</span><span class="pln"> value</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">).</span><span class="pln">before</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Date</span><span class="pun">)</span><span class="pln"> value</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如上所述，</font></font><code>PARAMETERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用</font></font><code>@SupportedValidationTarget</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">为交叉参数验证器配置</font><font style="vertical-align: inherit;">验证目标</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于交叉参数约束可以应用于任何方法或构造函数，因此在验证器实现中检查参数的预期数量和类型被认为是最佳实践。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与通用约束一样，</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数应被视为有效，并且</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应使用各个参数来确保参数不是</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与类级约束类似，您可以在验证交叉参数约束时在单个参数上创建自定义约束违规，而不是所有参数。</font><font style="vertical-align: inherit;">只需从</font></font><code>ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给</font><font style="vertical-align: inherit;">的节点构建器中获取</font></font><code>isValid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并通过调用添加参数节点
 </font></font><code>addParameterNode()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在该示例中，您可以使用此方法在已验证方法的结束日期参数上创建约束违规。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在极少数情况下，约束是泛型和交叉参数。</font><font style="vertical-align: inherit;">如果约束具有带有注释的验证器类，
 </font></font><code>@SupportedValidationTarget({ValidationTarget.PARAMETERS, ValidationTarget.ANNOTATED_ELEMENT})</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者如果它具有泛型和交叉参数验证器类，则会出现这种情况。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当在具有参数和返回值的方法上声明这样的约束时，不能确定预期的约束目标。</font><font style="vertical-align: inherit;">因此，同时具有通用和交叉参数</font></font><code>validationAppliesTo()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的约束</font><font style="vertical-align: inherit;">必须定义一个成员</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">该成员</font><font style="vertical-align: inherit;">允许约束用户指定约束的目标，如</font></font><a href="#example-dual-cross-parameter-constraint"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.16“通用和交叉参数约束”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-dual-cross-parameter-constraint" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.16：通用和交叉参数约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">crossparameter</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@Constraint</span><span class="pun">(</span><span class="pln">validatedBy </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">ScriptAssertObjectValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">ScriptAssertParametersValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="lit">@Target</span><span class="pun">({</span><span class="pln"> TYPE</span><span class="pun">,</span><span class="pln"> FIELD</span><span class="pun">,</span><span class="pln"> PARAMETER</span><span class="pun">,</span><span class="pln"> METHOD</span><span class="pun">,</span><span class="pln"> CONSTRUCTOR</span><span class="pun">,</span><span class="pln"> ANNOTATION_TYPE </span><span class="pun">})</span><span class="pln">
</span><span class="lit">@Retention</span><span class="pun">(</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Documented</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">ScriptAssert</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="str">"{org.hibernate.validator.referenceguide.chapter04."</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"crossparameter.ScriptAssert.message}"</span><span class="pun">;</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?&gt;[]</span><span class="pln"> groups</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pun">&gt;[]</span><span class="pln"> payload</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> script</span><span class="pun">();</span><span class="pln">

    </span><span class="typ">ConstraintTarget</span><span class="pln"> validationAppliesTo</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="typ">ConstraintTarget</span><span class="pun">.</span><span class="pln">IMPLICIT</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>@ScriptAssert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束具有两个验证程序（未示出），一个通用的和交参数之一，因此限定了构件</font></font><code>validationAppliesTo()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认值</font></font><code>IMPLICIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许在可能的情况下自动派生目标（例如，如果在字段上或在具有参数但没有返回值的方法上声明约束）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果无法隐式确定目标，则必须由用户将其设置为</font></font><code>PARAMETERS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者
 </font></font><code>RETURN_VALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font></font><a href="#example-dual-cross-parameter-constraint-usage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例6.17“为通用和交叉参数约束指定目标”中所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-dual-cross-parameter-constraint-usage" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.17：为泛型和跨参数约束指定目标</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@ScriptAssert</span><span class="pun">(</span><span class="pln">script </span><span class="pun">=</span><span class="pln"> </span><span class="str">"arg1.size() &lt;= arg0"</span><span class="pun">,</span><span class="pln"> validationAppliesTo </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ConstraintTarget</span><span class="pun">.</span><span class="pln">PARAMETERS</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> buildCar</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> seatCount</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Passenger</span><span class="pun">&gt;</span><span class="pln"> passengers</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">//...</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-constraint-composition"><a class="anchor" href="#section-constraint-composition"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.4。</font><font style="vertical-align: inherit;">约束组成</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看</font><a href="#example-car-with-checkcase"><font style="vertical-align: inherit;">Example 6.10“应用</font></a><a href="#example-car-with-checkcase"><font style="vertical-align: inherit;">约束”</font></a></font><code>licensePlate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">字段</font><font style="vertical-align: inherit;">，您已经看到了三个约束注释。</font><font style="vertical-align: inherit;">在更复杂的场景中，可以将更多约束应用于一个元素，这可能很容易让人感到困惑。</font><font style="vertical-align: inherit;">此外，如果</font><font style="vertical-align: inherit;">
另一个类中</font><font style="vertical-align: inherit;">有一个</font><font style="vertical-align: inherit;">字段，则必须将所有约束声明复制到另一个类，这违反了DRY原则。</font></font><a href="#example-car-with-checkcase"><font style="vertical-align: inherit;"></font><code>@CheckCase</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code>licensePlate</code><font style="vertical-align: inherit;"></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过创建由多个基本约束组成的更高级别约束来解决此类问题。</font></font><a href="#example-composed-constraint"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.18，“创建组合约束</font></font><code>@ValidLicensePlate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了一个包含约束的组合约束注释</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>@Size</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code>@CheckCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div id="example-composed-constraint" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.18：创建一个组合约束 </font></font><code>@ValidLicensePlate</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">constraintcomposition</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@NotNull</span><span class="pln">
</span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> max </span><span class="pun">=</span><span class="pln"> </span><span class="lit">14</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@CheckCase</span><span class="pun">(</span><span class="typ">CaseMode</span><span class="pun">.</span><span class="pln">UPPER</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Target</span><span class="pun">({</span><span class="pln"> METHOD</span><span class="pun">,</span><span class="pln"> FIELD</span><span class="pun">,</span><span class="pln"> ANNOTATION_TYPE</span><span class="pun">,</span><span class="pln"> TYPE_USE </span><span class="pun">})</span><span class="pln">
</span><span class="lit">@Retention</span><span class="pun">(</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Constraint</span><span class="pun">(</span><span class="pln">validatedBy </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
</span><span class="lit">@Documented</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">ValidLicensePlate</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="str">"{org.hibernate.validator.referenceguide.chapter06."</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"constraintcomposition.ValidLicensePlate.message}"</span><span class="pun">;</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?&gt;[]</span><span class="pln"> groups</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pun">&gt;[]</span><span class="pln"> payload</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要创建组合约束，只需使用其包含约束来注释约束声明。</font><font style="vertical-align: inherit;">如果组合约束本身需要验证器，则应在</font></font><code>@Constraint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释中</font><font style="vertical-align: inherit;">指定此验证器</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于不需要额外验证器的组合约束，例如</font></font><code>@ValidLicensePlate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，设置</font></font><code>validatedBy()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为空数组。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>licensePlate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段中</font><font style="vertical-align: inherit;">使用新的组合约束</font><font style="vertical-align: inherit;">完全等同于先前版本，其中三个约束直接在字段本身声明：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.19：组合约束的应用 </font></font><code>ValidLicensePlate</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">constraintcomposition</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@ValidLicensePlate</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licensePlate</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">时检索</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">s </font><font style="vertical-align: inherit;">集</font><font style="vertical-align: inherit;">将包含约束的每个违反的组成约束的条目</font></font><code>@ValidLicensePlate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您更喜欢单个</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以防任何组合约束被违反，则
 </font></font><code>@ReportAsSingleViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以按如下方式使用元约束：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例6.20：使用@ReportAsSingleViolation</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter06</span><span class="pun">.</span><span class="pln">constraintcomposition</span><span class="pun">.</span><span class="pln">reportassingle</span><span class="pun">;</span><span class="pln">

</span><span class="com">//...</span><span class="pln">
</span><span class="lit">@ReportAsSingleViolation</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">ValidLicensePlate</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="str">"{org.hibernate.validator.referenceguide.chapter06."</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"constraintcomposition.reportassingle.ValidLicensePlate.message}"</span><span class="pun">;</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?&gt;[]</span><span class="pln"> groups</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pun">&gt;[]</span><span class="pln"> payload</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapter-valueextraction"><a class="anchor" href="#chapter-valueextraction"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.价值提取</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值提取是从容器中提取值以便验证它们的过程。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它在处理</font></font><a href="#container-element-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">容器元素约束</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="#example-cascaded-validation-list"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">容器内的级联验证时使用</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect2">
<h3 id="section-valueextraction-builtinvalueextractors"><a class="anchor" href="#section-valueextraction-builtinvalueextractors"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1。</font><font style="vertical-align: inherit;">内置值提取器</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate验证带有内置值提取用于通常的Java容器类型，因此，除非你正在使用自己的自定义容器类型（或外部库的的，如</font></font><a href="https://github.com/google/guava"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">番石榴</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>Multimap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），你不应该以增加自己的价值提取。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有以下容器类型都有内置值提取器：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.util.Iterable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></p>
</li>
<li>
<p><code>java.util.List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></p>
</li>
<li>
<p><code>java.util.Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用于键和值;</font></font></p>
</li>
<li>
<p><code>java.util.Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.util.OptionalInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>java.util.OptionalLong</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>java.util.OptionalDouble</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></p>
</li>
<li>
<p><a href="http://docs.oracle.com/javase/8/javase-clienttechnologies.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaFX的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>ObservableValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参见</font></font><a href="#section-valueextraction-javafx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4节，‘JavaFX的值提取’</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
有详细介绍）。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在</font></font><a href="http://beanvalidation.org/2.0/spec/#valueextractordefinition-builtinvalueextractors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation规范中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到内置值提取器的完整列表以及它们的行为方式的所有详细信息
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_a_code_valueextractor_code"><a class="anchor" href="#_implementing_a_code_valueextractor_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2。</font><font style="vertical-align: inherit;">实施一个</font></font><code>ValueExtractor</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要从自定义容器中提取值，需要实现一个</font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现一个</font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是不够的，你还需要注册它。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多详细信息</font></font><a href="#section-valueextraction-registeringvalueextractor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a href="#section-valueextraction-registeringvalueextractor"><font style="vertical-align: inherit;">第7.5节“注册</font></a><a href="#section-valueextraction-registeringvalueextractor"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个非常简单的API，因为值提取器的唯一目的是将提取的值提供给a </font></font><code>ValueReceiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，让我们考虑一下番石榴的情况</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一个简单的例子，因为我们可以在它之后塑造它的值提取器</font></font><code>java.util.Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div id="example-valueextraction-guava-optional-valueextractor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.1：A </font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">番石榴</font></font><code>Optional</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter07</span><span class="pun">.</span><span class="pln">valueextractor</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">OptionalValueExtractor</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ValueExtractor</span><span class="pun">&lt;</span><span class="typ">Optional</span><span class="pun">&lt;</span><span class="lit">@ExtractedValue</span><span class="pln"> </span><span class="pun">?&gt;&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> extractValues</span><span class="pun">(</span><span class="typ">Optional</span><span class="pun">&lt;?&gt;</span><span class="pln"> originalValue</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ValueReceiver</span><span class="pln"> receiver</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        receiver</span><span class="pun">.</span><span class="pln">value</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> originalValue</span><span class="pun">.</span><span class="pln">orNull</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些解释是有序的：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>@ExtractedValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释标记所考虑的类型的参数：其将被用于解析验证值的类型;</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用</font></font><code>value()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收器</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">方法作为</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纯包装器类型;</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们不希望将节点添加到约束违规的属性路径中，因为我们希望将违规报告为直接在属性上，因此我们将</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点名称</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">给</font></font><code>value()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更有趣的例子是Guava的情况</font></font><code>Multimap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：我们希望能够验证密钥和此容器类型的值。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们首先考虑值的情况。</font><font style="vertical-align: inherit;">需要提取它们的值提取器：</font></font></p>
</div>
<div id="example-valueextraction-guava-multimap-value-valueextractor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.2：A </font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代表</font></font><code>Multimap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter07</span><span class="pun">.</span><span class="pln">valueextractor</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MultimapValueValueExtractor</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ValueExtractor</span><span class="pun">&lt;</span><span class="typ">Multimap</span><span class="pun">&lt;?,</span><span class="pln"> </span><span class="lit">@ExtractedValue</span><span class="pln"> </span><span class="pun">?&gt;&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> extractValues</span><span class="pun">(</span><span class="typ">Multimap</span><span class="pun">&lt;?,</span><span class="pln"> </span><span class="pun">?&gt;</span><span class="pln"> originalValue</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ValueReceiver</span><span class="pln"> receiver</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Entry</span><span class="pun">&lt;?,</span><span class="pln"> </span><span class="pun">?&gt;</span><span class="pln"> entry </span><span class="pun">:</span><span class="pln"> originalValue</span><span class="pun">.</span><span class="pln">entries</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            receiver</span><span class="pun">.</span><span class="pln">keyedValue</span><span class="pun">(</span><span class="pln"> </span><span class="str">"&lt;multimap value&gt;"</span><span class="pun">,</span><span class="pln"> entry</span><span class="pun">.</span><span class="pln">getKey</span><span class="pun">(),</span><span class="pln"> entry</span><span class="pun">.</span><span class="pln">getValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它允许验证以下值的约束</font></font><code>Multimap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.3：a的值的约束 </font></font><code>Multimap</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">private</span><span class="pln"> </span><span class="typ">Multimap</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@NotBlank</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> map1</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一个值提取器需要能够对以下键的键设置约束</font></font><code>Multimap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div id="example-valueextraction-guava-multimap-key-valueextractor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.4：A </font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代表</font></font><code>Multimap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter07</span><span class="pun">.</span><span class="pln">valueextractor</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MultimapKeyValueExtractor</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ValueExtractor</span><span class="pun">&lt;</span><span class="typ">Multimap</span><span class="pun">&lt;</span><span class="lit">@ExtractedValue</span><span class="pln"> </span><span class="pun">?,</span><span class="pln"> </span><span class="pun">?&gt;&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> extractValues</span><span class="pun">(</span><span class="typ">Multimap</span><span class="pun">&lt;?,</span><span class="pln"> </span><span class="pun">?&gt;</span><span class="pln"> originalValue</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ValueReceiver</span><span class="pln"> receiver</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> key </span><span class="pun">:</span><span class="pln"> originalValue</span><span class="pun">.</span><span class="pln">keySet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            receiver</span><span class="pun">.</span><span class="pln">keyedValue</span><span class="pun">(</span><span class="pln"> </span><span class="str">"&lt;multimap key&gt;"</span><span class="pun">,</span><span class="pln"> key</span><span class="pun">,</span><span class="pln"> key </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦注册了这两个值提取器，就可以声明对键和值的约束</font></font><code>Multimap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.5：a的键和值的约束 </font></font><code>Multimap</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">private</span><span class="pln"> </span><span class="typ">Multimap</span><span class="pun">&lt;</span><span class="lit">@NotBlank</span><span class="pln"> </span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@NotBlank</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> map2</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两个值提取器之间的差异乍一看可能有点微妙，所以让我们对它们有所了解：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>@ExtractedValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释标记目标类型参数（无论是
 </font></font><code>K</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>V</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下）。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用不同的节点名称（</font></font><code>&lt;multimap key&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vs. </font></font><code>&lt;multimap value&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在一种情况下，我们将值传递给接收者（</font></font><code>keyedValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用的</font><font style="vertical-align: inherit;">第三个参数</font><font style="vertical-align: inherit;">），在另</font><font style="vertical-align: inherit;">一种情况下，我们传递
 </font><font style="vertical-align: inherit;">密钥。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据您的容器类型，您应该选择最</font></font><code>ValueReceiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
适合的方法：</font></font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>value()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于一个简单的包装容器 - 它用于</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></p>
</dd>
<dt class="hdlist1"><code>iterableValue()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于可迭代容器 - 它用于</font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></p>
</dd>
<dt class="hdlist1"><code>indexedValue()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于包含索引值的容器 - 它用于</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></p>
</dd>
<dt class="hdlist1"><code>keyedValue()</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于包含键控值的容器 - 它用于</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s。</font><font style="vertical-align: inherit;">它用于键和值。</font><font style="vertical-align: inherit;">在密钥的情况下，密钥也作为验证值传递。</font></font></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于所有这些方法，您需要传递节点名称：它是添加到约束违规的属性路径中的节点中包含的名称。</font><font style="vertical-align: inherit;">如前所述，如果节点名称是</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则没有节点添加到属性路径：它对于类似的纯包装类型很有用</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所使用的方法的选择很重要，因为它将上下文信息添加到约束违反的属性路径，例如索引或验证值的键。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="_non_generic_containers"><a class="anchor" href="#_non_generic_containers"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.3。</font><font style="vertical-align: inherit;">非通用容器</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可能已经注意到，到目前为止，我们只为通用容器实现了值提取器。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator还支持非泛型容器的值提取。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们</font></font><code>java.util.OptionalInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将一个原语包装</font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
成</font><font style="vertical-align: inherit;">一个类似</font><font style="vertical-align: inherit;">的</font></font><code>Optional</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">容器。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对值提取器的第一次尝试</font></font><code>OptionalInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看起来像：</font></font></p>
</div>
<div id="example-valueextraction-optionalint-valueextractor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.6：A </font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font><code>OptionalInt</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter07</span><span class="pun">.</span><span class="pln">nongeneric</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">OptionalIntValueExtractor</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ValueExtractor</span><span class="pun">&lt;</span><span class="lit">@ExtractedValue</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln"> </span><span class="typ">OptionalInt</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> extractValues</span><span class="pun">(</span><span class="typ">OptionalInt</span><span class="pln"> originalValue</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ValueReceiver</span><span class="pln"> receiver</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        receiver</span><span class="pun">.</span><span class="pln">value</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> originalValue</span><span class="pun">.</span><span class="pln">isPresent</span><span class="pun">()</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> originalValue</span><span class="pun">.</span><span class="pln">getAsInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于非泛型容器，有一个明显的缺失：我们没有类型参数。</font><font style="vertical-align: inherit;">它有两个后果：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们无法使用type参数确定验证值的类型;</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们不能在类型参数上添加约束（例如</font></font><code>Container&lt;@NotNull String&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们需要一种方法告诉Hibernate Validator从一个</font></font><code>OptionalInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型中</font><font style="vertical-align: inherit;">提取的值</font></font><code>Integer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">正如您在上面的示例中所看到</font></font><code>type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的，</font></font><code>@ExtractedValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注释</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">允许将此信息提供给验证引擎。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，您必须告诉验证引擎</font></font><code>Min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您要添加到</font></font><code>OptionalInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">与包装的值相关，而不是与包装器相关。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation </font></font><code>Unwrapping.Unwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为这种情况</font><font style="vertical-align: inherit;">提供</font><font style="vertical-align: inherit;">有效负载：</font></font></p>
</div>
<div id="example-valueextraction-optionalint-unwrapping" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.7：使用</font></font><code>Unwrapping.Unwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Min</span><span class="pun">(</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> payload </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Unwrapping</span><span class="pun">.</span><span class="typ">Unwrap</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">OptionalInt</span><span class="pln"> optionalInt1</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们退一步，大多数 - 如果不是全部 - 我们想要添加到</font></font><code>OptionalInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">的约束
 </font><font style="vertical-align: inherit;">将应用于包装的值，因此有一种方法使它成为默认值会很好。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这正是</font></font><code>@UnwrapByDefault</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释的用途：</font></font></p>
</div>
<div id="example-valueextraction-optionalint-unwrapbydefault-valueextractor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施例7.8：一个</font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于</font></font><code>OptionalInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标明</font></font><code>@UnwrapByDefault</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter07</span><span class="pun">.</span><span class="pln">nongeneric</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@UnwrapByDefault</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">UnwrapByDefaultOptionalIntValueExtractor</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ValueExtractor</span><span class="pun">&lt;</span><span class="lit">@ExtractedValue</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln"> </span><span class="typ">OptionalInt</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> extractValues</span><span class="pun">(</span><span class="typ">OptionalInt</span><span class="pln"> originalValue</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ValueReceiver</span><span class="pln"> receiver</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        receiver</span><span class="pun">.</span><span class="pln">value</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> originalValue</span><span class="pun">.</span><span class="pln">isPresent</span><span class="pun">()</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> originalValue</span><span class="pun">.</span><span class="pln">getAsInt</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明此值提取器时</font></font><code>OptionalInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，约束注释将默认应用于包装值：</font></font></p>
</div>
<div id="example-valueextraction-optionalint-implicitunwrapping" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.9：由于隐含的展开 </font></font><code>@UnwrapByDefault</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Min</span><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">OptionalInt</span><span class="pln"> optionalInt2</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，您仍然可以使用</font></font><code>Unwrapping.Skip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效内容</font><font style="vertical-align: inherit;">为包装器本身声明注释</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div id="example-valueextraction-optionalint-avoid-implicitunwrapping" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.10：避免使用隐式展开 </font></font><code>Unwrapping.Skip</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NotNull</span><span class="pun">(</span><span class="pln">payload </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Unwrapping</span><span class="pun">.</span><span class="typ">Skip</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Min</span><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">OptionalInt</span><span class="pln"> optionalInt3</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>@UnwrapByDefault</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对值提取</font></font><code>OptionalInt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是内置值提取的一部分：没有必要添加一个。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="section-valueextraction-javafx"><a class="anchor" href="#section-valueextraction-javafx"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.4。</font><font style="vertical-align: inherit;">JavaFX值提取器</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaFX中的Bean属性通常不是简单的数据类型，如</font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
or </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是包含在</font></font><code>Property</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许使它们可观察的类型中，用于数据绑定等。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，需要提取值以能够对包装值应用约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaFX </font></font><code>ObservableValue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值提取器标有</font></font><code>@UnwrapByDefault</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，托管在容器上的约束默认情况下以包装值为目标。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，您可以限制</font></font><code>StringProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.11：约束a </font></font><code>StringProperty</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@NotBlank</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">StringProperty</span><span class="pln"> stringProperty</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code>LongProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.12：约束a </font></font><code>LongProperty</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Min</span><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">LongProperty</span><span class="pln"> longProperty</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可迭代属性类型，即</font></font><code>ReadOnlyListProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>ListProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和它们的</font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的对应是通用的，并且因此，可以使用的容器元素的约束。</font><font style="vertical-align: inherit;">因此，它们具有未标记的特定值提取器</font></font><code>@UnwrapByDefault</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A </font></font><code>ReadOnlyListProperty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自然会被限制为</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例7.13：约束a </font></font><code>ReadOnlyListProperty</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">private</span><span class="pln"> </span><span class="typ">ReadOnlyListProperty</span><span class="pun">&lt;</span><span class="lit">@NotBlank</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> listProperty</span><span class="pun">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-valueextraction-registeringvalueextractor"><a class="anchor" href="#section-valueextraction-registeringvalueextractor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.5。</font><font style="vertical-align: inherit;">注册一个</font></font><code>ValueExtractor</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator不会自动检测类路径中的值提取器，因此必须注册它们。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有几种方法可以注册值提取器（按优先级递增顺序）：</font></font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由验证引擎本身提供</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font></font><a href="#section-valueextraction-builtinvalueextractors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.1节“内置值提取器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过Java服务加载器机制</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"></font><code>META-INF/services/javax.validation.valueextraction.ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
必须提供</font><font style="vertical-align: inherit;">该文件</font><font style="vertical-align: inherit;">，其中一个或多个值提取器实现的完全限定名称作为其内容，每个都在单独的行上。</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code>META-INF/validation.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font></font></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关如何在XML配置中注册值提取器的更多信息</font></font><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;">第8.1节“在</font></a><a href="#section-configuration-validation-xml"><em><font style="vertical-align: inherit;">validation.xml中</font></em></a><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;">配置验证器工厂</font></a><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过电话 </font></font><code>Configuration#addValueExtractor(ValueExtractor&lt;?&gt;)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">
更多信息</font></font><a href="#section-bootstrapping-valueextractors"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a href="#section-bootstrapping-valueextractors"><font style="vertical-align: inherit;">第9.2.6节“注册</font></a><a href="#section-bootstrapping-valueextractors"><font style="vertical-align: inherit;">s”</font></a><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过调用 </font></font><code>ValidatorContext#addValueExtractor(ValueExtractor&lt;?&gt;)</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它只声明此</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">的值提取器</font><font style="vertical-align: inherit;">。</font></font></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以较高优先级指定的给定类型和类型参数的值提取器将覆盖以较低优先级给出的相同类型和类型参数的任何其他提取器。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="_resolution_algorithms"><a class="anchor" href="#_resolution_algorithms"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.6。</font><font style="vertical-align: inherit;">分辨率算法</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在大多数情况下，您不必担心这一点，但是，如果您要覆盖现有值提取器，则可以在Bean Validation规范中找到值提取器分辨率算法的详细说明：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于</font></font><a href="http://beanvalidation.org/2.0/spec/#constraintdeclarationvalidationprocess-validationroutine-valueextractorresolution-algorithm-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">容器元素约束</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于</font></font><a href="http://beanvalidation.org/2.0/spec/#constraintdeclarationvalidationprocess-validationroutine-valueextractorresolution-algorithm-cascaded"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级联验证</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并用于</font></font><a href="http://beanvalidation.org/2.0/spec/#constraintdeclarationvalidationprocess-validationroutine-valueextractorresolution-implicitunwrapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隐式展开</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要记住的一件重要事情是：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于容器元素约束，声明的类型用于解析值提取器;</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于级联验证，它是运行时类型。</font></font></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapter-xml-configuration"><a class="anchor" href="#chapter-xml-configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.通过XML配置</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们已经使用了Bean Validation的默认配置源，即注释。</font><font style="vertical-align: inherit;">但是，也存在两种允许通过XML进行配置的XML描述符。</font><font style="vertical-align: inherit;">第一个描述符描述了一般的Bean Validation行为，并以</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml的形式提供</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">第二个描述约束声明，并通过注释与约束声明方法紧密匹配。</font><font style="vertical-align: inherit;">我们来看看这两种文档类型。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XSD文件可通过
 </font></font><a href="http://xmlns.jcp.org/xml/ns/validation/configuration" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://xmlns.jcp.org/xml/ns/validation/configuration</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
 </font></font><a href="http://xmlns.jcp.org/xml/ns/validation/mapping" class="bare"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://xmlns.jcp.org/xml/ns/validation/mapping获得</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关XML模式的更多信息可以在
 </font></font><a href="http://beanvalidation.org/xml/ns/validation/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation网站上找到</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="section-configuration-validation-xml"><a class="anchor" href="#section-configuration-validation-xml"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1。</font><font style="vertical-align: inherit;">在</font><em><font style="vertical-align: inherit;">validation.xml中</font></em><font style="vertical-align: inherit;">配置验证器工厂</font></font><em><font style="vertical-align: inherit;"></font></em></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为Hibernate Validator启用XML配置的关键是文件</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果此类文件存在于类路径中，则</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在创建获取</font><font style="vertical-align: inherit;">时将应用其配置</font><font style="vertical-align: inherit;">。</font></font><a href="#image-validation-configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图1“验证配置模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">validation.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须遵守</font><font style="vertical-align: inherit;">的XML模式的模型视图
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="image-validation-configuration" class="imageblock">
<div class="content">
<img src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/validation-configuration-2.0.png" alt="验证配置-2.0.XSD">
</div>
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图1.验证配置架构</font></font></div>
</div>
<div class="paragraph">
<p><a href="#example-validation-xml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例8.1，“ </font></font><code>validation.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
显示了</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">validation.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的几个配置选项</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有设置都是可选的，并且可以通过编程方式使用相同的配置选项</font></font><code>javax.validation.Configuration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">实际上，XML配置将被通过编程API明确指定的值覆盖。</font><font style="vertical-align: inherit;">甚至可以完全忽略XML配置
 </font></font><code>Configuration#ignoreXmlConfiguration()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另请参见</font></font><a href="#section-configuring-validator-factory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2节“配置a </font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-validation-xml" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例8.1： </font></font><code>validation.xml</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;validation-config</span><span class="pln">
        </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/configuration"</span><span class="pln">
        </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
        </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/configuration
            http://xmlns.jcp.org/xml/ns/validation/configuration/validation-configuration-2.0.xsd"</span><span class="pln">
        </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"2.0"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="tag">&lt;default-provider&gt;</span><span class="pln">com.acme.ValidationProvider</span><span class="tag">&lt;/default-provider&gt;</span><span class="pln">

    </span><span class="tag">&lt;message-interpolator&gt;</span><span class="pln">com.acme.MessageInterpolator</span><span class="tag">&lt;/message-interpolator&gt;</span><span class="pln">
    </span><span class="tag">&lt;traversable-resolver&gt;</span><span class="pln">com.acme.TraversableResolver</span><span class="tag">&lt;/traversable-resolver&gt;</span><span class="pln">
    </span><span class="tag">&lt;constraint-validator-factory&gt;</span><span class="pln">
        com.acme.ConstraintValidatorFactory
    </span><span class="tag">&lt;/constraint-validator-factory&gt;</span><span class="pln">
    </span><span class="tag">&lt;parameter-name-provider&gt;</span><span class="pln">com.acme.ParameterNameProvider</span><span class="tag">&lt;/parameter-name-provider&gt;</span><span class="pln">
    </span><span class="tag">&lt;clock-provider&gt;</span><span class="pln">com.acme.ClockProvider</span><span class="tag">&lt;/clock-provider&gt;</span><span class="pln">

    </span><span class="tag">&lt;value-extractor&gt;</span><span class="pln">com.acme.ContainerValueExtractor</span><span class="tag">&lt;/value-extractor&gt;</span><span class="pln">

    </span><span class="tag">&lt;executable-validation</span><span class="pln"> </span><span class="atn">enabled</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;default-validated-executable-types&gt;</span><span class="pln">
            </span><span class="tag">&lt;executable-type&gt;</span><span class="pln">CONSTRUCTORS</span><span class="tag">&lt;/executable-type&gt;</span><span class="pln">
            </span><span class="tag">&lt;executable-type&gt;</span><span class="pln">NON_GETTER_METHODS</span><span class="tag">&lt;/executable-type&gt;</span><span class="pln">
            </span><span class="tag">&lt;executable-type&gt;</span><span class="pln">GETTER_METHODS</span><span class="tag">&lt;/executable-type&gt;</span><span class="pln">
        </span><span class="tag">&lt;/default-validated-executable-types&gt;</span><span class="pln">
    </span><span class="tag">&lt;/executable-validation&gt;</span><span class="pln">

    </span><span class="tag">&lt;constraint-mapping&gt;</span><span class="pln">META-INF/validation/constraints-car.xml</span><span class="tag">&lt;/constraint-mapping&gt;</span><span class="pln">

    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.validator.fail_fast"</span><span class="tag">&gt;</span><span class="pln">false</span><span class="tag">&lt;/property&gt;</span><span class="pln">
</span><span class="tag">&lt;/validation-config&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类路径上</font><font style="vertical-align: inherit;">只能有一个名为</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果发现多个异常，则抛出异常。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该节点</font></font><code>default-provider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许选择Bean Validation提供程序。</font><font style="vertical-align: inherit;">如果类路径上有多个提供程序，这将非常有用。</font></font><code>message-interpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>traversable-resolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>constraint-validator-factory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>parameter-name-provider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>clock-provider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许以自定义接口的使用实现</font></font><code>MessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>TraversableResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>ConstraintValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ClockProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在定义的
 </font></font><code>javax.validation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包。</font><font style="vertical-align: inherit;">有关这些接口的更多信息</font></font><a href="#section-configuring-validator-factory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a href="#section-configuring-validator-factory"><font style="vertical-align: inherit;">第9.2节“配置a </font></a><a href="#section-configuring-validator-factory"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">的子节</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><code>value-extractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许声明其他值提取器，以从自定义容器类型中提取值或覆盖内置值提取器。</font><font style="vertical-align: inherit;">有关如何实现的更多信息</font></font><a href="#chapter-valueextraction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em><font style="vertical-align: inherit;"></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a href="#chapter-valueextraction"><font style="vertical-align: inherit;">第7章，</font></a><a href="#chapter-valueextraction"><em><font style="vertical-align: inherit;">值提取</font></em></a></font><code>javax.validation.valueextraction.ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><code>executable-validation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">及其子节点定义方法验证的默认值。</font><font style="vertical-align: inherit;">Bean Validation规范将构造函数和非getter方法定义为默认值。</font><font style="vertical-align: inherit;">enabled属性充当全局开关，用于打开和关闭方法验证（另请参见</font></font><a href="#chapter-method-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明和验证方法约束</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过该</font></font><code>constraint-mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素，您可以列出包含实际约束配置的任意数量的其他XML文件。</font><font style="vertical-align: inherit;">必须使用类路径上的完全限定名称指定映射文件名。</font><font style="vertical-align: inherit;">有关编写映射文件的详细信息，请参阅下一节。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后但同样重要的是，您可以通过</font></font><code>property</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点</font><font style="vertical-align: inherit;">指定提供程序特定的属性</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在该示例中，我们使用Hibernate Validator特定</font></font><code>hibernate.validator.fail_fast</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性（请参见
 </font></font><a href="#section-fail-fast"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.2节“失败快速模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="section-mapping-xml-constraints"><a class="anchor" href="#section-mapping-xml-constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2。</font><font style="vertical-align: inherit;">通过映射约束</font></font><code>constraint-mappings</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过遵循</font></font><a href="#image-mapping-configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图2“验证映射模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font><a href="#image-mapping-configuration"><font style="vertical-align: inherit;">所示</font></a><font style="vertical-align: inherit;">模式的文件，可以表达XML中的约束
 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，只有在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">validation.xml中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过约束映射列出时，才会处理这些映射文件</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="image-mapping-configuration" class="imageblock">
<div class="content">
<img src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/validation-mapping-2.0.png" alt="验证映射-2.0.XSD">
</div>
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图2.验证映射架构</font></font></div>
</div>
<div class="paragraph">
<p><a href="#example-constraints-car"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例8.2“通过XML配置的Bean约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了</font></font><a href="#example-car"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例5.3中的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Car和RentalCar类</font><a href="#example-car"><font style="vertical-align: inherit;">，“Car”等</font></a><font style="vertical-align: inherit;">。
</font></font><a href="#example-rental-car"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例5.9，“ </font></font><code>RentalCar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有重新定义的默认组的</font><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用XML映射。</font></font></p>
</div>
<div id="example-constraints-car" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例8.2：通过XML配置的Bean约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;constraint-mappings</span><span class="pln">
        </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/mapping"</span><span class="pln">
        </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
        </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/mapping
            http://xmlns.jcp.org/xml/ns/validation/mapping/validation-mapping-2.0.xsd"</span><span class="pln">
        </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"2.0"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="tag">&lt;default-package&gt;</span><span class="pln">org.hibernate.validator.referenceguide.chapter05</span><span class="tag">&lt;/default-package&gt;</span><span class="pln">
    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"Car"</span><span class="pln"> </span><span class="atn">ignore-annotations</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;field</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"manufacturer"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.NotNull"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/field&gt;</span><span class="pln">
        </span><span class="tag">&lt;field</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"licensePlate"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.NotNull"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/field&gt;</span><span class="pln">
        </span><span class="tag">&lt;field</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"seatCount"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.Min"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"value"</span><span class="tag">&gt;</span><span class="pln">2</span><span class="tag">&lt;/element&gt;</span><span class="pln">
            </span><span class="tag">&lt;/constraint&gt;</span><span class="pln">
        </span><span class="tag">&lt;/field&gt;</span><span class="pln">
        </span><span class="tag">&lt;field</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"driver"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;valid/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/field&gt;</span><span class="pln">
        </span><span class="tag">&lt;field</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"partManufacturers"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;container-element-type</span><span class="pln"> </span><span class="atn">type-argument-index</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;valid/&gt;</span><span class="pln">
            </span><span class="tag">&lt;/container-element-type&gt;</span><span class="pln">
            </span><span class="tag">&lt;container-element-type</span><span class="pln"> </span><span class="atn">type-argument-index</span><span class="pun">=</span><span class="atv">"1"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;container-element-type&gt;</span><span class="pln">
                    </span><span class="tag">&lt;valid/&gt;</span><span class="pln">
                    </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.NotNull"</span><span class="tag">/&gt;</span><span class="pln">
                </span><span class="tag">&lt;/container-element-type&gt;</span><span class="pln">
            </span><span class="tag">&lt;/container-element-type&gt;</span><span class="pln">
        </span><span class="tag">&lt;/field&gt;</span><span class="pln">
        </span><span class="tag">&lt;getter</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"passedVehicleInspection"</span><span class="pln"> </span><span class="atn">ignore-annotations</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.AssertTrue"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;message&gt;</span><span class="pln">The car has to pass the vehicle inspection first</span><span class="tag">&lt;/message&gt;</span><span class="pln">
                </span><span class="tag">&lt;groups&gt;</span><span class="pln">
                    </span><span class="tag">&lt;value&gt;</span><span class="pln">CarChecks</span><span class="tag">&lt;/value&gt;</span><span class="pln">
                </span><span class="tag">&lt;/groups&gt;</span><span class="pln">
                </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"max"</span><span class="tag">&gt;</span><span class="pln">10</span><span class="tag">&lt;/element&gt;</span><span class="pln">
            </span><span class="tag">&lt;/constraint&gt;</span><span class="pln">
        </span><span class="tag">&lt;/getter&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">
    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"RentalCar"</span><span class="pln"> </span><span class="atn">ignore-annotations</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;class</span><span class="pln"> </span><span class="atn">ignore-annotations</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;group-sequence&gt;</span><span class="pln">
                </span><span class="tag">&lt;value&gt;</span><span class="pln">RentalCar</span><span class="tag">&lt;/value&gt;</span><span class="pln">
                </span><span class="tag">&lt;value&gt;</span><span class="pln">CarChecks</span><span class="tag">&lt;/value&gt;</span><span class="pln">
            </span><span class="tag">&lt;/group-sequence&gt;</span><span class="pln">
        </span><span class="tag">&lt;/class&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">
    </span><span class="tag">&lt;constraint-definition</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"org.mycompany.CheckCase"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;validated-by</span><span class="pln"> </span><span class="atn">include-existing-validators</span><span class="pun">=</span><span class="atv">"false"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;value&gt;</span><span class="pln">org.mycompany.CheckCaseValidator</span><span class="tag">&lt;/value&gt;</span><span class="pln">
        </span><span class="tag">&lt;/validated-by&gt;</span><span class="pln">
    </span><span class="tag">&lt;/constraint-definition&gt;</span><span class="pln">
</span><span class="tag">&lt;/constraint-mappings&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#example-rental-station-xml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例8.3“通过XML配置的方法约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了
 </font></font><a href="#example-declaring-parameter-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例3.1，“声明方法和构造函数参数约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="#example-declaring-return-value-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例3.4，“声明方法和构造函数返回值约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
和</font></font><a href="#example-specifying-constraint-target"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例3.3“指定约束的目标”中的约束</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何用XML表示。</font></font></p>
</div>
<div id="example-rental-station-xml" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例8.3：通过XML配置的方法约束</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;constraint-mappings</span><span class="pln">
        </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/mapping"</span><span class="pln">
        </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
        </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/mapping
            http://xmlns.jcp.org/xml/ns/validation/mapping/validation-mapping-2.0.xsd"</span><span class="pln">
        </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"2.0"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="tag">&lt;default-package&gt;</span><span class="pln">org.hibernate.validator.referenceguide.chapter08</span><span class="tag">&lt;/default-package&gt;</span><span class="pln">

    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"RentalStation"</span><span class="pln"> </span><span class="atn">ignore-annotations</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;constructor&gt;</span><span class="pln">
            </span><span class="tag">&lt;return-value&gt;</span><span class="pln">
                </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"ValidRentalStation"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;/return-value&gt;</span><span class="pln">
        </span><span class="tag">&lt;/constructor&gt;</span><span class="pln">

        </span><span class="tag">&lt;constructor&gt;</span><span class="pln">
            </span><span class="tag">&lt;parameter</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"java.lang.String"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.NotNull"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;/parameter&gt;</span><span class="pln">
        </span><span class="tag">&lt;/constructor&gt;</span><span class="pln">

        </span><span class="tag">&lt;method</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"getCustomers"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;return-value&gt;</span><span class="pln">
                </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.NotNull"</span><span class="tag">/&gt;</span><span class="pln">
                </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.Size"</span><span class="tag">&gt;</span><span class="pln">
                    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"min"</span><span class="tag">&gt;</span><span class="pln">1</span><span class="tag">&lt;/element&gt;</span><span class="pln">
                </span><span class="tag">&lt;/constraint&gt;</span><span class="pln">
            </span><span class="tag">&lt;/return-value&gt;</span><span class="pln">
        </span><span class="tag">&lt;/method&gt;</span><span class="pln">

        </span><span class="tag">&lt;method</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"rentCar"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;parameter</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"Customer"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.NotNull"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;/parameter&gt;</span><span class="pln">
            </span><span class="tag">&lt;parameter</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"java.util.Date"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.NotNull"</span><span class="tag">/&gt;</span><span class="pln">
                </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.Future"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;/parameter&gt;</span><span class="pln">
            </span><span class="tag">&lt;parameter</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"int"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.Min"</span><span class="tag">&gt;</span><span class="pln">
                    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"value"</span><span class="tag">&gt;</span><span class="pln">1</span><span class="tag">&lt;/element&gt;</span><span class="pln">
                </span><span class="tag">&lt;/constraint&gt;</span><span class="pln">
            </span><span class="tag">&lt;/parameter&gt;</span><span class="pln">
        </span><span class="tag">&lt;/method&gt;</span><span class="pln">

        </span><span class="tag">&lt;method</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"addCars"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;parameter</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"java.util.List"</span><span class="tag">&gt;</span><span class="pln">
                </span><span class="tag">&lt;container-element-type&gt;</span><span class="pln">
                    </span><span class="tag">&lt;valid/&gt;</span><span class="pln">
                    </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"javax.validation.constraints.NotNull"</span><span class="tag">/&gt;</span><span class="pln">
                </span><span class="tag">&lt;/container-element-type&gt;</span><span class="pln">
            </span><span class="tag">&lt;/parameter&gt;</span><span class="pln">
        </span><span class="tag">&lt;/method&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">

    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"Garage"</span><span class="pln"> </span><span class="atn">ignore-annotations</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;method</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"buildCar"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;parameter</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"java.util.List"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;cross-parameter&gt;</span><span class="pln">
                </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"ELAssert"</span><span class="tag">&gt;</span><span class="pln">
                    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"expression"</span><span class="tag">&gt;</span><span class="pln">...</span><span class="tag">&lt;/element&gt;</span><span class="pln">
                    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"validationAppliesTo"</span><span class="tag">&gt;</span><span class="pln">PARAMETERS</span><span class="tag">&lt;/element&gt;</span><span class="pln">
                </span><span class="tag">&lt;/constraint&gt;</span><span class="pln">
            </span><span class="tag">&lt;/cross-parameter&gt;</span><span class="pln">
        </span><span class="tag">&lt;/method&gt;</span><span class="pln">
        </span><span class="tag">&lt;method</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"paintCar"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;parameter</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"int"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;return-value&gt;</span><span class="pln">
                </span><span class="tag">&lt;constraint</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"ELAssert"</span><span class="tag">&gt;</span><span class="pln">
                    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"expression"</span><span class="tag">&gt;</span><span class="pln">...</span><span class="tag">&lt;/element&gt;</span><span class="pln">
                    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"validationAppliesTo"</span><span class="tag">&gt;</span><span class="pln">RETURN_VALUE</span><span class="tag">&lt;/element&gt;</span><span class="pln">
                </span><span class="tag">&lt;/constraint&gt;</span><span class="pln">
            </span><span class="tag">&lt;/return-value&gt;</span><span class="pln">
        </span><span class="tag">&lt;/method&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">

</span><span class="tag">&lt;/constraint-mappings&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML配置与程序化API密切相关。</font><font style="vertical-align: inherit;">因此，只需添加一些注释就足够了。</font></font><code>default-package</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于期望类名的所有字段。</font><font style="vertical-align: inherit;">如果指定的类不是完全限定的，则将使用配置的默认包。</font><font style="vertical-align: inherit;">然后，每个映射文件都可以有多个bean节点，每个节点都描述具有指定类名的实体的约束。</font></font></p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给定的类只能在所有配置文件中配置一次。</font><font style="vertical-align: inherit;">这同样适用于给定约束注释的约束定义。</font><font style="vertical-align: inherit;">它只能出现在一个映射文件中。</font><font style="vertical-align: inherit;">如果违反了这些规则</font></font><code>ValidationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则抛出。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font></font><code>ignore-annotations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示将忽略放置在已配置Bean上的约束注释。</font><font style="vertical-align: inherit;">此值的默认值为true。</font></font><code>ignore-annotations</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可用于节点
 </font></font><code>class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>fields</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>getter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>constructor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>method</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>parameter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>cross-parameter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>return-value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果未在这些级别上明确指定，则应用配置的bean值。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点</font></font><code>class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>getter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>container-element-type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>constructor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>method</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（及其子节点参数）确定在哪个水平约束被放置。</font><font style="vertical-align: inherit;">该</font></font><code>valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点用于启用级联验证，</font></font><code>constraint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点用于在相应级别上添加约束。</font><font style="vertical-align: inherit;">每个约束定义必须通过</font></font><code>annotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">定义类</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Bean Validation规范（</font></font><code>message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>groups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
 </font></font><code>payload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">所需的约束属性</font><font style="vertical-align: inherit;">具有专用节点。</font><font style="vertical-align: inherit;">使用该</font></font><code>element</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点</font><font style="vertical-align: inherit;">配置所有其他约束特定属性
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>container-element-type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许定义级联验证行为和容器元素的约束。</font><font style="vertical-align: inherit;">在上面的示例中，您可以看到嵌套在a </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的值中</font><font style="vertical-align: inherit;">的嵌套容器元素约束的示例</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>type-argument-index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于精确</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置所涉及的</font><font style="vertical-align: inherit;">类型参数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果类型只有一个类型参数（例如</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的例子中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">s）</font><font style="vertical-align: inherit;">，则可以省略它</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code>class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点还允许</font><font style="vertical-align: inherit;">通过</font><font style="vertical-align: inherit;">节点重新配置默认组序列（请参见
 </font></font><a href="#section-default-group-class"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4节“重新定义默认组序列”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><code>group-sequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">示例中未显示</font></font><code>convert-group</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于指定组转换的内容（请参见</font></font><a href="#section-group-conversion"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.5节“组转换”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">此节点可以用</font></font><code>field</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>getter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>container-element-type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>parameter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>return-value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和指定</font></font><code>from</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
属性来指定的组。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后但并非最不重要的是，</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过</font></font><code>constraint-definition</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点</font><font style="vertical-align: inherit;">更改与给定约束关联</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">列表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">annotation属性表示要更改的约束注释。</font><font style="vertical-align: inherit;">该</font></font><code>validated-by</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素表示</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
与约束关联</font><font style="vertical-align: inherit;">的（有序）</font><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">列表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font></font><code>include-existing-validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则忽略在约束注释上定义的验证器。</font><font style="vertical-align: inherit;">如果设置为</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则XML中描述的约束验证器列表将连接到注释上指定的验证器列表。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束定义的一个用例是更改默认约束定义</font></font><code>@URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从历史上看，Hibernate Validator的此约束的默认约束验证器使用
 </font></font><code>java.net.URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数来验证URL是否有效。</font><font style="vertical-align: inherit;">但是，还有一个纯正则表达式版本可用，可以使用XML进行配置：</font></font></p>
</div>
<div class="listingblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用XML为基于正则表达式的约束定义注册 </font></font><code>@URL</code></div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;constraint-definition</span><span class="pln"> </span><span class="atn">annotation</span><span class="pun">=</span><span class="atv">"org.hibernate.validator.constraints.URL"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;validated-by</span><span class="pln"> </span><span class="atn">include-existing-validators</span><span class="pun">=</span><span class="atv">"false"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;value&gt;</span><span class="pln">org.hibernate.validator.constraintvalidators.RegexpURLValidator</span><span class="tag">&lt;/value&gt;</span><span class="pln">
  </span><span class="tag">&lt;/validated-by&gt;</span><span class="pln">
</span><span class="tag">&lt;/constraint-definition&gt;</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapter-bootstrapping"><a class="anchor" href="#chapter-bootstrapping"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.引导</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="#section-obtaining-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.2.1节“获取</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您已经看到了一种创建</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例的方法 -  via
 </font></font><code>Validation#buildDefaultValidatorFactory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在本章中，您将学习如何使用其他方法</font></font><code>javax.validation.Validation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来引导特定配置的验证器。</font></font></p>
</div>
<div class="sect2">
<h3 id="section-retrieving-validator-factory-validator"><a class="anchor" href="#section-retrieving-validator-factory-validator"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1。</font><font style="vertical-align: inherit;">检索</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Validator</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过其中一个静态方法
 </font><font style="vertical-align: inherit;">检索</font></font><code>javax.validation.Validation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并调用</font></font><code>getValidator()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工厂实例来获取。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#example-build-default-validator-factory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.1，“Bootstrapping default </font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何从默认验证器工厂获取验证器：</font></font></p>
</div>
<div id="example-build-default-validator-factory" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.1：Bootstrapping默认</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Validator</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">buildDefaultValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例是线程安全的，可以缓存。</font><font style="vertical-align: inherit;">由于Hibernate Validator使用工厂作为缓存约束元数据的上下文，因此建议在应用程序中使用一个工厂实例。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation支持在一个应用程序中与多个提供程序（如Hibernate Validator）一起使用。</font><font style="vertical-align: inherit;">如果类路径中存在多个提供程序，则无法保证在创建工厂时选择哪个提供程序</font></font><code>buildDefaultValidatorFactory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，您可以显式指定要使用的提供程序</font></font><code>Validation#byProvider()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，传递提供程序的</font></font><code>ValidationProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类，如</font></font><a href="#example-using-specific-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.2“引导</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用特定提供程序”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-specific-provider" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.2：引导</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用特定的提供者</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，返回的配置对象</font></font><code>configure()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许在调用之前专门定制工厂</font></font><code>buildValidatorFactory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">可用选项将在本章后面讨论。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同样，您可以检索配置的默认验证器工厂，</font></font><a href="#example-configuring-default-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.3“检索</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置</font><font style="vertical-align: inherit;">的默认值”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对此进行了演示
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-configuring-default-provider" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.3：检索</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置</font><font style="vertical-align: inherit;">的默认值</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例不再使用，则应通过调用处理
 </font></font><code>ValidatorFactory#close()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这将释放工厂可能分配的任何资源。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="section-validation-provider-resolver"><a class="anchor" href="#section-validation-provider-resolver"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.1.1。 </font></font><code>ValidationProviderResolver</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，使用</font></font><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/jar/jar.html#Service_Provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java服务提供程序</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机制</font><font style="vertical-align: inherit;">发现可用的Bean Validation提供
 </font><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/jar/jar.html#Service_Provider"><font style="vertical-align: inherit;">程序</font></a><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，每个提供程序都包含文件</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / services / javax.validation.spi.ValidationProvider</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包含其</font></font><code>ValidationProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">的完全限定类名</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在Hibernate Validator的情况下，这是
 </font></font><code>org.hibernate.validator.HibernateValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据您的环境及其类加载细节，通过Java的服务加载器机制进行的提供程序发现可能不起作用。</font><font style="vertical-align: inherit;">在这种情况下，您可以插入</font></font><code>ValidationProviderResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行提供程序检索</font><font style="vertical-align: inherit;">的自定义
 </font><font style="vertical-align: inherit;">实现。</font><font style="vertical-align: inherit;">一个例子是OSGi，您可以在其中实现一个使用OSGi服务进行提供程序发现的提供程序解析程序。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用自定义提供程序解析程序，请</font></font><code>providerResolver()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按</font></font><a href="#example-using-custom-validation-provider-resolver"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例9.4“使用自定义</font></font><code>ValidationProviderResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示进行
 </font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-custom-validation-provider-resolver" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.4：使用自定义 </font></font><code>ValidationProviderResolver</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter09</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">OsgiServiceDiscoverer</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ValidationProviderResolver</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">ValidationProvider</span><span class="pun">&lt;?&gt;&gt;</span><span class="pln"> getValidationProviders</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">providerResolver</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">OsgiServiceDiscoverer</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-configuring-validator-factory"><a class="anchor" href="#section-configuring-validator-factory"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2。</font><font style="vertical-align: inherit;">配置一个</font></font><code>ValidatorFactory</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，</font></font><code>Validation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据XML描述符</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参见</font></font><a href="#chapter-xml-configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过XML配置</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）（如果存在）</font><a href="#chapter-xml-configuration"><em><font style="vertical-align: inherit;">配置</font></em></a><font style="vertical-align: inherit;">从中检索的验证器工厂</font><font style="vertical-align: inherit;">及其创建的任何验证器</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要禁用基于XML的配置，可以通过调用来执行此操作
 </font></font><code>Configuration#ignoreXmlConfiguration()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过访问XML配置的不同值
 </font></font><code>Configuration#getBootstrapConfiguration()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，如果要将Bean Validation集成到托管环境中并希望创建通过XML配置的对象的托管实例，这可能会有所帮助。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用fluent配置API，您可以在引导工厂时覆盖一个或多个设置。</font><font style="vertical-align: inherit;">以下部分显示如何使用不同的选项。</font><font style="vertical-align: inherit;">请注意，
 </font></font><code>Configuration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该类公开了不同扩展点的默认实现，如果您希望将这些扩展点用作自定义实现的委托，则这些实现非常有用。</font></font></p>
</div>
<div class="sect3">
<h4 id="section-validator-factory-message-interpolator"><a class="anchor" href="#section-validator-factory-message-interpolator"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.1。 </font></font><code>MessageInterpolator</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证引擎使用消息插值器从约束消息描述符创建用户可读错误消息。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><a href="#chapter-message-interpolation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4章中</font></font><em><font style="vertical-align: inherit;"></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述的默认消息插值算法</font><a href="#chapter-message-interpolation"><font style="vertical-align: inherit;">，</font></a><a href="#chapter-message-interpolation"><em><font style="vertical-align: inherit;">插值约束错误消息</font></em></a><font style="vertical-align: inherit;"> 
不足以满足您的需要，您可以通过</font><a href="#example-using-custom-message-interpolator"><font style="vertical-align: inherit;">示例9.5“使用自定义</font></a><a href="#example-using-custom-message-interpolator"><font style="vertical-align: inherit;">”中</font></a><font style="vertical-align: inherit;">所示
 </font><font style="vertical-align: inherit;">传递您自己的</font></font><code>MessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接口</font><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">。</font></font><code>Configuration#messageInterpolator()</code><font style="vertical-align: inherit;"></font><a href="#example-using-custom-message-interpolator"><font style="vertical-align: inherit;"></font><code>MessageInterpolator</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
<div id="example-using-custom-message-interpolator" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.5：使用自定义 </font></font><code>MessageInterpolator</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter09</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyMessageInterpolator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">MessageInterpolator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> interpolate</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> messageTemplate</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Context</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> interpolate</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> messageTemplate</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Context</span><span class="pln"> context</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Locale</span><span class="pln"> locale</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">messageInterpolator</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyMessageInterpolator</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="section-validator-factory-traversable-resolver"><a class="anchor" href="#section-validator-factory-traversable-resolver"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.2。 </font></font><code>TraversableResolver</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，验证引擎不应访问bean属性的状态。</font><font style="vertical-align: inherit;">最明显的例子是延迟加载的属性或JPA实体的关联。</font><font style="vertical-align: inherit;">验证此惰性属性或关联将意味着必须访问其状态，从数据库触发加载。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过查询</font></font><code>TraversableResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">来访问哪些属性以及哪些属性不受控制
 </font><font style="vertical-align: inherit;">。</font></font><a href="#example-using-custom-traversable-resolver"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.6“使用自定义</font></font><code>TraversableResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何使用自定义可遍历解析器实现。</font></font></p>
</div>
<div id="example-using-custom-traversable-resolver" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.6：使用自定义 </font></font><code>TraversableResolver</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter09</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyTraversableResolver</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">TraversableResolver</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isReachable</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">Object</span><span class="pln"> traversableObject</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Node</span><span class="pln"> traversableProperty</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Class</span><span class="pun">&lt;?&gt;</span><span class="pln"> rootBeanType</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Path</span><span class="pln"> pathToTraversableObject</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">ElementType</span><span class="pln"> elementType</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isCascadable</span><span class="pun">(</span><span class="pln">
            </span><span class="typ">Object</span><span class="pln"> traversableObject</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Node</span><span class="pln"> traversableProperty</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Class</span><span class="pun">&lt;?&gt;</span><span class="pln"> rootBeanType</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Path</span><span class="pln"> pathToTraversableObject</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">ElementType</span><span class="pln"> elementType</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">traversableResolver</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyTraversableResolver</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果未配置特定的可遍历解析程序，则默认行为是将所有属性视为可访问和可级联。</font><font style="vertical-align: inherit;">当将Hibernate Validator与JPA 2提供程序（如Hibernate ORM）一起使用时，只有那些已被加密提供程序加载的属性才会被视为可达，并且所有属性都将被视为可级联。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，每次验证调用都会缓存可遍历的解析程序调用。</font><font style="vertical-align: inherit;">这在调用</font></font><code>isReachable()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成本很高</font><font style="vertical-align: inherit;">的JPA环境中尤为重要</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种缓存增加了一些开销。</font><font style="vertical-align: inherit;">如果您的自定义可遍历解析器非常快，则最好考虑关闭缓存。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过XML配置禁用缓存：</font></font></p>
</div>
<div id="example-disabling-traversable-resolver-result-cache-xml-configuration" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.7：</font></font><code>TraversableResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过XML配置</font><font style="vertical-align: inherit;">禁用</font><font style="vertical-align: inherit;">结果缓存</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;validation-config</span><span class="pln">
        </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/configuration"</span><span class="pln">
        </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
        </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/configuration validation-configuration-2.0.xsd"</span><span class="pln">
        </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"2.0"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;default-provider&gt;</span><span class="pln">org.hibernate.validator.HibernateValidator</span><span class="tag">&lt;/default-provider&gt;</span><span class="pln">

    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.validator.enable_traversable_resolver_result_cache"</span><span class="tag">&gt;</span><span class="pln">false</span><span class="tag">&lt;/property&gt;</span><span class="pln">
</span><span class="tag">&lt;/validation-config&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或通过程序化API：</font></font></p>
</div>
<div id="example-disabling-traversable-resolver-result-cache-programmatic-api" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.8：</font></font><code>TraversableResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过编程API </font><font style="vertical-align: inherit;">禁用</font><font style="vertical-align: inherit;">结果缓存</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">traversableResolver</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyFastTraversableResolver</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">enableTraversableResolverResultCache</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_constraintvalidatorfactory_code"><a class="anchor" href="#_code_constraintvalidatorfactory_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.3。 </font></font><code>ConstraintValidatorFactory</code></h4>
<div class="paragraph">
<p><code>ConstraintValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 是自定义约束验证器如何实例化和释放的扩展点。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>ConstraintValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator提供</font><font style="vertical-align: inherit;">的默认值</font><font style="vertical-align: inherit;">需要公共的无参数构造函数来实例化</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例（请参见</font></font><a href="#section-constraint-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2节“约束验证器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">使用自定义</font></font><code>ConstraintValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供例如在约束验证器实现中使用依赖注入的可能性。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置自定义约束验证器工厂调用</font></font><code>Configuration#constraintValidatorFactory()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（请参见</font></font><a href="#example-using-custom-constraint-validator-factory"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.9“使用自定义</font></font><code>ConstraintValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-custom-constraint-validator-factory" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.9：使用自定义 </font></font><code>ConstraintValidatorFactory</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter09</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyConstraintValidatorFactory</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintValidatorFactory</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">T </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;?,</span><span class="pln"> </span><span class="pun">?&gt;&gt;</span><span class="pln"> T getInstance</span><span class="pun">(</span><span class="typ">Class</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> key</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> releaseInstance</span><span class="pun">(</span><span class="typ">ConstraintValidator</span><span class="pun">&lt;?,</span><span class="pln"> </span><span class="pun">?&gt;</span><span class="pln"> instance</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">constraintValidatorFactory</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyConstraintValidatorFactory</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何依赖于</font></font><code>ConstraintValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于实现的行为的</font><font style="vertical-align: inherit;">约束实现</font><font style="vertical-align: inherit;">（依赖注入，没有无参数构造函数等）都不被认为是可移植的。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>ConstraintValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现不应该缓存验证器实例，因为可以在</font></font><code>initialize()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法中</font><font style="vertical-align: inherit;">更改每个实例的状态</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="section-parameter-name-provider"><a class="anchor" href="#section-parameter-name-provider"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.4。 </font></font><code>ParameterNameProvider</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果违反了方法或构造函数参数约束，则该</font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接口用于检索参数名称，并通过约束违规的属性路径使其可供用户使用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认实现返回通过Java反射API获得的参数名称。</font><font style="vertical-align: inherit;">如果使用</font></font><code>-parameters</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译器标志编译源代码，将返回源代码中的实际参数名称。</font><font style="vertical-align: inherit;">在形式，否则合成的名字</font></font><code>arg0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>arg1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等将被使用。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用自定义参数名称提供程序，请在引导期间传递提供程序的实例，如</font></font><a href="#example-using-custom-parameter-name-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.10“使用自定义</font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者将提供程序的完全限定类名指定为</font><em><font style="vertical-align: inherit;">META-INF / validation中</font></em></font><code>&lt;parameter-name-provider&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素的</font><font style="vertical-align: inherit;">值</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件（请参见</font></font><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.1节“在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">validation.xml中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置验证器工厂</font><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这在</font></font><a href="#example-using-custom-parameter-name-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.10“使用自定义</font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中进行了</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-custom-parameter-name-provider" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.10：使用自定义 </font></font><code>ParameterNameProvider</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter09</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyParameterNameProvider</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ParameterNameProvider</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> getParameterNames</span><span class="pun">(</span><span class="typ">Constructor</span><span class="pun">&lt;?&gt;</span><span class="pln"> constructor</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> getParameterNames</span><span class="pun">(</span><span class="typ">Method</span><span class="pln"> method</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">parameterNameProvider</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyParameterNameProvider</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator附带了一个</font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于</font></font><a href="https://github.com/paul-hammant/paranamer/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ParaNamer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库</font><font style="vertical-align: inherit;">的自定义</font><font style="vertical-align: inherit;">实现，
 </font><font style="vertical-align: inherit;">它提供了几种在运行时获取参数名称的方法。</font><font style="vertical-align: inherit;">请参阅</font></font><a href="#section-paranamer-parameternameprovider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.12节“基于Paranamer </font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
以了解有关此特定实现的更多信息。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="section-clock-provider"><a class="anchor" href="#section-clock-provider"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.5。</font></font><code>ClockProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和时间验证容差</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于与时间相关的验证（</font></font><code>@Past</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code>@Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如约束），定义所考虑的内容可能是有用的</font></font><code>now</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当您想以可靠的方式测试约束时，这一点尤为重要。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考时间由</font></font><code>ClockProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合同</font><font style="vertical-align: inherit;">定义</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该职责的责任</font></font><code>ClockProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">为时间相关的验证者</font><font style="vertical-align: inherit;">提供</font></font><code>java.time.Clock</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义</font></font><code>now</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-custom-clock-provider" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.11：使用自定义 </font></font><code>ClockProvider</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter09</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">time</span><span class="pun">.</span><span class="typ">Clock</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">time</span><span class="pun">.</span><span class="typ">ZonedDateTime</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">ClockProvider</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">FixedClockProvider</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ClockProvider</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Clock</span><span class="pln"> clock</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">FixedClockProvider</span><span class="pun">(</span><span class="typ">ZonedDateTime</span><span class="pln"> dateTime</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        clock </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Clock</span><span class="pun">.</span><span class="kwd">fixed</span><span class="pun">(</span><span class="pln"> dateTime</span><span class="pun">.</span><span class="pln">toInstant</span><span class="pun">(),</span><span class="pln"> dateTime</span><span class="pun">.</span><span class="pln">getZone</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Clock</span><span class="pln"> getClock</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> clock</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">clockProvider</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">FixedClockProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ZonedDateTime</span><span class="pun">.</span><span class="pln">of</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2016</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">15</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ZoneId</span><span class="pun">.</span><span class="pln">of</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Europe/Paris"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，您可以在</font><font style="vertical-align: inherit;">通过</font><em><font style="vertical-align: inherit;">META-INF / validation.xml</font></em><font style="vertical-align: inherit;">配置默认验证器工厂时</font></font><code>ClockProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用该
 </font></font><code>&lt;clock-provider&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">指定实现的完全限定类名</font><font style="vertical-align: inherit;">
（请参阅</font><a href="#chapter-xml-configuration"><font style="vertical-align: inherit;">第8章，</font></a><a href="#chapter-xml-configuration"><em><font style="vertical-align: inherit;">通过XML配置</font></em></a><font style="vertical-align: inherit;">）。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="#chapter-xml-configuration"><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em></a><font style="vertical-align: inherit;"></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证</font></font><code>@Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>@Past</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束时，您可能希望获取当前时间。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以</font></font><code>ClockProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过调用</font></font><code>ConstraintValidatorContext#getClockProvider()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">获取</font><font style="vertical-align: inherit;">验证器中的
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，如果要</font></font><code>@Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用更明确</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">替换</font><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">的默认消息，这可能很有用</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在处理分布式体系结构时，在应用时间约束（如</font></font><code>@Past</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或）</font><font style="vertical-align: inherit;">时可能需要一些容差</font></font><code>@Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过引导来设置时间验证容差，</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：</font></font></p>
</div>
<div id="example-using-temporal-validation-tolerance" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.12：使用时间验证容差</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">temporalValidationTolerance</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Duration</span><span class="pun">.</span><span class="pln">ofMillis</span><span class="pun">(</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，您可以通过</font></font><code>hibernate.validator.temporal_validation_tolerance</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">属性来在</font><font style="vertical-align: inherit;">XML配置中定义它</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此属性的值必须</font></font><code>long</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是以毫秒为单位定义容差。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实现自己的时间约束时，您可能需要访问时间验证容差。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它可以通过调用</font></font><code>HibernateConstraintValidatorInitializationContext#getTemporalValidationTolerance()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">获得</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，要在初始化时访问此上下文，您的约束验证程序必须实现该</font></font><code>HibernateConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约定（请参见</font></font><a href="#constraint-validator-hibernateconstraintvalidator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.1.2.2节“ </font></font><code>HibernateConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">该合同目前标记为孵化：未来可能会发生变化。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="section-bootstrapping-valueextractors"><a class="anchor" href="#section-bootstrapping-valueextractors"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.6。</font><font style="vertical-align: inherit;">注册</font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小号</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font></font><a href="#chapter-valueextraction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7章“ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值提取”中所述</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以在引导期间注册其他值提取器（有关</font><font style="vertical-align: inherit;">注册值提取器的其他方法，</font><font style="vertical-align: inherit;">请参见</font></font><a href="#section-valueextraction-registeringvalueextractor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第7.5节“注册</font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#example-registering-value-extractor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.13，“注册附加值提取器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了我们如何注册我们之前创建的值提取器来提取密钥和Guava的值</font></font><code>Multimap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-registering-value-extractor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.13：注册其他值提取器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">addValueExtractor</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MultimapKeyValueExtractor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">addValueExtractor</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MultimapValueValueExtractor</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_mapping_streams"><a class="anchor" href="#_adding_mapping_streams"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.7。</font><font style="vertical-align: inherit;">添加映射流</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前所述，您可以使用基于XML的约束映射配置应用于Java bean的约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定的映射文件之外</font><font style="vertical-align: inherit;">，您还可以通过添加其他映射
 </font></font><code>Configuration#addMapping()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（请参见</font></font><a href="#example-adding-mapping-streams"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.14“添加约束映射流”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">请注意，传递的输入流必须遵守</font></font><a href="#section-mapping-xml-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2节“通过映射约束</font></font><code>constraint-mappings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的约束映射的XML模式
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-adding-mapping-streams" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.14：添加约束映射流</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">InputStream</span><span class="pln"> constraintMapping1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="typ">InputStream</span><span class="pln"> constraintMapping2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byDefaultProvider</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">addMapping</span><span class="pun">(</span><span class="pln"> constraintMapping1 </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">addMapping</span><span class="pun">(</span><span class="pln"> constraintMapping2 </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您应该在创建验证器工厂后关闭任何传递的输入流。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="section-provider-specific-settings"><a class="anchor" href="#section-provider-specific-settings"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.8。</font><font style="vertical-align: inherit;">特定于提供者的设置</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过返回的配置对象</font></font><code>Validation#byProvider()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以配置提供程序特定的选项。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Hibernate Validator的情况下，这允许您启用失败快速模式并传递一个或多个编程约束映射，如
 </font></font><a href="#example-hibernate-validator-specific-options"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.15“设置Hibernate Validator特定选项”中所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-hibernate-validator-specific-options" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.15：设置Hibernate Validator特定选项</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">failFast</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">addMapping</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="typ">ConstraintMapping</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，可以通过提供者特定选项传递</font></font><code>Configuration#addProperty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Hibernate Validator也支持以这种方式启用故障快速模式：</font></font></p>
</div>
<div id="example-hibernate-validator-specific-option-via-addproperty" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.16：通过启用Hibernate Validator特定选项 </font></font><code>addProperty()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">addProperty</span><span class="pun">(</span><span class="pln"> </span><span class="str">"hibernate.validator.fail_fast"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"true"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关故障快速模式和约束声明API的更多信息</font></font><a href="#section-fail-fast"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a href="#section-fail-fast"><font style="vertical-align: inherit;">第12.2节“快速失败模式”</font></a><font style="vertical-align: inherit;">和</font></font><a href="#section-programmatic-api"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.4节“编程约束定义和声明”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="section-script-evaluator-factory"><a class="anchor" href="#section-script-evaluator-factory"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.9。</font><font style="vertical-align: inherit;">配置</font></font><code>ScriptEvaluatorFactory</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于类似</font></font><code>@ScriptAssert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和的</font><font style="vertical-align: inherit;">约束</font></font><code>@ParameterScriptAssert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，配置脚本引擎的初始化方式以及脚本评估程序的构建方式可能很有用。</font><font style="vertical-align: inherit;">这可以通过设置自定义实现来完成</font></font><code>ScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特别是，这对于模块化环境（例如OSGi）非常重要，因为用户可能会遇到模块化类加载和</font></font><a href="https://www.jcp.org/en/jsr/detail?id=223"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 223的问题</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">它还允许使用任何自定义脚本引擎，不一定基于
 </font></font><a href="https://www.jcp.org/en/jsr/detail?id=223"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 223</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（例如Spring Expression Language）。</font></font></p>
</div>
<div class="sect4">
<h5 id="_xml_configuration"><a class="anchor" href="#_xml_configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.9.1。</font><font style="vertical-align: inherit;">XML配置</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要指定</font></font><code>ScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via XML，您需要定义</font></font><code>hibernate.validator.script_evaluator_factory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
属性。</font></font></p>
</div>
<div id="example-script-evaluator-factory-xml" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.17：定义</font></font><code>ScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">via XML</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;validation-config</span><span class="pln">
        </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/configuration"</span><span class="pln">
        </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
        </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/configuration
            http://xmlns.jcp.org/xml/ns/validation/configuration/validation-configuration-2.0.xsd"</span><span class="pln">
        </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"2.0"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.validator.script_evaluator_factory"</span><span class="tag">&gt;</span><span class="pln">
        org.hibernate.validator.referenceguide.chapter09.CustomScriptEvaluatorFactory
    </span><span class="tag">&lt;/property&gt;</span><span class="pln">

</span><span class="tag">&lt;/validation-config&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，指定的</font></font><code>ScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须具有no-arg构造函数。</font></font></p>
</div>
</div>
<div class="sect4">
<h5 id="_programmatic_configuration"><a class="anchor" href="#_programmatic_configuration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.9.2。</font><font style="vertical-align: inherit;">程序化配置</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要以编程方式配置它，您需要将实例传递</font></font><code>ScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这为配置提供了更大的灵活性</font></font><code>ScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="#example-script-evaluator-factory-programmatically"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.18“以</font></font><code>ScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编程方式</font><font style="vertical-align: inherit;">定义</font><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
显示了如何完成此操作。</font></font></p>
</div>
<div id="example-script-evaluator-factory-programmatically" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.18：以</font></font><code>ScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编程方式</font><font style="vertical-align: inherit;">定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">scriptEvaluatorFactory</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CustomScriptEvaluatorFactory</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_code_scriptevaluatorfactory_code_implementation_examples"><a class="anchor" href="#_custom_code_scriptevaluatorfactory_code_implementation_examples"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.2.9.3。</font><font style="vertical-align: inherit;">自定义</font></font><code>ScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现示例</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节介绍了几个</font></font><code>ScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在模块化环境中使用</font><font style="vertical-align: inherit;">的自定义</font><font style="vertical-align: inherit;">实现，以及一个使用</font></font><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Expression Language</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
编写约束脚本的实现。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块化环境和</font></font><a href="https://www.jcp.org/en/jsr/detail?id=223"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 223的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">问题</font><font style="vertical-align: inherit;">来自类加载。</font><font style="vertical-align: inherit;">脚本引擎可用的类加载器可能与Hibernate Validator不同。</font><font style="vertical-align: inherit;">因此，使用默认策略将找不到脚本引擎。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要解决此问题，</font></font><code>MultiClassLoaderScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以引入以下类：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">/*
 * Hibernate Validator, declare and validate application constraints
 *
 * License: Apache License, Version 2.0
 * See the license.txt file in the root directory or &lt;http://www.apache.org/licenses/LICENSE-2.0&gt;.
 */</span><span class="pln">
</span><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">osgi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">script</span><span class="pun">.</span><span class="typ">ScriptEngine</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">script</span><span class="pun">.</span><span class="typ">ScriptEngineManager</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">.</span><span class="typ">AbstractCachingScriptEvaluatorFactory</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">.</span><span class="typ">ScriptEngineScriptEvaluator</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">.</span><span class="typ">ScriptEvaluationException</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">.</span><span class="typ">ScriptEvaluator</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">.</span><span class="typ">ScriptEvaluatorFactory</span><span class="pun">;</span><span class="pln">

</span><span class="com">/**
 * {@link ScriptEvaluatorFactory} that allows you to pass multiple {@link ClassLoader}s that will be used
 * to search for {@link ScriptEngine}s. Useful in environments similar to OSGi, where script engines can be
 * found only in {@link ClassLoader}s different from default one.
 *
 * @author Marko Bekhta
 */</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MultiClassLoaderScriptEvaluatorFactory</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractCachingScriptEvaluatorFactory</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ClassLoader</span><span class="pun">[]</span><span class="pln"> classLoaders</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">MultiClassLoaderScriptEvaluatorFactory</span><span class="pun">(</span><span class="typ">ClassLoader</span><span class="pun">...</span><span class="pln"> classLoaders</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> classLoaders</span><span class="pun">.</span><span class="pln">length </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalArgumentException</span><span class="pun">(</span><span class="pln"> </span><span class="str">"No class loaders were passed"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">classLoaders </span><span class="pun">=</span><span class="pln"> classLoaders</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">ScriptEvaluator</span><span class="pln"> createNewScriptEvaluator</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> languageName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">ClassLoader</span><span class="pln"> classLoader </span><span class="pun">:</span><span class="pln"> classLoaders </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">ScriptEngine</span><span class="pln"> engine </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ScriptEngineManager</span><span class="pun">(</span><span class="pln"> classLoader </span><span class="pun">).</span><span class="pln">getEngineByName</span><span class="pun">(</span><span class="pln"> languageName </span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> engine </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ScriptEngineScriptEvaluator</span><span class="pun">(</span><span class="pln"> engine </span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ScriptEvaluationException</span><span class="pun">(</span><span class="pln"> </span><span class="str">"No JSR 223 script engine found for language "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> languageName </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后声明：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">scriptEvaluatorFactory</span><span class="pun">(</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MultiClassLoaderScriptEvaluatorFactory</span><span class="pun">(</span><span class="pln"> </span><span class="typ">GroovyScriptEngineFactory</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getClassLoader</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样，就可以传递多个</font></font><code>ClassLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例：通常是想要</font></font><code>ScriptEngine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">类的类加载器</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OSGi环境的替代方法可以是使用</font></font><code>OsgiScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面定义的：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">/*
 * Hibernate Validator, declare and validate application constraints
 *
 * License: Apache License, Version 2.0
 * See the license.txt file in the root directory or &lt;http://www.apache.org/licenses/LICENSE-2.0&gt;.
 */</span><span class="pln">
</span><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">osgi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">BufferedReader</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">IOException</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">InputStreamReader</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">net</span><span class="pun">.</span><span class="pln">URL</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Arrays</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Collections</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Enumeration</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">List</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Objects</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">stream</span><span class="pun">.</span><span class="typ">Collectors</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">stream</span><span class="pun">.</span><span class="typ">Stream</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">script</span><span class="pun">.</span><span class="typ">ScriptEngineFactory</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">script</span><span class="pun">.</span><span class="typ">ScriptEngineManager</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">ValidationException</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">.</span><span class="typ">AbstractCachingScriptEvaluatorFactory</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">.</span><span class="typ">ScriptEngineScriptEvaluator</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">.</span><span class="typ">ScriptEvaluator</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">.</span><span class="typ">ScriptEvaluatorFactory</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">spi</span><span class="pun">.</span><span class="pln">scripting</span><span class="pun">.</span><span class="typ">ScriptEvaluatorNotFoundException</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">osgi</span><span class="pun">.</span><span class="pln">framework</span><span class="pun">.</span><span class="typ">Bundle</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">osgi</span><span class="pun">.</span><span class="pln">framework</span><span class="pun">.</span><span class="typ">BundleContext</span><span class="pun">;</span><span class="pln">

</span><span class="com">/**
 * {@link ScriptEvaluatorFactory} suitable for OSGi environments. It is created
 * based on the {@code BundleContext} which is used to iterate through {@code Bundle}s and find all {@link ScriptEngineFactory}
 * candidates.
 *
 * @author Marko Bekhta
 */</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">OsgiScriptEvaluatorFactory</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractCachingScriptEvaluatorFactory</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">ScriptEngineManager</span><span class="pun">&gt;</span><span class="pln"> scriptEngineManagers</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">OsgiScriptEvaluatorFactory</span><span class="pun">(</span><span class="typ">BundleContext</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">scriptEngineManagers </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">unmodifiableList</span><span class="pun">(</span><span class="pln"> findManagers</span><span class="pun">(</span><span class="pln"> context </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">ScriptEvaluator</span><span class="pln"> createNewScriptEvaluator</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> languageName</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">ScriptEvaluatorNotFoundException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> scriptEngineManagers</span><span class="pun">.</span><span class="pln">stream</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln"> manager </span><span class="pun">-&gt;</span><span class="pln"> manager</span><span class="pun">.</span><span class="pln">getEngineByName</span><span class="pun">(</span><span class="pln"> languageName </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">::</span><span class="pln">nonNull </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln"> engine </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ScriptEngineScriptEvaluator</span><span class="pun">(</span><span class="pln"> engine </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">findFirst</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">orElseThrow</span><span class="pun">(</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ValidationException</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Unable to find script evaluator for '%s'."</span><span class="pun">,</span><span class="pln"> languageName </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">ScriptEngineManager</span><span class="pun">&gt;</span><span class="pln"> findManagers</span><span class="pun">(</span><span class="typ">BundleContext</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> findFactoryCandidates</span><span class="pun">(</span><span class="pln"> context </span><span class="pun">).</span><span class="pln">stream</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln"> className </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ScriptEngineManager</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="pln"> className </span><span class="pun">).</span><span class="pln">getClassLoader</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                    </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">ClassNotFoundException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ValidationException</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Unable to instantiate '"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> className </span><span class="pun">+</span><span class="pln"> </span><span class="str">"' based engine factory manager."</span><span class="pun">,</span><span class="pln"> e </span><span class="pun">);</span><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln"> </span><span class="pun">).</span><span class="pln">collect</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Collectors</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">/**
     * Iterates through all bundles to get the available {@link ScriptEngineFactory} classes
     *
     * @return the names of the available ScriptEngineFactory classes
     *
     * @throws IOException
     */</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> findFactoryCandidates</span><span class="pun">(</span><span class="typ">BundleContext</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Arrays</span><span class="pun">.</span><span class="pln">stream</span><span class="pun">(</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">getBundles</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">::</span><span class="pln">nonNull </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="pln"> bundle </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">!</span><span class="str">"system.bundle"</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"> bundle</span><span class="pun">.</span><span class="pln">getSymbolicName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">toStreamOfResourcesURL </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Objects</span><span class="pun">::</span><span class="pln">nonNull </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">flatMap</span><span class="pun">(</span><span class="pln"> url </span><span class="pun">-&gt;</span><span class="pln"> toListOfFactoryCandidates</span><span class="pun">(</span><span class="pln"> url </span><span class="pun">).</span><span class="pln">stream</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">collect</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Collectors</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Stream</span><span class="pun">&lt;</span><span class="pln">URL</span><span class="pun">&gt;</span><span class="pln"> toStreamOfResourcesURL</span><span class="pun">(</span><span class="typ">Bundle</span><span class="pln"> bundle</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Enumeration</span><span class="pun">&lt;</span><span class="pln">URL</span><span class="pun">&gt;</span><span class="pln"> entries </span><span class="pun">=</span><span class="pln"> bundle</span><span class="pun">.</span><span class="pln">findEntries</span><span class="pun">(</span><span class="pln">
                </span><span class="str">"META-INF/services"</span><span class="pun">,</span><span class="pln">
                </span><span class="str">"javax.script.ScriptEngineFactory"</span><span class="pun">,</span><span class="pln">
                </span><span class="kwd">false</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> entries </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">list</span><span class="pun">(</span><span class="pln"> entries </span><span class="pun">).</span><span class="pln">stream</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Stream</span><span class="pun">.</span><span class="pln">empty</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> toListOfFactoryCandidates</span><span class="pun">(</span><span class="pln">URL url</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">InputStreamReader</span><span class="pun">(</span><span class="pln"> url</span><span class="pun">.</span><span class="pln">openStream</span><span class="pun">(),</span><span class="pln"> </span><span class="str">"UTF-8"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> reader</span><span class="pun">.</span><span class="pln">lines</span><span class="pun">()</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">map</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">::</span><span class="pln">trim </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="pln"> line </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">line</span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="pln"> line </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">line</span><span class="pun">.</span><span class="pln">startsWith</span><span class="pun">(</span><span class="pln"> </span><span class="str">"#"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">collect</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Collectors</span><span class="pun">.</span><span class="pln">toList</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IOException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ValidationException</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Unable to read the ScriptEngineFactory resource file"</span><span class="pun">,</span><span class="pln"> e </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后声明：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">scriptEvaluatorFactory</span><span class="pun">(</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">OsgiScriptEvaluatorFactory</span><span class="pun">(</span><span class="pln"> </span><span class="typ">FrameworkUtil</span><span class="pun">.</span><span class="pln">getBundle</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getBundleContext</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它专为OSGi环境设计，允许您传递</font></font><code>BundleContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将用于搜索</font></font><code>ScriptEngineFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的参数。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前所述，您还可以使用不基于</font></font><a href="https://www.jcp.org/en/jsr/detail?id=223"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 223的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本引擎</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，要使用</font></font><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#expressions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spring Expression Language</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以将a定义</font></font><code>SpringELScriptEvaluatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter09</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SpringELScriptEvaluatorFactory</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractCachingScriptEvaluatorFactory</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">ScriptEvaluator</span><span class="pln"> createNewScriptEvaluator</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> languageName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="str">"spring"</span><span class="pun">.</span><span class="pln">equalsIgnoreCase</span><span class="pun">(</span><span class="pln"> languageName </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalStateException</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Only Spring EL is supported"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SpringELScriptEvaluator</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SpringELScriptEvaluator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ScriptEvaluator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

        </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ExpressionParser</span><span class="pln"> expressionParser </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SpelExpressionParser</span><span class="pun">();</span><span class="pln">

        </span><span class="lit">@Override</span><span class="pln">
        </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> evaluate</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> script</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> bindings</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">ScriptEvaluationException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="typ">Expression</span><span class="pln"> expression </span><span class="pun">=</span><span class="pln"> expressionParser</span><span class="pun">.</span><span class="pln">parseExpression</span><span class="pun">(</span><span class="pln"> script </span><span class="pun">);</span><span class="pln">
                </span><span class="typ">EvaluationContext</span><span class="pln"> context </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StandardEvaluationContext</span><span class="pun">(</span><span class="pln"> bindings</span><span class="pun">.</span><span class="pln">values</span><span class="pun">().</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
                </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> binding </span><span class="pun">:</span><span class="pln"> bindings</span><span class="pun">.</span><span class="pln">entrySet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    context</span><span class="pun">.</span><span class="pln">setVariable</span><span class="pun">(</span><span class="pln"> binding</span><span class="pun">.</span><span class="pln">getKey</span><span class="pun">(),</span><span class="pln"> binding</span><span class="pun">.</span><span class="pln">getValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">return</span><span class="pln"> expression</span><span class="pun">.</span><span class="pln">getValue</span><span class="pun">(</span><span class="pln"> context </span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">ParseException</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">EvaluationException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ScriptEvaluationException</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Unable to evaluate SpEL script"</span><span class="pun">,</span><span class="pln"> e </span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个工厂允许使用Spring Expression Language </font></font><code>ScriptAssert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ParameterScriptAssert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
约束：</font></font></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="lit">@ScriptAssert</span><span class="pun">(</span><span class="pln">script </span><span class="pun">=</span><span class="pln"> </span><span class="str">"value &gt; 0"</span><span class="pun">,</span><span class="pln"> lang </span><span class="pun">=</span><span class="pln"> </span><span class="str">"spring"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> getValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> value</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-configuring-validator"><a class="anchor" href="#section-configuring-validator"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.3。</font><font style="vertical-align: inherit;">配置验证器</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用配置的验证器工厂时，有时可能需要将不同的配置应用于单个</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font></font><a href="#example-using-context"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.25“ </font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font><font style="vertical-align: inherit;">配置</font><font style="vertical-align: inherit;">实例</font></font><code>usingContext()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何通过调用实现这一点</font></font><code>ValidatorFactory#usingContext()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-context" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.25：</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font><font style="vertical-align: inherit;">配置</font><font style="vertical-align: inherit;">实例</font></font><code>usingContext()</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">buildDefaultValidatorFactory</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> validatorFactory</span><span class="pun">.</span><span class="pln">usingContext</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">messageInterpolator</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyMessageInterpolator</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">traversableResolver</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyTraversableResolver</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validator-metadata-api"><a class="anchor" href="#validator-metadata-api"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.使用约束元数据</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation规范不仅提供验证引擎，还提供用于以统一方式检索约束元数据的API，无论是使用注释还是通过XML映射声明约束。</font><font style="vertical-align: inherit;">阅读本章以了解有关此API及其可能性的更多信息。</font><font style="vertical-align: inherit;">您可以在包中找到所有元数据API类型</font></font><code>javax.validation.metadata</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章中提供的示例基于</font></font><a href="#metadata-example-car"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example 10.1“Example classes”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示的类和约束声明
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="metadata-example-car" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.1：示例类</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter10</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Basic</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter10</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Vehicle</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Basic</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pun">(</span><span class="pln">groups </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Vehicle</span><span class="pun">.</span><span class="typ">Basic</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> getManufacturer</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter10</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@ValidCar</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Vehicle</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">SeverityInfo</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> max </span><span class="pun">=</span><span class="pln"> </span><span class="lit">14</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> licensePlate</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> driver</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> modelName</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln">
            </span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">String</span><span class="pln"> licencePlate</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Person</span><span class="pln"> driver</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">String</span><span class="pln"> modelName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">licensePlate </span><span class="pun">=</span><span class="pln"> licencePlate</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">driver </span><span class="pun">=</span><span class="pln"> driver</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">modelName </span><span class="pun">=</span><span class="pln"> modelName</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> driveAway</span><span class="pun">(</span><span class="lit">@Max</span><span class="pun">(</span><span class="lit">75</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> speed</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@LuggageCountMatchesPassengerCount</span><span class="pun">(</span><span class="pln">
            piecesOfLuggagePerPassenger </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln">
            validationAppliesTo </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ConstraintTarget</span><span class="pun">.</span><span class="pln">PARAMETERS</span><span class="pun">,</span><span class="pln">
            payload </span><span class="pun">=</span><span class="pln"> </span><span class="typ">SeverityInfo</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
            message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"There must not be more than {piecesOfLuggagePerPassenger} pieces "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
                    </span><span class="str">"of luggage per passenger."</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> load</span><span class="pun">(</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> passengers</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">PieceOfLuggage</span><span class="pun">&gt;</span><span class="pln"> luggage</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getManufacturer</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setManufacturer</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Valid</span><span class="pln">
    </span><span class="lit">@ConvertGroup</span><span class="pun">(</span><span class="kwd">from</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Default</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> to </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="typ">Basic</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> getDriver</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> driver</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//further getters and setters...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter10</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Library</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="lit">@NotNull</span><span class="pln"> </span><span class="lit">@Valid</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">&gt;</span><span class="pln"> books</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter10</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotEmpty</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@NotEmpty</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> author</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//getters and setters ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_beandescriptor_code"><a class="anchor" href="#_code_beandescriptor_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1。 </font></font><code>BeanDescriptor</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元数据API的入口点是方法</font></font><code>Validator#getConstraintsForClass()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它返回</font></font><a href="http://docs.jboss.org/hibernate/beanvalidation/spec/2.0/api/?javax/validation/metadata/BeanDescriptor.html"><code>BeanDescriptor</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">的实例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用此描述符，您可以获取直接在bean本身（类或属性级别）上声明的约束的元数据，还可以检索表示单个属性，方法和构造函数的元数据描述符。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#metadata-example-using-beandescriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如10.2，“使用</font></font><code>BeanDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示了如何检索</font></font><code>BeanDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
 </font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类，以及如何在声明的形式使用该描述符。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果请求的类托管的约束声明无效，</font></font><code>ValidationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则抛出a。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="metadata-example-using-beandescriptor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.2：使用 </font></font><code>BeanDescriptor</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">BeanDescriptor</span><span class="pln"> carDescriptor </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">getConstraintsForClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">isBeanConstrained</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//one class-level constraint</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//manufacturer, licensePlate, driver</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstrainedProperties</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//property has constraint</span><span class="pln">
assertNotNull</span><span class="pun">(</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForProperty</span><span class="pun">(</span><span class="pln"> </span><span class="str">"licensePlate"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//property is marked with @Valid</span><span class="pln">
assertNotNull</span><span class="pun">(</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForProperty</span><span class="pun">(</span><span class="pln"> </span><span class="str">"driver"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//constraints from getter method in interface and implementation class are returned</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">2</span><span class="pun">,</span><span class="pln">
        carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForProperty</span><span class="pun">(</span><span class="pln"> </span><span class="str">"manufacturer"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//property is not constrained</span><span class="pln">
assertNull</span><span class="pun">(</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForProperty</span><span class="pun">(</span><span class="pln"> </span><span class="str">"modelName"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//driveAway(int), load(List&lt;Person&gt;, List&lt;PieceOfLuggage&gt;)</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstrainedMethods</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MethodType</span><span class="pun">.</span><span class="pln">NON_GETTER </span><span class="pun">).</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//driveAway(int), getManufacturer(), getDriver(), load(List&lt;Person&gt;, List&lt;PieceOfLuggage&gt;)</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">4</span><span class="pun">,</span><span class="pln">
        carDescriptor</span><span class="pun">.</span><span class="pln">getConstrainedMethods</span><span class="pun">(</span><span class="pln"> </span><span class="typ">MethodType</span><span class="pun">.</span><span class="pln">NON_GETTER</span><span class="pun">,</span><span class="pln"> </span><span class="typ">MethodType</span><span class="pun">.</span><span class="pln">GETTER </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//driveAway(int)</span><span class="pln">
assertNotNull</span><span class="pun">(</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForMethod</span><span class="pun">(</span><span class="pln"> </span><span class="str">"driveAway"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//getManufacturer()</span><span class="pln">
assertNotNull</span><span class="pun">(</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForMethod</span><span class="pun">(</span><span class="pln"> </span><span class="str">"getManufacturer"</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//setManufacturer() is not constrained</span><span class="pln">
assertNull</span><span class="pun">(</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForMethod</span><span class="pun">(</span><span class="pln"> </span><span class="str">"setManufacturer"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//Car(String, String, Person, String)</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstrainedConstructors</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//Car(String, String, Person, String)</span><span class="pln">
assertNotNull</span><span class="pun">(</span><span class="pln">
        carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForConstructor</span><span class="pun">(</span><span class="pln">
                </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
                </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
                </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
                </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过确定指定的类是否承载任何类或属性级约束
 </font></font><code>isBeanConstrained()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">不考虑方法或构造函数约束</font></font><code>isBeanConstrained()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该方法</font></font><code>getConstraintDescriptors()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于派生自的所有描述符都是通用的</font></font><code>ElementDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（参见</font></font><a href="#validator-metadata-api-elementdescriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第10.4节“ </font></font><code>ElementDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），并返回一组描述符，这些描述符表示在给定元素上直接声明的约束。</font><font style="vertical-align: inherit;">如果是</font></font><code>BeanDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则返回bean的类级别约束。</font><font style="vertical-align: inherit;">更多细节</font></font><code>ConstraintDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在
 </font></font><a href="#section-constraint-descriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第10.7节“ </font></font><code>ConstraintDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中找到</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code>getConstraintsForProperty()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>getConstraintsForMethod()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>getConstraintsForConstructor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以获取代表一个给定的属性或可执行元素，其名称标识的描述符和，在方法和构造函数，参数类型案件。</font><font style="vertical-align: inherit;">以下各节介绍了这些方法返回的不同描述符类型。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，这些方法根据约束继承规则考虑在超类型处声明的约束，如</font></font><a href="#section-constraint-inheritance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.1.5节“约束继承”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">一个示例是</font></font><code>manufacturer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">的描述符</font><font style="vertical-align: inherit;">，它提供对定义的所有约束
 </font></font><code>Vehicle#getManufacturer()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和实现方法的访问</font></font><code>Car#getManufacturer()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果指定的元素不存在或没有约束，则返回。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的方法</font></font><code>getConstrainedProperties()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>getConstrainedMethods()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>getConstrainedConstructors()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
返回（潜在空）设置与分别所有约束的属性，方法和构造函数。</font><font style="vertical-align: inherit;">如果元素具有至少一个约束或标记为级联验证，则该元素被视为受约束。</font><font style="vertical-align: inherit;">调用时</font></font><code>getConstrainedMethods()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以指定要返回的方法的类型（getter，non-getters或两者）。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="section-property-descriptor"><a class="anchor" href="#section-property-descriptor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2。 </font></font><code>PropertyDescriptor</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口
 </font></font><a href="http://docs.jboss.org/hibernate/beanvalidation/spec/2.0/api/?javax/validation/metadata/PropertyDescriptor.html"><code>PropertyDescriptor</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示类的一个给定属性。</font><font style="vertical-align: inherit;">如果遵循JavaBeans命名约定，则在字段或属性获取器上声明约束是否透明。</font></font><a href="#metadata-example-using-propertydescriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.3“使用</font></font><code>PropertyDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何使用该</font></font><code>PropertyDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口。</font></font></p>
</div>
<div id="metadata-example-using-propertydescriptor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.3：使用 </font></font><code>PropertyDescriptor</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">PropertyDescriptor</span><span class="pln"> licensePlateDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForProperty</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"licensePlate"</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//"licensePlate" has two constraints, is not marked with @Valid and defines no group conversions</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"licensePlate"</span><span class="pun">,</span><span class="pln"> licensePlateDescriptor</span><span class="pun">.</span><span class="pln">getPropertyName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> licensePlateDescriptor</span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> licensePlateDescriptor</span><span class="pun">.</span><span class="pln">hasConstraints</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertFalse</span><span class="pun">(</span><span class="pln"> licensePlateDescriptor</span><span class="pun">.</span><span class="pln">isCascaded</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> licensePlateDescriptor</span><span class="pun">.</span><span class="pln">getGroupConversions</span><span class="pun">().</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">PropertyDescriptor</span><span class="pln"> driverDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForProperty</span><span class="pun">(</span><span class="pln"> </span><span class="str">"driver"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//"driver" has no constraints, is marked with @Valid and defines one group conversion</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"driver"</span><span class="pun">,</span><span class="pln"> driverDescriptor</span><span class="pun">.</span><span class="pln">getPropertyName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> driverDescriptor</span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">().</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertFalse</span><span class="pun">(</span><span class="pln"> driverDescriptor</span><span class="pun">.</span><span class="pln">hasConstraints</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> driverDescriptor</span><span class="pun">.</span><span class="pln">isCascaded</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> driverDescriptor</span><span class="pun">.</span><span class="pln">getGroupConversions</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用时</font></font><code>getConstraintDescriptors()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以检索一组</font></font><code>ConstraintDescriptors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供有关给定属性的各个约束的更多信息。</font><font style="vertical-align: inherit;">如果属性标记为级联验证（使用</font><font style="vertical-align: inherit;">注释或通过XML），</font><font style="vertical-align: inherit;">则</font></font><code>isCascaded()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回
 </font><font style="vertical-align: inherit;">该方法</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">否则返回。</font><font style="vertical-align: inherit;">任何已配置的组转换都将返回</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">详细信息</font><a href="#section-group-conversion-descriptor"><font style="vertical-align: inherit;">，</font></a><font style="vertical-align: inherit;">请参见
 </font><a href="#section-group-conversion-descriptor"><font style="vertical-align: inherit;">第10.6节“ </font></a><a href="#section-group-conversion-descriptor"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">。</font></font><code>true</code><font style="vertical-align: inherit;"></font><code>@Valid</code><font style="vertical-align: inherit;"></font><code>false</code><font style="vertical-align: inherit;"></font><code>getGroupConversions()</code><font style="vertical-align: inherit;"></font><a href="#section-group-conversion-descriptor"><font style="vertical-align: inherit;"></font><code>GroupConversionDescriptor</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code>GroupConversionDescriptor</code><font style="vertical-align: inherit;"></font></p>
</div>
</div>
<div class="sect2">
<h3 id="_code_methoddescriptor_code_and_code_constructordescriptor_code"><a class="anchor" href="#_code_methoddescriptor_code_and_code_constructordescriptor_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.3。</font></font><code>MethodDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ConstructorDescriptor</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束方法和构造函数分别由接口表示
 </font><font style="vertical-align: inherit;">。
</font><a href="#metadata-example-using-methodandconstructordescriptor"><font style="vertical-align: inherit;">例10.4，“使用</font></a><a href="#metadata-example-using-methodandconstructordescriptor"><font style="vertical-align: inherit;">和</font></a><a href="#metadata-example-using-methodandconstructordescriptor"><font style="vertical-align: inherit;">”</font></a><font style="vertical-align: inherit;">演示了如何使用这些描述符。</font></font><a href="http://docs.jboss.org/hibernate/beanvalidation/spec/2.0/api/?javax/validation/metadata/MethodDescriptor.html"><code>MethodDescriptor</code></a>
<a href="http://docs.jboss.org/hibernate/beanvalidation/spec/2.0/api/?javax/validation/metadata/ConstructorDescriptor.html"><code>ConstructorDescriptor</code></a><font style="vertical-align: inherit;"></font><a href="#metadata-example-using-methodandconstructordescriptor"><font style="vertical-align: inherit;"></font><code>MethodDescriptor</code><font style="vertical-align: inherit;"></font><code>ConstructorDescriptor</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
<div id="metadata-example-using-methodandconstructordescriptor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.4：使用</font></font><code>MethodDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ConstructorDescriptor</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">//driveAway(int) has a constrained parameter and an unconstrained return value</span><span class="pln">
</span><span class="typ">MethodDescriptor</span><span class="pln"> driveAwayDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForMethod</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"driveAway"</span><span class="pun">,</span><span class="pln">
        </span><span class="kwd">int</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"driveAway"</span><span class="pun">,</span><span class="pln"> driveAwayDescriptor</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> driveAwayDescriptor</span><span class="pun">.</span><span class="pln">hasConstrainedParameters</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertFalse</span><span class="pun">(</span><span class="pln"> driveAwayDescriptor</span><span class="pun">.</span><span class="pln">hasConstrainedReturnValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//always returns an empty set; constraints are retrievable by navigating to</span><span class="pln">
</span><span class="com">//one of the sub-descriptors, e.g. for the return value</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> driveAwayDescriptor</span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">().</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ParameterDescriptor</span><span class="pln"> speedDescriptor </span><span class="pun">=</span><span class="pln"> driveAwayDescriptor</span><span class="pun">.</span><span class="pln">getParameterDescriptors</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//The "speed" parameter is located at index 0, has one constraint and is not cascaded</span><span class="pln">
</span><span class="com">//nor does it define group conversions</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"speed"</span><span class="pun">,</span><span class="pln"> speedDescriptor</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> speedDescriptor</span><span class="pun">.</span><span class="pln">getIndex</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> speedDescriptor</span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertFalse</span><span class="pun">(</span><span class="pln"> speedDescriptor</span><span class="pun">.</span><span class="pln">isCascaded</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> speedDescriptor</span><span class="pun">.</span><span class="pln">getGroupConversions</span><span class="pun">().</span><span class="pln">isEmpty</span><span class="pun">();</span><span class="pln">

</span><span class="com">//getDriver() has no constrained parameters but its return value is marked for cascaded</span><span class="pln">
</span><span class="com">//validation and declares one group conversion</span><span class="pln">
</span><span class="typ">MethodDescriptor</span><span class="pln"> getDriverDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForMethod</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"getDriver"</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertFalse</span><span class="pun">(</span><span class="pln"> getDriverDescriptor</span><span class="pun">.</span><span class="pln">hasConstrainedParameters</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> getDriverDescriptor</span><span class="pun">.</span><span class="pln">hasConstrainedReturnValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ReturnValueDescriptor</span><span class="pln"> returnValueDescriptor </span><span class="pun">=</span><span class="pln"> getDriverDescriptor</span><span class="pun">.</span><span class="pln">getReturnValueDescriptor</span><span class="pun">();</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> returnValueDescriptor</span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">().</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> returnValueDescriptor</span><span class="pun">.</span><span class="pln">isCascaded</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> returnValueDescriptor</span><span class="pun">.</span><span class="pln">getGroupConversions</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//load(List&lt;Person&gt;, List&lt;PieceOfLuggage&gt;) has one cross-parameter constraint</span><span class="pln">
</span><span class="typ">MethodDescriptor</span><span class="pln"> loadDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForMethod</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"load"</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> loadDescriptor</span><span class="pun">.</span><span class="pln">hasConstrainedParameters</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertFalse</span><span class="pun">(</span><span class="pln"> loadDescriptor</span><span class="pun">.</span><span class="pln">hasConstrainedReturnValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">1</span><span class="pun">,</span><span class="pln">
        loadDescriptor</span><span class="pun">.</span><span class="pln">getCrossParameterDescriptor</span><span class="pun">().</span><span class="pln">getConstraintDescriptors</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//Car(String, String, Person, String) has one constrained parameter</span><span class="pln">
</span><span class="typ">ConstructorDescriptor</span><span class="pln"> constructorDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForConstructor</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Car"</span><span class="pun">,</span><span class="pln"> constructorDescriptor</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertFalse</span><span class="pun">(</span><span class="pln"> constructorDescriptor</span><span class="pun">.</span><span class="pln">hasConstrainedReturnValue</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> constructorDescriptor</span><span class="pun">.</span><span class="pln">hasConstrainedParameters</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">1</span><span class="pun">,</span><span class="pln">
        constructorDescriptor</span><span class="pun">.</span><span class="pln">getParameterDescriptors</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>getName()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回给定方法或构造函数的名称。</font><font style="vertical-align: inherit;">所述方法
 </font></font><code>hasConstrainedParameters()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>hasConstrainedReturnValue()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于执行快速检查可执行元素是否具有任何参数约束或返回值约束（在单参数或者横参数约束或者约束）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，约束不直接暴露在</font></font><code>MethodDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ConstructorDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而是</font><font style="vertical-align: inherit;">直接暴露在</font><font style="vertical-align: inherit;">表示可执行参数，返回值及其交叉参数约束的专用描述符上。</font><font style="vertical-align: inherit;">为了得到这些描述符之一的保持，调用
 </font></font><code>getParameterDescriptors()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>getReturnValueDescriptor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>getCrossParameterDescriptor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些描述符提供对元素约束（</font></font><code>getConstraintDescriptors()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">访问，</font><font style="vertical-align: inherit;">并且在参数和返回值的情况下，提供对其级联验证（</font></font><code>isValid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
 </font></font><code>getGroupConversions()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">配置的访问</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于参数，您还可以检索索引和名称，如当前使用的参数名称提供程序（参见</font></font><a href="#section-parameter-name-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2.4节，“ </font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）通过</font></font><code>getName()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和返回的</font></font><code>getIndex()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遵循JavaBeans命名约定的Getter方法被视为bean属性，但也被视为约束方法。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这意味着您可以通过获取</font></font><code>PropertyDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（例如
 </font></font><code>BeanDescriptor.getConstraintsForProperty("foo")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）或通过检查getter的返回值描述符</font><font style="vertical-align: inherit;">来检索相关元数据</font></font><code>MethodDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（例如
 </font></font><code>BeanDescriptor.getConstraintsForMethod("getFoo").getReturnValueDescriptor())</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="validator-metadata-api-elementdescriptor"><a class="anchor" href="#validator-metadata-api-elementdescriptor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.4。 </font></font><code>ElementDescriptor</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><a href="http://docs.jboss.org/hibernate/beanvalidation/spec/2.0/api/?javax/validation/metadata/ElementDescriptor.html"><code>ElementDescriptor</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接口是用于各个描述符的类型，如在共同的基类</font></font><code>BeanDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>PropertyDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等。此外
 </font></font><code>getConstraintDescriptors()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它提供了一些常见的所有描述符更多的方法。</font></font></p>
</div>
<div class="paragraph">
<p><code>hasConstraints()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许快速检查元素是否具有任何直接约束（例如，在类情况下为类级约束</font></font><code>BeanDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="paragraph">
<p><code>getElementClass()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回给定描述符表示的元素的Java类型。</font><font style="vertical-align: inherit;">更具体地说，该方法返回</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用时的对象类型</font></font><code>BeanDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
分别</font><font style="vertical-align: inherit;">在</font></font><code>PropertyDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或上</font><font style="vertical-align: inherit;">调用时的属性或参数的类型</font></font><code>ParameterDescriptor</code><font style="vertical-align: inherit;"></font></p>
</li>
<li>
<p><code>Object[].class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当被调用时</font></font><code>CrossParameterDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用时的返回类型</font></font><code>ConstructorDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>MethodDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>ReturnValueDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。
</font></font><code>void.class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将返回没有返回值的方法。</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#metadata-example-using-elementdescriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.5，“使用</font></font><code>ElementDescriptor methods</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何</font><a href="#metadata-example-using-elementdescriptor"><font style="vertical-align: inherit;">使用</font></a><font style="vertical-align: inherit;">这些方法。</font></font></p>
</div>
<div id="metadata-example-using-elementdescriptor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.5：使用 </font></font><code>ElementDescriptor methods</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">PropertyDescriptor</span><span class="pln"> manufacturerDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForProperty</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"manufacturer"</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

assertTrue</span><span class="pun">(</span><span class="pln"> manufacturerDescriptor</span><span class="pun">.</span><span class="pln">hasConstraints</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> manufacturerDescriptor</span><span class="pun">.</span><span class="pln">getElementClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">CrossParameterDescriptor</span><span class="pln"> loadCrossParameterDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForMethod</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"load"</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">).</span><span class="pln">getCrossParameterDescriptor</span><span class="pun">();</span><span class="pln">

assertTrue</span><span class="pun">(</span><span class="pln"> loadCrossParameterDescriptor</span><span class="pun">.</span><span class="pln">hasConstraints</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[].</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> loadCrossParameterDescriptor</span><span class="pun">.</span><span class="pln">getElementClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，</font></font><code>ElementDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供对</font></font><code>ConstraintFinder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API的</font><font style="vertical-align: inherit;">访问</font><font style="vertical-align: inherit;">，允许您以细粒度的方式查询约束元数据。</font></font><a href="#example-constraint-finder"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.6“使用</font></font><code>ConstraintFinder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何</font></font><code>ConstraintFinder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code>findConstraints()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API </font><font style="vertical-align: inherit;">检索
 </font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">并使用API​​查询约束元数据。</font></font></p>
</div>
<div id="example-constraint-finder" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.6：用法 </font></font><code>ConstraintFinder</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">PropertyDescriptor</span><span class="pln"> manufacturerDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForProperty</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"manufacturer"</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//"manufacturer" constraints are declared on the getter, not the field</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln">
        manufacturerDescriptor</span><span class="pun">.</span><span class="pln">findConstraints</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">declaredOn</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">FIELD </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//@NotNull on Vehicle#getManufacturer() is part of another group</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">1</span><span class="pun">,</span><span class="pln">
        manufacturerDescriptor</span><span class="pun">.</span><span class="pln">findConstraints</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">unorderedAndMatchingGroups</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Default</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//@Size on Car#getManufacturer()</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">1</span><span class="pun">,</span><span class="pln">
        manufacturerDescriptor</span><span class="pun">.</span><span class="pln">findConstraints</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">lookingAt</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Scope</span><span class="pun">.</span><span class="pln">LOCAL_ELEMENT </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//@Size on Car#getManufacturer() and @NotNull on Vehicle#getManufacturer()</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">2</span><span class="pun">,</span><span class="pln">
        manufacturerDescriptor</span><span class="pun">.</span><span class="pln">findConstraints</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">lookingAt</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Scope</span><span class="pun">.</span><span class="pln">HIERARCHY </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//Combining several filter options</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">1</span><span class="pun">,</span><span class="pln">
        manufacturerDescriptor</span><span class="pun">.</span><span class="pln">findConstraints</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">declaredOn</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">METHOD </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">lookingAt</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Scope</span><span class="pun">.</span><span class="pln">HIERARCHY </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">unorderedAndMatchingGroups</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Vehicle</span><span class="pun">.</span><span class="typ">Basic</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code>declaredOn()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以搜索</font></font><code>ConstraintDescriptors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某些元素类型的声明。</font><font style="vertical-align: inherit;">这对于查找在字段或getter方法上声明的属性约束很有用。</font></font></p>
</div>
<div class="paragraph">
<p><code>unorderedAndMatchingGroups()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 将结果约束限制为与给定验证组匹配的约束。</font></font></p>
</div>
<div class="paragraph">
<p><code>lookingAt()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许区分在element（</font></font><code>Scope.LOCAL_ELEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">上直接指定的</font><font style="vertical-align: inherit;">约束或属于该元素但在类层次结构（</font></font><code>Scope.HIERARCHY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">中的任何位置托管的约束</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您还可以组合不同的选项，如上一个示例所示。</font></font></p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">订单不受遵守</font></font><code>unorderedAndMatchingGroups()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是序列继承和继承是通过序列进行的。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_code_containerdescriptor_code_and_code_containerelementtypedescriptor_code"><a class="anchor" href="#_code_containerdescriptor_code_and_code_containerelementtypedescriptor_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.5。</font></font><code>ContainerDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ContainerElementTypeDescriptor</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><a href="http://docs.jboss.org/hibernate/beanvalidation/spec/2.0/api/?javax/validation/metadata/ContainerDescriptor.html"><code>ContainerDescriptor</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接口是用于所有支持容器元件约束和级联验证（元素的通用接口</font></font><code>PropertyDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>ParameterDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>ReturnValueDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它有一个</font></font><code>getConstrainedContainerElementTypes()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回一组的方法</font></font><code>ContainerElementTypeDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><code>ContainerElementTypeDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extends </font></font><code>ContainerDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以支持嵌套的容器元素约束。</font></font></p>
</div>
<div class="paragraph">
<p><code>ContainerElementTypeDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 包含有关容器，约束和级联验证的信息。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#metadata-example-using-containerelementtypedescriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.7，“使用</font></font><code>ContainerElementTypeDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何使用它</font></font><code>getConstrainedContainerElementTypes()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来检索一组</font></font><code>ContainerElementTypeDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="metadata-example-using-containerelementtypedescriptor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.7：使用 </font></font><code>ContainerElementTypeDescriptor</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">PropertyDescriptor</span><span class="pln"> booksDescriptor </span><span class="pun">=</span><span class="pln"> libraryDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForProperty</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"books"</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ContainerElementTypeDescriptor</span><span class="pun">&gt;</span><span class="pln"> booksContainerElementTypeDescriptors </span><span class="pun">=</span><span class="pln">
        booksDescriptor</span><span class="pun">.</span><span class="pln">getConstrainedContainerElementTypes</span><span class="pun">();</span><span class="pln">
</span><span class="typ">ContainerElementTypeDescriptor</span><span class="pln"> booksContainerElementTypeDescriptor </span><span class="pun">=</span><span class="pln">
        booksContainerElementTypeDescriptors</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">

assertTrue</span><span class="pun">(</span><span class="pln"> booksContainerElementTypeDescriptor</span><span class="pun">.</span><span class="pln">hasConstraints</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> booksContainerElementTypeDescriptor</span><span class="pun">.</span><span class="pln">isCascaded</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">0</span><span class="pun">,</span><span class="pln">
        booksContainerElementTypeDescriptor</span><span class="pun">.</span><span class="pln">getTypeArgumentIndex</span><span class="pun">().</span><span class="pln">intValue</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        booksContainerElementTypeDescriptor</span><span class="pun">.</span><span class="pln">getContainerClass</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintDescriptor</span><span class="pun">&lt;?&gt;&gt;</span><span class="pln"> constraintDescriptors </span><span class="pun">=</span><span class="pln">
        booksContainerElementTypeDescriptor</span><span class="pun">.</span><span class="pln">getConstraintDescriptors</span><span class="pun">();</span><span class="pln">
</span><span class="typ">ConstraintDescriptor</span><span class="pun">&lt;?&gt;</span><span class="pln"> constraintDescriptor </span><span class="pun">=</span><span class="pln">
        constraintDescriptors</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">NotNull</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        constraintDescriptor</span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">().</span><span class="pln">annotationType</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-group-conversion-descriptor"><a class="anchor" href="#section-group-conversion-descriptor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.6。 </font></font><code>GroupConversionDescriptor</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有那些表示可以进行级联验证的元素的描述符类型（即</font></font><code>PropertyDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>ParameterDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ReturnValueDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）提供对元素组转换的访问权限</font></font><code>getGroupConversions()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">返回的集合包含
 </font></font><a href="http://docs.jboss.org/hibernate/beanvalidation/spec/2.0/api/?javax/validation//metadata/GroupConversionDescriptor.html"><code>GroupConversionDescriptor</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
每个已配置的转换，允许检索转换的源组和目标组。</font></font><a href="#metadata-example-using-groupconversiondescriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.8，“使用</font></font><code>GroupConversionDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
显示了一个例子。</font></font></p>
</div>
<div id="metadata-example-using-groupconversiondescriptor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.8：使用 </font></font><code>GroupConversionDescriptor</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">PropertyDescriptor</span><span class="pln"> driverDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForProperty</span><span class="pun">(</span><span class="pln"> </span><span class="str">"driver"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">GroupConversionDescriptor</span><span class="pun">&gt;</span><span class="pln"> groupConversions </span><span class="pun">=</span><span class="pln"> driverDescriptor</span><span class="pun">.</span><span class="pln">getGroupConversions</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> groupConversions</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">GroupConversionDescriptor</span><span class="pln"> groupConversionDescriptor </span><span class="pun">=</span><span class="pln"> groupConversions</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Default</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> groupConversionDescriptor</span><span class="pun">.</span><span class="pln">getFrom</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="typ">Basic</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> groupConversionDescriptor</span><span class="pun">.</span><span class="pln">getTo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-constraint-descriptor"><a class="anchor" href="#section-constraint-descriptor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.7。 </font></font><code>ConstraintDescriptor</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后但并非最不重要的是，
 </font></font><a href="http://docs.jboss.org/hibernate/beanvalidation/spec/2.0/api/?javax/validation/metadata/ConstraintDescriptor.html"><code>ConstraintDescriptor</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
界面描述了单个约束及其组成约束。</font><font style="vertical-align: inherit;">通过此接口的实例，您可以访问约束注释及其参数。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#metadata-example-using-constraintdescriptor"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.9，“使用</font></font><code>ConstraintDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
显示了如何检索默认约束属性（例如消息模板，组等）以及自定义约束属性（</font></font><code>piecesOfLuggagePerPassenger</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和其他元数据，例如约束的注释类型及其验证器</font></font><code>ConstraintDescriptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="metadata-example-using-constraintdescriptor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例10.9：使用 </font></font><code>ConstraintDescriptor</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="com">//descriptor for the @LuggageCountMatchesPassengerCount constraint on the</span><span class="pln">
</span><span class="com">//load(List&lt;Person&gt;, List&lt;PieceOfLuggage&gt;) method</span><span class="pln">
</span><span class="typ">ConstraintDescriptor</span><span class="pun">&lt;?&gt;</span><span class="pln"> constraintDescriptor </span><span class="pun">=</span><span class="pln"> carDescriptor</span><span class="pun">.</span><span class="pln">getConstraintsForMethod</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"load"</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">).</span><span class="pln">getCrossParameterDescriptor</span><span class="pun">().</span><span class="pln">getConstraintDescriptors</span><span class="pun">().</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">

</span><span class="com">//constraint type</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">LuggageCountMatchesPassengerCount</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln">
        constraintDescriptor</span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">().</span><span class="pln">annotationType</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//standard constraint attributes</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">SeverityInfo</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> constraintDescriptor</span><span class="pun">.</span><span class="pln">getPayload</span><span class="pun">().</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">ConstraintTarget</span><span class="pun">.</span><span class="pln">PARAMETERS</span><span class="pun">,</span><span class="pln">
        constraintDescriptor</span><span class="pun">.</span><span class="pln">getValidationAppliesTo</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Default</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> constraintDescriptor</span><span class="pun">.</span><span class="pln">getGroups</span><span class="pun">().</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"There must not be more than {piecesOfLuggagePerPassenger} pieces of luggage per "</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
        </span><span class="str">"passenger."</span><span class="pun">,</span><span class="pln">
        constraintDescriptor</span><span class="pun">.</span><span class="pln">getMessageTemplate</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//custom constraint attribute</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="lit">2</span><span class="pun">,</span><span class="pln">
        constraintDescriptor</span><span class="pun">.</span><span class="pln">getAttributes</span><span class="pun">().</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> </span><span class="str">"piecesOfLuggagePerPassenger"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="pun">);</span><span class="pln">

</span><span class="com">//no composing constraints</span><span class="pln">
assertTrue</span><span class="pun">(</span><span class="pln"> constraintDescriptor</span><span class="pun">.</span><span class="pln">getComposingConstraints</span><span class="pun">().</span><span class="pln">isEmpty</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="com">//validator class</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">Arrays</span><span class="pun">.&lt;</span><span class="typ">Class</span><span class="pun">&lt;?&gt;&gt;</span><span class="pln">asList</span><span class="pun">(</span><span class="pln"> </span><span class="typ">LuggageCountMatchesPassengerCount</span><span class="pun">.</span><span class="typ">Validator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">),</span><span class="pln">
        constraintDescriptor</span><span class="pun">.</span><span class="pln">getConstraintValidatorClasses</span><span class="pun">()</span><span class="pln">
</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validator-integration"><a class="anchor" href="#validator-integration"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.与其他框架集成</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator旨在用于实现多层数据验证，其中约束在单个位置（带注释的域模型）中表示，并在应用程序的各个不同层中进行检查。</font><font style="vertical-align: inherit;">因此，与其他技术存在多个集成点。</font></font></p>
</div>
<div class="sect2">
<h3 id="validator-checkconstraints-orm"><a class="anchor" href="#validator-checkconstraints-orm"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1。</font><font style="vertical-align: inherit;">ORM集成</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator与Hibernate ORM和所有纯Java Persistence提供程序集成。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当应该验证延迟加载的关联时，建议将约束放在关联的getter上。</font><font style="vertical-align: inherit;">Hibernate ORM将延迟加载的关联替换为通过getter请求初始化/加载的代理实例。</font><font style="vertical-align: inherit;">如果在这种情况下，约束被放置在字段级别，则使用实际的代理实例，这将导致验证错误。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="validator-checkconstraints-db"><a class="anchor" href="#validator-checkconstraints-db"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1.1。</font><font style="vertical-align: inherit;">数据库模式级验证</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开箱即用，Hibernate ORM会将您为实体定义的约束转换为映射元数据。</font><font style="vertical-align: inherit;">例如，如果实体的属性已注释
 </font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则其列将</font></font><code>not null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Hibernate ORM生成的DDL模式中</font><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果由于某种原因需要禁用该功能，请设置</font></font><code>hibernate.validator.apply_to_ddl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为
 </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另请参见</font></font><a href="#validator-defineconstraints-spec"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.3.1节“Bean验证约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="#validator-defineconstraints-hv-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.3.2节“附加约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您还可以通过设置属性将DDL约束生成限制为已定义约束的子集</font></font><code>org.hibernate.validator.group.ddl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该属性指定约束必须属于的组的逗号分隔，完全指定的类名，以便考虑生成DDL模式。</font></font></p>
</div>
</div>
<div class="sect3">
<h4 id="validator-checkconstraints-orm-hibernateevent"><a class="anchor" href="#validator-checkconstraints-orm-hibernateevent"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1.2。</font><font style="vertical-align: inherit;">Hibernate基于ORM事件的验证</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator有一个内置的Hibernate事件监听器
 </font></font><a href="https://github.com/hibernate/hibernate-orm/blob/master/hibernate-core/src/main/java/org/hibernate/cfg/beanvalidation/BeanValidationEventListener.java"><code>org.hibernate.cfg.beanvalidation.BeanValidationEventListener</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 它是Hibernate ORM的一部分。</font><font style="vertical-align: inherit;">每当一个</font></font><code>PreInsertEvent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>PreUpdateEvent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>PreDeleteEvent</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生时，听者会验证该实体实例的所有约束，如果任何违反约束抛出异常。</font><font style="vertical-align: inherit;">默认情况下，在Hibernate ORM进行任何插入或更新之前，将检查对象。</font><font style="vertical-align: inherit;">默认情况下，预删除事件不会触发验证。</font><font style="vertical-align: inherit;">您可以为每个使用性质的事件类型进行验证组</font></font><code>javax.persistence.validation.group.pre-persist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>javax.persistence.validation.group.pre-update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>javax.persistence.validation.group.pre-remove</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些属性的值是要验证的组的逗号分隔的完全指定的类名。</font></font><a href="#example-beanvalidationeventlistener-config"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.1，“手动配置</font></font><code>BeanValidationEvenListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示这些属性的默认值。</font><font style="vertical-align: inherit;">在这种情况下，它们也可以省略。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在约束违规时，该事件将引发一个运行时</font></font><code>ConstraintViolationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包含一组</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述每个失败</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">实例。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果类路径中存在Hibernate Validator，Hibernate ORM将透明地使用它。</font><font style="vertical-align: inherit;">要避免验证，即使Hibernate Validator在类路径中，</font></font><code>javax.persistence.validation.mode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也要</font><font style="vertical-align: inherit;">设置
 </font><font style="vertical-align: inherit;">为none。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果bean未使用验证注释进行注释，则不存在运行时性能开销。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您需要为Hibernate ORM手动设置事件侦听器，请在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hibernate.cfg.xml中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下配置</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div id="example-beanvalidationeventlistener-config" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.1：手动配置 </font></font><code>BeanValidationEvenListener</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;hibernate-configuration&gt;</span><span class="pln">
    </span><span class="tag">&lt;session-factory&gt;</span><span class="pln">
        ...
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.validation.group.pre-persist"</span><span class="tag">&gt;</span><span class="pln">
            javax.validation.groups.Default
        </span><span class="tag">&lt;/property&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.validation.group.pre-update"</span><span class="tag">&gt;</span><span class="pln">
            javax.validation.groups.Default
        </span><span class="tag">&lt;/property&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"javax.persistence.validation.group.pre-remove"</span><span class="tag">&gt;&lt;/property&gt;</span><span class="pln">
        ...
        </span><span class="tag">&lt;event</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"pre-update"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;listener</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.hibernate.cfg.beanvalidation.BeanValidationEventListener"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/event&gt;</span><span class="pln">
        </span><span class="tag">&lt;event</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"pre-insert"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;listener</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.hibernate.cfg.beanvalidation.BeanValidationEventListener"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/event&gt;</span><span class="pln">
        </span><span class="tag">&lt;event</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"pre-delete"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;listener</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.hibernate.cfg.beanvalidation.BeanValidationEventListener"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/event&gt;</span><span class="pln">
    </span><span class="tag">&lt;/session-factory&gt;</span><span class="pln">
</span><span class="tag">&lt;/hibernate-configuration&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jpa"><a class="anchor" href="#_jpa"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1.3。</font><font style="vertical-align: inherit;">JPA</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您使用JPA 2并且Hibernate Validator在类路径中，则JPA2规范要求启用Bean Validation。</font><font style="vertical-align: inherit;">的属性</font></font><code>javax.persistence.validation.group.pre-persist</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>javax.persistence.validation.group.pre-update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>javax.persistence.validation.group.pre-remove</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如描述</font></font><a href="#validator-checkconstraints-orm-hibernateevent"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1.2节，“休眠ORM基于事件的验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此可以被配置中
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的persistence.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">persistence.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还定义了一个节点验证模式，可以设置为</font></font><code>AUTO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><code>CALLBACK</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认是</font></font><code>AUTO</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-presentation-layer"><a class="anchor" href="#section-presentation-layer"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2。</font><font style="vertical-align: inherit;">JSF＆Seam</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用JSF2或JBoss Seam并且运行时环境中存在Hibernate Validator（Bean Validation）时，将为应用程序中的每个字段触发验证。</font></font><a href="#example-jsf2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.2“在JSF2中使用Bean验证”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
显示</font></font><code>f:validateBean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了JSF页面中标记的</font><font style="vertical-align: inherit;">一个示例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><code>validationGroups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性是可选的，可用于指定以逗号分隔的验证组列表。</font><font style="vertical-align: inherit;">默认是
 </font></font><code>javax.validation.groups.Default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关更多信息，请参阅Seam文档或JSF 2规范。</font></font></p>
</div>
<div id="example-jsf2" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.2：在JSF2中使用Bean验证</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;h:form&gt;</span><span class="pln">

  </span><span class="tag">&lt;f:validateBean</span><span class="pln"> </span><span class="atn">validationGroups</span><span class="pun">=</span><span class="atv">"javax.validation.groups.Default"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="tag">&lt;h:inputText</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">#{model.property}</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;h:selectOneRadio</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">#{model.radioProperty}</span><span class="tag">&gt;</span><span class="pln"> ... </span><span class="tag">&lt;/h:selectOneRadio&gt;</span><span class="pln">
    </span><span class="com">&lt;!-- other input components here --&gt;</span><span class="pln">

  </span><span class="tag">&lt;/f:validateBean&gt;</span><span class="pln">

</span><span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSF 2和Bean Validation之间的集成在</font></font><a href="http://jcp.org/en/jsr/detail?id=314"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR-314</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的“Bean验证集成”一章中进行了描述</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有趣的是，JSF 2实现了一个自定义</font></font><code>MessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以确保正确的本地化。</font><font style="vertical-align: inherit;">为了鼓励使用Bean Validation消息工具，JSF 2默认只显示生成的Bean Validation消息。</font><font style="vertical-align: inherit;">但是，可以通过提供以下配置（</font></font><code>{0}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过Bean Validation消息</font></font><code>{1}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替换</font><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">替换为JSF组件标签）</font><font style="vertical-align: inherit;">，通过应用程序资源包进行配置</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javax.faces.validator.BeanValidator.MESSAGE = {1}：{0}</font></font></pre>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认为：</font></font></p>
</div>
<div class="listingblock">
<div class="content">
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javax.faces.validator.BeanValidator.MESSAGE = {0}</font></font></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="section-integration-with-cdi"><a class="anchor" href="#section-integration-with-cdi"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3。</font><font style="vertical-align: inherit;">CDI</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从版本1.1开始，Bean Validation与CDI（用于Java </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TM</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> EE的</font><font style="vertical-align: inherit;">上下文和依赖注入）集成在一起</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此集成为</font><font style="vertical-align: inherit;">约束验证器以及自定义消息插值器，可遍历解析器，约束验证器工厂，参数名称提供程序，时钟提供程序和值提取程序</font><font style="vertical-align: inherit;">提供CDI托管bean </font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并启用依赖项注入。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，CDI托管bean的方法和构造函数的参数和返回值约束将在调用时自动验证。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当您的应用程序在Java EE容器上运行时，默认情况下会启用此集成。</font><font style="vertical-align: inherit;">在Servlet容器或纯Java SE环境中使用CDI时，可以使用Hibernate Validator提供的CDI可移植扩展。</font><font style="vertical-align: inherit;">为此，请将可移植扩展添加到类路径，如</font></font><a href="#section-getting-started-cdi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1.1.2节“CDI”中所述</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect3">
<h4 id="_dependency_injection"><a class="anchor" href="#_dependency_injection"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3.1。</font><font style="vertical-align: inherit;">依赖注入</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDI的依赖注入机制使得检索</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
实例</font><font style="vertical-align: inherit;">非常容易，</font><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">在托管bean中使用它们。</font><font style="vertical-align: inherit;">只需注释bean的实例字段，
 </font></font><code>@javax.inject.Inject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font></font><a href="#example-dependency-injection"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.3“检索验证器工厂和验证器</font></font><code>@Inject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-dependency-injection" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.3：通过检索验证器工厂和验证器 </font></font><code>@Inject</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter11</span><span class="pun">.</span><span class="pln">cdi</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@ApplicationScoped</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Inject</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Inject</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Validator</span><span class="pln"> validator</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入的bean是默认的验证器工厂和验证器实例。</font><font style="vertical-align: inherit;">为了配置它们 - 例如使用自定义消息插补器 - 您可以使用</font></font><a href="#chapter-xml-configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8章“ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过XML配置”中</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">讨论的Bean Validation XML描述符</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您正在使用多个Bean Validation提供程序，则可以通过</font><a href="#example-dependency-injection-using-hv"><font style="vertical-align: inherit;">使用示例11.4“使用</font></a><a href="#example-dependency-injection-using-hv"><font style="vertical-align: inherit;">限定符注释”中</font></a></font><code>@HibernateValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">限定符</font><font style="vertical-align: inherit;">对注入点进行注释来确保注入来自Hibernate Validator的工厂和验证程序
 </font><font style="vertical-align: inherit;">。</font></font><a href="#example-dependency-injection-using-hv"><font style="vertical-align: inherit;"></font><code>@HibernateValidator</code><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
<div id="example-dependency-injection-using-hv" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.4：使用</font></font><code>@HibernateValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限定符注释</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter11</span><span class="pun">.</span><span class="pln">cdi</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">qualifier</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@ApplicationScoped</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Inject</span><span class="pln">
    </span><span class="lit">@HibernateValidator</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Inject</span><span class="pln">
    </span><span class="lit">@HibernateValidator</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Validator</span><span class="pln"> validator</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限定符注释的完全限定名称是
 </font></font><code>org.hibernate.validator.cdi.HibernateValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">使用bootstrapping API时，</font><font style="vertical-align: inherit;">请确保不要导入
 </font></font><code>org.hibernate.validator.HibernateValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是</font></font><code>ValidationProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于选择Hibernate Validator </font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">实现（请参见
 </font></font><a href="#section-retrieving-validator-factory-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.1节“检索</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code>@Inject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您还可以将依赖项注入约束验证器和其他Bean Validation对象（如</font></font><code>MessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现等）。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#example-constraint-validator-injected-bean"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.5“带注入bean的约束验证器”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
演示了如何在</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现中</font><font style="vertical-align: inherit;">使用注入的CDI bean </font><font style="vertical-align: inherit;">来确定给定的约束是否有效。</font><font style="vertical-align: inherit;">如示例所示，您还可以使用
 </font></font><code>@PostConstruct</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>@PreDestroy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回调来实现任何所需的构造和销毁逻辑。</font></font></p>
</div>
<div id="example-constraint-validator-injected-bean" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.5：带注入bean的约束验证器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter11</span><span class="pun">.</span><span class="pln">cdi</span><span class="pun">.</span><span class="pln">injection</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ValidLicensePlateValidator</span><span class="pln">
        </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;</span><span class="typ">ValidLicensePlate</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Inject</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">VehicleRegistry</span><span class="pln"> vehicleRegistry</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@PostConstruct</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> postConstruct</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//do initialization logic...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@PreDestroy</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> preDestroy</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//do destruction logic...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">ValidLicensePlate</span><span class="pln"> constraintAnnotation</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> licensePlate</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> constraintContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> vehicleRegistry</span><span class="pun">.</span><span class="pln">isValidLicensePlate</span><span class="pun">(</span><span class="pln"> licensePlate </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_method_validation"><a class="anchor" href="#_method_validation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3.2。</font><font style="vertical-align: inherit;">方法验证</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CDI的方法拦截功能允许与Bean Validation的方法验证功能进行非常紧密的集成。</font><font style="vertical-align: inherit;">只需将约束注释放入参数并返回CDI bean可执行文件的值，它们将在调用方法或构造函数之前（参数约束）和之后（返回值约束）自动验证。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，不需要显式的拦截器绑定，而是使用受约束的方法和构造函数自动为所有托管bean注册所需的方法验证拦截器。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拦截器</font></font><code>org.hibernate.validator.cdi.internal.interceptor.ValidationInterceptor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由注册</font></font><code>org.hibernate.validator.cdi.internal.ValidationExtension</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这在Java EE运行时环境中隐式发生，或通过添加</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hibernate-validator-cdi</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
工件</font><font style="vertical-align: inherit;">显式发生</font><font style="vertical-align: inherit;">- 请参见</font></font><a href="#section-getting-started-cdi"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1.1.2节“CDI”</font></font></a></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以在</font></font><a href="#example-cdi-method-validation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.6“具有方法级约束的CDI托管bean”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看到一个示例</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-cdi-method-validation" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.6：具有方法级约束的CDI托管bean</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter11</span><span class="pun">.</span><span class="pln">cdi</span><span class="pun">.</span><span class="pln">methodvalidation</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@ApplicationScoped</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Valid</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Valid</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> rentCar</span><span class="pun">(</span><span class="pln">
            </span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">Customer</span><span class="pln"> customer</span><span class="pun">,</span><span class="pln">
            </span><span class="lit">@NotNull</span><span class="pln"> </span><span class="lit">@Future</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> startDate</span><span class="pun">,</span><span class="pln">
            </span><span class="lit">@Min</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> durationInDays</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> getAvailableCars</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter11</span><span class="pun">.</span><span class="pln">cdi</span><span class="pun">.</span><span class="pln">methodvalidation</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@RequestScoped</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentCarRequest</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Inject</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pln"> rentalStation</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> rentCar</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> customerId</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> startDate</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> duration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//causes ConstraintViolationException</span><span class="pln">
        rentalStation</span><span class="pun">.</span><span class="pln">rentCar</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里</font></font><code>RentalStation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bean承载了几个方法约束。</font><font style="vertical-align: inherit;">当</font></font><code>RentalStation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从另一个bean </font><font style="vertical-align: inherit;">调用其中一个</font></font><code>RentCarRequest</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法时，会自动验证调用方法的约束。</font><font style="vertical-align: inherit;">如果在示例中传递了任何非法参数值</font></font><code>ConstraintViolationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则方法拦截器将抛出</font><font style="vertical-align: inherit;">a
 </font><font style="vertical-align: inherit;">，提供有关违反约束的详细信息。</font><font style="vertical-align: inherit;">如果方法的返回值违反任何返回值约束，则情况相同。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似地，构造函数约束在调用时自动验证。</font><font style="vertical-align: inherit;">在该示例中，</font></font><code>RentalStation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数返回</font><font style="vertical-align: inherit;">的
 </font><font style="vertical-align: inherit;">对象将被验证，因为构造函数返回值已标记为</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="sect4">
<h5 id="_validated_executable_types"><a class="anchor" href="#_validated_executable_types"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3.2.1。</font><font style="vertical-align: inherit;">验证的可执行类型</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation允许对自动验证的可执行类型进行细粒度控制。</font><font style="vertical-align: inherit;">默认情况下，验证构造函数和非getter方法的约束。</font><font style="vertical-align: inherit;">因此，</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在法约束</font></font><code>RentalStation#getAvailableCars()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
 </font></font><a href="#example-cdi-method-validation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例子11.6，“CDI管理与方法层面约束豆”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法被调用时没有得到验证。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用以下选项来配置在调用时验证哪些类型的可执行文件：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过XML描述符</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局配置可执行类型</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">有关示例</font></font><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;">第8.1节“在</font></a><a href="#section-configuration-validation-xml"><em><font style="vertical-align: inherit;">validation.xml中</font></em></a><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;">配置验证器工厂</font></a><a href="#section-configuration-validation-xml"><font style="vertical-align: inherit;">”</font></a></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"></font><code>@ValidateOnExecution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在可执行文件或类型级别上</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">注释</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果为给定的可执行文件指定了多个配置源，则可</font></font><code>@ValidateOnExecution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行级别优先</font></font><code>@ValidateOnExecution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于类型级别，并且
 </font></font><code>@ValidateOnExecution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常优先于</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的全局配置类型</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#example-using-validateonexecution"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.7“使用</font></font><code>@ValidateOnExecution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何使用</font></font><code>@ValidateOnExecution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释：</font></font></p>
</div>
<div id="example-using-validateonexecution" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.7：使用 </font></font><code>@ValidateOnExecution</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter11</span><span class="pun">.</span><span class="pln">cdi</span><span class="pun">.</span><span class="pln">methodvalidation</span><span class="pun">.</span><span class="pln">configuration</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@ApplicationScoped</span><span class="pln">
</span><span class="lit">@ValidateOnExecution</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ExecutableType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Valid</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Valid</span><span class="pln">
    </span><span class="lit">@ValidateOnExecution</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ExecutableType</span><span class="pun">.</span><span class="pln">NONE</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> rentCar</span><span class="pun">(</span><span class="pln">
            </span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">Customer</span><span class="pln"> customer</span><span class="pun">,</span><span class="pln">
            </span><span class="lit">@NotNull</span><span class="pln"> </span><span class="lit">@Future</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> startDate</span><span class="pun">,</span><span class="pln">
            </span><span class="lit">@Min</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> durationInDays</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> getAvailableCars</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里的方法</font></font><code>rentCar()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会在调用时验证，因为它带有注释
 </font></font><code>@ValidateOnExecution(type = ExecutableType.NONE)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">相反，</font></font><code>getAvailableCars()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于</font></font><code>@ValidateOnExecution(type =
ExecutableType.ALL)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在类型级别上给出</font><font style="vertical-align: inherit;">，构造函数和方法</font><font style="vertical-align: inherit;">将被验证</font><font style="vertical-align: inherit;">。</font></font><code>ExecutableType.ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个更紧凑的形式，用于显式指定所有类型</font></font><code>CONSTRUCTORS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>GETTER_METHODS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>NON_GETTER_METHODS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过</font></font><code>&lt;executable-validation enabled="false"/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定来全局关闭可执行
 </font><em><font style="vertical-align: inherit;">验证</font></em><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，</font></font><code>@ValidateOnExecution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将忽略</font><font style="vertical-align: inherit;">所有
 </font><font style="vertical-align: inherit;">注释。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，当方法覆盖或实现超类型方法时，将从该重写或实现的方法获取配置（通过</font></font><code>@ValidateOnExecution</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法本身或超类型给出）。</font><font style="vertical-align: inherit;">这保护超类型方法的客户端免于意外更改配置，例如禁用子类型中被覆盖的可执行文件的验证。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果CDI托管bean覆盖或实现超类型方法并且此超类型方法托管任何约束，则可能发生验证拦截器未正确注册bean，导致bean的方法未在调用时进行验证。</font><font style="vertical-align: inherit;">在这种情况下，您可以</font></font><code>IMPLICIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在子类上</font><font style="vertical-align: inherit;">指定可执行类型</font><font style="vertical-align: inherit;">，如
 </font></font><a href="#example-using-executabletype-implicit"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.8“使用</font></font><code>ExecutableType.IMPLICIT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这可确保在</font></font><code>ExpressRentalStation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">方法时发现所有必需的元数据并启动验证拦截器</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-executabletype-implicit" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.8：使用 </font></font><code>ExecutableType.IMPLICIT</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter11</span><span class="pun">.</span><span class="pln">cdi</span><span class="pun">.</span><span class="pln">methodvalidation</span><span class="pun">.</span><span class="kwd">implicit</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@ValidateOnExecution</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ExecutableType</span><span class="pun">.</span><span class="pln">ALL</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="lit">@Valid</span><span class="pln">
    </span><span class="typ">Car</span><span class="pln"> rentCar</span><span class="pun">(</span><span class="pln">
            </span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">Customer</span><span class="pln"> customer</span><span class="pun">,</span><span class="pln">
            </span><span class="lit">@NotNull</span><span class="pln"> </span><span class="lit">@Future</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> startDate</span><span class="pun">,</span><span class="pln">
            </span><span class="lit">@Min</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> durationInDays</span><span class="pun">);</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> getAvailableCars</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter11</span><span class="pun">.</span><span class="pln">cdi</span><span class="pun">.</span><span class="pln">methodvalidation</span><span class="pun">.</span><span class="kwd">implicit</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@ApplicationScoped</span><span class="pln">
</span><span class="lit">@ValidateOnExecution</span><span class="pun">(</span><span class="pln">type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ExecutableType</span><span class="pun">.</span><span class="pln">IMPLICIT</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ExpressRentalStation</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">RentalStation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> rentCar</span><span class="pun">(</span><span class="typ">Customer</span><span class="pln"> customer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> startDate</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@Min</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> durationInDays</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> getAvailableCars</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//...</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_ee"><a class="anchor" href="#_java_ee"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.4。</font><font style="vertical-align: inherit;">Java EE</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当您的应用程序在诸如</font></font><a href="http://wildfly.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WildFly之</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的Java EE应用程序服务器上运行时</font><font style="vertical-align: inherit;">，您还可以</font><font style="vertical-align: inherit;">通过</font><font style="vertical-align: inherit;">在EJB等托管对象中注入</font><font style="vertical-align: inherit;">来获取</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font></font><code>@Resource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如</font></font><a href="#example-validator-resource-injection"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.9“检索</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code>@Resource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-validator-resource-injection" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11.9：检索</font></font><code>Validator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>ValidatorFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><code>@Resource</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注射</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter11</span><span class="pun">.</span><span class="pln">javaee</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RentalStationBean</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Resource</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">ValidatorFactory</span><span class="pln"> validatorFactory</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@Resource</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Validator</span><span class="pln"> validator</span><span class="pun">;</span><span class="pln">

    </span><span class="com">//...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，您可以分别从名称“ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">java：comp / Validator</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”和“ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">java：comp / ValidatorFactory</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><font style="vertical-align: inherit;">获取JNDI的验证器和验证器工厂</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与基于CDI的注入过程类似</font></font><code>@Inject</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这些对象表示默认验证器和验证器工厂，因此可以使用XML描述符</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行配置</font><font style="vertical-align: inherit;">（请参阅
 </font></font><a href="#chapter-xml-configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过XML配置</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当您的应用程序启用CDI时，注入的对象也可以识别CDI，例如，在约束验证器中支持依赖注入。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="_javafx"><a class="anchor" href="#_javafx"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.5。</font><font style="vertical-align: inherit;">JavaFX的</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator还支持JavaFX属性的解包。</font><font style="vertical-align: inherit;">如果类路径中存在</font></font><code>ValueExtractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaFX，则会自动注册用于JavaFX属性的s。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">示例和进一步的讨论</font></font><a href="#section-valueextraction-javafx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font><a href="#section-valueextraction-javafx"><font style="vertical-align: inherit;">第7.4节“JavaFX值提取器”</font></a><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validator-specifics"><a class="anchor" href="#validator-specifics"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12. Hibernate Validator细节</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本章中，您将学习如何使用Hibernate Validator提供的几个功能以及Bean Validation规范定义的功能。</font><font style="vertical-align: inherit;">这包括失败快速模式，编程约束配置的API和约束的布尔组合。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>org.hibernate.validator.Incubating</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只要正在开发中，</font><font style="vertical-align: inherit;">新API或SPI就会使用</font><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">进行标记</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着在后续版本中可能会不兼容地更改或删除此类元素（例如包，类型，方法，常量等）。</font><font style="vertical-align: inherit;">我们鼓励使用孵化API / SPI成员（因此开发团队可以获得有关这些新功能的反馈），但是您应该准备好在升级到新版本的Hibernate Validator时根据需要更新使用它们的代码。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下各节中描述的功能可能会导致应用程序代码无法在Bean Validation提供程序之间移植。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="_public_api"><a class="anchor" href="#_public_api"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.1。</font><font style="vertical-align: inherit;">公共API</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，让我们先看一下Hibernate Validator的公共API。</font><font style="vertical-align: inherit;">您可以在下面找到属于此API的所有软件包及其用途的列表。</font><font style="vertical-align: inherit;">请注意，当包是公共API的一部分时，对于其子包不一定如此。</font></font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.hibernate.validator</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation引导机制使用的类（例如，验证提供程序，配置类）; </font><font style="vertical-align: inherit;">有关更多详细信息，请参阅</font></font><a href="#chapter-bootstrapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bootstrapping</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><code>org.hibernate.validator.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>org.hibernate.validator.cfg.context</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>org.hibernate.validator.cfg.defs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>org.hibernate.validator.spi.cfg</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator用于约束声明的流畅API; </font><font style="vertical-align: inherit;">在</font></font><code>org.hibernate.validator.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你会发现</font></font><code>ConstraintMapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">界面中，</font></font><code>org.hibernate.validator.cfg.defs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有的约束定义和</font></font><code>org.hibernate.validator.spi.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用API来配置默认验证工厂的回调。</font><font style="vertical-align: inherit;">有关详细信息，请参见</font></font><a href="#section-programmatic-api"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.4节“编程约束定义和声明”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><code>org.hibernate.validator.constraints</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>org.hibernate.validator.constraints.br</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>org.hibernate.validator.constraints.pl</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了Bean Validation规范定义的内置约束之外，Hibernate Validator提供了一些有用的自定义约束; </font></font><a href="#validator-defineconstraints-hv-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2.3.2节“附加约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中详细描述了</font><a href="#validator-defineconstraints-hv-constraints"><font style="vertical-align: inherit;">约束</font></a><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><code>org.hibernate.validator.constraintvalidation</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展约束验证器上下文，允许为消息插值设置自定义属性。</font></font><a href="#section-hibernateconstraintvalidatorcontext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.11.1节“ </font></font><code>HibernateConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述了如何使用该功能。</font></font></p>
</dd>
<dt class="hdlist1"><code>org.hibernate.validator.group</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">， </font></font><code>org.hibernate.validator.spi.group</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组序列提供程序功能，允许您根据验证的对象状态定义动态默认组序列; </font><font style="vertical-align: inherit;">有关详细信息，请参见</font></font><a href="#section-default-group-class"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.4节“重新定义默认组序列”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><code>org.hibernate.validator.messageinterpolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>org.hibernate.validator.resourceloading</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code>org.hibernate.validator.spi.resourceloading</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与约束消息插值相关的类; </font><font style="vertical-align: inherit;">第一个包包含Hibernate Validator的默认消息插值器</font></font><code>ResourceBundleMessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">后两个软件包提供了</font></font><code>ResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于加载资源包</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">SPI（参见</font></font><a href="#section-resource-bundle-locator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.1节“ </font></font><code>ResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）及其默认实现。</font></font></p>
</dd>
<dt class="hdlist1"><code>org.hibernate.validator.parameternameprovider</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A </font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于Paranamer库，请参见</font></font><a href="#section-paranamer-parameternameprovider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.12节“基于Paranamer </font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><code>org.hibernate.validator.propertypath</code></dt>
<dd>
<p><font style="vertical-align: inherit;"></font><code>javax.validation.Path</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API的</font><font style="vertical-align: inherit;">扩展</font><font style="vertical-align: inherit;">，请参见</font></font><a href="#section-extensions-path-api"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.7节“路径API的扩展”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><code>org.hibernate.validator.spi.constraintdefinition</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于以编程方式注册其他约束验证器的SPI，请参见</font></font><a href="#section-constraint-definition-contribution"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.13节“提供约束定义”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator的公共包分为两类：虽然实际的API部分旨在</font><font style="vertical-align: inherit;">被客户端</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（例如用于编程约束声明的API或自定义约束），但SPI（服务提供者接口）包中包含的接口旨在</font><font style="vertical-align: inherit;">由客户</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（例如</font></font><code>ResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该表中未列出的任何软件包都是Hibernate Validator的内部软件包，不应由客户端访问。</font><font style="vertical-align: inherit;">这些内部包的内容可以在不经通知的情况下从发行版更改为发行版，因此可能会破坏依赖它的任何客户端代码。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="section-fail-fast"><a class="anchor" href="#section-fail-fast"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.2。</font><font style="vertical-align: inherit;">失败快速模式</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用失败快速模式，Hibernate Validator允许在第一次发生约束违规时立即从当前验证返回。</font><font style="vertical-align: inherit;">这对于大型对象图的验证非常有用，您只需要快速检查是否存在任何约束违规。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#example-using-fail-fast"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.1“使用故障快速验证模式”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何引导和使用启用故障的快速验证器。</font></font></p>
</div>
<div id="example-using-fail-fast" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.1：使用故障快速验证模式</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter12</span><span class="pun">.</span><span class="pln">failfast</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@NotNull</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">

    </span><span class="lit">@AssertTrue</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isRegistered</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> manufacturer</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isRegistered</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">manufacturer </span><span class="pun">=</span><span class="pln"> manufacturer</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">isRegistered </span><span class="pun">=</span><span class="pln"> isRegistered</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">//getters and setters...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">failFast</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里验证的对象实际上不能满足在</font></font><code>Car</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">上声明的约束</font><font style="vertical-align: inherit;">，但验证调用只产生一个，</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为启用了失败快速模式。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法保证约束的评估顺序，即返回的违规是源自</font><font style="vertical-align: inherit;">约束</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还是</font></font><code>@AssertTrue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">不确定</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果需要，可以使用</font></font><a href="#section-defining-group-sequences"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5.3节“定义组序列”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述的组序列强制执行确定性评估顺序
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关在引导验证器时启用故障快速模式的不同方法，</font><font style="vertical-align: inherit;">请参见</font></font><a href="#section-provider-specific-settings"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第9.2.8节“特定</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">于</font><a href="#section-provider-specific-settings"><font style="vertical-align: inherit;">提供程序的设置”</font></a><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="section-method-validation-prerequisite-relaxation"><a class="anchor" href="#section-method-validation-prerequisite-relaxation"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.3。</font><font style="vertical-align: inherit;">放宽类层次结构中方法验证的要求</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation规范定义了一组前提条件，这些前提条件在为类层次结构中的方法定义约束时适用。</font><font style="vertical-align: inherit;">这些前提条件</font><font style="vertical-align: inherit;">
在Bean Validation 2.0规范的</font></font><a href="http://beanvalidation.org/2.0/spec/#constraintdeclarationvalidationprocess-methodlevelconstraints-inheritance"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.6.5节</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中定义
 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">另请参见</font><font style="vertical-align: inherit;">
本指南中的</font></font><a href="#section-method-constraints-inheritance-hierarchies"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第3.1.4节“继承层次结构中的方法约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据规范，允许Bean Validation提供程序放宽这些前提条件。</font><font style="vertical-align: inherit;">使用Hibernate Validator，您可以通过以下两种方式之一完成此操作。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，您可以</font><font style="vertical-align: inherit;">在</font><em><font style="vertical-align: inherit;">validation.xml中</font></em><font style="vertical-align: inherit;">使用配置属性</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hibernate.validator.allow_parameter_constraint_override</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hibernate.validator.allow_multiple_cascaded_validation_on_result</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hibernate.validator.allow_parallel_method_parameter_constraint</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请参见示例
 </font><a href="#example-relaxing-method-validation-xml"><font style="vertical-align: inherit;">示例12.2“通过属性在类层次结构中配置方法验证行为”</font></a><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="#example-relaxing-method-validation-xml"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
<div id="example-relaxing-method-validation-xml" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.2：通过属性在类层次结构中配置方法验证行为</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;validation-config</span><span class="pln">
        </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/configuration"</span><span class="pln">
        </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
        </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://xmlns.jcp.org/xml/ns/validation/configuration validation-configuration-2.0.xsd"</span><span class="pln">
        </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"2.0"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;default-provider&gt;</span><span class="pln">org.hibernate.validator.HibernateValidator</span><span class="tag">&lt;/default-provider&gt;</span><span class="pln">

    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.validator.allow_parameter_constraint_override"</span><span class="tag">&gt;</span><span class="pln">true</span><span class="tag">&lt;/property&gt;</span><span class="pln">
    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.validator.allow_multiple_cascaded_validation_on_result"</span><span class="tag">&gt;</span><span class="pln">true</span><span class="tag">&lt;/property&gt;</span><span class="pln">
    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"hibernate.validator.allow_parallel_method_parameter_constraint"</span><span class="tag">&gt;</span><span class="pln">true</span><span class="tag">&lt;/property&gt;</span><span class="pln">
</span><span class="tag">&lt;/validation-config&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，可以在编程引导期间应用这些设置。</font></font></p>
</div>
<div id="example-relaxing-method-validation" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.3：在类层次结构中配置方法验证行为</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">HibernateValidatorConfiguration</span><span class="pln"> configuration </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">configure</span><span class="pun">();</span><span class="pln">

configuration</span><span class="pun">.</span><span class="pln">allowMultipleCascadedValidationOnReturnValues</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">allowOverridingMethodAlterParameterConstraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">allowParallelMethodsDefineParameterConstraints</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，所有这些属性都是false，实现Bean Validation规范中定义的默认行为。</font></font></p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改方法验证的默认行为将导致符合规范且不可移植的应用程序。</font><font style="vertical-align: inherit;">确保了解您正在做什么，并且您的用例确实需要更改默认行为。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="section-programmatic-api"><a class="anchor" href="#section-programmatic-api"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.4。</font><font style="vertical-align: inherit;">程序化约束定义和声明</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据Bean Validation规范，您可以使用Java注释和基于XML的约束映射来定义和声明约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，Hibernate Validator提供了一个流畅的API，允许编程配置约束。</font><font style="vertical-align: inherit;">用例包括在运行时动态添加约束，具体取决于某些应用程序状态或测试，您需要在不同场景中具有不同约束的实体，但不希望为每个测试用例实现实际的Java类。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，通过流畅API添加的约束可添加到通过标准配置功能配置的约束。</font><font style="vertical-align: inherit;">但是也可以在需要时忽略注释和XML配置的约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API以</font></font><code>ConstraintMapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口</font><font style="vertical-align: inherit;">为中心</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您将获得一个新映射</font></font><code>HibernateValidatorConfiguration#createConstraintMapping()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后您可以</font><font style="vertical-align: inherit;">通过</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">映射
 </font><font style="vertical-align: inherit;">以流畅的方式进行配置，如</font></font><a href="#example-constraint-mapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.4“编程约束声明”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-constraint-mapping" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.4：程序化约束声明</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">HibernateValidatorConfiguration</span><span class="pln"> configuration </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">();</span><span class="pln">

</span><span class="typ">ConstraintMapping</span><span class="pln"> constraintMapping </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">createConstraintMapping</span><span class="pun">();</span><span class="pln">

constraintMapping
    </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"manufacturer"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"licensePlate"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">ignoreAnnotations</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SizeDef</span><span class="pun">().</span><span class="pln">min</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">).</span><span class="pln">max</span><span class="pun">(</span><span class="pln"> </span><span class="lit">14</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"rentalStation"</span><span class="pun">,</span><span class="pln"> METHOD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">addMapping</span><span class="pun">(</span><span class="pln"> constraintMapping </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用方法链在多个类和属性上配置约束。</font><font style="vertical-align: inherit;">约束定义类</font></font><code>NotNullDef</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和SizeDef是辅助类，它们允许以类型安全的方式配置约束参数。</font></font><code>org.hibernate.validator.cfg.defs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包</font><font style="vertical-align: inherit;">中的所有内置约束都存在定义类</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过调用</font></font><code>ignoreAnnotations()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过注释或XML配置的任何约束，将忽略给定元素。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个元素（类型，属性，方法等）只能在用于设置一个验证器工厂的所有约束映射中配置一次。</font><font style="vertical-align: inherit;">否则a </font></font><code>ValidationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被提出。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持通过配置子类型向未重写的超类型属性和方法添加约束。</font><font style="vertical-align: inherit;">相反，您需要在这种情况下配置超类型。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置映射后，必须将其添加回配置对象，然后可以从中获取验证器工厂。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于自定义约束，您可以创建自己的扩展定义类，</font></font><code>ConstraintDef</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以使用</font></font><code>GenericConstraintDef</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如</font></font><a href="#example-generic-constraint-mapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.5“自定义约束的编程声明”中所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-generic-constraint-mapping" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.5：自定义约束的编程声明</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ConstraintMapping</span><span class="pln"> constraintMapping </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">createConstraintMapping</span><span class="pun">();</span><span class="pln">

constraintMapping
    </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"licensePlate"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GenericConstraintDef</span><span class="pun">&lt;&gt;(</span><span class="pln"> </span><span class="typ">CheckCase</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">param</span><span class="pun">(</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CaseMode</span><span class="pun">.</span><span class="pln">UPPER </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序化API支持容器元素约束</font></font><code>containerElementType()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#example-nested-container-element-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.6“嵌套容器元素约束的编程声明”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了在嵌套容器元素上声明约束的示例。</font></font></p>
</div>
<div id="example-nested-container-element-constraints" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.6：嵌套容器元素约束的编程声明</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ConstraintMapping</span><span class="pln"> constraintMapping </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">createConstraintMapping</span><span class="pun">();</span><span class="pln">

constraintMapping
    </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"manufacturer"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"licensePlate"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">ignoreAnnotations</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SizeDef</span><span class="pun">().</span><span class="pln">min</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">).</span><span class="pln">max</span><span class="pun">(</span><span class="pln"> </span><span class="lit">14</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"partManufacturers"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">containerElementType</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">containerElementType</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"rentalStation"</span><span class="pun">,</span><span class="pln"> METHOD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图所示，传递给的参数</font></font><code>containerElementType()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是用于获取所需嵌套容器元素类型的类型参数索引的路径。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过调用，</font></font><code>valid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以标记成员进行级联验证，这相当于使用它进行注释</font></font><code>@Valid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用</font></font><code>convertGroup()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法（相当于</font></font><code>@ConvertGroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">配置在级联验证期间应用的任何组转换
 </font><font style="vertical-align: inherit;">。</font></font><a href="#example-cascading-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例12.7“标记属性以进行级联验证”中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以看到一个示例
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-cascading-constraints" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.7：标记属性以进行级联验证</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ConstraintMapping</span><span class="pln"> constraintMapping </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">createConstraintMapping</span><span class="pun">();</span><span class="pln">

constraintMapping
    </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"driver"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">valid</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">convertGroup</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Default</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">to</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PersonDefault</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"partManufacturers"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">containerElementType</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">valid</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">containerElementType</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">valid</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">().</span><span class="pln">groups</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PersonDefault</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您不仅可以使用fluent API配置bean约束，还可以使用方法和构造函数约束来配置bean约束。</font><font style="vertical-align: inherit;">如</font></font><a href="#example-method-constraint-mapping"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.8</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示</font><a href="#example-method-constraint-mapping"><font style="vertical-align: inherit;">，“方法和构造函数约束的编程声明”</font></a><font style="vertical-align: inherit;">构造函数由其参数类型和方法按名称和参数类型标识。</font><font style="vertical-align: inherit;">选择了方法或构造函数后，您可以标记其参数和/或返回值以进行级联验证，并添加约束和交叉参数约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如示例所示，</font></font><code>valid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以在容器元素类型上调用。</font></font></p>
</div>
<div id="example-method-constraint-mapping" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.8：方法和构造函数约束的编程声明</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ConstraintMapping</span><span class="pln"> constraintMapping </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">createConstraintMapping</span><span class="pun">();</span><span class="pln">

constraintMapping
    </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">constructor</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">parameter</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SizeDef</span><span class="pun">().</span><span class="pln">min</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">).</span><span class="pln">max</span><span class="pun">(</span><span class="pln"> </span><span class="lit">50</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">returnValue</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">valid</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">method</span><span class="pun">(</span><span class="pln"> </span><span class="str">"drive"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">parameter</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MaxDef</span><span class="pun">().</span><span class="pln">value</span><span class="pun">(</span><span class="pln"> </span><span class="lit">75</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">method</span><span class="pun">(</span><span class="pln"> </span><span class="str">"load"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">crossParameter</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GenericConstraintDef</span><span class="pun">&lt;&gt;(</span><span class="pln">
                        </span><span class="typ">LuggageCountMatchesPassengerCount</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">param</span><span class="pun">(</span><span class="pln">
                            </span><span class="str">"piecesOfLuggagePerPassenger"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
                        </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">method</span><span class="pun">(</span><span class="pln"> </span><span class="str">"getDriver"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">returnValue</span><span class="pun">()</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="pln">valid</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后但并非最不重要的是，您可以配置默认组序列或类型的默认组序列提供程序，如以下示例所示。</font></font></p>
</div>
<div id="example-sequences" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.9：配置默认组序列和默认组序列提供程序</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ConstraintMapping</span><span class="pln"> constraintMapping </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">createConstraintMapping</span><span class="pun">();</span><span class="pln">

constraintMapping
    </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">defaultGroupSequence</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> </span><span class="typ">CarChecks</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">RentalCar</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">defaultGroupSequenceProviderClass</span><span class="pun">(</span><span class="pln"> </span><span class="typ">RentalCarGroupSequenceProvider</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-programmatic-api-contributor"><a class="anchor" href="#section-programmatic-api-contributor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.5。</font><font style="vertical-align: inherit;">将编程约束声明应用于默认验证器工厂</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您不是手动引导验证器工厂，而是使用通过</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置的默认工厂</font><font style="vertical-align: inherit;">
（请参阅</font></font><a href="#chapter-xml-configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8章，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过XML配置</font></font></em></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），则可以通过创建一个或多个约束映射来添加一个或多个约束映射贡献者。</font><font style="vertical-align: inherit;">为此，执行</font></font><code>ConstraintMappingContributor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合同：</font></font></p>
</div>
<div id="example-constraint-mapping-contributor" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.10：自定义</font></font><code>ConstraintMappingContributor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter12</span><span class="pun">.</span><span class="pln">constraintapi</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyConstraintMappingContributor</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintMappingContributor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> createConstraintMappings</span><span class="pun">(</span><span class="typ">ConstraintMappingBuilder</span><span class="pln"> builder</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        builder</span><span class="pun">.</span><span class="pln">addConstraintMapping</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Marathon</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> METHOD </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NotNullDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"numberOfHelpers"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MinDef</span><span class="pun">().</span><span class="pln">value</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        builder</span><span class="pun">.</span><span class="pln">addConstraintMapping</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">type</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Runner</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="kwd">property</span><span class="pun">(</span><span class="pln"> </span><span class="str">"paidEntryFee"</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">constraint</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AssertTrueDef</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，您需要</font><font style="vertical-align: inherit;">使用属性键</font><font style="vertical-align: inherit;">在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定贡献者实现的完全限定类名</font></font><code>hibernate.validator.constraint_mapping_contributors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以通过用逗号分隔几个贡献者来指定它们。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="section-advanced-constraint-composition"><a class="anchor" href="#section-advanced-constraint-composition"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.6。</font><font style="vertical-align: inherit;">高级约束组合功能</font></font></h3>
<div class="sect3">
<h4 id="_validation_target_specification_for_purely_composed_constraints"><a class="anchor" href="#_validation_target_specification_for_purely_composed_constraints"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.6.1。</font><font style="vertical-align: inherit;">纯组合约束的验证目标规范</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您在方法声明中指定纯组合约束（即没有验证器本身但仅由其他组合约束构成的约束），则验证引擎无法确定是否将该约束应用为返回值约束或作为交叉参数约束。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator允许通过</font></font><code>@SupportedValidationTarget</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在组合约束类型的声明上</font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">注释</font><font style="vertical-align: inherit;">来解决这种歧义，</font><font style="vertical-align: inherit;">如</font></font><a href="#example-purely-composed-constraint-validation-target"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.11“指定纯组合约束的验证目标”所示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在</font></font><code>@ValidInvoiceAmount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有声明任何验证，但它是完全由组成</font></font><code>@Min</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>@NotNull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
约束。</font><font style="vertical-align: inherit;">在</font></font><code>@SupportedValidationTarget</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保了一个方法声明给定当约束被施加到该方法返回值。</font></font></p>
</div>
<div id="example-purely-composed-constraint-validation-target" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.11：指定纯组合约束的验证目标</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter12</span><span class="pun">.</span><span class="pln">purelycomposed</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@Min</span><span class="pun">(</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@NotNull</span><span class="pln">
</span><span class="lit">@Target</span><span class="pun">({</span><span class="pln"> METHOD</span><span class="pun">,</span><span class="pln"> FIELD</span><span class="pun">,</span><span class="pln"> ANNOTATION_TYPE</span><span class="pun">,</span><span class="pln"> CONSTRUCTOR</span><span class="pun">,</span><span class="pln"> PARAMETER </span><span class="pun">})</span><span class="pln">
</span><span class="lit">@Retention</span><span class="pun">(</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Documented</span><span class="pln">
</span><span class="lit">@Constraint</span><span class="pun">(</span><span class="pln">validatedBy </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{})</span><span class="pln">
</span><span class="lit">@SupportedValidationTarget</span><span class="pun">(</span><span class="typ">ValidationTarget</span><span class="pun">.</span><span class="pln">ANNOTATED_ELEMENT</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@ReportAsSingleViolation</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">ValidInvoiceAmount</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="str">"{org.hibernate.validator.referenceguide.chapter11.purelycomposed."</span><span class="pln">
            </span><span class="pun">+</span><span class="pln"> </span><span class="str">"ValidInvoiceAmount.message}"</span><span class="pun">;</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?&gt;[]</span><span class="pln"> groups</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pun">&gt;[]</span><span class="pln"> payload</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{};</span><span class="pln">

    </span><span class="lit">@OverridesAttribute</span><span class="pun">(</span><span class="pln">constraint </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Min</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">long</span><span class="pln"> value</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="section-boolean-constraint-composition"><a class="anchor" href="#section-boolean-constraint-composition"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.6.2。</font><font style="vertical-align: inherit;">布尔组合的约束</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation指定组合约束的约束（参见
 </font></font><a href="#section-constraint-composition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第6.4节“约束组合”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）都通过逻辑</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组合</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这意味着所有组合约束都需要返回true以获得整体成功验证。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator为此提供了扩展，允许您通过逻辑</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOT</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组合约束
 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为此，您必须使用ConstraintComposition批注和枚举CompositionType及其值</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AND</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OR</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALL_FALSE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><a href="#example-boolean-constraint-composition"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.12“约束的OR组合”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了如何构建组合约束</font></font><code>@PatternOrSize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
，其中只有一个组合约束需要有效才能通过验证。</font><font style="vertical-align: inherit;">验证的字符串都是低级的，或者长度在两到三个字符之间。</font></font></p>
</div>
<div id="example-boolean-constraint-composition" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.12：约束的OR组合</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter12</span><span class="pun">.</span><span class="pln">booleancomposition</span><span class="pun">;</span><span class="pln">

</span><span class="lit">@ConstraintComposition</span><span class="pun">(</span><span class="pln">OR</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Pattern</span><span class="pun">(</span><span class="pln">regexp </span><span class="pun">=</span><span class="pln"> </span><span class="str">"[a-z]"</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Size</span><span class="pun">(</span><span class="pln">min </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> max </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@ReportAsSingleViolation</span><span class="pln">
</span><span class="lit">@Target</span><span class="pun">({</span><span class="pln"> METHOD</span><span class="pun">,</span><span class="pln"> FIELD </span><span class="pun">})</span><span class="pln">
</span><span class="lit">@Retention</span><span class="pun">(</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Constraint</span><span class="pun">(</span><span class="pln">validatedBy </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">PatternOrSize</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="str">"{org.hibernate.validator.referenceguide.chapter11."</span><span class="pln"> </span><span class="pun">+</span><span class="pln">
            </span><span class="str">"booleancomposition.PatternOrSize.message}"</span><span class="pun">;</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?&gt;[]</span><span class="pln"> groups</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">

    </span><span class="typ">Class</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Payload</span><span class="pun">&gt;[]</span><span class="pln"> payload</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">};</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALL_FALSE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为组合类型隐式强制在约束组合的验证失败的情况下仅报告单个违例。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-extensions-path-api"><a class="anchor" href="#section-extensions-path-api"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.7。</font><font style="vertical-align: inherit;">Path API的扩展</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator提供了</font></font><code>javax.validation.Path</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API </font><font style="vertical-align: inherit;">的扩展</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于节点</font></font><code>ElementKind.PROPERTY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>ElementKind.CONTAINER_ELEMENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它允许获得表示属性的值。</font><font style="vertical-align: inherit;">为此，请将给定节点缩小到类型</font></font><code>org.hibernate.validator.path.PropertyNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或
 </font></font><code>org.hibernate.validator.path.ContainerElementNode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别使用</font></font><code>Node#as()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如以下示例所示：</font></font></p>
</div>
<div id="example-property-node-get-value" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.13：从属性节点获取值</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Building</span><span class="pln"> building </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Building</span><span class="pun">();</span><span class="pln">

</span><span class="com">// Assume the name of the person violates a @Size constraint</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> bob </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Bob"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Apartment</span><span class="pln"> bobsApartment </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Apartment</span><span class="pun">(</span><span class="pln"> bob </span><span class="pun">);</span><span class="pln">
building</span><span class="pun">.</span><span class="pln">getApartments</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="pln"> bobsApartment </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Building</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> building </span><span class="pun">);</span><span class="pln">

</span><span class="typ">Path</span><span class="pln"> path </span><span class="pun">=</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">().</span><span class="pln">getPropertyPath</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Iterator</span><span class="pun">&lt;</span><span class="typ">Path</span><span class="pun">.</span><span class="typ">Node</span><span class="pun">&gt;</span><span class="pln"> nodeIterator </span><span class="pun">=</span><span class="pln"> path</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">();</span><span class="pln">

</span><span class="typ">Path</span><span class="pun">.</span><span class="typ">Node</span><span class="pln"> node </span><span class="pun">=</span><span class="pln"> nodeIterator</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> node</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">(),</span><span class="pln"> </span><span class="str">"apartments"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertSame</span><span class="pun">(</span><span class="pln"> node</span><span class="pun">.</span><span class="kwd">as</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PropertyNode</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getValue</span><span class="pun">(),</span><span class="pln"> bobsApartment </span><span class="pun">);</span><span class="pln">

node </span><span class="pun">=</span><span class="pln"> nodeIterator</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> node</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">(),</span><span class="pln"> </span><span class="str">"resident"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertSame</span><span class="pun">(</span><span class="pln"> node</span><span class="pun">.</span><span class="kwd">as</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PropertyNode</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getValue</span><span class="pun">(),</span><span class="pln"> bob </span><span class="pun">);</span><span class="pln">

node </span><span class="pun">=</span><span class="pln"> nodeIterator</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> node</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">(),</span><span class="pln"> </span><span class="str">"name"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> node</span><span class="pun">.</span><span class="kwd">as</span><span class="pun">(</span><span class="pln"> </span><span class="typ">PropertyNode</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">).</span><span class="pln">getValue</span><span class="pun">(),</span><span class="pln"> </span><span class="str">"Bob"</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这对于获取</font></font><code>Set</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性路径上的属性</font><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">（例如</font></font><code>apartments</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在示例中）</font><font style="vertical-align: inherit;">也是非常有用的</font><font style="vertical-align: inherit;">，否则无法识别（不同于</font></font><code>Map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在这种情况下没有键和索引）。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="section-dynamic-payload"><a class="anchor" href="#section-dynamic-payload"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.8。</font><font style="vertical-align: inherit;">动态有效载荷作为一部分</font></font><code>ConstraintViolation</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，如果约束违规提供了额外的数据 - 所谓的动态有效载荷，则可以辅助自动处理违规。</font><font style="vertical-align: inherit;">例如，该动态有效载荷可以包含关于如何解决违规的用户提示。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以</font><font style="vertical-align: inherit;">使用</font></font><a href="#validator-customconstraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义约束</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置动态有效负载</font></font><code>HibernateConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这在示例</font></font><a href="#example-constraint-validator-setting-dynamic-payload"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例12.14“ </font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现设置动态有效负载”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">示出，</font><font style="vertical-align: inherit;">其中将
 </font></font><code>javax.validation.ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其解包</font></font><code>HibernateConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便调用
 </font></font><code>withDynamicPayload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-constraint-validator-setting-dynamic-payload" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.14：</font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现设置动态有效负载</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter12</span><span class="pun">.</span><span class="pln">dynamicpayload</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="kwd">internal</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">CollectionHelper</span><span class="pun">.</span><span class="pln">newHashMap</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ValidPassengerCountValidator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;</span><span class="typ">ValidPassengerCount</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> suggestedCars </span><span class="pun">=</span><span class="pln"> newHashMap</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">static</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        suggestedCars</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Chevrolet Corvette"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        suggestedCars</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Toyota Volta"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        suggestedCars</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Maserati GranCabrio"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
        suggestedCars</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="str">" Mercedes-Benz E-Class"</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">ValidPassengerCount</span><span class="pln"> constraintAnnotation</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">Car</span><span class="pln"> car</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> car </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">int</span><span class="pln"> passengerCount </span><span class="pun">=</span><span class="pln"> car</span><span class="pun">.</span><span class="pln">getPassengers</span><span class="pun">().</span><span class="pln">size</span><span class="pun">();</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> car</span><span class="pun">.</span><span class="pln">getSeatCount</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> passengerCount </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> suggestedCars</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="pln"> passengerCount </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="typ">HibernateConstraintValidatorContext</span><span class="pln"> hibernateContext </span><span class="pun">=</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln">
                        </span><span class="typ">HibernateConstraintValidatorContext</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
                </span><span class="pun">);</span><span class="pln">
                hibernateContext</span><span class="pun">.</span><span class="pln">withDynamicPayload</span><span class="pun">(</span><span class="pln"> suggestedCars</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln"> passengerCount </span><span class="pun">)</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在约束违反处理方面，</font></font><code>javax.validation.ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后可以将包装进行展开</font></font><code>HibernateConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便检索动态有效载荷以进行进一步处理。</font></font></p>
</div>
<div id="example-retrieving-dynamic-payload" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.15：检索</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态有效载荷</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Car</span><span class="pln"> car </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">addPassenger</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">addPassenger</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
car</span><span class="pun">.</span><span class="pln">addPassenger</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><span class="typ">Set</span><span class="pun">&lt;</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;&gt;</span><span class="pln"> constraintViolations </span><span class="pun">=</span><span class="pln"> validator</span><span class="pun">.</span><span class="pln">validate</span><span class="pun">(</span><span class="pln"> car </span><span class="pun">);</span><span class="pln">

assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

</span><span class="typ">ConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> constraintViolation </span><span class="pun">=</span><span class="pln"> constraintViolations</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">().</span><span class="kwd">next</span><span class="pun">();</span><span class="pln">
</span><span class="lit">@SuppressWarnings</span><span class="pun">(</span><span class="str">"unchecked"</span><span class="pun">)</span><span class="pln">
</span><span class="typ">HibernateConstraintViolation</span><span class="pun">&lt;</span><span class="typ">Car</span><span class="pun">&gt;</span><span class="pln"> hibernateConstraintViolation </span><span class="pun">=</span><span class="pln"> constraintViolation</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">HibernateConstraintViolation</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">);</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> suggestedCar </span><span class="pun">=</span><span class="pln"> hibernateConstraintViolation</span><span class="pun">.</span><span class="pln">getDynamicPayload</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Toyota Volta"</span><span class="pun">,</span><span class="pln"> suggestedCar </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="non-el-message-interpolator"><a class="anchor" href="#non-el-message-interpolator"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.9。 </font></font><code>ParameterMessageInterpolator</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator默认情况下需要Unified EL的实现（请参见
 </font></font><a href="#validator-gettingstarted-uel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1.1.1节“Unified EL”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">这需要允许使用Bean Validation规范定义的EL表达式插入约束错误消息。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于您不能或不想提供EL实现的环境，Hibernate Validator提供了一个非基于EL的消息插值器 - </font></font><code>org.hibernate.validator.messageinterpolation.ParameterMessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font></font><a href="#section-custom-message-interpolation"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2节“自定义消息插值”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以了解如何插入自定义消息插补器实现。</font></font></p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="警告"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含EL表达式的约束消息将被非插值返回
 </font></font><code>org.hibernate.validator.messageinterpolation.ParameterMessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这也会影响使用EL表达式的内置默认约束消息。</font><font style="vertical-align: inherit;">此刻，</font></font><code>DecimalMin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code>DecimalMax</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受到影响。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_code_resourcebundlelocator_code"><a class="anchor" href="#_code_resourcebundlelocator_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.10。 </font></font><code>ResourceBundleLocator</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>ResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，Hibernate Validator提供了一个额外的SPI，它允许从</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidationMessages</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之外的其他资源包中检索错误消息，</font><font style="vertical-align: inherit;">同时仍然使用规范定义的实际插值算法。</font><font style="vertical-align: inherit;">请参阅
 </font></font><a href="#section-resource-bundle-locator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第4.2.1节“ </font></font><code>ResourceBundleLocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以了解如何使用该SPI。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_contexts"><a class="anchor" href="#_custom_contexts"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.11。</font><font style="vertical-align: inherit;">自定义上下文</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation规范在其API中的几个点提供了将给定接口解包到实现者特定子类型的可能性。</font><font style="vertical-align: inherit;">在约束违反创作的情况中
 </font></font><code>ConstraintValidator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现，以及在消息内插</font></font><code>MessageInterpolator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
的情况下，存在</font></font><code>unwrap()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于所提供的上下文实例方法-
 </font></font><code>ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别</font></font><code>MessageInterpolatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Hibernate Validator为这两个接口提供自定义扩展。</font></font></p>
</div>
<div class="sect3">
<h4 id="section-hibernateconstraintvalidatorcontext"><a class="anchor" href="#section-hibernateconstraintvalidatorcontext"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.11.1。 </font></font><code>HibernateConstraintValidatorContext</code></h4>
<div id="section-custom-constraint-validator-context" class="paragraph">
<p><code>HibernateConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个子类型</font></font><code>ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，允许您：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>HibernateConstraintValidatorContext#addExpressionVariable(String, Object)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或</font><font style="vertical-align: inherit;">通过表达式语言消息插值工具设置用于插值的任意参数</font></font><code>HibernateConstraintValidatorContext#addMessageParameter(String, Object)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div id="example-custom-expression-variable" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例150. </font></font><code>@Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入表达式变量的</font><font style="vertical-align: inherit;">自定义</font><font style="vertical-align: inherit;">验证器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter12</span><span class="pun">.</span><span class="pln">context</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">time</span><span class="pun">.</span><span class="typ">Instant</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">ConstraintValidator</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">ConstraintValidatorContext</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constraints</span><span class="pun">.</span><span class="typ">Future</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">constraintvalidation</span><span class="pun">.</span><span class="typ">HibernateConstraintValidatorContext</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyFutureValidator</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;</span><span class="typ">Future</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Instant</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">Future</span><span class="pln"> constraintAnnotation</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">Instant</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> value </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="typ">HibernateConstraintValidatorContext</span><span class="pln"> hibernateContext </span><span class="pun">=</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln">
                </span><span class="typ">HibernateConstraintValidatorContext</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">

        </span><span class="typ">Instant</span><span class="pln"> now </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Instant</span><span class="pun">.</span><span class="pln">now</span><span class="pun">(</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">getClockProvider</span><span class="pun">().</span><span class="pln">getClock</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln">value</span><span class="pun">.</span><span class="pln">isAfter</span><span class="pun">(</span><span class="pln"> now </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            hibernateContext</span><span class="pun">.</span><span class="pln">disableDefaultConstraintViolation</span><span class="pun">();</span><span class="pln">
            hibernateContext
                    </span><span class="pun">.</span><span class="pln">addExpressionVariable</span><span class="pun">(</span><span class="pln"> </span><span class="str">"now"</span><span class="pun">,</span><span class="pln"> now </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">buildConstraintViolationWithTemplate</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Must be after ${now}"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">addConstraintViolation</span><span class="pun">();</span><span class="pln">

            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div id="example-custom-message-parameter" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例151. </font></font><code>@Future</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入消息参数的</font><font style="vertical-align: inherit;">自定义</font><font style="vertical-align: inherit;">验证器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">referenceguide</span><span class="pun">.</span><span class="pln">chapter12</span><span class="pun">.</span><span class="pln">context</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">time</span><span class="pun">.</span><span class="typ">Instant</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">ConstraintValidator</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="typ">ConstraintValidatorContext</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">validation</span><span class="pun">.</span><span class="pln">constraints</span><span class="pun">.</span><span class="typ">Future</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hibernate</span><span class="pun">.</span><span class="pln">validator</span><span class="pun">.</span><span class="pln">constraintvalidation</span><span class="pun">.</span><span class="typ">HibernateConstraintValidatorContext</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyFutureValidatorMessageParameter</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ConstraintValidator</span><span class="pun">&lt;</span><span class="typ">Future</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Instant</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initialize</span><span class="pun">(</span><span class="typ">Future</span><span class="pln"> constraintAnnotation</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> isValid</span><span class="pun">(</span><span class="typ">Instant</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConstraintValidatorContext</span><span class="pln"> context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> value </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="typ">HibernateConstraintValidatorContext</span><span class="pln"> hibernateContext </span><span class="pun">=</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">unwrap</span><span class="pun">(</span><span class="pln">
                </span><span class="typ">HibernateConstraintValidatorContext</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
        </span><span class="pun">);</span><span class="pln">

        </span><span class="typ">Instant</span><span class="pln"> now </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Instant</span><span class="pun">.</span><span class="pln">now</span><span class="pun">(</span><span class="pln"> context</span><span class="pun">.</span><span class="pln">getClockProvider</span><span class="pun">().</span><span class="pln">getClock</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln">value</span><span class="pun">.</span><span class="pln">isAfter</span><span class="pun">(</span><span class="pln"> now </span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            hibernateContext</span><span class="pun">.</span><span class="pln">disableDefaultConstraintViolation</span><span class="pun">();</span><span class="pln">
            hibernateContext
                    </span><span class="pun">.</span><span class="pln">addMessageParameter</span><span class="pun">(</span><span class="pln"> </span><span class="str">"now"</span><span class="pun">,</span><span class="pln"> now </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">buildConstraintViolationWithTemplate</span><span class="pun">(</span><span class="pln"> </span><span class="str">"Must be after {now}"</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                    </span><span class="pun">.</span><span class="pln">addConstraintViolation</span><span class="pun">();</span><span class="pln">

            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了语法之外，消息参数和表达式变量之间的主要区别在于消息参数是简单插值的，而表达式变量是使用表达式语言引擎解释的。</font><font style="vertical-align: inherit;">在实践中，它不应该改变任何东西。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，通过</font></font><code>addExpressionVariable(String, Object)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和
 </font><font style="vertical-align: inherit;">指定的参数</font></font><code>addMessageParameter(String, Object)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是全局的，并且适用于此</font></font><code>isValid()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">创建的所有约束违规</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这包括默认约束违规，但也包括由此创建的所有违规</font></font><code>ConstraintViolationBuilder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，您可以在调用之间更新参数
 </font></font><code>ConstraintViolationBuilder#addConstraintViolation()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置任意动态有效负载 - 请参见</font></font><a href="#section-dynamic-payload"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第12.8节“动态有效负载作为一部分</font></font><code>ConstraintViolation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_code_hibernatemessageinterpolatorcontext_code"><a class="anchor" href="#_code_hibernatemessageinterpolatorcontext_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.11.2。 </font></font><code>HibernateMessageInterpolatorContext</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator还提供自定义扩展</font></font><code>MessageInterpolatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即
 </font></font><code>HibernateMessageInterpolatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参见</font></font><a href="#example-custom-message-interpolator-context"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.16，“ </font></font><code>HibernateMessageInterpolatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">引入此子类型以允许更好地将Hibernate Validator集成到Glassfish中。</font><font style="vertical-align: inherit;">在这种情况下，需要根bean类型来确定消息资源包的正确类加载器。</font><font style="vertical-align: inherit;">如果您有任何其他用例，请告诉我们。</font></font></p>
</div>
<div id="example-custom-message-interpolator-context" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.16： </font></font><code>HibernateMessageInterpolatorContext</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">@author</span><span class="pln"> </span><span class="typ">Guillaume</span><span class="pln"> </span><span class="typ">Smet</span><span class="pln">
 </span><span class="pun">*</span><span class="pln"> </span><span class="lit">@since</span><span class="pln"> </span><span class="lit">5.0</span><span class="pln">
 </span><span class="pun">*/</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">HibernateMessageInterpolatorContext</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">MessageInterpolator</span><span class="pun">.</span><span class="typ">Context</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="com">/**
     * Returns the currently validated root bean type.
     *
     * @return The currently validated root bean type.</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-paranamer-parameternameprovider"><a class="anchor" href="#section-paranamer-parameternameprovider"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.12。</font><font style="vertical-align: inherit;">Paranamer基础</font></font><code>ParameterNameProvider</code></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator附带了一个</font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用
 </font></font><a href="http://paranamer.codehaus.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Paranamer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库的实现。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该库提供了几种在运行时获取参数名称的方法，例如基于Java编译器创建的调试符号，在编译后步骤中编码到字节码中的参数名称的常量或诸如</font></font><code>@Named</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 330的</font><font style="vertical-align: inherit;">注释之类的</font><font style="vertical-align: inherit;">注释。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用</font></font><code>ParanamerParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，请在引导验证程序时传递实例，如</font></font><a href="#example-using-custom-parameter-name-provider"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例9.10“使用自定义</font></font><code>ParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”中所示，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者指定
 </font></font><code>org.hibernate.validator.parameternameprovider.ParanamerParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font><em><font style="vertical-align: inherit;">META-INF / validation.xml</font></em><font style="vertical-align: inherit;">文件中</font></font><code>&lt;parameter-name-provider&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素的</font><font style="vertical-align: inherit;">值
 </font><font style="vertical-align: inherit;">。</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此参数名称提供程序时，需要将Paranamer库添加到类路径中。</font><font style="vertical-align: inherit;">它在Maven Central存储库中可用，具有组ID </font></font><code>com.thoughtworks.paranamer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和工件ID </font></font><code>paranamer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，</font></font><code>ParanamerParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从构建时添加到字节代码的常量（通过</font></font><code>DefaultParanamer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和调试符号（通过</font></font><code>BytecodeReadingParanamer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中</font><font style="vertical-align: inherit;">检索参数名称</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">或者，您可以</font></font><code>Paranamer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在创建</font></font><code>ParanamerParameterNameProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">指定</font><font style="vertical-align: inherit;">所选</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">实现
 </font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="section-constraint-definition-contribution"><a class="anchor" href="#section-constraint-definition-contribution"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.13。</font><font style="vertical-align: inherit;">提供约束定义</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bean Validation允许在其约束映射文件中通过XML（重新）定义约束定义。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息，</font><font style="vertical-align: inherit;">请参见</font></font><a href="#section-mapping-xml-constraints"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第8.2节“通过映射约束</font></font><code>constraint-mappings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="#example-constraints-car"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例8.2“通过XML配置的Bean约束”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
。</font><font style="vertical-align: inherit;">虽然这种方法对于许多用例来说已经足够了，但它在其他用例中却有其缺点。</font><font style="vertical-align: inherit;">想象一下，例如想要为自定义类型提供约束定义的约束库。</font><font style="vertical-align: inherit;">该库可以提供其库的映射文件，但该文件的用户仍需要引用该文件。</font><font style="vertical-align: inherit;">幸运的是有更好的方法。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下概念在此时被认为是实验性的。</font><font style="vertical-align: inherit;">让我们知道您是否发现它们有用以及它们是否满足您的需求。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect3">
<h4 id="_constraint_definitions_via_code_serviceloader_code"><a class="anchor" href="#_constraint_definitions_via_code_serviceloader_code"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.13.1。</font><font style="vertical-align: inherit;">约束定义通过</font></font><code>ServiceLoader</code></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator允许利用Java的
 </font></font><a href="http://docs.oracle.com/javase/8/docs/api/?java/util/ServiceLoader.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServiceLoader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
机制来注册其他约束定义。</font><font style="vertical-align: inherit;">您所要做的就是将文件</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javax.validation.ConstraintValidator</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加
 </font><font style="vertical-align: inherit;">到</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / services</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在此服务文件中，列出约束验证器类的完全限定类名（每行一个）。</font><font style="vertical-align: inherit;">Hibernate Validator将自动推断它们适用的约束类型。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">
示例，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="#example-using-service-file-for-constraint-definitions"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务文件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的</font><a href="#example-using-service-file-for-constraint-definitions"><font style="vertical-align: inherit;">约束定义</font></a><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-service-file-for-constraint-definitions" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.17：</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / services / javax.validation.ConstraintValidator</font></font></em></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="com"># Assuming a custom constraint annotation @org.mycompany.CheckCase</span><span class="pln">
org</span><span class="pun">.</span><span class="pln">mycompany</span><span class="pun">.</span><span class="typ">CheckCaseValidator</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要为自定义约束提供默认消息，请将文件</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ContributorValidationMessages.properties</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
和/或其特定于语言环境的特化放置在JAR的根目录中。</font><font style="vertical-align: inherit;">除了</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidationMessages.properties中</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给出的那些，Hibernate Validator将考虑在类路径中找到具有此名称的所有bundle的条目</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在创建大型多模块应用程序时，此机制也很有用：您可以在每个模块中只包含该模块的那些消息，而不是将所有约束消息放入一个单独的包中。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们强烈建议您阅读</font></font><a href="http://in.relation.to/2017/03/02/adding-custom-constraint-definitions-via-the-java-service-loader/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marko Bekhta撰写</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
 </font><a href="http://in.relation.to/2017/03/02/adding-custom-constraint-definitions-via-the-java-service-loader/"><font style="vertical-align: inherit;">这篇博客文章</font></a><font style="vertical-align: inherit;">，指导您逐步完成创建包含自定义约束的独立JAR的过程，并通过它来声明它们</font></font><code>ServiceLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="section-programmatic-constraint-definition"><a class="anchor" href="#section-programmatic-constraint-definition"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.13.2。</font><font style="vertical-align: inherit;">以编程方式添加约束定义</font></font></h4>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然服务加载器方法适用于许多场景，但并非全部（例如，OSGi，其中服务文件不可见），还有另一种提供约束定义的方法。</font><font style="vertical-align: inherit;">您可以使用编程约束声明API  - 请参见
 </font></font><a href="#example-using-constraint-definition-api"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.18“通过编程API添加约束定义”</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div id="example-using-constraint-definition-api" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.18：通过编程API添加约束定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ConstraintMapping</span><span class="pln"> constraintMapping </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">createConstraintMapping</span><span class="pun">();</span><span class="pln">

constraintMapping
        </span><span class="pun">.</span><span class="pln">constraintDefinition</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ValidPassengerCount</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">validatedBy</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ValidPassengerCountValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果验证器实现相当简单（即不需要从注释初始化，并且</font></font><code>ConstraintValidatorContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未使用），您还可以使用此备用API来使用Lambda表达式或方法引用指定约束逻辑：</font></font></p>
</div>
<div id="example-using-constraint-definition-api-lambda" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.19：使用Lambda表达式添加约束定义</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ConstraintMapping</span><span class="pln"> constraintMapping </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">createConstraintMapping</span><span class="pun">();</span><span class="pln">

constraintMapping
        </span><span class="pun">.</span><span class="pln">constraintDefinition</span><span class="pun">(</span><span class="pln"> </span><span class="typ">ValidPassengerCount</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">.</span><span class="pln">validateType</span><span class="pun">(</span><span class="pln"> </span><span class="typ">Bus</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
                </span><span class="pun">.</span><span class="kwd">with</span><span class="pun">(</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">getSeatCount</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">getPassengers</span><span class="pun">().</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font><a href="#section-programmatic-api-contributor"><font style="vertical-align: inherit;">第12.5节“将编程约束声明应用于默认验证器工厂”中</font></a></font><code>ConstraintMappingContributor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
详细说明，</font><font style="vertical-align: inherit;">而不是直接向配置对象添加约束映射</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在使用</font><em><font style="vertical-align: inherit;">META-INF / validation.xml</font></em><font style="vertical-align: inherit;">配置默认验证器工厂时，这非常有用</font><font style="vertical-align: inherit;">（请参阅
 </font><a href="#chapter-xml-configuration"><font style="vertical-align: inherit;">第8章，</font></a><a href="#chapter-xml-configuration"><em><font style="vertical-align: inherit;">通过XML配置</font></em></a><font style="vertical-align: inherit;">）。</font></font><a href="#section-programmatic-api-contributor"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><a href="#chapter-xml-configuration"><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em></a><font style="vertical-align: inherit;"></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过编程API注册约束定义的一个用例是为约束指定备用约束验证器的能力</font></font><code>@URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从历史上看，Hibernate Validator的此约束的默认约束验证器使用</font></font><code>java.net.URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数来验证URL。</font><font style="vertical-align: inherit;">但是，还有一个纯正则表达式版本可用，可以使用以下命令配置</font></font><code>ConstraintDefinitionContributor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="listingblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用编程约束声明API为基于正则表达式的约束定义注册 </font></font><code>@URL</code></div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">ConstraintMapping</span><span class="pln"> constraintMapping </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">createConstraintMapping</span><span class="pun">();</span><span class="pln">

constraintMapping
        </span><span class="pun">.</span><span class="pln">constraintDefinition</span><span class="pun">(</span><span class="pln"> URL</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">includeExistingValidators</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">validatedBy</span><span class="pun">(</span><span class="pln"> </span><span class="typ">RegexpURLValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">);</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-constraint-customizing-class-loading"><a class="anchor" href="#section-constraint-customizing-class-loading"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.14。</font><font style="vertical-align: inherit;">自定义类加载</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，Hibernate Validator需要加载由name给出的资源或类：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML描述符（</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">META-INF / validation.xml</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及XML约束映射）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML描述符中由name指定的类（例如自定义消息插值器等）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ValidationMessages</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源包</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述</font></font><code>ExpressionFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于基于表达消息内插实施</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，Hibernate Validator尝试通过当前线程上下文类加载器加载这些资源。</font><font style="vertical-align: inherit;">如果这不成功，Hibernate Validator自己的类加载器将作为后备尝试。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于不适合此策略的情况（例如OSGi等模块化环境），您可以在引导验证器工厂时提供特定的类加载器来加载这些资源：</font></font></p>
</div>
<div id="example-using-external-class-loader" class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例12.20：提供一个用于加载外部资源和类的类加载器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-JAVA" data-lang="JAVA"><span class="typ">Validator</span><span class="pln"> validator </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Validation</span><span class="pun">.</span><span class="pln">byProvider</span><span class="pun">(</span><span class="pln"> </span><span class="typ">HibernateValidator</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">configure</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">externalClassLoader</span><span class="pun">(</span><span class="pln"> classLoader </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">buildValidatorFactory</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">getValidator</span><span class="pun">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在OSGi的情况下，您可以例如从bundle bootstrapping Hibernate Validator或委托给它的自定义类加载器实现传递类的加载器</font></font><code>Bundle#loadClass()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="注意"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"></font><code>ValidatorFactory#close()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果不再需要给定的验证工厂实例，则</font><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果不重新部署应用程序/软件包并且应用程序代码仍引用非封闭验证器工厂，则不这样做可能会导致类加载器泄漏。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validator-annotation-processor"><a class="anchor" href="#validator-annotation-processor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.注释处理器</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你有无意识地做过这样的事吗？</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在不支持的数据类型上指定约束注释（例如，通过使用注释来指定字符串</font></font><code>@Past</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释JavaBeans属性的setter（而不是getter方法）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用约束注释注释静态字段/方法（不支持）？</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那么Hibernate Validator Annotation Processor对你来说是正确的。</font><font style="vertical-align: inherit;">它可以通过插入构建过程并在错误地使用约束注释时引发编译错误来帮助防止此类错误。</font></font></p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="小费"></i>
</td>
<td class="content">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以在</font></font><a href="http://sourceforge.net/projects/hibernate/files/hibernate-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sourceforge上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或在GAV下的常规Maven存储库（如Maven Central）中
 </font><font style="vertical-align: inherit;">找到Hibernate Validator Annotation Processor作为分发包的一部分
 </font></font><code>org.hibernate.validator:hibernate-validator-annotation-processor:6.0.13.Final</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect2">
<h3 id="validator-annotationprocessor-prerequisites"><a class="anchor" href="#validator-annotationprocessor-prerequisites"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1。</font><font style="vertical-align: inherit;">先决条件</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator Annotation Processor基于</font></font><a href="http://jcp.org/en/jsr/detail?id=269"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 269</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义的“Pluggable Annotation Processing API”，</font><font style="vertical-align: inherit;">它是Java Platform的一部分。</font></font></p>
</div>
</div>
<div class="sect2">
<h3 id="validator-annotationprocessor-features"><a class="anchor" href="#validator-annotationprocessor-features"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.2。</font><font style="vertical-align: inherit;">特征</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从Hibernate Validator 6.0.13.Final开始，Hibernate Validator Annotation Processor检查：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许注释元素的类型使用约束注释</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有非静态字段或方法使用约束注释进行注释</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有非原始字段或方法注释 </font></font><code>@Valid</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有这样的方法使用约束注释进行注释，这些注释是有效的JavaBeans getter方法（可选，见下文）</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有这样的注释类型用约束注释注释，约束注释本身就是约束注释</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态默认组序列的定义</font></font><code>@GroupSequenceProvider</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是有效的</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释参数值有意义且有效</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继承层次结构中的方法参数约束遵循继承规则</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继承层次结构中的方法返回值约束遵循继承规则</font></font></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="validator-annotationprocessor-options"><a class="anchor" href="#validator-annotationprocessor-options"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3。</font><font style="vertical-align: inherit;">选项</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用以下</font></font><a href="http://docs.oracle.com/javase/8/docs/technotes/tools/windows/javac.html#BHCHACIB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理器选项</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制Hibernate Validator Annotation Processor的行为
 </font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>diagnosticKind</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制如何报告约束问题。</font><font style="vertical-align: inherit;">必须是枚举中其中一个值的字符串表示</font></font><code>javax.tools.Diagnostic.Kind</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，例如</font></font><code>WARNING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code>ERROR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当AP检测到约束问题时，</font><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">将导致编译停止。</font><font style="vertical-align: inherit;">默认为</font></font><code>ERROR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><code>methodConstraintsSupported</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制是否允许在任何类型的方法中使用约束。</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用Hibernate Validator支持的方法级别约束时</font><font style="vertical-align: inherit;">必须设置为</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">可以设置为</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅允许Bean Validation API定义的JavaBeans getter方法的约束。</font><font style="vertical-align: inherit;">默认为</font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
<dt class="hdlist1"><code>verbose</code></dt>
<dd>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制是否显示详细的处理信息，对调试有用。</font><font style="vertical-align: inherit;">必须是
 </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认为</font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="validator-annotationprocessor-usage"><a class="anchor" href="#validator-annotationprocessor-usage"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4。</font><font style="vertical-align: inherit;">使用注释处理器</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节详细介绍了如何将Hibernate Validator Annotation Processor集成到命令行构建（Maven，Ant，javac）以及基于IDE的构建（Eclipse，IntelliJ IDEA，NetBeans）中。</font></font></p>
</div>
<div class="sect3">
<h4 id="validator-annotationprocessor-commandline"><a class="anchor" href="#validator-annotationprocessor-commandline"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.1。</font><font style="vertical-align: inherit;">命令行构建</font></font></h4>
<div class="sect4">
<h5 id="validator-annotationprocessor-maven"><a class="anchor" href="#validator-annotationprocessor-maven"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.1.1。</font><font style="vertical-align: inherit;">Maven的</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要将Hibernate Validator注释处理器与Maven一起使用，请通过以下</font></font><code>annotationProcessorPaths</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项进行</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例13.1：在Maven中使用HV注释处理器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;project&gt;</span><span class="pln">
    [...]
    </span><span class="tag">&lt;build&gt;</span><span class="pln">
        [...]
        </span><span class="tag">&lt;plugins&gt;</span><span class="pln">
            [...]
            </span><span class="tag">&lt;plugin&gt;</span><span class="pln">
                </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.apache.maven.plugins</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
                </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">maven-compiler-plugin</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
                </span><span class="tag">&lt;version&gt;</span><span class="pln">3.6.1</span><span class="tag">&lt;/version&gt;</span><span class="pln">
                </span><span class="tag">&lt;configuration&gt;</span><span class="pln">
                    </span><span class="tag">&lt;source&gt;</span><span class="pln">1.8</span><span class="tag">&lt;/source&gt;</span><span class="pln">
                    </span><span class="tag">&lt;target&gt;</span><span class="pln">1.8</span><span class="tag">&lt;/target&gt;</span><span class="pln">
                    </span><span class="tag">&lt;annotationProcessorPaths&gt;</span><span class="pln">
                        </span><span class="tag">&lt;path&gt;</span><span class="pln">
                            </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.hibernate.validator</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
                            </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">hibernate-validator-annotation-processor</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
                            </span><span class="tag">&lt;version&gt;</span><span class="pln">6.0.13.Final</span><span class="tag">&lt;/version&gt;</span><span class="pln">
                        </span><span class="tag">&lt;/path&gt;</span><span class="pln">
                    </span><span class="tag">&lt;/annotationProcessorPaths&gt;</span><span class="pln">
                </span><span class="tag">&lt;/configuration&gt;</span><span class="pln">
            </span><span class="tag">&lt;/plugin&gt;</span><span class="pln">
            [...]
        </span><span class="tag">&lt;/plugins&gt;</span><span class="pln">
        [...]
    </span><span class="tag">&lt;/build&gt;</span><span class="pln">
    [...]
</span><span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="validator-annotationprocessor-ant"><a class="anchor" href="#validator-annotationprocessor-ant"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.1.2。</font><font style="vertical-align: inherit;">Apache Ant</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与直接使用javac类似，在</font><font style="vertical-align: inherit;">
为</font><a href="http://ant.apache.org/"><font style="vertical-align: inherit;">Apache Ant</font></a><font style="vertical-align: inherit;">调用</font></font><a href="http://ant.apache.org/manual/CoreTasks/javac.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javac任务</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时，可以将注释处理器添加为编译器参数</font><font style="vertical-align: inherit;">：</font></font><a href="http://ant.apache.org/"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例13.2：使用带有Ant的注释处理器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-XML" data-lang="XML"><span class="tag">&lt;javac</span><span class="pln"> </span><span class="atn">srcdir</span><span class="pun">=</span><span class="atv">"src/main"</span><span class="pln">
       </span><span class="atn">destdir</span><span class="pun">=</span><span class="atv">"build/classes"</span><span class="pln">
       </span><span class="atn">classpath</span><span class="pun">=</span><span class="atv">"/path/to/validation-api-2.0.1.Final.jar"</span><span class="tag">&gt;</span><span class="pln">
       </span><span class="tag">&lt;compilerarg</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"-processorpath"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
       </span><span class="tag">&lt;compilerarg</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"/path/to/hibernate-validator-annotation-processor-6.0.13.Final.jar"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/javac&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="validator-annotationprocessor-javac"><a class="anchor" href="#validator-annotationprocessor-javac"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.1.3。</font><font style="vertical-align: inherit;">javac的</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/javac/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javac</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在命令行上
 </font><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/javac/index.html"><font style="vertical-align: inherit;">编译时</font></a><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">使用“processorpath”选项</font><font style="vertical-align: inherit;">指定JAR
 </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hibernate-validator-annotation-processor-6.0.13.Final.jar</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下面的清单所示。</font><font style="vertical-align: inherit;">编译器将自动检测处理器并在编译期间调用。</font></font></p>
</div>
<div class="exampleblock">
<div class="title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例13.3：使用带有javac的注释处理器</font></font></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">javac src / main / java / org / hibernate / validator / ap / demo / Car.java \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   -cp /path/to/validation-api-2.0.1.Final.jar \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   -processorpath /path/to/hibernate-validator-annotation-processor-6.0.13.Final.jar</font></font></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="validator-annotationprocessor-ide"><a class="anchor" href="#validator-annotationprocessor-ide"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.2。</font><font style="vertical-align: inherit;">IDE构建</font></font></h4>
<div class="sect4">
<h5 id="_eclipse"><a class="anchor" href="#_eclipse"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.2.1。</font><font style="vertical-align: inherit;">日食</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果安装了</font></font><a href="https://www.eclipse.org/m2e/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M2E Eclipse插件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则将自动为如上所述配置的Maven项目设置注释处理器</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于纯Eclipse项目，请按照以下步骤设置注释处理器：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右键单击您的项目，选择“属性”</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转到“Java编译器”并确保“编译器合规性级别”设置为“1.8”。</font><font style="vertical-align: inherit;">否则，处理器将不会被激活</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转到“Java编译器 - 注释处理”并选择“启用注释处理”</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转到“Java编译器 - 注释处理 - 工厂路径”并添加JAR hibernate-validator-annotation-processor-6.0.13.Final.jar</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确认工作区重建</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您现在应该在编辑器和“问题”视图中看到任何注释问题作为常规错误标记：</font></font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/annotation_processor_eclipse.png" alt="注释处理器eclipse">
</div>
</div>
</div>
<div class="sect4">
<h5 id="validator-annotationprocessor-idea"><a class="anchor" href="#validator-annotationprocessor-idea"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.2.2。</font><font style="vertical-align: inherit;">IntelliJ IDEA</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须遵循以下步骤才能在</font></font><a href="http://www.jetbrains.com/idea/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IntelliJ IDEA</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（版本9及更高版本）中</font><font style="vertical-align: inherit;">使用注释处理器
 </font><font style="vertical-align: inherit;">：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转到“文件”，然后“设置”，</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展开节点“编译器”，然后“注释处理器”</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择“启用注释处理”并输入以下内容作为“处理器路径”：/ path/to/hibernate-validator-annotation-processor-6.0.13.Final.jar</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将处理器的完全限定名称org.hibernate.validator.ap.ConstraintValidationProcessor添加到“注释处理器”列表中</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果适用，请将模块添加到“已处理模块”列表中</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后重建您的项目应该显示任何错误的约束注释：</font></font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/annotation_processor_intellij.png" alt="注释处理器intellij">
</div>
</div>
</div>
<div class="sect4">
<h5 id="validator-annotationprocessor-netbeans"><a class="anchor" href="#validator-annotationprocessor-netbeans"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.2.3。</font><font style="vertical-align: inherit;">NetBeans的</font></font></h5>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><a href="http://www.netbeans.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的NetBeans</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> IDE支持使用IDE构建中的注解处理器。</font><font style="vertical-align: inherit;">为此，请执行以下操作：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右键单击您的项目，选择“属性”</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转到“库”，选项卡“处理器”，然后添加JAR hibernate-validator-annotation-processor-6.0.13.Final.jar</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转到“构建 - 编译”，选择“启用注释处理”和“在编辑器中启用注释处理”。</font><font style="vertical-align: inherit;">通过指定其完全限定名称org.hibernate.validator.ap.ConstraintValidationProcessor来添加注释处理器</font></font></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，任何约束注释问题都将直接在编辑器中标记：</font></font></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/annotation_processor_netbeans.png" alt="注释处理器netbeans">
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validator-annotationprocessor-known-issues"><a class="anchor" href="#validator-annotationprocessor-known-issues"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.5。</font><font style="vertical-align: inherit;">已知的问题</font></font></h3>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">截至2017年7月存在以下已知问题：</font></font></p>
</div>
<div class="ulist">
<ul>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在不支持容器元素约束。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用于容器但实际上应用于容器元素的约束（无论是通过</font></font><code>Unwrapping.Unwrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载还是通过标记的值提取器</font></font><code>@UnwrapByDefault</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）都不能正确支持。</font></font></p>
</li>
<li>
<p><a href="https://hibernate.atlassian.net/browse/HV-308"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HV-308</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">注释处理器不评估</font></font><a href="http://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#chapter-xml-configuration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用XML</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册约束的附加验证器
 </font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Eclipse中使用处理器时，</font><font style="vertical-align: inherit;">有时无法</font></font><a href="https://hibernate.atlassian.net/browse/HV-293"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正确评估</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义约束
 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这些情况下清洁项目可能会有所帮助。</font><font style="vertical-align: inherit;">这似乎是Eclipse JSR 269 API实现的一个问题，但这里需要进一步调查。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Eclipse中使用处理器时，动态默认组序列定义的检查不起作用。</font><font style="vertical-align: inherit;">经过进一步调查，它似乎是Eclipse JSR 269 API实现的一个问题。</font></font></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validator-further-reading"><a class="anchor" href="#validator-further-reading"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.进一步阅读</font></font></h2>
<div class="sectionbody">
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后但并非最不重要的，一些指向更多信息的指示。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个很好的例子来源是Bean Validation TCK，可以在</font></font><a href="https://github.com/beanvalidation/beanvalidation-tck/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行匿名访问
 </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">特别是TCK的
 </font></font><a href="https://github.com/beanvalidation/beanvalidation-tck/tree/master/tests"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会引起关注。</font></font><a href="http://beanvalidation.org/2.0/spec/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 380</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规范本身也是加深您对Bean Validation和Hibernate Validator的理解的好方法。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您对Hibernate Validator有任何疑问或希望分享您的一些用例，请查看</font></font><a href="http://community.jboss.org/en/hibernate/validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator Wiki</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://discourse.hibernate.org/c/hibernate-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator论坛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://stackoverflow.com/questions/tagged/hibernate-validator"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stack Overflow上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的
 </font><a href="https://stackoverflow.com/questions/tagged/hibernate-validator"><font style="vertical-align: inherit;">Hibernate Validator标签</font></a><font style="vertical-align: inherit;">。</font></font></p>
</div>
<div class="paragraph">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您想报告错误，请使用
 </font></font><a href="https://hibernate.atlassian.net/projects/HV/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate的Jira</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font><font style="vertical-align: inherit;">随时欢迎反馈！</font></font></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
上次更新时间2018-08-22 22:15:09 UTC
</font></font></div>
</div>
<!-- Google Analytics -->
<script type="text/javascript" async="" src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/elqCfg.min.js.下载"></script><script type="text/javascript" async="" src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/insight.min.js.下载"></script><script type="text/javascript" async="" src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/f.txt"></script><script type="text/javascript" async="" src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/analytics.js.下载"></script><script async="" src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/gtm.js.下载"></script><script type="text/javascript">
	dataLayer = [{'channel' : 'Hibernate', 'additional_tracking_code' : 'UA-45270411-3'}];
	(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
		new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
		j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-NJWS5L');
</script>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-NJWS5L" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- /Google Analytics -->

<!-- HibernateDoc.OutdatedContent -->
<script src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/jquery-3.1.0.min.js.下载" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
<script src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/outdated-content.js.下载" type="text/javascript"></script>
<script type="text/javascript">var jQuery_3_1 = $.noConflict(true); jQuery_3_1(document).ready(function() { HibernateDoc.OutdatedContent.install('validator'); });</script>
<!-- /HibernateDoc.OutdatedContent -->
<link rel="stylesheet" href="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/prettify.min.css">
<script src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/prettify.min.js.下载"></script>
<script>prettyPrint()</script>


<script type="text/javascript" id="">window.eloqua=window.eloqua||{queue:[]};window.eloqua.siteId="1795";window.eloqua.formName="jboss-org-integration";eloqua.queue.unshift("eloqua.load");eloqua.queue.push("eloqua.loadGUID");</script>

<script type="text/javascript" id="" src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/elqCfg.js.下载"></script>

<script type="text/javascript" id="">var eloqua=eloqua||{guid:null};
(function(){function f(b){var a="; "+document.cookie;b=a.split("; "+b+"\x3d");if(2==b.length)return b.pop().split(";").shift()}function c(b){var a=window.location.hostname;var e=a.indexOf(".jboss.org");e=-1!=e?a.substring(e,a.length):null;a=g;var c=k,d=new Date;d.setTime(d.getTime()+c);c="expires\x3d"+d.toUTCString();a=a+"\x3d"+b+"; "+c;a+=";path\x3d/";e&&(a+=";domain\x3d"+e);document.cookie=a}function d(){if(h){if("function"===typeof window.GetElqCustomerGUID){eloqua.guid=GetElqCustomerGUID();c(eloqua.guid);
return}if(eloqua.guid){c(eloqua.guid);return}}h=setTimeout(d,100)}function l(){if(!f(g)){var b=f("rh_elqCustomerGUID");b?(eloqua.guid=b,c(eloqua.guid)):jQuery?jQuery(document).ready(d):d()}}var k=2592E6,g="elqGUID",h=null;l()})();</script>        <script type="text/javascript" id="">_bizo_data_partner_id="6570";</script>
<script type="text/javascript" id="">(function(){var b=document.getElementsByTagName("script")[0],a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===window.location.protocol?"https://sjs":"http://js")+".bizographics.com/insight.min.js";b.parentNode.insertBefore(a,b)})();</script>
<noscript>
  <img height="1" width="1" alt="" style="display:none;" src="//www.bizographics.com/collect/?pid=6570&amp;fmt=gif">
</noscript><script src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/f(1).txt"></script>
<script type="text/javascript" id="" src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/eloqua-1.0.13.min.js.下载"></script><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div><script src="./Hibernate Validator 6.0.13.Final - JSR 380参考实现：参考指南_files/saved_resource" type="text/javascript"></script><div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>